(function(){var r,i,t;(function(n){function e(n,t){return d.call(n,t)}function l(n,t){var o,s,u,e,h,y,c,b,i,l,p,k,r=t&&t.split("/"),a=f.map,v=a&&a["*"]||{};if(n){for(n=n.split("/"),h=n.length-1,f.nodeIdCompat&&w.test(n[h])&&(n[h]=n[h].replace(w,"")),n[0].charAt(0)==="."&&r&&(k=r.slice(0,r.length-1),n=k.concat(n)),i=0;i<n.length;i++)if(p=n[i],p===".")n.splice(i,1),i-=1;else if(p==="..")if(i===0||i===1&&n[2]===".."||n[i-1]==="..")continue;else i>0&&(n.splice(i-1,2),i-=2);n=n.join("/")}if((r||v)&&a){for(o=n.split("/"),i=o.length;i>0;i-=1){if(s=o.slice(0,i).join("/"),r)for(l=r.length;l>0;l-=1)if(u=a[r.slice(0,l).join("/")],u&&(u=u[s],u)){e=u;y=i;break}if(e)break;!c&&v&&v[s]&&(c=v[s],b=i)}!e&&c&&(e=c,y=b);e&&(o.splice(0,y,e),n=o.join("/"))}return n}function b(t,i){return function(){var r=g.call(arguments,0);return typeof r[0]!="string"&&r.length===1&&r.push(null),o.apply(n,r.concat([t,i]))}}function nt(n){return function(t){return l(t,n)}}function tt(n){return function(t){u[n]=t}}function a(t){if(e(h,t)){var i=h[t];delete h[t];y[t]=!0;c.apply(n,i)}if(!e(u,t)&&!e(y,t))throw new Error("No "+t);return u[t]}function p(n){var i,t=n?n.indexOf("!"):-1;return t>-1&&(i=n.substring(0,t),n=n.substring(t+1,n.length)),[i,n]}function k(n){return n?p(n):[]}function it(n){return function(){return f&&f.config&&f.config[n]||{}}}var c,o,v,s,u={},h={},f={},y={},d=Object.prototype.hasOwnProperty,g=[].slice,w=/\.js$/;v=function(n,t){var r,u=p(n),i=u[0],f=t[1];return n=u[1],i&&(i=l(i,f),r=a(i)),i?n=r&&r.normalize?r.normalize(n,nt(f)):l(n,f):(n=l(n,f),u=p(n),i=u[0],n=u[1],i&&(r=a(i))),{f:i?i+"!"+n:n,n:n,pr:i,p:r}};s={require:function(n){return b(n)},exports:function(n){var t=u[n];return typeof t!="undefined"?t:u[n]={}},module:function(n){return{id:n,uri:"",exports:u[n],config:it(n)}}};c=function(t,i,r,f){var p,o,d,w,c,g,l=[],nt=typeof r,it;if(f=f||t,g=k(f),nt==="undefined"||nt==="function"){for(i=!i.length&&r.length?["require","exports","module"]:i,c=0;c<i.length;c+=1)if(w=v(i[c],g),o=w.f,o==="require")l[c]=s.require(t);else if(o==="exports")l[c]=s.exports(t),it=!0;else if(o==="module")p=l[c]=s.module(t);else if(e(u,o)||e(h,o)||e(y,o))l[c]=a(o);else if(w.p)w.p.load(w.n,b(f,!0),tt(o),{}),l[c]=u[o];else throw new Error(t+" missing "+o);d=r?r.apply(u[t],l):undefined;t&&(p&&p.exports!==n&&p.exports!==u[t]?u[t]=p.exports:d===n&&it||(u[t]=d))}else t&&(u[t]=r)};r=i=o=function(t,i,r,u,e){if(typeof t=="string")return s[t]?s[t](i):a(v(t,k(i)).f);if(!t.splice){if(f=t,f.deps&&o(f.deps,f.callback),!i)return;i.splice?(t=i,i=r,r=null):t=n}return i=i||function(){},typeof r=="function"&&(r=u,u=e),u?c(n,t,i,r):setTimeout(function(){c(n,t,i,r)},4),o};o.config=function(n){return o(n)};r._defined=u;t=function(n,t,i){if(typeof n!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(i=t,t=[]);e(u,n)||e(h,n)||(h[n]=[n,t,i])};t.amd={jQuery:!0}})();t("Core/appendForwardSlash",[],function(){"use strict";function n(n){return(n.length===0||n[n.length-1]!=="/")&&(n=n+"/"),n}return n});t("Core/defined",[],function(){"use strict";function n(n){return n!==undefined&&n!==null}return n});t("Core/DeveloperError",["./defined"],function(n){"use strict";function t(n){this.name="DeveloperError";this.message=n;var t;try{throw new Error;}catch(i){t=i.stack}this.stack=t}return n(Object.create)&&(t.prototype=Object.create(Error.prototype),t.prototype.constructor=t),t.prototype.toString=function(){var t=this.name+": "+this.message;return n(this.stack)&&(t+="\n"+this.stack.toString()),t},t.throwInstantiationError=function(){throw new t("This function defines an interface and should not be called directly.");},t});t("ThirdParty/Uri",[],function(){function n(t){if(t instanceof n)this.scheme=t.scheme,this.authority=t.authority,this.path=t.path,this.query=t.query,this.fragment=t.fragment;else if(t){var i=r.exec(t);this.scheme=i[1];this.authority=i[2];this.path=i[3];this.query=i[4];this.fragment=i[5]}}function i(n){var t=unescape(n);return u.test(t)?t:n.toUpperCase()}function e(n,t,i,r){return(t||"")+i.toLowerCase()+(r||"")}var r;n.prototype.scheme=null;n.prototype.authority=null;n.prototype.path="";n.prototype.query=null;n.prototype.fragment=null;r=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");n.prototype.getScheme=function(){return this.scheme};n.prototype.getAuthority=function(){return this.authority};n.prototype.getPath=function(){return this.path};n.prototype.getQuery=function(){return this.query};n.prototype.getFragment=function(){return this.fragment};n.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment};n.prototype.isSameDocumentAs=function(n){return n.scheme==this.scheme&&n.authority==this.authority&&n.path==this.path&&n.query==this.query};n.prototype.equals=function(n){return this.isSameDocumentAs(n)&&n.fragment==this.fragment};n.prototype.normalize=function(){this.removeDotSegments();this.scheme&&(this.scheme=this.scheme.toLowerCase());this.authority&&(this.authority=this.authority.replace(f,e).replace(t,i));this.path&&(this.path=this.path.replace(t,i));this.query&&(this.query=this.query.replace(t,i));this.fragment&&(this.fragment=this.fragment.replace(t,i))};var t=/%[0-9a-z]{2}/gi,u=/[a-zA-Z0-9\-\._~]/,f=/(.*@)?([^@:]*)(:.*)?/;return n.prototype.resolve=function(t){var i=new n;return this.scheme?(i.scheme=this.scheme,i.authority=this.authority,i.path=this.path,i.query=this.query):(i.scheme=t.scheme,this.authority?(i.authority=this.authority,i.path=this.path,i.query=this.query):(i.authority=t.authority,this.path==""?(i.path=t.path,i.query=this.query||t.query):(this.path.charAt(0)=="/"?(i.path=this.path,i.removeDotSegments()):(i.path=t.authority&&t.path==""?"/"+this.path:t.path.substring(0,t.path.lastIndexOf("/")+1)+this.path,i.removeDotSegments()),i.query=this.query))),i.fragment=this.fragment,i},n.prototype.removeDotSegments=function(){var n=this.path.split("/"),i=[],t,r=n[0]=="",u;for(r&&n.shift(),u=n[0]==""?n.shift():null;n.length;)t=n.shift(),t==".."?i.pop():t!="."&&i.push(t);(t=="."||t=="..")&&i.push("");r&&i.unshift("");this.path=i.join("/")},n.prototype.toString=function(){var n="";return this.scheme&&(n+=this.scheme+":"),this.authority&&(n+="//"+this.authority),n+=this.path,this.query&&(n+="?"+this.query),this.fragment&&(n+="#"+this.fragment),n},n});t("Core/freezeObject",["./defined"],function(n){"use strict";var t=Object.freeze;return n(t)||(t=function(n){return n}),t});t("Core/defaultValue",["./freezeObject"],function(n){"use strict";function t(n,t){return n!==undefined&&n!==null?n:t}return t.EMPTY_OBJECT=n({}),t});t("Core/getAbsoluteUri",["../ThirdParty/Uri","./defaultValue","./defined","./DeveloperError"],function(n,t,i,r){"use strict";function u(n,t){var i;return typeof document!="undefined"&&(i=document),u._implementation(n,t,i)}return u._implementation=function(u,f,e){if(!i(u))throw new r("relative uri is required.");if(!i(f)){if(typeof e=="undefined")return u;f=t(e.baseURI,e.location.href)}var o=new n(f),s=new n(u);return s.resolve(o).toString()},u}),function(n){"use strict";n("ThirdParty/when",[],function(){function n(n,i,r,u){return t(n).then(i,r,u)}function t(n){var i,t;return n instanceof r?i=n:c(n)?(t=u(),n.then(function(n){t.resolve(n)},function(n){t.reject(n)},function(n){t.progress(n)}),i=t.promise):i=b(n),i}function w(t){return n(t,i)}function r(n){this.then=n}function b(n){return new r(function(r){try{return t(r?r(n):n)}catch(u){return i(u)}})}function i(n){return new r(function(r,u){try{return u?t(u(n)):i(n)}catch(f){return i(f)}})}function u(){function y(n,t,i){return h(n,t,i)}function p(n){return s(n)}function w(n){return s(i(n))}function b(n){return c(n)}var l,a,n,e,h,c,s;return a=new r(y),l={then:y,resolve:p,reject:w,progress:b,promise:a,resolver:{resolve:p,reject:w,progress:b}},n=[],e=[],h=function(t,i,r){var f,o;return f=u(),o=typeof r=="function"?function(n){try{f.progress(r(n))}catch(t){f.progress(t)}}:function(n){f.progress(n)},n.push(function(n){n.then(t,i).then(f.resolve,f.reject,o)}),e.push(o),f.promise},c=function(n){return v(e,n),n},s=function(i){return i=t(i),h=i.then,s=t,c=o,v(n,i),e=n=f,i},l}function c(n){return n&&typeof n.then=="function"}function l(t,i,r,f,e){return y(2,arguments),n(t,function(t){function k(n){v(n)}function d(n){a(n)}var c,w,l,p,s,a,v,b,y,h;if(y=t.length>>>0,c=Math.max(0,Math.min(i,y)),l=[],w=y-c+1,p=[],s=u(),c)for(b=s.progress,v=function(n){p.push(n);--w||(a=v=o,s.reject(p))},a=function(n){l.push(n);--c||(a=v=o,s.resolve(l))},h=0;h<y;++h)h in t&&n(t[h],d,k,b);else s.resolve(l);return s.then(r,f,e)})}function k(n,t,i,r){function u(n){return t?t(n[0]):n[0]}return l(n,1,u,i,r)}function a(n,t,i,r){return y(1,arguments),e(n,p).then(t,i,r)}function d(){return e(arguments,p)}function e(t,i){return n(t,function(t){var e,s,o,h,r,f;if(o=s=t.length>>>0,e=[],f=u(),o)for(h=function(t,r){n(t,i).then(function(n){e[r]=n;--o||f.resolve(e)},f.reject)},r=0;r<s;r++)r in t?h(t[r],r):--o;else f.resolve(e);return f.promise})}function g(t,i){var r=h.call(arguments,1);return n(t,function(t){var u;return u=t.length,r[0]=function(t,r,f){return n(t,function(t){return n(r,function(n){return i(t,n,f,u)})})},s.apply(t,r)})}function nt(t,r,u){var f=arguments.length>2;return n(t,function(n){return n=f?u:n,r.resolve(n),n},function(n){return r.reject(n),i(n)},r.progress)}function v(n,t){for(var i,r=0;i=n[r++];)i(t)}function y(n,t){for(var i,r=t.length;r>n;)if(i=t[--r],i!=null&&typeof i!="function")throw new Error("arg "+r+" must be a function");}function o(){}function p(n){return n}var s,h,f;return n.defer=u,n.resolve=t,n.reject=w,n.join=d,n.all=a,n.map=e,n.reduce=g,n.any=k,n.some=l,n.chain=nt,n.isPromise=c,r.prototype={always:function(n,t){return this.then(n,n,t)},otherwise:function(n){return this.then(f,n)},"yield":function(n){return this.then(function(){return n})},spread:function(n){return this.then(function(t){return a(t,function(t){return n.apply(f,t)})})}},h=[].slice,s=[].reduce||function(n){var i,u,r,f,t;if(t=0,i=Object(this),f=i.length>>>0,u=arguments,u.length<=1)for(;;){if(t in i){r=i[t++];break}if(++t>=f)throw new TypeError;}else r=u[1];for(;t<f;++t)t in i&&(r=n(r,i[t],t,i));return r},n})}(typeof t=="function"&&t.amd?t:function(n){typeof exports=="object"?module.exports=n():this.when=n()});t("Core/Check",["./defined","./DeveloperError"],function(n,t){"use strict";function u(n){return n+" is required, actual value was undefined"}function r(n,t,i){return"Expected "+i+" to be typeof "+t+", actual typeof was "+n}var i={};return i.typeOf={},i.defined=function(i,r){if(!n(r))throw new t(u(i));},i.typeOf.func=function(n,i){if(typeof i!="function")throw new t(r(typeof i,"function",n));},i.typeOf.string=function(n,i){if(typeof i!="string")throw new t(r(typeof i,"string",n));},i.typeOf.number=function(n,i){if(typeof i!="number")throw new t(r(typeof i,"number",n));},i.typeOf.number.lessThan=function(n,r,u){if(i.typeOf.number(n,r),r>=u)throw new t("Expected "+n+" to be less than "+u+", actual value was "+r);},i.typeOf.number.lessThanOrEquals=function(n,r,u){if(i.typeOf.number(n,r),r>u)throw new t("Expected "+n+" to be less than or equal to "+u+", actual value was "+r);},i.typeOf.number.greaterThan=function(n,r,u){if(i.typeOf.number(n,r),r<=u)throw new t("Expected "+n+" to be greater than "+u+", actual value was "+r);},i.typeOf.number.greaterThanOrEquals=function(n,r,u){if(i.typeOf.number(n,r),r<u)throw new t("Expected "+n+" to be greater than or equal to"+u+", actual value was "+r);},i.typeOf.object=function(n,i){if(typeof i!="object")throw new t(r(typeof i,"object",n));},i.typeOf.bool=function(n,i){if(typeof i!="boolean")throw new t(r(typeof i,"boolean",n));},i.typeOf.number.equals=function(n,r,u,f){if(i.typeOf.number(n,u),i.typeOf.number(r,f),u!==f)throw new t(n+" must be equal to "+r+", the actual values are "+u+" and "+f);},i});t("Core/clone",["./defaultValue"],function(n){"use strict";function t(i,r){var e,u,f;if(i===null||typeof i!="object")return i;r=n(r,!1);e=new i.constructor;for(u in i)i.hasOwnProperty(u)&&(f=i[u],r&&(f=t(f,r)),e[u]=f);return e}return t});t("Core/combine",["./defaultValue","./defined"],function(n,t){"use strict";function i(r,u,f){f=n(f,!1);var o={},l=t(r),c=t(u),e,s,h;if(l)for(e in r)r.hasOwnProperty(e)&&(s=r[e],c&&f&&typeof s=="object"&&u.hasOwnProperty(e)?(h=u[e],o[e]=typeof h=="object"?i(s,h,f):s):o[e]=s);if(c)for(e in u)u.hasOwnProperty(e)&&!o.hasOwnProperty(e)&&(h=u[e],o[e]=h);return o}return i});t("Core/defineProperties",["./defined"],function(n){"use strict";var i=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(n){return!1}}(),t=Object.defineProperties;return i&&n(t)||(t=function(n){return n}),t});t("Core/oneTimeWarning",["./defaultValue","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(r,f){if(!t(r))throw new i("identifier is required.");t(u[r])||(u[r]=!0,console.warn(n(f,r)))}var u={};return r.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",r.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",r});t("Core/deprecationWarning",["./defined","./DeveloperError","./oneTimeWarning"],function(n,t,i){"use strict";function r(r,u){if(!n(r)||!n(u))throw new t("identifier and message are required.");i(r,u)}return r});t("Core/Fullscreen",["./defined","./defineProperties"],function(n,t){"use strict";var u,i={requestFullscreen:undefined,exitFullscreen:undefined,fullscreenEnabled:undefined,fullscreenElement:undefined,fullscreenchange:undefined,fullscreenerror:undefined},r={};return t(r,{element:{get:function(){return r.supportsFullscreen()?document[i.fullscreenElement]:undefined}},changeEventName:{get:function(){return r.supportsFullscreen()?i.fullscreenchange:undefined}},errorEventName:{get:function(){return r.supportsFullscreen()?i.fullscreenerror:undefined}},enabled:{get:function(){return r.supportsFullscreen()?document[i.fullscreenEnabled]:undefined}},fullscreen:{get:function(){return r.supportsFullscreen()?r.element!==null:undefined}}}),r.supportsFullscreen=function(){var f,o,t,e,s,r;if(n(u))return u;if(u=!1,f=document.body,typeof f.requestFullscreen=="function")return i.requestFullscreen="requestFullscreen",i.exitFullscreen="exitFullscreen",i.fullscreenEnabled="fullscreenEnabled",i.fullscreenElement="fullscreenElement",i.fullscreenchange="fullscreenchange",i.fullscreenerror="fullscreenerror",u=!0;for(o=["webkit","moz","o","ms","khtml"],e=0,s=o.length;e<s;++e)r=o[e],t=r+"RequestFullscreen",typeof f[t]=="function"?(i.requestFullscreen=t,u=!0):(t=r+"RequestFullScreen",typeof f[t]=="function"&&(i.requestFullscreen=t,u=!0)),t=r+"ExitFullscreen",typeof document[t]=="function"?i.exitFullscreen=t:(t=r+"CancelFullScreen",typeof document[t]=="function"&&(i.exitFullscreen=t)),t=r+"FullscreenEnabled",document[t]!==undefined?i.fullscreenEnabled=t:(t=r+"FullScreenEnabled",document[t]!==undefined&&(i.fullscreenEnabled=t)),t=r+"FullscreenElement",document[t]!==undefined?i.fullscreenElement=t:(t=r+"FullScreenElement",document[t]!==undefined&&(i.fullscreenElement=t)),t=r+"fullscreenchange",document["on"+t]!==undefined&&(r==="ms"&&(t="MSFullscreenChange"),i.fullscreenchange=t),t=r+"fullscreenerror",document["on"+t]!==undefined&&(r==="ms"&&(t="MSFullscreenError"),i.fullscreenerror=t);return u},r.requestFullscreen=function(n,t){r.supportsFullscreen()&&n[i.requestFullscreen]({vrDisplay:t})},r.exitFullscreen=function(){r.supportsFullscreen()&&document[i.exitFullscreen]()},r});t("Core/FeatureDetection",["./defaultValue","./defined","./Fullscreen"],function(n,t,i){"use strict";function u(n){for(var t=n.split("."),i=0,r=t.length;i<r;++i)t[i]=parseInt(t[i],10);return t}function p(){if(!t(s)&&(s=!1,!a())){var n=/ Chrome\/([\.0-9]+)/.exec(r.userAgent);n!==null&&(s=!0,nt=u(n[1]))}return s}function ht(){return p()&&nt}function it(){if(!t(h)&&(h=!1,!p()&&!a()&&/ Safari\/[\.0-9]+/.test(r.userAgent))){var n=/ Version\/([\.0-9]+)/.exec(r.userAgent);n!==null&&(h=!0,tt=u(n[1]))}return h}function ct(){return it()&&tt}function rt(){if(!t(c)){c=!1;var n=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(r.userAgent);n!==null&&(c=!0,w=u(n[1]),w.isNightly=!!n[2])}return c}function lt(){return rt()&&w}function ut(){if(!t(e)){e=!1;var n;r.appName==="Microsoft Internet Explorer"?(n=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(r.userAgent),n!==null&&(e=!0,b=u(n[1]))):r.appName==="Netscape"&&(n=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(r.userAgent),n!==null&&(e=!0,b=u(n[1])))}return e}function at(){return ut()&&b}function a(){if(!t(l)){l=!1;var n=/ Edge\/([\.0-9]+)/.exec(r.userAgent);n!==null&&(l=!0,ft=u(n[1]))}return l}function vt(){return a()&&ft}function k(){if(!t(v)){v=!1;var n=/Firefox\/([\.0-9]+)/.exec(r.userAgent);n!==null&&(v=!0,et=u(n[1]))}return v}function yt(){return t(d)||(d=/Windows/i.test(r.appVersion)),d}function pt(){return k()&&et}function wt(){return t(g)||(g=!k()&&typeof PointerEvent!="undefined"&&(!t(r.pointerEnabled)||r.pointerEnabled)),g}function st(){var i,n;return t(y)||(i=document.createElement("canvas"),i.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;"),n=i.style.imageRendering,y=t(n)&&n!=="",y&&(ot=n)),y}function bt(){return st()?ot:undefined}var r,s,nt,h,tt,c,w,e,b,l,ft,v,et,d,g,ot,y,o,f;return r=typeof navigator!="undefined"?navigator:{},o=[],typeof ArrayBuffer!="undefined"&&(o.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),typeof Uint8ClampedArray!="undefined"&&o.push(Uint8ClampedArray),typeof CanvasPixelArray!="undefined"&&o.push(CanvasPixelArray)),f={isChrome:p,chromeVersion:ht,isSafari:it,safariVersion:ct,isWebkit:rt,webkitVersion:lt,isInternetExplorer:ut,internetExplorerVersion:at,isEdge:a,edgeVersion:vt,isFirefox:k,firefoxVersion:pt,isWindows:yt,hardwareConcurrency:n(r.hardwareConcurrency,3),supportsPointerEvents:wt,supportsImageRenderingPixelated:st,imageRenderingValue:bt,typedArrayTypes:o},f.supportsFullscreen=function(){return i.supportsFullscreen()},f.supportsTypedArrays=function(){return typeof ArrayBuffer!="undefined"},f.supportsWebWorkers=function(){return typeof Worker!="undefined"},f.supportsWebAssembly=function(){return typeof WebAssembly!="undefined"&&!f.isEdge()},f});t("Core/getBaseUri",["../ThirdParty/Uri","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(r,u){if(!t(r))throw new i("uri is required.");var f="",e=r.lastIndexOf("/");return(e!==-1&&(f=r.substring(0,e+1)),!u)?f:(r=new n(r),t(r.query)&&(f+="?"+r.query),t(r.fragment)&&(f+="#"+r.fragment),f)}return r});t("Core/getExtensionFromUri",["../ThirdParty/Uri","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(r){var e,u,f;if(!t(r))throw new i("uri is required.");return e=new n(r),e.normalize(),u=e.path,f=u.lastIndexOf("/"),f!==-1&&(u=u.substr(f+1)),f=u.lastIndexOf("."),f===-1?"":u.substr(f+1)}return r});t("Core/isBlobUri",["./Check"],function(n){"use strict";function i(i){return n.typeOf.string("uri",i),t.test(i)}var t=/^blob:/i;return i});t("Core/isCrossOriginUrl",["./defined"],function(n){"use strict";function i(i){n(t)||(t=document.createElement("a"));t.href=window.location.href;var r=t.host,u=t.protocol;return t.href=i,t.href=t.href,u!==t.protocol||r!==t.host}var t;return i});t("Core/isDataUri",["./Check"],function(n){"use strict";function i(i){return n.typeOf.string("uri",i),t.test(i)}var t=/^data:/i;return i});t("Core/isArray",["./defined"],function(n){"use strict";var t=Array.isArray;return n(t)||(t=function(n){return Object.prototype.toString.call(n)==="[object Array]"}),t});t("Core/objectToQuery",["./defined","./DeveloperError","./isArray"],function(n,t,i){"use strict";function r(r){var f,e,u,s,o,h;if(!n(r))throw new t("obj is required.");f="";for(e in r)if(r.hasOwnProperty(e))if(u=r[e],s=encodeURIComponent(e)+"=",i(u))for(o=0,h=u.length;o<h;++o)f+=s+encodeURIComponent(u[o])+"&";else f+=s+encodeURIComponent(u)+"&";return f.slice(0,-1)}return r});t("Core/queryToObject",["./defined","./DeveloperError","./isArray"],function(n,t,i){"use strict";function r(r){var u,s,o,c,e;if(!n(r))throw new t("queryString is required.");if(u={},r==="")return u;for(s=r.replace(/\+/g,"%20").split(/[&;]/),o=0,c=s.length;o<c;++o){var l=s[o].split("="),h=decodeURIComponent(l[0]),f=l[1];f=n(f)?decodeURIComponent(f):"";e=u[h];typeof e=="string"?u[h]=[e,f]:i(e)?e.push(f):u[h]=f}return u}return r});t("Core/RequestState",["../Core/freezeObject"],function(n){"use strict";return n({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5})});t("Core/RequestType",["../Core/freezeObject"],function(n){"use strict";return n({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3})});t("Core/Request",["./defaultValue","./defined","./RequestState","./RequestType"],function(n,t,i,r){"use strict";function u(t){t=n(t,n.EMPTY_OBJECT);var u=n(t.throttleByServer,!1),f=u||n(t.throttle,!1);this.url=t.url;this.requestFunction=t.requestFunction;this.cancelFunction=t.cancelFunction;this.priorityFunction=t.priorityFunction;this.priority=n(t.priority,0);this.throttle=f;this.throttleByServer=u;this.type=n(t.type,r.OTHER);this.serverKey=undefined;this.state=i.UNISSUED;this.deferred=undefined;this.cancelled=!1}return u.prototype.cancel=function(){this.cancelled=!0},u.prototype.clone=function(n){return t(n)?(n.url=this.url,n.requestFunction=this.requestFunction,n.cancelFunction=this.cancelFunction,n.priorityFunction=this.priorityFunction,n.priority=this.priority,n.throttle=this.throttle,n.throttleByServer=this.throttleByServer,n.type=this.type,n.serverKey=this.serverKey,n.state=this.RequestState.UNISSUED,n.deferred=undefined,n.cancelled=!1,n):new u(this)},u});t("Core/parseResponseHeaders",[],function(){"use strict";function n(n){var u={},f,t,i,r,e,o;if(!n)return u;for(f=n.split("\r\n"),t=0;t<f.length;++t)i=f[t],r=i.indexOf(": "),r>0&&(e=i.substring(0,r),o=i.substring(r+2),u[e]=o);return u}return n});t("Core/RequestErrorEvent",["./defined","./parseResponseHeaders"],function(n,t){"use strict";function i(n,i,r){this.statusCode=n;this.response=i;this.responseHeaders=r;typeof this.responseHeaders=="string"&&(this.responseHeaders=t(this.responseHeaders))}return i.prototype.toString=function(){var t="Request has failed.";return n(this.statusCode)&&(t+=" Status Code: "+this.statusCode),t},i});t("Core/Event",["./Check","./defined","./defineProperties"],function(n,t,i){"use strict";function r(){this._listeners=[];this._scopes=[];this._toRemove=[];this._insideRaiseEvent=!1}function u(n,t){return t-n}return i(r.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),r.prototype.addEventListener=function(t,i){n.typeOf.func("listener",t);this._listeners.push(t);this._scopes.push(i);var r=this;return function(){r.removeEventListener(t,i)}},r.prototype.removeEventListener=function(t,i){var u;n.typeOf.func("listener",t);var f=this._listeners,e=this._scopes,r=-1;for(u=0;u<f.length;u++)if(f[u]===t&&e[u]===i){r=u;break}return r!==-1?(this._insideRaiseEvent?(this._toRemove.push(r),f[r]=undefined,e[r]=undefined):(f.splice(r,1),e.splice(r,1)),!0):!1},r.prototype.raiseEvent=function(){var s,i,e;this._insideRaiseEvent=!0;for(var r=this._listeners,o=this._scopes,f=r.length,n=0;n<f;n++)s=r[n],t(s)&&r[n].apply(o[n],arguments);if(i=this._toRemove,f=i.length,f>0){for(i.sort(u),n=0;n<f;n++)e=i[n],r.splice(e,1),o.splice(e,1);i.length=0}this._insideRaiseEvent=!1},r});t("Core/Heap",["./Check","./defaultValue","./defined","./defineProperties"],function(n,t,i,r){"use strict";function u(t){n.typeOf.object("options",t);n.defined("options.comparator",t.comparator);this._comparator=t.comparator;this._array=[];this._length=0;this._maximumLength=undefined}function f(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}return r(u.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(n){this._maximumLength=n;this._length>n&&n>0&&(this._length=n,this._array.length=n)}},comparator:{get:function(){return this._comparator}}}),u.prototype.reserve=function(n){n=t(n,this._length);this._array.length=n},u.prototype.heapify=function(n){var u,e;n=t(n,0);for(var o=this._length,s=this._comparator,r=this._array,i=-1,h=!0;h;)u=2*(n+1),e=u-1,i=e<o&&s(r[e],r[n])<0?e:n,u<o&&s(r[u],r[i])<0&&(i=u),i!==n?(f(r,i,n),n=i):h=!1},u.prototype.resort=function(){for(var t=this._length,n=Math.ceil(t/2);n>=0;--n)this.heapify(n)},u.prototype.insert=function(t){var o,s;n.defined("element",t);var r=this._array,h=this._comparator,e=this._maximumLength,u=this._length++;for(u<r.length?r[u]=t:r.push(t);u!==0;)if(o=Math.floor((u-1)/2),h(r[u],r[o])<0)f(r,u,o),u=o;else break;return i(e)&&this._length>e&&(s=r[e],this._length=e),s},u.prototype.pop=function(i){if(i=t(i,0),this._length===0)return undefined;n.typeOf.number.lessThan("index",i,this._length);var r=this._array,u=r[i];return f(r,i,--this._length),this.heapify(i),u},u});t("Core/RequestScheduler",["../ThirdParty/Uri","../ThirdParty/when","./Check","./defaultValue","./defined","./defineProperties","./Event","./Heap","./isBlobUri","./isDataUri","./RequestState"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function it(n,t){return n.priority-t.priority}function a(){}function d(n){u(n.priorityFunction)&&(n.priority=n.priorityFunction())}function g(n){var t=r(a.requestsByServer[n],a.maximumRequestsPerServer);return p[n]<t}function nt(n){return n.state===c.UNISSUED&&(n.state=c.ISSUED,n.deferred=t.defer()),n.deferred.promise}function ut(n){return function(t){n.state!==c.CANCELLED&&(--l.numberOfActiveRequests,--p[n.serverKey],k.raiseEvent(),n.state=c.RECEIVED,n.deferred.resolve(t))}}function ft(n){return function(t){n.state!==c.CANCELLED&&(++l.numberOfFailedRequests,--l.numberOfActiveRequests,--p[n.serverKey],k.raiseEvent(t),n.state=c.FAILED,n.deferred.reject(t))}}function tt(n){var t=nt(n);return n.state=c.ACTIVE,y.push(n),++l.numberOfActiveRequests,++l.numberOfActiveRequestsEver,++p[n.serverKey],n.requestFunction().then(ut(n)).otherwise(ft(n)),t}function w(n){var t=n.state===c.ACTIVE;n.state=c.CANCELLED;++l.numberOfCancelledRequests;n.deferred.reject();t&&(--l.numberOfActiveRequests,--p[n.serverKey],++l.numberOfCancelledActiveRequests);u(n.cancelFunction)&&n.cancelFunction()}function et(){l.numberOfAttemptedRequests=0;l.numberOfCancelledRequests=0;l.numberOfCancelledActiveRequests=0}function ot(){a.debugShowStatistics&&(l.numberOfAttemptedRequests>0&&console.log("Number of attempted requests: "+l.numberOfAttemptedRequests),l.numberOfActiveRequests>0&&console.log("Number of active requests: "+l.numberOfActiveRequests),l.numberOfCancelledRequests>0&&console.log("Number of cancelled requests: "+l.numberOfCancelledRequests),l.numberOfCancelledActiveRequests>0&&console.log("Number of cancelled active requests: "+l.numberOfCancelledActiveRequests),l.numberOfFailedRequests>0&&console.log("Number of failed requests: "+l.numberOfFailedRequests),et())}var l={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0},b=20,v=new o({comparator:it});v.maximumLength=b;v.reserve(b);var y=[],p={},rt=typeof document!="undefined"?new n(document.location.href):new n,k=new e;return a.maximumRequests=50,a.maximumRequestsPerServer=6,a.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},a.throttleRequests=!0,a.debugShowStatistics=!1,a.requestCompletedEvent=k,f(a,{statistics:{get:function(){return l}},priorityHeapLength:{get:function(){return b},set:function(n){if(n<b)while(v.length>n){var t=v.pop();w(t)}b=n;v.maximumLength=n;v.reserve(n)}}}),a.update=function(){for(var n,i=0,o=y.length,u,f,e,r,t=0;t<o;++t){if(n=y[t],n.cancelled&&w(n),n.state!==c.ACTIVE){++i;continue}i>0&&(y[t-i]=n)}for(y.length-=i,u=v.internalArray,f=v.length,t=0;t<f;++t)d(u[t]);for(v.resort(),e=Math.max(a.maximumRequests-y.length,0),r=0;r<e&&v.length>0;){if(n=v.pop(),n.cancelled){w(n);continue}if(n.throttleByServer&&!g(n.serverKey)){w(n);continue}tt(n);++r}ot()},a.getServerKey=function(t){var f,r,e;return i.typeOf.string("url",t),f=new n(t).resolve(rt),f.normalize(),r=f.authority,/:/.test(r)||(r=r+":"+(f.scheme==="https"?"443":"80")),e=p[r],u(e)||(p[r]=0),r},a.request=function(n){if(i.typeOf.object("request",n),i.typeOf.string("request.url",n.url),i.typeOf.func("request.requestFunction",n.requestFunction),h(n.url)||s(n.url))return k.raiseEvent(),n.state=c.RECEIVED,n.requestFunction();if(++l.numberOfAttemptedRequests,u(n.serverKey)||(n.serverKey=a.getServerKey(n.url)),!a.throttleRequests||!n.throttle)return tt(n);if(y.length>=a.maximumRequests||n.throttleByServer&&!g(n.serverKey))return undefined;d(n);var t=v.insert(n);if(u(t)){if(t===n)return undefined;w(t)}return nt(n)},a.clearForSpecs=function(){for(var t,i,n;v.length>0;)t=v.pop(),w(t);for(i=y.length,n=0;n<i;++n)w(y[n]);y.length=0;p={};l.numberOfAttemptedRequests=0;l.numberOfActiveRequests=0;l.numberOfCancelledRequests=0;l.numberOfCancelledActiveRequests=0;l.numberOfFailedRequests=0;l.numberOfActiveRequestsEver=0},a.numberOfActiveRequestsByServer=function(n){return p[n]},a.requestHeap=v,a});t("Core/RuntimeError",["./defined"],function(n){"use strict";function t(n){this.name="RuntimeError";this.message=n;var t;try{throw new Error;}catch(i){t=i.stack}this.stack=t}return n(Object.create)&&(t.prototype=Object.create(Error.prototype),t.prototype.constructor=t),t.prototype.toString=function(){var t=this.name+": "+this.message;return n(this.stack)&&(t+="\n"+this.stack.toString()),t},t});t("Core/TrustedServers",["../ThirdParty/Uri","./defined","./DeveloperError"],function(n,t,i){"use strict";function f(i){var f=new n(i),r,e,u;if(f.normalize(),r=f.getAuthority(),!t(r))return undefined;if(r.indexOf("@")!==-1&&(e=r.split("@"),r=e[1]),r.indexOf(":")===-1)if(u=f.getScheme(),t(u)||(u=window.location.protocol,u=u.substring(0,u.length-1)),u==="http")r+=":80";else if(u==="https")r+=":443";else return undefined;return r}var u={},r={};return u.add=function(n,u){if(!t(n))throw new i("host is required.");if(!t(u)||u<=0)throw new i("port is required to be greater than 0.");var f=n.toLowerCase()+":"+u;t(r[f])||(r[f]=!0)},u.remove=function(n,u){if(!t(n))throw new i("host is required.");if(!t(u)||u<=0)throw new i("port is required to be greater than 0.");var f=n.toLowerCase()+":"+u;t(r[f])&&delete r[f]},u.contains=function(n){if(!t(n))throw new i("url is required.");var u=f(n);return t(u)&&t(r[u])?!0:!1},u.clear=function(){r={}},u});t("Core/Resource",["../ThirdParty/Uri","../ThirdParty/when","./appendForwardSlash","./Check","./clone","./combine","./defaultValue","./defined","./defineProperties","./deprecationWarning","./DeveloperError","./FeatureDetection","./freezeObject","./getAbsoluteUri","./getBaseUri","./getExtensionFromUri","./isBlobUri","./isCrossOriginUrl","./isDataUri","./objectToQuery","./queryToObject","./Request","./RequestErrorEvent","./RequestScheduler","./RequestState","./RuntimeError","./TrustedServers"],function(n,t,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et){"use strict";function lt(n,t,i,r){var u=n.query,f,e;if(!s(u)||u.length===0)return{};u.indexOf("=")===-1?(e={},e[u]=undefined,f=e):f=nt(u);t._queryParameters=i?ht(f,t._queryParameters,r):f;n.query=undefined}function gt(n,t){var i=t._queryParameters,r=Object.keys(i);n.query=r.length!==1||s(i[r[0]])?g(i):r[0]}function st(n,t){return s(n)?s(n.clone)?n.clone():f(n):t}function at(n){if(n.state===ut.ISSUED||n.state===ut.ACTIVE)throw new ft("The Resource is already being fetched.");n.state=ut.UNISSUED;n.deferred=undefined}function ht(n,t,i){var u,r,o,h;if(!i)return e(n,t);u=f(n,!0);for(r in t)t.hasOwnProperty(r)&&(o=u[r],h=t[r],s(o)?(Array.isArray(o)||(o=u[r]=[o]),u[r]=o.concat(h)):u[r]=Array.isArray(h)?h.slice():h);return u}function ot(t){t=o(t,o.EMPTY_OBJECT);typeof t=="string"&&(t={url:t});u.typeOf.string("options.url",t.url);this._url=undefined;this._templateValues=st(t.templateValues,{});this._queryParameters=st(t.queryParameters,{});this.headers=st(t.headers,{});this.request=o(t.request,new tt);this.proxy=t.proxy;this.retryCallback=t.retryCallback;this.retryAttempts=o(t.retryAttempts,0);this._retryCount=0;var i=new n(t.url);lt(i,this,!0,!0);i.fragment=undefined;this._url=i.toString()}function vt(n){var i=n.request,r;if(i.url=n.url,i.requestFunction=function(){var u=n.url,r=!1,i;return n.isDataUri||n.isBlobUri||(r=n.isCrossOriginUrl),i=t.defer(),ot._Implementations.createImage(u,r,i),i.promise},r=rt.request(i),s(r))return r.otherwise(function(r){return i.state!==ut.FAILED?t.reject(r):n.retryOnError(r).then(function(u){return u?(i.state=ut.UNISSUED,i.deferred=undefined,vt(n)):t.reject(r)})})}function pt(n,i,r){var e={},u,f;if(e[i]=r,n.setQueryParameters(e),u=n.request,u.url=n.url,u.requestFunction=function(){var i=t.defer();return window[r]=function(n){i.resolve(n);try{delete window[r]}catch(t){window[r]=undefined}},ot._Implementations.loadAndExecuteScript(n.url,r,i),i.promise},f=rt.request(u),s(f))return f.otherwise(function(f){return u.state!==ut.FAILED?t.reject(f):n.retryOnError(f).then(function(e){return e?(u.state=ut.UNISSUED,u.deferred=undefined,pt(n,i,r)):t.reject(f)})})}function ct(n,t){var i=decodeURIComponent(t);return n?atob(i):i}function bt(n,t){for(var r=ct(n,t),u=new ArrayBuffer(r.length),f=new Uint8Array(u),i=0;i<r.length;i++)f[i]=r.charCodeAt(i);return u}function ni(n,t){var f,e;t=o(t,"");var u=n[1],i=!!n[2],r=n[3];switch(t){case"":case"text":return ct(i,r);case"arraybuffer":return bt(i,r);case"blob":return f=bt(i,r),new Blob([f],{type:u});case"document":return e=new DOMParser,e.parseFromString(ct(i,r),u);case"json":return JSON.parse(ct(i,r));default:throw new l("Unhandled responseType: "+t);}}function kt(n,t){switch(t){case"text":return n.toString("utf8");case"json":return JSON.parse(n.toString("utf8"));default:return new Uint8Array(n).buffer}}function ti(n,t,r,u,f,e){var o=i("url").parse(n),s=o.protocol==="https:"?i("https"):i("http"),h=i("zlib"),c={protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.path,query:o.query,method:r,headers:f};s.request(c).on("response",function(n){if(n.statusCode<200||n.statusCode>=300){e.reject(new it(n.statusCode,n,n.headers));return}var i=[];n.on("data",function(n){i.push(n)});n.on("end",function(){var r=Buffer.concat(i);n.headers["content-encoding"]==="gzip"?h.gunzip(r,function(n,i){n?e.reject(new ft("Error decompressing response.")):e.resolve(kt(i,t))}):e.resolve(kt(r,t))})}).on("error",function(){e.reject(new it)}).end()}var yt=function(){try{var n=new XMLHttpRequest;return n.open("GET","#",!0),n.responseType="blob",n.responseType==="blob"}catch(t){return!1}}(),wt,dt;return ot.createIfNeeded=function(n){return n instanceof ot?n.getDerivedResource({request:n.request}):typeof n!="string"?n:new ot({url:n})},h(ot,{isBlobSupported:{get:function(){return yt}}}),h(ot.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(t){var i=new n(t);lt(i,this,!1);i.fragment=undefined;this._url=i.toString()}},extension:{get:function(){return w(this._url)}},isDataUri:{get:function(){return d(this._url)}},isBlobUri:{get:function(){return b(this._url)}},isCrossOriginUrl:{get:function(){return k(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}}}),ot.prototype.getUrlComponent=function(t,i){var f,u,o,c;if(this.isDataUri)return this._url;f=new n(this._url);t&&gt(f,this);var r=f.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),h=this._templateValues,e=Object.keys(h);if(e.length>0)for(u=0;u<e.length;u++)o=e[u],c=h[o],r=r.replace(new RegExp("{"+o+"}","g"),encodeURIComponent(c));return i&&s(this.proxy)&&(r=this.proxy.getURL(r)),r},ot.prototype.setQueryParameters=function(n,t){this._queryParameters=t?ht(this._queryParameters,n,!1):ht(n,this._queryParameters,!1)},ot.prototype.addQueryParameters=function(n,t){return c("Resource.addQueryParameters","addQueryParameters has been deprecated and will be removed 1.45. Use setQueryParameters or appendQueryParameters instead."),this.setQueryParameters(n,t)},ot.prototype.appendQueryParameters=function(n){this._queryParameters=ht(n,this._queryParameters,!0)},ot.prototype.setTemplateValues=function(n,t){this._templateValues=t?e(this._templateValues,n):e(n,this._templateValues)},ot.prototype.addTemplateValues=function(n,t){return c("Resource.addTemplateValues","addTemplateValues has been deprecated and will be removed 1.45. Use setTemplateValues."),this.setTemplateValues(n,t)},ot.prototype.getDerivedResource=function(t){var i=this.clone(),r,u;return i._retryCount=0,s(t.url)&&(r=new n(t.url),u=o(t.preserveQueryParameters,!1),lt(r,i,!0,u),r.fragment=undefined,i._url=r.resolve(new n(y(this._url))).toString()),s(t.queryParameters)&&(i._queryParameters=e(t.queryParameters,i._queryParameters)),s(t.templateValues)&&(i._templateValues=e(t.templateValues,i.templateValues)),s(t.headers)&&(i.headers=e(t.headers,i.headers)),s(t.proxy)&&(i.proxy=t.proxy),s(t.request)&&(i.request=t.request),s(t.retryCallback)&&(i.retryCallback=t.retryCallback),s(t.retryAttempts)&&(i.retryAttempts=t.retryAttempts),i},ot.prototype.retryOnError=function(n){var i=this.retryCallback,r;return typeof i!="function"||this._retryCount>=this.retryAttempts?t(!1):(r=this,t(i(this,n)).then(function(n){return++r._retryCount,n}))},ot.prototype.clone=function(n){return s(n)||(n=new ot({url:this._url})),n._url=this._url,n._queryParameters=f(this._queryParameters),n._templateValues=f(this._templateValues),n.headers=f(this.headers),n.proxy=this.proxy,n.retryCallback=this.retryCallback,n.retryAttempts=this.retryAttempts,n._retryCount=0,n.request=this.request.clone(),n},ot.prototype.getBaseUri=function(n){return p(this.getUrlComponent(n),n)},ot.prototype.appendForwardSlash=function(){this._url=r(this._url)},ot.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},ot.fetchArrayBuffer=function(n){var t=new ot(n);return t.fetchArrayBuffer()},ot.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},ot.fetchBlob=function(n){var t=new ot(n);return t.fetchBlob()},ot.prototype.fetchImage=function(n){var r,i,u;return(n=o(n,!1),at(this.request),!yt||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!n)?vt(this,!0):(r=this.fetchBlob(),!s(r))?void 0:r.then(function(n){if(s(n)){u=n;var t=window.URL.createObjectURL(n);return i=new ot({url:t}),vt(i)}}).then(function(n){if(s(n))return window.URL.revokeObjectURL(i.url),n.blob=u,n}).otherwise(function(n){return s(i)&&window.URL.revokeObjectURL(i.url),t.reject(n)})},ot.fetchImage=function(n){var t=new ot(n);return t.fetchImage(n.preferBlob)},ot.prototype.fetchText=function(){return this.fetch({responseType:"text"})},ot.fetchText=function(n){var t=new ot(n);return t.fetchText()},ot.prototype.fetchJson=function(){var n=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});return s(n)?n.then(function(n){if(s(n))return JSON.parse(n)}):undefined},ot.fetchJson=function(n){var t=new ot(n);return t.fetchJson()},ot.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},ot.fetchXML=function(n){var t=new ot(n);return t.fetchXML()},ot.prototype.fetchJsonp=function(n){n=o(n,"callback");at(this.request);var t;do t="loadJsonp"+Math.random().toString().substring(2,8);while(s(window[t]));return pt(this,n,t)},ot.fetchJsonp=function(n){var t=new ot(n);return t.fetchJsonp(n.callbackParameterName)},ot.prototype._makeRequest=function(n){var r=this,i,u;if(at(r.request),i=r.request,i.url=r.url,i.requestFunction=function(){var o=n.responseType,h=e(n.headers,r.headers),c=n.overrideMimeType,l=n.method,a=n.data,f=t.defer(),u=ot._Implementations.loadWithXhr(r.url,o,l,a,h,f,c);return s(u)&&s(u.abort)&&(i.cancelFunction=function(){u.abort()}),f.promise},u=rt.request(i),s(u))return u.then(function(n){return n}).otherwise(function(u){return i.state!==ut.FAILED?t.reject(u):r.retryOnError(u).then(function(f){return f?(i.state=ut.UNISSUED,i.deferred=undefined,r.fetch(n)):t.reject(u)})})},wt=/^data:(.*?)(;base64)?,(.*)$/,ot.prototype.fetch=function(n){return n=st(n,{}),n.method="GET",this._makeRequest(n)},ot.fetch=function(n){var t=new ot(n);return t.fetch({responseType:n.responseType,overrideMimeType:n.overrideMimeType})},ot.prototype.delete=function(n){return n=st(n,{}),n.method="DELETE",this._makeRequest(n)},ot.delete=function(n){var t=new ot(n);return t.delete({responseType:n.responseType,overrideMimeType:n.overrideMimeType,data:n.data})},ot.prototype.head=function(n){return n=st(n,{}),n.method="HEAD",this._makeRequest(n)},ot.head=function(n){var t=new ot(n);return t.head({responseType:n.responseType,overrideMimeType:n.overrideMimeType})},ot.prototype.options=function(n){return n=st(n,{}),n.method="OPTIONS",this._makeRequest(n)},ot.options=function(n){var t=new ot(n);return t.options({responseType:n.responseType,overrideMimeType:n.overrideMimeType})},ot.prototype.post=function(n,t){return u.defined("data",n),t=st(t,{}),t.method="POST",t.data=n,this._makeRequest(t)},ot.post=function(n){var t=new ot(n);return t.post(n.data,{responseType:n.responseType,overrideMimeType:n.overrideMimeType})},ot.prototype.put=function(n,t){return u.defined("data",n),t=st(t,{}),t.method="PUT",t.data=n,this._makeRequest(t)},ot.put=function(n){var t=new ot(n);return t.put(n.data,{responseType:n.responseType,overrideMimeType:n.overrideMimeType})},ot.prototype.patch=function(n,t){return u.defined("data",n),t=st(t,{}),t.method="PATCH",t.data=n,this._makeRequest(t)},ot.patch=function(n){var t=new ot(n);return t.patch(n.data,{responseType:n.responseType,overrideMimeType:n.overrideMimeType})},ot._Implementations={},ot._Implementations.createImage=function(n,t,i){var r=new Image;r.onload=function(){i.resolve(r)};r.onerror=function(n){i.reject(n)};t&&(r.crossOrigin=et.contains(n)?"use-credentials":"");r.src=n},dt=typeof XMLHttpRequest=="undefined",ot._Implementations.loadWithXhr=function(n,t,i,r,u,f,e){var l=wt.exec(n),o,h,c;if(l!==null){f.resolve(ni(l,t));return}if(dt){ti(n,t,i,r,u,f,e);return}if(o=new XMLHttpRequest,et.contains(n)&&(o.withCredentials=!0),o.open(i,n,!0),s(e)&&s(o.overrideMimeType)&&o.overrideMimeType(e),s(u))for(h in u)u.hasOwnProperty(h)&&o.setRequestHeader(h,u[h]);return s(t)&&(o.responseType=t),c=!1,typeof n=="string"&&(c=n.indexOf("file://")===0||typeof window!="undefined"&&window.location.origin==="file://"),o.onload=function(){var r,n;if((o.status<200||o.status>=300)&&!(c&&o.status===0)){f.reject(new it(o.status,o.response,o.getAllResponseHeaders()));return}if(r=o.response,n=o.responseType,i==="HEAD"||i==="OPTIONS"){var e=o.getAllResponseHeaders(),h=e.trim().split(/[\r\n]+/),u={};h.forEach(function(n){var t=n.split(": "),i=t.shift();u[i]=t.join(": ")});f.resolve(u);return}if(o.status===204)f.resolve();else if(s(r)&&(!s(t)||n===t))f.resolve(r);else if(t==="json"&&typeof r=="string")try{f.resolve(JSON.parse(r))}catch(l){f.reject(l)}else(n===""||n==="document")&&s(o.responseXML)&&o.responseXML.hasChildNodes()?f.resolve(o.responseXML):(n===""||n==="text")&&s(o.responseText)?f.resolve(o.responseText):f.reject(new ft("Invalid XMLHttpRequest response type."))},o.onerror=function(){f.reject(new it)},o.send(r),o},ot._Implementations.loadAndExecuteScript=function(n,t,i){var r=document.createElement("script"),u;r.async=!0;r.src=n;u=document.getElementsByTagName("head")[0];r.onload=function(){r.onload=undefined;u.removeChild(r)};r.onerror=function(n){i.reject(n)};u.appendChild(r)},ot._DefaultImplementations={},ot._DefaultImplementations.createImage=ot._Implementations.createImage,ot._DefaultImplementations.loadWithXhr=ot._Implementations.loadWithXhr,ot._DefaultImplementations.loadAndExecuteScript=ot._Implementations.loadAndExecuteScript,ot.DEFAULT=v(new ot({url:typeof document=="undefined"?"":document.location.href.split("?")[0]})),ot});t("Core/buildModuleUrl",["./defined","./DeveloperError","./getAbsoluteUri","./Resource","require"],function(n,i,r,u,f){"use strict";function y(){for(var r,t,i=document.getElementsByTagName("script"),n=0,u=i.length;n<u;++n)if(r=i[n].getAttribute("src"),t=c.exec(r),t!==null)return t[1];return undefined}function l(t){return typeof document=="undefined"?t:(n(s)||(s=document.createElement("a")),s.href=t,s.href=s.href,s.href)}function a(){if(n(e))return e;var s;if(s=typeof CESIUM_BASE_URL!="undefined"?CESIUM_BASE_URL:n(t.amd)&&!t.amd.toUrlUndefined&&n(f.toUrl)?r("..",o("Core/buildModuleUrl.js")):y(),!n(s))throw new i("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.");return e=new u({url:l(s)}),e.appendForwardSlash(),e}function p(n){return l(f.toUrl("../"+n))}function v(n){var t=a().getDerivedResource({url:n});return t.url}function o(i){n(h)||(h=n(t.amd)&&!t.amd.toUrlUndefined&&n(f.toUrl)?p:v);return h(i)}var c=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i,s,e,h;return o._cesiumScriptRegex=c,o._buildModuleUrlFromBaseUrl=v,o._clearBaseResource=function(){e=undefined},o.setBaseUrl=function(n){e=u.DEFAULT.getDerivedResource({url:n})},o.getCesiumBaseUrl=a,o});t("ThirdParty/mersenne-twister",[],function(){var n=function(n){n==undefined&&(n=(new Date).getTime());this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=new Array(this.N);this.mti=this.N+1;this.init_genrand(n)};return n.prototype.init_genrand=function(n){for(this.mt[0]=n>>>0,this.mti=1;this.mti<this.N;this.mti++){var n=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((n&4294901760)>>>16)*1812433253<<16)+(n&65535)*1812433253+this.mti;this.mt[this.mti]>>>=0}},n.prototype.genrand_int32=function(){var n,i=[0,this.MATRIX_A],t;if(this.mti>=this.N){for(this.mti==this.N+1&&this.init_genrand(5489),t=0;t<this.N-this.M;t++)n=this.mt[t]&this.UPPER_MASK|this.mt[t+1]&this.LOWER_MASK,this.mt[t]=this.mt[t+this.M]^n>>>1^i[n&1];for(;t<this.N-1;t++)n=this.mt[t]&this.UPPER_MASK|this.mt[t+1]&this.LOWER_MASK,this.mt[t]=this.mt[t+(this.M-this.N)]^n>>>1^i[n&1];n=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-1]^n>>>1^i[n&1];this.mti=0}return n=this.mt[this.mti++],n^=n>>>11,n^=n<<7&2636928640,n^=n<<15&4022730752,n^=n>>>18,n>>>0},n.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},n});t("Core/Math",["../ThirdParty/mersenne-twister","./Check","./defaultValue","./defined","./DeveloperError"],function(n,t,i,r,u){"use strict";var f={},e,o;return f.EPSILON1=.1,f.EPSILON2=.01,f.EPSILON3=.001,f.EPSILON4=.0001,f.EPSILON5=1e-5,f.EPSILON6=1e-6,f.EPSILON7=1e-7,f.EPSILON8=1e-8,f.EPSILON9=1e-9,f.EPSILON10=1e-10,f.EPSILON11=1e-11,f.EPSILON12=1e-12,f.EPSILON13=1e-13,f.EPSILON14=1e-14,f.EPSILON15=1e-15,f.EPSILON16=1e-16,f.EPSILON17=1e-17,f.EPSILON18=1e-18,f.EPSILON19=1e-19,f.EPSILON20=1e-20,f.EPSILON21=1e-21,f.GRAVITATIONALPARAMETER=3986004418e5,f.SOLAR_RADIUS=6955e5,f.LUNAR_RADIUS=1737400,f.SIXTY_FOUR_KILOBYTES=65536,f.sign=i(Math.sign,function(n){return(n=+n,n===0||n!==n)?n:n>0?1:-1}),f.signNotZero=function(n){return n<0?-1:1},f.toSNorm=function(n,t){return t=i(t,255),Math.round((f.clamp(n,-1,1)*.5+.5)*t)},f.fromSNorm=function(n,t){return t=i(t,255),f.clamp(n,0,t)/t*2-1},f.sinh=i(Math.sinh,function(n){return(Math.exp(n)-Math.exp(-n))/2}),f.cosh=i(Math.cosh,function(n){return(Math.exp(n)+Math.exp(-n))/2}),f.lerp=function(n,t,i){return(1-i)*n+i*t},f.PI=Math.PI,f.ONE_OVER_PI=1/Math.PI,f.PI_OVER_TWO=Math.PI/2,f.PI_OVER_THREE=Math.PI/3,f.PI_OVER_FOUR=Math.PI/4,f.PI_OVER_SIX=Math.PI/6,f.THREE_PI_OVER_TWO=3*Math.PI/2,f.TWO_PI=2*Math.PI,f.ONE_OVER_TWO_PI=1/(2*Math.PI),f.RADIANS_PER_DEGREE=Math.PI/180,f.DEGREES_PER_RADIAN=180/Math.PI,f.RADIANS_PER_ARCSECOND=f.RADIANS_PER_DEGREE/3600,f.toRadians=function(n){if(!r(n))throw new u("degrees is required.");return n*f.RADIANS_PER_DEGREE},f.toDegrees=function(n){if(!r(n))throw new u("radians is required.");return n*f.DEGREES_PER_RADIAN},f.convertLongitudeRange=function(n){if(!r(n))throw new u("angle is required.");var i=f.TWO_PI,t=n-Math.floor(n/i)*i;return t<-Math.PI?t+i:t>=Math.PI?t-i:t},f.clampToLatitudeRange=function(n){if(!r(n))throw new u("angle is required.");return f.clamp(n,-1*f.PI_OVER_TWO,f.PI_OVER_TWO)},f.negativePiToPi=function(n){if(!r(n))throw new u("angle is required.");return f.zeroToTwoPi(n+f.PI)-f.PI},f.zeroToTwoPi=function(n){if(!r(n))throw new u("angle is required.");var t=f.mod(n,f.TWO_PI);return Math.abs(t)<f.EPSILON14&&Math.abs(n)>f.EPSILON14?f.TWO_PI:t},f.mod=function(n,t){if(!r(n))throw new u("m is required.");if(!r(t))throw new u("n is required.");return(n%t+t)%t},f.equalsEpsilon=function(n,t,f,e){if(!r(n))throw new u("left is required.");if(!r(t))throw new u("right is required.");if(!r(f))throw new u("relativeEpsilon is required.");e=i(e,f);var o=Math.abs(n-t);return o<=e||o<=f*Math.max(Math.abs(n),Math.abs(t))},e=[1],f.factorial=function(n){var t,r,i;if(typeof n!="number"||n<0)throw new u("A number greater than or equal to 0 is required.");if(t=e.length,n>=t)for(r=e[t-1],i=t;i<=n;i++)e.push(r*i);return e[n]},f.incrementWrap=function(n,t,f){if(f=i(f,0),!r(n))throw new u("n is required.");if(t<=f)throw new u("maximumValue must be greater than minimumValue.");return++n,n>t&&(n=f),n},f.isPowerOfTwo=function(n){if(typeof n!="number"||n<0)throw new u("A number greater than or equal to 0 is required.");return n!==0&&(n&n-1)==0},f.nextPowerOfTwo=function(n){if(typeof n!="number"||n<0)throw new u("A number greater than or equal to 0 is required.");return--n,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,++n,n},f.clamp=function(n,t,i){if(!r(n))throw new u("value is required");if(!r(t))throw new u("min is required.");if(!r(i))throw new u("max is required.");return n<t?t:n>i?i:n},o=new n,f.setRandomNumberSeed=function(t){if(!r(t))throw new u("seed is required.");o=new n(t)},f.nextRandomNumber=function(){return o.random()},f.randomBetween=function(n,t){return f.nextRandomNumber()*(t-n)+n},f.acosClamped=function(n){if(!r(n))throw new u("value is required.");return Math.acos(f.clamp(n,-1,1))},f.asinClamped=function(n){if(!r(n))throw new u("value is required.");return Math.asin(f.clamp(n,-1,1))},f.chordLength=function(n,t){if(!r(n))throw new u("angle is required.");if(!r(t))throw new u("radius is required.");return 2*t*Math.sin(n*.5)},f.logBase=function(n,t){if(!r(n))throw new u("number is required.");if(!r(t))throw new u("base is required.");return Math.log(n)/Math.log(t)},f.cbrt=i(Math.cbrt,function(n){var t=Math.pow(Math.abs(n),1/3);return n<0?-t:t}),f.log2=i(Math.log2,function(n){return Math.log(n)*Math.LOG2E}),f.fog=function(n,t){var i=n*t;return 1-Math.exp(-(i*i))},f.fastApproximateAtan=function(n){return t.typeOf.number("x",n),n*(-.1784*Math.abs(n)-.0663*n*n+1.0301)},f.fastApproximateAtan2=function(n,i){var e,s,r,o;if(t.typeOf.number("x",n),t.typeOf.number("y",i),r=Math.abs(n),e=Math.abs(i),s=Math.max(r,e),e=Math.min(r,e),o=e/s,isNaN(o))throw new u("either x or y must be nonzero");return r=f.fastApproximateAtan(o),r=Math.abs(i)>Math.abs(n)?f.PI_OVER_TWO-r:r,r=n<0?f.PI-r:r,i<0?-r:r},f});t("Core/Cartesian3",["./Check","./defaultValue","./defined","./DeveloperError","./freezeObject","./Math"],function(n,t,i,r,u,f){"use strict";function e(n,i,r){this.x=t(n,0);this.y=t(i,0);this.z=t(r,0)}var h,a,c,l,v;e.fromSpherical=function(r,u){n.typeOf.object("spherical",r);i(u)||(u=new e);var f=r.clock,o=r.cone,s=t(r.magnitude,1),h=s*Math.sin(o);return u.x=h*Math.cos(f),u.y=h*Math.sin(f),u.z=s*Math.cos(o),u};e.fromElements=function(n,t,r,u){return i(u)?(u.x=n,u.y=t,u.z=r,u):new e(n,t,r)};e.clone=function(n,t){return i(n)?i(t)?(t.x=n.x,t.y=n.y,t.z=n.z,t):new e(n.x,n.y,n.z):undefined};e.fromCartesian4=e.clone;e.packedLength=3;e.pack=function(i,r,u){return n.typeOf.object("value",i),n.defined("array",r),u=t(u,0),r[u++]=i.x,r[u++]=i.y,r[u]=i.z,r};e.unpack=function(r,u,f){return n.defined("array",r),u=t(u,0),i(f)||(f=new e),f.x=r[u++],f.y=r[u++],f.z=r[u],f};e.packArray=function(t,r){var f,u;for(n.defined("array",t),f=t.length,i(r)?r.length=f*3:r=new Array(f*3),u=0;u<f;++u)e.pack(t[u],r,u*3);return r};e.unpackArray=function(t,u){var o,f,s;if(n.defined("array",t),n.typeOf.number.greaterThanOrEquals("array.length",t.length,3),t.length%3!=0)throw new r("array length must be a multiple of 3.");for(o=t.length,i(u)?u.length=o/3:u=new Array(o/3),f=0;f<o;f+=3)s=f/3,u[s]=e.unpack(t,f,u[s]);return u};e.fromArray=e.unpack;e.maximumComponent=function(t){return n.typeOf.object("cartesian",t),Math.max(t.x,t.y,t.z)};e.minimumComponent=function(t){return n.typeOf.object("cartesian",t),Math.min(t.x,t.y,t.z)};e.minimumByComponent=function(t,i,r){return n.typeOf.object("first",t),n.typeOf.object("second",i),n.typeOf.object("result",r),r.x=Math.min(t.x,i.x),r.y=Math.min(t.y,i.y),r.z=Math.min(t.z,i.z),r};e.maximumByComponent=function(t,i,r){return n.typeOf.object("first",t),n.typeOf.object("second",i),n.typeOf.object("result",r),r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r.z=Math.max(t.z,i.z),r};e.magnitudeSquared=function(t){return n.typeOf.object("cartesian",t),t.x*t.x+t.y*t.y+t.z*t.z};e.magnitude=function(n){return Math.sqrt(e.magnitudeSquared(n))};h=new e;e.distance=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.subtract(t,i,h),e.magnitude(h)};e.distanceSquared=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.subtract(t,i,h),e.magnitudeSquared(h)};e.normalize=function(t,i){n.typeOf.object("cartesian",t);n.typeOf.object("result",i);var u=e.magnitude(t);if(i.x=t.x/u,i.y=t.y/u,i.z=t.z/u,isNaN(i.x)||isNaN(i.y)||isNaN(i.z))throw new r("normalized result is not a number");return i};e.dot=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),t.x*i.x+t.y*i.y+t.z*i.z};e.multiplyComponents=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x*i.x,r.y=t.y*i.y,r.z=t.z*i.z,r};e.divideComponents=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x/i.x,r.y=t.y/i.y,r.z=t.z/i.z,r};e.add=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x+i.x,r.y=t.y+i.y,r.z=t.z+i.z,r};e.subtract=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x-i.x,r.y=t.y-i.y,r.z=t.z-i.z,r};e.multiplyByScalar=function(t,i,r){return n.typeOf.object("cartesian",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.x=t.x*i,r.y=t.y*i,r.z=t.z*i,r};e.divideByScalar=function(t,i,r){return n.typeOf.object("cartesian",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.x=t.x/i,r.y=t.y/i,r.z=t.z/i,r};e.negate=function(t,i){return n.typeOf.object("cartesian",t),n.typeOf.object("result",i),i.x=-t.x,i.y=-t.y,i.z=-t.z,i};e.abs=function(t,i){return n.typeOf.object("cartesian",t),n.typeOf.object("result",i),i.x=Math.abs(t.x),i.y=Math.abs(t.y),i.z=Math.abs(t.z),i};a=new e;e.lerp=function(t,i,r,u){return n.typeOf.object("start",t),n.typeOf.object("end",i),n.typeOf.number("t",r),n.typeOf.object("result",u),e.multiplyByScalar(i,r,a),u=e.multiplyByScalar(t,1-r,u),e.add(a,u,u)};c=new e;l=new e;e.angleBetween=function(t,i){n.typeOf.object("left",t);n.typeOf.object("right",i);e.normalize(t,c);e.normalize(i,l);var r=e.dot(c,l),u=e.magnitude(e.cross(c,l,c));return Math.atan2(u,r)};v=new e;e.mostOrthogonalAxis=function(t,i){n.typeOf.object("cartesian",t);n.typeOf.object("result",i);var r=e.normalize(t,v);return e.abs(r,r),r.x<=r.y?r.x<=r.z?e.clone(e.UNIT_X,i):e.clone(e.UNIT_Z,i):r.y<=r.z?e.clone(e.UNIT_Y,i):e.clone(e.UNIT_Z,i)};e.projectVector=function(t,i,r){n.defined("a",t);n.defined("b",i);n.defined("result",r);var u=e.dot(t,i)/e.dot(i,i);return e.multiplyByScalar(i,u,r)};e.equals=function(n,t){return n===t||i(n)&&i(t)&&n.x===t.x&&n.y===t.y&&n.z===t.z};e.equalsArray=function(n,t,i){return n.x===t[i]&&n.y===t[i+1]&&n.z===t[i+2]};e.equalsEpsilon=function(n,t,r,u){return n===t||i(n)&&i(t)&&f.equalsEpsilon(n.x,t.x,r,u)&&f.equalsEpsilon(n.y,t.y,r,u)&&f.equalsEpsilon(n.z,t.z,r,u)};e.cross=function(t,i,r){n.typeOf.object("left",t);n.typeOf.object("right",i);n.typeOf.object("result",r);var u=t.x,f=t.y,e=t.z,o=i.x,s=i.y,h=i.z,c=f*h-e*s,l=e*o-u*h,a=u*s-f*o;return r.x=c,r.y=l,r.z=a,r};e.midpoint=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=(t.x+i.x)*.5,r.y=(t.y+i.y)*.5,r.z=(t.z+i.z)*.5,r};e.fromDegrees=function(t,i,r,u,o){return n.typeOf.number("longitude",t),n.typeOf.number("latitude",i),t=f.toRadians(t),i=f.toRadians(i),e.fromRadians(t,i,r,u,o)};var o=new e,s=new e,y=new e(40680631590769,40680631590769,6356752.3142451793*6356752.3142451793);return e.fromRadians=function(r,u,f,h,c){var a,l,v;return n.typeOf.number("longitude",r),n.typeOf.number("latitude",u),f=t(f,0),a=i(h)?h.radiiSquared:y,l=Math.cos(u),o.x=l*Math.cos(r),o.y=l*Math.sin(r),o.z=Math.sin(u),o=e.normalize(o,o),e.multiplyComponents(a,o,s),v=Math.sqrt(e.dot(o,s)),s=e.divideByScalar(s,v,s),o=e.multiplyByScalar(o,f,o),i(c)||(c=new e),e.add(s,o,c)},e.fromDegreesArray=function(t,u,f){var s,o;if(n.defined("coordinates",t),t.length<2||t.length%2!=0)throw new r("the number of coordinates must be a multiple of 2 and at least 2");for(s=t.length,i(f)?f.length=s/2:f=new Array(s/2),o=0;o<s;o+=2){var c=t[o],l=t[o+1],h=o/2;f[h]=e.fromDegrees(c,l,0,u,f[h])}return f},e.fromRadiansArray=function(t,u,f){var s,o;if(n.defined("coordinates",t),t.length<2||t.length%2!=0)throw new r("the number of coordinates must be a multiple of 2 and at least 2");for(s=t.length,i(f)?f.length=s/2:f=new Array(s/2),o=0;o<s;o+=2){var c=t[o],l=t[o+1],h=o/2;f[h]=e.fromRadians(c,l,0,u,f[h])}return f},e.fromDegreesArrayHeights=function(t,u,f){var s,o;if(n.defined("coordinates",t),t.length<3||t.length%3!=0)throw new r("the number of coordinates must be a multiple of 3 and at least 3");for(s=t.length,i(f)?f.length=s/3:f=new Array(s/3),o=0;o<s;o+=3){var c=t[o],l=t[o+1],a=t[o+2],h=o/3;f[h]=e.fromDegrees(c,l,a,u,f[h])}return f},e.fromRadiansArrayHeights=function(t,u,f){var s,o;if(n.defined("coordinates",t),t.length<3||t.length%3!=0)throw new r("the number of coordinates must be a multiple of 3 and at least 3");for(s=t.length,i(f)?f.length=s/3:f=new Array(s/3),o=0;o<s;o+=3){var c=t[o],l=t[o+1],a=t[o+2],h=o/3;f[h]=e.fromRadians(c,l,a,u,f[h])}return f},e.ZERO=u(new e(0,0,0)),e.UNIT_X=u(new e(1,0,0)),e.UNIT_Y=u(new e(0,1,0)),e.UNIT_Z=u(new e(0,0,1)),e.prototype.clone=function(n){return e.clone(this,n)},e.prototype.equals=function(n){return e.equals(this,n)},e.prototype.equalsEpsilon=function(n,t,i){return e.equalsEpsilon(this,n,t,i)},e.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},e});t("Core/scaleToGeodeticSurface",["./Cartesian3","./defined","./DeveloperError","./Math"],function(n,t,i,r){"use strict";function e(e,o,s,h,c){var y,et,ot,pt,l,a,v,st,ht,ct,wt,bt,kt,dt;if(!t(e))throw new i("cartesian is required.");if(!t(o))throw new i("oneOverRadii is required.");if(!t(s))throw new i("oneOverRadiiSquared is required.");if(!t(h))throw new i("centerToleranceSquared is required.");var p=e.x,w=e.y,b=e.z,lt=o.x,at=o.y,vt=o.z,g=p*p*lt*lt,nt=w*w*at*at,tt=b*b*vt*vt,yt=g+nt+tt,it=Math.sqrt(1/yt),k=n.multiplyByScalar(e,it,u);if(yt<h)return isFinite(it)?n.clone(k,c):undefined;var rt=s.x,ut=s.y,ft=s.z,d=f;d.x=k.x*rt*2;d.y=k.y*ut*2;d.z=k.z*ft*2;y=(1-it)*n.magnitude(e)/(.5*n.magnitude(d));et=0;do y-=et,l=1/(1+y*rt),a=1/(1+y*ut),v=1/(1+y*ft),st=l*l,ht=a*a,ct=v*v,wt=st*l,bt=ht*a,kt=ct*v,ot=g*st+nt*ht+tt*ct-1,pt=g*wt*rt+nt*bt*ut+tt*kt*ft,dt=-2*pt,et=ot/dt;while(Math.abs(ot)>r.EPSILON12);return t(c)?(c.x=p*l,c.y=w*a,c.z=b*v,c):new n(p*l,w*a,b*v)}var u=new n,f=new n;return e});t("Core/Cartographic",["./Cartesian3","./Check","./defaultValue","./defined","./freezeObject","./Math","./scaleToGeodeticSurface"],function(n,t,i,r,u,f,e){"use strict";function o(n,t,r){this.longitude=i(n,0);this.latitude=i(t,0);this.height=i(r,0)}o.fromRadians=function(n,u,f,e){return(t.typeOf.number("longitude",n),t.typeOf.number("latitude",u),f=i(f,0),!r(e))?new o(n,u,f):(e.longitude=n,e.latitude=u,e.height=f,e)};o.fromDegrees=function(n,i,r,u){return t.typeOf.number("longitude",n),t.typeOf.number("latitude",i),n=f.toRadians(n),i=f.toRadians(i),o.fromRadians(n,i,r,u)};var s=new n,h=new n,c=new n,l=new n(1/6378137,1/6378137,1/6356752.3142451793),a=new n(1/40680631590769,1/40680631590769,1/(6356752.3142451793*6356752.3142451793)),v=f.EPSILON1;return o.fromCartesian=function(t,i,u){var nt=r(i)?i.oneOverRadii:l,w=r(i)?i.oneOverRadiiSquared:a,tt=r(i)?i._centerToleranceSquared:v,p=e(t,nt,w,tt,h),y;if(!r(p))return undefined;y=n.multiplyComponents(p,w,s);y=n.normalize(y,y);var b=n.subtract(t,p,c),k=Math.atan2(y.y,y.x),d=Math.asin(y.z),g=f.sign(n.dot(b,t))*n.magnitude(b);return r(u)?(u.longitude=k,u.latitude=d,u.height=g,u):new o(k,d,g)},o.toCartesian=function(i,r,u){return t.defined("cartographic",i),n.fromRadians(i.longitude,i.latitude,i.height,r,u)},o.clone=function(n,t){return r(n)?r(t)?(t.longitude=n.longitude,t.latitude=n.latitude,t.height=n.height,t):new o(n.longitude,n.latitude,n.height):undefined},o.equals=function(n,t){return n===t||r(n)&&r(t)&&n.longitude===t.longitude&&n.latitude===t.latitude&&n.height===t.height},o.equalsEpsilon=function(n,i,u){return t.typeOf.number("epsilon",u),n===i||r(n)&&r(i)&&Math.abs(n.longitude-i.longitude)<=u&&Math.abs(n.latitude-i.latitude)<=u&&Math.abs(n.height-i.height)<=u},o.ZERO=u(new o(0,0,0)),o.prototype.clone=function(n){return o.clone(this,n)},o.prototype.equals=function(n){return o.equals(this,n)},o.prototype.equalsEpsilon=function(n,t){return o.equalsEpsilon(this,n,t)},o.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},o});t("Core/Ellipsoid",["./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./freezeObject","./Math","./scaleToGeodeticSurface"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function l(t,u,f,e){u=r(u,0);f=r(f,0);e=r(e,0);i.typeOf.number.greaterThanOrEquals("x",u,0);i.typeOf.number.greaterThanOrEquals("y",f,0);i.typeOf.number.greaterThanOrEquals("z",e,0);t._radii=new n(u,f,e);t._radiiSquared=new n(u*u,f*f,e*e);t._radiiToTheFourth=new n(u*u*u*u,f*f*f*f,e*e*e*e);t._oneOverRadii=new n(u===0?0:1/u,f===0?0:1/f,e===0?0:1/e);t._oneOverRadiiSquared=new n(u===0?0:1/(u*u),f===0?0:1/(f*f),e===0?0:1/(e*e));t._minimumRadius=Math.min(u,f,e);t._maximumRadius=Math.max(u,f,e);t._centerToleranceSquared=s.EPSILON1;t._radiiSquared.z!==0&&(t._squaredXOverSquaredZ=t._radiiSquared.x/t._radiiSquared.z)}function c(n,t,i){this._radii=undefined;this._radiiSquared=undefined;this._radiiToTheFourth=undefined;this._oneOverRadii=undefined;this._oneOverRadiiSquared=undefined;this._minimumRadius=undefined;this._maximumRadius=undefined;this._centerToleranceSquared=undefined;this._squaredXOverSquaredZ=undefined;l(this,n,t,i)}var a,v;f(c.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}});c.clone=function(t,i){if(!u(t))return undefined;var r=t._radii;return u(i)?(n.clone(r,i._radii),n.clone(t._radiiSquared,i._radiiSquared),n.clone(t._radiiToTheFourth,i._radiiToTheFourth),n.clone(t._oneOverRadii,i._oneOverRadii),n.clone(t._oneOverRadiiSquared,i._oneOverRadiiSquared),i._minimumRadius=t._minimumRadius,i._maximumRadius=t._maximumRadius,i._centerToleranceSquared=t._centerToleranceSquared,i):new c(r.x,r.y,r.z)};c.fromCartesian3=function(n,t){return(u(t)||(t=new c),!u(n))?t:(l(t,n.x,n.y,n.z),t)};c.WGS84=o(new c(6378137,6378137,6356752.3142451793));c.UNIT_SPHERE=o(new c(1,1,1));c.MOON=o(new c(s.LUNAR_RADIUS,s.LUNAR_RADIUS,s.LUNAR_RADIUS));c.prototype.clone=function(n){return c.clone(this,n)};c.packedLength=n.packedLength;c.pack=function(t,u,f){return i.typeOf.object("value",t),i.defined("array",u),f=r(f,0),n.pack(t._radii,u,f),u};c.unpack=function(t,u,f){i.defined("array",t);u=r(u,0);var e=n.unpack(t,u);return c.fromCartesian3(e,f)};c.prototype.geocentricSurfaceNormal=n.normalize;c.prototype.geodeticSurfaceNormalCartographic=function(t,r){i.typeOf.object("cartographic",t);var f=t.longitude,e=t.latitude,o=Math.cos(e),s=o*Math.cos(f),h=o*Math.sin(f),c=Math.sin(e);return u(r)||(r=new n),r.x=s,r.y=h,r.z=c,n.normalize(r,r)};c.prototype.geodeticSurfaceNormal=function(t,i){return u(i)||(i=new n),i=n.multiplyComponents(t,this._oneOverRadiiSquared,i),n.normalize(i,i)};a=new n;v=new n;c.prototype.cartographicToCartesian=function(t,i){var r=a,f=v,e;return this.geodeticSurfaceNormalCartographic(t,r),n.multiplyComponents(this._radiiSquared,r,f),e=Math.sqrt(n.dot(r,f)),n.divideByScalar(f,e,f),n.multiplyByScalar(r,t.height,r),u(i)||(i=new n),n.add(f,r,i)};c.prototype.cartographicArrayToCartesianArray=function(n,t){var f,r;for(i.defined("cartographics",n),f=n.length,u(t)?t.length=f:t=new Array(f),r=0;r<f;r++)t[r]=this.cartographicToCartesian(n[r],t[r]);return t};var y=new n,p=new n,w=new n;return c.prototype.cartesianToCartographic=function(i,r){var f=this.scaleToGeodeticSurface(i,p);if(!u(f))return undefined;var e=this.geodeticSurfaceNormal(f,y),o=n.subtract(i,f,w),h=Math.atan2(e.y,e.x),c=Math.asin(e.z),l=s.sign(n.dot(o,i))*n.magnitude(o);return u(r)?(r.longitude=h,r.latitude=c,r.height=l,r):new t(h,c,l)},c.prototype.cartesianArrayToCartographicArray=function(n,t){var f,r;for(i.defined("cartesians",n),f=n.length,u(t)?t.length=f:t=new Array(f),r=0;r<f;++r)t[r]=this.cartesianToCartographic(n[r],t[r]);return t},c.prototype.scaleToGeodeticSurface=function(n,t){return h(n,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},c.prototype.scaleToGeocentricSurface=function(t,r){i.typeOf.object("cartesian",t);u(r)||(r=new n);var e=t.x,o=t.y,s=t.z,f=this._oneOverRadiiSquared,h=1/Math.sqrt(e*e*f.x+o*o*f.y+s*s*f.z);return n.multiplyByScalar(t,h,r)},c.prototype.transformPositionToScaledSpace=function(t,i){return u(i)||(i=new n),n.multiplyComponents(t,this._oneOverRadii,i)},c.prototype.transformPositionFromScaledSpace=function(t,i){return u(i)||(i=new n),n.multiplyComponents(t,this._radii,i)},c.prototype.equals=function(t){return this===t||u(t)&&n.equals(this._radii,t._radii)},c.prototype.toString=function(){return this._radii.toString()},c.prototype.getSurfaceNormalIntersectionWithZAxis=function(t,f,o){if(i.typeOf.object("position",t),!s.equalsEpsilon(this._radii.x,this._radii.y,s.EPSILON15))throw new e("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");i.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0);f=r(f,0);var h=this._squaredXOverSquaredZ;return(u(o)||(o=new n),o.x=0,o.y=0,o.z=t.z*(1-h),Math.abs(o.z)>=this._radii.z-f)?undefined:o},c});t("Core/GeographicProjection",["./Cartesian3","./Cartographic","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid"],function(n,t,i,r,u,f,e){"use strict";function o(n){this._ellipsoid=i(n,e.WGS84);this._semimajorAxis=this._ellipsoid.maximumRadius;this._oneOverSemimajorAxis=1/this._semimajorAxis}return u(o.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),o.prototype.project=function(t,i){var u=this._semimajorAxis,f=t.longitude*u,e=t.latitude*u,o=t.height;return r(i)?(i.x=f,i.y=e,i.z=o,i):new n(f,e,o)},o.prototype.unproject=function(n,i){if(!r(n))throw new f("cartesian is required");var u=this._oneOverSemimajorAxis,e=n.x*u,o=n.y*u,s=n.z;return r(i)?(i.longitude=e,i.latitude=o,i.height=s,i):new t(e,o,s)},o});t("Core/Intersect",["./freezeObject"],function(n){"use strict";return n({OUTSIDE:-1,INTERSECTING:0,INSIDE:1})});t("Core/Interval",["./defaultValue"],function(n){"use strict";function t(t,i){this.start=n(t,0);this.stop=n(i,0)}return t});t("Core/Matrix3",["./Cartesian3","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./freezeObject","./Math"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,t,r,u,f,e,o,s,h){this[0]=i(n,0);this[1]=i(u,0);this[2]=i(o,0);this[3]=i(t,0);this[4]=i(f,0);this[5]=i(s,0);this[6]=i(r,0);this[7]=i(e,0);this[8]=i(h,0)}function p(n){for(var i,r=0,t=0;t<9;++t)i=n[t],r+=i*i;return Math.sqrt(r)}function w(n){for(var i,r=0,t=0;t<3;++t)i=n[s.getElementIndex(a[t],l[t])],r+=2*i*i;return Math.sqrt(r)}function b(n,t){for(var c,w=o.EPSILON15,p=0,h=1,f=0;f<3;++f)c=Math.abs(n[s.getElementIndex(a[f],l[f])]),c>p&&(h=f,p=c);var v=1,y=0,i=l[h],r=a[h];if(Math.abs(n[s.getElementIndex(r,i)])>w){var b=n[s.getElementIndex(r,r)],k=n[s.getElementIndex(i,i)],d=n[s.getElementIndex(r,i)],u=(b-k)/2/d,e;e=u<0?-1/(-u+Math.sqrt(1+u*u)):1/(u+Math.sqrt(1+u*u));v=1/Math.sqrt(1+e*e);y=e*v}return t=s.clone(s.IDENTITY,t),t[s.getElementIndex(i,i)]=t[s.getElementIndex(r,r)]=v,t[s.getElementIndex(r,i)]=y,t[s.getElementIndex(i,r)]=-y,t}var c,v,l,a,h,y;return s.packedLength=9,s.pack=function(n,r,u){return t.typeOf.object("value",n),t.defined("array",r),u=i(u,0),r[u++]=n[0],r[u++]=n[1],r[u++]=n[2],r[u++]=n[3],r[u++]=n[4],r[u++]=n[5],r[u++]=n[6],r[u++]=n[7],r[u++]=n[8],r},s.unpack=function(n,u,f){return t.defined("array",n),u=i(u,0),r(f)||(f=new s),f[0]=n[u++],f[1]=n[u++],f[2]=n[u++],f[3]=n[u++],f[4]=n[u++],f[5]=n[u++],f[6]=n[u++],f[7]=n[u++],f[8]=n[u++],f},s.clone=function(n,t){return r(n)?r(t)?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t):new s(n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]):undefined},s.fromArray=function(n,u,f){return t.defined("array",n),u=i(u,0),r(f)||(f=new s),f[0]=n[u],f[1]=n[u+1],f[2]=n[u+2],f[3]=n[u+3],f[4]=n[u+4],f[5]=n[u+5],f[6]=n[u+6],f[7]=n[u+7],f[8]=n[u+8],f},s.fromColumnMajorArray=function(n,i){return t.defined("values",n),s.clone(n,i)},s.fromRowMajorArray=function(n,i){return(t.defined("values",n),!r(i))?new s(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]):(i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8],i)},s.fromQuaternion=function(n,i){t.typeOf.object("quaternion",n);var u=n.x*n.x,h=n.x*n.y,c=n.x*n.z,l=n.x*n.w,f=n.y*n.y,a=n.y*n.z,v=n.y*n.w,e=n.z*n.z,y=n.z*n.w,o=n.w*n.w,p=u-f-e+o,w=2*(h-y),b=2*(c+v),k=2*(h+y),d=-u+f-e+o,g=2*(a-l),nt=2*(c-v),tt=2*(a+l),it=-u-f+e+o;return r(i)?(i[0]=p,i[1]=k,i[2]=nt,i[3]=w,i[4]=d,i[5]=tt,i[6]=b,i[7]=g,i[8]=it,i):new s(p,w,b,k,d,g,nt,tt,it)},s.fromHeadingPitchRoll=function(n,i){t.typeOf.object("headingPitchRoll",n);var c=Math.cos(-n.pitch),u=Math.cos(-n.heading),f=Math.cos(n.roll),e=Math.sin(-n.pitch),o=Math.sin(-n.heading),h=Math.sin(n.roll),l=c*u,a=-f*o+h*e*u,v=h*o+f*e*u,y=c*o,p=f*u+h*e*o,w=-h*u+f*e*o,b=-e,k=h*c,d=f*c;return r(i)?(i[0]=l,i[1]=y,i[2]=b,i[3]=a,i[4]=p,i[5]=k,i[6]=v,i[7]=w,i[8]=d,i):new s(l,a,v,y,p,w,b,k,d)},s.fromScale=function(n,i){return(t.typeOf.object("scale",n),!r(i))?new s(n.x,0,0,0,n.y,0,0,0,n.z):(i[0]=n.x,i[1]=0,i[2]=0,i[3]=0,i[4]=n.y,i[5]=0,i[6]=0,i[7]=0,i[8]=n.z,i)},s.fromUniformScale=function(n,i){return(t.typeOf.number("scale",n),!r(i))?new s(n,0,0,0,n,0,0,0,n):(i[0]=n,i[1]=0,i[2]=0,i[3]=0,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=n,i)},s.fromCrossProduct=function(n,i){return(t.typeOf.object("vector",n),!r(i))?new s(0,-n.z,n.y,n.z,0,-n.x,-n.y,n.x,0):(i[0]=0,i[1]=n.z,i[2]=-n.y,i[3]=-n.z,i[4]=0,i[5]=n.x,i[6]=n.y,i[7]=-n.x,i[8]=0,i)},s.fromRotationX=function(n,i){t.typeOf.number("angle",n);var u=Math.cos(n),f=Math.sin(n);return r(i)?(i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=u,i[5]=f,i[6]=0,i[7]=-f,i[8]=u,i):new s(1,0,0,0,u,-f,0,f,u)},s.fromRotationY=function(n,i){t.typeOf.number("angle",n);var u=Math.cos(n),f=Math.sin(n);return r(i)?(i[0]=u,i[1]=0,i[2]=-f,i[3]=0,i[4]=1,i[5]=0,i[6]=f,i[7]=0,i[8]=u,i):new s(u,0,f,0,1,0,-f,0,u)},s.fromRotationZ=function(n,i){t.typeOf.number("angle",n);var u=Math.cos(n),f=Math.sin(n);return r(i)?(i[0]=u,i[1]=f,i[2]=0,i[3]=-f,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i):new s(u,-f,0,f,u,0,0,0,1)},s.toArray=function(n,i){return(t.typeOf.object("matrix",n),!r(i))?[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]]:(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i)},s.getElementIndex=function(n,i){return t.typeOf.number.greaterThanOrEquals("row",i,0),t.typeOf.number.lessThanOrEquals("row",i,2),t.typeOf.number.greaterThanOrEquals("column",n,0),t.typeOf.number.lessThanOrEquals("column",n,2),n*3+i},s.getColumn=function(n,i,r){t.typeOf.object("matrix",n);t.typeOf.number.greaterThanOrEquals("index",i,0);t.typeOf.number.lessThanOrEquals("index",i,2);t.typeOf.object("result",r);var u=i*3,f=n[u],e=n[u+1],o=n[u+2];return r.x=f,r.y=e,r.z=o,r},s.setColumn=function(n,i,r,u){t.typeOf.object("matrix",n);t.typeOf.number.greaterThanOrEquals("index",i,0);t.typeOf.number.lessThanOrEquals("index",i,2);t.typeOf.object("cartesian",r);t.typeOf.object("result",u);u=s.clone(n,u);var f=i*3;return u[f]=r.x,u[f+1]=r.y,u[f+2]=r.z,u},s.getRow=function(n,i,r){t.typeOf.object("matrix",n);t.typeOf.number.greaterThanOrEquals("index",i,0);t.typeOf.number.lessThanOrEquals("index",i,2);t.typeOf.object("result",r);var u=n[i],f=n[i+3],e=n[i+6];return r.x=u,r.y=f,r.z=e,r},s.setRow=function(n,i,r,u){return t.typeOf.object("matrix",n),t.typeOf.number.greaterThanOrEquals("index",i,0),t.typeOf.number.lessThanOrEquals("index",i,2),t.typeOf.object("cartesian",r),t.typeOf.object("result",u),u=s.clone(n,u),u[i]=r.x,u[i+3]=r.y,u[i+6]=r.z,u},c=new n,s.getScale=function(i,r){return t.typeOf.object("matrix",i),t.typeOf.object("result",r),r.x=n.magnitude(n.fromElements(i[0],i[1],i[2],c)),r.y=n.magnitude(n.fromElements(i[3],i[4],i[5],c)),r.z=n.magnitude(n.fromElements(i[6],i[7],i[8],c)),r},v=new n,s.getMaximumScale=function(t){return s.getScale(t,v),n.maximumComponent(v)},s.multiply=function(n,i,r){t.typeOf.object("left",n);t.typeOf.object("right",i);t.typeOf.object("result",r);var u=n[0]*i[0]+n[3]*i[1]+n[6]*i[2],f=n[1]*i[0]+n[4]*i[1]+n[7]*i[2],e=n[2]*i[0]+n[5]*i[1]+n[8]*i[2],o=n[0]*i[3]+n[3]*i[4]+n[6]*i[5],s=n[1]*i[3]+n[4]*i[4]+n[7]*i[5],h=n[2]*i[3]+n[5]*i[4]+n[8]*i[5],c=n[0]*i[6]+n[3]*i[7]+n[6]*i[8],l=n[1]*i[6]+n[4]*i[7]+n[7]*i[8],a=n[2]*i[6]+n[5]*i[7]+n[8]*i[8];return r[0]=u,r[1]=f,r[2]=e,r[3]=o,r[4]=s,r[5]=h,r[6]=c,r[7]=l,r[8]=a,r},s.add=function(n,i,r){return t.typeOf.object("left",n),t.typeOf.object("right",i),t.typeOf.object("result",r),r[0]=n[0]+i[0],r[1]=n[1]+i[1],r[2]=n[2]+i[2],r[3]=n[3]+i[3],r[4]=n[4]+i[4],r[5]=n[5]+i[5],r[6]=n[6]+i[6],r[7]=n[7]+i[7],r[8]=n[8]+i[8],r},s.subtract=function(n,i,r){return t.typeOf.object("left",n),t.typeOf.object("right",i),t.typeOf.object("result",r),r[0]=n[0]-i[0],r[1]=n[1]-i[1],r[2]=n[2]-i[2],r[3]=n[3]-i[3],r[4]=n[4]-i[4],r[5]=n[5]-i[5],r[6]=n[6]-i[6],r[7]=n[7]-i[7],r[8]=n[8]-i[8],r},s.multiplyByVector=function(n,i,r){t.typeOf.object("matrix",n);t.typeOf.object("cartesian",i);t.typeOf.object("result",r);var u=i.x,f=i.y,e=i.z,o=n[0]*u+n[3]*f+n[6]*e,s=n[1]*u+n[4]*f+n[7]*e,h=n[2]*u+n[5]*f+n[8]*e;return r.x=o,r.y=s,r.z=h,r},s.multiplyByScalar=function(n,i,r){return t.typeOf.object("matrix",n),t.typeOf.number("scalar",i),t.typeOf.object("result",r),r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[3]=n[3]*i,r[4]=n[4]*i,r[5]=n[5]*i,r[6]=n[6]*i,r[7]=n[7]*i,r[8]=n[8]*i,r},s.multiplyByScale=function(n,i,r){return t.typeOf.object("matrix",n),t.typeOf.object("scale",i),t.typeOf.object("result",r),r[0]=n[0]*i.x,r[1]=n[1]*i.x,r[2]=n[2]*i.x,r[3]=n[3]*i.y,r[4]=n[4]*i.y,r[5]=n[5]*i.y,r[6]=n[6]*i.z,r[7]=n[7]*i.z,r[8]=n[8]*i.z,r},s.negate=function(n,i){return t.typeOf.object("matrix",n),t.typeOf.object("result",i),i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i[4]=-n[4],i[5]=-n[5],i[6]=-n[6],i[7]=-n[7],i[8]=-n[8],i},s.transpose=function(n,i){t.typeOf.object("matrix",n);t.typeOf.object("result",i);var r=n[0],u=n[3],f=n[6],e=n[1],o=n[4],s=n[7],h=n[2],c=n[5],l=n[8];return i[0]=r,i[1]=u,i[2]=f,i[3]=e,i[4]=o,i[5]=s,i[6]=h,i[7]=c,i[8]=l,i},l=[1,0,0],a=[2,2,1],h=new s,y=new s,s.computeEigenDecomposition=function(n,i){t.typeOf.object("matrix",n);var l=o.EPSILON20,f=0,e=0;r(i)||(i={});for(var c=i.unitary=s.clone(s.IDENTITY,i.unitary),u=i.diagonal=s.clone(n,i.diagonal),a=l*p(u);e<10&&w(u)>a;)b(u,h),s.transpose(h,y),s.multiply(u,h,u),s.multiply(y,u,u),s.multiply(c,h,c),++f>2&&(++e,f=0);return i},s.abs=function(n,i){return t.typeOf.object("matrix",n),t.typeOf.object("result",i),i[0]=Math.abs(n[0]),i[1]=Math.abs(n[1]),i[2]=Math.abs(n[2]),i[3]=Math.abs(n[3]),i[4]=Math.abs(n[4]),i[5]=Math.abs(n[5]),i[6]=Math.abs(n[6]),i[7]=Math.abs(n[7]),i[8]=Math.abs(n[8]),i},s.determinant=function(n){t.typeOf.object("matrix",n);var s=n[0],i=n[3],r=n[6],h=n[1],u=n[4],f=n[7],c=n[2],e=n[5],o=n[8];return s*(u*o-e*f)+h*(e*r-i*o)+c*(i*f-u*r)},s.inverse=function(n,i){var w;t.typeOf.object("matrix",n);t.typeOf.object("result",i);var r=n[0],u=n[1],e=n[2],h=n[3],c=n[4],l=n[5],a=n[6],v=n[7],y=n[8],p=s.determinant(n);if(Math.abs(p)<=o.EPSILON15)throw new f("matrix is not invertible");return i[0]=c*y-v*l,i[1]=v*e-u*y,i[2]=u*l-c*e,i[3]=a*l-h*y,i[4]=r*y-a*e,i[5]=h*e-r*l,i[6]=h*v-a*c,i[7]=a*u-r*v,i[8]=r*c-h*u,w=1/p,s.multiplyByScalar(i,w,i)},s.equals=function(n,t){return n===t||r(n)&&r(t)&&n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]},s.equalsEpsilon=function(n,i,u){return t.typeOf.number("epsilon",u),n===i||r(n)&&r(i)&&Math.abs(n[0]-i[0])<=u&&Math.abs(n[1]-i[1])<=u&&Math.abs(n[2]-i[2])<=u&&Math.abs(n[3]-i[3])<=u&&Math.abs(n[4]-i[4])<=u&&Math.abs(n[5]-i[5])<=u&&Math.abs(n[6]-i[6])<=u&&Math.abs(n[7]-i[7])<=u&&Math.abs(n[8]-i[8])<=u},s.IDENTITY=e(new s(1,0,0,0,1,0,0,0,1)),s.ZERO=e(new s(0,0,0,0,0,0,0,0,0)),s.COLUMN0ROW0=0,s.COLUMN0ROW1=1,s.COLUMN0ROW2=2,s.COLUMN1ROW0=3,s.COLUMN1ROW1=4,s.COLUMN1ROW2=5,s.COLUMN2ROW0=6,s.COLUMN2ROW1=7,s.COLUMN2ROW2=8,u(s.prototype,{length:{get:function(){return s.packedLength}}}),s.prototype.clone=function(n){return s.clone(this,n)},s.prototype.equals=function(n){return s.equals(this,n)},s.equalsArray=function(n,t,i){return n[0]===t[i]&&n[1]===t[i+1]&&n[2]===t[i+2]&&n[3]===t[i+3]&&n[4]===t[i+4]&&n[5]===t[i+5]&&n[6]===t[i+6]&&n[7]===t[i+7]&&n[8]===t[i+8]},s.prototype.equalsEpsilon=function(n,t){return s.equalsEpsilon(this,n,t)},s.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"},s});t("Core/Cartesian4",["./Check","./defaultValue","./defined","./DeveloperError","./freezeObject","./Math"],function(n,t,i,r,u,f){"use strict";function e(n,i,r,u){this.x=t(n,0);this.y=t(i,0);this.z=t(r,0);this.w=t(u,0)}var o,c,l;e.fromElements=function(n,t,r,u,f){return i(f)?(f.x=n,f.y=t,f.z=r,f.w=u,f):new e(n,t,r,u)};e.fromColor=function(t,r){return(n.typeOf.object("color",t),!i(r))?new e(t.red,t.green,t.blue,t.alpha):(r.x=t.red,r.y=t.green,r.z=t.blue,r.w=t.alpha,r)};e.clone=function(n,t){return i(n)?i(t)?(t.x=n.x,t.y=n.y,t.z=n.z,t.w=n.w,t):new e(n.x,n.y,n.z,n.w):undefined};e.packedLength=4;e.pack=function(i,r,u){return n.typeOf.object("value",i),n.defined("array",r),u=t(u,0),r[u++]=i.x,r[u++]=i.y,r[u++]=i.z,r[u]=i.w,r};e.unpack=function(r,u,f){return n.defined("array",r),u=t(u,0),i(f)||(f=new e),f.x=r[u++],f.y=r[u++],f.z=r[u++],f.w=r[u],f};e.packArray=function(t,r){var f,u;for(n.defined("array",t),f=t.length,i(r)?r.length=f*4:r=new Array(f*4),u=0;u<f;++u)e.pack(t[u],r,u*4);return r};e.unpackArray=function(t,r){var f,u,o;for(n.defined("array",t),f=t.length,i(r)?r.length=f/4:r=new Array(f/4),u=0;u<f;u+=4)o=u/4,r[o]=e.unpack(t,u,r[o]);return r};e.fromArray=e.unpack;e.maximumComponent=function(t){return n.typeOf.object("cartesian",t),Math.max(t.x,t.y,t.z,t.w)};e.minimumComponent=function(t){return n.typeOf.object("cartesian",t),Math.min(t.x,t.y,t.z,t.w)};e.minimumByComponent=function(t,i,r){return n.typeOf.object("first",t),n.typeOf.object("second",i),n.typeOf.object("result",r),r.x=Math.min(t.x,i.x),r.y=Math.min(t.y,i.y),r.z=Math.min(t.z,i.z),r.w=Math.min(t.w,i.w),r};e.maximumByComponent=function(t,i,r){return n.typeOf.object("first",t),n.typeOf.object("second",i),n.typeOf.object("result",r),r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r.z=Math.max(t.z,i.z),r.w=Math.max(t.w,i.w),r};e.magnitudeSquared=function(t){return n.typeOf.object("cartesian",t),t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w};e.magnitude=function(n){return Math.sqrt(e.magnitudeSquared(n))};o=new e;e.distance=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.subtract(t,i,o),e.magnitude(o)};e.distanceSquared=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.subtract(t,i,o),e.magnitudeSquared(o)};e.normalize=function(t,i){n.typeOf.object("cartesian",t);n.typeOf.object("result",i);var u=e.magnitude(t);if(i.x=t.x/u,i.y=t.y/u,i.z=t.z/u,i.w=t.w/u,isNaN(i.x)||isNaN(i.y)||isNaN(i.z)||isNaN(i.w))throw new r("normalized result is not a number");return i};e.dot=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w};e.multiplyComponents=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x*i.x,r.y=t.y*i.y,r.z=t.z*i.z,r.w=t.w*i.w,r};e.divideComponents=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x/i.x,r.y=t.y/i.y,r.z=t.z/i.z,r.w=t.w/i.w,r};e.add=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x+i.x,r.y=t.y+i.y,r.z=t.z+i.z,r.w=t.w+i.w,r};e.subtract=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x-i.x,r.y=t.y-i.y,r.z=t.z-i.z,r.w=t.w-i.w,r};e.multiplyByScalar=function(t,i,r){return n.typeOf.object("cartesian",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.x=t.x*i,r.y=t.y*i,r.z=t.z*i,r.w=t.w*i,r};e.divideByScalar=function(t,i,r){return n.typeOf.object("cartesian",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.x=t.x/i,r.y=t.y/i,r.z=t.z/i,r.w=t.w/i,r};e.negate=function(t,i){return n.typeOf.object("cartesian",t),n.typeOf.object("result",i),i.x=-t.x,i.y=-t.y,i.z=-t.z,i.w=-t.w,i};e.abs=function(t,i){return n.typeOf.object("cartesian",t),n.typeOf.object("result",i),i.x=Math.abs(t.x),i.y=Math.abs(t.y),i.z=Math.abs(t.z),i.w=Math.abs(t.w),i};c=new e;e.lerp=function(t,i,r,u){return n.typeOf.object("start",t),n.typeOf.object("end",i),n.typeOf.number("t",r),n.typeOf.object("result",u),e.multiplyByScalar(i,r,c),u=e.multiplyByScalar(t,1-r,u),e.add(c,u,u)};l=new e;e.mostOrthogonalAxis=function(t,i){n.typeOf.object("cartesian",t);n.typeOf.object("result",i);var r=e.normalize(t,l);return e.abs(r,r),r.x<=r.y?r.x<=r.z?r.x<=r.w?e.clone(e.UNIT_X,i):e.clone(e.UNIT_W,i):r.z<=r.w?e.clone(e.UNIT_Z,i):e.clone(e.UNIT_W,i):r.y<=r.z?r.y<=r.w?e.clone(e.UNIT_Y,i):e.clone(e.UNIT_W,i):r.z<=r.w?e.clone(e.UNIT_Z,i):e.clone(e.UNIT_W,i)};e.equals=function(n,t){return n===t||i(n)&&i(t)&&n.x===t.x&&n.y===t.y&&n.z===t.z&&n.w===t.w};e.equalsArray=function(n,t,i){return n.x===t[i]&&n.y===t[i+1]&&n.z===t[i+2]&&n.w===t[i+3]};e.equalsEpsilon=function(n,t,r,u){return n===t||i(n)&&i(t)&&f.equalsEpsilon(n.x,t.x,r,u)&&f.equalsEpsilon(n.y,t.y,r,u)&&f.equalsEpsilon(n.z,t.z,r,u)&&f.equalsEpsilon(n.w,t.w,r,u)};e.ZERO=u(new e(0,0,0,0));e.UNIT_X=u(new e(1,0,0,0));e.UNIT_Y=u(new e(0,1,0,0));e.UNIT_Z=u(new e(0,0,1,0));e.UNIT_W=u(new e(0,0,0,1));e.prototype.clone=function(n){return e.clone(this,n)};e.prototype.equals=function(n){return e.equals(this,n)};e.prototype.equalsEpsilon=function(n,t,i){return e.equalsEpsilon(this,n,t,i)};e.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var a=new Float32Array(1),s=256,v=1/s,y=1/65536,p=1/16777216,h=38;return e.packFloat=function(t,r){var c,o,u;return(n.typeOf.number("value",t),i(r)||(r=new e),a[0]=t,t=a[0],t===0)?e.clone(e.ZERO,r):(c=t<0?1:0,isFinite(t)?(t=Math.abs(t),o=Math.floor(f.logBase(t,10))+1,t=t/Math.pow(10,o)):(t=.1,o=h),u=t*s,r.x=Math.floor(u),u=(u-r.x)*s,r.y=Math.floor(u),u=(u-r.y)*s,r.z=Math.floor(u),r.w=(o+h)*2+c,r)},e.unpackFloat=function(t){var u;n.typeOf.object("packedFloat",t);var f=t.w/2,r=Math.floor(f),i=(f-r)*2;return(r=r-h,i=i*2-1,i=-i,r>=h)?i<0?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY:(u=i*t.x*v,u+=i*t.y*y,u+=i*t.z*p,u*Math.pow(10,r))},e});t("Core/Matrix4",["./Cartesian3","./Cartesian4","./Check","./defaultValue","./defined","./defineProperties","./freezeObject","./Math","./Matrix3","./RuntimeError"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n,t,i,u,f,e,o,s,h,c,l,a,v,y,p,w){this[0]=r(n,0);this[1]=r(f,0);this[2]=r(h,0);this[3]=r(v,0);this[4]=r(t,0);this[5]=r(e,0);this[6]=r(c,0);this[7]=r(y,0);this[8]=r(i,0);this[9]=r(o,0);this[10]=r(l,0);this[11]=r(p,0);this[12]=r(u,0);this[13]=r(s,0);this[14]=r(a,0);this[15]=r(w,0)}var w,p,b,y;c.packedLength=16;c.pack=function(n,t,u){return i.typeOf.object("value",n),i.defined("array",t),u=r(u,0),t[u++]=n[0],t[u++]=n[1],t[u++]=n[2],t[u++]=n[3],t[u++]=n[4],t[u++]=n[5],t[u++]=n[6],t[u++]=n[7],t[u++]=n[8],t[u++]=n[9],t[u++]=n[10],t[u++]=n[11],t[u++]=n[12],t[u++]=n[13],t[u++]=n[14],t[u]=n[15],t};c.unpack=function(n,t,f){return i.defined("array",n),t=r(t,0),u(f)||(f=new c),f[0]=n[t++],f[1]=n[t++],f[2]=n[t++],f[3]=n[t++],f[4]=n[t++],f[5]=n[t++],f[6]=n[t++],f[7]=n[t++],f[8]=n[t++],f[9]=n[t++],f[10]=n[t++],f[11]=n[t++],f[12]=n[t++],f[13]=n[t++],f[14]=n[t++],f[15]=n[t],f};c.clone=function(n,t){return u(n)?u(t)?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t):new c(n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]):undefined};c.fromArray=c.unpack;c.fromColumnMajorArray=function(n,t){return i.defined("values",n),c.clone(n,t)};c.fromRowMajorArray=function(n,t){return(i.defined("values",n),!u(t))?new c(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]):(t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15],t)};c.fromRotationTranslation=function(t,f,e){return(i.typeOf.object("rotation",t),f=r(f,n.ZERO),!u(e))?new c(t[0],t[3],t[6],f.x,t[1],t[4],t[7],f.y,t[2],t[5],t[8],f.z,0,0,0,1):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[3],e[5]=t[4],e[6]=t[5],e[7]=0,e[8]=t[6],e[9]=t[7],e[10]=t[8],e[11]=0,e[12]=f.x,e[13]=f.y,e[14]=f.z,e[15]=1,e)};c.fromTranslationQuaternionRotationScale=function(n,t,r,f){i.typeOf.object("translation",n);i.typeOf.object("rotation",t);i.typeOf.object("scale",r);u(f)||(f=new c);var e=r.x,o=r.y,s=r.z,h=t.x*t.x,y=t.x*t.y,p=t.x*t.z,w=t.x*t.w,l=t.y*t.y,b=t.y*t.z,k=t.y*t.w,a=t.z*t.z,d=t.z*t.w,v=t.w*t.w,g=h-l-a+v,nt=2*(y-d),tt=2*(p+k),it=2*(y+d),rt=-h+l-a+v,ut=2*(b-w),ft=2*(p-k),et=2*(b+w),ot=-h-l+a+v;return f[0]=g*e,f[1]=it*e,f[2]=ft*e,f[3]=0,f[4]=nt*o,f[5]=rt*o,f[6]=et*o,f[7]=0,f[8]=tt*s,f[9]=ut*s,f[10]=ot*s,f[11]=0,f[12]=n.x,f[13]=n.y,f[14]=n.z,f[15]=1,f};c.fromTranslationRotationScale=function(n,t){return i.typeOf.object("translationRotationScale",n),c.fromTranslationQuaternionRotationScale(n.translation,n.rotation,n.scale,t)};c.fromTranslation=function(n,t){return i.typeOf.object("translation",n),c.fromRotationTranslation(s.IDENTITY,n,t)};c.fromScale=function(n,t){return(i.typeOf.object("scale",n),!u(t))?new c(n.x,0,0,0,0,n.y,0,0,0,0,n.z,0,0,0,0,1):(t[0]=n.x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n.y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n.z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)};c.fromUniformScale=function(n,t){return(i.typeOf.number("scale",n),!u(t))?new c(n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1):(t[0]=n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)};var l=new n,a=new n,v=new n;c.fromCamera=function(t,r){i.typeOf.object("camera",t);var f=t.position,tt=t.direction,it=t.up;i.typeOf.object("camera.position",f);i.typeOf.object("camera.direction",tt);i.typeOf.object("camera.up",it);n.normalize(tt,l);n.normalize(n.cross(l,it,a),a);n.normalize(n.cross(a,l,v),v);var e=a.x,o=a.y,s=a.z,h=l.x,y=l.y,p=l.z,w=v.x,b=v.y,k=v.z,d=f.x,g=f.y,nt=f.z,rt=e*-d+o*-g+s*-nt,ut=w*-d+b*-g+k*-nt,ft=h*d+y*g+p*nt;return u(r)?(r[0]=e,r[1]=w,r[2]=-h,r[3]=0,r[4]=o,r[5]=b,r[6]=-y,r[7]=0,r[8]=s,r[9]=k,r[10]=-p,r[11]=0,r[12]=rt,r[13]=ut,r[14]=ft,r[15]=1,r):new c(e,o,s,rt,w,b,k,ut,-h,-y,-p,ft,0,0,0,1)};c.computePerspectiveFieldOfView=function(n,t,r,u,f){i.typeOf.number.greaterThan("fovY",n,0);i.typeOf.number.lessThan("fovY",n,Math.PI);i.typeOf.number.greaterThan("near",r,0);i.typeOf.number.greaterThan("far",u,0);i.typeOf.object("result",f);var o=Math.tan(n*.5),e=1/o,s=e/t,h=(u+r)/(r-u),c=2*u*r/(r-u);return f[0]=s,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=e,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=h,f[11]=-1,f[12]=0,f[13]=0,f[14]=c,f[15]=0,f};c.computeOrthographicOffCenter=function(n,t,r,u,f,e,o){i.typeOf.number("left",n);i.typeOf.number("right",t);i.typeOf.number("bottom",r);i.typeOf.number("top",u);i.typeOf.number("near",f);i.typeOf.number("far",e);i.typeOf.object("result",o);var s=1/(t-n),h=1/(u-r),c=1/(e-f),l=-(t+n)*s,a=-(u+r)*h,v=-(e+f)*c;return s*=2,h*=2,c*=-2,o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=c,o[11]=0,o[12]=l,o[13]=a,o[14]=v,o[15]=1,o};c.computePerspectiveOffCenter=function(n,t,r,u,f,e,o){i.typeOf.number("left",n);i.typeOf.number("right",t);i.typeOf.number("bottom",r);i.typeOf.number("top",u);i.typeOf.number("near",f);i.typeOf.number("far",e);i.typeOf.object("result",o);var s=2*f/(t-n),h=2*f/(u-r),c=(t+n)/(t-n),l=(u+r)/(u-r),a=-(e+f)/(e-f),v=-2*e*f/(e-f);return o[0]=s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=h,o[6]=0,o[7]=0,o[8]=c,o[9]=l,o[10]=a,o[11]=-1,o[12]=0,o[13]=0,o[14]=v,o[15]=0,o};c.computeInfinitePerspectiveOffCenter=function(n,t,r,u,f,e){i.typeOf.number("left",n);i.typeOf.number("right",t);i.typeOf.number("bottom",r);i.typeOf.number("top",u);i.typeOf.number("near",f);i.typeOf.object("result",e);var o=2*f/(t-n),s=2*f/(u-r),h=(t+n)/(t-n),c=(u+r)/(u-r),l=-2*f;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=h,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0,e};c.computeViewportTransformation=function(n,t,u,f){i.typeOf.object("result",f);n=r(n,r.EMPTY_OBJECT);var h=r(n.x,0),c=r(n.y,0),l=r(n.width,0),a=r(n.height,0);t=r(t,0);u=r(u,1);var e=l*.5,o=a*.5,s=(u-t)*.5,v=e,y=o,p=s,w=h+e,b=c+o,k=t+s;return f[0]=v,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=y,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=p,f[11]=0,f[12]=w,f[13]=b,f[14]=k,f[15]=1,f};c.computeView=function(t,r,u,f,e){return i.typeOf.object("position",t),i.typeOf.object("direction",r),i.typeOf.object("up",u),i.typeOf.object("right",f),i.typeOf.object("result",e),e[0]=f.x,e[1]=u.x,e[2]=-r.x,e[3]=0,e[4]=f.y,e[5]=u.y,e[6]=-r.y,e[7]=0,e[8]=f.z,e[9]=u.z,e[10]=-r.z,e[11]=0,e[12]=-n.dot(f,t),e[13]=-n.dot(u,t),e[14]=n.dot(r,t),e[15]=1,e};c.toArray=function(n,t){return(i.typeOf.object("matrix",n),!u(t))?[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]]:(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t)};c.getElementIndex=function(n,t){return i.typeOf.number.greaterThanOrEquals("row",t,0),i.typeOf.number.lessThanOrEquals("row",t,3),i.typeOf.number.greaterThanOrEquals("column",n,0),i.typeOf.number.lessThanOrEquals("column",n,3),n*4+t};c.getColumn=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.number.greaterThanOrEquals("index",t,0);i.typeOf.number.lessThanOrEquals("index",t,3);i.typeOf.object("result",r);var u=t*4,f=n[u],e=n[u+1],o=n[u+2],s=n[u+3];return r.x=f,r.y=e,r.z=o,r.w=s,r};c.setColumn=function(n,t,r,u){i.typeOf.object("matrix",n);i.typeOf.number.greaterThanOrEquals("index",t,0);i.typeOf.number.lessThanOrEquals("index",t,3);i.typeOf.object("cartesian",r);i.typeOf.object("result",u);u=c.clone(n,u);var f=t*4;return u[f]=r.x,u[f+1]=r.y,u[f+2]=r.z,u[f+3]=r.w,u};c.setTranslation=function(n,t,r){return i.typeOf.object("matrix",n),i.typeOf.object("translation",t),i.typeOf.object("result",r),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=n[15],r};w=new n;c.setScale=function(t,r,u){i.typeOf.object("matrix",t);i.typeOf.object("scale",r);i.typeOf.object("result",u);var f=c.getScale(t,w),e=n.divideComponents(r,f,w);return c.multiplyByScale(t,e,u)};c.getRow=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.number.greaterThanOrEquals("index",t,0);i.typeOf.number.lessThanOrEquals("index",t,3);i.typeOf.object("result",r);var u=n[t],f=n[t+4],e=n[t+8],o=n[t+12];return r.x=u,r.y=f,r.z=e,r.w=o,r};c.setRow=function(n,t,r,u){return i.typeOf.object("matrix",n),i.typeOf.number.greaterThanOrEquals("index",t,0),i.typeOf.number.lessThanOrEquals("index",t,3),i.typeOf.object("cartesian",r),i.typeOf.object("result",u),u=c.clone(n,u),u[t]=r.x,u[t+4]=r.y,u[t+8]=r.z,u[t+12]=r.w,u};p=new n;c.getScale=function(t,r){return i.typeOf.object("matrix",t),i.typeOf.object("result",r),r.x=n.magnitude(n.fromElements(t[0],t[1],t[2],p)),r.y=n.magnitude(n.fromElements(t[4],t[5],t[6],p)),r.z=n.magnitude(n.fromElements(t[8],t[9],t[10],p)),r};b=new n;c.getMaximumScale=function(t){return c.getScale(t,b),n.maximumComponent(b)};c.multiply=function(n,t,r){i.typeOf.object("left",n);i.typeOf.object("right",t);i.typeOf.object("result",r);var u=n[0],f=n[1],e=n[2],o=n[3],s=n[4],h=n[5],c=n[6],l=n[7],a=n[8],v=n[9],y=n[10],p=n[11],w=n[12],b=n[13],k=n[14],d=n[15],g=t[0],nt=t[1],tt=t[2],it=t[3],rt=t[4],ut=t[5],ft=t[6],et=t[7],ot=t[8],st=t[9],ht=t[10],ct=t[11],lt=t[12],at=t[13],vt=t[14],yt=t[15],pt=u*g+s*nt+a*tt+w*it,wt=f*g+h*nt+v*tt+b*it,bt=e*g+c*nt+y*tt+k*it,kt=o*g+l*nt+p*tt+d*it,dt=u*rt+s*ut+a*ft+w*et,gt=f*rt+h*ut+v*ft+b*et,ni=e*rt+c*ut+y*ft+k*et,ti=o*rt+l*ut+p*ft+d*et,ii=u*ot+s*st+a*ht+w*ct,ri=f*ot+h*st+v*ht+b*ct,ui=e*ot+c*st+y*ht+k*ct,fi=o*ot+l*st+p*ht+d*ct,ei=u*lt+s*at+a*vt+w*yt,oi=f*lt+h*at+v*vt+b*yt,si=e*lt+c*at+y*vt+k*yt,hi=o*lt+l*at+p*vt+d*yt;return r[0]=pt,r[1]=wt,r[2]=bt,r[3]=kt,r[4]=dt,r[5]=gt,r[6]=ni,r[7]=ti,r[8]=ii,r[9]=ri,r[10]=ui,r[11]=fi,r[12]=ei,r[13]=oi,r[14]=si,r[15]=hi,r};c.add=function(n,t,r){return i.typeOf.object("left",n),i.typeOf.object("right",t),i.typeOf.object("result",r),r[0]=n[0]+t[0],r[1]=n[1]+t[1],r[2]=n[2]+t[2],r[3]=n[3]+t[3],r[4]=n[4]+t[4],r[5]=n[5]+t[5],r[6]=n[6]+t[6],r[7]=n[7]+t[7],r[8]=n[8]+t[8],r[9]=n[9]+t[9],r[10]=n[10]+t[10],r[11]=n[11]+t[11],r[12]=n[12]+t[12],r[13]=n[13]+t[13],r[14]=n[14]+t[14],r[15]=n[15]+t[15],r};c.subtract=function(n,t,r){return i.typeOf.object("left",n),i.typeOf.object("right",t),i.typeOf.object("result",r),r[0]=n[0]-t[0],r[1]=n[1]-t[1],r[2]=n[2]-t[2],r[3]=n[3]-t[3],r[4]=n[4]-t[4],r[5]=n[5]-t[5],r[6]=n[6]-t[6],r[7]=n[7]-t[7],r[8]=n[8]-t[8],r[9]=n[9]-t[9],r[10]=n[10]-t[10],r[11]=n[11]-t[11],r[12]=n[12]-t[12],r[13]=n[13]-t[13],r[14]=n[14]-t[14],r[15]=n[15]-t[15],r};c.multiplyTransformation=function(n,t,r){i.typeOf.object("left",n);i.typeOf.object("right",t);i.typeOf.object("result",r);var u=n[0],f=n[1],e=n[2],o=n[4],s=n[5],h=n[6],c=n[8],l=n[9],a=n[10],ut=n[12],ft=n[13],et=n[14],v=t[0],y=t[1],p=t[2],w=t[4],b=t[5],k=t[6],d=t[8],g=t[9],nt=t[10],tt=t[12],it=t[13],rt=t[14],ot=u*v+o*y+c*p,st=f*v+s*y+l*p,ht=e*v+h*y+a*p,ct=u*w+o*b+c*k,lt=f*w+s*b+l*k,at=e*w+h*b+a*k,vt=u*d+o*g+c*nt,yt=f*d+s*g+l*nt,pt=e*d+h*g+a*nt,wt=u*tt+o*it+c*rt+ut,bt=f*tt+s*it+l*rt+ft,kt=e*tt+h*it+a*rt+et;return r[0]=ot,r[1]=st,r[2]=ht,r[3]=0,r[4]=ct,r[5]=lt,r[6]=at,r[7]=0,r[8]=vt,r[9]=yt,r[10]=pt,r[11]=0,r[12]=wt,r[13]=bt,r[14]=kt,r[15]=1,r};c.multiplyByMatrix3=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.object("rotation",t);i.typeOf.object("result",r);var u=n[0],f=n[1],e=n[2],o=n[4],s=n[5],h=n[6],c=n[8],l=n[9],a=n[10],v=t[0],y=t[1],p=t[2],w=t[3],b=t[4],k=t[5],d=t[6],g=t[7],nt=t[8],tt=u*v+o*y+c*p,it=f*v+s*y+l*p,rt=e*v+h*y+a*p,ut=u*w+o*b+c*k,ft=f*w+s*b+l*k,et=e*w+h*b+a*k,ot=u*d+o*g+c*nt,st=f*d+s*g+l*nt,ht=e*d+h*g+a*nt;return r[0]=tt,r[1]=it,r[2]=rt,r[3]=0,r[4]=ut,r[5]=ft,r[6]=et,r[7]=0,r[8]=ot,r[9]=st,r[10]=ht,r[11]=0,r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r};c.multiplyByTranslation=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.object("translation",t);i.typeOf.object("result",r);var u=t.x,f=t.y,e=t.z,o=u*n[0]+f*n[4]+e*n[8]+n[12],s=u*n[1]+f*n[5]+e*n[9]+n[13],h=u*n[2]+f*n[6]+e*n[10]+n[14];return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=o,r[13]=s,r[14]=h,r[15]=n[15],r};y=new n;c.multiplyByUniformScale=function(n,t,r){return i.typeOf.object("matrix",n),i.typeOf.number("scale",t),i.typeOf.object("result",r),y.x=t,y.y=t,y.z=t,c.multiplyByScale(n,y,r)};c.multiplyByScale=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.object("scale",t);i.typeOf.object("result",r);var u=t.x,f=t.y,e=t.z;return u===1&&f===1&&e===1?c.clone(n,r):(r[0]=u*n[0],r[1]=u*n[1],r[2]=u*n[2],r[3]=0,r[4]=f*n[4],r[5]=f*n[5],r[6]=f*n[6],r[7]=0,r[8]=e*n[8],r[9]=e*n[9],r[10]=e*n[10],r[11]=0,r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=1,r)};c.multiplyByVector=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.object("cartesian",t);i.typeOf.object("result",r);var u=t.x,f=t.y,e=t.z,o=t.w,s=n[0]*u+n[4]*f+n[8]*e+n[12]*o,h=n[1]*u+n[5]*f+n[9]*e+n[13]*o,c=n[2]*u+n[6]*f+n[10]*e+n[14]*o,l=n[3]*u+n[7]*f+n[11]*e+n[15]*o;return r.x=s,r.y=h,r.z=c,r.w=l,r};c.multiplyByPointAsVector=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.object("cartesian",t);i.typeOf.object("result",r);var u=t.x,f=t.y,e=t.z,o=n[0]*u+n[4]*f+n[8]*e,s=n[1]*u+n[5]*f+n[9]*e,h=n[2]*u+n[6]*f+n[10]*e;return r.x=o,r.y=s,r.z=h,r};c.multiplyByPoint=function(n,t,r){i.typeOf.object("matrix",n);i.typeOf.object("cartesian",t);i.typeOf.object("result",r);var u=t.x,f=t.y,e=t.z,o=n[0]*u+n[4]*f+n[8]*e+n[12],s=n[1]*u+n[5]*f+n[9]*e+n[13],h=n[2]*u+n[6]*f+n[10]*e+n[14];return r.x=o,r.y=s,r.z=h,r};c.multiplyByScalar=function(n,t,r){return i.typeOf.object("matrix",n),i.typeOf.number("scalar",t),i.typeOf.object("result",r),r[0]=n[0]*t,r[1]=n[1]*t,r[2]=n[2]*t,r[3]=n[3]*t,r[4]=n[4]*t,r[5]=n[5]*t,r[6]=n[6]*t,r[7]=n[7]*t,r[8]=n[8]*t,r[9]=n[9]*t,r[10]=n[10]*t,r[11]=n[11]*t,r[12]=n[12]*t,r[13]=n[13]*t,r[14]=n[14]*t,r[15]=n[15]*t,r};c.negate=function(n,t){return i.typeOf.object("matrix",n),i.typeOf.object("result",t),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=-n[7],t[8]=-n[8],t[9]=-n[9],t[10]=-n[10],t[11]=-n[11],t[12]=-n[12],t[13]=-n[13],t[14]=-n[14],t[15]=-n[15],t};c.transpose=function(n,t){i.typeOf.object("matrix",n);i.typeOf.object("result",t);var r=n[1],u=n[2],f=n[3],e=n[6],o=n[7],s=n[11];return t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=r,t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=u,t[9]=e,t[10]=n[10],t[11]=n[14],t[12]=f,t[13]=o,t[14]=s,t[15]=n[15],t};c.abs=function(n,t){return i.typeOf.object("matrix",n),i.typeOf.object("result",t),t[0]=Math.abs(n[0]),t[1]=Math.abs(n[1]),t[2]=Math.abs(n[2]),t[3]=Math.abs(n[3]),t[4]=Math.abs(n[4]),t[5]=Math.abs(n[5]),t[6]=Math.abs(n[6]),t[7]=Math.abs(n[7]),t[8]=Math.abs(n[8]),t[9]=Math.abs(n[9]),t[10]=Math.abs(n[10]),t[11]=Math.abs(n[11]),t[12]=Math.abs(n[12]),t[13]=Math.abs(n[13]),t[14]=Math.abs(n[14]),t[15]=Math.abs(n[15]),t};c.equals=function(n,t){return n===t||u(n)&&u(t)&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[3]===t[3]&&n[7]===t[7]&&n[11]===t[11]&&n[15]===t[15]};c.equalsEpsilon=function(n,t,r){return i.typeOf.number("epsilon",r),n===t||u(n)&&u(t)&&Math.abs(n[0]-t[0])<=r&&Math.abs(n[1]-t[1])<=r&&Math.abs(n[2]-t[2])<=r&&Math.abs(n[3]-t[3])<=r&&Math.abs(n[4]-t[4])<=r&&Math.abs(n[5]-t[5])<=r&&Math.abs(n[6]-t[6])<=r&&Math.abs(n[7]-t[7])<=r&&Math.abs(n[8]-t[8])<=r&&Math.abs(n[9]-t[9])<=r&&Math.abs(n[10]-t[10])<=r&&Math.abs(n[11]-t[11])<=r&&Math.abs(n[12]-t[12])<=r&&Math.abs(n[13]-t[13])<=r&&Math.abs(n[14]-t[14])<=r&&Math.abs(n[15]-t[15])<=r};c.getTranslation=function(n,t){return i.typeOf.object("matrix",n),i.typeOf.object("result",t),t.x=n[12],t.y=n[13],t.z=n[14],t};c.getRotation=function(n,t){return i.typeOf.object("matrix",n),i.typeOf.object("result",t),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t};var k=new s,d=new s,g=new t,nt=new t(0,0,0,1);return c.inverse=function(n,r){i.typeOf.object("matrix",n);i.typeOf.object("result",r);var f=n[0],e=n[4],l=n[8],a=n[12],v=n[1],y=n[5],p=n[9],w=n[13],b=n[2],tt=n[6],it=n[10],rt=n[14],ut=n[3],ft=n[7],et=n[11],ot=n[15],st=it*ot,ht=rt*et,ct=tt*ot,lt=rt*ft,at=tt*et,vt=it*ft,yt=b*ot,pt=rt*ut,wt=b*et,bt=it*ut,kt=b*ft,dt=tt*ut,gt=st*y+lt*p+at*w-(ht*y+ct*p+vt*w),ni=ht*v+yt*p+bt*w-(st*v+pt*p+wt*w),ti=ct*v+pt*y+kt*w-(lt*v+yt*y+dt*w),ii=vt*v+wt*y+dt*p-(at*v+bt*y+kt*p),ri=ht*e+ct*l+vt*a-(st*e+lt*l+at*a),ui=st*f+pt*l+wt*a-(ht*f+yt*l+bt*a),fi=lt*f+yt*e+dt*a-(ct*f+pt*e+kt*a),ei=at*f+bt*e+kt*l-(vt*f+wt*e+dt*l);st=l*w;ht=a*p;ct=e*w;lt=a*y;at=e*p;vt=l*y;yt=f*w;pt=a*v;wt=f*p;bt=l*v;kt=f*y;dt=e*v;var oi=st*ft+lt*et+at*ot-(ht*ft+ct*et+vt*ot),si=ht*ut+yt*et+bt*ot-(st*ut+pt*et+wt*ot),hi=ct*ut+pt*ft+kt*ot-(lt*ut+yt*ft+dt*ot),ci=vt*ut+wt*ft+dt*et-(at*ut+bt*ft+kt*et),li=ct*it+vt*rt+ht*tt-(at*rt+st*tt+lt*it),ai=wt*rt+st*b+pt*it-(yt*it+bt*rt+ht*b),vi=yt*tt+dt*rt+lt*b-(kt*rt+ct*b+pt*tt),yi=kt*it+at*b+bt*tt-(wt*tt+dt*it+vt*b),u=f*gt+e*ni+l*ti+a*ii;if(Math.abs(u)<o.EPSILON21){if(s.equalsEpsilon(c.getRotation(n,k),d,o.EPSILON7)&&t.equals(c.getRow(n,3,g),nt))return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=0,r[11]=0,r[12]=-n[12],r[13]=-n[13],r[14]=-n[14],r[15]=1,r;throw new h("matrix is not invertible because its determinate is zero.");}return u=1/u,r[0]=gt*u,r[1]=ni*u,r[2]=ti*u,r[3]=ii*u,r[4]=ri*u,r[5]=ui*u,r[6]=fi*u,r[7]=ei*u,r[8]=oi*u,r[9]=si*u,r[10]=hi*u,r[11]=ci*u,r[12]=li*u,r[13]=ai*u,r[14]=vi*u,r[15]=yi*u,r},c.inverseTransformation=function(n,t){i.typeOf.object("matrix",n);i.typeOf.object("result",t);var e=n[0],o=n[1],s=n[2],h=n[4],c=n[5],l=n[6],a=n[8],v=n[9],y=n[10],r=n[12],u=n[13],f=n[14],p=-e*r-o*u-s*f,w=-h*r-c*u-l*f,b=-a*r-v*u-y*f;return t[0]=e,t[1]=h,t[2]=a,t[3]=0,t[4]=o,t[5]=c,t[6]=v,t[7]=0,t[8]=s,t[9]=l,t[10]=y,t[11]=0,t[12]=p,t[13]=w,t[14]=b,t[15]=1,t},c.IDENTITY=e(new c(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)),c.ZERO=e(new c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)),c.COLUMN0ROW0=0,c.COLUMN0ROW1=1,c.COLUMN0ROW2=2,c.COLUMN0ROW3=3,c.COLUMN1ROW0=4,c.COLUMN1ROW1=5,c.COLUMN1ROW2=6,c.COLUMN1ROW3=7,c.COLUMN2ROW0=8,c.COLUMN2ROW1=9,c.COLUMN2ROW2=10,c.COLUMN2ROW3=11,c.COLUMN3ROW0=12,c.COLUMN3ROW1=13,c.COLUMN3ROW2=14,c.COLUMN3ROW3=15,f(c.prototype,{length:{get:function(){return c.packedLength}}}),c.prototype.clone=function(n){return c.clone(this,n)},c.prototype.equals=function(n){return c.equals(this,n)},c.equalsArray=function(n,t,i){return n[0]===t[i]&&n[1]===t[i+1]&&n[2]===t[i+2]&&n[3]===t[i+3]&&n[4]===t[i+4]&&n[5]===t[i+5]&&n[6]===t[i+6]&&n[7]===t[i+7]&&n[8]===t[i+8]&&n[9]===t[i+9]&&n[10]===t[i+10]&&n[11]===t[i+11]&&n[12]===t[i+12]&&n[13]===t[i+13]&&n[14]===t[i+14]&&n[15]===t[i+15]},c.prototype.equalsEpsilon=function(n,t){return c.equalsEpsilon(this,n,t)},c.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"},c});t("Core/Rectangle",["./Cartographic","./Check","./defaultValue","./defined","./defineProperties","./Ellipsoid","./freezeObject","./Math"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,t,r,u){this.west=i(n,0);this.south=i(t,0);this.east=i(r,0);this.north=i(u,0)}u(s.prototype,{width:{get:function(){return s.computeWidth(this)}},height:{get:function(){return s.computeHeight(this)}}});s.packedLength=4;s.pack=function(n,r,u){return t.typeOf.object("value",n),t.defined("array",r),u=i(u,0),r[u++]=n.west,r[u++]=n.south,r[u++]=n.east,r[u]=n.north,r};s.unpack=function(n,u,f){return t.defined("array",n),u=i(u,0),r(f)||(f=new s),f.west=n[u++],f.south=n[u++],f.east=n[u++],f.north=n[u],f};s.computeWidth=function(n){t.typeOf.object("rectangle",n);var i=n.east,r=n.west;return i<r&&(i+=o.TWO_PI),i-r};s.computeHeight=function(n){return t.typeOf.object("rectangle",n),n.north-n.south};s.fromDegrees=function(n,t,u,f,e){return(n=o.toRadians(i(n,0)),t=o.toRadians(i(t,0)),u=o.toRadians(i(u,0)),f=o.toRadians(i(f,0)),!r(e))?new s(n,t,u,f):(e.west=n,e.south=t,e.east=u,e.north=f,e)};s.fromRadians=function(n,t,u,f,e){return r(e)?(e.west=i(n,0),e.south=i(t,0),e.east=i(u,0),e.north=i(f,0),e):new s(n,t,u,f)};s.fromCartographicArray=function(n,i){var v,p,e,y;t.defined("cartographics",n);var u=Number.MAX_VALUE,f=-Number.MAX_VALUE,h=Number.MAX_VALUE,c=-Number.MAX_VALUE,l=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(v=0,p=n.length;v<p;v++)e=n[v],u=Math.min(u,e.longitude),f=Math.max(f,e.longitude),l=Math.min(l,e.latitude),a=Math.max(a,e.latitude),y=e.longitude>=0?e.longitude:e.longitude+o.TWO_PI,h=Math.min(h,y),c=Math.max(c,y);return(f-u>c-h&&(u=h,f=c,f>o.PI&&(f=f-o.TWO_PI),u>o.PI&&(u=u-o.TWO_PI)),!r(i))?new s(u,l,f,a):(i.west=u,i.south=l,i.east=f,i.north=a,i)};s.fromCartesianArray=function(n,u,e){var w,k,l,b;t.defined("cartesians",n);u=i(u,f.WGS84);var h=Number.MAX_VALUE,c=-Number.MAX_VALUE,a=Number.MAX_VALUE,v=-Number.MAX_VALUE,y=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(w=0,k=n.length;w<k;w++)l=u.cartesianToCartographic(n[w]),h=Math.min(h,l.longitude),c=Math.max(c,l.longitude),y=Math.min(y,l.latitude),p=Math.max(p,l.latitude),b=l.longitude>=0?l.longitude:l.longitude+o.TWO_PI,a=Math.min(a,b),v=Math.max(v,b);return(c-h>v-a&&(h=a,c=v,c>o.PI&&(c=c-o.TWO_PI),h>o.PI&&(h=h-o.TWO_PI)),!r(e))?new s(h,y,c,p):(e.west=h,e.south=y,e.east=c,e.north=p,e)};s.clone=function(n,t){return r(n)?r(t)?(t.west=n.west,t.south=n.south,t.east=n.east,t.north=n.north,t):new s(n.west,n.south,n.east,n.north):undefined};s.equalsEpsilon=function(n,i,u){return t.typeOf.number("absoluteEpsilon",u),n===i||r(n)&&r(i)&&Math.abs(n.west-i.west)<=u&&Math.abs(n.south-i.south)<=u&&Math.abs(n.east-i.east)<=u&&Math.abs(n.north-i.north)<=u};s.prototype.clone=function(n){return s.clone(this,n)};s.prototype.equals=function(n){return s.equals(this,n)};s.equals=function(n,t){return n===t||r(n)&&r(t)&&n.west===t.west&&n.south===t.south&&n.east===t.east&&n.north===t.north};s.prototype.equalsEpsilon=function(n,i){return t.typeOf.number("epsilon",i),s.equalsEpsilon(this,n,i)};s.validate=function(n){var i,r,u,f;t.typeOf.object("rectangle",n);i=n.north;t.typeOf.number.greaterThanOrEquals("north",i,-o.PI_OVER_TWO);t.typeOf.number.lessThanOrEquals("north",i,o.PI_OVER_TWO);r=n.south;t.typeOf.number.greaterThanOrEquals("south",r,-o.PI_OVER_TWO);t.typeOf.number.lessThanOrEquals("south",r,o.PI_OVER_TWO);u=n.west;t.typeOf.number.greaterThanOrEquals("west",u,-Math.PI);t.typeOf.number.lessThanOrEquals("west",u,Math.PI);f=n.east;t.typeOf.number.greaterThanOrEquals("east",f,-Math.PI);t.typeOf.number.lessThanOrEquals("east",f,Math.PI)};s.southwest=function(i,u){return(t.typeOf.object("rectangle",i),!r(u))?new n(i.west,i.south):(u.longitude=i.west,u.latitude=i.south,u.height=0,u)};s.northwest=function(i,u){return(t.typeOf.object("rectangle",i),!r(u))?new n(i.west,i.north):(u.longitude=i.west,u.latitude=i.north,u.height=0,u)};s.northeast=function(i,u){return(t.typeOf.object("rectangle",i),!r(u))?new n(i.east,i.north):(u.longitude=i.east,u.latitude=i.north,u.height=0,u)};s.southeast=function(i,u){return(t.typeOf.object("rectangle",i),!r(u))?new n(i.east,i.south):(u.longitude=i.east,u.latitude=i.south,u.height=0,u)};s.center=function(i,u){var f,e,s,h;return(t.typeOf.object("rectangle",i),f=i.east,e=i.west,f<e&&(f+=o.TWO_PI),s=o.negativePiToPi((e+f)*.5),h=(i.south+i.north)*.5,!r(u))?new n(s,h):(u.longitude=s,u.latitude=h,u.height=0,u)};s.intersection=function(n,i,u){var l,a,v,y;t.typeOf.object("rectangle",n);t.typeOf.object("otherRectangle",i);var f=n.east,e=n.west,h=i.east,c=i.west;return(f<e&&h>0?f+=o.TWO_PI:h<c&&f>0&&(h+=o.TWO_PI),f<e&&c<0?c+=o.TWO_PI:h<c&&e<0&&(e+=o.TWO_PI),l=o.negativePiToPi(Math.max(e,c)),a=o.negativePiToPi(Math.min(f,h)),(n.west<n.east||i.west<i.east)&&a<=l)?undefined:(v=Math.max(n.south,i.south),y=Math.min(n.north,i.north),v>=y)?undefined:r(u)?(u.west=l,u.south=v,u.east=a,u.north=y,u):new s(l,v,a,y)};s.simpleIntersection=function(n,i,u){t.typeOf.object("rectangle",n);t.typeOf.object("otherRectangle",i);var f=Math.max(n.west,i.west),e=Math.max(n.south,i.south),o=Math.min(n.east,i.east),h=Math.min(n.north,i.north);return e>=h||f>=o?undefined:r(u)?(u.west=f,u.south=e,u.east=o,u.north=h,u):new s(f,e,o,h)};s.union=function(n,i,u){var l,a;t.typeOf.object("rectangle",n);t.typeOf.object("otherRectangle",i);r(u)||(u=new s);var f=n.east,e=n.west,h=i.east,c=i.west;return f<e&&h>0?f+=o.TWO_PI:h<c&&f>0&&(h+=o.TWO_PI),f<e&&c<0?c+=o.TWO_PI:h<c&&e<0&&(e+=o.TWO_PI),l=o.convertLongitudeRange(Math.min(e,c)),a=o.convertLongitudeRange(Math.max(f,h)),u.west=l,u.south=Math.min(n.south,i.south),u.east=a,u.north=Math.max(n.north,i.north),u};s.expand=function(n,i,u){return t.typeOf.object("rectangle",n),t.typeOf.object("cartographic",i),r(u)||(u=new s),u.west=Math.min(n.west,i.longitude),u.south=Math.min(n.south,i.latitude),u.east=Math.max(n.east,i.longitude),u.north=Math.max(n.north,i.latitude),u};s.contains=function(n,i){t.typeOf.object("rectangle",n);t.typeOf.object("cartographic",i);var r=i.longitude,e=i.latitude,f=n.west,u=n.east;return u<f&&(u+=o.TWO_PI,r<0&&(r+=o.TWO_PI)),(r>f||o.equalsEpsilon(r,f,o.EPSILON14))&&(r<u||o.equalsEpsilon(r,u,o.EPSILON14))&&e>=n.south&&e<=n.north};var h=new n;return s.subsample=function(n,u,e,c){var v;t.typeOf.object("rectangle",n);u=i(u,f.WGS84);e=i(e,0);r(c)||(c=[]);var l=0,y=n.north,p=n.south,b=n.east,w=n.west,a=h;for(a.height=e,a.longitude=w,a.latitude=y,c[l]=u.cartographicToCartesian(a,c[l]),l++,a.longitude=b,c[l]=u.cartographicToCartesian(a,c[l]),l++,a.latitude=p,c[l]=u.cartographicToCartesian(a,c[l]),l++,a.longitude=w,c[l]=u.cartographicToCartesian(a,c[l]),l++,a.latitude=y<0?y:p>0?p:0,v=1;v<8;++v)a.longitude=-Math.PI+v*o.PI_OVER_TWO,s.contains(n,a)&&(c[l]=u.cartographicToCartesian(a,c[l]),l++);return a.latitude===0&&(a.longitude=w,c[l]=u.cartographicToCartesian(a,c[l]),l++,a.longitude=b,c[l]=u.cartographicToCartesian(a,c[l]),l++),c.length=l,c},s.MAX_VALUE=e(new s(-Math.PI,-o.PI_OVER_TWO,Math.PI,o.PI_OVER_TWO)),s});t("Core/BoundingSphere",["./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./Ellipsoid","./GeographicProjection","./Intersect","./Interval","./Math","./Matrix3","./Matrix4","./Rectangle"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(t,i){this.center=n.clone(r(t,n.ZERO));this.radius=r(i,0)}var w=new n,b=new n,k=new n,d=new n,g=new n,nt=new n,tt=new n,y=new n,it=new n,rt=new n,ut=new n,ft=new n,bt=4/3*h.PI,st,ht,ct,lt,at,vt,yt,p,wt;v.fromPoints=function(t,i){var f,ht,pt,ct,wt,bt,h,vt;if(u(i)||(i=new v),!u(t)||t.length===0)return i.center=n.clone(n.ZERO,i.center),i.radius=0,i;for(var r=n.clone(t[0],tt),c=n.clone(r,w),l=n.clone(r,b),a=n.clone(r,k),p=n.clone(r,d),et=n.clone(r,g),ot=n.clone(r,nt),kt=t.length,o=1;o<kt;o++){n.clone(t[o],r);var dt=r.x,gt=r.y,ni=r.z;dt<c.x&&n.clone(r,c);dt>p.x&&n.clone(r,p);gt<l.y&&n.clone(r,l);gt>et.y&&n.clone(r,et);ni<a.z&&n.clone(r,a);ni>ot.z&&n.clone(r,ot)}var ri=n.magnitudeSquared(n.subtract(p,c,y)),ti=n.magnitudeSquared(n.subtract(et,l,y)),ii=n.magnitudeSquared(n.subtract(ot,a,y)),st=c,s=p,lt=ri;ti>lt&&(lt=ti,st=l,s=et);ii>lt&&(lt=ii,st=a,s=ot);f=it;f.x=(st.x+s.x)*.5;f.y=(st.y+s.y)*.5;f.z=(st.z+s.z)*.5;var yt=n.magnitudeSquared(n.subtract(s,f,y)),e=Math.sqrt(yt),at=rt;for(at.x=c.x,at.y=l.y,at.z=a.z,ht=ut,ht.x=p.x,ht.y=et.y,ht.z=ot.z,pt=n.midpoint(at,ht,ft),ct=0,o=0;o<kt;o++)n.clone(t[o],r),wt=n.magnitude(n.subtract(r,pt,y)),wt>ct&&(ct=wt),bt=n.magnitudeSquared(n.subtract(r,f,y)),bt>yt&&(h=Math.sqrt(bt),e=(e+h)*.5,yt=e*e,vt=h-e,f.x=(e*f.x+vt*r.x)/h,f.y=(e*f.y+vt*r.y)/h,f.z=(e*f.z+vt*r.z)/h);return e<ct?(n.clone(f,i.center),i.radius=e):(n.clone(pt,i.center),i.radius=ct),i};var kt=new e,dt=new n,gt=new n,et=new t,ot=new t;v.fromRectangle2D=function(n,t,i){return v.fromRectangleWithHeights2D(n,t,0,0,i)};v.fromRectangleWithHeights2D=function(t,i,f,e,o){var h;if(u(o)||(o=new v),!u(t))return o.center=n.clone(n.ZERO,o.center),o.radius=0,o;i=r(i,kt);a.southwest(t,et);et.height=f;a.northeast(t,ot);ot.height=e;var s=i.project(et,dt),c=i.project(ot,gt),l=c.x-s.x,y=c.y-s.y,p=c.z-s.z;return o.radius=Math.sqrt(l*l+y*y+p*p)*.5,h=o.center,h.x=s.x+l*.5,h.y=s.y+y*.5,h.z=s.z+p*.5,o};st=[];v.fromRectangle3D=function(t,i,e,o){if(i=r(i,f.WGS84),e=r(e,0),u(o)||(o=new v),!u(t))return o.center=n.clone(n.ZERO,o.center),o.radius=0,o;var s=a.subsample(t,i,e,st);return v.fromPoints(s,o)};v.fromVertices=function(t,f,e,o){var s,h,vt,ti,yt,ii,ri,p,bt;if(u(o)||(o=new v),!u(t)||t.length===0)return o.center=n.clone(n.ZERO,o.center),o.radius=0,o;f=r(f,n.ZERO);e=r(e,3);i.typeOf.number.greaterThanOrEquals("stride",e,3);s=tt;s.x=t[0]+f.x;s.y=t[1]+f.y;s.z=t[2]+f.z;for(var et=n.clone(s,w),ot=n.clone(s,b),st=n.clone(s,k),ht=n.clone(s,d),ct=n.clone(s,g),lt=n.clone(s,nt),ui=t.length,c=0;c<ui;c+=e){var kt=t[c]+f.x,dt=t[c+1]+f.y,gt=t[c+2]+f.z;s.x=kt;s.y=dt;s.z=gt;kt<et.x&&n.clone(s,et);kt>ht.x&&n.clone(s,ht);dt<ot.y&&n.clone(s,ot);dt>ct.y&&n.clone(s,ct);gt<st.z&&n.clone(s,st);gt>lt.z&&n.clone(s,lt)}var oi=n.magnitudeSquared(n.subtract(ht,et,y)),fi=n.magnitudeSquared(n.subtract(ct,ot,y)),ei=n.magnitudeSquared(n.subtract(lt,st,y)),at=et,a=ht,pt=oi;fi>pt&&(pt=fi,at=ot,a=ct);ei>pt&&(pt=ei,at=st,a=lt);h=it;h.x=(at.x+a.x)*.5;h.y=(at.y+a.y)*.5;h.z=(at.z+a.z)*.5;var ni=n.magnitudeSquared(n.subtract(a,h,y)),l=Math.sqrt(ni),wt=rt;for(wt.x=et.x,wt.y=ot.y,wt.z=st.z,vt=ut,vt.x=ht.x,vt.y=ct.y,vt.z=lt.z,ti=n.midpoint(wt,vt,ft),yt=0,c=0;c<ui;c+=e)s.x=t[c]+f.x,s.y=t[c+1]+f.y,s.z=t[c+2]+f.z,ii=n.magnitude(n.subtract(s,ti,y)),ii>yt&&(yt=ii),ri=n.magnitudeSquared(n.subtract(s,h,y)),ri>ni&&(p=Math.sqrt(ri),l=(l+p)*.5,ni=l*l,bt=p-l,h.x=(l*h.x+bt*s.x)/p,h.y=(l*h.y+bt*s.y)/p,h.z=(l*h.z+bt*s.z)/p);return l<yt?(n.clone(h,o.center),o.radius=l):(n.clone(ti,o.center),o.radius=yt),o};v.fromEncodedCartesianVertices=function(t,i,r){var f,o,ct,dt,lt,gt,ni,c,yt;if(u(r)||(r=new v),!u(t)||!u(i)||t.length!==i.length||t.length===0)return r.center=n.clone(n.ZERO,r.center),r.radius=0,r;f=tt;f.x=t[0]+i[0];f.y=t[1]+i[1];f.z=t[2]+i[2];for(var l=n.clone(f,w),a=n.clone(f,b),p=n.clone(f,k),et=n.clone(f,d),ot=n.clone(f,g),st=n.clone(f,nt),ti=t.length,e=0;e<ti;e+=3){var pt=t[e]+i[e],wt=t[e+1]+i[e+1],bt=t[e+2]+i[e+2];f.x=pt;f.y=wt;f.z=bt;pt<l.x&&n.clone(f,l);pt>et.x&&n.clone(f,et);wt<a.y&&n.clone(f,a);wt>ot.y&&n.clone(f,ot);bt<p.z&&n.clone(f,p);bt>st.z&&n.clone(f,st)}var ui=n.magnitudeSquared(n.subtract(et,l,y)),ii=n.magnitudeSquared(n.subtract(ot,a,y)),ri=n.magnitudeSquared(n.subtract(st,p,y)),ht=l,h=et,at=ui;ii>at&&(at=ii,ht=a,h=ot);ri>at&&(at=ri,ht=p,h=st);o=it;o.x=(ht.x+h.x)*.5;o.y=(ht.y+h.y)*.5;o.z=(ht.z+h.z)*.5;var kt=n.magnitudeSquared(n.subtract(h,o,y)),s=Math.sqrt(kt),vt=rt;for(vt.x=l.x,vt.y=a.y,vt.z=p.z,ct=ut,ct.x=et.x,ct.y=ot.y,ct.z=st.z,dt=n.midpoint(vt,ct,ft),lt=0,e=0;e<ti;e+=3)f.x=t[e]+i[e],f.y=t[e+1]+i[e+1],f.z=t[e+2]+i[e+2],gt=n.magnitude(n.subtract(f,dt,y)),gt>lt&&(lt=gt),ni=n.magnitudeSquared(n.subtract(f,o,y)),ni>kt&&(c=Math.sqrt(ni),s=(s+c)*.5,kt=s*s,yt=c-s,o.x=(s*o.x+yt*f.x)/c,o.y=(s*o.y+yt*f.y)/c,o.z=(s*o.z+yt*f.z)/c);return s<lt?(n.clone(o,r.center),r.radius=s):(n.clone(dt,r.center),r.radius=lt),r};v.fromCornerPoints=function(t,r,f){i.typeOf.object("corner",t);i.typeOf.object("oppositeCorner",r);u(f)||(f=new v);var e=n.midpoint(t,r,f.center);return f.radius=n.distance(e,r),f};v.fromEllipsoid=function(t,r){return i.typeOf.object("ellipsoid",t),u(r)||(r=new v),n.clone(n.ZERO,r.center),r.radius=t.maximumRadius,r};ht=new n;v.fromBoundingSpheres=function(t,i){var f,o,r,h,e,s;if(u(i)||(i=new v),!u(t)||t.length===0)return i.center=n.clone(n.ZERO,i.center),i.radius=0,i;if(f=t.length,f===1)return v.clone(t[0],i);if(f===2)return v.union(t[0],t[1],i);for(o=[],r=0;r<f;r++)o.push(t[r].center);for(i=v.fromPoints(o,i),h=i.center,e=i.radius,r=0;r<f;r++)s=t[r],e=Math.max(e,n.distance(h,s.center,ht)+s.radius);return i.radius=e,i};var ni=new n,ti=new n,ii=new n;v.fromOrientedBoundingBox=function(t,r){i.defined("orientedBoundingBox",t);u(r)||(r=new v);var e=t.halfAxes,f=c.getColumn(e,0,ni),o=c.getColumn(e,1,ti),s=c.getColumn(e,2,ii);return n.add(f,o,f),n.add(f,s,f),r.center=n.clone(t.center,r.center),r.radius=n.magnitude(f),r};v.clone=function(t,i){return u(t)?u(i)?(i.center=n.clone(t.center,i.center),i.radius=t.radius,i):new v(t.center,t.radius):undefined};v.packedLength=4;v.pack=function(n,t,u){i.typeOf.object("value",n);i.defined("array",t);u=r(u,0);var f=n.center;return t[u++]=f.x,t[u++]=f.y,t[u++]=f.z,t[u]=n.radius,t};v.unpack=function(n,t,f){i.defined("array",n);t=r(t,0);u(f)||(f=new v);var e=f.center;return e.x=n[t++],e.y=n[t++],e.z=n[t++],f.radius=n[t],f};ct=new n;lt=new n;v.union=function(t,r,f){var c,s;i.typeOf.object("left",t);i.typeOf.object("right",r);u(f)||(f=new v);var l=t.center,e=t.radius,y=r.center,h=r.radius,a=n.subtract(y,l,ct),o=n.magnitude(a);return e>=o+h?(t.clone(f),f):h>=o+e?(r.clone(f),f):(c=(e+o+h)*.5,s=n.multiplyByScalar(a,(-e+c)/o,lt),n.add(s,l,s),n.clone(s,f.center),f.radius=c,f)};at=new n;v.expand=function(t,r,u){i.typeOf.object("sphere",t);i.typeOf.object("point",r);u=v.clone(t,u);var f=n.magnitude(n.subtract(r,u.center,at));return f>u.radius&&(u.radius=f),u};v.intersectPlane=function(t,r){i.typeOf.object("sphere",t);i.typeOf.object("plane",r);var e=t.center,u=t.radius,s=r.normal,f=n.dot(s,e)+r.distance;return f<-u?o.OUTSIDE:f<u?o.INTERSECTING:o.INSIDE};v.transform=function(n,t,r){return i.typeOf.object("sphere",n),i.typeOf.object("transform",t),u(r)||(r=new v),r.center=l.multiplyByPoint(t,n.center,r.center),r.radius=l.getMaximumScale(t)*n.radius,r};vt=new n;v.distanceSquaredTo=function(t,r){i.typeOf.object("sphere",t);i.typeOf.object("cartesian",r);var u=n.subtract(t.center,r,vt);return n.magnitudeSquared(u)-t.radius*t.radius};v.transformWithoutScale=function(n,t,r){return i.typeOf.object("sphere",n),i.typeOf.object("transform",t),u(r)||(r=new v),r.center=l.multiplyByPoint(t,n.center,r.center),r.radius=n.radius,r};yt=new n;v.computePlaneDistances=function(t,r,f,e){i.typeOf.object("sphere",t);i.typeOf.object("position",r);i.typeOf.object("direction",f);u(e)||(e=new s);var h=n.subtract(t.center,r,yt),o=n.dot(f,h);return e.start=o-t.radius,e.stop=o+t.radius,e};var ri=new n,ui=new n,fi=new n,ei=new n,oi=new n,si=new t,pt=new Array(8);for(p=0;p<8;++p)pt[p]=new n;return wt=new e,v.projectTo2D=function(t,u,f){var c,d,w,a,g;i.typeOf.object("sphere",t);u=r(u,wt);var k=u.ellipsoid,l=t.center,b=t.radius,o=k.geodeticSurfaceNormal(l,ri),h=n.cross(n.UNIT_Z,o,ui);n.normalize(h,h);c=n.cross(o,h,fi);n.normalize(c,c);n.multiplyByScalar(o,b,o);n.multiplyByScalar(c,b,c);n.multiplyByScalar(h,b,h);var y=n.negate(c,oi),p=n.negate(h,ei),s=pt,e=s[0];for(n.add(o,c,e),n.add(e,h,e),e=s[1],n.add(o,c,e),n.add(e,p,e),e=s[2],n.add(o,y,e),n.add(e,p,e),e=s[3],n.add(o,y,e),n.add(e,h,e),n.negate(o,o),e=s[4],n.add(o,c,e),n.add(e,h,e),e=s[5],n.add(o,c,e),n.add(e,p,e),e=s[6],n.add(o,y,e),n.add(e,p,e),e=s[7],n.add(o,y,e),n.add(e,h,e),d=s.length,w=0;w<d;++w)a=s[w],n.add(l,a,a),g=k.cartesianToCartographic(a,si),u.project(g,a);f=v.fromPoints(s,f);l=f.center;var nt=l.x,tt=l.y,it=l.z;return l.x=it,l.y=nt,l.z=tt,f},v.isOccluded=function(n,t){return i.typeOf.object("sphere",n),i.typeOf.object("occluder",t),!t.isBoundingSphereVisible(n)},v.equals=function(t,i){return t===i||u(t)&&u(i)&&n.equals(t.center,i.center)&&t.radius===i.radius},v.prototype.intersectPlane=function(n){return v.intersectPlane(this,n)},v.prototype.distanceSquaredTo=function(n){return v.distanceSquaredTo(this,n)},v.prototype.computePlaneDistances=function(n,t,i){return v.computePlaneDistances(this,n,t,i)},v.prototype.isOccluded=function(n){return v.isOccluded(this,n)},v.prototype.equals=function(n){return v.equals(this,n)},v.prototype.clone=function(n){return v.clone(this,n)},v.prototype.volume=function(){var n=this.radius;return bt*n*n*n},v});t("Core/Cartesian2",["./Check","./defaultValue","./defined","./DeveloperError","./freezeObject","./Math"],function(n,t,i,r,u,f){"use strict";function e(n,i){this.x=t(n,0);this.y=t(i,0)}var o,s,h,c,l;return e.fromElements=function(n,t,r){return i(r)?(r.x=n,r.y=t,r):new e(n,t)},e.clone=function(n,t){return i(n)?i(t)?(t.x=n.x,t.y=n.y,t):new e(n.x,n.y):undefined},e.fromCartesian3=e.clone,e.fromCartesian4=e.clone,e.packedLength=2,e.pack=function(i,r,u){return n.typeOf.object("value",i),n.defined("array",r),u=t(u,0),r[u++]=i.x,r[u]=i.y,r},e.unpack=function(r,u,f){return n.defined("array",r),u=t(u,0),i(f)||(f=new e),f.x=r[u++],f.y=r[u],f},e.packArray=function(t,r){var f,u;for(n.defined("array",t),f=t.length,i(r)?r.length=f*2:r=new Array(f*2),u=0;u<f;++u)e.pack(t[u],r,u*2);return r},e.unpackArray=function(t,r){var f,u,o;for(n.defined("array",t),f=t.length,i(r)?r.length=f/2:r=new Array(f/2),u=0;u<f;u+=2)o=u/2,r[o]=e.unpack(t,u,r[o]);return r},e.fromArray=e.unpack,e.maximumComponent=function(t){return n.typeOf.object("cartesian",t),Math.max(t.x,t.y)},e.minimumComponent=function(t){return n.typeOf.object("cartesian",t),Math.min(t.x,t.y)},e.minimumByComponent=function(t,i,r){return n.typeOf.object("first",t),n.typeOf.object("second",i),n.typeOf.object("result",r),r.x=Math.min(t.x,i.x),r.y=Math.min(t.y,i.y),r},e.maximumByComponent=function(t,i,r){return n.typeOf.object("first",t),n.typeOf.object("second",i),n.typeOf.object("result",r),r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r},e.magnitudeSquared=function(t){return n.typeOf.object("cartesian",t),t.x*t.x+t.y*t.y},e.magnitude=function(n){return Math.sqrt(e.magnitudeSquared(n))},o=new e,e.distance=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.subtract(t,i,o),e.magnitude(o)},e.distanceSquared=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.subtract(t,i,o),e.magnitudeSquared(o)},e.normalize=function(t,i){n.typeOf.object("cartesian",t);n.typeOf.object("result",i);var u=e.magnitude(t);if(i.x=t.x/u,i.y=t.y/u,isNaN(i.x)||isNaN(i.y))throw new r("normalized result is not a number");return i},e.dot=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),t.x*i.x+t.y*i.y},e.multiplyComponents=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x*i.x,r.y=t.y*i.y,r},e.divideComponents=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x/i.x,r.y=t.y/i.y,r},e.add=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x+i.x,r.y=t.y+i.y,r},e.subtract=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.x=t.x-i.x,r.y=t.y-i.y,r},e.multiplyByScalar=function(t,i,r){return n.typeOf.object("cartesian",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.x=t.x*i,r.y=t.y*i,r},e.divideByScalar=function(t,i,r){return n.typeOf.object("cartesian",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.x=t.x/i,r.y=t.y/i,r},e.negate=function(t,i){return n.typeOf.object("cartesian",t),n.typeOf.object("result",i),i.x=-t.x,i.y=-t.y,i},e.abs=function(t,i){return n.typeOf.object("cartesian",t),n.typeOf.object("result",i),i.x=Math.abs(t.x),i.y=Math.abs(t.y),i},s=new e,e.lerp=function(t,i,r,u){return n.typeOf.object("start",t),n.typeOf.object("end",i),n.typeOf.number("t",r),n.typeOf.object("result",u),e.multiplyByScalar(i,r,s),u=e.multiplyByScalar(t,1-r,u),e.add(s,u,u)},h=new e,c=new e,e.angleBetween=function(t,i){return n.typeOf.object("left",t),n.typeOf.object("right",i),e.normalize(t,h),e.normalize(i,c),f.acosClamped(e.dot(h,c))},l=new e,e.mostOrthogonalAxis=function(t,i){n.typeOf.object("cartesian",t);n.typeOf.object("result",i);var r=e.normalize(t,l);return e.abs(r,r),r.x<=r.y?e.clone(e.UNIT_X,i):e.clone(e.UNIT_Y,i)},e.equals=function(n,t){return n===t||i(n)&&i(t)&&n.x===t.x&&n.y===t.y},e.equalsArray=function(n,t,i){return n.x===t[i]&&n.y===t[i+1]},e.equalsEpsilon=function(n,t,r,u){return n===t||i(n)&&i(t)&&f.equalsEpsilon(n.x,t.x,r,u)&&f.equalsEpsilon(n.y,t.y,r,u)},e.ZERO=u(new e(0,0)),e.UNIT_X=u(new e(1,0)),e.UNIT_Y=u(new e(0,1)),e.prototype.clone=function(n){return e.clone(this,n)},e.prototype.equals=function(n){return e.equals(this,n)},e.prototype.equalsEpsilon=function(n,t,i){return e.equalsEpsilon(this,n,t,i)},e.prototype.toString=function(){return"("+this.x+", "+this.y+")"},e});t("Core/GeographicTilingScheme",["./Cartesian2","./Check","./defaultValue","./defined","./defineProperties","./Ellipsoid","./GeographicProjection","./Math","./Rectangle"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(n){n=i(n,{});this._ellipsoid=i(n.ellipsoid,f.WGS84);this._rectangle=i(n.rectangle,s.MAX_VALUE);this._projection=new e(this._ellipsoid);this._numberOfLevelZeroTilesX=i(n.numberOfLevelZeroTilesX,2);this._numberOfLevelZeroTilesY=i(n.numberOfLevelZeroTilesY,1)}return u(h.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),h.prototype.getNumberOfXTilesAtLevel=function(n){return this._numberOfLevelZeroTilesX<<n},h.prototype.getNumberOfYTilesAtLevel=function(n){return this._numberOfLevelZeroTilesY<<n},h.prototype.rectangleToNativeRectangle=function(n,i){t.defined("rectangle",n);var u=o.toDegrees(n.west),f=o.toDegrees(n.south),e=o.toDegrees(n.east),h=o.toDegrees(n.north);return r(i)?(i.west=u,i.south=f,i.east=e,i.north=h,i):new s(u,f,e,h)},h.prototype.tileXYToNativeRectangle=function(n,t,i,r){var u=this.tileXYToRectangle(n,t,i,r);return u.west=o.toDegrees(u.west),u.south=o.toDegrees(u.south),u.east=o.toDegrees(u.east),u.north=o.toDegrees(u.north),u},h.prototype.tileXYToRectangle=function(n,t,i,u){var f=this._rectangle,v=this.getNumberOfXTilesAtLevel(i),y=this.getNumberOfYTilesAtLevel(i),e=f.width/v,o=n*e+f.west,h=(n+1)*e+f.west,c=f.height/y,l=f.north-t*c,a=f.north-(t+1)*c;return r(u)||(u=new s(o,a,h,l)),u.west=o,u.south=a,u.east=h,u.north=l,u},h.prototype.positionToTileXY=function(t,i,u){var f=this._rectangle,e,h;if(!s.contains(f,t))return undefined;var c=this.getNumberOfXTilesAtLevel(i),l=this.getNumberOfYTilesAtLevel(i),v=f.width/c,y=f.height/l,a=t.longitude;return(f.east<f.west&&(a+=o.TWO_PI),e=(a-f.west)/v|0,e>=c&&(e=c-1),h=(f.north-t.latitude)/y|0,h>=l&&(h=l-1),!r(u))?new n(e,h):(u.x=e,u.y=h,u)},h});t("Core/ApproximateTerrainHeights",["./buildModuleUrl","./defaultValue","./defined","./defineProperties","./BoundingSphere","./Cartesian2","./Cartesian3","./Cartographic","./Check","./DeveloperError","./Ellipsoid","./GeographicTilingScheme","./Rectangle","./Resource"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function tt(n){var e,i,c;o.fromRadians(n.east,n.north,0,p[0]);o.fromRadians(n.west,n.north,0,p[1]);o.fromRadians(n.east,n.south,0,p[2]);o.fromRadians(n.west,n.south,0,p[3]);for(var s=0,h=0,r=0,u=0,f=y._terrainHeightsMaxLevel,t=0;t<=f;++t){for(e=!1,i=0;i<4;++i)if(c=p[i],rt.positionToTileXY(c,t,w),i===0)r=w.x,u=w.y;else if(r!==w.x||u!==w.y){e=!0;break}if(e)break;s=r;h=u}return t===0?undefined:{x:s,y:h,level:t>f?f:t-1}}var k=new e,d=new e,g=new o,b=new e,it=new e,nt=new u,rt=new l,p=[new o,new o,new o,new o],w=new f,y={};return y.initialize=function(){var t=y._initPromise;return i(t)?t:(t=v.fetchJson(n("Assets/approximateTerrainHeights.json")).then(function(n){y._terrainHeights=n}),y._initPromise=t,t)},y.getApproximateTerrainHeights=function(n,r){var p,o,l,w;if(s.defined("rectangle",n),!i(y._terrainHeights))throw new h("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");r=t(r,c.WGS84);var f=tt(n),u=y._defaultMinTerrainHeight,v=y._defaultMaxTerrainHeight;return i(f)&&(p=f.level+"-"+f.x+"-"+f.y,o=y._terrainHeights[p],i(o)&&(u=o[0],v=o[1]),r.cartographicToCartesian(a.northeast(n,g),k),r.cartographicToCartesian(a.southwest(n,g),d),e.midpoint(d,k,b),l=r.scaleToGeodeticSurface(b,it),i(l)?(w=e.distance(b,l),u=Math.min(u,-w)):u=y._defaultMinTerrainHeight),u=Math.max(y._defaultMinTerrainHeight,u),{minimumTerrainHeight:u,maximumTerrainHeight:v}},y.getInstanceBoundingSphere=function(n,r){var f,e,a,o,l;if(s.defined("rectangle",n),!i(y._terrainHeights))throw new h("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");return r=t(r,c.WGS84),f=tt(n),e=y._defaultMaxTerrainHeight,i(f)&&(a=f.level+"-"+f.x+"-"+f.y,o=y._terrainHeights[a],i(o)&&(e=o[1])),l=u.fromRectangle3D(n,r,0),u.fromRectangle3D(n,r,e,nt),u.union(l,nt,l)},y._terrainHeightsMaxLevel=6,y._defaultMaxTerrainHeight=9e3,y._defaultMinTerrainHeight=-1e5,y._terrainHeights=undefined,y._initPromise=undefined,r(y,{initialized:{get:function(){return i(y._terrainHeights)}}}),y});t("Core/arrayFill",["./Check","./defaultValue","./defined"],function(n,t,i){"use strict";function r(r,u,f,e){if(n.defined("array",r),n.defined("value",u),i(f)&&n.typeOf.number("start",f),i(e)&&n.typeOf.number("end",e),typeof r.fill=="function")return r.fill(u,f,e);for(var o=r.length>>>0,s=t(f,0),h=s<0?Math.max(o+s,0):Math.min(s,o),c=t(e,o),l=c<0?Math.max(o+c,0):Math.min(c,o);h<l;)r[h]=u,h++;return r}return r});t("Core/arrayRemoveDuplicates",["./Check","./defaultValue","./defined","./Math"],function(n,t,i,r){"use strict";function f(r,f,e){var c,o,l,h,s;if(n.defined("equalsEpsilon",f),!i(r))return undefined;if(e=t(e,!1),c=r.length,c<2)return r;for(o=1;o<c;++o)if(l=r[o-1],h=r[o],f(l,h,u))break;if(o===c)return e&&f(r[0],r[r.length-1],u)?r.slice(1):r;for(s=r.slice(0,o);o<c;++o)h=r[o],f(l,h,u)||(s.push(h),l=h);return e&&s.length>1&&f(s[0],s[s.length-1],u)&&s.shift(),s}var u=r.EPSILON10;return f});t("Core/arraySlice",["./Check","./defined","./FeatureDetection"],function(n,t,i){"use strict";function r(r,u,f){var e;if(n.defined("array",r),t(u)&&n.typeOf.number("begin",u),t(f)&&n.typeOf.number("end",f),typeof r.slice=="function")return r.slice(u,f);var o=Array.prototype.slice.call(r,u,f),s=i.typedArrayTypes,h=s.length;for(e=0;e<h;++e)if(r instanceof s[e]){o=new s[e](o);break}return o}return r});t("Core/AssociativeArray",["./defined","./defineProperties","./DeveloperError"],function(n,t,i){"use strict";function r(){this._array=[];this._hash={}}return t(r.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}}),r.prototype.contains=function(t){if(typeof t!="string"&&typeof t!="number")throw new i("key is required to be a string or number.");return n(this._hash[t])},r.prototype.set=function(n,t){if(typeof n!="string"&&typeof n!="number")throw new i("key is required to be a string or number.");var r=this._hash[n];t!==r&&(this.remove(n),this._hash[n]=t,this._array.push(t))},r.prototype.get=function(n){if(typeof n!="string"&&typeof n!="number")throw new i("key is required to be a string or number.");return this._hash[n]},r.prototype.remove=function(t){var r,u,f;if(n(t)&&typeof t!="string"&&typeof t!="number")throw new i("key is required to be a string or number.");return r=this._hash[t],u=n(r),u&&(f=this._array,f.splice(f.indexOf(r),1),delete this._hash[t]),u},r.prototype.removeAll=function(){var n=this._array;n.length>0&&(this._hash={},n.length=0)},r});t("Core/AttributeCompression",["./Cartesian2","./Cartesian3","./Check","./defined","./DeveloperError","./Math"],function(n,t,i,r,u,f){"use strict";function s(n){return c[0]=n,c[0]}function l(n){return n>>1^-(n&1)}var a=1/256,v=256,e={},o,c,h;return e.octEncodeInRange=function(n,r,e){var h,o,s;if(i.defined("vector",n),i.defined("result",e),h=t.magnitudeSquared(n),Math.abs(h-1)>f.EPSILON6)throw new u("vector must be normalized.");return e.x=n.x/(Math.abs(n.x)+Math.abs(n.y)+Math.abs(n.z)),e.y=n.y/(Math.abs(n.x)+Math.abs(n.y)+Math.abs(n.z)),n.z<0&&(o=e.x,s=e.y,e.x=(1-Math.abs(s))*f.signNotZero(o),e.y=(1-Math.abs(o))*f.signNotZero(s)),e.x=f.toSNorm(e.x,r),e.y=f.toSNorm(e.y,r),e},e.octEncode=function(n,t){return e.octEncodeInRange(n,255,t)},o=new n,c=new Uint8Array(1),e.octEncodeToCartesian4=function(n,t){return e.octEncodeInRange(n,65535,o),t.x=s(o.x*a),t.y=s(o.x),t.z=s(o.y*a),t.w=s(o.y),t},e.octDecodeInRange=function(n,r,e,o){if(i.defined("result",o),n<0||n>e||r<0||r>e)throw new u("x and y must be unsigned normalized integers between 0 and "+e);if(o.x=f.fromSNorm(n,e),o.y=f.fromSNorm(r,e),o.z=1-(Math.abs(o.x)+Math.abs(o.y)),o.z<0){var s=o.x;o.x=(1-Math.abs(o.y))*f.signNotZero(s);o.y=(1-Math.abs(s))*f.signNotZero(o.y)}return t.normalize(o,o)},e.octDecode=function(n,t,i){return e.octDecodeInRange(n,t,255,i)},e.octDecodeFromCartesian4=function(n,t){var h,c;i.typeOf.object("encoded",n);i.typeOf.object("result",t);var r=n.x,f=n.y,o=n.z,s=n.w;if(r<0||r>255||f<0||f>255||o<0||o>255||s<0||s>255)throw new u("x, y, z, and w must be unsigned normalized integers between 0 and 255");return h=r*v+f,c=o*v+s,e.octDecodeInRange(h,c,65535,t)},e.octPackFloat=function(n){return i.defined("encoded",n),256*n.x+n.y},h=new n,e.octEncodeFloat=function(n){return e.octEncode(n,h),e.octPackFloat(h)},e.octDecodeFloat=function(n,t){i.defined("value",n);var r=n/256,u=Math.floor(r),f=(r-u)*256;return e.octDecode(u,f,t)},e.octPack=function(n,t,r,u){i.defined("v1",n);i.defined("v2",t);i.defined("v3",r);i.defined("result",u);var o=e.octEncodeFloat(n),s=e.octEncodeFloat(t),f=e.octEncode(r,h);return u.x=65536*f.x+o,u.y=65536*f.y+s,u},e.octUnpack=function(n,t,r,u){var o,h;i.defined("packed",n);i.defined("v1",t);i.defined("v2",r);i.defined("v3",u);var f=n.x/65536,s=Math.floor(f),c=(f-s)*65536;f=n.y/65536;o=Math.floor(f);h=(f-o)*65536;e.octDecodeFloat(c,t);e.octDecodeFloat(h,r);e.octDecode(s,o,u)},e.compressTextureCoordinates=function(n){i.defined("textureCoordinates",n);var t=n.x*4095|0,r=n.y*4095|0;return 4096*t+r},e.decompressTextureCoordinates=function(n,t){i.defined("compressed",n);i.defined("result",t);var u=n/4096,r=Math.floor(u);return t.x=r/4095,t.y=(n-r*4096)/4095,t},e.zigZagDeltaDecode=function(n,t,u){var f;i.defined("uBuffer",n);i.defined("vBuffer",t);i.typeOf.number.equals("uBuffer.length","vBuffer.length",n.length,t.length);r(u)&&i.typeOf.number.equals("uBuffer.length","heightBuffer.length",n.length,u.length);var h=n.length,e=0,o=0,s=0;for(f=0;f<h;++f)e+=l(n[f]),o+=l(t[f]),n[f]=e,t[f]=o,r(u)&&(s+=l(u[f]),u[f]=s)},e});t("Core/AxisAlignedBoundingBox",["./Cartesian3","./Check","./defaultValue","./defined","./Intersect"],function(n,t,i,r,u){"use strict";function f(t,u,f){this.minimum=n.clone(i(t,n.ZERO));this.maximum=n.clone(i(u,n.ZERO));f=r(f)?n.clone(f):n.midpoint(this.minimum,this.maximum,new n);this.center=f}f.fromPoints=function(t,i){var o,u,e;if(r(i)||(i=new f),!r(t)||t.length===0)return i.minimum=n.clone(n.ZERO,i.minimum),i.maximum=n.clone(n.ZERO,i.maximum),i.center=n.clone(n.ZERO,i.center),i;var s=t[0].x,h=t[0].y,c=t[0].z,l=t[0].x,a=t[0].y,v=t[0].z,k=t.length;for(o=1;o<k;o++){var y=t[o],p=y.x,w=y.y,b=y.z;s=Math.min(p,s);l=Math.max(p,l);h=Math.min(w,h);a=Math.max(w,a);c=Math.min(b,c);v=Math.max(b,v)}return u=i.minimum,u.x=s,u.y=h,u.z=c,e=i.maximum,e.x=l,e.y=a,e.z=v,i.center=n.midpoint(u,e,i.center),i};f.clone=function(t,i){return r(t)?r(i)?(i.minimum=n.clone(t.minimum,i.minimum),i.maximum=n.clone(t.maximum,i.maximum),i.center=n.clone(t.center,i.center),i):new f(t.minimum,t.maximum,t.center):undefined};f.equals=function(t,i){return t===i||r(t)&&r(i)&&n.equals(t.center,i.center)&&n.equals(t.minimum,i.minimum)&&n.equals(t.maximum,i.maximum)};var e=new n;return f.intersectPlane=function(i,r){t.defined("box",i);t.defined("plane",r);e=n.subtract(i.maximum,i.minimum,e);var o=n.multiplyByScalar(e,.5,e),f=r.normal,s=o.x*Math.abs(f.x)+o.y*Math.abs(f.y)+o.z*Math.abs(f.z),h=n.dot(i.center,f)+r.distance;return h-s>0?u.INSIDE:h+s<0?u.OUTSIDE:u.INTERSECTING},f.prototype.clone=function(n){return f.clone(this,n)},f.prototype.intersectPlane=function(n){return f.intersectPlane(this,n)},f.prototype.equals=function(n){return f.equals(this,n)},f});t("Core/barycentricCoordinates",["./Cartesian2","./Cartesian3","./Check","./defined","./Math"],function(n,t,i,r,u){"use strict";function s(s,h,c,l,a){var v,y,p,b,w,k,d,g,tt,nt;if(i.defined("point",s),i.defined("p0",h),i.defined("p1",c),i.defined("p2",l),r(a)||(a=new t),r(h.z)){if(t.equalsEpsilon(s,h,u.EPSILON14))return t.clone(t.UNIT_X,a);if(t.equalsEpsilon(s,c,u.EPSILON14))return t.clone(t.UNIT_Y,a);if(t.equalsEpsilon(s,l,u.EPSILON14))return t.clone(t.UNIT_Z,a);v=t.subtract(c,h,f);y=t.subtract(l,h,e);p=t.subtract(s,h,o);b=t.dot(v,v);w=t.dot(v,y);k=t.dot(v,p);d=t.dot(y,y);g=t.dot(y,p)}else{if(n.equalsEpsilon(s,h,u.EPSILON14))return t.clone(t.UNIT_X,a);if(n.equalsEpsilon(s,c,u.EPSILON14))return t.clone(t.UNIT_Y,a);if(n.equalsEpsilon(s,l,u.EPSILON14))return t.clone(t.UNIT_Z,a);v=n.subtract(c,h,f);y=n.subtract(l,h,e);p=n.subtract(s,h,o);b=n.dot(v,v);w=n.dot(v,y);k=n.dot(v,p);d=n.dot(y,y);g=n.dot(y,p)}return tt=b*d-w*w,nt=1/tt,a.y=(d*k-w*g)*nt,a.z=(b*g-w*k)*nt,a.x=1-a.y-a.z,a}var f=new t,e=new t,o=new t;return s});t("Core/binarySearch",["./Check"],function(n){"use strict";function t(t,i,r){n.defined("array",t);n.defined("itemToFind",i);n.defined("comparator",r);for(var e=0,f=t.length-1,u,o;e<=f;){if(u=~~((e+f)/2),o=r(t[u],i),o<0){e=u+1;continue}if(o>0){f=u-1;continue}return u}return~(f+1)}return t});t("Core/BingMapsApi",["./defined"],function(n){"use strict";var t={};return t.defaultKey=undefined,t.getKey=function(i){return n(i)?i:t.defaultKey},t});t("Core/BingMapsGeocoderService",["./BingMapsApi","./Check","./defaultValue","./defined","./defineProperties","./Rectangle","./Resource"],function(n,t,i,r,u,f,e){"use strict";function o(t){t=i(t,i.EMPTY_OBJECT);var r=t.key;this._key=n.getKey(r);this._resource=new e({url:s,queryParameters:{key:this._key}})}var s="https://dev.virtualearth.net/REST/v1/Locations";return u(o.prototype,{url:{get:function(){return s}},key:{get:function(){return this._key}}}),o.prototype.geocode=function(n){t.typeOf.string("query",n);var i=this._resource.getDerivedResource({queryParameters:{query:n}});return i.fetchJsonp("jsonp").then(function(n){if(n.resourceSets.length===0)return[];var t=n.resourceSets[0].resources;return t.map(function(n){var t=n.bbox,i=t[0],r=t[1],u=t[2],e=t[3];return{displayName:n.name,destination:f.fromDegrees(r,i,e,u)}})})},o});t("Core/BoundingRectangle",["./Cartesian2","./Cartographic","./Check","./defaultValue","./defined","./GeographicProjection","./Intersect","./Rectangle"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,t,i,u){this.x=r(n,0);this.y=r(t,0);this.width=r(i,0);this.height=r(u,0)}s.packedLength=4;s.pack=function(n,t,u){return i.typeOf.object("value",n),i.defined("array",t),u=r(u,0),t[u++]=n.x,t[u++]=n.y,t[u++]=n.width,t[u]=n.height,t};s.unpack=function(n,t,f){return i.defined("array",n),t=r(t,0),u(f)||(f=new s),f.x=n[t++],f.y=n[t++],f.width=n[t++],f.height=n[t],f};s.fromPoints=function(n,t){var f;if(u(t)||(t=new s),!u(n)||n.length===0)return t.x=0,t.y=0,t.width=0,t.height=0,t;var a=n.length,i=n[0].x,r=n[0].y,e=n[0].x,o=n[0].y;for(f=1;f<a;f++){var h=n[f],c=h.x,l=h.y;i=Math.min(c,i);e=Math.max(c,e);r=Math.min(l,r);o=Math.max(l,o)}return t.x=i,t.y=r,t.width=e-i,t.height=o-r,t};var h=new f,c=new t,l=new t;return s.fromRectangle=function(t,i,f){if(u(f)||(f=new s),!u(t))return f.x=0,f.y=0,f.width=0,f.height=0,f;i=r(i,h);var a=i.project(o.southwest(t,c)),e=i.project(o.northeast(t,l));return n.subtract(e,a,e),f.x=a.x,f.y=a.y,f.width=e.x,f.height=e.y,f},s.clone=function(n,t){return u(n)?u(t)?(t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height,t):new s(n.x,n.y,n.width,n.height):undefined},s.union=function(n,t,r){i.typeOf.object("left",n);i.typeOf.object("right",t);u(r)||(r=new s);var f=Math.min(n.x,t.x),e=Math.min(n.y,t.y),o=Math.max(n.x+n.width,t.x+t.width),h=Math.max(n.y+n.height,t.y+t.height);return r.x=f,r.y=e,r.width=o-f,r.height=h-e,r},s.expand=function(n,t,r){i.typeOf.object("rectangle",n);i.typeOf.object("point",t);r=s.clone(n,r);var u=t.x-r.x,f=t.y-r.y;return u>r.width?r.width=u:u<0&&(r.width-=u,r.x=t.x),f>r.height?r.height=f:f<0&&(r.height-=f,r.y=t.y),r},s.intersect=function(n,t){i.typeOf.object("left",n);i.typeOf.object("right",t);var r=n.x,u=n.y,f=t.x,o=t.y;return(r>f+t.width||r+n.width<f||u+n.height<o||u>o+t.height)?e.OUTSIDE:e.INTERSECTING},s.equals=function(n,t){return n===t||u(n)&&u(t)&&n.x===t.x&&n.y===t.y&&n.width===t.width&&n.height===t.height},s.prototype.clone=function(n){return s.clone(this,n)},s.prototype.intersect=function(n){return s.intersect(this,n)},s.prototype.equals=function(n){return s.equals(this,n)},s});t("Core/WebGLConstants",["./freezeObject"],function(n){"use strict";return n({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047})});t("Core/ComponentDatatype",["./defaultValue","./defined","./DeveloperError","./FeatureDetection","./freezeObject","./WebGLConstants"],function(n,t,i,r,u,f){"use strict";if(!r.supportsTypedArrays())return{};var e={BYTE:f.BYTE,UNSIGNED_BYTE:f.UNSIGNED_BYTE,SHORT:f.SHORT,UNSIGNED_SHORT:f.UNSIGNED_SHORT,INT:f.INT,UNSIGNED_INT:f.UNSIGNED_INT,FLOAT:f.FLOAT,DOUBLE:f.DOUBLE};return e.getSizeInBytes=function(n){if(!t(n))throw new i("value is required.");switch(n){case e.BYTE:return Int8Array.BYTES_PER_ELEMENT;case e.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case e.SHORT:return Int16Array.BYTES_PER_ELEMENT;case e.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case e.INT:return Int32Array.BYTES_PER_ELEMENT;case e.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case e.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case e.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new i("componentDatatype is not a valid value.");}},e.fromTypedArray=function(n){return n instanceof Int8Array?e.BYTE:n instanceof Uint8Array?e.UNSIGNED_BYTE:n instanceof Int16Array?e.SHORT:n instanceof Uint16Array?e.UNSIGNED_SHORT:n instanceof Int32Array?e.INT:n instanceof Uint32Array?e.UNSIGNED_INT:n instanceof Float32Array?e.FLOAT:n instanceof Float64Array?e.DOUBLE:void 0},e.validate=function(n){return t(n)&&(n===e.BYTE||n===e.UNSIGNED_BYTE||n===e.SHORT||n===e.UNSIGNED_SHORT||n===e.INT||n===e.UNSIGNED_INT||n===e.FLOAT||n===e.DOUBLE)},e.createTypedArray=function(n,r){if(!t(n))throw new i("componentDatatype is required.");if(!t(r))throw new i("valuesOrLength is required.");switch(n){case e.BYTE:return new Int8Array(r);case e.UNSIGNED_BYTE:return new Uint8Array(r);case e.SHORT:return new Int16Array(r);case e.UNSIGNED_SHORT:return new Uint16Array(r);case e.INT:return new Int32Array(r);case e.UNSIGNED_INT:return new Uint32Array(r);case e.FLOAT:return new Float32Array(r);case e.DOUBLE:return new Float64Array(r);default:throw new i("componentDatatype is not a valid value.");}},e.createArrayBufferView=function(r,u,f,o){if(!t(r))throw new i("componentDatatype is required.");if(!t(u))throw new i("buffer is required.");f=n(f,0);o=n(o,(u.byteLength-f)/e.getSizeInBytes(r));switch(r){case e.BYTE:return new Int8Array(u,f,o);case e.UNSIGNED_BYTE:return new Uint8Array(u,f,o);case e.SHORT:return new Int16Array(u,f,o);case e.UNSIGNED_SHORT:return new Uint16Array(u,f,o);case e.INT:return new Int32Array(u,f,o);case e.UNSIGNED_INT:return new Uint32Array(u,f,o);case e.FLOAT:return new Float32Array(u,f,o);case e.DOUBLE:return new Float64Array(u,f,o);default:throw new i("componentDatatype is not a valid value.");}},e.fromName=function(n){switch(n){case"BYTE":return e.BYTE;case"UNSIGNED_BYTE":return e.UNSIGNED_BYTE;case"SHORT":return e.SHORT;case"UNSIGNED_SHORT":return e.UNSIGNED_SHORT;case"INT":return e.INT;case"UNSIGNED_INT":return e.UNSIGNED_INT;case"FLOAT":return e.FLOAT;case"DOUBLE":return e.DOUBLE;default:throw new i("name is not a valid value.");}},u(e)});t("Core/GeometryOffsetAttribute",["../Core/freezeObject"],function(n){"use strict";return n({NONE:0,TOP:1,ALL:2})});t("Core/GeometryType",["./freezeObject"],function(n){"use strict";return n({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3})});t("Core/Matrix2",["./Cartesian2","./Check","./defaultValue","./defined","./defineProperties","./freezeObject"],function(n,t,i,r,u,f){"use strict";function e(n,t,r,u){this[0]=i(n,0);this[1]=i(r,0);this[2]=i(t,0);this[3]=i(u,0)}var o,s;return e.packedLength=4,e.pack=function(n,r,u){return t.typeOf.object("value",n),t.defined("array",r),u=i(u,0),r[u++]=n[0],r[u++]=n[1],r[u++]=n[2],r[u++]=n[3],r},e.unpack=function(n,u,f){return t.defined("array",n),u=i(u,0),r(f)||(f=new e),f[0]=n[u++],f[1]=n[u++],f[2]=n[u++],f[3]=n[u++],f},e.clone=function(n,t){return r(n)?r(t)?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):new e(n[0],n[2],n[1],n[3]):undefined},e.fromArray=function(n,u,f){return t.defined("array",n),u=i(u,0),r(f)||(f=new e),f[0]=n[u],f[1]=n[u+1],f[2]=n[u+2],f[3]=n[u+3],f},e.fromColumnMajorArray=function(n,i){return t.defined("values",n),e.clone(n,i)},e.fromRowMajorArray=function(n,i){return(t.defined("values",n),!r(i))?new e(n[0],n[1],n[2],n[3]):(i[0]=n[0],i[1]=n[2],i[2]=n[1],i[3]=n[3],i)},e.fromScale=function(n,i){return(t.typeOf.object("scale",n),!r(i))?new e(n.x,0,0,n.y):(i[0]=n.x,i[1]=0,i[2]=0,i[3]=n.y,i)},e.fromUniformScale=function(n,i){return(t.typeOf.number("scale",n),!r(i))?new e(n,0,0,n):(i[0]=n,i[1]=0,i[2]=0,i[3]=n,i)},e.fromRotation=function(n,i){t.typeOf.number("angle",n);var u=Math.cos(n),f=Math.sin(n);return r(i)?(i[0]=u,i[1]=f,i[2]=-f,i[3]=u,i):new e(u,-f,f,u)},e.toArray=function(n,i){return(t.typeOf.object("matrix",n),!r(i))?[n[0],n[1],n[2],n[3]]:(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i)},e.getElementIndex=function(n,i){return t.typeOf.number.greaterThanOrEquals("row",i,0),t.typeOf.number.lessThanOrEquals("row",i,1),t.typeOf.number.greaterThanOrEquals("column",n,0),t.typeOf.number.lessThanOrEquals("column",n,1),n*2+i},e.getColumn=function(n,i,r){t.typeOf.object("matrix",n);t.typeOf.number.greaterThanOrEquals("index",i,0);t.typeOf.number.lessThanOrEquals("index",i,1);t.typeOf.object("result",r);var u=i*2,f=n[u],e=n[u+1];return r.x=f,r.y=e,r},e.setColumn=function(n,i,r,u){t.typeOf.object("matrix",n);t.typeOf.number.greaterThanOrEquals("index",i,0);t.typeOf.number.lessThanOrEquals("index",i,1);t.typeOf.object("cartesian",r);t.typeOf.object("result",u);u=e.clone(n,u);var f=i*2;return u[f]=r.x,u[f+1]=r.y,u},e.getRow=function(n,i,r){t.typeOf.object("matrix",n);t.typeOf.number.greaterThanOrEquals("index",i,0);t.typeOf.number.lessThanOrEquals("index",i,1);t.typeOf.object("result",r);var u=n[i],f=n[i+2];return r.x=u,r.y=f,r},e.setRow=function(n,i,r,u){return t.typeOf.object("matrix",n),t.typeOf.number.greaterThanOrEquals("index",i,0),t.typeOf.number.lessThanOrEquals("index",i,1),t.typeOf.object("cartesian",r),t.typeOf.object("result",u),u=e.clone(n,u),u[i]=r.x,u[i+2]=r.y,u},o=new n,e.getScale=function(i,r){return t.typeOf.object("matrix",i),t.typeOf.object("result",r),r.x=n.magnitude(n.fromElements(i[0],i[1],o)),r.y=n.magnitude(n.fromElements(i[2],i[3],o)),r},s=new n,e.getMaximumScale=function(t){return e.getScale(t,s),n.maximumComponent(s)},e.multiply=function(n,i,r){t.typeOf.object("left",n);t.typeOf.object("right",i);t.typeOf.object("result",r);var u=n[0]*i[0]+n[2]*i[1],f=n[0]*i[2]+n[2]*i[3],e=n[1]*i[0]+n[3]*i[1],o=n[1]*i[2]+n[3]*i[3];return r[0]=u,r[1]=e,r[2]=f,r[3]=o,r},e.add=function(n,i,r){return t.typeOf.object("left",n),t.typeOf.object("right",i),t.typeOf.object("result",r),r[0]=n[0]+i[0],r[1]=n[1]+i[1],r[2]=n[2]+i[2],r[3]=n[3]+i[3],r},e.subtract=function(n,i,r){return t.typeOf.object("left",n),t.typeOf.object("right",i),t.typeOf.object("result",r),r[0]=n[0]-i[0],r[1]=n[1]-i[1],r[2]=n[2]-i[2],r[3]=n[3]-i[3],r},e.multiplyByVector=function(n,i,r){t.typeOf.object("matrix",n);t.typeOf.object("cartesian",i);t.typeOf.object("result",r);var u=n[0]*i.x+n[2]*i.y,f=n[1]*i.x+n[3]*i.y;return r.x=u,r.y=f,r},e.multiplyByScalar=function(n,i,r){return t.typeOf.object("matrix",n),t.typeOf.number("scalar",i),t.typeOf.object("result",r),r[0]=n[0]*i,r[1]=n[1]*i,r[2]=n[2]*i,r[3]=n[3]*i,r},e.multiplyByScale=function(n,i,r){return t.typeOf.object("matrix",n),t.typeOf.object("scale",i),t.typeOf.object("result",r),r[0]=n[0]*i.x,r[1]=n[1]*i.x,r[2]=n[2]*i.y,r[3]=n[3]*i.y,r},e.negate=function(n,i){return t.typeOf.object("matrix",n),t.typeOf.object("result",i),i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i},e.transpose=function(n,i){t.typeOf.object("matrix",n);t.typeOf.object("result",i);var r=n[0],u=n[2],f=n[1],e=n[3];return i[0]=r,i[1]=u,i[2]=f,i[3]=e,i},e.abs=function(n,i){return t.typeOf.object("matrix",n),t.typeOf.object("result",i),i[0]=Math.abs(n[0]),i[1]=Math.abs(n[1]),i[2]=Math.abs(n[2]),i[3]=Math.abs(n[3]),i},e.equals=function(n,t){return n===t||r(n)&&r(t)&&n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]},e.equalsArray=function(n,t,i){return n[0]===t[i]&&n[1]===t[i+1]&&n[2]===t[i+2]&&n[3]===t[i+3]},e.equalsEpsilon=function(n,i,u){return t.typeOf.number("epsilon",u),n===i||r(n)&&r(i)&&Math.abs(n[0]-i[0])<=u&&Math.abs(n[1]-i[1])<=u&&Math.abs(n[2]-i[2])<=u&&Math.abs(n[3]-i[3])<=u},e.IDENTITY=f(new e(1,0,0,1)),e.ZERO=f(new e(0,0,0,0)),e.COLUMN0ROW0=0,e.COLUMN0ROW1=1,e.COLUMN1ROW0=2,e.COLUMN1ROW1=3,u(e.prototype,{length:{get:function(){return e.packedLength}}}),e.prototype.clone=function(n){return e.clone(this,n)},e.prototype.equals=function(n){return e.equals(this,n)},e.prototype.equalsEpsilon=function(n,t){return e.equalsEpsilon(this,n,t)},e.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"},e});t("Core/PrimitiveType",["./freezeObject","./WebGLConstants"],function(n,t){"use strict";var i={POINTS:t.POINTS,LINES:t.LINES,LINE_LOOP:t.LINE_LOOP,LINE_STRIP:t.LINE_STRIP,TRIANGLES:t.TRIANGLES,TRIANGLE_STRIP:t.TRIANGLE_STRIP,TRIANGLE_FAN:t.TRIANGLE_FAN,validate:function(n){return n===i.POINTS||n===i.LINES||n===i.LINE_LOOP||n===i.LINE_STRIP||n===i.TRIANGLES||n===i.TRIANGLE_STRIP||n===i.TRIANGLE_FAN}};return n(i)});t("Core/Quaternion",["./Cartesian3","./Check","./defaultValue","./defined","./FeatureDetection","./freezeObject","./Math","./Matrix3"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,t,r,u){this.x=i(n,0);this.y=i(t,0);this.z=i(r,0);this.w=i(u,0)}var y=new n,et,ot,k,v,nt,ft;s.fromAxisAngle=function(i,u,f){var o,e;t.typeOf.object("axis",i);t.typeOf.number("angle",u);o=u/2;e=Math.sin(o);y=n.normalize(i,y);var h=y.x*e,c=y.y*e,l=y.z*e,a=Math.cos(o);return r(f)?(f.x=h,f.y=c,f.z=l,f.w=a,f):new s(h,c,l,a)};et=[1,2,0];ot=new Array(3);s.fromRotationMatrix=function(n,i){var k,f,e,h,c;t.typeOf.object("matrix",n);var u,l,a,v,y,p=n[o.COLUMN0ROW0],w=n[o.COLUMN1ROW1],b=n[o.COLUMN2ROW2],d=p+w+b;return(d>0?(u=Math.sqrt(d+1),y=.5*u,u=.5/u,l=(n[o.COLUMN1ROW2]-n[o.COLUMN2ROW1])*u,a=(n[o.COLUMN2ROW0]-n[o.COLUMN0ROW2])*u,v=(n[o.COLUMN0ROW1]-n[o.COLUMN1ROW0])*u):(k=et,f=0,w>p&&(f=1),b>p&&b>w&&(f=2),e=k[f],h=k[e],u=Math.sqrt(n[o.getElementIndex(f,f)]-n[o.getElementIndex(e,e)]-n[o.getElementIndex(h,h)]+1),c=ot,c[f]=.5*u,u=.5/u,y=(n[o.getElementIndex(h,e)]-n[o.getElementIndex(e,h)])*u,c[e]=(n[o.getElementIndex(e,f)]+n[o.getElementIndex(f,e)])*u,c[h]=(n[o.getElementIndex(h,f)]+n[o.getElementIndex(f,h)])*u,l=-c[0],a=-c[1],v=-c[2]),!r(i))?new s(l,a,v,y):(i.x=l,i.y=a,i.z=v,i.w=y,i)};var st=new s,ht=new s,tt=new s,ct=new s;s.fromHeadingPitchRoll=function(i,r){return t.typeOf.object("headingPitchRoll",i),ct=s.fromAxisAngle(n.UNIT_X,i.roll,st),tt=s.fromAxisAngle(n.UNIT_Y,-i.pitch,r),r=s.multiply(tt,ct,tt),ht=s.fromAxisAngle(n.UNIT_Z,-i.heading,st),s.multiply(ht,r,r)};var w=new n,it=new n,h=new s,lt=new s,b=new s;s.packedLength=4;s.pack=function(n,r,u){return t.typeOf.object("value",n),t.defined("array",r),u=i(u,0),r[u++]=n.x,r[u++]=n.y,r[u++]=n.z,r[u]=n.w,r};s.unpack=function(n,u,f){return t.defined("array",n),u=i(u,0),r(f)||(f=new s),f.x=n[u],f.y=n[u+1],f.z=n[u+2],f.w=n[u+3],f};s.packedInterpolationLength=3;s.convertPackedArrayForInterpolation=function(n,t,i,r){var u,o,f,e;for(s.unpack(n,i*4,b),s.conjugate(b,b),u=0,o=i-t+1;u<o;u++)f=u*3,s.unpack(n,(t+u)*4,h),s.multiply(h,b,h),h.w<0&&s.negate(h,h),s.computeAxis(h,w),e=s.computeAngle(h),r[f]=w.x*e,r[f+1]=w.y*e,r[f+2]=w.z*e};s.unpackInterpolationResult=function(t,i,u,f,e){r(e)||(e=new s);n.fromArray(t,0,it);var o=n.magnitude(it);return s.unpack(i,f*4,lt),o===0?s.clone(s.IDENTITY,h):s.fromAxisAngle(it,o,h),s.multiply(h,lt,e)};s.clone=function(n,t){return r(n)?r(t)?(t.x=n.x,t.y=n.y,t.z=n.z,t.w=n.w,t):new s(n.x,n.y,n.z,n.w):undefined};s.conjugate=function(n,i){return t.typeOf.object("quaternion",n),t.typeOf.object("result",i),i.x=-n.x,i.y=-n.y,i.z=-n.z,i.w=n.w,i};s.magnitudeSquared=function(n){return t.typeOf.object("quaternion",n),n.x*n.x+n.y*n.y+n.z*n.z+n.w*n.w};s.magnitude=function(n){return Math.sqrt(s.magnitudeSquared(n))};s.normalize=function(n,i){t.typeOf.object("result",i);var r=1/s.magnitude(n),u=n.x*r,f=n.y*r,e=n.z*r,o=n.w*r;return i.x=u,i.y=f,i.z=e,i.w=o,i};s.inverse=function(n,i){t.typeOf.object("result",i);var r=s.magnitudeSquared(n);return i=s.conjugate(n,i),s.multiplyByScalar(i,1/r,i)};s.add=function(n,i,r){return t.typeOf.object("left",n),t.typeOf.object("right",i),t.typeOf.object("result",r),r.x=n.x+i.x,r.y=n.y+i.y,r.z=n.z+i.z,r.w=n.w+i.w,r};s.subtract=function(n,i,r){return t.typeOf.object("left",n),t.typeOf.object("right",i),t.typeOf.object("result",r),r.x=n.x-i.x,r.y=n.y-i.y,r.z=n.z-i.z,r.w=n.w-i.w,r};s.negate=function(n,i){return t.typeOf.object("quaternion",n),t.typeOf.object("result",i),i.x=-n.x,i.y=-n.y,i.z=-n.z,i.w=-n.w,i};s.dot=function(n,i){return t.typeOf.object("left",n),t.typeOf.object("right",i),n.x*i.x+n.y*i.y+n.z*i.z+n.w*i.w};s.multiply=function(n,i,r){t.typeOf.object("left",n);t.typeOf.object("right",i);t.typeOf.object("result",r);var u=n.x,f=n.y,e=n.z,o=n.w,s=i.x,h=i.y,c=i.z,l=i.w,a=o*s+u*l+f*c-e*h,v=o*h-u*c+f*l+e*s,y=o*c+u*h-f*s+e*l,p=o*l-u*s-f*h-e*c;return r.x=a,r.y=v,r.z=y,r.w=p,r};s.multiplyByScalar=function(n,i,r){return t.typeOf.object("quaternion",n),t.typeOf.number("scalar",i),t.typeOf.object("result",r),r.x=n.x*i,r.y=n.y*i,r.z=n.z*i,r.w=n.w*i,r};s.divideByScalar=function(n,i,r){return t.typeOf.object("quaternion",n),t.typeOf.number("scalar",i),t.typeOf.object("result",r),r.x=n.x/i,r.y=n.y/i,r.z=n.z/i,r.w=n.w/i,r};s.computeAxis=function(n,i){var r,u;return(t.typeOf.object("quaternion",n),t.typeOf.object("result",i),r=n.w,Math.abs(r-1)<e.EPSILON6)?(i.x=i.y=i.z=0,i):(u=1/Math.sqrt(1-r*r),i.x=n.x*u,i.y=n.y*u,i.z=n.z*u,i)};s.computeAngle=function(n){return(t.typeOf.object("quaternion",n),Math.abs(n.w-1)<e.EPSILON6)?0:2*Math.acos(n.w)};k=new s;s.lerp=function(n,i,r,u){return t.typeOf.object("start",n),t.typeOf.object("end",i),t.typeOf.number("t",r),t.typeOf.object("result",u),k=s.multiplyByScalar(i,r,k),u=s.multiplyByScalar(n,1-r,u),s.add(k,u,u)};var at=new s,rt=new s,ut=new s;s.slerp=function(n,i,r,u){var f,o,h;return(t.typeOf.object("start",n),t.typeOf.object("end",i),t.typeOf.number("t",r),t.typeOf.object("result",u),f=s.dot(n,i),o=i,f<0&&(f=-f,o=at=s.negate(i,at)),1-f<e.EPSILON6)?s.lerp(n,o,r,u):(h=Math.acos(f),rt=s.multiplyByScalar(n,Math.sin((1-r)*h),rt),ut=s.multiplyByScalar(o,Math.sin(r*h),ut),u=s.add(rt,ut,u),s.multiplyByScalar(u,1/Math.sin(h),u))};s.log=function(i,r){t.typeOf.object("quaternion",i);t.typeOf.object("result",r);var u=e.acosClamped(i.w),f=0;return u!==0&&(f=u/Math.sin(u)),n.multiplyByScalar(i,f,r)};s.exp=function(i,r){t.typeOf.object("cartesian",i);t.typeOf.object("result",r);var u=n.magnitude(i),f=0;return u!==0&&(f=Math.sin(u)/u),r.x=i.x*f,r.y=i.y*f,r.z=i.z*f,r.w=Math.cos(u),r};var yt=new n,pt=new n,p=new s,a=new s;s.computeInnerQuadrangle=function(i,r,u,f){var o,e,h;return t.typeOf.object("q0",i),t.typeOf.object("q1",r),t.typeOf.object("q2",u),t.typeOf.object("result",f),o=s.conjugate(r,p),s.multiply(o,u,a),e=s.log(a,yt),s.multiply(o,i,a),h=s.log(a,pt),n.add(e,h,e),n.multiplyByScalar(e,.25,e),n.negate(e,e),s.exp(e,p),s.multiply(r,p,f)};s.squad=function(n,i,r,u,f,e){t.typeOf.object("q0",n);t.typeOf.object("q1",i);t.typeOf.object("s0",r);t.typeOf.object("s1",u);t.typeOf.number("t",f);t.typeOf.object("result",e);var o=s.slerp(n,i,f,p),h=s.slerp(r,u,f,a);return s.slerp(o,h,2*f*(1-f),e)};var wt=new s,vt=1.9011074535173003,d=u.supportsTypedArrays()?new Float32Array(8):[],g=u.supportsTypedArrays()?new Float32Array(8):[],c=u.supportsTypedArrays()?new Float32Array(8):[],l=u.supportsTypedArrays()?new Float32Array(8):[];for(v=0;v<7;++v)nt=v+1,ft=2*nt+1,d[v]=1/(nt*ft),g[v]=nt/ft;return d[7]=vt/136,g[7]=vt*8/17,s.fastSlerp=function(n,i,r,u){var e,o,f;t.typeOf.object("start",n);t.typeOf.object("end",i);t.typeOf.number("t",r);t.typeOf.object("result",u);e=s.dot(n,i);e>=0?o=1:(o=-1,e=-e);var a=e-1,h=1-r,v=r*r,y=h*h;for(f=7;f>=0;--f)c[f]=(d[f]*v-g[f])*a,l[f]=(d[f]*y-g[f])*a;var p=o*r*(1+c[0]*(1+c[1]*(1+c[2]*(1+c[3]*(1+c[4]*(1+c[5]*(1+c[6]*(1+c[7])))))))),w=h*(1+l[0]*(1+l[1]*(1+l[2]*(1+l[3]*(1+l[4]*(1+l[5]*(1+l[6]*(1+l[7])))))))),b=s.multiplyByScalar(n,w,wt);return s.multiplyByScalar(i,p,u),s.add(b,u,u)},s.fastSquad=function(n,i,r,u,f,e){t.typeOf.object("q0",n);t.typeOf.object("q1",i);t.typeOf.object("s0",r);t.typeOf.object("s1",u);t.typeOf.number("t",f);t.typeOf.object("result",e);var o=s.fastSlerp(n,i,f,p),h=s.fastSlerp(r,u,f,a);return s.fastSlerp(o,h,2*f*(1-f),e)},s.equals=function(n,t){return n===t||r(n)&&r(t)&&n.x===t.x&&n.y===t.y&&n.z===t.z&&n.w===t.w},s.equalsEpsilon=function(n,i,u){return t.typeOf.number("epsilon",u),n===i||r(n)&&r(i)&&Math.abs(n.x-i.x)<=u&&Math.abs(n.y-i.y)<=u&&Math.abs(n.z-i.z)<=u&&Math.abs(n.w-i.w)<=u},s.ZERO=f(new s(0,0,0,0)),s.IDENTITY=f(new s(0,0,0,1)),s.prototype.clone=function(n){return s.clone(this,n)},s.prototype.equals=function(n){return s.equals(this,n)},s.prototype.equalsEpsilon=function(n,t){return s.equalsEpsilon(this,n,t)},s.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},s});t("Core/EarthOrientationParametersSample",[],function(){"use strict";function n(n,t,i,r,u){this.xPoleWander=n;this.yPoleWander=t;this.xPoleOffset=i;this.yPoleOffset=r;this.ut1MinusUtc=u}return n});t("ThirdParty/sprintf",[],function(){function n(){var n=arguments,i=0,e=n[i++],r=function(n,t,i,r){i||(i=" ");var u=n.length>=t?"":Array(1+t-n.length>>>0).join(i);return r?n+u:u+n},u=function(n,t,i,u,f,e){var o=u-n.length;return o>0&&(n=i||!f?r(n,u,e,i):n.slice(0,t.length)+r("",o,"0",!0)+n.slice(t.length)),n},t=function(n,t,i,f,e,o,s){var h=n>>>0;return i=i&&h&&{"2":"0b","8":"0","16":"0x"}[t]||"",n=i+r(h.toString(t),o||0,"0",!1),u(n,i,f,e,s)},f=function(n,t,i,r,f,e){return r!=null&&(n=n.slice(0,r)),u(n,"",t,i,f,e)},o=function(e,o,s,h,c,l,a){var w,b,nt,tt,v,d;if(e=="%%")return"%";var y=!1,g="",p=!1,k=!1,it=" ",rt=s.length;for(d=0;s&&d<rt;d++)switch(s.charAt(d)){case" ":g=" ";break;case"+":g="+";break;case"-":y=!0;break;case"'":it=s.charAt(d+1);break;case"0":p=!0;break;case"#":k=!0}if(h=h?h=="*"?+n[i++]:h.charAt(0)=="*"?+n[h.slice(1,-1)]:+h:0,h<0&&(h=-h,y=!0),!isFinite(h))throw new Error("sprintf: (minimum-)width must be finite");l=l?l=="*"?+n[i++]:l.charAt(0)=="*"?+n[l.slice(1,-1)]:+l:"fFeE".indexOf(a)>-1?6:a=="d"?0:undefined;v=o?n[o.slice(0,-1)]:n[i++];switch(a){case"s":return f(String(v),y,h,l,p,it);case"c":return f(String.fromCharCode(+v),y,h,l,p);case"b":return t(v,2,k,y,h,l,p);case"o":return t(v,8,k,y,h,l,p);case"x":return t(v,16,k,y,h,l,p);case"X":return t(v,16,k,y,h,l,p).toUpperCase();case"u":return t(v,10,k,y,h,l,p);case"i":case"d":return w=+v||0,w=Math.round(w-w%1),b=w<0?"-":g,v=b+r(String(Math.abs(w)),l,"0",!1),u(v,b,y,h,p);case"e":case"E":case"f":case"F":case"g":case"G":return w=+v,b=w<0?"-":g,nt=["toExponential","toFixed","toPrecision"]["efg".indexOf(a.toLowerCase())],tt=["toString","toUpperCase"]["eEfFgG".indexOf(a)%2],v=b+Math.abs(w)[nt](l),u(v,b,y,h,p)[tt]();default:return e}};return e.replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,o)}return n});t("Core/GregorianDate",[],function(){"use strict";function n(n,t,i,r,u,f,e,o){this.year=n;this.month=t;this.day=i;this.hour=r;this.minute=u;this.second=f;this.millisecond=e;this.isLeapSecond=o}return n});t("Core/isLeapYear",["./DeveloperError"],function(n){"use strict";function t(t){if(t===null||isNaN(t))throw new n("year is required and must be a number.");return t%4==0&&t%100!=0||t%400==0}return t});t("Core/LeapSecond",[],function(){"use strict";function n(n,t){this.julianDate=n;this.offset=t}return n});t("Core/TimeConstants",["./freezeObject"],function(n){"use strict";return n({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1e-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5})});t("Core/TimeStandard",["./freezeObject"],function(n){"use strict";return n({UTC:0,TAI:1})});t("Core/JulianDate",["../ThirdParty/sprintf","./binarySearch","./defaultValue","./defined","./DeveloperError","./GregorianDate","./isLeapYear","./LeapSecond","./TimeConstants","./TimeStandard"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function k(n,t){return c.compare(n.julianDate,t.julianDate)}function b(n){var r,i,u,f;v.julianDate=n;r=c.leapSeconds;i=t(r,v,k);i<0&&(i=~i);i>=r.length&&(i=r.length-1);u=r[i].offset;i>0&&(f=c.secondsDifference(r[i].julianDate,n),f>u&&(i--,u=r[i].offset));c.addSeconds(n,u,n)}function tt(n,i){var u,r,f;return(v.julianDate=n,u=c.leapSeconds,r=t(u,v,k),r<0&&(r=~r),r===0)?c.addSeconds(n,-u[0].offset,i):r>=u.length?c.addSeconds(n,-u[r-1].offset,i):(f=c.secondsDifference(u[r].julianDate,n),f===0)?c.addSeconds(n,-u[r].offset,i):f<=1?undefined:c.addSeconds(n,-u[--r].offset,i)}function a(n,t,i){var r=t/s.SECONDS_PER_DAY|0;return n+=r,t-=s.SECONDS_PER_DAY*r,t<0&&(n--,t+=s.SECONDS_PER_DAY),i.dayNumber=n,i.secondsOfDay=t,i}function d(n,t,i,r,u,f,e){var h=(t-14)/12|0,c=n+4800+h,l=(1461*c/4|0)+(367*(t-2-12*h)/12|0)-(3*((c+100)/100|0)/4|0)+i-32075,o;return r=r-12,r<0&&(r+=24),o=f+(r*s.SECONDS_PER_HOUR+u*s.SECONDS_PER_MINUTE+e*s.SECONDS_PER_MILLISECOND),o>=43200&&(l-=1),[l,o]}function c(n,t,r){this.dayNumber=undefined;this.secondsOfDay=undefined;n=i(n,0);t=i(t,0);r=i(r,h.UTC);var u=n|0;t=t+(n-u)*s.SECONDS_PER_DAY;a(u,t,this);r===h.UTC&&b(this)}var nt=new f,p=[31,28,31,30,31,30,31,31,30,31,30,31],w=29,v=new o,it=/^(\d{4})$/,rt=/^(\d{4})-(\d{2})$/,ut=/^(\d{4})-?(\d{3})$/,ft=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,et=/^(\d{4})-?(\d{2})-?(\d{2})$/,g=/([Z+\-])?(\d{2})?:?(\d{2})?$/,ot=/^(\d{2})(\.\d+)?/.source+g.source,st=/^(\d{2}):?(\d{2})(\.\d+)?/.source+g.source,ht=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+g.source,l="Invalid ISO 8601 date.",y;return c.fromGregorianDate=function(n,t){if(!(n instanceof f))throw new u("date must be a valid GregorianDate.");var i=d(n.year,n.month,n.day,n.hour,n.minute,n.second,n.millisecond);return r(t)?(a(i[0],i[1],t),b(t),t):new c(i[0],i[1],h.UTC)},c.fromDate=function(n,t){if(!(n instanceof Date)||isNaN(n.getTime()))throw new u("date must be a valid JavaScript Date.");var i=d(n.getUTCFullYear(),n.getUTCMonth()+1,n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds());return r(t)?(a(i[0],i[1],t),b(t),t):new c(i[0],i[1],h.UTC)},c.fromIso8601=function(n,t){var k,at,bt,kt,dt,vt,wt,yt;if(typeof n!="string")throw new u(l);n=n.replace(",",".");var i=n.split("T"),v,f=1,y=1,o=0,s=0,ct=0,pt=0,tt=i[0],lt=i[1],g,nt;if(!r(tt))throw new u(l);if(i=tt.match(et),i!==null){if(k=tt.split("-").length-1,k>0&&k!==2)throw new u(l);v=+i[1];f=+i[2];y=+i[3]}else if(i=tt.match(rt),i!==null)v=+i[1],f=+i[2];else if(i=tt.match(it),i!==null)v=+i[1];else{if(i=tt.match(ut),i!==null){if(v=+i[1],at=+i[2],nt=e(v),at<1||nt&&at>366||!nt&&at>365)throw new u(l);}else if(i=tt.match(ft),i!==null){if(v=+i[1],bt=+i[2],kt=+i[3]||0,k=tt.split("-").length-1,k>0&&(!r(i[3])&&k!==1||r(i[3])&&k!==2))throw new u(l);dt=new Date(Date.UTC(v,0,4));at=bt*7+kt-dt.getUTCDay()-3}else throw new u(l);g=new Date(Date.UTC(v,0,1));g.setUTCDate(at);f=g.getUTCMonth()+1;y=g.getUTCDate()}if(nt=e(v),f<1||f>12||y<1||(f!==2||!nt)&&y>p[f-1]||nt&&f===2&&y>w)throw new u(l);if(r(lt)){if(i=lt.match(ht),i!==null){if(k=lt.split(":").length-1,k>0&&k!==2&&k!==3)throw new u(l);o=+i[1];s=+i[2];ct=+i[3];pt=+(i[4]||0)*1e3;vt=5}else if(i=lt.match(st),i!==null){if(k=lt.split(":").length-1,k>2)throw new u(l);o=+i[1];s=+i[2];ct=+(i[3]||0)*60;vt=4}else if(i=lt.match(ot),i!==null)o=+i[1],s=+(i[2]||0)*60,vt=3;else throw new u(l);if(s>=60||ct>=61||o>24||o===24&&(s>0||ct>0||pt>0))throw new u(l);var ti=i[vt],gt=+i[vt+1],ni=+(i[vt+2]||0);switch(ti){case"+":o=o-gt;s=s-ni;break;case"-":o=o+gt;s=s+ni;break;case"Z":break;default:s=s+new Date(Date.UTC(v,f-1,y,o,s)).getTimezoneOffset()}}for(wt=ct===60,wt&&ct--;s>=60;)s-=60,o++;while(o>=24)o-=24,y++;for(g=nt&&f===2?w:p[f-1];y>g;)y-=g,f++,f>12&&(f-=12,v++),g=nt&&f===2?w:p[f-1];while(s<0)s+=60,o--;while(o<0)o+=24,y--;while(y<1)f--,f<1&&(f+=12,v--),g=nt&&f===2?w:p[f-1],y+=g;return yt=d(v,f,y,o,s,ct,pt),r(t)?(a(yt[0],yt[1],t),b(t)):t=new c(yt[0],yt[1],h.UTC),wt&&c.addSeconds(t,1,t),t},c.now=function(n){return c.fromDate(new Date,n)},y=new c(0,0,h.TAI),c.toGregorianDate=function(n,t){var o,h,w,v,i,b,k,p,d,a,nt;if(!r(n))throw new u("julianDate is required.");o=!1;h=tt(n,y);r(h)||(c.addSeconds(n,-1,y),h=tt(y,y),o=!0);w=h.dayNumber;v=h.secondsOfDay;v>=43200&&(w+=1);i=w+68569|0;b=4*i/146097|0;i=i-((146097*b+3)/4|0)|0;k=4e3*(i+1)/1461001|0;i=i-(1461*k/4|0)+31|0;p=80*i/2447|0;d=i-(2447*p/80|0)|0;i=p/11|0;var it=p+2-12*i|0,rt=100*(b-49)+k+i|0,e=v/s.SECONDS_PER_HOUR|0,l=v-e*s.SECONDS_PER_HOUR,g=l/s.SECONDS_PER_MINUTE|0;return(l=l-g*s.SECONDS_PER_MINUTE,a=l|0,nt=(l-a)/s.SECONDS_PER_MILLISECOND,e+=12,e>23&&(e-=24),o&&(a+=1),!r(t))?new f(rt,it,d,e,g,a,nt,o):(t.year=rt,t.month=it,t.day=d,t.hour=e,t.minute=g,t.second=a,t.millisecond=nt,t.isLeapSecond=o,t)},c.toDate=function(n){if(!r(n))throw new u("julianDate is required.");var t=c.toGregorianDate(n,nt),i=t.second;return t.isLeapSecond&&(i-=1),new Date(Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,i,t.millisecond))},c.toIso8601=function(t,i){var y;if(!r(t))throw new u("julianDate is required.");var f=c.toGregorianDate(t,nt),e=f.year,o=f.month,s=f.day,h=f.hour,l=f.minute,a=f.second,v=f.millisecond;return(e===1e4&&o===1&&s===1&&h===0&&l===0&&a===0&&v===0&&(e=9999,o=12,s=31,h=24),!r(i)&&v!==0)?(y=(v*.01).toString().replace(".",""),n("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",e,o,s,h,l,a,y)):!r(i)||i===0?n("%04d-%02d-%02dT%02d:%02d:%02dZ",e,o,s,h,l,a):(y=(v*.01).toFixed(i).replace(".","").slice(0,i),n("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",e,o,s,h,l,a,y))},c.clone=function(n,t){return r(n)?r(t)?(t.dayNumber=n.dayNumber,t.secondsOfDay=n.secondsOfDay,t):new c(n.dayNumber,n.secondsOfDay,h.TAI):undefined},c.compare=function(n,t){if(!r(n))throw new u("left is required.");if(!r(t))throw new u("right is required.");var i=n.dayNumber-t.dayNumber;return i!==0?i:n.secondsOfDay-t.secondsOfDay},c.equals=function(n,t){return n===t||r(n)&&r(t)&&n.dayNumber===t.dayNumber&&n.secondsOfDay===t.secondsOfDay},c.equalsEpsilon=function(n,t,i){if(!r(i))throw new u("epsilon is required.");return n===t||r(n)&&r(t)&&Math.abs(c.secondsDifference(n,t))<=i},c.totalDays=function(n){if(!r(n))throw new u("julianDate is required.");return n.dayNumber+n.secondsOfDay/s.SECONDS_PER_DAY},c.secondsDifference=function(n,t){if(!r(n))throw new u("left is required.");if(!r(t))throw new u("right is required.");var i=(n.dayNumber-t.dayNumber)*s.SECONDS_PER_DAY;return i+(n.secondsOfDay-t.secondsOfDay)},c.daysDifference=function(n,t){if(!r(n))throw new u("left is required.");if(!r(t))throw new u("right is required.");var i=n.dayNumber-t.dayNumber,f=(n.secondsOfDay-t.secondsOfDay)/s.SECONDS_PER_DAY;return i+f},c.computeTaiMinusUtc=function(n){v.julianDate=n;var r=c.leapSeconds,i=t(r,v,k);return i<0&&(i=~i,--i,i<0&&(i=0)),r[i].offset},c.addSeconds=function(n,t,i){if(!r(n))throw new u("julianDate is required.");if(!r(t))throw new u("seconds is required.");if(!r(i))throw new u("result is required.");return a(n.dayNumber,n.secondsOfDay+t,i)},c.addMinutes=function(n,t,i){if(!r(n))throw new u("julianDate is required.");if(!r(t))throw new u("minutes is required.");if(!r(i))throw new u("result is required.");var f=n.secondsOfDay+t*s.SECONDS_PER_MINUTE;return a(n.dayNumber,f,i)},c.addHours=function(n,t,i){if(!r(n))throw new u("julianDate is required.");if(!r(t))throw new u("hours is required.");if(!r(i))throw new u("result is required.");var f=n.secondsOfDay+t*s.SECONDS_PER_HOUR;return a(n.dayNumber,f,i)},c.addDays=function(n,t,i){if(!r(n))throw new u("julianDate is required.");if(!r(t))throw new u("days is required.");if(!r(i))throw new u("result is required.");var f=n.dayNumber+t;return a(f,n.secondsOfDay,i)},c.lessThan=function(n,t){return c.compare(n,t)<0},c.lessThanOrEquals=function(n,t){return c.compare(n,t)<=0},c.greaterThan=function(n,t){return c.compare(n,t)>0},c.greaterThanOrEquals=function(n,t){return c.compare(n,t)>=0},c.prototype.clone=function(n){return c.clone(this,n)},c.prototype.equals=function(n){return c.equals(this,n)},c.prototype.equalsEpsilon=function(n,t){return c.equalsEpsilon(this,n,t)},c.prototype.toString=function(){return c.toIso8601(this)},c.leapSeconds=[new o(new c(2441317,43210,h.TAI),10),new o(new c(2441499,43211,h.TAI),11),new o(new c(2441683,43212,h.TAI),12),new o(new c(2442048,43213,h.TAI),13),new o(new c(2442413,43214,h.TAI),14),new o(new c(2442778,43215,h.TAI),15),new o(new c(2443144,43216,h.TAI),16),new o(new c(2443509,43217,h.TAI),17),new o(new c(2443874,43218,h.TAI),18),new o(new c(2444239,43219,h.TAI),19),new o(new c(2444786,43220,h.TAI),20),new o(new c(2445151,43221,h.TAI),21),new o(new c(2445516,43222,h.TAI),22),new o(new c(2446247,43223,h.TAI),23),new o(new c(2447161,43224,h.TAI),24),new o(new c(2447892,43225,h.TAI),25),new o(new c(2448257,43226,h.TAI),26),new o(new c(2448804,43227,h.TAI),27),new o(new c(2449169,43228,h.TAI),28),new o(new c(2449534,43229,h.TAI),29),new o(new c(2450083,43230,h.TAI),30),new o(new c(2450630,43231,h.TAI),31),new o(new c(2451179,43232,h.TAI),32),new o(new c(2453736,43233,h.TAI),33),new o(new c(2454832,43234,h.TAI),34),new o(new c(2456109,43235,h.TAI),35),new o(new c(2457204,43236,h.TAI),36),new o(new c(2457754,43237,h.TAI),37)],c});t("Core/EarthOrientationParameters",["../ThirdParty/when","./binarySearch","./defaultValue","./defined","./EarthOrientationParametersSample","./freezeObject","./JulianDate","./LeapSecond","./Resource","./RuntimeError","./TimeConstants","./TimeStandard"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function v(t){if(t=i(t,i.EMPTY_OBJECT),this._dates=undefined,this._samples=undefined,this._dateColumn=-1,this._xPoleWanderRadiansColumn=-1,this._yPoleWanderRadiansColumn=-1,this._ut1MinusUtcSecondsColumn=-1,this._xCelestialPoleOffsetRadiansColumn=-1,this._yCelestialPoleOffsetRadiansColumn=-1,this._taiMinusUtcSecondsColumn=-1,this._columnCount=0,this._lastIndex=-1,this._downloadPromise=undefined,this._dataError=undefined,this._addNewLeapSeconds=i(t.addNewLeapSeconds,!0),r(t.data))y(this,t.data);else if(r(t.url)){var u=s.createIfNeeded(t.url),f=this;this._downloadPromise=n(u.fetchJson(),function(n){y(f,n)},function(){f._dataError="An error occurred while retrieving the EOP data from the URL "+u.url+"."})}else y(this,{columnNames:["dateIso8601","modifiedJulianDateUtc","xPoleWanderRadians","yPoleWanderRadians","ut1MinusUtcSeconds","lengthOfDayCorrectionSeconds","xCelestialPoleOffsetRadians","yCelestialPoleOffsetRadians","taiMinusUtcSeconds"],samples:[]})}function b(n,t){return e.compare(n.julianDate,t)}function y(n,i){var f,it,v,rt,u,ut,p,w,ft;if(!r(i.columnNames)){n._dataError="Error in loaded EOP data: The columnNames property is required.";return}if(!r(i.samples)){n._dataError="Error in loaded EOP data: The samples property is required.";return}var h=i.columnNames.indexOf("modifiedJulianDateUtc"),k=i.columnNames.indexOf("xPoleWanderRadians"),d=i.columnNames.indexOf("yPoleWanderRadians"),g=i.columnNames.indexOf("ut1MinusUtcSeconds"),nt=i.columnNames.indexOf("xCelestialPoleOffsetRadians"),tt=i.columnNames.indexOf("yCelestialPoleOffsetRadians"),a=i.columnNames.indexOf("taiMinusUtcSeconds");if(h<0||k<0||d<0||g<0||nt<0||tt<0||a<0){n._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";return}for(f=n._samples=i.samples,it=n._dates=[],n._dateColumn=h,n._xPoleWanderRadiansColumn=k,n._yPoleWanderRadiansColumn=d,n._ut1MinusUtcSecondsColumn=g,n._xCelestialPoleOffsetRadiansColumn=nt,n._yCelestialPoleOffsetRadiansColumn=tt,n._taiMinusUtcSecondsColumn=a,n._columnCount=i.columnNames.length,n._lastIndex=undefined,rt=n._addNewLeapSeconds,u=0,ut=f.length;u<ut;u+=n._columnCount){var et=f[u+h],s=f[u+a],ot=et+c.MODIFIED_JULIAN_DATE_DIFFERENCE,y=new e(ot,s,l.TAI);it.push(y);rt&&(s!==v&&r(v)&&(p=e.leapSeconds,w=t(p,y,b),w<0&&(ft=new o(y,s),p.splice(~w,0,ft))),v=s)}}function p(n,t,i,r,u){var f=i*r;u.xPoleWander=t[f+n._xPoleWanderRadiansColumn];u.yPoleWander=t[f+n._yPoleWanderRadiansColumn];u.xPoleOffset=t[f+n._xCelestialPoleOffsetRadiansColumn];u.yPoleOffset=t[f+n._yCelestialPoleOffsetRadiansColumn];u.ut1MinusUtc=t[f+n._ut1MinusUtcSecondsColumn]}function a(n,t,i){return t+n*(i-t)}function w(n,t,i,r,u,f,o){var y=n._columnCount,c,l,k,d;if(f>t.length-1)return o.xPoleWander=0,o.yPoleWander=0,o.xPoleOffset=0,o.yPoleOffset=0,o.ut1MinusUtc=0,o;if(c=t[u],l=t[f],c.equals(l)||r.equals(c))return p(n,i,u,y,o),o;if(r.equals(l))return p(n,i,f,y,o),o;var v=e.secondsDifference(r,c)/e.secondsDifference(l,c),s=u*y,h=f*y,b=i[s+n._ut1MinusUtcSecondsColumn],w=i[h+n._ut1MinusUtcSecondsColumn],g=w-b;return(g>.5||g<-.5)&&(k=i[s+n._taiMinusUtcSecondsColumn],d=i[h+n._taiMinusUtcSecondsColumn],k!==d&&(l.equals(r)?b=w:w-=d-k)),o.xPoleWander=a(v,i[s+n._xPoleWanderRadiansColumn],i[h+n._xPoleWanderRadiansColumn]),o.yPoleWander=a(v,i[s+n._yPoleWanderRadiansColumn],i[h+n._yPoleWanderRadiansColumn]),o.xPoleOffset=a(v,i[s+n._xCelestialPoleOffsetRadiansColumn],i[h+n._xCelestialPoleOffsetRadiansColumn]),o.yPoleOffset=a(v,i[s+n._yCelestialPoleOffsetRadiansColumn],i[h+n._yCelestialPoleOffsetRadiansColumn]),o.ut1MinusUtc=a(v,b,w),o}return v.NONE=f({getPromiseToLoad:function(){return n()},compute:function(n,t){return r(t)?(t.xPoleWander=0,t.yPoleWander=0,t.xPoleOffset=0,t.yPoleOffset=0,t.ut1MinusUtc=0):t=new u(0,0,0,0,0),t}}),v.prototype.getPromiseToLoad=function(){return n(this._downloadPromise)},v.prototype.compute=function(n,i){var o;if(!r(this._samples)){if(r(this._dataError))throw new h(this._dataError);return undefined}if(r(i)||(i=new u(0,0,0,0,0)),this._samples.length===0)return i.xPoleWander=0,i.yPoleWander=0,i.xPoleOffset=0,i.yPoleOffset=0,i.ut1MinusUtc=0,i;var s=this._dates,l=this._lastIndex,f=0,c=0;if(r(l)){var y=s[l],a=s[l+1],p=e.lessThanOrEquals(y,n),v=!r(a),b=v||e.greaterThanOrEquals(a,n);if(p&&b)return f=l,!v&&a.equals(n)&&++f,c=f+1,w(this,s,this._samples,n,f,c,i),i}return o=t(s,n,e.compare,this._dateColumn),o>=0?(o<s.length-1&&s[o+1].equals(n)&&++o,f=o,c=o):(c=~o,f=c-1,f<0&&(f=0)),this._lastIndex=f,w(this,s,this._samples,n,f,c,i),i},v});t("Core/Iau2006XysSample",[],function(){"use strict";function n(n,t,i){this.x=n;this.y=t;this.s=i}return n});t("Core/Iau2006XysData",["../ThirdParty/when","./buildModuleUrl","./defaultValue","./defined","./Iau2006XysSample","./JulianDate","./Resource","./TimeStandard"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){var t,u;n=i(n,i.EMPTY_OBJECT);this._xysFileUrlTemplate=e.createIfNeeded(n.xysFileUrlTemplate);this._interpolationOrder=i(n.interpolationOrder,9);this._sampleZeroJulianEphemerisDate=i(n.sampleZeroJulianEphemerisDate,2442396.5);this._sampleZeroDateTT=new f(this._sampleZeroJulianEphemerisDate,0,o.TAI);this._stepSizeDays=i(n.stepSizeDays,1);this._samplesPerXysFile=i(n.samplesPerXysFile,1e3);this._totalSamples=i(n.totalSamples,27426);this._samples=new Array(this._totalSamples*3);this._chunkDownloadsInProgress=[];var r=this._interpolationOrder,s=this._denominators=new Array(r+1),h=this._xTable=new Array(r+1),c=Math.pow(this._stepSizeDays,r);for(t=0;t<=r;++t){for(s[t]=c,h[t]=t*this._stepSizeDays,u=0;u<=r;++u)u!==t&&(s[t]*=t-u);s[t]=1/s[t]}this._work=new Array(r+1);this._coef=new Array(r+1)}function h(n,t,i){var r=l;return r.dayNumber=t,r.secondsOfDay=i,f.daysDifference(r,n._sampleZeroDateTT)}function c(i,u){var f,s,o;return i._chunkDownloadsInProgress[u]?i._chunkDownloadsInProgress[u]:(f=n.defer(),i._chunkDownloadsInProgress[u]=f,o=i._xysFileUrlTemplate,s=r(o)?o.getDerivedResource({templateValues:{"0":u}}):new e({url:t("Assets/IAU2006_XYS/IAU2006_XYS_"+u+".json")}),n(s.fetchJson(),function(n){var t,e;i._chunkDownloadsInProgress[u]=!1;var o=i._samples,r=n.samples,s=u*i._samplesPerXysFile*3;for(t=0,e=r.length;t<e;++t)o[s+t]=r[t];f.resolve()}),f.promise)}var l=new f(0,0,o.TAI);return s.prototype.preload=function(t,i,r,u){var l=h(this,t,i),a=h(this,r,u),o=l/this._stepSizeDays-this._interpolationOrder/2|0,f,e;o<0&&(o=0);f=a/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;f>=this._totalSamples&&(f=this._totalSamples-1);var v=o/this._samplesPerXysFile|0,y=f/this._samplesPerXysFile|0,s=[];for(e=v;e<=y;++e)s.push(c(this,e));return n.all(s)},s.prototype.computeXysRadians=function(n,t,i){var w=h(this,n,t),b,o,e,s,y,l,p;if(w<0||(b=w/this._stepSizeDays|0,b>=this._totalSamples)||(o=this._interpolationOrder,e=b-(o/2|0),e<0&&(e=0),s=e+o,s>=this._totalSamples&&(s=this._totalSamples-1,e=s-o,e<0&&(e=0)),y=!1,l=this._samples,r(l[e*3])||(c(this,e/this._samplesPerXysFile|0),y=!0),r(l[s*3])||(c(this,s/this._samplesPerXysFile|0),y=!0),y))return undefined;r(i)?(i.x=0,i.y=0,i.s=0):i=new u(0,0,0);for(var d=w-e*this._stepSizeDays,k=this._work,g=this._denominators,a=this._coef,nt=this._xTable,v,f=0;f<=o;++f)k[f]=d-nt[f];for(f=0;f<=o;++f){for(a[f]=1,v=0;v<=o;++v)v!==f&&(a[f]*=k[v]);a[f]*=g[f];p=(e+f)*3;i.x+=a[f]*l[p++];i.y+=a[f]*l[p++];i.s+=a[f]*l[p]}return i},s});t("Core/Transforms",["../ThirdParty/when","./Cartesian2","./Cartesian3","./Cartesian4","./Cartographic","./Check","./defaultValue","./defined","./DeveloperError","./EarthOrientationParameters","./EarthOrientationParametersSample","./Ellipsoid","./Iau2006XysData","./Iau2006XysSample","./JulianDate","./Math","./Matrix3","./Matrix4","./Quaternion","./TimeConstants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";var g={},et={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},ot={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},st={},nt={east:new i,north:new i,up:new i,west:new i,south:new i,down:new i},tt=new i,it=new i,rt=new i,at,vt,ft,yt,pt;g.localFrameToFixedFrameGenerator=function(n,t){if(!et.hasOwnProperty(n)||!et[n].hasOwnProperty(t))throw new s("firstAxis and secondAxis must be east, north, up, west, south or down.");var r=et[n][t],u,f=n+t;return o(st[f])?u=st[f]:(u=function(u,f,h){var a,v,c;if(!o(u))throw new s("origin is required.");return o(h)||(h=new b),p.equalsEpsilon(u.x,0,p.EPSILON14)&&p.equalsEpsilon(u.y,0,p.EPSILON14)?(a=p.sign(u.z),i.unpack(ot[n],0,tt),n!=="east"&&n!=="west"&&i.multiplyByScalar(tt,a,tt),i.unpack(ot[t],0,it),t!=="east"&&t!=="west"&&i.multiplyByScalar(it,a,it),i.unpack(ot[r],0,rt),r!=="east"&&r!=="west"&&i.multiplyByScalar(rt,a,rt)):(f=e(f,l.WGS84),f.geodeticSurfaceNormal(u,nt.up),v=nt.up,c=nt.east,c.x=-u.y,c.y=u.x,c.z=0,i.normalize(c,nt.east),i.cross(v,c,nt.north),i.multiplyByScalar(nt.up,-1,nt.down),i.multiplyByScalar(nt.east,-1,nt.west),i.multiplyByScalar(nt.north,-1,nt.south),tt=nt[n],it=nt[t],rt=nt[r]),h[0]=tt.x,h[1]=tt.y,h[2]=tt.z,h[3]=0,h[4]=it.x,h[5]=it.y,h[6]=it.z,h[7]=0,h[8]=rt.x,h[9]=rt.y,h[10]=rt.z,h[11]=0,h[12]=u.x,h[13]=u.y,h[14]=u.z,h[15]=1,h},st[f]=u),u};g.eastNorthUpToFixedFrame=g.localFrameToFixedFrameGenerator("east","north");g.northEastDownToFixedFrame=g.localFrameToFixedFrameGenerator("north","east");g.northUpEastToFixedFrame=g.localFrameToFixedFrameGenerator("north","up");g.northWestUpToFixedFrame=g.localFrameToFixedFrameGenerator("north","west");var gt=new k,ni=new i(1,1,1),ti=new b;g.headingPitchRollToFixedFrame=function(n,t,r,u,o){f.typeOf.object("HeadingPitchRoll",t);u=e(u,g.eastNorthUpToFixedFrame);var s=k.fromHeadingPitchRoll(t,gt),h=b.fromTranslationQuaternionRotationScale(i.ZERO,s,ni,ti);return o=u(n,r,o),b.multiply(o,h,o)};at=new b;vt=new w;g.headingPitchRollQuaternion=function(n,t,i,r,u){f.typeOf.object("HeadingPitchRoll",t);var e=g.headingPitchRollToFixedFrame(n,t,i,r,at),o=b.getRotation(e,vt);return k.fromRotationMatrix(o,u)};var ii=24060+50.54841,ri=8640184.812866,ui=.093104,fi=-62e-7,ei=11772758384668e-32,oi=72921158553e-15,si=p.TWO_PI/86400,ut=new y;g.computeTemeToPseudoFixedMatrix=function(n,t){if(!o(n))throw new s("date is required.");ut=y.addSeconds(n,-y.computeTaiMinusUtc(n),ut);var f=ut.dayNumber,e=ut.secondsOfDay,i,h=f-2451545;i=e>=43200?(h+.5)/d.DAYS_PER_JULIAN_CENTURY:(h-.5)/d.DAYS_PER_JULIAN_CENTURY;var l=ii+i*(ri+i*(ui+i*fi)),a=l*si%p.TWO_PI,v=oi+ei*(f-2451545.5),b=(e+d.SECONDS_PER_DAY*.5)%d.SECONDS_PER_DAY,c=a+v*b,r=Math.cos(c),u=Math.sin(c);return o(t)?(t[0]=r,t[1]=-u,t[2]=0,t[3]=u,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t):new w(r,u,0,-u,r,0,0,0,1)};g.iau2006XysData=new a;g.earthOrientationParameters=h.NONE;ft=32.184;yt=2451545;g.preloadIcrfFixed=function(t){var i=t.start.dayNumber,r=t.start.secondsOfDay+ft,u=t.stop.dayNumber,f=t.stop.secondsOfDay+ft,e=g.iau2006XysData.preload(i,r,u,f),o=g.earthOrientationParameters.getPromiseToLoad();return n.all([e,o])};g.computeIcrfToFixedMatrix=function(n,t){if(!o(n))throw new s("date is required.");o(t)||(t=new w);var i=g.computeFixedToIcrfMatrix(n,t);return o(i)?w.transpose(i,t):undefined};var hi=new v(0,0,0),ci=new c(0,0,0,0,0,0),ht=new w,ct=new w;g.computeFixedToIcrfMatrix=function(n,t){var e;if(!o(n))throw new s("date is required.");if(o(t)||(t=new w),e=g.earthOrientationParameters.compute(n,ci),!o(e))return undefined;var it=n.dayNumber,rt=n.secondsOfDay+ft,k=g.iau2006XysData.computeXysRadians(it,rt,hi);if(!o(k))return undefined;var i=k.x+e.xPoleOffset,r=k.y+e.yPoleOffset,h=1/(1+Math.sqrt(1-i*i-r*r)),u=ht;u[0]=1-h*i*i;u[3]=-h*i*r;u[6]=i;u[1]=-h*i*r;u[4]=1-h*r*r;u[7]=r;u[2]=-i;u[5]=-r;u[8]=1-h*(i*i+r*r);var ot=w.fromRotationZ(-k.s,ct),st=w.multiply(u,ot,ht),lt=n.dayNumber,at=n.secondsOfDay-y.computeTaiMinusUtc(n)+e.ut1MinusUtc,vt=lt-2451545,ut=at/d.SECONDS_PER_DAY,tt=.779057273264+ut+.00273781191135448*(vt+ut);tt=tt%1*p.TWO_PI;var pt=w.fromRotationZ(tt,ct),wt=w.multiply(st,pt,ht),nt=Math.cos(e.xPoleWander),c=Math.cos(e.yPoleWander),l=Math.sin(e.xPoleWander),a=Math.sin(e.yPoleWander),bt=(it-yt+rt/d.SECONDS_PER_DAY)/36525;var et=-47e-6*bt*p.RADIANS_PER_DEGREE/3600,v=Math.cos(et),b=Math.sin(et),f=ct;return f[0]=nt*v,f[1]=nt*b,f[2]=l,f[3]=-c*b+a*l*v,f[4]=c*v+a*l*b,f[5]=-a*nt,f[6]=-a*b-c*l*v,f[7]=a*v-c*l*b,f[8]=c*nt,w.multiply(wt,f,t)};pt=new r;g.pointToWindowCoordinates=function(n,t,i,r){return r=g.pointToGLWindowCoordinates(n,t,i,r),r.y=2*t[5]-r.y,r};g.pointToGLWindowCoordinates=function(n,i,u,f){if(!o(n))throw new s("modelViewProjectionMatrix is required.");if(!o(i))throw new s("viewportTransformation is required.");if(!o(u))throw new s("point is required.");o(f)||(f=new t);var e=pt;return b.multiplyByVector(n,r.fromElements(u.x,u.y,u.z,1,e),e),r.multiplyByScalar(e,1/e.w,e),b.multiplyByVector(i,e,e),t.fromCartesian4(e,f)};var li=new i,ai=new i,vi=new i;g.rotationMatrixFromPositionVelocity=function(n,t,r,u){var c,f,h;if(!o(n))throw new s("position is required.");if(!o(t))throw new s("velocity is required.");return c=e(r,l.WGS84).geodeticSurfaceNormal(n,li),f=i.cross(t,c,ai),i.equalsEpsilon(f,i.ZERO,p.EPSILON6)&&(f=i.clone(i.UNIT_X,f)),h=i.cross(f,t,vi),i.cross(t,h,f),i.negate(f,f),o(u)||(u=new w),u[0]=t.x,u[1]=t.y,u[2]=t.z,u[3]=f.x,u[4]=f.y,u[5]=f.z,u[6]=h.x,u[7]=h.y,u[8]=h.z,u};var wt=new b(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),bt=new u,kt=new i,yi=new i,pi=new w,lt=new b,dt=new b;return g.basisTo2D=function(n,t,r){if(!o(n))throw new s("projection is required.");if(!o(t))throw new s("matrix is required.");if(!o(r))throw new s("result is required.");var f=b.getTranslation(t,yi),e=n.ellipsoid,h=e.cartesianToCartographic(f,bt),u=n.project(h,kt);i.fromElements(u.z,u.x,u.y,u);var c=g.eastNorthUpToFixedFrame(f,e,lt),l=b.inverseTransformation(c,dt),a=b.getRotation(t,pi),v=b.multiplyByMatrix3(l,a,r);return b.multiply(wt,v,r),b.setTranslation(r,u,r),r},g.wgs84To2DModelMatrix=function(n,t,r){var e;if(!o(n))throw new s("projection is required.");if(!o(t))throw new s("center is required.");if(!o(r))throw new s("result is required.");var f=n.ellipsoid,h=g.eastNorthUpToFixedFrame(t,f,lt),c=b.inverseTransformation(h,dt),l=f.cartesianToCartographic(t,bt),u=n.project(l,kt);return i.fromElements(u.z,u.x,u.y,u),e=b.fromTranslation(u,lt),b.multiply(wt,c,r),b.multiply(e,r,r),r},g});t("Core/Geometry",["./Cartesian2","./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./DeveloperError","./GeometryOffsetAttribute","./GeometryType","./Matrix2","./Matrix3","./Matrix4","./PrimitiveType","./Quaternion","./Rectangle","./Transforms"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function w(n){n=u(n,u.EMPTY_OBJECT);r.typeOf.object("options.attributes",n.attributes);this.attributes=n.attributes;this.indices=n.indices;this.primitiveType=u(n.primitiveType,a.TRIANGLES);this.boundingSphere=n.boundingSphere;this.geometryType=u(n.geometryType,s.NONE);this.boundingSphereCV=n.boundingSphereCV;this.offsetAttribute=n.offsetAttribute}w.computeNumberOfVertices=function(n){var t,i,u,o;r.typeOf.object("geometry",n);t=-1;for(i in n.attributes)if(n.attributes.hasOwnProperty(i)&&f(n.attributes[i])&&f(n.attributes[i].values)){if(u=n.attributes[i],o=u.values.length/u.componentsPerAttribute,t!==o&&t!==-1)throw new e("All attribute lists must have the same number of attributes.");t=o}return t};var k=new i,d=new t,b=new l,g=[new i,new i,new i],nt=[new n,new n,new n],tt=[new n,new n,new n],it=new t,rt=new v,ut=new l,ft=new h;return w._textureCoordinateRotationPoints=function(r,u,f,e){var s,wt=y.center(e,k),bt=i.toCartesian(wt,f,d),kt=p.eastNorthUpToFixedFrame(bt,f,b),yt=l.inverse(kt,b),ot=nt,w=g,o,pt,a,et;for(w[0].longitude=e.west,w[0].latitude=e.south,w[1].longitude=e.west,w[1].latitude=e.north,w[2].longitude=e.east,w[2].latitude=e.south,o=it,s=0;s<3;s++)i.toCartesian(w[s],f,o),o=l.multiplyByPointAsVector(yt,o,o),ot[s].x=o.x,ot[s].y=o.y;var dt=v.fromAxisAngle(t.UNIT_Z,-u,rt),gt=c.fromQuaternion(dt,ut),ni=r.length,st=Number.POSITIVE_INFINITY,ht=Number.POSITIVE_INFINITY,at=Number.NEGATIVE_INFINITY,vt=Number.NEGATIVE_INFINITY;for(s=0;s<ni;s++)o=l.multiplyByPointAsVector(yt,r[s],o),o=c.multiplyByVector(gt,o,o),st=Math.min(st,o.x),ht=Math.min(ht,o.y),at=Math.max(at,o.x),vt=Math.max(vt,o.y);pt=h.fromRotation(u,ft);a=tt;a[0].x=st;a[0].y=ht;a[1].x=st;a[1].y=vt;a[2].x=at;a[2].y=ht;var ct=ot[0],ti=ot[2].x-ct.x,ii=ot[1].y-ct.y;for(s=0;s<3;s++)et=a[s],h.multiplyByVector(pt,et,et),et.x=(et.x-ct.x)/ti,et.y=(et.y-ct.y)/ii;var ri=a[0],ui=a[1],fi=a[2],lt=new Array(6);return n.pack(ri,lt),n.pack(ui,lt,2),n.pack(fi,lt,4),lt},w});t("Core/GeometryAttribute",["./defaultValue","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(r){if(r=n(r,n.EMPTY_OBJECT),!t(r.componentDatatype))throw new i("options.componentDatatype is required.");if(!t(r.componentsPerAttribute))throw new i("options.componentsPerAttribute is required.");if(r.componentsPerAttribute<1||r.componentsPerAttribute>4)throw new i("options.componentsPerAttribute must be between 1 and 4.");if(!t(r.values))throw new i("options.values is required.");this.componentDatatype=r.componentDatatype;this.componentsPerAttribute=r.componentsPerAttribute;this.normalize=n(r.normalize,!1);this.values=r.values}return r});t("Core/GeometryAttributes",["./defaultValue"],function(n){"use strict";function t(t){t=n(t,n.EMPTY_OBJECT);this.position=t.position;this.normal=t.normal;this.st=t.st;this.bitangent=t.bitangent;this.tangent=t.tangent;this.color=t.color}return t});t("Core/VertexFormat",["./defaultValue","./defined","./DeveloperError","./freezeObject"],function(n,t,i,r){"use strict";function u(t){t=n(t,n.EMPTY_OBJECT);this.position=n(t.position,!1);this.normal=n(t.normal,!1);this.st=n(t.st,!1);this.bitangent=n(t.bitangent,!1);this.tangent=n(t.tangent,!1);this.color=n(t.color,!1)}return u.POSITION_ONLY=r(new u({position:!0})),u.POSITION_AND_NORMAL=r(new u({position:!0,normal:!0})),u.POSITION_NORMAL_AND_ST=r(new u({position:!0,normal:!0,st:!0})),u.POSITION_AND_ST=r(new u({position:!0,st:!0})),u.POSITION_AND_COLOR=r(new u({position:!0,color:!0})),u.ALL=r(new u({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0})),u.DEFAULT=u.POSITION_NORMAL_AND_ST,u.packedLength=6,u.pack=function(r,u,f){if(!t(r))throw new i("value is required");if(!t(u))throw new i("array is required");return f=n(f,0),u[f++]=r.position?1:0,u[f++]=r.normal?1:0,u[f++]=r.st?1:0,u[f++]=r.tangent?1:0,u[f++]=r.bitangent?1:0,u[f]=r.color?1:0,u},u.unpack=function(r,f,e){if(!t(r))throw new i("array is required");return f=n(f,0),t(e)||(e=new u),e.position=r[f++]===1,e.normal=r[f++]===1,e.st=r[f++]===1,e.tangent=r[f++]===1,e.bitangent=r[f++]===1,e.color=r[f]===1,e},u.clone=function(n,i){return t(n)?(t(i)||(i=new u),i.position=n.position,i.normal=n.normal,i.st=n.st,i.tangent=n.tangent,i.bitangent=n.bitangent,i.color=n.color,i):undefined},u});t("Core/BoxGeometry",["./arrayFill","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./PrimitiveType","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(n){var t,u,s;if(n=f(n,f.EMPTY_OBJECT),t=n.minimum,u=n.maximum,r.typeOf.object("min",t),r.typeOf.object("max",u),e(n.offsetAttribute)&&n.offsetAttribute===l.TOP)throw new o("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");s=f(n.vertexFormat,v.DEFAULT);this._minimum=i.clone(t);this._maximum=i.clone(u);this._vertexFormat=s;this._offsetAttribute=n.offsetAttribute;this._workerName="createBoxGeometry"}var g=new i,p;y.fromDimensions=function(n){var t,u;return n=f(n,f.EMPTY_OBJECT),t=n.dimensions,r.typeOf.object("dimensions",t),r.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),r.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),r.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0),u=i.multiplyByScalar(t,.5,new i),new y({minimum:i.negate(u,new i),maximum:u,vertexFormat:n.vertexFormat,offsetAttribute:n.offsetAttribute})};y.fromAxisAlignedBoundingBox=function(n){return r.typeOf.object("boundingBox",n),new y({minimum:n.minimum,maximum:n.maximum})};y.packedLength=2*i.packedLength+v.packedLength+1;y.pack=function(n,t,u){return r.typeOf.object("value",n),r.defined("array",t),u=f(u,0),i.pack(n._minimum,t,u),i.pack(n._maximum,t,u+i.packedLength),v.pack(n._vertexFormat,t,u+2*i.packedLength),t[u+2*i.packedLength+v.packedLength]=f(n._offsetAttribute,-1),t};var w=new i,b=new i,k=new v,d={minimum:w,maximum:b,vertexFormat:k,offsetAttribute:undefined};return y.unpack=function(n,t,u){r.defined("array",n);t=f(t,0);var s=i.unpack(n,t,w),h=i.unpack(n,t+i.packedLength,b),c=v.unpack(n,t+2*i.packedLength,k),o=n[t+2*i.packedLength+v.packedLength];return e(u)?(u._minimum=i.clone(s,u._minimum),u._maximum=i.clone(h,u._maximum),u._vertexFormat=v.clone(c,u._vertexFormat),u._offsetAttribute=o===-1?undefined:o,u):(d.offsetAttribute=o===-1?undefined:o,new y(d))},y.createGeometry=function(r){var w=r._minimum,b=r._maximum,d=r._vertexFormat,nt,o,f,v,k,y,p,tt,it;if(!i.equals(w,b)){if(nt=new c,d.position&&(d.st||d.normal||d.tangent||d.bitangent)?(d.position&&(f=new Float64Array(72),f[0]=w.x,f[1]=w.y,f[2]=b.z,f[3]=b.x,f[4]=w.y,f[5]=b.z,f[6]=b.x,f[7]=b.y,f[8]=b.z,f[9]=w.x,f[10]=b.y,f[11]=b.z,f[12]=w.x,f[13]=w.y,f[14]=w.z,f[15]=b.x,f[16]=w.y,f[17]=w.z,f[18]=b.x,f[19]=b.y,f[20]=w.z,f[21]=w.x,f[22]=b.y,f[23]=w.z,f[24]=b.x,f[25]=w.y,f[26]=w.z,f[27]=b.x,f[28]=b.y,f[29]=w.z,f[30]=b.x,f[31]=b.y,f[32]=b.z,f[33]=b.x,f[34]=w.y,f[35]=b.z,f[36]=w.x,f[37]=w.y,f[38]=w.z,f[39]=w.x,f[40]=b.y,f[41]=w.z,f[42]=w.x,f[43]=b.y,f[44]=b.z,f[45]=w.x,f[46]=w.y,f[47]=b.z,f[48]=w.x,f[49]=b.y,f[50]=w.z,f[51]=b.x,f[52]=b.y,f[53]=w.z,f[54]=b.x,f[55]=b.y,f[56]=b.z,f[57]=w.x,f[58]=b.y,f[59]=b.z,f[60]=w.x,f[61]=w.y,f[62]=w.z,f[63]=b.x,f[64]=w.y,f[65]=w.z,f[66]=b.x,f[67]=w.y,f[68]=b.z,f[69]=w.x,f[70]=w.y,f[71]=b.z,nt.position=new h({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:f})),d.normal&&(v=new Float32Array(72),v[0]=0,v[1]=0,v[2]=1,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=1,v[9]=0,v[10]=0,v[11]=1,v[12]=0,v[13]=0,v[14]=-1,v[15]=0,v[16]=0,v[17]=-1,v[18]=0,v[19]=0,v[20]=-1,v[21]=0,v[22]=0,v[23]=-1,v[24]=1,v[25]=0,v[26]=0,v[27]=1,v[28]=0,v[29]=0,v[30]=1,v[31]=0,v[32]=0,v[33]=1,v[34]=0,v[35]=0,v[36]=-1,v[37]=0,v[38]=0,v[39]=-1,v[40]=0,v[41]=0,v[42]=-1,v[43]=0,v[44]=0,v[45]=-1,v[46]=0,v[47]=0,v[48]=0,v[49]=1,v[50]=0,v[51]=0,v[52]=1,v[53]=0,v[54]=0,v[55]=1,v[56]=0,v[57]=0,v[58]=1,v[59]=0,v[60]=0,v[61]=-1,v[62]=0,v[63]=0,v[64]=-1,v[65]=0,v[66]=0,v[67]=-1,v[68]=0,v[69]=0,v[70]=-1,v[71]=0,nt.normal=new h({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:v})),d.st&&(k=new Float32Array(48),k[0]=0,k[1]=0,k[2]=1,k[3]=0,k[4]=1,k[5]=1,k[6]=0,k[7]=1,k[8]=1,k[9]=0,k[10]=0,k[11]=0,k[12]=0,k[13]=1,k[14]=1,k[15]=1,k[16]=0,k[17]=0,k[18]=1,k[19]=0,k[20]=1,k[21]=1,k[22]=0,k[23]=1,k[24]=1,k[25]=0,k[26]=0,k[27]=0,k[28]=0,k[29]=1,k[30]=1,k[31]=1,k[32]=1,k[33]=0,k[34]=0,k[35]=0,k[36]=0,k[37]=1,k[38]=1,k[39]=1,k[40]=0,k[41]=0,k[42]=1,k[43]=0,k[44]=1,k[45]=1,k[46]=0,k[47]=1,nt.st=new h({componentDatatype:u.FLOAT,componentsPerAttribute:2,values:k})),d.tangent&&(y=new Float32Array(72),y[0]=1,y[1]=0,y[2]=0,y[3]=1,y[4]=0,y[5]=0,y[6]=1,y[7]=0,y[8]=0,y[9]=1,y[10]=0,y[11]=0,y[12]=-1,y[13]=0,y[14]=0,y[15]=-1,y[16]=0,y[17]=0,y[18]=-1,y[19]=0,y[20]=0,y[21]=-1,y[22]=0,y[23]=0,y[24]=0,y[25]=1,y[26]=0,y[27]=0,y[28]=1,y[29]=0,y[30]=0,y[31]=1,y[32]=0,y[33]=0,y[34]=1,y[35]=0,y[36]=0,y[37]=-1,y[38]=0,y[39]=0,y[40]=-1,y[41]=0,y[42]=0,y[43]=-1,y[44]=0,y[45]=0,y[46]=-1,y[47]=0,y[48]=-1,y[49]=0,y[50]=0,y[51]=-1,y[52]=0,y[53]=0,y[54]=-1,y[55]=0,y[56]=0,y[57]=-1,y[58]=0,y[59]=0,y[60]=1,y[61]=0,y[62]=0,y[63]=1,y[64]=0,y[65]=0,y[66]=1,y[67]=0,y[68]=0,y[69]=1,y[70]=0,y[71]=0,nt.tangent=new h({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:y})),d.bitangent&&(p=new Float32Array(72),p[0]=0,p[1]=1,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=0,p[7]=1,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=1,p[14]=0,p[15]=0,p[16]=1,p[17]=0,p[18]=0,p[19]=1,p[20]=0,p[21]=0,p[22]=1,p[23]=0,p[24]=0,p[25]=0,p[26]=1,p[27]=0,p[28]=0,p[29]=1,p[30]=0,p[31]=0,p[32]=1,p[33]=0,p[34]=0,p[35]=1,p[36]=0,p[37]=0,p[38]=1,p[39]=0,p[40]=0,p[41]=1,p[42]=0,p[43]=0,p[44]=1,p[45]=0,p[46]=0,p[47]=1,p[48]=0,p[49]=0,p[50]=1,p[51]=0,p[52]=0,p[53]=1,p[54]=0,p[55]=0,p[56]=1,p[57]=0,p[58]=0,p[59]=1,p[60]=0,p[61]=0,p[62]=1,p[63]=0,p[64]=0,p[65]=1,p[66]=0,p[67]=0,p[68]=1,p[69]=0,p[70]=0,p[71]=1,nt.bitangent=new h({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:p})),o=new Uint16Array(36),o[0]=0,o[1]=1,o[2]=2,o[3]=0,o[4]=2,o[5]=3,o[6]=6,o[7]=5,o[8]=4,o[9]=7,o[10]=6,o[11]=4,o[12]=8,o[13]=9,o[14]=10,o[15]=8,o[16]=10,o[17]=11,o[18]=14,o[19]=13,o[20]=12,o[21]=15,o[22]=14,o[23]=12,o[24]=18,o[25]=17,o[26]=16,o[27]=19,o[28]=18,o[29]=16,o[30]=20,o[31]=21,o[32]=22,o[33]=20,o[34]=22,o[35]=23):(f=new Float64Array(24),f[0]=w.x,f[1]=w.y,f[2]=w.z,f[3]=b.x,f[4]=w.y,f[5]=w.z,f[6]=b.x,f[7]=b.y,f[8]=w.z,f[9]=w.x,f[10]=b.y,f[11]=w.z,f[12]=w.x,f[13]=w.y,f[14]=b.z,f[15]=b.x,f[16]=w.y,f[17]=b.z,f[18]=b.x,f[19]=b.y,f[20]=b.z,f[21]=w.x,f[22]=b.y,f[23]=b.z,nt.position=new h({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:f}),o=new Uint16Array(36),o[0]=4,o[1]=5,o[2]=6,o[3]=4,o[4]=6,o[5]=7,o[6]=1,o[7]=0,o[8]=3,o[9]=1,o[10]=3,o[11]=2,o[12]=1,o[13]=6,o[14]=5,o[15]=1,o[16]=2,o[17]=6,o[18]=2,o[19]=3,o[20]=7,o[21]=2,o[22]=7,o[23]=6,o[24]=3,o[25]=0,o[26]=4,o[27]=3,o[28]=4,o[29]=7,o[30]=0,o[31]=1,o[32]=5,o[33]=0,o[34]=5,o[35]=4),tt=i.subtract(b,w,g),it=i.magnitude(tt)*.5,e(r._offsetAttribute)){var ut=f.length,rt=new Uint8Array(ut/3),ft=r._offsetAttribute===l.NONE?0:1;n(rt,ft);nt.applyOffset=new h({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:1,values:rt})}return new s({attributes:nt,indices:o,primitiveType:a.TRIANGLES,boundingSphere:new t(i.ZERO,it),offsetAttribute:r._offsetAttribute})}},y.getUnitBox=function(){return e(p)||(p=y.createGeometry(y.fromDimensions({dimensions:new i(1,1,1),vertexFormat:v.POSITION_ONLY}))),p},y});t("Core/BoxOutlineGeometry",["./arrayFill","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(n){n=f(n,f.EMPTY_OBJECT);var t=n.minimum,u=n.maximum;if(r.typeOf.object("min",t),r.typeOf.object("max",u),e(n.offsetAttribute)&&n.offsetAttribute===l.TOP)throw new o("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._min=i.clone(t);this._max=i.clone(u);this._offsetAttribute=n.offsetAttribute;this._workerName="createBoxOutlineGeometry"}var b=new i;v.fromDimensions=function(n){var t,u;return n=f(n,f.EMPTY_OBJECT),t=n.dimensions,r.typeOf.object("dimensions",t),r.typeOf.number.greaterThanOrEquals("dimensions.x",t.x,0),r.typeOf.number.greaterThanOrEquals("dimensions.y",t.y,0),r.typeOf.number.greaterThanOrEquals("dimensions.z",t.z,0),u=i.multiplyByScalar(t,.5,new i),new v({minimum:i.negate(u,new i),maximum:u,offsetAttribute:n.offsetAttribute})};v.fromAxisAlignedBoundingBox=function(n){return r.typeOf.object("boundindBox",n),new v({minimum:n.minimum,maximum:n.maximum})};v.packedLength=2*i.packedLength+1;v.pack=function(n,t,u){return r.typeOf.object("value",n),r.defined("array",t),u=f(u,0),i.pack(n._min,t,u),i.pack(n._max,t,u+i.packedLength),t[u+i.packedLength*2]=f(n._offsetAttribute,-1),t};var y=new i,p=new i,w={minimum:y,maximum:p,offsetAttribute:undefined};return v.unpack=function(n,t,u){r.defined("array",n);t=f(t,0);var s=i.unpack(n,t,y),h=i.unpack(n,t+i.packedLength,p),o=n[t+i.packedLength*2];return e(u)?(u._min=i.clone(s,u._min),u._max=i.clone(h,u._max),u._offsetAttribute=o===-1?undefined:o,u):(w.offsetAttribute=o===-1?undefined:o,new v(w))},v.createGeometry=function(r){var v=r._min,y=r._max,w,k;if(!i.equals(v,y)){var p=new c,o=new Uint16Array(24),f=new Float64Array(24);if(f[0]=v.x,f[1]=v.y,f[2]=v.z,f[3]=y.x,f[4]=v.y,f[5]=v.z,f[6]=y.x,f[7]=y.y,f[8]=v.z,f[9]=v.x,f[10]=y.y,f[11]=v.z,f[12]=v.x,f[13]=v.y,f[14]=y.z,f[15]=y.x,f[16]=v.y,f[17]=y.z,f[18]=y.x,f[19]=y.y,f[20]=y.z,f[21]=v.x,f[22]=y.y,f[23]=y.z,p.position=new h({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:f}),o[0]=4,o[1]=5,o[2]=5,o[3]=6,o[4]=6,o[5]=7,o[6]=7,o[7]=4,o[8]=0,o[9]=1,o[10]=1,o[11]=2,o[12]=2,o[13]=3,o[14]=3,o[15]=0,o[16]=0,o[17]=4,o[18]=1,o[19]=5,o[20]=2,o[21]=6,o[22]=3,o[23]=7,w=i.subtract(y,v,b),k=i.magnitude(w)*.5,e(r._offsetAttribute)){var g=f.length,d=new Uint8Array(g/3),nt=r._offsetAttribute===l.NONE?0:1;n(d,nt);p.applyOffset=new h({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})}return new s({attributes:p,indices:o,primitiveType:a.LINES,boundingSphere:new t(i.ZERO,k),offsetAttribute:r._offsetAttribute})}},v});t("Core/cancelAnimationFrame",["./defined"],function(n){"use strict";function i(n){t(n)}if(typeof window!="undefined"){var t=window.cancelAnimationFrame;return function(){if(!n(t))for(var r=["webkit","moz","ms","o"],i=0,u=r.length;i<u&&!n(t);)t=window[r[i]+"CancelAnimationFrame"],n(t)||(t=window[r[i]+"CancelRequestAnimationFrame"]),++i;n(t)||(t=clearTimeout)}(),i}});t("Core/CartographicGeocoderService",["../ThirdParty/when","./Cartesian3","./Check"],function(n,t,i){"use strict";function r(){}return r.prototype.geocode=function(r){var u,h,e,f,l;if(i.typeOf.string("query",r),u=r.match(/[^\s,\n]+/g),u.length===2||u.length===3){var o=+u[0],s=+u[1],c=u.length===3?+u[2]:300;if(isNaN(o)&&isNaN(s))for(h=/^(\d+.?\d*)([nsew])/i,e=0;e<u.length;++e)f=u[e].match(h),h.test(u[e])&&f.length===3&&(/^[ns]/i.test(f[2])?s=/^[n]/i.test(f[2])?+f[1]:-f[1]:/^[ew]/i.test(f[2])&&(o=/^[e]/i.test(f[2])?+f[1]:-f[1]));if(!isNaN(o)&&!isNaN(s)&&!isNaN(c))return l={displayName:r,destination:t.fromDegrees(o,s,c)},n.resolve([l])}return n.resolve([])},r});t("Core/Spline",["./Check","./defaultValue","./defined","./DeveloperError","./Math"],function(n,t,i,r,u){"use strict";function f(){this.times=undefined;this.points=undefined;r.throwInstantiationError()}return f.prototype.evaluate=r.throwInstantiationError,f.prototype.findTimeInterval=function(n,u){var e=this.times,o=e.length,f;if(!i(n))throw new r("time is required.");if(n<e[0]||n>e[o-1])throw new r("time is out of range.");if(u=t(u,0),n>=e[u]){if(u+1<o&&n<e[u+1])return u;if(u+2<o&&n<e[u+2])return u+1}else if(u-1>=0&&n>=e[u-1])return u-1;if(n>e[u]){for(f=u;f<o-1;++f)if(n>=e[f]&&n<e[f+1])break}else for(f=u-1;f>=0;--f)if(n>=e[f]&&n<e[f+1])break;return f===o-1&&(f=o-2),f},f.prototype.wrapTime=function(t){n.typeOf.number("time",t);var u=this.times,f=u[u.length-1],e=u[0],i=f-e,r;return t<e&&(r=Math.floor((e-t)/i)+1,t+=r*i),t>f&&(r=Math.floor((t-f)/i)+1,t-=r*i),t},f.prototype.clampTime=function(t){n.typeOf.number("time",t);var i=this.times;return u.clamp(t,i[0],i[i.length-1])},f});t("Core/LinearSpline",["./Cartesian3","./defaultValue","./defined","./defineProperties","./DeveloperError","./Spline"],function(n,t,i,r,u,f){"use strict";function e(n){n=t(n,t.EMPTY_OBJECT);var r=n.points,f=n.times;if(!i(r)||!i(f))throw new u("points and times are required.");if(r.length<2)throw new u("points.length must be greater than or equal to 2.");if(f.length!==r.length)throw new u("times.length must be equal to points.length.");this._times=f;this._points=r;this._lastTimeIndex=0}return r(e.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),e.prototype.findTimeInterval=f.prototype.findTimeInterval,e.prototype.wrapTime=f.prototype.wrapTime,e.prototype.clampTime=f.prototype.clampTime,e.prototype.evaluate=function(t,r){var e=this.points,f=this.times,u=this._lastTimeIndex=this.findTimeInterval(t,this._lastTimeIndex),o=(t-f[u])/(f[u+1]-f[u]);return i(r)||(r=new n),n.lerp(e[u],e[u+1],o,r)},e});t("Core/TridiagonalSystemSolver",["./Cartesian3","./defined","./DeveloperError"],function(n,t,i){"use strict";var r={};return r.solve=function(r,u,f,e){var l;if(!t(r)||!(r instanceof Array))throw new i("The array lower is required.");if(!t(u)||!(u instanceof Array))throw new i("The array diagonal is required.");if(!t(f)||!(f instanceof Array))throw new i("The array upper is required.");if(!t(e)||!(e instanceof Array))throw new i("The array right is required.");if(u.length!==e.length)throw new i("diagonal and right must have the same lengths.");if(r.length!==f.length)throw new i("lower and upper must have the same lengths.");else if(r.length!==u.length-1)throw new i("lower and upper must be one less than the length of diagonal.");for(var c=new Array(f.length),s=new Array(e.length),h=new Array(e.length),o=0;o<s.length;o++)s[o]=new n,h[o]=new n;for(c[0]=f[0]/u[0],s[0]=n.multiplyByScalar(e[0],1/u[0],s[0]),o=1;o<c.length;++o)l=1/(u[o]-c[o-1]*r[o-1]),c[o]=f[o]*l,s[o]=n.subtract(e[o],n.multiplyByScalar(s[o-1],r[o-1],s[o]),s[o]),s[o]=n.multiplyByScalar(s[o],l,s[o]);for(l=1/(u[o]-c[o-1]*r[o-1]),s[o]=n.subtract(e[o],n.multiplyByScalar(s[o-1],r[o-1],s[o]),s[o]),s[o]=n.multiplyByScalar(s[o],l,s[o]),h[h.length-1]=s[s.length-1],o=h.length-2;o>=0;--o)h[o]=n.subtract(s[o],n.multiplyByScalar(h[o+1],c[o],h[o]),h[o]);return h},r});t("Core/HermiteSpline",["./Cartesian3","./Cartesian4","./defaultValue","./defined","./defineProperties","./DeveloperError","./LinearSpline","./Matrix4","./Spline","./TridiagonalSystemSolver"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function b(t,i,u){var s=a,l=y,c=v,o=p,f,e;for(s.length=l.length=t.length-1,c.length=o.length=t.length,s[0]=c[0]=1,l[0]=0,e=o[0],r(e)||(e=o[0]=new n),n.clone(i,e),f=1;f<s.length-1;++f)s[f]=l[f]=1,c[f]=4,e=o[f],r(e)||(e=o[f]=new n),n.subtract(t[f+1],t[f-1],e),n.multiplyByScalar(e,3,e);return s[f]=0,l[f]=1,c[f]=4,e=o[f],r(e)||(e=o[f]=new n),n.subtract(t[f+1],t[f-1],e),n.multiplyByScalar(e,3,e),c[f+1]=1,e=o[f+1],r(e)||(e=o[f+1]=new n),n.clone(u,e),h.solve(s,c,l,o)}function k(t){var e=a,s=y,o=v,f=p,u,i;for(e.length=s.length=t.length-1,o.length=f.length=t.length,e[0]=s[0]=1,o[0]=2,i=f[0],r(i)||(i=f[0]=new n),n.subtract(t[1],t[0],i),n.multiplyByScalar(i,3,i),u=1;u<e.length;++u)e[u]=s[u]=1,o[u]=4,i=f[u],r(i)||(i=f[u]=new n),n.subtract(t[u+1],t[u-1],i),n.multiplyByScalar(i,3,i);return o[u]=2,i=f[u],r(i)||(i=f[u]=new n),n.subtract(t[u],t[u-1],i),n.multiplyByScalar(i,3,i),h.solve(e,o,s,f)}function c(n){n=i(n,i.EMPTY_OBJECT);var t=n.points,e=n.times,u=n.inTangents,o=n.outTangents;if(!r(t)||!r(e)||!r(u)||!r(o))throw new f("times, points, inTangents, and outTangents are required.");if(t.length<2)throw new f("points.length must be greater than or equal to 2.");if(e.length!==t.length)throw new f("times.length must be equal to points.length.");if(u.length!==o.length||u.length!==t.length-1)throw new f("inTangents and outTangents must have a length equal to points.length - 1.");this._times=e;this._points=t;this._inTangents=u;this._outTangents=o;this._lastTimeIndex=0}var a=[],v=[],y=[],p=[],w,l;return u(c.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},inTangents:{get:function(){return this._inTangents}},outTangents:{get:function(){return this._outTangents}}}),c.createC1=function(n){var o,s;n=i(n,i.EMPTY_OBJECT);var u=n.times,e=n.points,t=n.tangents;if(!r(e)||!r(u)||!r(t))throw new f("points, times and tangents are required.");if(e.length<2)throw new f("points.length must be greater than or equal to 2.");if(u.length!==e.length||u.length!==t.length)throw new f("times, points and tangents must have the same length.");return o=t.slice(0,t.length-1),s=t.slice(1,t.length),new c({times:u,points:e,inTangents:s,outTangents:o})},c.createNaturalCubic=function(n){var u,t;if(n=i(n,i.EMPTY_OBJECT),u=n.times,t=n.points,!r(t)||!r(u))throw new f("points and times are required.");if(t.length<2)throw new f("points.length must be greater than or equal to 2.");if(u.length!==t.length)throw new f("times.length must be equal to points.length.");if(t.length<3)return new e({points:t,times:u});var o=k(t),s=o.slice(0,o.length-1),h=o.slice(1,o.length);return new c({times:u,points:t,inTangents:h,outTangents:s})},c.createClampedCubic=function(n){n=i(n,i.EMPTY_OBJECT);var u=n.times,t=n.points,s=n.firstTangent,h=n.lastTangent;if(!r(t)||!r(u)||!r(s)||!r(h))throw new f("points, times, firstTangent and lastTangent are required.");if(t.length<2)throw new f("points.length must be greater than or equal to 2.");if(u.length!==t.length)throw new f("times.length must be equal to points.length.");if(t.length<3)return new e({points:t,times:u});var o=b(t,s,h),l=o.slice(0,o.length-1),a=o.slice(1,o.length);return new c({times:u,points:t,inTangents:a,outTangents:l})},c.hermiteCoefficientMatrix=new o(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0),c.prototype.findTimeInterval=s.prototype.findTimeInterval,w=new t,l=new n,c.prototype.wrapTime=s.prototype.wrapTime,c.prototype.clampTime=s.prototype.clampTime,c.prototype.evaluate=function(t,i){var e;r(i)||(i=new n);var a=this.points,h=this.times,v=this.inTangents,y=this.outTangents,u=this._lastTimeIndex=this.findTimeInterval(t,this._lastTimeIndex),s=(t-h[u])/(h[u+1]-h[u]),f=w;return f.z=s,f.y=s*s,f.x=f.y*s,f.w=1,e=o.multiplyByVector(c.hermiteCoefficientMatrix,f,f),i=n.multiplyByScalar(a[u],e.x,i),n.multiplyByScalar(a[u+1],e.y,l),n.add(i,l,i),n.multiplyByScalar(y[u],e.z,l),n.add(i,l,i),n.multiplyByScalar(v[u],e.w,l),n.add(i,l,i)},c});t("Core/CatmullRomSpline",["./Cartesian3","./Cartesian4","./Check","./defaultValue","./defined","./defineProperties","./HermiteSpline","./Matrix4","./Spline"],function(n,t,i,r,u,f,e,o,s){"use strict";function v(t){var i=t.points,r=t.times;if(i.length<3){var f=r[0],s=1/(r[1]-f),v=i[0],y=i[1];return function(t,i){u(i)||(i=new n);var r=(t-f)*s;return n.lerp(v,y,r,i)}}return function(f,s){var k,d,w,b,p;u(s)||(s=new n);var v=t._lastTimeIndex=t.findTimeInterval(f,t._lastTimeIndex),g=(f-r[v])/(r[v+1]-r[v]),y=a;return y.z=g,y.y=g*g,y.x=y.y*g,y.w=1,v===0?(k=i[0],d=i[1],w=t.firstTangent,b=n.subtract(i[2],k,l),n.multiplyByScalar(b,.5,b),p=o.multiplyByVector(e.hermiteCoefficientMatrix,y,y)):v===i.length-2?(k=i[v],d=i[v+1],b=t.lastTangent,w=n.subtract(d,i[v-1],l),n.multiplyByScalar(w,.5,w),p=o.multiplyByVector(e.hermiteCoefficientMatrix,y,y)):(k=i[v-1],d=i[v],w=i[v+1],b=i[v+2],p=o.multiplyByVector(h.catmullRomCoefficientMatrix,y,y)),s=n.multiplyByScalar(k,p.x,s),n.multiplyByScalar(d,p.y,c),n.add(s,c,s),n.multiplyByScalar(w,p.z,c),n.add(s,c,s),n.multiplyByScalar(b,p.w,c),n.add(s,c,s)}}function h(t){var s;t=r(t,r.EMPTY_OBJECT);var f=t.points,h=t.times,e=t.firstTangent,o=t.lastTangent;i.defined("points",f);i.defined("times",h);i.typeOf.number.greaterThanOrEquals("points.length",f.length,2);i.typeOf.number.equals("times.length","points.length",h.length,f.length);f.length>2&&(u(e)||(e=y,n.multiplyByScalar(f[1],2,e),n.subtract(e,f[2],e),n.subtract(e,f[0],e),n.multiplyByScalar(e,.5,e)),u(o)||(s=f.length-1,o=p,n.multiplyByScalar(f[s-1],2,o),n.subtract(f[s],o,o),n.add(o,f[s-2],o),n.multiplyByScalar(o,.5,o)));this._times=h;this._points=f;this._firstTangent=n.clone(e);this._lastTangent=n.clone(o);this._evaluateFunction=v(this);this._lastTimeIndex=0}var a=new t,l=new n,c=new n,y=new n,p=new n;return f(h.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},firstTangent:{get:function(){return this._firstTangent}},lastTangent:{get:function(){return this._lastTangent}}}),h.catmullRomCoefficientMatrix=new o(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0),h.prototype.findTimeInterval=s.prototype.findTimeInterval,h.prototype.wrapTime=s.prototype.wrapTime,h.prototype.clampTime=s.prototype.clampTime,h.prototype.evaluate=function(n,t){return this._evaluateFunction(n,t)},h}),function(n,i){typeof exports=="object"&&typeof module!="undefined"?module.exports=i():typeof t=="function"&&t.amd?t("ThirdParty/purify",i):n.DOMPurify=i()}(this,function(){"use strict";function n(n,t){for(var i=t.length;i--;)typeof t[i]=="string"&&(t[i]=t[i].toLowerCase()),n[t[i]]=!0;return n}function a(n){var i={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(i[t]=n[t]);return i}function t(n){if(Array.isArray(n)){for(var t=0,i=Array(n.length);t<n.length;t++)i[t]=n[t];return i}return Array.from(n)}function v(){var it=arguments.length>0&&arguments[0]!==undefined?arguments[0]:nt(),tt=function(n){return v(n)},vt;if(tt.version="1.0.8",tt.removed=[],!it||!it.document||it.document.nodeType!==9)return tt.isSupported=!1,tt;var ci=it.document,li=!1,ai=!1,ot=it.document,vi=it.DocumentFragment,lr=it.HTMLTemplateElement,lt=it.Node,at=it.NodeFilter,yi=it.NamedNodeMap,ar=yi===undefined?it.NamedNodeMap||it.MozNamedAttrMap:yi,vr=it.Text,yr=it.Comment,pr=it.DOMParser;typeof lr=="function"&&(vt=ot.createElement("template"),vt.content&&vt.content.ownerDocument&&(ot=vt.content.ownerDocument));var yt=ot,dt=yt.implementation,wr=yt.createNodeIterator,br=yt.getElementsByTagName,kr=yt.createDocumentFragment,dr=ci.importNode,ft={};tt.isSupported=dt&&typeof dt.createHTMLDocument!="undefined"&&ot.documentMode!==9;var pi=y,wi=p,gr=w,nu=b,tu=d,bi=g,gt=k,rt=null,ki=n({},[].concat(t(f),t(e),t(o),t(s),t(h))),ut=null,di=n({},[].concat(t(c),t(u),t(l),t(i))),ni=null,ti=null,gi=!0,ii=!0,nr=!1,tr=!1,pt=!1,ht=!1,ri=!1,ui=!1,ct=!1,fi=!1,ir=!1,rr=!0,ei=!0,wt=!1,st={},iu=n({},["audio","head","math","script","style","template","svg","video"]),ru=n({},["audio","video","img","source","image"]),ur=n({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),bt=null,uu=ot.createElement("form"),oi=function(v){(typeof v=="undefined"?"undefined":r(v))!=="object"&&(v={});rt="ALLOWED_TAGS"in v?n({},v.ALLOWED_TAGS):ki;ut="ALLOWED_ATTR"in v?n({},v.ALLOWED_ATTR):di;ni="FORBID_TAGS"in v?n({},v.FORBID_TAGS):{};ti="FORBID_ATTR"in v?n({},v.FORBID_ATTR):{};st="USE_PROFILES"in v?v.USE_PROFILES:!1;gi=v.ALLOW_ARIA_ATTR!==!1;ii=v.ALLOW_DATA_ATTR!==!1;nr=v.ALLOW_UNKNOWN_PROTOCOLS||!1;tr=v.SAFE_FOR_JQUERY||!1;pt=v.SAFE_FOR_TEMPLATES||!1;ht=v.WHOLE_DOCUMENT||!1;ct=v.RETURN_DOM||!1;fi=v.RETURN_DOM_FRAGMENT||!1;ir=v.RETURN_DOM_IMPORT||!1;ui=v.FORCE_BODY||!1;rr=v.SANITIZE_DOM!==!1;ei=v.KEEP_CONTENT!==!1;wt=v.IN_PLACE||!1;gt=v.ALLOWED_URI_REGEXP||gt;pt&&(ii=!1);fi&&(ct=!0);st&&(rt=n({},[].concat(t(h))),ut=[],st.html===!0&&(n(rt,f),n(ut,c)),st.svg===!0&&(n(rt,e),n(ut,u),n(ut,i)),st.svgFilters===!0&&(n(rt,o),n(ut,u),n(ut,i)),st.mathMl===!0&&(n(rt,s),n(ut,l),n(ut,i)));v.ADD_TAGS&&(rt===ki&&(rt=a(rt)),n(rt,v.ADD_TAGS));v.ADD_ATTR&&(ut===di&&(ut=a(ut)),n(ut,v.ADD_ATTR));v.ADD_URI_SAFE_ATTR&&n(ur,v.ADD_URI_SAFE_ATTR);ei&&(rt["#text"]=!0);ht&&n(rt,["html","head","body"]);rt.table&&n(rt,["tbody"]);Object&&"freeze"in Object&&Object.freeze(v);bt=v},si=function(n){tt.removed.push({element:n});try{n.parentNode.removeChild(n)}catch(t){n.outerHTML=""}},hi=function(n,t){try{tt.removed.push({attribute:t.getAttributeNode(n),from:t})}catch(i){tt.removed.push({attribute:null,from:t})}t.removeAttribute(n)},kt=function(t){var i=void 0,r=void 0,f,e,u;if(ui?t="<remove><\/remove>"+t:(f=t.match(/^[\s]+/),r=f&&f[0],r&&(t=t.slice(r.length))),li)try{i=(new pr).parseFromString(t,"text/html")}catch(o){}return ai&&n(ni,["title"]),i&&i.documentElement||(i=dt.createHTMLDocument(""),e=i,u=e.body,u.parentNode.removeChild(u.parentNode.firstElementChild),u.outerHTML=t),r&&i.body.insertBefore(ot.createTextNode(r),i.body.childNodes[0]||null),br.call(i,ht?"html":"body")[0]};tt.isSupported&&(function(){try{var n=kt('<svg><p><style><img src="<\/style><img src=x onerror=alert(1)//">');n.querySelector("svg img")&&(li=!0)}catch(t){}}(),function(){try{var n=kt("<x/><title>&lt;/title&gt;&lt;img&gt;");n.querySelector("title").textContent.match(/<\/title/)&&(ai=!0)}catch(t){}}());var fr=function(n){return wr.call(n.ownerDocument||n,n,at.SHOW_ELEMENT|at.SHOW_COMMENT|at.SHOW_TEXT,function(){return at.FILTER_ACCEPT},!1)},fu=function(n){return n instanceof vr||n instanceof yr?!1:typeof n.nodeName!="string"||typeof n.textContent!="string"||typeof n.removeChild!="function"||!(n.attributes instanceof ar)||typeof n.removeAttribute!="function"||typeof n.setAttribute!="function"?!0:!1},er=function(n){return(typeof lt=="undefined"?"undefined":r(lt))==="object"?n instanceof lt:n&&(typeof n=="undefined"?"undefined":r(n))==="object"&&typeof n.nodeType=="number"&&typeof n.nodeName=="string"},et=function(n,t,i){ft[n]&&ft[n].forEach(function(n){n.call(tt,t,i,bt)})},or=function(n){var t=void 0,i;if(et("beforeSanitizeElements",n,null),fu(n))return si(n),!0;if(i=n.nodeName.toLowerCase(),et("uponSanitizeElement",n,{tagName:i,allowedTags:rt}),!rt[i]||ni[i]){if(ei&&!iu[i]&&typeof n.insertAdjacentHTML=="function")try{n.insertAdjacentHTML("AfterEnd",n.innerHTML)}catch(r){}return si(n),!0}return!tr||n.firstElementChild||n.content&&n.content.firstElementChild||!/</g.test(n.textContent)||(tt.removed.push({element:n.cloneNode()}),n.innerHTML=n.innerHTML?n.innerHTML.replace(/</g,"&lt;"):n.textContent.replace(/</g,"&lt;")),pt&&n.nodeType===3&&(t=n.textContent,t=t.replace(pi," "),t=t.replace(wi," "),n.textContent!==t&&(tt.removed.push({element:n.cloneNode()}),n.textContent=t)),et("afterSanitizeElements",n,null),!1},sr=function(n,t,i){return rr&&(t==="id"||t==="name")&&(i in ot||i in uu)?!1:(pt&&(i=i.replace(pi," "),i=i.replace(wi," ")),(!ii||!gr.test(t))&&(!gi||!nu.test(t))&&(!ut[t]||ti[t]||!ur[t]&&!gt.test(i.replace(bi,""))&&(t!=="src"&&t!=="xlink:href"||n==="script"||i.indexOf("data:")!==0||!ru[n])&&(!nr||tu.test(i.replace(bi,"")))&&i))?!1:!0},hr=function(n){var o=void 0,i=void 0,r=void 0,s=void 0,e=void 0,t,u,l;if(et("beforeSanitizeAttributes",n,null),t=n.attributes,t){for(u={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ut},e=t.length;e--;){o=t[e];var h=o,f=h.name,c=h.namespaceURI;if(i=o.value.trim(),r=f.toLowerCase(),u.attrName=r,u.attrValue=i,u.keepAttr=!0,et("uponSanitizeAttribute",n,u),i=u.attrValue,r==="name"&&n.nodeName==="IMG"&&t.id)s=t.id,t=Array.prototype.slice.apply(t),hi("id",n),hi(f,n),t.indexOf(s)>e&&n.setAttribute("id",s.value);else if(n.nodeName==="INPUT"&&r==="type"&&i==="file"&&(ut[r]||!ti[r]))continue;else f==="id"&&n.setAttribute(f,""),hi(f,n);if(u.keepAttr&&(l=n.nodeName.toLowerCase(),sr(l,r,i)))try{c?n.setAttributeNS(c,f,i):n.setAttribute(f,i);tt.removed.pop()}catch(a){}}et("afterSanitizeAttributes",n,null)}},cr=function cr(n){var t=void 0,i=fr(n);for(et("beforeSanitizeShadowDOM",n,null);t=i.nextNode();)(et("uponSanitizeShadowNode",t,null),or(t))||(t.content instanceof vi&&cr(t.content),hr(t));et("afterSanitizeShadowDOM",n,null)};return tt.sanitize=function(n,t){var i=void 0,e=void 0,u=void 0,o=void 0,f=void 0,s;if(n||(n="<!-->"),typeof n!="string"&&!er(n))if(typeof n.toString!="function")throw new TypeError("toString is not a function");else if(n=n.toString(),typeof n!="string")throw new TypeError("dirty is not a string, aborting");if(!tt.isSupported){if(r(it.toStaticHTML)==="object"||typeof it.toStaticHTML=="function"){if(typeof n=="string")return it.toStaticHTML(n);if(er(n))return it.toStaticHTML(n.outerHTML)}return n}if(ri||oi(t),tt.removed=[],!wt)if(n instanceof lt)i=kt("<!-->"),e=i.ownerDocument.importNode(n,!0),e.nodeType===1&&e.nodeName==="BODY"?i=e:i.appendChild(e);else{if(!ct&&!ht&&n.indexOf("<")===-1)return n;if(i=kt(n),!i)return ct?null:""}for(i&&ui&&si(i.firstChild),s=fr(wt?n:i);u=s.nextNode();)(u.nodeType!==3||u!==o)&&(or(u)||(u.content instanceof vi&&cr(u.content),hr(u),o=u));if(wt)return n;if(ct){if(fi)for(f=kr.call(i.ownerDocument);i.firstChild;)f.appendChild(i.firstChild);else f=i;return ir&&(f=dr.call(ci,f,!0)),f}return ht?i.outerHTML:i.innerHTML},tt.setConfig=function(n){oi(n);ri=!0},tt.clearConfig=function(){bt=null;ri=!1},tt.isValidAttribute=function(n,t,i){bt||oi({});var r=n.toLowerCase(),u=t.toLowerCase();return sr(r,u,i)},tt.addHook=function(n,t){typeof t=="function"&&(ft[n]=ft[n]||[],ft[n].push(t))},tt.removeHook=function(n){ft[n]&&ft[n].pop()},tt.removeHooks=function(n){ft[n]&&(ft[n]=[])},tt.removeAllHooks=function(){ft={}},tt}var f=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"],e=["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"],o=["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"],s=["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"],h=["#text"],c=["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","crossorigin","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","integrity","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns"],u=["accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"],l=["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"],i=["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"],y=/\{\{[\s\S]*|[\s\S]*\}\}/gm,p=/<%[\s\S]*|[\s\S]*%>/gm,w=/^data-[\-\w.\u00B7-\uFFFF]/,b=/^aria-[\-\w]+$/,k=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,d=/^(?:\w+script|data):/i,g=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},nt=function(){return typeof window=="undefined"?null:window};return v()});t("Core/Credit",["../ThirdParty/purify","./defaultValue","./defined","./defineProperties","./Check"],function(n,t,i,r,u){"use strict";function f(n,r){u.typeOf.string("html",n);var f,s=n;i(e[s])?f=e[s]:(f=o++,e[s]=f);r=t(r,!1);this._id=f;this._html=n;this._showOnScreen=r;this._element=undefined}var o=0,e={};return r(f.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen}},element:{get:function(){var f,t,u,r;if(!i(this._element)){for(f=n.sanitize(this._html),t=document.createElement("div"),t._creditId=this._id,t.style.display="inline",t.innerHTML=f,u=t.querySelectorAll("a"),r=0;r<u.length;r++)u[r].setAttribute("target","_blank");this._element=t}return this._element}}}),f.equals=function(n,t){return n===t||i(n)&&i(t)&&n._id===t._id},f.prototype.equals=function(n){return f.equals(this,n)},f.getIonCredit=function(n){var r=i(n.collapsible)&&!n.collapsible,t=new f(n.html,r);return t._isIon=t.html.indexOf("ion-credit.png")!==-1,t},f.clone=function(n){if(i(n))return new f(n.html,n.showOnScreen)},f});t("Core/EllipsoidalOccluder",["./BoundingSphere","./Cartesian3","./Check","./defaultValue","./defined","./defineProperties","./Rectangle"],function(n,t,i,r,u,f,e){"use strict";function o(n,r){i.typeOf.object("ellipsoid",n);this._ellipsoid=n;this._cameraPosition=new t;this._cameraPositionInScaledSpace=new t;this._distanceToLimbInScaledSpaceSquared=0;u(r)&&(this.cameraPosition=r)}function y(n,i,r){var o=n.transformPositionToScaledSpace(i,a),u=t.magnitudeSquared(o),f=Math.sqrt(u),e=t.divideByScalar(o,f,v);u=Math.max(1,u);f=Math.max(1,f);var h=t.dot(e,r),c=t.magnitude(t.cross(e,r,e)),s=1/f,l=Math.sqrt(u-1)*s;return 1/(h*s-c*l)}function p(n,i,r){return i<=0||i===1/0||i!==i?undefined:t.multiplyByScalar(n,i,r)}function w(n,i){return t.equals(i,t.ZERO)?i:(n.transformPositionToScaledSpace(i,h),t.normalize(h,h))}var c,s,l,a,v,h;return f(o.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(n){var r=this._ellipsoid,i=r.transformPositionToScaledSpace(n,this._cameraPositionInScaledSpace),u=t.magnitudeSquared(i)-1;t.clone(n,this._cameraPosition);this._cameraPositionInScaledSpace=i;this._distanceToLimbInScaledSpaceSquared=u}}}),c=new t,o.prototype.isPointVisible=function(n){var t=this._ellipsoid,i=t.transformPositionToScaledSpace(n,c);return this.isScaledSpacePointVisible(i)},o.prototype.isScaledSpacePointVisible=function(n){var u=this._cameraPositionInScaledSpace,r=this._distanceToLimbInScaledSpaceSquared,f=t.subtract(n,u,c),i=-t.dot(f,u),e=r<0?i>0:i>r&&i*i/t.magnitudeSquared(f)>r;return!e},o.prototype.computeHorizonCullingPoint=function(n,r,f){var e,c,l,a;i.typeOf.object("directionToPoint",n);i.defined("positions",r);u(f)||(f=new t);var s=this._ellipsoid,h=w(s,n),o=0;for(e=0,c=r.length;e<c;++e)l=r[e],a=y(s,l,h),o=Math.max(o,a);return p(h,o,f)},s=new t,o.prototype.computeHorizonCullingPointFromVertices=function(n,f,e,o,h){var c,b,k;i.typeOf.object("directionToPoint",n);i.defined("vertices",f);i.typeOf.number("stride",e);u(h)||(h=new t);o=r(o,t.ZERO);var a=this._ellipsoid,v=w(a,n),l=0;for(c=0,b=f.length;c<b;c+=e)s.x=f[c]+o.x,s.y=f[c+1]+o.y,s.z=f[c+2]+o.z,k=y(a,s,v),l=Math.max(l,k);return p(v,l,h)},l=[],o.prototype.computeHorizonCullingPointFromRectangle=function(r,u,f){i.typeOf.object("rectangle",r);var o=e.subsample(r,u,0,l),s=n.fromPoints(o);return t.magnitude(s.center)<.1*u.minimumRadius?undefined:this.computeHorizonCullingPoint(s.center,o,f)},a=new t,v=new t,h=new t,o});t("Core/QuadraticRealPolynomial",["./DeveloperError","./Math"],function(n,t){"use strict";function r(n,i,r){var u=n+i;return t.sign(n)!==t.sign(i)&&Math.abs(u/Math.max(Math.abs(n),Math.abs(i)))<r?0:u}var i={};return i.computeDiscriminant=function(t,i,r){if(typeof t!="number")throw new n("a is a required number.");if(typeof i!="number")throw new n("b is a required number.");if(typeof r!="number")throw new n("c is a required number.");return i*i-4*t*r},i.computeRealRoots=function(i,u,f){var e,o,s,c,h;if(typeof i!="number")throw new n("a is a required number.");if(typeof u!="number")throw new n("b is a required number.");if(typeof f!="number")throw new n("c is a required number.");if(i===0)return u===0?[]:[-f/u];if(u===0)return f===0?[0,0]:(o=Math.abs(f),s=Math.abs(i),o<s&&o/s<t.EPSILON14)?[0,0]:o>s&&s/o<t.EPSILON14?[]:(e=-f/i,e<0)?[]:(c=Math.sqrt(e),[-c,c]);if(f===0)return(e=-u/i,e<0)?[e,0]:[0,e];var a=u*u,v=4*i*f,l=r(a,-v,t.EPSILON14);return l<0?[]:(h=-.5*r(u,t.sign(u)*Math.sqrt(l),t.EPSILON14),u>0)?[h/i,f/h]:[f/h,h/i]},i});t("Core/CubicRealPolynomial",["./DeveloperError","./QuadraticRealPolynomial"],function(n,t){"use strict";function r(n,t,i,r){var o=n,u=t/3,f=i/3,s=r,at=o*f,vt=u*s,tt=u*u,it=f*f,p=o*f-tt,v=o*s-u*f,w=u*s-it,rt=4*p*w-v*v,h,c,ut,b,k,yt,ft,y;if(rt<0){tt*vt>=at*it?(ut=o,b=p,k=-2*u*p+o*v):(ut=s,b=w,k=-s*v+2*f*w);yt=k<0?-1:1;ft=-yt*Math.abs(ut)*Math.sqrt(-rt);c=-k+ft;var et=c/2,d=et<0?-Math.pow(-et,1/3):Math.pow(et,1/3),ot=c===ft?-d:-b/d;return(h=b<=0?d+ot:-k/(d*d+ot*ot+b),tt*vt>=at*it)?[(h-u)/o]:[-s/(h+f)]}var kt=p,dt=-2*u*p+o*v,gt=w,ni=-s*v+2*f*w,pt=Math.sqrt(rt),wt=Math.sqrt(3)/2,g=Math.abs(Math.atan2(o*pt,-dt)/3);h=2*Math.sqrt(-kt);y=Math.cos(g);c=h*y;var nt=h*(-y/2-wt*Math.sin(g)),st=c+nt>2*u?c-u:nt-u,ht=o,l=st/ht;g=Math.abs(Math.atan2(s*pt,-ni)/3);h=2*Math.sqrt(-gt);y=Math.cos(g);c=h*y;nt=h*(-y/2-wt*Math.sin(g));var ct=-s,lt=c+nt<2*f?c+f:nt+f,e=ct/lt,ti=ht*lt,bt=-st*lt-ht*ct,ii=st*ct,a=(f*bt-u*ii)/(-u*bt+f*ti);return l<=a?l<=e?a<=e?[l,a,e]:[l,e,a]:[e,l,a]:l<=e?[a,l,e]:a<=e?[a,e,l]:[e,a,l]}var i={};return i.computeDiscriminant=function(t,i,r,u){if(typeof t!="number")throw new n("a is a required number.");if(typeof i!="number")throw new n("b is a required number.");if(typeof r!="number")throw new n("c is a required number.");if(typeof u!="number")throw new n("d is a required number.");var o=t*t,f=i*i,e=r*r,s=u*u;return 18*t*i*r*u+f*e-27*o*s-4*(t*e*r+f*i*u)},i.computeRealRoots=function(i,u,f,e){var o,s,h;if(typeof i!="number")throw new n("a is a required number.");if(typeof u!="number")throw new n("b is a required number.");if(typeof f!="number")throw new n("c is a required number.");if(typeof e!="number")throw new n("d is a required number.");return i===0?t.computeRealRoots(u,f,e):u===0?f===0?e===0?[0,0,0]:(s=-e/i,h=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3),[h,h,h]):e===0?(o=t.computeRealRoots(i,0,f),o.Length===0)?[0]:[o[0],0,o[1]]:r(i,0,f,e):f===0?e===0?(s=-u/i,s<0)?[s,0,0]:[0,0,s]:r(i,u,0,e):e===0?(o=t.computeRealRoots(i,u,f),o.length===0)?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]:r(i,u,f,e)},i});t("Core/QuarticRealPolynomial",["./CubicRealPolynomial","./DeveloperError","./Math","./QuadraticRealPolynomial"],function(n,t,i,r){"use strict";function u(t,u,f,e){var p=t*t,c=u-3*p/8,w=f-u*t/2+p*t/8,tt=e-f*t/4+u*p/16-3*p*p/256,d=n.computeRealRoots(1,2*c,c*c-4*tt,-w*w),h,l,b,a,v,y,g,nt;if(d.length>0){if(h=-t/4,l=d[d.length-1],Math.abs(l)<i.EPSILON14){if(b=r.computeRealRoots(1,c,tt),b.length===2){if(a=b[0],v=b[1],a>=0&&v>=0)return g=Math.sqrt(a),nt=Math.sqrt(v),[h-nt,h-g,h+g,h+nt];if(a>=0&&v<0)return y=Math.sqrt(a),[h-y,h+y];if(a<0&&v>=0)return y=Math.sqrt(v),[h-y,h+y]}return[]}if(l>0){var k=Math.sqrt(l),it=(c+l-w/k)/2,rt=(c+l+w/k)/2,s=r.computeRealRoots(1,k,it),o=r.computeRealRoots(1,-k,rt);return s.length!==0?(s[0]+=h,s[1]+=h,o.length!==0)?(o[0]+=h,o[1]+=h,s[1]<=o[0])?[s[0],s[1],o[0],o[1]]:o[1]<=s[0]?[o[0],o[1],s[0],s[1]]:s[0]>=o[0]&&s[1]<=o[1]?[o[0],s[0],s[1],o[1]]:o[0]>=s[0]&&o[1]<=s[1]?[s[0],o[0],o[1],s[1]]:s[0]>o[0]&&s[0]<o[1]?[o[0],s[0],o[1],s[1]]:[s[0],o[0],s[1],o[1]]:s:o.length!==0?(o[0]+=h,o[1]+=h,o):[]}}return[]}function f(t,u,f,e){var ft=f*f,et=u*u,g=t*t,ot=-2*u,st=f*t+et-4*e,ht=g*e-f*u*t+ft,tt=n.computeRealRoots(1,ot,st,ht),k,d,v,y,p,w,s,o;if(tt.length>0){var h=tt[0],nt=u-h,it=nt*nt,b=t/2,c=nt/2,rt=it-4*e,ct=it+4*Math.abs(e),ut=g-4*h,lt=g+4*Math.abs(h),l,a;if(h<0||rt*lt<ut*ct?(k=Math.sqrt(ut),l=k/2,a=k===0?0:(t*c-f)/k):(d=Math.sqrt(rt),l=d===0?0:(t*c-f)/d,a=d/2),b===0&&l===0?(v=0,y=0):i.sign(b)===i.sign(l)?(v=b+l,y=h/v):(y=b-l,v=h/y),c===0&&a===0?(p=0,w=0):i.sign(c)===i.sign(a)?(p=c+a,w=e/p):(w=c-a,p=e/w),s=r.computeRealRoots(1,v,p),o=r.computeRealRoots(1,y,w),s.length!==0)return o.length!==0?s[1]<=o[0]?[s[0],s[1],o[0],o[1]]:o[1]<=s[0]?[o[0],o[1],s[0],s[1]]:s[0]>=o[0]&&s[1]<=o[1]?[o[0],s[0],s[1],o[1]]:o[0]>=s[0]&&o[1]<=s[1]?[s[0],o[0],o[1],s[1]]:s[0]>o[0]&&s[0]<o[1]?[o[0],s[0],o[1],s[1]]:[s[0],o[0],s[1],o[1]]:s;if(o.length!==0)return o}return[]}var e={};return e.computeDiscriminant=function(n,i,r,u,f){if(typeof n!="number")throw new t("a is a required number.");if(typeof i!="number")throw new t("b is a required number.");if(typeof r!="number")throw new t("c is a required number.");if(typeof u!="number")throw new t("d is a required number.");if(typeof f!="number")throw new t("e is a required number.");var h=n*n,y=h*n,e=i*i,c=e*i,s=r*r,l=s*r,o=u*u,a=o*u,v=f*f,p=v*f;return e*s*o-4*c*a-4*n*l*o+18*n*i*r*a-27*h*o*o+256*y*p+f*(18*c*r*u-4*e*l+16*n*s*s-80*n*i*s*u-6*n*e*o+144*h*r*o)+v*(144*n*e*r-27*e*e-128*h*s-192*h*i*u)},e.computeRealRoots=function(r,e,o,s,h){if(typeof r!="number")throw new t("a is a required number.");if(typeof e!="number")throw new t("b is a required number.");if(typeof o!="number")throw new t("c is a required number.");if(typeof s!="number")throw new t("d is a required number.");if(typeof h!="number")throw new t("e is a required number.");if(Math.abs(r)<i.EPSILON15)return n.computeRealRoots(e,o,s,h);var c=e/r,l=o/r,a=s/r,v=h/r,y=c<0?1:0;y+=l<0?y+1:y;y+=a<0?y+1:y;y+=v<0?y+1:y;switch(y){case 0:return u(c,l,a,v);case 1:return f(c,l,a,v);case 2:return f(c,l,a,v);case 3:return u(c,l,a,v);case 4:return u(c,l,a,v);case 5:return f(c,l,a,v);case 6:return u(c,l,a,v);case 7:return u(c,l,a,v);case 8:return f(c,l,a,v);case 9:return u(c,l,a,v);case 10:return u(c,l,a,v);case 11:return f(c,l,a,v);case 12:return u(c,l,a,v);case 13:return u(c,l,a,v);case 14:return u(c,l,a,v);case 15:return u(c,l,a,v);default:return undefined}},e});t("Core/Ray",["./Cartesian3","./defaultValue","./defined","./DeveloperError"],function(n,t,i,r){"use strict";function u(i,r){r=n.clone(t(r,n.ZERO));n.equals(r,n.ZERO)||n.normalize(r,r);this.origin=n.clone(t(i,n.ZERO));this.direction=r}return u.getPoint=function(t,u,f){if(!i(t))throw new r("ray is requred");if(typeof u!="number")throw new r("t is a required number");return i(f)||(f=new n),f=n.multiplyByScalar(t.direction,u,f),n.add(t.origin,f,f)},u});t("Core/IntersectionTests",["./Cartesian3","./Cartographic","./defaultValue","./defined","./DeveloperError","./Interval","./Math","./Matrix3","./QuadraticRealPolynomial","./QuarticRealPolynomial","./Ray"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function lt(n,t,i,r){var u=t*t-4*n*i,o;if(u<0)return undefined;if(u>0){var s=1/(2*n),h=Math.sqrt(u),f=(-t+h)*s,e=(-t-h)*s;return f<e?(r.root0=f,r.root1=e):(r.root0=e,r.root1=f),r}return(o=-t/(2*n),o===0)?undefined:(r.root0=r.root1=o,r)}function g(t,i,u){r(u)||(u=new f);var h=t.origin,e=t.direction,c=i.center,l=i.radius*i.radius,s=n.subtract(h,c,p),a=n.dot(e,e),v=2*n.dot(e,s),y=n.magnitudeSquared(s)-l,o=lt(a,v,y,d);return r(o)?(u.start=o.root0,u.stop=o.root1,u):undefined}function a(n,t,i){var r=n+t;return e.sign(n)!==e.sign(t)&&Math.abs(r/Math.max(Math.abs(n),Math.abs(t)))<i?0:r}function at(t,i,r,u,f){var bt=u*u,rt=f*f,y=(t[o.COLUMN1ROW1]-t[o.COLUMN2ROW2])*rt,p=f*(u*a(t[o.COLUMN1ROW0],t[o.COLUMN0ROW1],e.EPSILON15)+i.y),v=t[o.COLUMN0ROW0]*bt+t[o.COLUMN2ROW2]*rt+u*i.x+r,k=rt*a(t[o.COLUMN2ROW1],t[o.COLUMN1ROW2],e.EPSILON15),d=f*(u*a(t[o.COLUMN2ROW0],t[o.COLUMN0ROW2])+i.z),w,c=[],g,ut,nt,ft,et,tt,wt,ot;if(d===0&&k===0)return(w=s.computeRealRoots(y,p,v),w.length===0)?c:(g=w[0],ut=Math.sqrt(Math.max(1-g*g,0)),c.push(new n(u,f*g,f*-ut)),c.push(new n(u,f*g,f*ut)),w.length===2&&(nt=w[1],ft=Math.sqrt(Math.max(1-nt*nt,0)),c.push(new n(u,f*nt,f*-ft)),c.push(new n(u,f*nt,f*ft))),c);var st=d*d,ht=k*k,kt=y*y,ct=d*k,lt=kt+ht,at=2*(p*y+ct),vt=2*v*y+p*p-ht+st,yt=2*(v*p-ct),dt=v*v-st;if(lt===0&&at===0&&vt===0&&yt===0||(w=h.computeRealRoots(lt,at,vt,yt,dt),et=w.length,et===0))return c;for(tt=0;tt<et;++tt){var l=w[tt],it=l*l,gt=Math.max(1-it,0),b=Math.sqrt(gt),pt;pt=e.sign(y)===e.sign(v)?a(y*it+v,p*l,e.EPSILON12):e.sign(v)===e.sign(p*l)?a(y*it,p*l+v,e.EPSILON12):a(y*it+p*l,v,e.EPSILON12);wt=a(k*l,d,e.EPSILON15);ot=pt*wt;ot<0?c.push(new n(u,f*l,f*b)):ot>0?c.push(new n(u,f*l,f*-b)):b!==0?(c.push(new n(u,f*l,f*-b)),c.push(new n(u,f*l,f*b)),++tt):c.push(new n(u,f*l,f*b))}return c}var l={},k,d,nt,tt,it,st;l.rayPlane=function(t,i,f){var o;if(!r(t))throw new u("ray is required.");if(!r(i))throw new u("plane is required.");r(f)||(f=new n);var s=t.origin,h=t.direction,c=i.normal,l=n.dot(c,h);return Math.abs(l)<e.EPSILON15?undefined:(o=(-i.distance-n.dot(c,s))/l,o<0)?undefined:(f=n.multiplyByScalar(h,o,f),n.add(s,f,f))};var ht=new n,ct=new n,p=new n,w=new n,b=new n;l.rayTriangleParametric=function(t,f,o,s,h){var k;if(!r(t))throw new u("ray is required.");if(!r(f))throw new u("p0 is required.");if(!r(o))throw new u("p1 is required.");if(!r(s))throw new u("p2 is required.");h=i(h,!1);var rt=t.origin,d=t.direction,g=n.subtract(o,f,ht),nt=n.subtract(s,f,ct),tt=n.cross(d,nt,p),l=n.dot(g,tt),a,v,c,y,it;if(h){if(l<e.EPSILON6||(a=n.subtract(rt,f,w),c=n.dot(a,tt),c<0||c>l)||(v=n.cross(a,g,b),y=n.dot(d,v),y<0||c+y>l))return undefined;it=n.dot(nt,v)/l}else{if(Math.abs(l)<e.EPSILON6||(k=1/l,a=n.subtract(rt,f,w),c=n.dot(a,tt)*k,c<0||c>1)||(v=n.cross(a,g,b),y=n.dot(d,v)*k,y<0||c+y>1))return undefined;it=n.dot(nt,v)*k}return it};l.rayTriangle=function(t,i,u,f,e,o){var s=l.rayTriangleParametric(t,i,u,f,e);return!r(s)||s<0?undefined:(r(o)||(o=new n),n.multiplyByScalar(t.direction,s,o),n.add(t.origin,o,o))};k=new c;l.lineSegmentTriangle=function(t,i,f,e,o,s,h){var c,a;if(!r(t))throw new u("v0 is required.");if(!r(i))throw new u("v1 is required.");if(!r(f))throw new u("p0 is required.");if(!r(e))throw new u("p1 is required.");if(!r(o))throw new u("p2 is required.");return(c=k,n.clone(t,c.origin),n.subtract(i,t,c.direction),n.normalize(c.direction,c.direction),a=l.rayTriangleParametric(c,f,e,o,s),!r(a)||a<0||a>n.distance(t,i))?undefined:(r(h)||(h=new n),n.multiplyByScalar(c.direction,a,h),n.add(c.origin,h,h))};d={root0:0,root1:0};l.raySphere=function(n,t,i){if(!r(n))throw new u("ray is required.");if(!r(t))throw new u("sphere is required.");return(i=g(n,t,i),!r(i)||i.stop<0)?undefined:(i.start=Math.max(i.start,0),i)};nt=new c;l.lineSegmentSphere=function(t,i,f,e){var o,s,h;if(!r(t))throw new u("p0 is required.");if(!r(i))throw new u("p1 is required.");if(!r(f))throw new u("sphere is required.");return(o=nt,n.clone(t,o.origin),s=n.subtract(i,t,o.direction),h=n.magnitude(s),n.normalize(s,s),e=g(o,f,e),!r(e)||e.stop<0||e.start>h)?undefined:(e.start=Math.max(e.start,0),e.stop=Math.min(e.stop,h),e)};tt=new n;it=new n;l.rayEllipsoid=function(t,i){var w,y,p,b;if(!r(t))throw new u("ray is required.");if(!r(i))throw new u("ellipsoid is required.");var k=i.oneOverRadii,d=n.multiplyComponents(k,t.origin,tt),l=n.multiplyComponents(k,t.direction,it),a=n.magnitudeSquared(d),e=n.dot(d,l),s,o,h,v,c;return a>1?e>=0?undefined:(w=e*e,s=a-1,o=n.magnitudeSquared(l),h=o*s,w<h)?undefined:w>h?(v=e*e-h,c=-e+Math.sqrt(v),y=c/o,p=s/c,y<p)?new f(y,p):{start:p,stop:y}:(b=Math.sqrt(s/o),new f(b,b)):a<1?(s=a-1,o=n.magnitudeSquared(l),h=o*s,v=e*e-h,c=-e+Math.sqrt(v),new f(0,c/o)):e<0?(o=n.magnitudeSquared(l),new f(0,-e/o)):undefined};var y=new n,rt=new n,ut=new n,v=new n,vt=new n,yt=new o,pt=new o,wt=new o,bt=new o,kt=new o,ft=new o,et=new o,ot=new n,dt=new n,gt=new t;return l.grazingAltitudeLocation=function(t,i){var c,s,st,w,l,k,ti,tt,it;if(!r(t))throw new u("ray is required.");if(!r(i))throw new u("ellipsoid is required.");if(c=t.origin,s=t.direction,!n.equals(c,n.ZERO)&&(st=i.geodeticSurfaceNormal(c,y),n.dot(s,st)>=0))return c;var ii=r(this.rayEllipsoid(t,i)),d=i.transformPositionToScaledSpace(s,y),a=n.normalize(d,d),ri=n.mostOrthogonalAxis(d,v),b=n.normalize(n.cross(ri,a,rt),rt),g=n.normalize(n.cross(a,b,ut),ut),f=yt;f[0]=a.x;f[1]=a.y;f[2]=a.z;f[3]=b.x;f[4]=b.y;f[5]=b.z;f[6]=g.x;f[7]=g.y;f[8]=g.z;var ui=o.transpose(f,pt),ht=o.fromScale(i.radii,wt),fi=o.fromScale(i.oneOverRadii,bt),h=kt;h[0]=0;h[1]=-s.z;h[2]=s.y;h[3]=s.z;h[4]=0;h[5]=-s.x;h[6]=-s.y;h[7]=s.x;h[8]=0;var ct=o.multiply(o.multiply(ui,fi,ft),h,ft),ei=o.multiply(o.multiply(ct,ht,et),f,et),oi=o.multiplyByVector(ct,c,vt),lt=at(ei,n.negate(oi,y),0,0,1),nt,p,ni=lt.length;if(ni>0){for(w=n.clone(n.ZERO,dt),l=Number.NEGATIVE_INFINITY,k=0;k<ni;++k)nt=o.multiplyByVector(ht,o.multiplyByVector(f,lt[k],ot),ot),ti=n.normalize(n.subtract(nt,c,v),v),tt=n.dot(ti,s),tt>l&&(l=tt,w=n.clone(nt,w));return it=i.cartesianToCartographic(w,gt),l=e.clamp(l,0,1),p=n.magnitude(n.subtract(w,c,v))*Math.sqrt(1-l*l),p=ii?-p:p,it.height=p,i.cartographicToCartesian(it,new n)}return undefined},st=new n,l.lineSegmentPlane=function(t,i,f,o){var a,s;if(!r(t))throw new u("endPoint0 is required.");if(!r(i))throw new u("endPoint1 is required.");if(!r(f))throw new u("plane is required.");r(o)||(o=new n);var h=n.subtract(i,t,st),c=f.normal,l=n.dot(c,h);return Math.abs(l)<e.EPSILON6?undefined:(a=n.dot(c,t),s=-(f.distance+a)/l,s<0||s>1)?undefined:(n.multiplyByScalar(h,s,o),n.add(t,o,o),o)},l.trianglePlaneIntersection=function(t,i,f,e){var o,s;if(!r(t)||!r(i)||!r(f)||!r(e))throw new u("p0, p1, p2, and plane are required.");var c=e.normal,a=e.distance,v=n.dot(c,t)+a<0,y=n.dot(c,i)+a<0,p=n.dot(c,f)+a<0,h=0;if(h+=v?1:0,h+=y?1:0,h+=p?1:0,(h===1||h===2)&&(o=new n,s=new n),h===1){if(v)return l.lineSegmentPlane(t,i,e,o),l.lineSegmentPlane(t,f,e,s),{positions:[t,i,f,o,s],indices:[0,3,4,1,2,4,1,4,3]};if(y)return l.lineSegmentPlane(i,f,e,o),l.lineSegmentPlane(i,t,e,s),{positions:[t,i,f,o,s],indices:[1,3,4,2,0,4,2,4,3]};if(p)return l.lineSegmentPlane(f,t,e,o),l.lineSegmentPlane(f,i,e,s),{positions:[t,i,f,o,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(h===2)if(v)if(y){if(!p)return l.lineSegmentPlane(t,f,e,o),l.lineSegmentPlane(i,f,e,s),{positions:[t,i,f,o,s],indices:[0,1,4,0,4,3,2,3,4]}}else return l.lineSegmentPlane(f,i,e,o),l.lineSegmentPlane(t,i,e,s),{positions:[t,i,f,o,s],indices:[2,0,4,2,4,3,1,3,4]};else return l.lineSegmentPlane(i,t,e,o),l.lineSegmentPlane(f,t,e,s),{positions:[t,i,f,o,s],indices:[1,2,4,1,4,3,0,3,4]};return undefined},l});t("Core/Plane",["./Cartesian3","./Check","./defined","./DeveloperError","./freezeObject","./Math","./Matrix4"],function(n,t,i,r,u,f,e){"use strict";function o(i,u){if(t.typeOf.object("normal",i),!f.equalsEpsilon(n.magnitude(i),1,f.EPSILON6))throw new r("normal must be normalized.");t.typeOf.number("distance",u);this.normal=n.clone(i);this.distance=u}var s,c,h;return o.fromPointNormal=function(u,e,s){if(t.typeOf.object("point",u),t.typeOf.object("normal",e),!f.equalsEpsilon(n.magnitude(e),1,f.EPSILON6))throw new r("normal must be normalized.");var h=-n.dot(e,u);return i(s)?(n.clone(e,s.normal),s.distance=h,s):new o(e,h)},s=new n,o.fromCartesian4=function(u,e){t.typeOf.object("coefficients",u);var h=n.fromCartesian4(u,s),c=u.w;if(!f.equalsEpsilon(n.magnitude(h),1,f.EPSILON6))throw new r("normal must be normalized.");return i(e)?(n.clone(h,e.normal),e.distance=c,e):new o(h,c)},o.getPointDistance=function(i,r){return t.typeOf.object("plane",i),t.typeOf.object("point",r),n.dot(i.normal,r)+i.distance},c=new n,o.projectPointOntoPlane=function(r,u,f){t.typeOf.object("plane",r);t.typeOf.object("point",u);i(f)||(f=new n);var e=o.getPointDistance(r,u),s=n.multiplyByScalar(r.normal,e,c);return n.subtract(u,s,f)},h=new n,o.transform=function(i,r,u){return t.typeOf.object("plane",i),t.typeOf.object("transform",r),e.multiplyByPointAsVector(r,i.normal,s),n.normalize(s,s),n.multiplyByScalar(i.normal,-i.distance,h),e.multiplyByPoint(r,h,h),o.fromPointNormal(h,s,u)},o.clone=function(r,u){return(t.typeOf.object("plane",r),!i(u))?new o(r.normal,r.distance):(n.clone(r.normal,u.normal),u.distance=r.distance,u)},o.equals=function(i,r){return t.typeOf.object("left",i),t.typeOf.object("right",r),i.distance===r.distance&&n.equals(i.normal,r.normal)},o.ORIGIN_XY_PLANE=u(new o(n.UNIT_Z,0)),o.ORIGIN_YZ_PLANE=u(new o(n.UNIT_X,0)),o.ORIGIN_ZX_PLANE=u(new o(n.UNIT_Y,0)),o});t("Core/EllipsoidTangentPlane",["./AxisAlignedBoundingBox","./Cartesian2","./Cartesian3","./Cartesian4","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./IntersectionTests","./Matrix4","./Plane","./Ray","./Transforms"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n,t){var r,o;if(u.defined("origin",n),t=f(t,h.WGS84),n=t.scaleToGeodeticSurface(n),!e(n))throw new s("origin must not be at the center of the ellipsoid.");r=y.eastNorthUpToFixedFrame(n,t);this._ellipsoid=t;this._origin=n;this._xAxis=i.fromCartesian4(l.getColumn(r,0,b));this._yAxis=i.fromCartesian4(l.getColumn(r,1,b));o=i.fromCartesian4(l.getColumn(r,2,b));this._plane=a.fromPointNormal(n,o)}var b=new r,d,k,w,g;return o(p.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}}),d=new n,p.fromPoints=function(t,i){u.defined("cartesians",t);var r=n.fromPoints(t,d);return new p(r.center,i)},k=new v,w=new i,p.prototype.projectPointOntoPlane=function(n,r){var f,o;if(u.defined("cartesian",n),f=k,f.origin=n,i.normalize(n,f.direction),o=c.rayPlane(f,this._plane,w),e(o)||(i.negate(f.direction,f.direction),o=c.rayPlane(f,this._plane,w)),e(o)){var s=i.subtract(o,this._origin,o),h=i.dot(this._xAxis,s),l=i.dot(this._yAxis,s);return e(r)?(r.x=h,r.y=l,r):new t(h,l)}return undefined},p.prototype.projectPointsOntoPlane=function(n,t){var i,o,r,f;for(u.defined("cartesians",n),e(t)||(t=[]),i=0,o=n.length,r=0;r<o;r++)f=this.projectPointOntoPlane(n[r],t[i]),e(f)&&(t[i]=f,i++);return t.length=i,t},p.prototype.projectPointToNearestOnPlane=function(n,r){var f,o;u.defined("cartesian",n);e(r)||(r=new t);f=k;f.origin=n;i.clone(this._plane.normal,f.direction);o=c.rayPlane(f,this._plane,w);e(o)||(i.negate(f.direction,f.direction),o=c.rayPlane(f,this._plane,w));var s=i.subtract(o,this._origin,o),h=i.dot(this._xAxis,s),l=i.dot(this._yAxis,s);return r.x=h,r.y=l,r},p.prototype.projectPointsToNearestOnPlane=function(n,t){var r,i;for(u.defined("cartesians",n),e(t)||(t=[]),r=n.length,t.length=r,i=0;i<r;i++)t[i]=this.projectPointToNearestOnPlane(n[i],t[i]);return t},g=new i,p.prototype.projectPointOntoEllipsoid=function(n,t){u.defined("cartesian",n);e(t)||(t=new i);var f=this._ellipsoid,o=this._origin,s=this._xAxis,h=this._yAxis,r=g;return i.multiplyByScalar(s,n.x,r),t=i.add(o,r,t),i.multiplyByScalar(h,n.y,r),i.add(t,r,t),f.scaleToGeocentricSurface(t,t),t},p.prototype.projectPointsOntoEllipsoid=function(n,t){var r,i;for(u.defined("cartesians",n),r=n.length,e(t)?t.length=r:t=new Array(r),i=0;i<r;++i)t[i]=this.projectPointOntoEllipsoid(n[i],t[i]);return t},p});t("Core/OrientedBoundingBox",["./BoundingSphere","./Cartesian2","./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./EllipsoidTangentPlane","./Intersect","./Interval","./Math","./Matrix3","./Plane","./Rectangle"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function w(n,t){this.center=i.clone(f(n,i.ZERO));this.halfAxes=v.clone(f(t,v.ZERO))}function pt(n,t,r,u,f,s,h,c){var l,a,y,p;if(!e(t)||!e(r)||!e(u)||!e(f)||!e(s)||!e(h))throw new o("all extents (minimum/maximum X/Y/Z) are required.");return e(c)||(c=new w),l=c.halfAxes,v.setColumn(l,0,n.xAxis,l),v.setColumn(l,1,n.yAxis,l),v.setColumn(l,2,n.zAxis,l),a=g,a.x=(t+r)/2,a.y=(u+f)/2,a.z=(s+h)/2,y=nt,y.x=(r-t)/2,y.y=(f-u)/2,y.z=(h-s)/2,p=c.center,a=v.multiplyByVector(l,a,a),i.add(n.origin,a,p),v.multiplyByScale(l,y,l),c}var g,nt,ut,ft,et;w.packedLength=i.packedLength+v.packedLength;w.pack=function(n,t,r){return u.typeOf.object("value",n),u.defined("array",t),r=f(r,0),i.pack(n.center,t,r),v.pack(n.halfAxes,t,r+i.packedLength),t};w.unpack=function(n,t,r){return u.defined("array",n),t=f(t,0),e(r)||(r=new w),i.unpack(n,t,r.center),v.unpack(n,t+i.packedLength,r.halfAxes),r};var ot=new i,st=new i,ht=new i,ct=new i,lt=new i,at=new i,vt=new v,yt={unitary:new v,diagonal:new v};w.fromPoints=function(n,t){var u,y,h,o,f,wt,s;if(e(t)||(t=new w),!e(n)||n.length===0)return t.halfAxes=v.ZERO,t.center=i.ZERO,t;for(y=n.length,h=i.clone(n[0],ot),u=1;u<y;u++)i.add(h,n[u],h);o=1/y;i.multiplyByScalar(h,o,h);var ut=0,p=0,b=0,ft=0,k=0,et=0,r;for(u=0;u<y;u++)r=i.subtract(n[u],h,st),ut+=r.x*r.x,p+=r.x*r.y,b+=r.x*r.z,ft+=r.y*r.y,k+=r.y*r.z,et+=r.z*r.z;ut*=o;p*=o;b*=o;ft*=o;k*=o;et*=o;f=vt;f[0]=ut;f[1]=p;f[2]=b;f[3]=p;f[4]=ft;f[5]=k;f[6]=b;f[7]=k;f[8]=et;var bt=v.computeEigenDecomposition(f,yt),pt=v.clone(bt.unitary,t.halfAxes),c=v.getColumn(pt,0,ct),l=v.getColumn(pt,1,lt),a=v.getColumn(pt,2,at),d=-Number.MAX_VALUE,g=-Number.MAX_VALUE,nt=-Number.MAX_VALUE,tt=Number.MAX_VALUE,it=Number.MAX_VALUE,rt=Number.MAX_VALUE;for(u=0;u<y;u++)r=n[u],d=Math.max(i.dot(c,r),d),g=Math.max(i.dot(l,r),g),nt=Math.max(i.dot(a,r),nt),tt=Math.min(i.dot(c,r),tt),it=Math.min(i.dot(l,r),it),rt=Math.min(i.dot(a,r),rt);return c=i.multiplyByScalar(c,.5*(tt+d),c),l=i.multiplyByScalar(l,.5*(it+g),l),a=i.multiplyByScalar(a,.5*(rt+nt),a),wt=i.add(c,l,t.center),i.add(wt,a,wt),s=ht,s.x=d-tt,s.y=g-it,s.z=nt-rt,i.multiplyByScalar(s,.5,s),v.multiplyByScale(t.halfAxes,s,t.halfAxes),t};g=new i;nt=new i;var wt=new r,bt=new i,k=[new r,new r,new r,new r,new r,new r,new r,new r],d=[new i,new i,new i,new i,new i,new i,new i,new i],b=[new t,new t,new t,new t,new t,new t,new t,new t];w.fromRectangle=function(n,t,i,r,u){var et,ot;if(!e(n))throw new o("rectangle is required");if(n.width<0||n.width>a.TWO_PI)throw new o("Rectangle width must be between 0 and 2*pi");if(n.height<0||n.height>a.PI)throw new o("Rectangle height must be between 0 and pi");if(e(r)&&!a.equalsEpsilon(r.radii.x,r.radii.y,a.EPSILON15))throw new o("Ellipsoid must be an ellipsoid of revolution (radii.x == radii.y)");t=f(t,0);i=f(i,0);r=f(r,s.WGS84);var nt=p.center(n,wt),st=r.cartographicToCartesian(nt,bt),tt=new h(st,r),c=tt.plane,l=k[0],it=k[1],v=k[2],rt=k[3],w=k[4],ut=k[5],g=k[6],ft=k[7],ht=nt.longitude,ct=n.south<0&&n.north>0?0:nt.latitude;g.latitude=ut.latitude=w.latitude=n.south;ft.latitude=rt.latitude=ct;l.latitude=it.latitude=v.latitude=n.north;g.longitude=ft.longitude=l.longitude=n.west;ut.longitude=it.longitude=ht;w.longitude=rt.longitude=v.longitude=n.east;v.height=it.height=l.height=ft.height=g.height=ut.height=w.height=rt.height=i;r.cartographicArrayToCartesianArray(k,d);tt.projectPointsToNearestOnPlane(d,b);var lt=Math.min(b[6].x,b[7].x,b[0].x),at=Math.max(b[2].x,b[3].x,b[4].x),vt=Math.min(b[4].y,b[5].y,b[6].y),yt=Math.max(b[0].y,b[1].y,b[2].y);return v.height=l.height=w.height=g.height=t,r.cartographicArrayToCartesianArray(k,d),et=Math.min(y.getPointDistance(c,d[0]),y.getPointDistance(c,d[2]),y.getPointDistance(c,d[4]),y.getPointDistance(c,d[6])),ot=i,pt(tt,lt,at,vt,yt,et,ot,u)};w.clone=function(n,t){return e(n)?e(t)?(i.clone(n.center,t.center),v.clone(n.halfAxes,t.halfAxes),t):new w(n.center,n.halfAxes):undefined};w.intersectPlane=function(n,t){if(!e(n))throw new o("box is required.");if(!e(t))throw new o("plane is required.");var y=n.center,u=t.normal,r=n.halfAxes,f=u.x,s=u.y,h=u.z,l=Math.abs(f*r[v.COLUMN0ROW0]+s*r[v.COLUMN0ROW1]+h*r[v.COLUMN0ROW2])+Math.abs(f*r[v.COLUMN1ROW0]+s*r[v.COLUMN1ROW1]+h*r[v.COLUMN1ROW2])+Math.abs(f*r[v.COLUMN2ROW0]+s*r[v.COLUMN2ROW1]+h*r[v.COLUMN2ROW2]),a=i.dot(u,y)+t.distance;return a<=-l?c.OUTSIDE:a>=l?c.INSIDE:c.INTERSECTING};var tt=new i,it=new i,rt=new i,kt=new i;return w.distanceSquaredTo=function(n,t){var u,f,r;if(!e(n))throw new o("box is required.");if(!e(t))throw new o("cartesian is required.");var p=i.subtract(t,n.center,g),w=n.halfAxes,s=v.getColumn(w,0,tt),h=v.getColumn(w,1,it),c=v.getColumn(w,2,rt),l=i.magnitude(s),a=i.magnitude(h),y=i.magnitude(c);return i.normalize(s,s),i.normalize(h,h),i.normalize(c,c),u=kt,u.x=i.dot(p,s),u.y=i.dot(p,h),u.z=i.dot(p,c),f=0,u.x<-l?(r=u.x+l,f+=r*r):u.x>l&&(r=u.x-l,f+=r*r),u.y<-a?(r=u.y+a,f+=r*r):u.y>a&&(r=u.y-a,f+=r*r),u.z<-y?(r=u.z+y,f+=r*r):u.z>y&&(r=u.z-y,f+=r*r),f},ut=new i,ft=new i,w.computePlaneDistances=function(n,t,r,u){var a,s;if(!e(n))throw new o("box is required.");if(!e(t))throw new o("position is required.");if(!e(r))throw new o("direction is required.");e(u)||(u=new l);var h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,y=n.center,k=n.halfAxes,p=v.getColumn(k,0,tt),w=v.getColumn(k,1,it),b=v.getColumn(k,2,rt),f=i.add(p,w,ut);return i.add(f,b,f),i.add(f,y,f),a=i.subtract(f,t,ft),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.add(y,p,f),i.add(f,w,f),i.subtract(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.add(y,p,f),i.subtract(f,w,f),i.add(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.add(y,p,f),i.subtract(f,w,f),i.subtract(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.subtract(y,p,f),i.add(f,w,f),i.add(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.subtract(y,p,f),i.add(f,w,f),i.subtract(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.subtract(y,p,f),i.subtract(f,w,f),i.add(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),i.subtract(y,p,f),i.subtract(f,w,f),i.subtract(f,b,f),i.subtract(f,t,a),s=i.dot(r,a),h=Math.min(s,h),c=Math.max(s,c),u.start=h,u.stop=c,u},et=new n,w.isOccluded=function(t,i){if(!e(t))throw new o("box is required.");if(!e(i))throw new o("occluder is required.");var r=n.fromOrientedBoundingBox(t,et);return!i.isBoundingSphereVisible(r)},w.prototype.intersectPlane=function(n){return w.intersectPlane(this,n)},w.prototype.distanceSquaredTo=function(n){return w.distanceSquaredTo(this,n)},w.prototype.computePlaneDistances=function(n,t,i){return w.computePlaneDistances(this,n,t,i)},w.prototype.isOccluded=function(n){return w.isOccluded(this,n)},w.equals=function(n,t){return n===t||e(n)&&e(t)&&i.equals(n.center,t.center)&&v.equals(n.halfAxes,t.halfAxes)},w.prototype.clone=function(n){return w.clone(this,n)},w.prototype.equals=function(n){return w.equals(this,n)},w});t("Core/TerrainQuantization",["./freezeObject"],function(n){"use strict";return n({NONE:0,BITS12:1})});t("Core/TerrainEncoding",["./AttributeCompression","./Cartesian2","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./Math","./Matrix4","./TerrainQuantization"],function(n,t,i,r,u,f,e,o,s){"use strict";function c(n,t,r,e,h,c){var nt,tt,a,y,it,d;if(f(n)&&f(t)&&f(r)&&f(e)){var g=n.minimum,ut=n.maximum,k=i.subtract(ut,g,p),ft=r-t,et=Math.max(i.maximumComponent(k),ft);nt=et<b-1?s.BITS12:s.NONE;tt=n.center;a=o.inverseTransformation(e,new o);it=i.negate(g,l);o.multiply(o.fromTranslation(it,v),a,a);d=l;d.x=1/k.x;d.y=1/k.y;d.z=1/k.z;o.multiply(o.fromScale(d,v),a,a);y=o.clone(e);o.setTranslation(y,i.ZERO,y);e=o.clone(e,new o);var ot=o.fromTranslation(g,v),st=o.fromScale(k,w),rt=o.multiply(ot,st,v);o.multiply(e,rt,e);o.multiply(y,rt,y)}this.quantization=nt;this.minimumHeight=t;this.maximumHeight=r;this.center=tt;this.toScaledENU=a;this.fromScaledENU=e;this.matrix=y;this.hasVertexNormals=h;this.hasWebMercatorT=u(c,!1)}var l=new i,p=new i,h=new t,v=new o,w=new o,b=Math.pow(2,12),y,a;return c.prototype.encode=function(r,u,f,c,a,v,y){var p=c.x,w=c.y,b,k,d,g,nt,tt;return this.quantization===s.BITS12?(f=o.multiplyByPoint(this.toScaledENU,f,l),f.x=e.clamp(f.x,0,1),f.y=e.clamp(f.y,0,1),f.z=e.clamp(f.z,0,1),b=this.maximumHeight-this.minimumHeight,k=e.clamp((a-this.minimumHeight)/b,0,1),t.fromElements(f.x,f.y,h),d=n.compressTextureCoordinates(h),t.fromElements(f.z,k,h),g=n.compressTextureCoordinates(h),t.fromElements(p,w,h),nt=n.compressTextureCoordinates(h),r[u++]=d,r[u++]=g,r[u++]=nt,this.hasWebMercatorT&&(t.fromElements(y,0,h),tt=n.compressTextureCoordinates(h),r[u++]=tt)):(i.subtract(f,this.center,l),r[u++]=l.x,r[u++]=l.y,r[u++]=l.z,r[u++]=a,r[u++]=p,r[u++]=w,this.hasWebMercatorT&&(r[u++]=y)),this.hasVertexNormals&&(r[u++]=n.octPackFloat(v)),u},c.prototype.decodePosition=function(t,r,u){var e,c;return(f(u)||(u=new i),r*=this.getStride(),this.quantization===s.BITS12)?(e=n.decompressTextureCoordinates(t[r],h),u.x=e.x,u.y=e.y,c=n.decompressTextureCoordinates(t[r+1],h),u.z=c.x,o.multiplyByPoint(this.fromScaledENU,u,u)):(u.x=t[r],u.y=t[r+1],u.z=t[r+2],i.add(u,this.center,u))},c.prototype.decodeTextureCoordinates=function(i,r,u){return(f(u)||(u=new t),r*=this.getStride(),this.quantization===s.BITS12)?n.decompressTextureCoordinates(i[r+2],u):t.fromElements(i[r+4],i[r+5],u)},c.prototype.decodeHeight=function(t,i){if(i*=this.getStride(),this.quantization===s.BITS12){var r=n.decompressTextureCoordinates(t[i+1],h);return r.y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight}return t[i+3]},c.prototype.getOctEncodedNormal=function(n,i,r){var e=this.getStride();i=(i+1)*e-1;var u=n[i]/256,f=Math.floor(u),o=(u-f)*256;return t.fromElements(f,o,r)},c.prototype.getStride=function(){var n;switch(this.quantization){case s.BITS12:n=3;break;default:n=6}return this.hasWebMercatorT&&++n,this.hasVertexNormals&&++n,n},y={position3DAndHeight:0,textureCoordAndEncodedNormals:1},a={compressed0:0,compressed1:1},c.prototype.getAttributes=function(n){var t=r.FLOAT,e=r.getSizeInBytes(t),i,o,f,u,h;return this.quantization===s.NONE?(o=4,f=2,this.hasWebMercatorT&&++f,this.hasVertexNormals&&++f,i=(o+f)*e,[{index:y.position3DAndHeight,vertexBuffer:n,componentDatatype:t,componentsPerAttribute:o,offsetInBytes:0,strideInBytes:i},{index:y.textureCoordAndEncodedNormals,vertexBuffer:n,componentDatatype:t,componentsPerAttribute:f,offsetInBytes:o*e,strideInBytes:i}]):(u=3,h=0,(this.hasWebMercatorT||this.hasVertexNormals)&&++u,this.hasWebMercatorT&&this.hasVertexNormals)?(++h,i=(u+h)*e,[{index:a.compressed0,vertexBuffer:n,componentDatatype:t,componentsPerAttribute:u,offsetInBytes:0,strideInBytes:i},{index:a.compressed1,vertexBuffer:n,componentDatatype:t,componentsPerAttribute:h,offsetInBytes:u*e,strideInBytes:i}]):[{index:a.compressed0,vertexBuffer:n,componentDatatype:t,componentsPerAttribute:u}]},c.prototype.getAttributeLocations=function(){return this.quantization===s.NONE?y:a},c.clone=function(n,t){return f(t)||(t=new c),t.quantization=n.quantization,t.minimumHeight=n.minimumHeight,t.maximumHeight=n.maximumHeight,t.center=i.clone(n.center),t.toScaledENU=o.clone(n.toScaledENU),t.fromScaledENU=o.clone(n.fromScaledENU),t.matrix=o.clone(n.matrix),t.hasVertexNormals=n.hasVertexNormals,t.hasWebMercatorT=n.hasWebMercatorT,t},c});t("Core/WebMercatorProjection",["./Cartesian3","./Cartographic","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./Math"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){this._ellipsoid=i(n,e.WGS84);this._semimajorAxis=this._ellipsoid.maximumRadius;this._oneOverSemimajorAxis=1/this._semimajorAxis}return u(s.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),s.mercatorAngleToGeodeticLatitude=function(n){return o.PI_OVER_TWO-2*Math.atan(Math.exp(-n))},s.geodeticLatitudeToMercatorAngle=function(n){n>s.MaximumLatitude?n=s.MaximumLatitude:n<-s.MaximumLatitude&&(n=-s.MaximumLatitude);var t=Math.sin(n);return.5*Math.log((1+t)/(1-t))},s.MaximumLatitude=s.mercatorAngleToGeodeticLatitude(Math.PI),s.prototype.project=function(t,i){var u=this._semimajorAxis,f=t.longitude*u,e=s.geodeticLatitudeToMercatorAngle(t.latitude)*u,o=t.height;return r(i)?(i.x=f,i.y=e,i.z=o,i):new n(f,e,o)},s.prototype.unproject=function(n,i){if(!r(n))throw new f("cartesian is required");var u=this._oneOverSemimajorAxis,e=n.x*u,o=s.mercatorAngleToGeodeticLatitude(n.y*u),h=n.z;return r(i)?(i.longitude=e,i.latitude=o,i.height=h,i):new t(e,o,h)},s});t("Core/HeightmapTessellator",["./AxisAlignedBoundingBox","./BoundingSphere","./Cartesian2","./Cartesian3","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./EllipsoidalOccluder","./freezeObject","./Math","./Matrix4","./OrientedBoundingBox","./Rectangle","./TerrainEncoding","./Transforms","./WebMercatorProjection"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";var b={};b.DEFAULT_STRUCTURE=h({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var k=new r,d=new l,g=new r,nt=new r;return b.computeVertices=function(h){var ct,ur,lt,at,dt,gt,ot,rt,ou,ni,st,ut,bi,tt,ht,ki,si,cu,lu,au,vu,vt;if(!f(h)||!f(h.heightmap))throw new e("options.heightmap is required.");if(!f(h.width)||!f(h.height))throw new e("options.width and options.height are required.");if(!f(h.nativeRectangle))throw new e("options.nativeRectangle is required.");if(!f(h.skirtHeight))throw new e("options.skirtHeight is required.");var di=Math.cos,gi=Math.sin,wu=Math.sqrt,nr=Math.atan,tr=Math.exp,ir=c.PI_OVER_TWO,yt=c.toRadians,rr=h.heightmap,pt=h.width,ti=h.height,ci=h.skirtHeight,li=u(h.isGeographic,!0),ii=u(h.ellipsoid,o.WGS84),ft=1/ii.maximumRadius,it=h.nativeRectangle,ri,wt,ai,ui,et=h.rectangle;f(et)?(ri=et.west,wt=et.south,ai=et.east,ui=et.north):li?(ri=yt(it.west),wt=yt(it.south),ai=yt(it.east),ui=yt(it.north)):(ri=it.west*ft,wt=ir-2*nr(tr(-it.south*ft)),ai=it.east*ft,ui=ir-2*nr(tr(-it.north*ft)));ct=h.relativeToCenter;ur=f(ct);ct=ur?ct:r.ZERO;var bu=u(h.exaggeration,1),fi=u(h.includeWebMercatorT,!1),bt=u(h.structure,b.DEFAULT_STRUCTURE),ku=u(bt.heightScale,b.DEFAULT_STRUCTURE.heightScale),du=u(bt.heightOffset,b.DEFAULT_STRUCTURE.heightOffset),fr=u(bt.elementsPerHeight,b.DEFAULT_STRUCTURE.elementsPerHeight),wr=u(bt.stride,b.DEFAULT_STRUCTURE.stride),br=u(bt.elementMultiplier,b.DEFAULT_STRUCTURE.elementMultiplier),gu=u(bt.isBigEndian,b.DEFAULT_STRUCTURE.isBigEndian),vi=v.computeWidth(it),yi=v.computeHeight(it),nf=vi/(pt-1),tf=yi/(ti-1);li||(vi*=ft,yi*=ft);var er=ii.radiiSquared,rf=er.x,uf=er.y,kr=er.z,pi=65536,ei=-65536,dr=p.eastNorthUpToFixedFrame(ct,ii),ff=l.inverseTransformation(dr,d),or,gr;fi&&(or=w.geodeticLatitudeToMercatorAngle(wt),gr=1/(w.geodeticLatitudeToMercatorAngle(ui)-or));lt=g;lt.x=Number.POSITIVE_INFINITY;lt.y=Number.POSITIVE_INFINITY;lt.z=Number.POSITIVE_INFINITY;at=nt;at.x=Number.NEGATIVE_INFINITY;at.y=Number.NEGATIVE_INFINITY;at.z=Number.NEGATIVE_INFINITY;var sr=Number.POSITIVE_INFINITY,ef=pt+(ci>0?2:0),of=ti+(ci>0?2:0),kt=ef*of,wi=new Array(kt),nu=new Array(kt),tu=new Array(kt),iu=fi?new Array(kt):[],ru=0,uu=ti,fu=0,eu=pt;for(ci>0&&(--ru,++uu,--fu,++eu),dt=0,gt=ru;gt<uu;++gt){ot=gt;ot<0&&(ot=0);ot>=ti&&(ot=ti-1);rt=it.north-tf*ot;rt=li?yt(rt):ir-2*nr(tr(-rt*ft));var hr=di(rt),oi=gi(rt),cr=kr*oi,lr=(rt-wt)/(ui-wt);for(lr=c.clamp(lr,0,1),fi&&(ou=(w.geodeticLatitudeToMercatorAngle(rt)-or)*gr),ni=fu;ni<eu;++ni){if(st=ni,st<0&&(st=0),st>=pt&&(st=pt-1),ut=it.west+nf*st,ut=li?yt(ut):ut*ft,bi=ot*pt*wr+st*wr,fr===1)tt=rr[bi];else if(tt=0,gu)for(ht=0;ht<fr;++ht)tt=tt*br+rr[bi+ht];else for(ht=fr-1;ht>=0;--ht)tt=tt*br+rr[bi+ht];tt=(tt*ku+du)*bu;ki=(ut-ri)/(ai-ri);ki=c.clamp(ki,0,1);tu[dt]=new i(ki,lr);ei=Math.max(ei,tt);pi=Math.min(pi,tt);(ni!==st||gt!==ot)&&(si=1e-5,ni<0?ut-=si*vi:ut+=si*vi,gt<0?rt+=si*yi:rt-=si*yi,hr=di(rt),oi=gi(rt),cr=kr*oi,tt-=ci);var ar=hr*di(ut),vr=hr*gi(ut),su=rf*ar,hu=uf*vr,sf=wu(su*ar+hu*vr+cr*oi),yr=1/sf,hf=su*yr,cf=hu*yr,lf=cr*yr,hi=new r;hi.x=hf+ar*tt;hi.y=cf+vr*tt;hi.z=lf+oi*tt;wi[dt]=hi;nu[dt]=tt;fi&&(iu[dt]=ou);dt++;l.multiplyByPoint(ff,hi,k);r.minimumByComponent(k,lt,lt);r.maximumByComponent(k,at,at);sr=Math.min(sr,tt)}}cu=t.fromPoints(wi);f(et)&&et.width<c.PI_OVER_TWO+c.EPSILON5&&(lu=a.fromRectangle(et,pi,ei,ii));ur&&(vu=new s(ii),au=vu.computeHorizonCullingPoint(ct,wi));var af=new n(lt,at,ct),pr=new y(af,sr,ei,dr,!1,fi),yu=new Float32Array(kt*pr.getStride()),pu=0;for(vt=0;vt<kt;++vt)pu=pr.encode(yu,pu,wi[vt],tu[vt],nu[vt],undefined,iu[vt]);return{vertices:yu,maximumHeight:ei,minimumHeight:pi,encoding:pr,boundingSphere3D:cu,orientedBoundingBox:lu,occludeePointInScaledSpace:au}},b});t("Core/destroyObject",["./defaultValue","./DeveloperError"],function(n,t){"use strict";function i(){return!0}function r(r,u){function e(){throw new t(u);}u=n(u,"This object was destroyed, i.e., destroy() was called.");for(var f in r)typeof r[f]=="function"&&(r[f]=e);return r.isDestroyed=i,undefined}return r});t("Core/TaskProcessor",["../ThirdParty/when","./buildModuleUrl","./defaultValue","./defined","./destroyObject","./DeveloperError","./Event","./FeatureDetection","./getAbsoluteUri","./isCrossOriginUrl","./Resource","./RuntimeError","require"],function(n,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function b(){var t,i,f,e;if(!u(y._canTransferArrayBuffer)){t=new Worker(d("Workers/transferTypedArrayTest.js"));t.postMessage=r(t.webkitPostMessage,t.postMessage);i=99;f=new Int8Array([i]);try{t.postMessage({array:f},[f.buffer])}catch(o){return y._canTransferArrayBuffer=!1,y._canTransferArrayBuffer}e=n.defer();t.onmessage=function(n){var r=n.data.array,f=u(r)&&r[0]===i;e.resolve(f);t.terminate();y._canTransferArrayBuffer=f};y._canTransferArrayBuffer=e.promise}return y._canTransferArrayBuffer}function k(n,t){var r,f,o,i;(--n._activeTasks,r=t.id,u(r))&&(f=n._deferreds,o=f[r],u(t.error)?(i=t.error,i.name==="RuntimeError"?(i=new a(t.error.message),i.stack=t.error.stack):i.name==="DeveloperError"&&(i=new e(t.error.message),i.stack=t.error.stack),p.raiseEvent(i),o.reject(i)):(p.raiseEvent(),o.resolve(t.result)),delete f[r])}function d(n){var t=i(n),r,u,e,f,o;if(c(t)){r='importScripts("'+t+'");';try{u=new Blob([r],{type:"application/javascript"})}catch(s){e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;f=new e;f.append(r);u=f.getBlob("application/javascript")}o=window.URL||window.webkitURL;t=o.createObjectURL(u)}return t}function nt(){return u(w)||(w=d("Workers/cesiumWorkerBootstrapper.js")),w}function g(n){var f=new Worker(nt()),e;return f.postMessage=r(f.webkitPostMessage,f.postMessage),e={loaderConfig:{},workerModule:y._workerModulePrefix+n._workerName},u(y._loaderConfig)?e.loaderConfig=y._loaderConfig:(u(t.amd)&&!t.amd.toUrlUndefined&&u(v.toUrl)||(e.loaderConfig.paths={Workers:i("Workers")}),e.loaderConfig.baseUrl=i.getCesiumBaseUrl().url),f.postMessage(e),f.onmessage=function(t){k(n,t.data)},f}function tt(t,r){var f={modulePath:undefined,wasmBinaryFile:undefined,wasmBinary:undefined};if(!s.supportsWebAssembly()){if(!u(r.fallbackModulePath))throw new a("This browser does not support Web Assembly, and no backup module was provided for "+t._workerName);return f.modulePath=i(r.fallbackModulePath),n.resolve(f)}return f.modulePath=i(r.modulePath),f.wasmBinaryFile=i(r.wasmBinaryFile),l.fetchArrayBuffer({url:f.wasmBinaryFile}).then(function(n){return f.wasmBinary=n,f})}function y(n,t){this._workerName=n;this._maximumActiveTasks=r(t,5);this._activeTasks=0;this._deferreds={};this._nextID=0}var p=new o,w,it=[];return y.prototype.scheduleTask=function(t,i){if(u(this._worker)||(this._worker=g(this)),this._activeTasks>=this._maximumActiveTasks)return undefined;++this._activeTasks;var r=this;return n(b(),function(f){u(i)?f||(i.length=0):i=it;var e=r._nextID++,o=n.defer();return r._deferreds[e]=o,r._worker.postMessage({id:e,parameters:t,canTransferArrayBuffer:f},i),o.promise})},y.prototype.initWebAssemblyModule=function(t){u(this._worker)||(this._worker=g(this));var r=n.defer(),f=this,i=this._worker;return tt(this,t).then(function(t){return n(b(),function(n){var e,o=t.wasmBinary;u(o)&&n&&(e=[o]);i.onmessage=function(n){i.onmessage=function(n){k(f,n.data)};r.resolve(n.data)};i.postMessage({webAssemblyConfig:t},e)})}),r},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return u(this._worker)&&this._worker.terminate(),f(this)},y.taskCompletedEvent=p,y._defaultWorkerModulePrefix="Workers/",y._workerModulePrefix=y._defaultWorkerModulePrefix,y._loaderConfig=undefined,y._canTransferArrayBuffer=undefined,y});t("Core/TerrainMesh",["./defaultValue"],function(n){"use strict";function t(t,i,r,u,f,e,o,s,h,c,l){this.center=t;this.vertices=i;this.stride=n(s,6);this.indices=r;this.minimumHeight=u;this.maximumHeight=f;this.boundingSphere3D=e;this.occludeePointInScaledSpace=o;this.orientedBoundingBox=h;this.encoding=c;this.exaggeration=l}return t});t("Core/TerrainProvider",["./defined","./defineProperties","./DeveloperError","./Math"],function(n,t,i,r){"use strict";function u(){i.throwInstantiationError()}t(u.prototype,{errorEvent:{get:i.throwInstantiationError},credit:{get:i.throwInstantiationError},tilingScheme:{get:i.throwInstantiationError},ready:{get:i.throwInstantiationError},readyPromise:{get:i.throwInstantiationError},hasWaterMask:{get:i.throwInstantiationError},hasVertexNormals:{get:i.throwInstantiationError},availability:{get:i.throwInstantiationError}});var f=[];return u.getRegularGridIndices=function(t,u){var s,e,h,o,c,l;if(t*u>=r.SIXTY_FOUR_KILOBYTES)throw new i("The total number of vertices (width * height) must be less than 65536.");if(s=f[t],n(s)||(f[t]=s=[]),e=s[u],!n(e))for(e=s[u]=new Uint16Array((t-1)*(u-1)*6),h=0,o=0,c=0;c<u-1;++c){for(l=0;l<t-1;++l){var a=h,v=a+t,p=v+1,y=a+1;e[o++]=a;e[o++]=v;e[o++]=y;e[o++]=y;e[o++]=v;e[o++]=p;++h}++h}return e},u.heightmapTerrainQuality=.25,u.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(n,t,i){return n.maximumRadius*2*Math.PI*u.heightmapTerrainQuality/(t*i)},u.prototype.requestTileGeometry=i.throwInstantiationError,u.prototype.getLevelMaximumGeometricError=i.throwInstantiationError,u.prototype.getTileDataAvailable=i.throwInstantiationError,u});t("Core/HeightmapTerrainData",["../ThirdParty/when","./defaultValue","./defined","./defineProperties","./DeveloperError","./GeographicProjection","./HeightmapTessellator","./Math","./Rectangle","./TaskProcessor","./TerrainEncoding","./TerrainMesh","./TerrainProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(n){if(!i(n)||!i(n.buffer))throw new u("options.buffer is required.");if(!i(n.width))throw new u("options.width is required.");if(!i(n.height))throw new u("options.height is required.");this._buffer=n.buffer;this._width=n.width;this._height=n.height;this._childTileMask=t(n.childTileMask,15);var f=e.DEFAULT_STRUCTURE,r=n.structure;i(r)?r!==f&&(r.heightScale=t(r.heightScale,f.heightScale),r.heightOffset=t(r.heightOffset,f.heightOffset),r.elementsPerHeight=t(r.elementsPerHeight,f.elementsPerHeight),r.stride=t(r.stride,f.stride),r.elementMultiplier=t(r.elementMultiplier,f.elementMultiplier),r.isBigEndian=t(r.isBigEndian,f.isBigEndian)):r=f;this._structure=r;this._createdByUpsampling=t(n.createdByUpsampling,!1);this._waterMask=n.waterMask;this._skirtHeight=undefined;this._bufferType=this._buffer.constructor;this._mesh=undefined}function k(n,t,i,r,u,f,e,o,s,h){var p=(s-f.west)*(e-1)/(f.east-f.west),b=(h-f.south)*(o-1)/(f.north-f.south),a=p|0,v=a+1,c,l,k,d;v>=e&&(v=e-1,a=e-2);c=b|0;l=c+1;l>=o&&(l=o-1,c=o-2);k=p-a;d=b-c;c=o-1-c;l=o-1-l;var g=y(n,t,i,r,u,c*e+a),nt=y(n,t,i,r,u,c*e+v),tt=y(n,t,i,r,u,l*e+a),it=y(n,t,i,r,u,l*e+v);return w(k,d,g,nt,tt,it)}function p(n,t,i,r,u,f,e,o,s,h,c){var p=(s-f.west)*(e-1)/(f.east-f.west),b=(h-f.south)*(o-1)/(f.north-f.south),k,d;u>0&&(p+=1,b+=1,e+=2,o+=2);var g=u>0?e-1:e,v=p|0,y=v+1;y>=g&&(y=e-1,v=e-2);var nt=u>0?o-1:o,l=b|0,a=l+1;a>=nt&&(a=o-1,l=o-2);k=p-v;d=b-l;l=o-1-l;a=o-1-a;var tt=(t.decodeHeight(n,l*e+v)/c-i)/r,it=(t.decodeHeight(n,l*e+y)/c-i)/r,rt=(t.decodeHeight(n,a*e+v)/c-i)/r,ut=(t.decodeHeight(n,a*e+y)/c-i)/r;return w(k,d,tt,it,rt,ut)}function w(n,t,i,r,u,f){return t<n?i+n*(r-i)+t*(f-r):i+n*(f-u)+t*(u-i)}function y(n,t,i,r,u,f){f*=r;var o=0,e;if(u)for(e=0;e<t;++e)o=o*i+n[f+e];else for(e=t-1;e>=0;--e)o=o*i+n[f+e];return o}function d(n,t,i,r,u,f,e,o){e*=u;var s;if(f)for(s=0;s<t-1;++s)n[e+s]=o/r|0,o-=n[e+s]*r,r/=i;else for(s=t-1;s>0;--s)n[e+s]=o/r|0,o-=n[e+s]*r,r/=i;n[e+s]=o}r(v.prototype,{credits:{get:function(){return undefined}},waterMask:{get:function(){return this._waterMask}}});var b=new h("createVerticesFromHeightmap");return v.prototype.createMesh=function(r,e,o,h,v){var w,y;if(!i(r))throw new u("tilingScheme is required.");if(!i(e))throw new u("x is required.");if(!i(o))throw new u("y is required.");if(!i(h))throw new u("level is required.");var p=r.ellipsoid,g=r.tileXYToNativeRectangle(e,o,h),k=r.tileXYToRectangle(e,o,h);v=t(v,1);var d=p.cartographicToCartesian(s.center(k)),nt=this._structure,tt=a.getEstimatedLevelZeroGeometricErrorForAHeightmap(p,this._width,r.getNumberOfXTilesAtLevel(0)),it=tt/(1<<h);return(this._skirtHeight=Math.min(it*4,1e3),w=b.scheduleTask({heightmap:this._buffer,structure:nt,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:g,rectangle:k,relativeToCenter:d,ellipsoid:p,skirtHeight:this._skirtHeight,isGeographic:r.projection instanceof f,exaggeration:v}),!i(w))?undefined:(y=this,n(w,function(n){return y._mesh=new l(d,new Float32Array(n.vertices),a.getRegularGridIndices(n.gridWidth,n.gridHeight),n.minimumHeight,n.maximumHeight,n.boundingSphere3D,n.occludeePointInScaledSpace,n.numberOfAttributes,n.orientedBoundingBox,c.clone(n.encoding),v),y._buffer=undefined,y._mesh}))},v.prototype.interpolateHeight=function(n,t,r){var e=this._width,o=this._height,u=this._structure,c=u.stride,l=u.elementsPerHeight,a=u.elementMultiplier,v=u.isBigEndian,s=u.heightOffset,h=u.heightScale,f;if(i(this._mesh)){var y=this._mesh.vertices,w=this._mesh.encoding,b=this._skirtHeight,d=this._mesh.exaggeration;f=p(y,w,s,h,b,n,e,o,t,r,d)}else f=k(this._buffer,l,a,c,v,n,e,o,t,r),f=f*h+s;return f},v.prototype.upsample=function(n,t,r,f,e,s,h){var nt,w,ft,b,et,l;if(!i(n))throw new u("tilingScheme is required.");if(!i(t))throw new u("thisX is required.");if(!i(r))throw new u("thisY is required.");if(!i(f))throw new u("thisLevel is required.");if(!i(e))throw new u("descendantX is required.");if(!i(s))throw new u("descendantY is required.");if(!i(h))throw new u("descendantLevel is required.");if(nt=h-f,nt>1)throw new u("Upsampling through more than one level at a time is not currently supported.");var a=this._width,y=this._height,c=this._structure,ot=this._skirtHeight,tt=c.stride,it=new this._bufferType(a*y*tt),k=this._mesh;if(!i(k))return undefined;var st=k.vertices,ht=k.encoding,ct=n.tileXYToRectangle(t,r,f),g=n.tileXYToRectangle(e,s,h),lt=c.heightOffset,at=c.heightScale,vt=k.exaggeration,rt=c.elementsPerHeight,ut=c.elementMultiplier,yt=c.isBigEndian,pt=Math.pow(ut,rt-1);for(w=0;w<y;++w)for(ft=o.lerp(g.north,g.south,w/(y-1)),b=0;b<a;++b)et=o.lerp(g.west,g.east,b/(a-1)),l=p(st,ht,lt,at,ot,ct,a,y,et,ft,vt),l=l<c.lowestEncodedHeight?c.lowestEncodedHeight:l,l=l>c.highestEncodedHeight?c.highestEncodedHeight:l,d(it,rt,ut,pt,tt,yt,w*a+b,l);return new v({buffer:it,width:a,height:y,childTileMask:0,structure:this._structure,createdByUpsampling:!0})},v.prototype.isChildAvailable=function(n,t,r,f){if(!i(n))throw new u("thisX is required.");if(!i(t))throw new u("thisY is required.");if(!i(r))throw new u("childX is required.");if(!i(f))throw new u("childY is required.");var e=2;return r!==n*2&&++e,f!==t*2&&(e-=2),(this._childTileMask&1<<e)!=0},v.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling},v});t("Core/IndexDatatype",["./defined","./DeveloperError","./freezeObject","./Math","./WebGLConstants"],function(n,t,i,r,u){"use strict";var f={UNSIGNED_BYTE:u.UNSIGNED_BYTE,UNSIGNED_SHORT:u.UNSIGNED_SHORT,UNSIGNED_INT:u.UNSIGNED_INT};return f.getSizeInBytes=function(n){switch(n){case f.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case f.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case f.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}throw new t("indexDatatype is required and must be a valid IndexDatatype constant.");},f.validate=function(t){return n(t)&&(t===f.UNSIGNED_BYTE||t===f.UNSIGNED_SHORT||t===f.UNSIGNED_INT)},f.createTypedArray=function(i,u){if(!n(i))throw new t("numberOfVertices is required.");return i>=r.SIXTY_FOUR_KILOBYTES?new Uint32Array(u):new Uint16Array(u)},f.createTypedArrayFromArrayBuffer=function(i,u,f,e){if(!n(i))throw new t("numberOfVertices is required.");if(!n(u))throw new t("sourceArray is required.");if(!n(f))throw new t("byteOffset is required.");return i>=r.SIXTY_FOUR_KILOBYTES?new Uint32Array(u,f,e):new Uint16Array(u,f,e)},i(f)});t("Core/Intersections2D",["./Cartesian3","./defined","./DeveloperError"],function(n,t,i){"use strict";var r={};return r.clipTriangleAtAxisAlignedThreshold=function(n,r,u,f,e,o){var s,h,c,b,l,a,v,y,p,w;if(!t(n))throw new i("threshold is required.");if(!t(r))throw new i("keepAbove is required.");if(!t(u))throw new i("u0 is required.");if(!t(f))throw new i("u1 is required.");if(!t(e))throw new i("u2 is required.");return t(o)?o.length=0:o=[],r?(s=u<n,h=f<n,c=e<n):(s=u>n,h=f>n,c=e>n),b=s+h+c,b===1?s?(l=(n-u)/(f-u),a=(n-u)/(e-u),o.push(1),o.push(2),a!==1&&(o.push(-1),o.push(0),o.push(2),o.push(a)),l!==1&&(o.push(-1),o.push(0),o.push(1),o.push(l))):h?(v=(n-f)/(e-f),y=(n-f)/(u-f),o.push(2),o.push(0),y!==1&&(o.push(-1),o.push(1),o.push(0),o.push(y)),v!==1&&(o.push(-1),o.push(1),o.push(2),o.push(v))):c&&(p=(n-e)/(u-e),w=(n-e)/(f-e),o.push(0),o.push(1),w!==1&&(o.push(-1),o.push(2),o.push(1),o.push(w)),p!==1&&(o.push(-1),o.push(2),o.push(0),o.push(p))):b===2?s||u===n?h||f===n?c||e===n||(a=(n-u)/(e-u),v=(n-f)/(e-f),o.push(2),o.push(-1),o.push(0),o.push(2),o.push(a),o.push(-1),o.push(1),o.push(2),o.push(v)):(w=(n-e)/(f-e),l=(n-u)/(f-u),o.push(1),o.push(-1),o.push(2),o.push(1),o.push(w),o.push(-1),o.push(0),o.push(1),o.push(l)):(y=(n-f)/(u-f),p=(n-e)/(u-e),o.push(0),o.push(-1),o.push(1),o.push(0),o.push(y),o.push(-1),o.push(2),o.push(0),o.push(p)):b!==3&&(o.push(0),o.push(1),o.push(2)),o},r.computeBarycentricCoordinates=function(r,u,f,e,o,s,h,c,l){if(!t(r))throw new i("x is required.");if(!t(u))throw new i("y is required.");if(!t(f))throw new i("x1 is required.");if(!t(e))throw new i("y1 is required.");if(!t(o))throw new i("x2 is required.");if(!t(s))throw new i("y2 is required.");if(!t(h))throw new i("x3 is required.");if(!t(c))throw new i("y3 is required.");var y=f-h,p=h-o,w=s-c,b=e-c,k=1/(w*y+p*b),d=u-c,g=r-h,a=(w*g+p*d)*k,v=(-b*g+y*d)*k,nt=1-a-v;return t(l)?(l.x=a,l.y=v,l.z=nt,l):new n(a,v,nt)},r});t("Core/QuantizedMeshTerrainData",["../ThirdParty/when","./BoundingSphere","./Cartesian2","./Cartesian3","./defaultValue","./defined","./defineProperties","./DeveloperError","./IndexDatatype","./Intersections2D","./Math","./OrientedBoundingBox","./TaskProcessor","./TerrainEncoding","./TerrainMesh"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n){function e(n,t){return r[n]-r[t]}function s(n,t){return i[n]-i[t]}if(!f(n)||!f(n.quantizedVertices))throw new o("options.quantizedVertices is required.");if(!f(n.indices))throw new o("options.indices is required.");if(!f(n.minimumHeight))throw new o("options.minimumHeight is required.");if(!f(n.maximumHeight))throw new o("options.maximumHeight is required.");if(!f(n.maximumHeight))throw new o("options.maximumHeight is required.");if(!f(n.boundingSphere))throw new o("options.boundingSphere is required.");if(!f(n.horizonOcclusionPoint))throw new o("options.horizonOcclusionPoint is required.");if(!f(n.westIndices))throw new o("options.westIndices is required.");if(!f(n.southIndices))throw new o("options.southIndices is required.");if(!f(n.eastIndices))throw new o("options.eastIndices is required.");if(!f(n.northIndices))throw new o("options.northIndices is required.");if(!f(n.westSkirtHeight))throw new o("options.westSkirtHeight is required.");if(!f(n.southSkirtHeight))throw new o("options.southSkirtHeight is required.");if(!f(n.eastSkirtHeight))throw new o("options.eastSkirtHeight is required.");if(!f(n.northSkirtHeight))throw new o("options.northSkirtHeight is required.");this._quantizedVertices=n.quantizedVertices;this._encodedNormals=n.encodedNormals;this._indices=n.indices;this._minimumHeight=n.minimumHeight;this._maximumHeight=n.maximumHeight;this._boundingSphere=n.boundingSphere;this._orientedBoundingBox=n.orientedBoundingBox;this._horizonOcclusionPoint=n.horizonOcclusionPoint;this._credits=n.credits;var t=this._quantizedVertices.length/3,i=this._uValues=this._quantizedVertices.subarray(0,t),r=this._vValues=this._quantizedVertices.subarray(t,2*t);this._heightValues=this._quantizedVertices.subarray(2*t,3*t);this._westIndices=b(n.westIndices,e,t);this._southIndices=b(n.southIndices,s,t);this._eastIndices=b(n.eastIndices,e,t);this._northIndices=b(n.northIndices,s,t);this._westSkirtHeight=n.westSkirtHeight;this._southSkirtHeight=n.southSkirtHeight;this._eastSkirtHeight=n.eastSkirtHeight;this._northSkirtHeight=n.northSkirtHeight;this._childTileMask=u(n.childTileMask,15);this._createdByUpsampling=u(n.createdByUpsampling,!1);this._waterMask=n.waterMask;this._mesh=undefined}function b(n,t,i){var u,r,f;for(w.length=n.length,u=!1,r=0,f=n.length;r<f;++r)w[r]=n[r],u=u||r>0&&t(n[r-1],n[r])>0;return u?(w.sort(t),s.createTypedArray(i,w)):n}function ut(n,t,i){for(var s=n._mesh,r=s.vertices,u=s.encoding,o=s.indices,e=0,w=o.length;e<w;e+=3){var c=o[e],l=o[e+1],a=o[e+2],v=u.decodeTextureCoordinates(r,c,tt),y=u.decodeTextureCoordinates(r,l,it),p=u.decodeTextureCoordinates(r,a,rt),f=h.computeBarycentricCoordinates(t,i,v.x,v.y,y.x,y.y,p.x,p.y,d);if(f.x>=-1e-15&&f.y>=-1e-15&&f.z>=-1e-15){var b=u.decodeHeight(r,c),k=u.decodeHeight(r,l),g=u.decodeHeight(r,a);return f.x*b+f.y*k+f.z*g}}return undefined}function ft(n,t,i){for(var y,e=n._uValues,o=n._vValues,s=n._heightValues,f=n._indices,u=0,p=f.length;u<p;u+=3){var l=f[u],a=f[u+1],v=f[u+2],w=e[l],b=e[a],g=e[v],nt=o[l],tt=o[a],it=o[v],r=h.computeBarycentricCoordinates(t,i,w,nt,b,tt,g,it,d);if(r.x>=-1e-15&&r.y>=-1e-15&&r.z>=-1e-15)return y=r.x*s[l]+r.y*s[a]+r.z*s[v],c.lerp(n._minimumHeight,n._maximumHeight,y/k)}return undefined}var w,g,nt,k,d;e(p.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){return this._waterMask}}});w=[];g=new a("createVerticesFromQuantizedTerrainMesh");p.prototype.createMesh=function(t,i,r,e,h){var a,p,l,c;if(!f(t))throw new o("tilingScheme is required.");if(!f(i))throw new o("x is required.");if(!f(r))throw new o("y is required.");if(!f(e))throw new o("level is required.");return(a=t.ellipsoid,p=t.tileXYToRectangle(i,r,e),h=u(h,1),l=g.scheduleTask({minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,quantizedVertices:this._quantizedVertices,octEncodedNormals:this._encodedNormals,includeWebMercatorT:!0,indices:this._indices,westIndices:this._westIndices,southIndices:this._southIndices,eastIndices:this._eastIndices,northIndices:this._northIndices,westSkirtHeight:this._westSkirtHeight,southSkirtHeight:this._southSkirtHeight,eastSkirtHeight:this._eastSkirtHeight,northSkirtHeight:this._northSkirtHeight,rectangle:p,relativeToCenter:this._boundingSphere.center,ellipsoid:a,exaggeration:h}),!f(l))?undefined:(c=this,n(l,function(n){var t=c._quantizedVertices.length/3+(c._westIndices.length+c._southIndices.length+c._eastIndices.length+c._northIndices.length);var i=s.createTypedArray(t,n.indices),r=new Float32Array(n.vertices),f=n.center,e=n.minimumHeight,o=n.maximumHeight,l=u(n.boundingSphere,c._boundingSphere),a=u(n.orientedBoundingBox,c._orientedBoundingBox),p=c._horizonOcclusionPoint,w=n.vertexStride,b=v.clone(n.encoding);return c._skirtIndex=n.skirtIndex,c._vertexCountWithoutSkirts=c._quantizedVertices.length/3,c._mesh=new y(f,r,i,e,o,l,p,w,a,b,h),c._quantizedVertices=undefined,c._encodedNormals=undefined,c._indices=undefined,c._uValues=undefined,c._vValues=undefined,c._heightValues=undefined,c._westIndices=undefined,c._southIndices=undefined,c._eastIndices=undefined,c._northIndices=undefined,c._mesh}))};nt=new a("upsampleQuantizedTerrainMesh");p.prototype.upsample=function(i,u,e,h,c,a,v){var d,w,y;if(!f(i))throw new o("tilingScheme is required.");if(!f(u))throw new o("thisX is required.");if(!f(e))throw new o("thisY is required.");if(!f(h))throw new o("thisLevel is required.");if(!f(c))throw new o("descendantX is required.");if(!f(a))throw new o("descendantY is required.");if(!f(v))throw new o("descendantLevel is required.");if(d=v-h,d>1)throw new o("Upsampling through more than one level at a time is not currently supported.");if(w=this._mesh,!f(this._mesh))return undefined;var b=u*2!==c,k=e*2===a,tt=i.ellipsoid,it=i.tileXYToRectangle(c,a,v),g=nt.scheduleTask({vertices:w.vertices,vertexCountWithoutSkirts:this._vertexCountWithoutSkirts,indices:w.indices,skirtIndex:this._skirtIndex,encoding:w.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:b,isNorthChild:k,childRectangle:it,ellipsoid:tt,exaggeration:w.exaggeration});if(!f(g))return undefined;y=Math.min(this._westSkirtHeight,this._eastSkirtHeight);y=Math.min(y,this._southSkirtHeight);y=Math.min(y,this._northSkirtHeight);var rt=b?y*.5:this._westSkirtHeight,ut=k?y*.5:this._southSkirtHeight,ft=b?this._eastSkirtHeight:y*.5,et=k?this._northSkirtHeight:y*.5,ot=this._credits;return n(g).then(function(n){var i=new Uint16Array(n.vertices),e=s.createTypedArray(i.length/3,n.indices),u;return f(n.encodedNormals)&&(u=new Uint8Array(n.encodedNormals)),new p({quantizedVertices:i,indices:e,encodedNormals:u,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,boundingSphere:t.clone(n.boundingSphere),orientedBoundingBox:l.clone(n.orientedBoundingBox),horizonOcclusionPoint:r.clone(n.horizonOcclusionPoint),westIndices:n.westIndices,southIndices:n.southIndices,eastIndices:n.eastIndices,northIndices:n.northIndices,westSkirtHeight:rt,southSkirtHeight:ut,eastSkirtHeight:ft,northSkirtHeight:et,childTileMask:0,credits:ot,createdByUpsampling:!0})})};k=32767;d=new r;p.prototype.interpolateHeight=function(n,t,i){var u=c.clamp((t-n.west)/n.width,0,1),r;return(u*=k,r=c.clamp((i-n.south)/n.height,0,1),r*=k,!f(this._mesh))?ft(this,u,r):ut(this,u,r)};var tt=new i,it=new i,rt=new i;return p.prototype.isChildAvailable=function(n,t,i,r){if(!f(n))throw new o("thisX is required.");if(!f(t))throw new o("thisY is required.");if(!f(i))throw new o("childX is required.");if(!f(r))throw new o("childY is required.");var u=2;return i!==n*2&&++u,r!==t*2&&(u-=2),(this._childTileMask&1<<u)!=0},p.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling},p});t("Core/TileAvailability",["./binarySearch","./Cartographic","./defined","./defineProperties","./DeveloperError","./Rectangle"],function(n,t,i,r,u,f){"use strict";function o(n,t){this._tilingScheme=n;this._maximumLevel=t;this._rootNodes=[]}function p(n,t,i,r){for(var u,e=r.length,f=0;f<e;++f)if(u=r[f],u.x===t&&u.y===i&&u.level===n)return!0;return!1}function s(n,t,i,r,u){this.tilingScheme=n;this.parent=t;this.level=i;this.x=r;this.y=u;this.extent=n.tileXYToRectangle(r,u,i);this.rectangles=[];this._sw=undefined;this._se=undefined;this._nw=undefined;this._ne=undefined}function g(n,t,i,r,u){this.level=n;this.west=t;this.south=i;this.east=r;this.north=u}function y(n,t){var i=Math.max(n.west,t.west),r=Math.max(n.south,t.south),u=Math.min(n.east,t.east),f=Math.min(n.north,t.north);return r<f&&i<u}function nt(t,i,r){while(i.level<t)if(a(i.nw.extent,r))i=i.nw;else if(a(i.ne.extent,r))i=i.ne;else if(a(i.sw.extent,r))i=i.sw;else if(a(i.se.extent,r))i=i.se;else break;if(i.rectangles.length===0||i.rectangles[i.rectangles.length-1].level<=r.level)i.rectangles.push(r);else{var u=n(i.rectangles,r.level,tt);u<=0&&(u=~u);i.rectangles.splice(u,0,r)}}function tt(n,t){return n.level-t}function a(n,t){return t.west>=n.west&&t.east<=n.east&&t.south>=n.south&&t.north<=n.north}function h(n,t){return t.longitude>=n.west&&t.longitude<=n.east&&t.latitude>=n.south&&t.latitude<=n.north}function c(n,t,i){for(var r=0,v=!1,f,u,a;!v;){var e=t._nw&&h(t._nw.extent,i),o=t._ne&&h(t._ne.extent,i),s=t._sw&&h(t._sw.extent,i),l=t._se&&h(t._se.extent,i);if(e+o+s+l>1){e&&(r=Math.max(r,c(t,t._nw,i)));o&&(r=Math.max(r,c(t,t._ne,i)));s&&(r=Math.max(r,c(t,t._sw,i)));l&&(r=Math.max(r,c(t,t._se,i)));break}else e?t=t._nw:o?t=t._ne:s?t=t._sw:l?t=t._se:v=!0}while(t!==n){for(f=t.rectangles,u=f.length-1;u>=0&&f[u].level>r;--u)a=f[u],h(a,i)&&(r=a.level);t=t.parent}return r}function l(n,t,i){var r,f,e,u;if(t){for(f=!1,r=0;r<i.length;++r)f=f||y(t.extent,i[r]);if(f){for(e=t.rectangles,r=0;r<e.length;++r)u=e[r],n[u.level]||(n[u.level]=i),n[u.level]=it(n[u.level],u);l(n,t._nw,i);l(n,t._ne,i);l(n,t._sw,i);l(n,t._se,i)}}}function it(n,t){for(var i,r=[],u=0;u<n.length;++u)i=n[u],y(i,t)?(i.west<t.west&&r.push(new f(i.west,i.south,t.west,i.north)),i.east>t.east&&r.push(new f(t.east,i.south,i.east,i.north)),i.south<t.south&&r.push(new f(Math.max(t.west,i.west),i.south,Math.min(t.east,i.east),t.south)),i.north>t.north&&r.push(new f(Math.max(t.west,i.west),t.north,Math.min(t.east,i.east),i.north))):r.push(i);return r}var e=new f,v;o.prototype.addAvailableTileRange=function(n,t,i,r,u){var l=this._tilingScheme,h=this._rootNodes,f,o,v,w,c,a;if(n===0)for(f=i;f<=u;++f)for(o=t;o<=r;++o)p(n,o,f,h)||h.push(new s(l,undefined,0,o,f));l.tileXYToRectangle(t,i,n,e);v=e.west;w=e.north;l.tileXYToRectangle(r,u,n,e);var k=e.east,d=e.south,b=new g(n,v,d,k,w);for(c=0;c<h.length;++c)a=h[c],y(a.extent,b)&&nt(this._maximumLevel,a,b)};o.prototype.computeMaximumLevelAtPosition=function(n){for(var u,t,r=0;r<this._rootNodes.length;++r)if(u=this._rootNodes[r],h(u.extent,n)){t=u;break}return i(t)?c(undefined,t,n):-1};var w=[],b=[],k=new f,d=new f;return o.prototype.computeBestAvailableLevelOverRectangle=function(n){var u=w,r,t;for(u.length=0,n.east<n.west?(u.push(f.fromRadians(-Math.PI,n.south,n.east,n.north,k)),u.push(f.fromRadians(n.west,n.south,Math.PI,n.north,d))):u.push(n),r=b,r.length=0,t=0;t<this._rootNodes.length;++t)l(r,this._rootNodes[t],u);for(t=r.length-1;t>=0;--t)if(i(r[t])&&r[t].length===0)return t;return 0},v=new t,o.prototype.isTileAvailable=function(n,t,i){var r=this._tilingScheme.tileXYToRectangle(t,i,n,e);return f.center(r,v),this.computeMaximumLevelAtPosition(v)>=n},o.prototype.computeChildMaskForTile=function(n,t,i){var r=n+1,u;return r>=this._maximumLevel?0:(u=0,u|=this.isTileAvailable(r,2*t,2*i+1)?1:0,u|=this.isTileAvailable(r,2*t+1,2*i+1)?2:0,u|=this.isTileAvailable(r,2*t,2*i)?4:0,u|(this.isTileAvailable(r,2*t+1,2*i)?8:0))},r(s.prototype,{nw:{get:function(){return this._nw||(this._nw=new s(this.tilingScheme,this,this.level+1,this.x*2,this.y*2)),this._nw}},ne:{get:function(){return this._ne||(this._ne=new s(this.tilingScheme,this,this.level+1,this.x*2+1,this.y*2)),this._ne}},sw:{get:function(){return this._sw||(this._sw=new s(this.tilingScheme,this,this.level+1,this.x*2,this.y*2+1)),this._sw}},se:{get:function(){return this._se||(this._se=new s(this.tilingScheme,this,this.level+1,this.x*2+1,this.y*2+1)),this._se}}}),o});t("Core/formatError",["./defined"],function(n){"use strict";function t(t){var i,u=t.name,f=t.message,r;return i=n(u)&&n(f)?u+": "+f:t.toString(),r=t.stack,n(r)&&(i+="\n"+r),i}return t});t("Core/TileProviderError",["./defaultValue","./defined","./formatError"],function(n,t,i){"use strict";function r(t,i,r,u,f,e,o){this.provider=t;this.message=i;this.x=r;this.y=u;this.level=f;this.timesRetried=n(e,0);this.retry=!1;this.error=o}return r.handleError=function(n,u,f,e,o,s,h,c,l){var a=n;return t(n)?(a.provider=u,a.message=e,a.x=o,a.y=s,a.level=h,a.retry=!1,a.error=l,++a.timesRetried):a=new r(u,e,o,s,h,0,l),f.numberOfListeners>0?f.raiseEvent(a):console.log('An error occurred in "'+u.constructor.name+'": '+i(e)),a.retry&&t(c)&&c(),a},r.handleSuccess=function(n){t(n)&&(n.timesRetried=-1)},r});t("Core/CesiumTerrainProvider",["../ThirdParty/Uri","../ThirdParty/when","./AttributeCompression","./BoundingSphere","./Cartesian3","./Credit","./defaultValue","./defined","./defineProperties","./deprecationWarning","./DeveloperError","./Event","./GeographicTilingScheme","./HeightmapTerrainData","./IndexDatatype","./Math","./OrientedBoundingBox","./QuantizedMeshTerrainData","./Resource","./RuntimeError","./TerrainProvider","./TileAvailability","./TileProviderError"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function ft(n){this.resource=n.resource;this.version=n.version;this.isHeightmap=n.isHeightmap;this.tileUrlTemplates=n.tileUrlTemplates;this.availability=n.availability;this.hasVertexNormals=n.hasVertexNormals;this.hasWaterMask=n.hasWaterMask;this.littleEndianExtensionSize=n.littleEndianExtensionSize}function it(i){function it(n){var f,st,h,a,i,k,d,y,g,lt;if(!n.format){f="The tile format is not specified in the layer.json file.";u=tt.handleError(u,r,r._errorEvent,f,undefined,undefined,undefined,b);return}if(!n.tiles||n.tiles.length===0){f="The layer.json file does not specify any tile URL templates.";u=tt.handleError(u,r,r._errorEvent,f,undefined,undefined,undefined,b);return}var c=!1,l=!1,ut=!0,ot=!1;if(n.format==="heightmap-1.0")ot=!0,o(r._heightmapStructure)||(r._heightmapStructure={heightScale:1/5,heightOffset:-1e3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),l=!0,r._requestWaterMask=!0;else if(n.format.indexOf("quantized-mesh-1.")!==0){f='The tile format "'+n.format+'" is invalid or not supported.';u=tt.handleError(u,r,r._errorEvent,f,undefined,undefined,undefined,b);return}if(st=n.tiles,h=n.available,o(h))for(a=new nt(r._tilingScheme,h.length),i=0;i<h.length;++i)for(k=h[i],d=r._tilingScheme.getNumberOfYTilesAtLevel(i),o(w[i])||(w[i]=[]),y=0;y<k.length;++y){var e=k[y],ht=d-e.endY-1,ct=d-e.startY-1;w[i].push([e.startX,ht,e.endX,ct]);a.addAvailableTileRange(i,e.startX,ht,e.endX,ct)}return(o(n.extensions)&&n.extensions.indexOf("octvertexnormals")!==-1?c=!0:o(n.extensions)&&n.extensions.indexOf("vertexnormals")!==-1&&(c=!0,ut=!1),o(n.extensions)&&n.extensions.indexOf("watermask")!==-1&&(l=!0),r._hasWaterMask=r._hasWaterMask||l,r._hasVertexNormals=r._hasVertexNormals||c,o(n.attribution)&&(p.length>0&&(p+=" "),p+=n.attribution),et.push(new ft({resource:s,version:n.version,isHeightmap:ot,tileUrlTemplates:st,availability:a,hasVertexNormals:c,hasWaterMask:l,littleEndianExtensionSize:ut})),g=n.parentUrl,o(g))?o(a)?(s=s.getDerivedResource({url:g}),s.appendForwardSlash(),v=s.getDerivedResource({url:"layer.json"}),lt=v.fetchJson(),t(lt,it,rt)):(console.log("A layer.json can't have a parentUrl if it does't have an available array."),t.resolve()):t.resolve()}function rt(){var n="An error occurred while accessing "+v.url+".";u=tt.handleError(u,r,r._errorEvent,n,undefined,undefined,undefined,b)}function ut(n){it(n).then(function(){var i,c,n,s,e,t,h;if(!o(u)){if(i=w.length,i>0)for(c=r._availability=new nt(r._tilingScheme,i),n=0;n<i;++n)for(s=w[n],e=0;e<s.length;++e)t=s[e],c.addAvailableTileRange(n,t[0],t[1],t[2],t[3]);p.length>0&&(h=new f(p),o(r._tileCredits)?r._tileCredits.push(h):r._tileCredits=[h]);r._ready=!0;r._readyPromise.resolve(!0)}})}function ot(n){if(o(n)&&n.statusCode===404){ut({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v={version}"]});return}rt(n)}function b(){t(v.fetchJson()).then(ut).otherwise(ot)}var y,d;if(!o(i)||!o(i.url))throw new c("options.url is required.");this._tilingScheme=new a({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:i.ellipsoid});this._heightmapWidth=65;this._levelZeroMaximumGeometricError=g.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0));this._heightmapStructure=undefined;this._hasWaterMask=!1;this._hasVertexNormals=!1;this._requestVertexNormals=e(i.requestVertexNormals,!1);this._requestWaterMask=e(i.requestWaterMask,!1);this._errorEvent=new l;y=i.credit;typeof y=="string"&&(y=new f(y));this._credit=y;this._availability=undefined;d=t.defer();this._ready=!1;this._readyPromise=d;this._tileCredits=undefined;var r=this,s,v,u,et=this._layers=[],p="",w=[];t(i.url).then(function(t){var i=k.createIfNeeded(t),u;if(i.appendForwardSlash(),s=i,v=s.getDerivedResource({url:"layer.json"}),u=new n(v.url),u.authority==="assets.agi.com"){var e="STK World Terrain at assets.agi.com was shut down on October 1, 2018.",o="Check out the new high-resolution Cesium World Terrain for migration instructions.",c="https://cesium.com/blog/2018/03/01/introducing-cesium-world-terrain/";r._tileCredits=[new f("<span><b>"+e+'<\/b><\/span> <a href="'+c+'">'+o+"<\/a>",!0)];h("assets.agi.com",e+" "+o+" "+c)}else r._tileCredits=i.credits;b()}).otherwise(function(n){d.reject(n)})}function ut(n){if(!o(n)||n.length===0)return{Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"};var t=n.join("-");return{Accept:"application/vnd.quantized-mesh;extensions="+t+",application/octet-stream;q=0.9,*/*;q=0.01"}}function et(n,t){var i=new Uint16Array(t,0,n._heightmapWidth*n._heightmapWidth);return new v({buffer:i,childTileMask:new Uint8Array(t,i.byteLength,1)[0],waterMask:new Uint8Array(t,i.byteLength+1,t.byteLength-i.byteLength-1),width:n._heightmapWidth,height:n._heightmapWidth,structure:n._heightmapStructure,credits:n._tileCredits})}function ot(n,t,f,e,o,s,h){var c=0,wt=3,oi=wt+1,tt=Float64Array.BYTES_PER_ELEMENT*wt,si=Float64Array.BYTES_PER_ELEMENT*oi,hi=Uint16Array.BYTES_PER_ELEMENT*3,it=3,v=Uint16Array.BYTES_PER_ELEMENT,bt=v*it,l=new DataView(t),ci=new u(l.getFloat64(c,!0),l.getFloat64(c+8,!0),l.getFloat64(c+16,!0)),ut,ft,kt,dt,a,k,et,d,ot,gt,g,st,ht,ni,ct,ti,lt,ii,at,ri,ui,fi,vt,yt,nt,pt,ei;c+=tt;ut=l.getFloat32(c,!0);c+=Float32Array.BYTES_PER_ELEMENT;ft=l.getFloat32(c,!0);c+=Float32Array.BYTES_PER_ELEMENT;kt=new r(new u(l.getFloat64(c,!0),l.getFloat64(c+8,!0),l.getFloat64(c+16,!0)),l.getFloat64(c+tt,!0));c+=si;dt=new u(l.getFloat64(c,!0),l.getFloat64(c+8,!0),l.getFloat64(c+16,!0));c+=tt;a=l.getUint32(c,!0);c+=Uint32Array.BYTES_PER_ELEMENT;k=new Uint16Array(t,c,a*3);c+=a*hi;a>65536&&(v=Uint32Array.BYTES_PER_ELEMENT,bt=v*it);var li=k.subarray(0,a),ai=k.subarray(a,2*a),vi=k.subarray(a*2,3*a);for(i.zigZagDeltaDecode(li,ai,vi),c%v!=0&&(c+=v-c%v),et=l.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,d=y.createTypedArrayFromArrayBuffer(a,t,c,et*it),c+=et*bt,ot=0,gt=d.length,g=0;g<gt;++g)st=d[g],d[g]=ot-st,st===0&&++ot;for(ht=l.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,ni=y.createTypedArrayFromArrayBuffer(a,t,c,ht),c+=ht*v,ct=l.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,ti=y.createTypedArrayFromArrayBuffer(a,t,c,ct),c+=ct*v,lt=l.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,ii=y.createTypedArrayFromArrayBuffer(a,t,c,lt),c+=lt*v,at=l.getUint32(c,!0),c+=Uint32Array.BYTES_PER_ELEMENT,ri=y.createTypedArrayFromArrayBuffer(a,t,c,at),c+=at*v;c<l.byteLength;)vt=l.getUint8(c,!0),c+=Uint8Array.BYTES_PER_ELEMENT,yt=l.getUint32(c,h),c+=Uint32Array.BYTES_PER_ELEMENT,vt===rt.OCT_VERTEX_NORMALS&&n._requestVertexNormals?ui=new Uint8Array(t,c,a*2):vt===rt.WATER_MASK&&n._requestWaterMask&&(fi=new Uint8Array(t,c,yt)),c+=yt;return nt=n.getLevelMaximumGeometricError(f)*5,pt=n._tilingScheme.tileXYToRectangle(e,o,f),pt.width<p.PI_OVER_TWO+p.EPSILON5&&(ei=w.fromRectangle(pt,ut,ft,n._tilingScheme.ellipsoid)),new b({center:ci,minimumHeight:ut,maximumHeight:ft,boundingSphere:kt,orientedBoundingBox:ei,horizonOcclusionPoint:dt,quantizedVertices:k,encodedNormals:ui,indices:d,westIndices:ni,southIndices:ti,eastIndices:ii,northIndices:ri,westSkirtHeight:nt,southSkirtHeight:nt,eastSkirtHeight:nt,northSkirtHeight:nt,childTileMask:n.availability.computeChildMaskForTile(f,e,o),waterMask:fi,credits:n._tileCredits})}var rt={OCT_VERTEX_NORMALS:1,WATER_MASK:2};return it.prototype.requestTileGeometry=function(n,i,r,u){var s,f,w,h,l,a,b,g,nt,y,k,p;if(!this._ready)throw new c("requestTileGeometry must not be called before the terrain provider is ready.");if(s=this._layers,w=s.length,w===1)f=s[0];else for(h=0;h<w;++h)if(l=s[h],!o(l.availability)||l.availability.isTileAvailable(r,n,i)){f=l;break}if(!o(f))return t.reject(new d("Terrain tile doesn't exist"));if(a=f.tileUrlTemplates,a.length===0)return undefined;var tt=this._tilingScheme.getNumberOfYTilesAtLevel(r),v=tt-i-1,e=[];return(this._requestVertexNormals&&f.hasVertexNormals&&e.push(f.littleEndianExtensionSize?"octvertexnormals":"vertexnormals"),this._requestWaterMask&&f.hasWaterMask&&e.push("watermask"),nt=a[(n+v+r)%a.length],y=f.resource,o(y._ionEndpoint)&&!o(y._ionEndpoint.externalType)?(e.length!==0&&(g={extensions:e.join("-")}),b=ut(undefined)):b=ut(e),k=y.getDerivedResource({url:nt,templateValues:{version:f.version,z:r,x:n,y:v},queryParameters:g,headers:b,request:u}).fetchArrayBuffer(),!o(k))?undefined:(p=this,k.then(function(t){return o(p._heightmapStructure)?et(p,t,r,n,i,v):ot(p,t,r,n,i,v,f.littleEndianExtensionSize)}))},s(it.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new c("credit must not be called before the terrain provider is ready.");return this._credit}},tilingScheme:{get:function(){if(!this._ready)throw new c("tilingScheme must not be called before the terrain provider is ready.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){if(!this._ready)throw new c("hasWaterMask must not be called before the terrain provider is ready.");return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){if(!this._ready)throw new c("hasVertexNormals must not be called before the terrain provider is ready.");return this._hasVertexNormals&&this._requestVertexNormals}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},availability:{get:function(){if(!this._ready)throw new c("availability must not be called before the terrain provider is ready.");return this._availability}}}),it.prototype.getLevelMaximumGeometricError=function(n){return this._levelZeroMaximumGeometricError/(1<<n)},it.prototype.getTileDataAvailable=function(n,t,i){return o(this._availability)?this._availability.isTileAvailable(i,n,t):undefined},it});t("Core/EllipseGeometryLibrary",["./Cartesian3","./Math","./Matrix3","./Quaternion"],function(n,t,i,r){"use strict";function u(t,u,e,o,l,a,v,y,p,w){var d=t+u,b,k,g,nt;return n.multiplyByScalar(o,Math.cos(d),f),n.multiplyByScalar(e,Math.sin(d),s),n.add(f,s,f),b=Math.cos(t),b=b*b,k=Math.sin(t),k=k*k,g=a/Math.sqrt(v*b+l*k),nt=g/y,r.fromAxisAngle(f,nt,h),i.fromQuaternion(h,c),i.multiplyByVector(c,p,w),n.normalize(w,w),n.multiplyByScalar(w,y,w),w}var e={},f=new n,s=new n,h=new r,c=new i,l=new n,a=new n,o=new n,v=new n;e.raisePositionsToHeight=function(t,i,r){for(var y=i.ellipsoid,d=i.height,g=i.extrudedHeight,nt=r?t.length/3*2:t.length/3,f=new Float64Array(nt*3),p=t.length,h=r?p:0,e=0;e<p;e+=3){var w=e+1,b=e+2,u=n.fromArray(t,e,l);y.scaleToGeodeticSurface(u,u);var s=n.clone(u,a),k=y.geodeticSurfaceNormal(u,v),c=n.multiplyByScalar(k,d,o);n.add(u,c,u);r&&(n.multiplyByScalar(k,g,c),n.add(s,c,s),f[e+h]=s.x,f[w+h]=s.y,f[b+h]=s.z);f[e]=u.x;f[w]=u.y;f[b]=u.z}return f};var y=new n,p=new n,w=new n;return e.computeEllipsePositions=function(i,r,f){var pt=i.semiMinorAxis,wt=i.semiMajorAxis,ut=i.rotation,bt=i.center,dt=i.granularity*8,ft=pt*pt,et=wt*wt,ot=wt*pt,st=n.magnitude(bt),rt=n.normalize(bt,y),d=n.cross(n.UNIT_Z,bt,p),vt;d=n.normalize(d,d);var ht=n.cross(rt,d,w),nt=1+Math.ceil(t.PI_OVER_TWO/dt),at=t.PI_OVER_TWO/(nt-1),b=t.PI_OVER_TWO-nt*at;b<0&&(nt-=Math.ceil(Math.abs(b)/at));var gt=2*nt*(nt+2),s=r?new Array(gt*3):undefined,h=0,e=l,v=a,kt=nt*12,k=kt-1,ct=0,c=f?new Array(kt):undefined,g,tt,lt,yt,it;for(b=t.PI_OVER_TWO,e=u(b,ut,ht,d,ft,ot,et,st,rt,e),r&&(s[h++]=e.x,s[h++]=e.y,s[h++]=e.z),f&&(c[k--]=e.z,c[k--]=e.y,c[k--]=e.x),b=t.PI_OVER_TWO-at,g=1;g<nt+1;++g){if(e=u(b,ut,ht,d,ft,ot,et,st,rt,e),v=u(Math.PI-b,ut,ht,d,ft,ot,et,st,rt,v),r){for(s[h++]=e.x,s[h++]=e.y,s[h++]=e.z,lt=2*g+2,tt=1;tt<lt-1;++tt)yt=tt/(lt-1),it=n.lerp(e,v,yt,o),s[h++]=it.x,s[h++]=it.y,s[h++]=it.z;s[h++]=v.x;s[h++]=v.y;s[h++]=v.z}f&&(c[k--]=e.z,c[k--]=e.y,c[k--]=e.x,c[ct++]=v.x,c[ct++]=v.y,c[ct++]=v.z);b=t.PI_OVER_TWO-(g+1)*at}for(g=nt;g>1;--g){if(b=t.PI_OVER_TWO-(g-1)*at,e=u(-b,ut,ht,d,ft,ot,et,st,rt,e),v=u(b+Math.PI,ut,ht,d,ft,ot,et,st,rt,v),r){for(s[h++]=e.x,s[h++]=e.y,s[h++]=e.z,lt=2*(g-1)+2,tt=1;tt<lt-1;++tt)yt=tt/(lt-1),it=n.lerp(e,v,yt,o),s[h++]=it.x,s[h++]=it.y,s[h++]=it.z;s[h++]=v.x;s[h++]=v.y;s[h++]=v.z}f&&(c[k--]=e.z,c[k--]=e.y,c[k--]=e.x,c[ct++]=v.x,c[ct++]=v.y,c[ct++]=v.z)}return b=t.PI_OVER_TWO,e=u(-b,ut,ht,d,ft,ot,et,st,rt,e),vt={},r&&(s[h++]=e.x,s[h++]=e.y,s[h++]=e.z,vt.positions=s,vt.numPts=nt),f&&(c[k--]=e.z,c[k--]=e.y,c[k--]=e.x,vt.outerPositions=c),vt},e});t("Core/GeometryInstance",["./defaultValue","./defined","./DeveloperError","./Matrix4"],function(n,t,i,r){"use strict";function u(u){if(u=n(u,n.EMPTY_OBJECT),!t(u.geometry))throw new i("options.geometry is required.");this.geometry=u.geometry;this.modelMatrix=r.clone(n(u.modelMatrix,r.IDENTITY));this.id=u.id;this.pickPrimitive=u.pickPrimitive;this.attributes=n(u.attributes,{});this.westHemisphereGeometry=undefined;this.eastHemisphereGeometry=undefined}return u});t("Core/EncodedCartesian3",["./Cartesian3","./Check","./defined"],function(n,t,i){"use strict";function r(){this.high=n.clone(n.ZERO);this.low=n.clone(n.ZERO)}var u,f;return r.encode=function(n,r){t.typeOf.number("value",n);i(r)||(r={high:0,low:0});var u;return n>=0?(u=Math.floor(n/65536)*65536,r.high=u,r.low=n-u):(u=Math.floor(-n/65536)*65536,r.high=-u,r.low=n+u),r},u={high:0,low:0},r.fromCartesian=function(n,f){t.typeOf.object("cartesian",n);i(f)||(f=new r);var e=f.high,o=f.low;return r.encode(n.x,u),e.x=u.high,o.x=u.low,r.encode(n.y,u),e.y=u.high,o.y=u.low,r.encode(n.z,u),e.z=u.high,o.z=u.low,f},f=new r,r.writeElements=function(n,i,u){t.defined("cartesianArray",i);t.typeOf.number("index",u);t.typeOf.number.greaterThanOrEquals("index",u,0);r.fromCartesian(n,f);var e=f.high,o=f.low;i[u]=e.x;i[u+1]=e.y;i[u+2]=e.z;i[u+3]=o.x;i[u+4]=o.y;i[u+5]=o.z},r});t("Core/Tipsify",["./defaultValue","./defined","./DeveloperError"],function(n,t,i){"use strict";var r={};return r.calculateACMR=function(r){var e,o,l,a,v,s,h;r=n(r,n.EMPTY_OBJECT);var u=r.indices,f=r.maximumIndex,c=n(r.cacheSize,24);if(!t(u))throw new i("indices is required.");if(e=u.length,e<3||e%3!=0)throw new i("indices length must be a multiple of three.");if(f<=0)throw new i("maximumIndex must be greater than zero.");if(c<3)throw new i("cacheSize must be greater than two.");if(!t(f))for(f=0,o=0,l=u[o];o<e;)l>f&&(f=l),++o,l=u[o];for(a=[],v=0;v<f+1;v++)a[v]=0;for(s=c+1,h=0;h<e;++h)s-a[u[h]]>c&&(a[u[h]]=s,++s);return(s-c+1)/(e/3)},r.tipsify=function(r){function st(n,t,i,r){while(t.length>=1){var u=t[t.length-1];if(t.splice(t.length-1,1),n[u].numLiveTriangles>0)return u}while(c<r){if(n[c].numLiveTriangles>0)return++c,c-1;++c}return-1}function ht(n,t,i,r,u,f,e){for(var h=-1,s,c=-1,l=0,o;l<i.length;)o=i[l],r[o].numLiveTriangles&&(s=0,u-r[o].timeStamp+2*r[o].numLiveTriangles<=t&&(s=u-r[o].timeStamp),(s>c||c===-1)&&(c=s,h=o)),++l;return h===-1?st(r,f,n,e):h}var l,e,s,o,p,a,v,ot,b,it;r=n(r,n.EMPTY_OBJECT);var f=r.indices,k=r.maximumIndex,y=n(r.cacheSize,24),c;if(!t(f))throw new i("indices is required.");if(l=f.length,l<3||l%3!=0)throw new i("indices length must be a multiple of three.");if(k<=0)throw new i("maximumIndex must be greater than zero.");if(y<3)throw new i("cacheSize must be greater than two.");var h=0,u=0,d=f[u],rt=l;if(t(k))h=k+1;else{while(u<rt)d>h&&(h=d),++u,d=f[u];if(h===-1)return 0;++h}for(e=[],s=0;s<h;s++)e[s]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(u=0,o=0;u<rt;)e[f[u]].vertexTriangles.push(o),++e[f[u]].numLiveTriangles,e[f[u+1]].vertexTriangles.push(o),++e[f[u+1]].numLiveTriangles,e[f[u+2]].vertexTriangles.push(o),++e[f[u+2]].numLiveTriangles,++o,u+=3;p=0;a=y+1;c=1;var g=[],ut=[],w,nt,ft=0,et=[],ct=l/3,tt=[];for(s=0;s<ct;s++)tt[s]=!1;while(p!==-1){for(g=[],nt=e[p],ot=nt.vertexTriangles.length,b=0;b<ot;++b)if(o=nt.vertexTriangles[b],!tt[o])for(tt[o]=!0,u=o+o+o,it=0;it<3;++it)v=f[u],g.push(v),ut.push(v),et[ft]=v,++ft,w=e[v],--w.numLiveTriangles,a-w.timeStamp>y&&(w.timeStamp=a,++a),++u;p=ht(f,y,g,e,a,ut,h)}return et},r});t("Core/GeometryPipeline",["./AttributeCompression","./barycentricCoordinates","./BoundingSphere","./Cartesian2","./Cartesian3","./Cartesian4","./Cartographic","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./EncodedCartesian3","./GeographicProjection","./Geometry","./GeometryAttribute","./GeometryType","./IndexDatatype","./Intersect","./IntersectionTests","./Math","./Matrix3","./Matrix4","./Plane","./PrimitiveType","./Tipsify"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){"use strict";function ui(n,t,i,r,u){n[t++]=i;n[t++]=r;n[t++]=r;n[t++]=u;n[t++]=u;n[t]=i}function br(n){for(var i=n.length,f=i*2,r=w.createTypedArray(i,f),u=0,t=0;t<i;t+=3,u+=6)ui(r,u,n[t],n[t+1],n[t+2]);return r}function kr(n){var i=n.length,f,r,u,t;if(i>=3){for(f=(i-2)*6,r=w.createTypedArray(i,f),ui(r,0,n[0],n[1],n[2]),u=6,t=3;t<i;++t,u+=6)ui(r,u,n[t-1],n[t],n[t-2]);return r}return new Uint16Array}function dr(n){var t;if(n.length>0){var i=n.length-1,f=(i-1)*6,r=w.createTypedArray(i,f),e=n[0],u=0;for(t=1;t<i;++t,u+=6)ui(r,u,e,n[t],n[t+1]);return r}return new Uint16Array}function gi(n){var r={},t,i;for(t in n)n.hasOwnProperty(t)&&h(n[t])&&h(n[t].values)&&(i=n[t],r[t]=new y({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]}));return r}function gr(n,t,i){var r,u,f;for(r in t)if(t.hasOwnProperty(r)&&h(t[r])&&h(t[r].values))for(u=t[r],f=0;f<u.componentsPerAttribute;++f)n[r].values.push(u.values[i*u.componentsPerAttribute+f])}function ci(n,t){var r,f,i;if(h(t))for(r=t.values,f=r.length,i=0;i<f;i+=3)u.unpack(r,i,ft),nt.multiplyByPoint(n,ft,ft),u.pack(ft,r,i)}function li(n,t){var r,f,i;if(h(t))for(r=t.values,f=r.length,i=0;i<f;i+=3)u.unpack(r,i,ft),g.multiplyByVector(n,ft,ft),ft=u.normalize(ft,ft),u.pack(ft,r,i)}function nu(n,t){var a=n.length,s={},f=n[0][t].attributes,r,e,u;for(r in f)if(f.hasOwnProperty(r)&&h(f[r])&&h(f[r].values)){var i=f[r],c=i.values.length,l=!0;for(e=1;e<a;++e){if(u=n[e][t].attributes[r],!h(u)||i.componentDatatype!==u.componentDatatype||i.componentsPerAttribute!==u.componentsPerAttribute||i.normalize!==u.normalize){l=!1;break}c+=u.values.length}l&&(s[r]=new y({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:o.createTypedArray(i.componentDatatype,c)}))}return s}function ai(n,t){for(var e=n.length,a,y,o,ct=n[0].modelMatrix,tt=h(n[0][t].indices),rt=n[0][t].primitiveType,s,ut,b,ft,et,k,d,ht,f,p,l,g,r=1;r<e;++r){if(!nt.equals(n[r].modelMatrix,ct))throw new c("All instances must have the same modelMatrix.");if(h(n[r][t].indices)!==tt)throw new c("All instance geometries must have an indices or not have one.");if(n[r][t].primitiveType!==rt)throw new c("All instance geometries must have the same primitiveType.");}s=nu(n,t);for(a in s)if(s.hasOwnProperty(a))for(ut=s[a].values,o=0,r=0;r<e;++r)for(b=n[r][t].attributes[a].values,ft=b.length,y=0;y<ft;++y)ut[o++]=b[y];if(tt){for(k=0,r=0;r<e;++r)k+=n[r][t].indices.length;var lt=v.computeNumberOfVertices(new v({attributes:s,primitiveType:it.POINTS})),ot=w.createTypedArray(lt,k),at=0,st=0;for(r=0;r<e;++r){for(d=n[r][t].indices,ht=d.length,o=0;o<ht;++o)ot[at++]=st+d[o];st+=v.computeNumberOfVertices(n[r][t])}et=ot}for(f=new u,p=0,r=0;r<e;++r){if(l=n[r][t].boundingSphere,!h(l)){f=undefined;break}u.add(l.center,f,f)}if(h(f))for(u.divideByScalar(f,e,f),r=0;r<e;++r)l=n[r][t].boundingSphere,g=u.magnitude(u.subtract(l.center,f,tr))+l.radius,g>p&&(p=g);return new v({attributes:s,indices:et,primitiveType:rt,boundingSphere:h(f)?new i(f,p):undefined})}function ru(n){var t,r,i;if(h(n.indices))return n;if(t=v.computeNumberOfVertices(n),t<3)throw new c("The number of vertices must be at least three.");if(t%3!=0)throw new c("The number of vertices must be a multiple of three.");for(r=w.createTypedArray(t,t),i=0;i<t;++i)r[i]=i;return n.indices=r,n}function uu(n){var r=v.computeNumberOfVertices(n),t,u,i;if(r<3)throw new c("The number of vertices must be at least three.");for(t=w.createTypedArray(r,(r-2)*3),t[0]=1,t[1]=0,t[2]=2,u=3,i=3;i<r;++i)t[u++]=i-1,t[u++]=0,t[u++]=i;return n.indices=t,n.primitiveType=it.TRIANGLES,n}function fu(n){var u=v.computeNumberOfVertices(n),t,r,i;if(u<3)throw new c("The number of vertices must be at least 3.");for(t=w.createTypedArray(u,(u-2)*3),t[0]=0,t[1]=1,t[2]=2,u>3&&(t[3]=0,t[4]=2,t[5]=3),r=6,i=3;i<u-1;i+=2)t[r++]=i,t[r++]=i-1,t[r++]=i+1,i+2<u&&(t[r++]=i,t[r++]=i+1,t[r++]=i+2);return n.indices=t,n.primitiveType=it.TRIANGLES,n}function eu(n){var t,r,i;if(h(n.indices))return n;if(t=v.computeNumberOfVertices(n),t<2)throw new c("The number of vertices must be at least two.");if(t%2!=0)throw new c("The number of vertices must be a multiple of 2.");for(r=w.createTypedArray(t,t),i=0;i<t;++i)r[i]=i;return n.indices=r,n}function ou(n){var r=v.computeNumberOfVertices(n),t,u,i;if(r<2)throw new c("The number of vertices must be at least two.");for(t=w.createTypedArray(r,(r-1)*2),t[0]=0,t[1]=1,u=2,i=2;i<r;++i)t[u++]=i-1,t[u++]=i;return n.indices=t,n.primitiveType=it.LINES,n}function su(n){var i=v.computeNumberOfVertices(n),t,r,u;if(i<2)throw new c("The number of vertices must be at least two.");for(t=w.createTypedArray(i,i*2),t[0]=0,t[1]=1,r=2,u=2;u<i;++u)t[r++]=u-1,t[r++]=u;return t[r++]=i-1,t[r]=0,n.indices=t,n.primitiveType=it.LINES,n}function hu(n){switch(n.primitiveType){case it.TRIANGLE_FAN:return uu(n);case it.TRIANGLE_STRIP:return fu(n);case it.TRIANGLES:return ru(n);case it.LINE_STRIP:return ou(n);case it.LINE_LOOP:return su(n);case it.LINES:return eu(n)}return n}function ct(n,t){Math.abs(n.y)<d.EPSILON6&&(n.y=t?-d.EPSILON6:d.EPSILON6)}function cu(n,t,i){var r;if(n.y!==0&&t.y!==0&&i.y!==0){ct(n,n.y<0);ct(t,t.y<0);ct(i,i.y<0);return}var u=Math.abs(n.y),f=Math.abs(t.y),e=Math.abs(i.y),o;o=u>f?u>e?d.sign(n.y):d.sign(i.y):f>e?d.sign(t.y):d.sign(i.y);r=o<0;ct(n,r);ct(t,r);ct(i,r)}function ot(n,t,i,r){u.add(n,u.multiplyByScalar(u.subtract(t,n,vi),n.y/(n.y-t.y),vi),i);u.clone(i,r);ct(i,!0);ct(r,!1)}function lu(n,t,i){var r,u;if(n.x>=0||t.x>=0||i.x>=0)return undefined;cu(n,t,i);var e=n.y<0,o=t.y<0,s=i.y<0,f=0;return f+=e?1:0,f+=o?1:0,f+=s?1:0,r=yi.indices,f===1?(r[1]=3,r[2]=4,r[5]=6,r[7]=6,r[8]=5,e?(ot(n,t,lt,vt),ot(n,i,at,yt),r[0]=0,r[3]=1,r[4]=2,r[6]=1):o?(ot(t,i,lt,vt),ot(t,n,at,yt),r[0]=1,r[3]=2,r[4]=0,r[6]=2):s&&(ot(i,n,lt,vt),ot(i,t,at,yt),r[0]=2,r[3]=0,r[4]=1,r[6]=0)):f===2&&(r[2]=4,r[4]=4,r[5]=3,r[7]=5,r[8]=6,e?o?s||(ot(i,n,lt,vt),ot(i,t,at,yt),r[0]=0,r[1]=1,r[3]=0,r[6]=2):(ot(t,i,lt,vt),ot(t,n,at,yt),r[0]=2,r[1]=0,r[3]=2,r[6]=1):(ot(n,t,lt,vt),ot(n,i,at,yt),r[0]=1,r[1]=2,r[3]=1,r[6]=0)),u=yi.positions,u[0]=n,u[1]=t,u[2]=i,u.length=3,(f===1||f===2)&&(u[3]=lt,u[4]=at,u[5]=vt,u[6]=yt,u.length=7),yi}function fr(n,t){var r=n.attributes,u,f,e;if(r.position.values.length===0)return undefined;for(u in r)r.hasOwnProperty(u)&&h(r[u])&&h(r[u].values)&&(f=r[u],f.values=o.createTypedArray(f.componentDatatype,f.values));return e=v.computeNumberOfVertices(n),n.indices=w.createTypedArray(e,n.indices),t&&(n.boundingSphere=i.fromVertices(r.position.values)),n}function bt(n){var i=n.attributes,u={},t,r;for(t in i)i.hasOwnProperty(t)&&h(i[t])&&h(i[t].values)&&(r=i[t],u[t]=new y({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}));return new v({attributes:u,indices:[],primitiveType:n.primitiveType})}function pi(n,t,i){var r=h(n.geometry.boundingSphere);t=fr(t,r);i=fr(i,r);h(i)&&!h(t)?n.geometry=i:!h(i)&&h(t)?n.geometry=t:(n.westHemisphereGeometry=t,n.eastHemisphereGeometry=i,n.geometry=undefined)}function wi(n,t){var i=new n,r=new n,u=new n;return function(f,e,o,s,h,c,l,a){var y=n.fromArray(h,f*t,i),p=n.fromArray(h,e*t,r),w=n.fromArray(h,o*t,u),v;n.multiplyByScalar(y,s.x,y);n.multiplyByScalar(p,s.y,p);n.multiplyByScalar(w,s.z,w);v=n.add(y,p,y);n.add(v,w,v);a&&n.normalize(v,v);n.pack(v,c,l*t)}}function si(n,i,r,f,e,o,s,c,l,a,v,y,p,w,b,k){var d,rt,ut;if(h(o)||h(s)||h(c)||h(l)||h(a)||w!==0){var ft=u.fromArray(e,n*3,ii),et=u.fromArray(e,i*3,bi),ot=u.fromArray(e,r*3,ki),g=t(f,ft,et,ot,yu);if(h(o)&&oi(n,i,r,g,o,y.normal.values,k,!0),h(a)){var nt=u.fromArray(a,n*3,ii),tt=u.fromArray(a,i*3,bi),it=u.fromArray(a,r*3,ki);u.multiplyByScalar(nt,g.x,nt);u.multiplyByScalar(tt,g.y,tt);u.multiplyByScalar(it,g.z,it);u.equals(nt,u.ZERO)&&u.equals(tt,u.ZERO)&&u.equals(it,u.ZERO)?(d=ii,d.x=0,d.y=0,d.z=0):(d=u.add(nt,tt,nt),u.add(d,it,d),u.normalize(d,d));u.pack(d,y.extrudeDirection.values,k*3)}if(h(v)&&vu(n,i,r,g,v,y.applyOffset.values,k),h(s)&&oi(n,i,r,g,s,y.tangent.values,k,!0),h(c)&&oi(n,i,r,g,c,y.bitangent.values,k,!0),h(l)&&er(n,i,r,g,l,y.st.values,k),w>0)for(rt=0;rt<w;rt++)ut=p[rt],pu(n,i,r,g,k,b[ut],y[ut])}}function pu(n,t,i,r,u,f,e){var h=f.componentsPerAttribute,o=f.values,s=e.values;switch(h){case 4:au(n,t,i,r,o,s,u,!1);break;case 3:oi(n,t,i,r,o,s,u,!1);break;case 2:er(n,t,i,r,o,s,u,!1);break;default:s[u]=o[n]*r.x+o[t]*r.y+o[i]*r.z}}function ht(n,t,i,r,u,f){var e=n.position.values.length/3,s,o;return u!==-1?(s=r[u],o=i[s],o===-1)?(i[s]=e,n.position.values.push(f.x,f.y,f.z),t.push(e),e):(t.push(o),o):(n.position.values.push(f.x,f.y,f.z),t.push(e),e)}function sr(n){var tt=n.geometry,t=tt.attributes,f=t.position.values,it=h(t.normal)?t.normal.values:undefined,rt=h(t.bitangent)?t.bitangent.values:undefined,ut=h(t.tangent)?t.tangent.values:undefined,ft=h(t.st)?t.st.values:undefined,et=h(t.extrudeDirection)?t.extrudeDirection.values:undefined,ot=h(t.applyOffset)?t.applyOffset.values:undefined,e=tt.indices,a=[],v,b,pt,at,vt,yt;for(v in t)t.hasOwnProperty(v)&&!or[v]&&h(t[v])&&a.push(v);var st=a.length,y=bt(tt),p=bt(tt),r,o,s,c,i,w=[];for(w.length=f.length/3,b=[],b.length=f.length/3,i=0;i<w.length;++i)w[i]=-1,b[i]=-1;for(pt=e.length,i=0;i<pt;i+=3){var k=e[i],d=e[i+1],g=e[i+2],nt=u.fromArray(f,k*3),ct=u.fromArray(f,d*3),lt=u.fromArray(f,g*3),l=lu(nt,ct,lt);if(h(l)&&l.positions.length>3){var kt=l.positions,wt=l.indices,dt=wt.length;for(at=0;at<dt;++at)vt=wt[at],yt=kt[vt],yt.y<0?(r=p.attributes,o=p.indices,s=w):(r=y.attributes,o=y.indices,s=b),c=ht(r,o,s,e,vt<3?i+vt:-1,yt),si(k,d,g,yt,f,it,ut,rt,ft,et,ot,r,a,st,t,c)}else h(l)&&(nt=l.positions[0],ct=l.positions[1],lt=l.positions[2]),nt.y<0?(r=p.attributes,o=p.indices,s=w):(r=y.attributes,o=y.indices,s=b),c=ht(r,o,s,e,i,nt),si(k,d,g,nt,f,it,ut,rt,ft,et,ot,r,a,st,t,c),c=ht(r,o,s,e,i+1,ct),si(k,d,g,ct,f,it,ut,rt,ft,et,ot,r,a,st,t,c),c=ht(r,o,s,e,i+2,lt),si(k,d,g,lt,f,it,ut,rt,ft,et,ot,r,a,st,t,c)}pi(n,p,y)}function kt(n,t,i,r,f,e,o){if(h(o)){var s=u.fromArray(r,n*3,ii);e.applyOffset.values[f]=u.equalsEpsilon(s,i,d.EPSILON10)?o[n]:o[t]}}function cr(n){var it=n.geometry,ft=it.attributes,r=ft.position.values,y=h(ft.applyOffset)?ft.applyOffset.values:undefined,e=it.indices,s=bt(it),c=bt(it),t,at=e.length,p=[],w,v,b,g,rt,ut;for(p.length=r.length/3,w=[],w.length=r.length/3,t=0;t<p.length;++t)p[t]=-1,w[t]=-1;for(t=0;t<at;t+=2){var l=e[t],a=e[t+1],f=u.fromArray(r,l*3,ii),o=u.fromArray(r,a*3,bi),i;Math.abs(f.y)<d.EPSILON6&&(f.y=f.y<0?-d.EPSILON6:d.EPSILON6);Math.abs(o.y)<d.EPSILON6&&(o.y=o.y<0?-d.EPSILON6:d.EPSILON6);var nt=s.attributes,et=s.indices,ot=w,tt=c.attributes,st=c.indices,ct=p,lt=k.lineSegmentPlane(f,o,hr,ki);h(lt)?(v=u.multiplyByScalar(u.UNIT_Y,5*d.EPSILON9,wu),f.y<0&&(u.negate(v,v),nt=c.attributes,et=c.indices,ot=p,tt=s.attributes,st=s.indices,ct=w),b=u.add(lt,v,bu),i=ht(nt,et,ot,e,t,f),kt(l,a,f,r,i,nt,y),i=ht(nt,et,ot,e,-1,b),kt(l,a,b,r,i,nt,y),u.negate(v,v),u.add(lt,v,b),i=ht(tt,st,ct,e,-1,b),kt(l,a,b,r,i,tt,y),i=ht(tt,st,ct,e,t+1,o),kt(l,a,o,r,i,tt,y)):(f.y<0?(g=c.attributes,rt=c.indices,ut=p):(g=s.attributes,rt=s.indices,ut=w),i=ht(g,rt,ut,e,t,f),kt(l,a,f,r,i,g,y),i=ht(g,rt,ut,e,t+1,o),kt(l,a,o,r,i,g,y))}pi(n,c,s)}function pr(n){for(var r,s,h,o=n.attributes,i=o.position.values,f=o.prevPosition.values,e=o.nextPosition.values,c=i.length,t=0;t<c;t+=3)(r=u.unpack(i,t,ar),r.x>0)||(s=u.unpack(f,t,vr),(r.y<0&&s.y>0||r.y>0&&s.y<0)&&(t-3>0?(f[t]=i[t-3],f[t+1]=i[t-2],f[t+2]=i[t-1]):u.pack(r,f,t)),h=u.unpack(e,t,di),(r.y<0&&h.y>0||r.y>0&&h.y<0)&&(t+3<c?(e[t]=i[t+3],e[t+1]=i[t+4],e[t+2]=i[t+5]):u.pack(r,e,t)))}function tf(n){for(var kt=n.geometry,tt=kt.attributes,y=tt.position.values,b=tt.prevPosition.values,g=tt.nextPosition.values,ii=tt.expandAndWidth.values,ut=h(tt.st)?tt.st.values:undefined,ft=h(tt.color)?tt.color.values:undefined,it=bt(kt),rt=bt(kt),t,c,ui=!1,ei=y.length/3,et,i,fi,nt,ot,w,wt,s=0;s<ei;s+=4){var v=s,p=s+2,e=u.fromArray(y,v*3,ar),o=u.fromArray(y,p*3,vr);if(Math.abs(e.y)<ri)for(e.y=ri*(o.y<0?-1:1),y[s*3+1]=e.y,y[(s+1)*3+1]=e.y,t=v*3;t<v*3+12;t+=3)b[t]=y[s*3],b[t+1]=y[s*3+1],b[t+2]=y[s*3+2];if(Math.abs(o.y)<ri)for(o.y=ri*(e.y<0?-1:1),y[(s+2)*3+1]=o.y,y[(s+3)*3+1]=o.y,t=v*3;t<v*3+12;t+=3)g[t]=y[(s+2)*3],g[t+1]=y[(s+2)*3+1],g[t+2]=y[(s+2)*3+2];var l=it.attributes,dt=it.indices,a=rt.attributes,gt=rt.indices,st=k.lineSegmentPlane(e,o,hr,du);if(h(st)){if(ui=!0,et=u.multiplyByScalar(u.UNIT_Y,wr,gu),e.y<0&&(u.negate(et,et),l=rt.attributes,dt=rt.indices,a=it.attributes,gt=it.indices),i=u.add(st,et,nf),l.position.values.push(e.x,e.y,e.z,e.x,e.y,e.z),l.position.values.push(i.x,i.y,i.z),l.position.values.push(i.x,i.y,i.z),l.prevPosition.values.push(b[v*3],b[v*3+1],b[v*3+2]),l.prevPosition.values.push(b[v*3+3],b[v*3+4],b[v*3+5]),l.prevPosition.values.push(e.x,e.y,e.z,e.x,e.y,e.z),l.nextPosition.values.push(i.x,i.y,i.z),l.nextPosition.values.push(i.x,i.y,i.z),l.nextPosition.values.push(i.x,i.y,i.z),l.nextPosition.values.push(i.x,i.y,i.z),u.negate(et,et),u.add(st,et,i),a.position.values.push(i.x,i.y,i.z),a.position.values.push(i.x,i.y,i.z),a.position.values.push(o.x,o.y,o.z,o.x,o.y,o.z),a.prevPosition.values.push(i.x,i.y,i.z),a.prevPosition.values.push(i.x,i.y,i.z),a.prevPosition.values.push(i.x,i.y,i.z),a.prevPosition.values.push(i.x,i.y,i.z),a.nextPosition.values.push(o.x,o.y,o.z,o.x,o.y,o.z),a.nextPosition.values.push(g[p*3],g[p*3+1],g[p*3+2]),a.nextPosition.values.push(g[p*3+3],g[p*3+4],g[p*3+5]),fi=r.fromArray(ii,v*2,lr),nt=Math.abs(fi.y),l.expandAndWidth.values.push(-1,nt,1,nt),l.expandAndWidth.values.push(-1,-nt,1,-nt),a.expandAndWidth.values.push(-1,nt,1,nt),a.expandAndWidth.values.push(-1,-nt,1,-nt),ot=u.magnitudeSquared(u.subtract(st,e,di)),ot/=u.magnitudeSquared(u.subtract(o,e,di)),h(ft)){var ht=f.fromArray(ft,v*4,yr),ct=f.fromArray(ft,p*4,yr),lt=d.lerp(ht.x,ct.x,ot),at=d.lerp(ht.y,ct.y,ot),vt=d.lerp(ht.z,ct.z,ot),yt=d.lerp(ht.w,ct.w,ot);for(t=v*4;t<v*4+8;++t)l.color.values.push(ft[t]);for(l.color.values.push(lt,at,vt,yt),l.color.values.push(lt,at,vt,yt),a.color.values.push(lt,at,vt,yt),a.color.values.push(lt,at,vt,yt),t=p*4;t<p*4+8;++t)a.color.values.push(ft[t])}if(h(ut)){var ni=r.fromArray(ut,v*2,lr),ti=r.fromArray(ut,(s+3)*2,ku),pt=d.lerp(ni.x,ti.x,ot);for(t=v*2;t<v*2+4;++t)l.st.values.push(ut[t]);for(l.st.values.push(pt,ni.y),l.st.values.push(pt,ti.y),a.st.values.push(pt,ni.y),a.st.values.push(pt,ti.y),t=p*2;t<p*2+4;++t)a.st.values.push(ut[t])}c=l.position.values.length/3-4;dt.push(c,c+2,c+1);dt.push(c+1,c+2,c+3);c=a.position.values.length/3-4;gt.push(c,c+2,c+1);gt.push(c+1,c+2,c+3)}else{for(e.y<0?(w=rt.attributes,wt=rt.indices):(w=it.attributes,wt=it.indices),w.position.values.push(e.x,e.y,e.z),w.position.values.push(e.x,e.y,e.z),w.position.values.push(o.x,o.y,o.z),w.position.values.push(o.x,o.y,o.z),t=s*3;t<s*3+12;++t)w.prevPosition.values.push(b[t]),w.nextPosition.values.push(g[t]);for(t=s*2;t<s*2+8;++t)w.expandAndWidth.values.push(ii[t]),h(ut)&&w.st.values.push(ut[t]);if(h(ft))for(t=s*4;t<s*4+16;++t)w.color.values.push(ft[t]);c=w.position.values.length/3-4;wt.push(c,c+2,c+1);wt.push(c+1,c+2,c+3)}}ui&&(pr(rt),pr(it));pi(n,rt,it)}var ut={},hi,nr,fi,ft,dt,gt,tr,vi,or,wr,ri;ut.toWireframe=function(n){if(!h(n))throw new c("geometry is required.");var t=n.indices;if(h(t)){switch(n.primitiveType){case it.TRIANGLES:n.indices=br(t);break;case it.TRIANGLE_STRIP:n.indices=kr(t);break;case it.TRIANGLE_FAN:n.indices=dr(t);break;default:throw new c("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.");}n.primitiveType=it.LINES}return n};ut.createLineSegmentsForVectors=function(n,t,r){var u,b,a;if(t=s(t,"normal"),!h(n))throw new c("geometry is required.");if(!h(n.attributes.position))throw new c("geometry.attributes.position is required.");if(!h(n.attributes[t]))throw new c("geometry.attributes must have an attribute with the same name as the attributeName parameter, "+t+".");r=s(r,1e4);var f=n.attributes.position.values,p=n.attributes[t].values,w=f.length,e=new Float64Array(2*w),l=0;for(u=0;u<w;u+=3)e[l++]=f[u],e[l++]=f[u+1],e[l++]=f[u+2],e[l++]=f[u]+p[u]*r,e[l++]=f[u+1]+p[u+1]*r,e[l++]=f[u+2]+p[u+2]*r;return a=n.boundingSphere,h(a)&&(b=new i(a.center,a.radius+r)),new v({attributes:{position:new y({componentDatatype:o.DOUBLE,componentsPerAttribute:3,values:e})},primitiveType:it.LINES,boundingSphere:b})};ut.createAttributeLocations=function(n){var f,r;if(!h(n))throw new c("geometry is required.");for(var e=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],u=n.attributes,t={},o=0,s=e.length,i=0;i<s;++i)f=e[i],h(u[f])&&(t[f]=o++);for(r in u)u.hasOwnProperty(r)&&!h(t[r])&&(t[r]=o++);return t};ut.reorderForPreVertexCache=function(n){var i,k,r,s,t,f,tt,e;if(!h(n))throw new c("geometry is required.");if(i=v.computeNumberOfVertices(n),k=n.indices,h(k)){for(r=new Int32Array(i),s=0;s<i;s++)r[s]=-1;for(var d=k,it=d.length,g=w.createTypedArray(i,it),l=0,nt=0,a=0,u;l<it;)u=r[d[l]],u!==-1?g[nt]=u:(u=d[l],r[u]=a,g[nt]=a,++a),++l,++nt;n.indices=g;t=n.attributes;for(f in t)if(t.hasOwnProperty(f)&&h(t[f])&&h(t[f].values)){for(var y=t[f],ut=y.values,p=0,b=y.componentsPerAttribute,rt=o.createTypedArray(y.componentDatatype,a*b);p<i;){if(tt=r[p],tt!==-1)for(e=0;e<b;e++)rt[b*tt+e]=ut[b*p+e];++p}y.values=rt}}return n};ut.reorderForPostVertexCache=function(n,t){var i,f,u,r;if(!h(n))throw new c("geometry is required.");if(i=n.indices,n.primitiveType===it.TRIANGLES&&h(i)){for(f=i.length,u=0,r=0;r<f;r++)i[r]>u&&(u=i[r]);n.indices=rt.tipsify({indices:i,maximumIndex:u,cacheSize:t})}return n};ut.fitToUnsignedShortIndices=function(n){var i,y,e,o,s,u;if(!h(n))throw new c("geometry is required.");if(h(n.indices)&&n.primitiveType!==it.TRIANGLES&&n.primitiveType!==it.LINES&&n.primitiveType!==it.POINTS)throw new c("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");if(i=[],y=v.computeNumberOfVertices(n),h(n.indices)&&y>=d.SIXTY_FOUR_KILOBYTES){var l=[],r=[],a=0,f=gi(n.attributes),p=n.indices,w=p.length,t;for(n.primitiveType===it.TRIANGLES?t=3:n.primitiveType===it.LINES?t=2:n.primitiveType===it.POINTS&&(t=1),e=0;e<w;e+=t){for(o=0;o<t;++o)s=p[e+o],u=l[s],h(u)||(u=a++,l[s]=u,gr(f,n.attributes,s)),r.push(u);a+t>=d.SIXTY_FOUR_KILOBYTES&&(i.push(new v({attributes:f,indices:r,primitiveType:n.primitiveType,boundingSphere:n.boundingSphere,boundingSphereCV:n.boundingSphereCV})),l=[],r=[],a=0,f=gi(n.attributes))}r.length!==0&&i.push(new v({attributes:f,indices:r,primitiveType:n.primitiveType,boundingSphere:n.boundingSphere,boundingSphereCV:n.boundingSphereCV}))}else i.push(n);return i};hi=new u;nr=new e;ut.projectTo2D=function(n,t,i,r,f){var p,l,e,k,v;if(!h(n))throw new c("geometry is required.");if(!h(t))throw new c("attributeName is required.");if(!h(i))throw new c("attributeName3D is required.");if(!h(r))throw new c("attributeName2D is required.");if(!h(n.attributes[t]))throw new c("geometry must have attribute matching the attributeName argument: "+t+".");if(n.attributes[t].componentDatatype!==o.DOUBLE)throw new c("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");p=n.attributes[t];f=h(f)?f:new a;var d=f.ellipsoid,w=p.values,s=new Float64Array(w.length),b=0;for(l=0;l<w.length;l+=3){if(e=u.fromArray(w,l,hi),k=d.cartesianToCartographic(e,nr),!h(k))throw new c("Could not project point ("+e.x+", "+e.y+", "+e.z+") to 2D.");v=f.project(k,hi);s[b++]=v.x;s[b++]=v.y;s[b++]=v.z}return n.attributes[i]=p,n.attributes[r]=new y({componentDatatype:o.DOUBLE,componentsPerAttribute:3,values:s}),delete n.attributes[t],n};fi={high:0,low:0};ut.encodeAttribute=function(n,t,i,r){var u,e;if(!h(n))throw new c("geometry is required.");if(!h(t))throw new c("attributeName is required.");if(!h(i))throw new c("attributeHighName is required.");if(!h(r))throw new c("attributeLowName is required.");if(!h(n.attributes[t]))throw new c("geometry must have attribute matching the attributeName argument: "+t+".");if(n.attributes[t].componentDatatype!==o.DOUBLE)throw new c("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");var s=n.attributes[t],a=s.values,f=a.length,v=new Float32Array(f),p=new Float32Array(f);for(u=0;u<f;++u)l.encode(a[u],fi),v[u]=fi.high,p[u]=fi.low;return e=s.componentsPerAttribute,n.attributes[i]=new y({componentDatatype:o.FLOAT,componentsPerAttribute:e,values:v}),n.attributes[r]=new y({componentDatatype:o.FLOAT,componentsPerAttribute:e,values:p}),delete n.attributes[t],n};ft=new u;dt=new nt;gt=new g;ut.transformToWorldCoordinates=function(n){var r,t,u;if(!h(n))throw new c("instance is required.");return(r=n.modelMatrix,nt.equals(r,nt.IDENTITY))?n:(t=n.geometry.attributes,ci(r,t.position),ci(r,t.prevPosition),ci(r,t.nextPosition),(h(t.normal)||h(t.tangent)||h(t.bitangent))&&(nt.inverse(r,dt),nt.transpose(dt,dt),nt.getRotation(dt,gt),li(gt,t.normal),li(gt,t.tangent),li(gt,t.bitangent)),u=n.geometry.boundingSphere,h(u)&&(n.geometry.boundingSphere=i.transform(u,r,u)),n.modelMatrix=nt.clone(nt.IDENTITY),n)};tr=new u;ut.combineInstances=function(n){var u,t,i;if(!h(n)||n.length<1)throw new c("instances is required and must have length greater than zero.");var f=[],r=[],e=n.length;for(u=0;u<e;++u)t=n[u],h(t.geometry)?f.push(t):h(t.westHemisphereGeometry)&&h(t.eastHemisphereGeometry)&&r.push(t);return i=[],f.length>0&&i.push(ai(f,"geometry")),r.length>0&&(i.push(ai(r,"westHemisphereGeometry")),i.push(ai(r,"eastHemisphereGeometry"))),i};var et=new u,ni=new u,pt=new u,wt=new u;ut.computeNormal=function(n){var r,rt,i,l,p,b;if(!h(n))throw new c("geometry is required.");if(!h(n.attributes.position)||!h(n.attributes.position.values))throw new c("geometry.attributes.position.values is required.");if(!h(n.indices))throw new c("geometry.indices is required.");if(n.indices.length<2||n.indices.length%3!=0)throw new c("geometry.indices length must be greater than 0 and be a multiple of 3.");if(n.primitiveType!==it.TRIANGLES)throw new c("geometry.primitiveType must be PrimitiveType.TRIANGLES.");for(var s=n.indices,ut=n.attributes,e=ut.position.values,a=ut.position.values.length/3,w=s.length,f=new Array(a),k=new Array(w/3),v=new Array(w),t=0;t<a;t++)f[t]={indexOffset:0,count:0,currentCount:0};for(r=0,t=0;t<w;t+=3){var ft=s[t],ot=s[t+1],st=s[t+2],g=ft*3,nt=ot*3,tt=st*3;ni.x=e[g];ni.y=e[g+1];ni.z=e[g+2];pt.x=e[nt];pt.y=e[nt+1];pt.z=e[nt+2];wt.x=e[tt];wt.y=e[tt+1];wt.z=e[tt+2];f[ft].count++;f[ot].count++;f[st].count++;u.subtract(pt,ni,pt);u.subtract(wt,ni,wt);k[r]=u.cross(pt,wt,new u);r++}for(rt=0,t=0;t<a;t++)f[t].indexOffset+=rt,rt+=f[t].count;for(r=0,t=0;t<w;t+=3)i=f[s[t]],l=i.indexOffset+i.currentCount,v[l]=r,i.currentCount++,i=f[s[t+1]],l=i.indexOffset+i.currentCount,v[l]=r,i.currentCount++,i=f[s[t+2]],l=i.indexOffset+i.currentCount,v[l]=r,i.currentCount++,r++;for(p=new Float32Array(a*3),t=0;t<a;t++){if(b=t*3,i=f[t],u.clone(u.ZERO,et),i.count>0){for(r=0;r<i.count;r++)u.add(et,k[v[i.indexOffset+r]],et);u.equalsEpsilon(u.ZERO,et,d.EPSILON10)&&u.clone(k[v[i.indexOffset]],et)}u.equalsEpsilon(u.ZERO,et,d.EPSILON10)&&(et.z=1);u.normalize(et,et);p[b]=et.x;p[b+1]=et.y;p[b+2]=et.z}return n.attributes.normal=new y({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:p}),n};var tu=new u,ir=new u,iu=new u;ut.computeTangentAndBitangent=function(n){var v,a,i,e,s,w,b;if(!h(n))throw new c("geometry is required.");if(v=n.attributes,a=n.indices,!h(v.position)||!h(v.position.values))throw new c("geometry.attributes.position.values is required.");if(!h(v.normal)||!h(v.normal.values))throw new c("geometry.attributes.normal.values is required.");if(!h(v.st)||!h(v.st.values))throw new c("geometry.attributes.st.values is required.");if(!h(a))throw new c("geometry.indices is required.");if(a.length<2||a.length%3!=0)throw new c("geometry.indices length must be greater than 0 and be a multiple of 3.");if(n.primitiveType!==it.TRIANGLES)throw new c("geometry.primitiveType must be PrimitiveType.TRIANGLES.");for(var l=n.attributes.position.values,bt=n.attributes.normal.values,p=n.attributes.st.values,k=n.attributes.position.values.length/3,kt=a.length,f=new Array(k*3),t=0;t<f.length;t++)f[t]=0;for(t=0;t<kt;t+=3){var et=a[t],ot=a[t+1],st=a[t+2];i=et*3;e=ot*3;s=st*3;var ht=et*2,ct=ot*2,lt=st*2,at=l[i],vt=l[i+1],yt=l[i+2],pt=p[ht],wt=p[ht+1],d=p[ct+1]-wt,g=p[lt+1]-wt,nt=1/((p[ct]-pt)*g-(p[lt]-pt)*d),tt=(g*(l[e]-at)-d*(l[s]-at))*nt,rt=(g*(l[e+1]-vt)-d*(l[s+1]-vt))*nt,ut=(g*(l[e+2]-yt)-d*(l[s+2]-yt))*nt;f[i]+=tt;f[i+1]+=rt;f[i+2]+=ut;f[e]+=tt;f[e+1]+=rt;f[e+2]+=ut;f[s]+=tt;f[s+1]+=rt;f[s+2]+=ut}for(w=new Float32Array(k*3),b=new Float32Array(k*3),t=0;t<k;t++){i=t*3;e=i+1;s=i+2;var ft=u.fromArray(bt,i,tu),r=u.fromArray(f,i,iu),dt=u.dot(ft,r);u.multiplyByScalar(ft,dt,ir);u.normalize(u.subtract(r,ir,r),r);w[i]=r.x;w[e]=r.y;w[s]=r.z;u.normalize(u.cross(ft,r,r),r);b[i]=r.x;b[e]=r.y;b[s]=r.z}return n.attributes.tangent=new y({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:w}),n.attributes.bitangent=new y({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:b}),n};var ti=new r,st=new u,rr=new u,ur=new u,ei=new r;ut.compressVertices=function(t){var it,i,a,rt,p,w,lt,at,ft,tt,e,s,l;if(!h(t))throw new c("geometry is required.");if(it=t.attributes.extrudeDirection,h(it)){for(rt=it.values,a=rt.length/3,p=new Float32Array(a*2),w=0,i=0;i<a;++i){if(u.fromArray(rt,i*3,st),u.equals(st,u.ZERO)){w+=2;continue}ei=n.octEncodeInRange(st,65535,ei);p[w++]=ei.x;p[w++]=ei.y}return t.attributes.compressedAttributes=new y({componentDatatype:o.FLOAT,componentsPerAttribute:2,values:p}),delete t.attributes.extrudeDirection,t}var et=t.attributes.normal,ot=t.attributes.st,f=h(et),v=h(ot);if(!f&&!v)return t;var ht=t.attributes.tangent,ct=t.attributes.bitangent,b=h(ht),k=h(ct),d,ut,g,nt;for(f&&(d=et.values),v&&(ut=ot.values),b&&(g=ht.values),k&&(nt=ct.values),lt=f?d.length:ut.length,at=f?3:2,a=lt/at,ft=a,tt=v&&f?2:1,tt+=b||k?1:0,ft*=tt,e=new Float32Array(ft),s=0,i=0;i<a;++i)v&&(r.fromArray(ut,i*2,ti),e[s++]=n.compressTextureCoordinates(ti)),l=i*3,f&&h(g)&&h(nt)?(u.fromArray(d,l,st),u.fromArray(g,l,rr),u.fromArray(nt,l,ur),n.octPack(st,rr,ur,ti),e[s++]=ti.x,e[s++]=ti.y):(f&&(u.fromArray(d,l,st),e[s++]=n.octEncodeFloat(st)),b&&(u.fromArray(g,l,st),e[s++]=n.octEncodeFloat(st)),k&&(u.fromArray(nt,l,st),e[s++]=n.octEncodeFloat(st)));return t.attributes.compressedAttributes=new y({componentDatatype:o.FLOAT,componentsPerAttribute:tt,values:e}),f&&delete t.attributes.normal,v&&delete t.attributes.st,k&&delete t.attributes.bitangent,b&&delete t.attributes.tangent,t};vi=new u;var lt=new u,at=new u,vt=new u,yt=new u,yi={positions:new Array(7),indices:new Array(9)};var au=wi(f,4),oi=wi(u,3),er=wi(r,2),vu=function(n,t,i,r,u,f,e){var o=u[n]*r.x,s=u[t]*r.y,h=u[i]*r.z;f[e]=o+s+h>d.EPSILON6?1:0},ii=new u,bi=new u,ki=new u,yu=new u;or={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};var hr=tt.fromPointNormal(u.ZERO,u.UNIT_Y),wu=new u,bu=new u;var lr=new r,ku=new r,ar=new u,vr=new u,di=new u,du=new u,gu=new u,nf=new u,yr=new f;return wr=5*d.EPSILON9,ri=d.EPSILON6,ut.splitLongitude=function(n){var t,r,u;if(!h(n))throw new c("instance is required.");if(t=n.geometry,r=t.boundingSphere,h(r)&&(u=r.center.x-r.radius,u>0||i.intersectPlane(r,tt.ORIGIN_ZX_PLANE)!==b.INTERSECTING))return n;if(t.geometryType!==p.NONE)switch(t.geometryType){case p.POLYLINES:tf(n);break;case p.TRIANGLES:sr(n);break;case p.LINES:cr(n)}else hu(t),t.primitiveType===it.TRIANGLES?sr(n):t.primitiveType===it.LINES&&cr(n);return n},ut});t("Core/EllipseGeometry",["./arrayFill","./BoundingSphere","./Cartesian2","./Cartesian3","./Cartographic","./Check","./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError","./EllipseGeometryLibrary","./Ellipsoid","./GeographicProjection","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryInstance","./GeometryOffsetAttribute","./GeometryPipeline","./IndexDatatype","./Math","./Matrix3","./PrimitiveType","./Quaternion","./Rectangle","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function ui(t,u,f){var o=u.vertexFormat,wi=u.center,bi=u.semiMajorAxis,ki=u.semiMinorAxis,vt=u.ellipsoid,pi=u.stRotation,it=f?t.length/3*2:t.length/3,si=u.shadowVolume,b=o.st?new Float32Array(it*2):undefined,ut=o.normal?new Float32Array(it*3):undefined,ft=o.tangent?new Float32Array(it*3):undefined,ot=o.bitangent?new Float32Array(it*3):undefined,hi=si?new Float32Array(it*3):undefined,li=0,h=dt,y=gt,d=ni,di=new v(vt),ur=di.project(vt.cartesianToCartographic(wi,lt),ti),ai=vt.scaleToGeodeticSurface(wi,ct),bt,ui,vi,a,tr,oi,at,g,ir,ei,rr;vt.geodeticSurfaceNormal(ai,ai);bt=kt;ui=ci;pi!==0?(vi=rt.fromAxisAngle(ai,pi,wt),bt=tt.fromQuaternion(vi,bt),vi=rt.fromAxisAngle(ai,-pi,wt),ui=tt.fromQuaternion(vi,ui)):(bt=tt.clone(tt.IDENTITY,bt),ui=tt.clone(tt.IDENTITY,ui));var nt=i.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,ii),fi=i.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,ri),yi=t.length,c=f?yi:0,gi=c/3*2;for(a=0;a<yi;a+=3){var st=a+1,ht=a+2,nr=r.fromArray(t,a,ct);o.st&&(tr=tt.multiplyByVector(bt,nr,yt),oi=di.project(vt.cartesianToCartographic(tr,lt),pt),r.subtract(oi,ur,oi),et.x=(oi.x+bi)/(2*bi),et.y=(oi.y+ki)/(2*ki),nt.x=Math.min(et.x,nt.x),nt.y=Math.min(et.y,nt.y),fi.x=Math.max(et.x,fi.x),fi.y=Math.max(et.y,fi.y),f&&(b[li+gi]=et.x,b[li+1+gi]=et.y),b[li++]=et.x,b[li++]=et.y);(o.normal||o.tangent||o.bitangent||si)&&(h=vt.geodeticSurfaceNormal(nr,h),si&&(hi[a+c]=-h.x,hi[st+c]=-h.y,hi[ht+c]=-h.z),(o.normal||o.tangent||o.bitangent)&&((o.tangent||o.bitangent)&&(y=r.normalize(r.cross(r.UNIT_Z,h,y),y),tt.multiplyByVector(ui,y,y)),o.normal&&(ut[a]=h.x,ut[st]=h.y,ut[ht]=h.z,f&&(ut[a+c]=-h.x,ut[st+c]=-h.y,ut[ht+c]=-h.z)),o.tangent&&(ft[a]=y.x,ft[st]=y.y,ft[ht]=y.z,f&&(ft[a+c]=-y.x,ft[st+c]=-y.y,ft[ht+c]=-y.z)),o.bitangent&&(d=r.normalize(r.cross(h,y,d),d),ot[a]=d.x,ot[st]=d.y,ot[ht]=d.z,f&&(ot[a+c]=d.x,ot[st+c]=d.y,ot[ht+c]=d.z))))}if(o.st)for(yi=b.length,at=0;at<yi;at+=2)b[at]=(b[at]-nt.x)/(fi.x-nt.x),b[at+1]=(b[at+1]-nt.y)/(fi.y-nt.y);return g=new w,o.position&&(ir=l.raisePositionsToHeight(t,u,f),g.position=new p({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:ir})),o.st&&(g.st=new p({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:b})),o.normal&&(g.normal=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ut})),o.tangent&&(g.tangent=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ft})),o.bitangent&&(g.bitangent=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ot})),si&&(g.extrudeDirection=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:hi})),f&&s(u.offsetAttribute)&&(ei=new Uint8Array(it),u.offsetAttribute===k.TOP?ei=n(ei,1,0,it/2):(rr=u.offsetAttribute===k.NONE?0:1,ei=n(ei,rr)),g.applyOffset=new p({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:ei})),g}function fi(n){var t=new Array(12*n*(n+1)-6),i=0,r,e,u,f,o;for(r=0,u=1,f=0;f<3;f++)t[i++]=u++,t[i++]=r,t[i++]=u;for(f=2;f<n+1;++f){for(u=f*(f+1)-1,r=(f-1)*f-1,t[i++]=u++,t[i++]=r,t[i++]=u,e=2*f,o=0;o<e-1;++o)t[i++]=u,t[i++]=r++,t[i++]=r,t[i++]=u++,t[i++]=r,t[i++]=u;t[i++]=u++;t[i++]=r;t[i++]=u}for(e=n*2,++u,++r,f=0;f<e-1;++f)t[i++]=u,t[i++]=r++,t[i++]=r,t[i++]=u++,t[i++]=r,t[i++]=u;for(t[i++]=u,t[i++]=r++,t[i++]=r,t[i++]=u++,t[i++]=r++,t[i++]=r,++r,f=n-1;f>1;--f){for(t[i++]=r++,t[i++]=r,t[i++]=u,e=2*f,o=0;o<e-1;++o)t[i++]=u,t[i++]=r++,t[i++]=r,t[i++]=u++,t[i++]=r,t[i++]=u;t[i++]=r++;t[i++]=r++;t[i++]=u++}for(f=0;f<3;f++)t[i++]=r++,t[i++]=r,t[i++]=u;return t}function li(n){var u=n.center;ht=r.multiplyByScalar(n.ellipsoid.geodeticSurfaceNormal(u,ht),n.height,ht);ht=r.add(u,ht,ht);var o=new t(ht,n.semiMajorAxis),f=l.computeEllipsePositions(n,!0,!1),e=f.positions,s=f.numPts,h=ui(e,n,!1),i=fi(s);return i=g.createTypedArray(e.length/3,i),{boundingSphere:o,attributes:h,indices:i}}function ai(t,u){var o=u.vertexFormat,yi=u.center,pi=u.semiMajorAxis,wi=u.semiMinorAxis,ot=u.ellipsoid,tr=u.height,ir=u.extrudedHeight,rr=u.stRotation,g=t.length/3*2,st=new Float64Array(g*3),a=o.st?new Float32Array(g*2):undefined,ht=o.normal?new Float32Array(g*3):undefined,at=o.tangent?new Float32Array(g*3):undefined,vt=o.bitangent?new Float32Array(g*3):undefined,ai=u.shadowVolume,hi=ai?new Float32Array(g*3):undefined,ci=0,h=dt,y=gt,b=ni,bi=new v(ot),ur=bi.project(ot.cartesianToCartographic(yi,lt),ti),vi=ot.scaleToGeodeticSurface(yi,ct),c,di,oi,si,li,gi,ui,d,ei,nr;ot.geodeticSurfaceNormal(vi,vi);var fr=rt.fromAxisAngle(vi,rr,wt),er=tt.fromQuaternion(fr,kt),nt=i.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,ii),fi=i.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,ri),f=t.length,ki=f/3*2;for(c=0;c<f;c+=3){var it=c+1,ut=c+2,l=r.fromArray(t,c,ct),ft;o.st&&(di=tt.multiplyByVector(er,l,yt),oi=bi.project(ot.cartesianToCartographic(di,lt),pt),r.subtract(oi,ur,oi),et.x=(oi.x+pi)/(2*pi),et.y=(oi.y+wi)/(2*wi),nt.x=Math.min(et.x,nt.x),nt.y=Math.min(et.y,nt.y),fi.x=Math.max(et.x,fi.x),fi.y=Math.max(et.y,fi.y),a[ci+ki]=et.x,a[ci+1+ki]=et.y,a[ci++]=et.x,a[ci++]=et.y);l=ot.scaleToGeodeticSurface(l,l);ft=r.clone(l,yt);h=ot.geodeticSurfaceNormal(l,h);ai&&(hi[c+f]=-h.x,hi[it+f]=-h.y,hi[ut+f]=-h.z);si=r.multiplyByScalar(h,tr,bt);l=r.add(l,si,l);si=r.multiplyByScalar(h,ir,si);ft=r.add(ft,si,ft);o.position&&(st[c+f]=ft.x,st[it+f]=ft.y,st[ut+f]=ft.z,st[c]=l.x,st[it]=l.y,st[ut]=l.z);(o.normal||o.tangent||o.bitangent)&&(b=r.clone(h,b),li=r.fromArray(t,(c+3)%f,bt),r.subtract(li,l,li),gi=r.subtract(ft,l,pt),h=r.normalize(r.cross(gi,li,h),h),o.normal&&(ht[c]=h.x,ht[it]=h.y,ht[ut]=h.z,ht[c+f]=h.x,ht[it+f]=h.y,ht[ut+f]=h.z),o.tangent&&(y=r.normalize(r.cross(b,h,y),y),at[c]=y.x,at[it]=y.y,at[ut]=y.z,at[c+f]=y.x,at[c+1+f]=y.y,at[c+2+f]=y.z),o.bitangent&&(vt[c]=b.x,vt[it]=b.y,vt[ut]=b.z,vt[c+f]=b.x,vt[it+f]=b.y,vt[ut+f]=b.z))}if(o.st)for(f=a.length,ui=0;ui<f;ui+=2)a[ui]=(a[ui]-nt.x)/(fi.x-nt.x),a[ui+1]=(a[ui+1]-nt.y)/(fi.y-nt.y);return d=new w,o.position&&(d.position=new p({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:st})),o.st&&(d.st=new p({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:a})),o.normal&&(d.normal=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ht})),o.tangent&&(d.tangent=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:at})),o.bitangent&&(d.bitangent=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:vt})),ai&&(d.extrudeDirection=new p({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:hi})),s(u.offsetAttribute)&&(ei=new Uint8Array(g),u.offsetAttribute===k.TOP?ei=n(ei,1,0,g/2):(nr=u.offsetAttribute===k.NONE?0:1,ei=n(ei,nr)),d.applyOffset=new p({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:ei})),d}function vi(n){for(var i=n.length/3,t=g.createTypedArray(i,i*6),r=0,u=0;u<i;u++){var e=u,o=u+i,f=(e+1)%i,s=f+i;t[r++]=e;t[r++]=o;t[r++]=f;t[r++]=f;t[r++]=o;t[r++]=s}return t}function yi(n){var s=n.center,a=n.ellipsoid,v=n.semiMajorAxis,f=r.multiplyByScalar(a.geodeticSurfaceNormal(s,ct),n.height,ct),o,u;at.center=r.add(s,f,at.center);at.radius=v;f=r.multiplyByScalar(a.geodeticSurfaceNormal(s,f),n.extrudedHeight,f);vt.center=r.add(s,f,vt.center);vt.radius=v;var h=l.computeEllipsePositions(n,!0,!0),p=h.positions,k=h.numPts,c=h.outerPositions,nt=t.union(at,vt),tt=ui(p,n,!0),i=fi(k),e=i.length;for(i.length=e*2,o=p.length/3,u=0;u<e;u+=3)i[u+e]=i[u+2]+o,i[u+1+e]=i[u+1]+o,i[u+2+e]=i[u]+o;var rt=g.createTypedArray(o*2/3,i),ut=new y({attributes:tt,indices:rt,primitiveType:it.TRIANGLES}),ft=ai(c,n);i=vi(c);var et=g.createTypedArray(c.length*2/3,i),ot=new y({attributes:ft,indices:et,primitiveType:it.TRIANGLES}),w=d.combineInstances([new b({geometry:ut}),new b({geometry:ot})]);return{boundingSphere:nt,attributes:w[0].attributes,indices:w[0].indices}}function ei(n,t,i,u,f,e,o){for(var s,y=l.computeEllipsePositions({center:n,semiMajorAxis:t,semiMinorAxis:i,rotation:u,granularity:f},!1,!0),c=y.outerPositions,a=c.length/3,v=new Array(a),h=0;h<a;++h)v[h]=r.fromArray(c,h*3);return s=ut.fromCartesianArray(v,e,o),s.width>nt.PI&&(s.north=s.north>0?nt.PI_OVER_TWO-nt.EPSILON7:s.north,s.south=s.south<0?nt.EPSILON7-nt.PI_OVER_TWO:s.south,s.east=nt.PI,s.west=-nt.PI),s}function ot(n){var t,e;n=o(n,o.EMPTY_OBJECT);var s=n.center,l=o(n.ellipsoid,a.WGS84),i=n.semiMajorAxis,u=n.semiMinorAxis,h=o(n.granularity,nt.RADIANS_PER_DEGREE),v=o(n.vertexFormat,ft.DEFAULT);if(f.defined("options.center",s),f.typeOf.number("options.semiMajorAxis",i),f.typeOf.number("options.semiMinorAxis",u),i<u)throw new c("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(h<=0)throw new c("granularity must be greater than zero.");t=o(n.height,0);e=o(n.extrudedHeight,t);this._center=r.clone(s);this._semiMajorAxis=i;this._semiMinorAxis=u;this._ellipsoid=a.clone(l);this._rotation=o(n.rotation,0);this._stRotation=o(n.stRotation,0);this._height=Math.max(e,t);this._granularity=h;this._vertexFormat=ft.clone(v);this._extrudedHeight=Math.min(e,t);this._shadowVolume=o(n.shadowVolume,!1);this._workerName="createEllipseGeometry";this._offsetAttribute=n.offsetAttribute;this._rectangle=undefined;this._textureCoordinateRotationPoints=undefined}function pi(n){var i=-n._stRotation,t,o,s;if(i===0)return[0,0,0,1,1,0];var h=l.computeEllipsePositions({center:n._center,semiMajorAxis:n._semiMajorAxis,semiMinorAxis:n._semiMinorAxis,rotation:n._rotation,granularity:n._granularity},!1,!0),u=h.outerPositions,f=u.length/3,e=new Array(f);for(t=0;t<f;++t)e[t]=r.fromArray(u,t*3);return o=n._ellipsoid,s=n.rectangle,y._textureCoordinateRotationPoints(e,i,o,s)}var ct=new r,yt=new r,pt=new r,bt=new r,et=new i,kt=new tt,ci=new tt,wt=new rt,dt=new r,gt=new r,ni=new r,lt=new u,ti=new r,ii=new i,ri=new i,ht=new r,at=new t,vt=new t;ot.packedLength=r.packedLength+a.packedLength+ft.packedLength+9;ot.pack=function(n,t,i){return f.defined("value",n),f.defined("array",t),i=o(i,0),r.pack(n._center,t,i),i+=r.packedLength,a.pack(n._ellipsoid,t,i),i+=a.packedLength,ft.pack(n._vertexFormat,t,i),i+=ft.packedLength,t[i++]=n._semiMajorAxis,t[i++]=n._semiMinorAxis,t[i++]=n._rotation,t[i++]=n._stRotation,t[i++]=n._height,t[i++]=n._granularity,t[i++]=n._extrudedHeight,t[i++]=n._shadowVolume?1:0,t[i]=o(n._offsetAttribute,-1),t};var oi=new r,si=new a,hi=new ft,st={center:oi,ellipsoid:si,vertexFormat:hi,semiMajorAxis:undefined,semiMinorAxis:undefined,rotation:undefined,stRotation:undefined,height:undefined,granularity:undefined,extrudedHeight:undefined,shadowVolume:undefined,offsetAttribute:undefined};return ot.unpack=function(n,t,i){var e,h,c;f.defined("array",n);t=o(t,0);e=r.unpack(n,t,oi);t+=r.packedLength;h=a.unpack(n,t,si);t+=a.packedLength;c=ft.unpack(n,t,hi);t+=ft.packedLength;var l=n[t++],v=n[t++],y=n[t++],p=n[t++],w=n[t++],b=n[t++],k=n[t++],d=n[t++]===1,u=n[t];return s(i)?(i._center=r.clone(e,i._center),i._ellipsoid=a.clone(h,i._ellipsoid),i._vertexFormat=ft.clone(c,i._vertexFormat),i._semiMajorAxis=l,i._semiMinorAxis=v,i._rotation=y,i._stRotation=p,i._height=w,i._granularity=b,i._extrudedHeight=k,i._shadowVolume=d,i._offsetAttribute=u===-1?undefined:u,i):(st.height=w,st.extrudedHeight=k,st.granularity=b,st.stRotation=p,st.rotation=y,st.semiMajorAxis=l,st.semiMinorAxis=v,st.shadowVolume=d,st.offsetAttribute=u===-1?undefined:u,new ot(st))},ot.computeRectangle=function(n,t){n=o(n,o.EMPTY_OBJECT);var u=n.center,s=o(n.ellipsoid,a.WGS84),i=n.semiMajorAxis,r=n.semiMinorAxis,e=o(n.granularity,nt.RADIANS_PER_DEGREE),h=o(n.rotation,0);if(f.defined("options.center",u),f.typeOf.number("options.semiMajorAxis",i),f.typeOf.number("options.semiMinorAxis",r),i<r)throw new c("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(e<=0)throw new c("granularity must be greater than zero.");return ei(u,i,r,h,e,s,t)},ot.createGeometry=function(t){var r,i;if(!(t._semiMajorAxis<=0)&&!(t._semiMinorAxis<=0)){var u=t._height,f=t._extrudedHeight,h=!nt.equalsEpsilon(u,f,0,nt.EPSILON2);if(t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center),r={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:u,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation},h)r.extrudedHeight=f,r.shadowVolume=t._shadowVolume,r.offsetAttribute=t._offsetAttribute,i=yi(r);else if(i=li(r),s(t._offsetAttribute)){var c=i.attributes.position.values.length,o=new Uint8Array(c/3),l=t._offsetAttribute===k.NONE?0:1;n(o,l);i.attributes.applyOffset=new p({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:o})}return new y({attributes:i.attributes,indices:i.indices,primitiveType:it.TRIANGLES,boundingSphere:i.boundingSphere,offsetAttribute:t._offsetAttribute})}},ot.createShadowVolume=function(n,t,i){var r=n._granularity,u=n._ellipsoid,f=t(r,u),e=i(r,u);return new ot({center:n._center,semiMajorAxis:n._semiMajorAxis,semiMinorAxis:n._semiMinorAxis,ellipsoid:u,rotation:n._rotation,stRotation:n._stRotation,granularity:r,extrudedHeight:f,height:e,vertexFormat:ft.POSITION_ONLY,shadowVolume:!0})},h(ot.prototype,{rectangle:{get:function(){return s(this._rectangle)||(this._rectangle=ei(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return s(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=pi(this)),this._textureCoordinateRotationPoints}}}),ot});t("Core/CircleGeometry",["./Cartesian3","./Check","./defaultValue","./defined","./defineProperties","./EllipseGeometry","./Ellipsoid","./VertexFormat"],function(n,t,i,r,u,f,e,o){"use strict";function h(n){var r,u;n=i(n,i.EMPTY_OBJECT);r=n.radius;t.typeOf.number("radius",r);u={center:n.center,semiMajorAxis:r,semiMinorAxis:r,ellipsoid:n.ellipsoid,height:n.height,extrudedHeight:n.extrudedHeight,granularity:n.granularity,vertexFormat:n.vertexFormat,stRotation:n.stRotation,shadowVolume:n.shadowVolume};this._ellipseGeometry=new f(u);this._workerName="createCircleGeometry"}h.packedLength=f.packedLength;h.pack=function(n,i,r){return t.typeOf.object("value",n),f.pack(n._ellipseGeometry,i,r)};var c=new f({center:new n,semiMajorAxis:1,semiMinorAxis:1}),s={center:new n,radius:undefined,ellipsoid:e.clone(e.UNIT_SPHERE),height:undefined,extrudedHeight:undefined,granularity:undefined,vertexFormat:new o,stRotation:undefined,semiMajorAxis:undefined,semiMinorAxis:undefined,shadowVolume:undefined};return h.unpack=function(t,i,u){var l=f.unpack(t,i,c);return(s.center=n.clone(l._center,s.center),s.ellipsoid=e.clone(l._ellipsoid,s.ellipsoid),s.height=l._height,s.extrudedHeight=l._extrudedHeight,s.granularity=l._granularity,s.vertexFormat=o.clone(l._vertexFormat,s.vertexFormat),s.stRotation=l._stRotation,s.shadowVolume=l._shadowVolume,!r(u))?(s.radius=l._semiMajorAxis,new h(s)):(s.semiMajorAxis=l._semiMajorAxis,s.semiMinorAxis=l._semiMinorAxis,u._ellipseGeometry=new f(s),u)},h.createGeometry=function(n){return f.createGeometry(n._ellipseGeometry)},h.createShadowVolume=function(n,t,i){var r=n._ellipseGeometry._granularity,u=n._ellipseGeometry._ellipsoid,f=t(r,u),e=i(r,u);return new h({center:n._ellipseGeometry._center,radius:n._ellipseGeometry._semiMajorAxis,ellipsoid:u,stRotation:n._ellipseGeometry._stRotation,granularity:r,extrudedHeight:f,height:e,vertexFormat:o.POSITION_ONLY,shadowVolume:!0})},u(h.prototype,{rectangle:{get:function(){return this._ellipseGeometry.rectangle}},textureCoordinateRotationPoints:{get:function(){return this._ellipseGeometry.textureCoordinateRotationPoints}}}),h});t("Core/EllipseOutlineGeometry",["./arrayFill","./BoundingSphere","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./EllipseGeometryLibrary","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function rt(n){var s=n.center,u;b=i.multiplyByScalar(n.ellipsoid.geodeticSurfaceNormal(s,b),n.height,b);b=i.add(s,b,b);var y=new t(b,n.semiMajorAxis),h=o.computeEllipsePositions(n,!1,!0).outerPositions,p=new l({position:new c({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:o.raisePositionsToHeight(h,n,!1)})}),f=h.length/3,e=v.createTypedArray(f,f*2),a=0;for(u=0;u<f;++u)e[a++]=u,e[a++]=(u+1)%f;return{boundingSphere:y,attributes:p,indices:e}}function ut(e){var it=e.center,et=e.ellipsoid,ot=e.semiMajorAxis,tt=i.multiplyByScalar(et.geodeticSurfaceNormal(it,nt),e.height,nt),rt,ut,st,s,k,ht,w,p,b,h,ft,ct,lt;for(d.center=i.add(it,tt,d.center),d.radius=ot,tt=i.multiplyByScalar(et.geodeticSurfaceNormal(it,tt),e.extrudedHeight,tt),g.center=i.add(it,tt,g.center),g.radius=ot,rt=o.computeEllipsePositions(e,!1,!0).outerPositions,ut=new l({position:new c({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:o.raisePositionsToHeight(rt,e,!0)})}),rt=ut.position.values,st=t.union(d,g),s=rt.length/3,f(e.offsetAttribute)&&(k=new Uint8Array(s),e.offsetAttribute===a.TOP?k=n(k,1,0,s/2):(ht=e.offsetAttribute===a.NONE?0:1,k=n(k,ht)),ut.applyOffset=new c({componentDatatype:r.UNSIGNED_BYTE,componentsPerAttribute:1,values:k})),w=u(e.numberOfVerticalLines,16),w=y.clamp(w,0,s/2),p=v.createTypedArray(s,s*2+w*2),s/=2,b=0,h=0;h<s;++h)p[b++]=h,p[b++]=(h+1)%s,p[b++]=h+s,p[b++]=(h+1)%s+s;if(w>0)for(ct=Math.min(w,s),ft=Math.round(s/ct),lt=Math.min(ft*w,s),h=0;h<lt;h+=ft)p[b++]=h,p[b++]=h+s;return{boundingSphere:st,attributes:ut,indices:p}}function k(n){var t,h;n=u(n,u.EMPTY_OBJECT);var c=n.center,a=u(n.ellipsoid,s.WGS84),r=n.semiMajorAxis,o=n.semiMinorAxis,l=u(n.granularity,y.RADIANS_PER_DEGREE);if(!f(c))throw new e("center is required.");if(!f(r))throw new e("semiMajorAxis is required.");if(!f(o))throw new e("semiMinorAxis is required.");if(r<o)throw new e("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(l<=0)throw new e("granularity must be greater than zero.");t=u(n.height,0);h=u(n.extrudedHeight,t);this._center=i.clone(c);this._semiMajorAxis=r;this._semiMinorAxis=o;this._ellipsoid=s.clone(a);this._rotation=u(n.rotation,0);this._height=Math.max(h,t);this._granularity=l;this._extrudedHeight=Math.min(h,t);this._numberOfVerticalLines=Math.max(u(n.numberOfVerticalLines,16),0);this._offsetAttribute=n.offsetAttribute;this._workerName="createEllipseOutlineGeometry"}var nt=new i,b=new i,d=new t,g=new t;k.packedLength=i.packedLength+s.packedLength+8;k.pack=function(n,t,r){if(!f(n))throw new e("value is required");if(!f(t))throw new e("array is required");return r=u(r,0),i.pack(n._center,t,r),r+=i.packedLength,s.pack(n._ellipsoid,t,r),r+=s.packedLength,t[r++]=n._semiMajorAxis,t[r++]=n._semiMinorAxis,t[r++]=n._rotation,t[r++]=n._height,t[r++]=n._granularity,t[r++]=n._extrudedHeight,t[r++]=n._numberOfVerticalLines,t[r]=u(n._offsetAttribute,-1),t};var tt=new i,it=new s,w={center:tt,ellipsoid:it,semiMajorAxis:undefined,semiMinorAxis:undefined,rotation:undefined,height:undefined,granularity:undefined,extrudedHeight:undefined,numberOfVerticalLines:undefined,offsetAttribute:undefined};return k.unpack=function(n,t,r){var h,c;if(!f(n))throw new e("array is required");t=u(t,0);h=i.unpack(n,t,tt);t+=i.packedLength;c=s.unpack(n,t,it);t+=s.packedLength;var l=n[t++],a=n[t++],v=n[t++],y=n[t++],p=n[t++],b=n[t++],d=n[t++],o=n[t];return f(r)?(r._center=i.clone(h,r._center),r._ellipsoid=s.clone(c,r._ellipsoid),r._semiMajorAxis=l,r._semiMinorAxis=a,r._rotation=v,r._height=y,r._granularity=p,r._extrudedHeight=b,r._numberOfVerticalLines=d,r._offsetAttribute=o===-1?undefined:o,r):(w.height=y,w.extrudedHeight=b,w.granularity=p,w.rotation=v,w.semiMajorAxis=l,w.semiMinorAxis=a,w.numberOfVerticalLines=d,w.offsetAttribute=o===-1?undefined:o,new k(w))},k.createGeometry=function(t){var u,i;if(!(t._semiMajorAxis<=0)&&!(t._semiMinorAxis<=0)){var e=t._height,o=t._extrudedHeight,l=!y.equalsEpsilon(e,o,0,y.EPSILON2);if(t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center),u={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:e,granularity:t._granularity,numberOfVerticalLines:t._numberOfVerticalLines},l)u.extrudedHeight=o,u.offsetAttribute=t._offsetAttribute,i=ut(u);else if(i=rt(u),f(t._offsetAttribute)){var v=i.attributes.position.values.length,s=new Uint8Array(v/3),w=t._offsetAttribute===a.NONE?0:1;n(s,w);i.attributes.applyOffset=new c({componentDatatype:r.UNSIGNED_BYTE,componentsPerAttribute:1,values:s})}return new h({attributes:i.attributes,indices:i.indices,primitiveType:p.LINES,boundingSphere:i.boundingSphere,offsetAttribute:t._offsetAttribute})}},k});t("Core/CircleOutlineGeometry",["./Cartesian3","./Check","./defaultValue","./defined","./EllipseOutlineGeometry","./Ellipsoid"],function(n,t,i,r,u,f){"use strict";function o(n){var r,f;n=i(n,i.EMPTY_OBJECT);r=n.radius;t.typeOf.number("radius",r);f={center:n.center,semiMajorAxis:r,semiMinorAxis:r,ellipsoid:n.ellipsoid,height:n.height,extrudedHeight:n.extrudedHeight,granularity:n.granularity,numberOfVerticalLines:n.numberOfVerticalLines};this._ellipseGeometry=new u(f);this._workerName="createCircleOutlineGeometry"}o.packedLength=u.packedLength;o.pack=function(n,i,r){return t.typeOf.object("value",n),u.pack(n._ellipseGeometry,i,r)};var s=new u({center:new n,semiMajorAxis:1,semiMinorAxis:1}),e={center:new n,radius:undefined,ellipsoid:f.clone(f.UNIT_SPHERE),height:undefined,extrudedHeight:undefined,granularity:undefined,numberOfVerticalLines:undefined,semiMajorAxis:undefined,semiMinorAxis:undefined};return o.unpack=function(t,i,h){var c=u.unpack(t,i,s);return(e.center=n.clone(c._center,e.center),e.ellipsoid=f.clone(c._ellipsoid,e.ellipsoid),e.height=c._height,e.extrudedHeight=c._extrudedHeight,e.granularity=c._granularity,e.numberOfVerticalLines=c._numberOfVerticalLines,!r(h))?(e.radius=c._semiMajorAxis,new o(e)):(e.semiMajorAxis=c._semiMajorAxis,e.semiMinorAxis=c._semiMinorAxis,h._ellipseGeometry=new u(e),h)},o.createGeometry=function(n){return u.createGeometry(n._ellipseGeometry)},o});t("Core/ClockRange",["./freezeObject"],function(n){"use strict";return n({UNBOUNDED:0,CLAMPED:1,LOOP_STOP:2})});t("Core/ClockStep",["./freezeObject"],function(n){"use strict";return n({TICK_DEPENDENT:0,SYSTEM_CLOCK_MULTIPLIER:1,SYSTEM_CLOCK:2})});t("Core/getTimestamp",[],function(){"use strict";return typeof performance!="undefined"&&typeof performance.now=="function"&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()}});t("Core/Clock",["./ClockRange","./ClockStep","./defaultValue","./defined","./defineProperties","./DeveloperError","./Event","./getTimestamp","./JulianDate"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(u){u=i(u,i.EMPTY_OBJECT);var l=u.currentTime,h=u.startTime,c=u.stopTime;if(l=r(l)?s.clone(l):r(h)?s.clone(h):r(c)?s.addDays(c,-1,new s):s.now(),h=r(h)?s.clone(h):s.clone(l),c=r(c)?s.clone(c):s.addDays(h,1,new s),s.greaterThan(h,c))throw new f("startTime must come before stopTime.");this.startTime=h;this.stopTime=c;this.clockRange=i(u.clockRange,n.UNBOUNDED);this.canAnimate=i(u.canAnimate,!0);this.onTick=new e;this._currentTime=undefined;this._multiplier=undefined;this._clockStep=undefined;this._shouldAnimate=undefined;this._lastSystemTime=o();this.currentTime=l;this.multiplier=i(u.multiplier,1);this.shouldAnimate=i(u.shouldAnimate,!1);this.clockStep=i(u.clockStep,t.SYSTEM_CLOCK_MULTIPLIER)}return u(h.prototype,{currentTime:{get:function(){return this._currentTime},set:function(n){s.equals(this._currentTime,n)||(this._clockStep===t.SYSTEM_CLOCK&&(this._clockStep=t.SYSTEM_CLOCK_MULTIPLIER),this._currentTime=n)}},multiplier:{get:function(){return this._multiplier},set:function(n){this._multiplier!==n&&(this._clockStep===t.SYSTEM_CLOCK&&(this._clockStep=t.SYSTEM_CLOCK_MULTIPLIER),this._multiplier=n)}},clockStep:{get:function(){return this._clockStep},set:function(n){n===t.SYSTEM_CLOCK&&(this._multiplier=1,this._shouldAnimate=!0,this._currentTime=s.now());this._clockStep=n}},shouldAnimate:{get:function(){return this._shouldAnimate},set:function(n){this._shouldAnimate!==n&&(this._clockStep===t.SYSTEM_CLOCK&&(this._clockStep=t.SYSTEM_CLOCK_MULTIPLIER),this._shouldAnimate=n)}}}),h.prototype.tick=function(){var h=o(),i=s.clone(this._currentTime),f,e,c;if(this.canAnimate&&this._shouldAnimate)if(f=this._clockStep,f===t.SYSTEM_CLOCK)i=s.now(i);else{e=this._multiplier;f===t.TICK_DEPENDENT?i=s.addSeconds(i,e,i):(c=h-this._lastSystemTime,i=s.addSeconds(i,e*(c/1e3),i));var l=this.clockRange,r=this.startTime,u=this.stopTime;if(l===n.CLAMPED)s.lessThan(i,r)?i=s.clone(r,i):s.greaterThan(i,u)&&(i=s.clone(u,i));else if(l===n.LOOP_STOP)for(s.lessThan(i,r)&&(i=s.clone(r,i));s.greaterThan(i,u);)i=s.addSeconds(r,s.secondsDifference(i,u),i)}return this._currentTime=i,this._lastSystemTime=h,this.onTick.raiseEvent(this),i},h});t("Core/Color",["./Check","./defaultValue","./defined","./FeatureDetection","./freezeObject","./Math"],function(n,t,i,r,u,f){"use strict";function s(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i*6<1)?n+(t-n)*6*i:i*2<1?t:i*3<2?n+(t-n)*(2/3-i)*6:n}function e(n,i,r,u){this.red=t(n,1);this.green=t(i,1);this.blue=t(r,1);this.alpha=t(u,1)}var h,c,o;e.fromCartesian4=function(t,r){return(n.typeOf.object("cartesian",t),!i(r))?new e(t.x,t.y,t.z,t.w):(r.red=t.x,r.green=t.y,r.blue=t.z,r.alpha=t.w,r)};e.fromBytes=function(n,r,u,f,o){return(n=e.byteToFloat(t(n,255)),r=e.byteToFloat(t(r,255)),u=e.byteToFloat(t(u,255)),f=e.byteToFloat(t(f,255)),!i(o))?new e(n,r,u,f):(o.red=n,o.green=r,o.blue=u,o.alpha=f,o)};e.fromAlpha=function(t,r,u){return(n.typeOf.object("color",t),n.typeOf.number("alpha",r),!i(u))?new e(t.red,t.green,t.blue,r):(u.red=t.red,u.green=t.green,u.blue=t.blue,u.alpha=r,u)};r.supportsTypedArrays()&&(h=new ArrayBuffer(4),c=new Uint32Array(h),o=new Uint8Array(h));e.fromRgba=function(n,t){return c[0]=n,e.fromBytes(o[0],o[1],o[2],o[3],t)};e.fromHsl=function(n,r,u,f,o){var h,c;n=t(n,0)%1;r=t(r,0);u=t(u,0);f=t(f,1);var l=u,a=u,v=u;return(r!==0&&(h=u<.5?u*(1+r):u+r-u*r,c=2*u-h,l=s(c,h,n+1/3),a=s(c,h,n),v=s(c,h,n-1/3)),!i(o))?new e(l,a,v,f):(o.red=l,o.green=a,o.blue=v,o.alpha=f,o)};e.fromRandom=function(r,u){var o,l,p,s,a,w,h,v,b,c,y,k;return(r=t(r,t.EMPTY_OBJECT),o=r.red,i(o)||(l=t(r.minimumRed,0),p=t(r.maximumRed,1),n.typeOf.number.lessThanOrEquals("minimumRed",l,p),o=l+f.nextRandomNumber()*(p-l)),s=r.green,i(s)||(a=t(r.minimumGreen,0),w=t(r.maximumGreen,1),n.typeOf.number.lessThanOrEquals("minimumGreen",a,w),s=a+f.nextRandomNumber()*(w-a)),h=r.blue,i(h)||(v=t(r.minimumBlue,0),b=t(r.maximumBlue,1),n.typeOf.number.lessThanOrEquals("minimumBlue",v,b),h=v+f.nextRandomNumber()*(b-v)),c=r.alpha,i(c)||(y=t(r.minimumAlpha,0),k=t(r.maximumAlpha,1),n.typeOf.number.lessThanOrEquals("minumumAlpha",y,k),c=y+f.nextRandomNumber()*(k-y)),!i(u))?new e(o,s,h,c):(u.red=o,u.green=s,u.blue=h,u.alpha=c,u)};var l=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,a=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,v=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,y=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;return e.fromCssColorString=function(r,u){var o,f;return(n.typeOf.string("color",r),i(u)||(u=new e),o=e[r.toUpperCase()],i(o))?(e.clone(o,u),u):(f=l.exec(r),f!==null)?(u.red=parseInt(f[1],16)/15,u.green=parseInt(f[2],16)/15,u.blue=parseInt(f[3],16)/15,u.alpha=1,u):(f=a.exec(r),f!==null)?(u.red=parseInt(f[1],16)/255,u.green=parseInt(f[2],16)/255,u.blue=parseInt(f[3],16)/255,u.alpha=1,u):(f=v.exec(r),f!==null)?(u.red=parseFloat(f[1])/("%"===f[1].substr(-1)?100:255),u.green=parseFloat(f[2])/("%"===f[2].substr(-1)?100:255),u.blue=parseFloat(f[3])/("%"===f[3].substr(-1)?100:255),u.alpha=parseFloat(t(f[4],"1.0")),u):(f=y.exec(r),f!==null)?e.fromHsl(parseFloat(f[1])/360,parseFloat(f[2])/100,parseFloat(f[3])/100,parseFloat(t(f[4],"1.0")),u):undefined},e.packedLength=4,e.pack=function(i,r,u){return n.typeOf.object("value",i),n.defined("array",r),u=t(u,0),r[u++]=i.red,r[u++]=i.green,r[u++]=i.blue,r[u]=i.alpha,r},e.unpack=function(r,u,f){return n.defined("array",r),u=t(u,0),i(f)||(f=new e),f.red=r[u++],f.green=r[u++],f.blue=r[u++],f.alpha=r[u],f},e.byteToFloat=function(n){return n/255},e.floatToByte=function(n){return n===1?255:n*256|0},e.clone=function(n,t){return i(n)?i(t)?(t.red=n.red,t.green=n.green,t.blue=n.blue,t.alpha=n.alpha,t):new e(n.red,n.green,n.blue,n.alpha):undefined},e.equals=function(n,t){return n===t||i(n)&&i(t)&&n.red===t.red&&n.green===t.green&&n.blue===t.blue&&n.alpha===t.alpha},e.equalsArray=function(n,t,i){return n.red===t[i]&&n.green===t[i+1]&&n.blue===t[i+2]&&n.alpha===t[i+3]},e.prototype.clone=function(n){return e.clone(this,n)},e.prototype.equals=function(n){return e.equals(this,n)},e.prototype.equalsEpsilon=function(n,t){return this===n||i(n)&&Math.abs(this.red-n.red)<=t&&Math.abs(this.green-n.green)<=t&&Math.abs(this.blue-n.blue)<=t&&Math.abs(this.alpha-n.alpha)<=t},e.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"},e.prototype.toCssColorString=function(){var n=e.floatToByte(this.red),t=e.floatToByte(this.green),i=e.floatToByte(this.blue);return this.alpha===1?"rgb("+n+","+t+","+i+")":"rgba("+n+","+t+","+i+","+this.alpha+")"},e.prototype.toBytes=function(n){var t=e.floatToByte(this.red),r=e.floatToByte(this.green),u=e.floatToByte(this.blue),f=e.floatToByte(this.alpha);return i(n)?(n[0]=t,n[1]=r,n[2]=u,n[3]=f,n):[t,r,u,f]},e.prototype.toRgba=function(){return o[0]=e.floatToByte(this.red),o[1]=e.floatToByte(this.green),o[2]=e.floatToByte(this.blue),o[3]=e.floatToByte(this.alpha),c[0]},e.prototype.brighten=function(t,i){return n.typeOf.number("magnitude",t),n.typeOf.number.greaterThanOrEquals("magnitude",t,0),n.typeOf.object("result",i),t=1-t,i.red=1-(1-this.red)*t,i.green=1-(1-this.green)*t,i.blue=1-(1-this.blue)*t,i.alpha=this.alpha,i},e.prototype.darken=function(t,i){return n.typeOf.number("magnitude",t),n.typeOf.number.greaterThanOrEquals("magnitude",t,0),n.typeOf.object("result",i),t=1-t,i.red=this.red*t,i.green=this.green*t,i.blue=this.blue*t,i.alpha=this.alpha,i},e.prototype.withAlpha=function(n,t){return e.fromAlpha(this,n,t)},e.add=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.red=t.red+i.red,r.green=t.green+i.green,r.blue=t.blue+i.blue,r.alpha=t.alpha+i.alpha,r},e.subtract=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.red=t.red-i.red,r.green=t.green-i.green,r.blue=t.blue-i.blue,r.alpha=t.alpha-i.alpha,r},e.multiply=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.red=t.red*i.red,r.green=t.green*i.green,r.blue=t.blue*i.blue,r.alpha=t.alpha*i.alpha,r},e.divide=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.red=t.red/i.red,r.green=t.green/i.green,r.blue=t.blue/i.blue,r.alpha=t.alpha/i.alpha,r},e.mod=function(t,i,r){return n.typeOf.object("left",t),n.typeOf.object("right",i),n.typeOf.object("result",r),r.red=t.red%i.red,r.green=t.green%i.green,r.blue=t.blue%i.blue,r.alpha=t.alpha%i.alpha,r},e.multiplyByScalar=function(t,i,r){return n.typeOf.object("color",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.red=t.red*i,r.green=t.green*i,r.blue=t.blue*i,r.alpha=t.alpha*i,r},e.divideByScalar=function(t,i,r){return n.typeOf.object("color",t),n.typeOf.number("scalar",i),n.typeOf.object("result",r),r.red=t.red/i,r.green=t.green/i,r.blue=t.blue/i,r.alpha=t.alpha/i,r},e.ALICEBLUE=u(e.fromCssColorString("#F0F8FF")),e.ANTIQUEWHITE=u(e.fromCssColorString("#FAEBD7")),e.AQUA=u(e.fromCssColorString("#00FFFF")),e.AQUAMARINE=u(e.fromCssColorString("#7FFFD4")),e.AZURE=u(e.fromCssColorString("#F0FFFF")),e.BEIGE=u(e.fromCssColorString("#F5F5DC")),e.BISQUE=u(e.fromCssColorString("#FFE4C4")),e.BLACK=u(e.fromCssColorString("#000000")),e.BLANCHEDALMOND=u(e.fromCssColorString("#FFEBCD")),e.BLUE=u(e.fromCssColorString("#0000FF")),e.BLUEVIOLET=u(e.fromCssColorString("#8A2BE2")),e.BROWN=u(e.fromCssColorString("#A52A2A")),e.BURLYWOOD=u(e.fromCssColorString("#DEB887")),e.CADETBLUE=u(e.fromCssColorString("#5F9EA0")),e.CHARTREUSE=u(e.fromCssColorString("#7FFF00")),e.CHOCOLATE=u(e.fromCssColorString("#D2691E")),e.CORAL=u(e.fromCssColorString("#FF7F50")),e.CORNFLOWERBLUE=u(e.fromCssColorString("#6495ED")),e.CORNSILK=u(e.fromCssColorString("#FFF8DC")),e.CRIMSON=u(e.fromCssColorString("#DC143C")),e.CYAN=u(e.fromCssColorString("#00FFFF")),e.DARKBLUE=u(e.fromCssColorString("#00008B")),e.DARKCYAN=u(e.fromCssColorString("#008B8B")),e.DARKGOLDENROD=u(e.fromCssColorString("#B8860B")),e.DARKGRAY=u(e.fromCssColorString("#A9A9A9")),e.DARKGREEN=u(e.fromCssColorString("#006400")),e.DARKGREY=e.DARKGRAY,e.DARKKHAKI=u(e.fromCssColorString("#BDB76B")),e.DARKMAGENTA=u(e.fromCssColorString("#8B008B")),e.DARKOLIVEGREEN=u(e.fromCssColorString("#556B2F")),e.DARKORANGE=u(e.fromCssColorString("#FF8C00")),e.DARKORCHID=u(e.fromCssColorString("#9932CC")),e.DARKRED=u(e.fromCssColorString("#8B0000")),e.DARKSALMON=u(e.fromCssColorString("#E9967A")),e.DARKSEAGREEN=u(e.fromCssColorString("#8FBC8F")),e.DARKSLATEBLUE=u(e.fromCssColorString("#483D8B")),e.DARKSLATEGRAY=u(e.fromCssColorString("#2F4F4F")),e.DARKSLATEGREY=e.DARKSLATEGRAY,e.DARKTURQUOISE=u(e.fromCssColorString("#00CED1")),e.DARKVIOLET=u(e.fromCssColorString("#9400D3")),e.DEEPPINK=u(e.fromCssColorString("#FF1493")),e.DEEPSKYBLUE=u(e.fromCssColorString("#00BFFF")),e.DIMGRAY=u(e.fromCssColorString("#696969")),e.DIMGREY=e.DIMGRAY,e.DODGERBLUE=u(e.fromCssColorString("#1E90FF")),e.FIREBRICK=u(e.fromCssColorString("#B22222")),e.FLORALWHITE=u(e.fromCssColorString("#FFFAF0")),e.FORESTGREEN=u(e.fromCssColorString("#228B22")),e.FUCHSIA=u(e.fromCssColorString("#FF00FF")),e.GAINSBORO=u(e.fromCssColorString("#DCDCDC")),e.GHOSTWHITE=u(e.fromCssColorString("#F8F8FF")),e.GOLD=u(e.fromCssColorString("#FFD700")),e.GOLDENROD=u(e.fromCssColorString("#DAA520")),e.GRAY=u(e.fromCssColorString("#808080")),e.GREEN=u(e.fromCssColorString("#008000")),e.GREENYELLOW=u(e.fromCssColorString("#ADFF2F")),e.GREY=e.GRAY,e.HONEYDEW=u(e.fromCssColorString("#F0FFF0")),e.HOTPINK=u(e.fromCssColorString("#FF69B4")),e.INDIANRED=u(e.fromCssColorString("#CD5C5C")),e.INDIGO=u(e.fromCssColorString("#4B0082")),e.IVORY=u(e.fromCssColorString("#FFFFF0")),e.KHAKI=u(e.fromCssColorString("#F0E68C")),e.LAVENDER=u(e.fromCssColorString("#E6E6FA")),e.LAVENDAR_BLUSH=u(e.fromCssColorString("#FFF0F5")),e.LAWNGREEN=u(e.fromCssColorString("#7CFC00")),e.LEMONCHIFFON=u(e.fromCssColorString("#FFFACD")),e.LIGHTBLUE=u(e.fromCssColorString("#ADD8E6")),e.LIGHTCORAL=u(e.fromCssColorString("#F08080")),e.LIGHTCYAN=u(e.fromCssColorString("#E0FFFF")),e.LIGHTGOLDENRODYELLOW=u(e.fromCssColorString("#FAFAD2")),e.LIGHTGRAY=u(e.fromCssColorString("#D3D3D3")),e.LIGHTGREEN=u(e.fromCssColorString("#90EE90")),e.LIGHTGREY=e.LIGHTGRAY,e.LIGHTPINK=u(e.fromCssColorString("#FFB6C1")),e.LIGHTSEAGREEN=u(e.fromCssColorString("#20B2AA")),e.LIGHTSKYBLUE=u(e.fromCssColorString("#87CEFA")),e.LIGHTSLATEGRAY=u(e.fromCssColorString("#778899")),e.LIGHTSLATEGREY=e.LIGHTSLATEGRAY,e.LIGHTSTEELBLUE=u(e.fromCssColorString("#B0C4DE")),e.LIGHTYELLOW=u(e.fromCssColorString("#FFFFE0")),e.LIME=u(e.fromCssColorString("#00FF00")),e.LIMEGREEN=u(e.fromCssColorString("#32CD32")),e.LINEN=u(e.fromCssColorString("#FAF0E6")),e.MAGENTA=u(e.fromCssColorString("#FF00FF")),e.MAROON=u(e.fromCssColorString("#800000")),e.MEDIUMAQUAMARINE=u(e.fromCssColorString("#66CDAA")),e.MEDIUMBLUE=u(e.fromCssColorString("#0000CD")),e.MEDIUMORCHID=u(e.fromCssColorString("#BA55D3")),e.MEDIUMPURPLE=u(e.fromCssColorString("#9370DB")),e.MEDIUMSEAGREEN=u(e.fromCssColorString("#3CB371")),e.MEDIUMSLATEBLUE=u(e.fromCssColorString("#7B68EE")),e.MEDIUMSPRINGGREEN=u(e.fromCssColorString("#00FA9A")),e.MEDIUMTURQUOISE=u(e.fromCssColorString("#48D1CC")),e.MEDIUMVIOLETRED=u(e.fromCssColorString("#C71585")),e.MIDNIGHTBLUE=u(e.fromCssColorString("#191970")),e.MINTCREAM=u(e.fromCssColorString("#F5FFFA")),e.MISTYROSE=u(e.fromCssColorString("#FFE4E1")),e.MOCCASIN=u(e.fromCssColorString("#FFE4B5")),e.NAVAJOWHITE=u(e.fromCssColorString("#FFDEAD")),e.NAVY=u(e.fromCssColorString("#000080")),e.OLDLACE=u(e.fromCssColorString("#FDF5E6")),e.OLIVE=u(e.fromCssColorString("#808000")),e.OLIVEDRAB=u(e.fromCssColorString("#6B8E23")),e.ORANGE=u(e.fromCssColorString("#FFA500")),e.ORANGERED=u(e.fromCssColorString("#FF4500")),e.ORCHID=u(e.fromCssColorString("#DA70D6")),e.PALEGOLDENROD=u(e.fromCssColorString("#EEE8AA")),e.PALEGREEN=u(e.fromCssColorString("#98FB98")),e.PALETURQUOISE=u(e.fromCssColorString("#AFEEEE")),e.PALEVIOLETRED=u(e.fromCssColorString("#DB7093")),e.PAPAYAWHIP=u(e.fromCssColorString("#FFEFD5")),e.PEACHPUFF=u(e.fromCssColorString("#FFDAB9")),e.PERU=u(e.fromCssColorString("#CD853F")),e.PINK=u(e.fromCssColorString("#FFC0CB")),e.PLUM=u(e.fromCssColorString("#DDA0DD")),e.POWDERBLUE=u(e.fromCssColorString("#B0E0E6")),e.PURPLE=u(e.fromCssColorString("#800080")),e.RED=u(e.fromCssColorString("#FF0000")),e.ROSYBROWN=u(e.fromCssColorString("#BC8F8F")),e.ROYALBLUE=u(e.fromCssColorString("#4169E1")),e.SADDLEBROWN=u(e.fromCssColorString("#8B4513")),e.SALMON=u(e.fromCssColorString("#FA8072")),e.SANDYBROWN=u(e.fromCssColorString("#F4A460")),e.SEAGREEN=u(e.fromCssColorString("#2E8B57")),e.SEASHELL=u(e.fromCssColorString("#FFF5EE")),e.SIENNA=u(e.fromCssColorString("#A0522D")),e.SILVER=u(e.fromCssColorString("#C0C0C0")),e.SKYBLUE=u(e.fromCssColorString("#87CEEB")),e.SLATEBLUE=u(e.fromCssColorString("#6A5ACD")),e.SLATEGRAY=u(e.fromCssColorString("#708090")),e.SLATEGREY=e.SLATEGRAY,e.SNOW=u(e.fromCssColorString("#FFFAFA")),e.SPRINGGREEN=u(e.fromCssColorString("#00FF7F")),e.STEELBLUE=u(e.fromCssColorString("#4682B4")),e.TAN=u(e.fromCssColorString("#D2B48C")),e.TEAL=u(e.fromCssColorString("#008080")),e.THISTLE=u(e.fromCssColorString("#D8BFD8")),e.TOMATO=u(e.fromCssColorString("#FF6347")),e.TURQUOISE=u(e.fromCssColorString("#40E0D0")),e.VIOLET=u(e.fromCssColorString("#EE82EE")),e.WHEAT=u(e.fromCssColorString("#F5DEB3")),e.WHITE=u(e.fromCssColorString("#FFFFFF")),e.WHITESMOKE=u(e.fromCssColorString("#F5F5F5")),e.YELLOW=u(e.fromCssColorString("#FFFF00")),e.YELLOWGREEN=u(e.fromCssColorString("#9ACD32")),e.TRANSPARENT=u(new e(0,0,0,0)),e});t("Core/ColorGeometryInstanceAttribute",["./Color","./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError"],function(n,t,i,r,u,f){"use strict";function e(t,r,u,f){t=i(t,1);r=i(r,1);u=i(u,1);f=i(f,1);this.value=new Uint8Array([n.floatToByte(t),n.floatToByte(r),n.floatToByte(u),n.floatToByte(f)])}return u(e.prototype,{componentDatatype:{get:function(){return t.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}}),e.fromColor=function(n){if(!r(n))throw new f("color is required.");return new e(n.red,n.green,n.blue,n.alpha)},e.toValue=function(n,t){if(!r(n))throw new f("color is required.");return r(t)?n.toBytes(t):new Uint8Array(n.toBytes())},e.equals=function(n,t){return n===t||r(n)&&r(t)&&n.value[0]===t.value[0]&&n.value[1]===t.value[1]&&n.value[2]===t.value[2]&&n.value[3]===t.value[3]},e});t("Core/CompressedTextureBuffer",["./defined","./defineProperties"],function(n,t){"use strict";function i(n,t,i,r){this._format=n;this._width=t;this._height=i;this._buffer=r}return t(i.prototype,{internalFormat:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}}),i.clone=function(t){return n(t)?new i(t._format,t._width,t._height,t._buffer):undefined},i.prototype.clone=function(){return i.clone(this)},i});t("Core/CoplanarPolygonGeometryLibrary",["./defined","./Cartesian2","./Cartesian3","./Check","./IntersectionTests","./Math","./Matrix3","./OrientedBoundingBox"],function(n,t,i,r,u,f,e,o){"use strict";function v(n,r,u,f,e){var o=i.subtract(n,r,y),s=i.dot(u,o),h=i.dot(f,o);return t.fromElements(s,h,e)}var s={},y=new i,h=new i,c=new i,l=new i,a=new o;return s.validOutline=function(n){r.defined("positions",n);var s=o.fromPoints(n,a),t=s.halfAxes,v=e.getColumn(t,0,h),y=e.getColumn(t,1,c),p=e.getColumn(t,2,l),w=i.magnitude(v),u=i.magnitude(y),f=i.magnitude(p);return!(w===0&&(u===0||f===0)||u===0&&f===0)},s.computeProjectTo2DArguments=function(n,t,u,f){var k,d;r.defined("positions",n);r.defined("centerResult",t);r.defined("planeAxis1Result",u);r.defined("planeAxis2Result",f);var g=o.fromPoints(n,a),w=g.halfAxes,nt=e.getColumn(w,0,h),b=e.getColumn(w,1,c),tt=e.getColumn(w,2,l),p=i.magnitude(nt),v=i.magnitude(b),y=i.magnitude(tt),s=Math.min(p,v,y);return p===0&&(v===0||y===0)||v===0&&y===0?!1:((s===v||s===y)&&(k=nt),s===p?k=b:s===y&&(d=b),(s===p||s===v)&&(d=tt),i.normalize(k,u),i.normalize(d,f),i.clone(g.center,t),!0)},s.createProjectPointsTo2DFunction=function(n,t,i){return function(r){for(var f=new Array(r.length),u=0;u<r.length;u++)f[u]=v(r[u],n,t,i);return f}},s.createProjectPointTo2DFunction=function(n,t,i){return function(r,u){return v(r,n,t,i,u)}},s});t("ThirdParty/earcut-2.1.1",[],function(){"use strict";function o(n,t,i){var u,f,c,a,e,o,w,s;i=i||2;var y=t&&t.length,p=y?t[0]*i:n.length,h=l(n,0,p,i,!0),v=[];if(!h)return v;if(y&&(h=d(n,t,h,i)),n.length>80*i){for(u=c=n[0],f=a=n[1],s=i;s<p;s+=i)e=n[s],o=n[s+1],e<u&&(u=e),o<f&&(f=o),e>c&&(c=e),o>a&&(a=o);w=Math.max(c-u,a-f)}return r(h,v,i,u,f,w),v}function l(n,i,r,u,e){var o,s;if(e===c(n,i,r,u)>0)for(o=i;o<r;o+=u)s=y(o,n[o],n[o+1],s);else for(o=r-u;o>=i;o-=u)s=y(o,n[o],n[o+1],s);return s&&t(s,s.next)&&(f(s),s=s.next),s}function i(i,r){if(!i)return i;r||(r=i);var u=i,e;do if(e=!1,!u.steiner&&(t(u,u.next)||n(u.prev,u,u.next)===0)){if(f(u),u=r=u.prev,u===u.next)return null;e=!0}else u=u.next;while(e||u!==r);return r}function r(n,t,u,e,o,s,h){if(n){!h&&s&&it(n,e,o,s);for(var l=n,a,c;n.prev!==n.next;){if(a=n.prev,c=n.next,s?w(n,e,o,s):p(n)){t.push(a.i/u);t.push(n.i/u);t.push(c.i/u);f(n);n=c.next;l=c.next;continue}if(n=c,n===l){h?h===1?(n=b(n,t,u),r(n,t,u,e,o,s,2)):h===2&&k(n,t,u,e,o,s):r(i(n),t,u,e,o,s,1);break}}}}function p(t){var r=t.prev,u=t,f=t.next,i;if(n(r,u,f)>=0)return!1;for(i=t.next.next;i!==t.prev;){if(e(r.x,r.y,u.x,u.y,f.x,f.y,i.x,i.y)&&n(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function w(t,i,r,u){var h=t.prev,c=t,o=t.next;if(n(h,c,o)>=0)return!1;for(var l=h.x<c.x?h.x<o.x?h.x:o.x:c.x<o.x?c.x:o.x,a=h.y<c.y?h.y<o.y?h.y:o.y:c.y<o.y?c.y:o.y,v=h.x>c.x?h.x>o.x?h.x:o.x:c.x>o.x?c.x:o.x,y=h.y>c.y?h.y>o.y?h.y:o.y:c.y>o.y?c.y:o.y,p=s(l,a,i,r,u),w=s(v,y,i,r,u),f=t.nextZ;f&&f.z<=w;){if(f!==t.prev&&f!==t.next&&e(h.x,h.y,c.x,c.y,o.x,o.y,f.x,f.y)&&n(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=p;){if(f!==t.prev&&f!==t.next&&e(h.x,h.y,c.x,c.y,o.x,o.y,f.x,f.y)&&n(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function b(n,i,r){var e=n,s,o;do s=e.prev,o=e.next.next,!t(s,o)&&a(s,e,e.next,o)&&u(s,o)&&u(o,s)&&(i.push(s.i/r),i.push(e.i/r),i.push(o.i/r),f(e),f(e.next),e=n=o),e=e.next;while(e!==n);return e}function k(n,t,u,f,e,o){var s=n,h,c;do{for(h=s.next.next;h!==s.prev;){if(s.i!==h.i&&ft(s,h)){c=v(s,h);s=i(s,s.next);c=i(c,c.next);r(s,t,u,f,e,o);r(c,t,u,f,e,o);return}h=h.next}s=s.next}while(s!==n)}function d(n,t,r,u){for(var o=[],h,c,e,f=0,s=t.length;f<s;f++)h=t[f]*u,c=f<s-1?t[f+1]*u:n.length,e=l(n,h,c,u,!1),e===e.next&&(e.steiner=!0),o.push(ut(e));for(o.sort(g),f=0;f<o.length;f++)nt(o[f],r),r=i(r,r.next);return r}function g(n,t){return n.x-t.x}function nt(n,t){if(t=tt(n,t),t){var r=v(t,n);i(r,r.next)}}function tt(n,t){var i=t,o=n.x,r=n.y,s=-Infinity,f,h;do{if(r<=i.y&&r>=i.next.y&&(h=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y),h<=o&&h>s)){if(s=h,h===o){if(r===i.y)return i;if(r===i.next.y)return i.next}f=i.x<i.next.x?i:i.next}i=i.next}while(i!==t);if(!f)return null;if(o===s)return f.prev;var y=f,v=f.x,l=f.y,a=Infinity,c;for(i=f.next;i!==y;)o>=i.x&&i.x>=v&&e(r<l?o:s,r,v,l,r<l?s:o,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(o-i.x),(c<a||c===a&&i.x>f.x)&&u(i,n)&&(f=i,a=c)),i=i.next;return f}function it(n,t,i,r){var u=n;do u.z===null&&(u.z=s(u.x,u.y,t,i,r)),u.prevZ=u.prev,u.nextZ=u.next,u=u.next;while(u!==n);u.prevZ.nextZ=null;u.prevZ=null;rt(u)}function rt(n){var o,i,t,r,u,s,f,e,h=1;do{for(i=n,n=null,u=null,s=0;i;){for(s++,t=i,f=0,o=0;o<h;o++)if(f++,t=t.nextZ,!t)break;for(e=h;f>0||e>0&&t;)f===0?(r=t,t=t.nextZ,e--):e!==0&&t?i.z<=t.z?(r=i,i=i.nextZ,f--):(r=t,t=t.nextZ,e--):(r=i,i=i.nextZ,f--),u?u.nextZ=r:n=r,r.prevZ=u,u=r;i=t}u.nextZ=null;h*=2}while(s>1);return n}function s(n,t,i,r,u){return n=32767*(n-i)/u,t=32767*(t-r)/u,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function ut(n){var t=n,i=n;do t.x<i.x&&(i=t),t=t.next;while(t!==n);return i}function e(n,t,i,r,u,f,e,o){return(u-e)*(t-o)-(n-e)*(f-o)>=0&&(n-e)*(r-o)-(i-e)*(t-o)>=0&&(i-e)*(f-o)-(u-e)*(r-o)>=0}function ft(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!et(n,t)&&u(n,t)&&u(t,n)&&ot(n,t)}function n(n,t,i){return(t.y-n.y)*(i.x-t.x)-(t.x-n.x)*(i.y-t.y)}function t(n,t){return n.x===t.x&&n.y===t.y}function a(i,r,u,f){return t(i,r)&&t(u,f)||t(i,f)&&t(u,r)?!0:n(i,r,u)>0!=n(i,r,f)>0&&n(u,f,i)>0!=n(u,f,r)>0}function et(n,t){var i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==t.i&&i.next.i!==t.i&&a(i,i.next,n,t))return!0;i=i.next}while(i!==n);return!1}function u(t,i){return n(t.prev,t,t.next)<0?n(t,i,t.next)>=0&&n(t,t.prev,i)>=0:n(t,i,t.prev)<0||n(t,t.next,i)<0}function ot(n,t){var i=n,r=!1,f=(n.x+t.x)/2,u=(n.y+t.y)/2;do i.y>u!=i.next.y>u&&f<(i.next.x-i.x)*(u-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==n);return r}function v(n,t){var r=new h(n.i,n.x,n.y),i=new h(t.i,t.x,t.y),u=n.next,f=t.prev;return n.next=t,t.prev=n,r.next=u,u.prev=r,i.next=r,r.prev=i,f.next=i,i.prev=f,i}function y(n,t,i,r){var u=new h(n,t,i);return r?(u.next=r.next,u.prev=r,r.next.prev=u,r.next=u):(u.prev=u,u.next=u),u}function f(n){n.next.prev=n.prev;n.prev.next=n.next;n.prevZ&&(n.prevZ.nextZ=n.nextZ);n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function h(n,t,i){this.i=n;this.x=t;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function c(n,t,i,r){for(var e=0,u=t,f=i-r;u<i;u+=r)e+=(n[f]-n[u])*(n[u+1]+n[f+1]),f=u;return e}return o.deviation=function(n,t,i,r){var h=t&&t.length,p=h?t[0]*i:n.length,f=Math.abs(c(n,0,p,i)),u,s,l,a,e;if(h)for(u=0,s=t.length;u<s;u++)l=t[u]*i,a=u<s-1?t[u+1]*i:n.length,f-=Math.abs(c(n,l,a,i));for(e=0,u=0;u<r.length;u+=3){var o=r[u]*i,v=r[u+1]*i,y=r[u+2]*i;e+=Math.abs((n[o]-n[y])*(n[v+1]-n[o+1])-(n[o]-n[v])*(n[y+1]-n[o+1]))}return f===0&&e===0?0:Math.abs((e-f)/f)},o.flatten=function(n){for(var i,r,f=n[0][0].length,u={vertices:[],holes:[],dimensions:f},e=0,t=0;t<n.length;t++){for(i=0;i<n[t].length;i++)for(r=0;r<f;r++)u.vertices.push(n[t][i][r]);t>0&&(e+=n[t-1].length,u.holes.push(e))}return u},o});t("Core/WindingOrder",["./freezeObject","./WebGLConstants"],function(n,t){"use strict";var i={CLOCKWISE:t.CW,COUNTER_CLOCKWISE:t.CCW,validate:function(n){return n===i.CLOCKWISE||n===i.COUNTER_CLOCKWISE}};return n(i)});t("Core/PolygonPipeline",["../ThirdParty/earcut-2.1.1","./Cartesian2","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./Ellipsoid","./Geometry","./GeometryAttribute","./Math","./PrimitiveType","./WindingOrder"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";var k=new i,d=new i,v={};v.computeArea2D=function(n){var i,u,f,t,e,o;for(r.defined("positions",n),r.typeOf.number.greaterThanOrEquals("positions.length",n.length,3),i=n.length,u=0,f=i-1,t=0;t<i;f=t++)e=n[f],o=n[t],u+=e.x*o.y-o.x*e.y;return u*.5};v.computeWindingOrder2D=function(n){var t=v.computeArea2D(n);return t>0?a.COUNTER_CLOCKWISE:a.CLOCKWISE};v.triangulate=function(i,u){r.defined("positions",i);var f=t.packArray(i);return n(f,u,2)};var g=new i,nt=new i,tt=new i,p=new i,w=new i,b=new i,y=new i;return v.computeSubdivision=function(n,t,o,a){var st;a=f(a,c.RADIANS_PER_DEGREE);r.typeOf.object("ellipsoid",n);r.defined("positions",t);r.defined("indices",o);r.typeOf.number.greaterThanOrEquals("indices.length",o.length,3);r.typeOf.number.equals("indices.length % 3","0",o.length%3,0);r.typeOf.number.greaterThan("granularity",a,0);for(var it=o.slice(0),wt=t.length,d=new Array(wt*3),at=0,v=0;v<wt;v++)st=t[v],d[at++]=st.x,d[at++]=st.y,d[at++]=st.z;for(var ht=[],ot={},ct=n.maximumRadius,bt=c.chordLength(a,ct),ri=bt*bt;it.length>0;){var rt=it.pop(),ut=it.pop(),ft=it.pop(),vt=i.fromArray(d,ft*3,g),yt=i.fromArray(d,ut*3,nt),pt=i.fromArray(d,rt*3,tt),kt=i.multiplyByScalar(i.normalize(vt,p),ct,p),dt=i.multiplyByScalar(i.normalize(yt,w),ct,w),gt=i.multiplyByScalar(i.normalize(pt,b),ct,b),ni=i.magnitudeSquared(i.subtract(kt,dt,y)),ti=i.magnitudeSquared(i.subtract(dt,gt,y)),ii=i.magnitudeSquared(i.subtract(gt,kt,y)),lt=Math.max(ni,ti,ii),et,k;lt>ri?ni===lt?(et=Math.min(ft,ut)+" "+Math.max(ft,ut),v=ot[et],e(v)||(k=i.add(vt,yt,y),i.multiplyByScalar(k,.5,k),d.push(k.x,k.y,k.z),v=d.length/3-1,ot[et]=v),it.push(ft,v,rt),it.push(v,ut,rt)):ti===lt?(et=Math.min(ut,rt)+" "+Math.max(ut,rt),v=ot[et],e(v)||(k=i.add(yt,pt,y),i.multiplyByScalar(k,.5,k),d.push(k.x,k.y,k.z),v=d.length/3-1,ot[et]=v),it.push(ut,v,ft),it.push(v,rt,ft)):ii===lt&&(et=Math.min(rt,ft)+" "+Math.max(rt,ft),v=ot[et],e(v)||(k=i.add(pt,vt,y),i.multiplyByScalar(k,.5,k),d.push(k.x,k.y,k.z),v=d.length/3-1,ot[et]=v),it.push(rt,v,ut),it.push(v,ft,ut)):(ht.push(ft),ht.push(ut),ht.push(rt))}return new s({attributes:{position:new h({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:d})},indices:ht,primitiveType:l.TRIANGLES})},v.scaleToGeodeticHeight=function(n,t,r,u){var c,s,l,h;if(r=f(r,o.WGS84),c=k,s=d,t=f(t,0),u=f(u,!0),e(n))for(l=n.length,h=0;h<l;h+=3)i.fromArray(n,h,s),u&&(s=r.scaleToGeodeticSurface(s,s)),t!==0&&(c=r.geodeticSurfaceNormal(s,c),i.multiplyByScalar(c,t,c),i.add(s,c,s)),n[h]=s.x,n[h+1]=s.y,n[h+2]=s.z;return n},v});t("Core/Queue",["./defineProperties"],function(n){"use strict";function t(){this._array=[];this._offset=0;this._length=0}return n(t.prototype,{length:{get:function(){return this._length}}}),t.prototype.enqueue=function(n){this._array.push(n);this._length++},t.prototype.dequeue=function(){if(this._length===0)return undefined;var t=this._array,n=this._offset,i=t[n];return t[n]=undefined,n++,n>10&&n*2>t.length&&(this._array=t.slice(n),n=0),this._offset=n,this._length--,i},t.prototype.peek=function(){return this._length===0?undefined:this._array[this._offset]},t.prototype.contains=function(n){return this._array.indexOf(n)!==-1},t.prototype.clear=function(){this._array.length=this._offset=this._length=0},t.prototype.sort=function(n){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0);this._array.sort(n)},t});t("Core/PolygonGeometryLibrary",["./arrayRemoveDuplicates","./Cartesian2","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryPipeline","./IndexDatatype","./Math","./Matrix3","./PolygonPipeline","./PrimitiveType","./Quaternion","./Queue","./WindingOrder"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function nt(n,t,r,u){return i.subtract(t,n,g),i.multiplyByScalar(g,r/u,g),i.add(n,g,g),[g.x,g.y,g.z]}var d={},g;d.computeHierarchyPackedLength=function(n){for(var e=0,o=[n],t,s,r,h,u;o.length>0;)if((t=o.pop(),f(t))&&(e+=2,s=t.positions,r=t.holes,f(s)&&(e+=s.length*i.packedLength),f(r)))for(h=r.length,u=0;u<h;++u)o.push(r[u]);return e};d.packPolygonHierarchy=function(n,t,r){for(var c=[n],o,u,e,l,s,a,h;c.length>0;)if(o=c.pop(),f(o)){if(u=o.positions,e=o.holes,t[r++]=f(u)?u.length:0,t[r++]=f(e)?e.length:0,f(u))for(l=u.length,s=0;s<l;++s,r+=3)i.pack(u[s],t,r);if(f(e))for(a=e.length,h=0;h<a;++h)c.push(e[h])}return r};d.unpackPolygonHierarchy=function(n,t){for(var r,o=n[t++],f=n[t++],s=new Array(o),u=f>0?new Array(f):undefined,e=0;e<o;++e,t+=i.packedLength)s[e]=i.unpack(n,t);for(r=0;r<f;++r)u[r]=d.unpackPolygonHierarchy(n,t),t=u[r].startingIndex,delete u[r].startingIndex;return{positions:s,holes:u,startingIndex:t}};g=new i;d.subdivideLineCount=function(n,t,r){var u=i.distance(n,t),f=u/r,e=Math.max(0,Math.ceil(Math.log(f)/Math.log(2)));return Math.pow(2,e)};d.subdivideLine=function(n,t,r,u){var c=d.subdivideLineCount(n,t,r),l=i.distance(n,t),a=l/c,e,o,s,h;for(f(u)||(u=[]),e=u,e.length=c*3,o=0,s=0;s<c;s++)h=nt(n,t,s*a,l),e[o++]=h[0],e[o++]=h[1],e[o++]=h[2];return e};var tt=new i,it=new i,rt=new i,ut=new i;d.scaleToGeodeticHeightExtruded=function(n,t,r,o,s){var l,v,c;o=u(o,e.WGS84);var p=tt,h=it,y=rt,a=ut;if(f(n)&&f(n.attributes)&&f(n.attributes.position))for(l=n.attributes.position.values,v=l.length/2,c=0;c<v;c+=3)i.fromArray(l,c,y),o.geodeticSurfaceNormal(y,p),a=o.scaleToGeodeticSurface(y,a),h=i.multiplyByScalar(p,r,h),h=i.add(a,h,h),l[c+v]=h.x,l[c+1+v]=h.y,l[c+2+v]=h.z,s&&(a=i.clone(y,a)),h=i.multiplyByScalar(p,t,h),h=i.add(a,h,h),l[c]=h.x,l[c+1]=h.y,l[c+2]=h.z;return n};d.polygonOutlinesFromHierarchy=function(t,r,u){var y=[],a=new b,e,o,v,c,s,w,l,h,p;for(a.enqueue(t);a.length!==0;){if(c=a.dequeue(),s=c.positions,r)for(v=s.length,e=0;e<v;e++)u.scaleToGeodeticSurface(s[e],s[e]);if(s=n(s,i.equalsEpsilon,!0),!(s.length<3)){for(w=c.holes?c.holes.length:0,e=0;e<w;e++){if(l=c.holes[e],h=l.positions,r)for(v=h.length,o=0;o<v;++o)u.scaleToGeodeticSurface(h[o],h[o]);if(h=n(h,i.equalsEpsilon,!0),!(h.length<3))for(y.push(h),p=0,f(l.holes)&&(p=l.holes.length),o=0;o<p;o++)a.enqueue(l.holes[o])}y.push(s)}}return y};d.polygonsFromHierarchy=function(t,r,u,e){var rt=[],ut=[],p=new b,l,tt,d,a,o,v,it;for(p.enqueue(t);p.length!==0;){var ft=p.dequeue(),s=ft.positions,nt=ft.holes,h,w;if(u)for(w=s.length,h=0;h<w;h++)e.scaleToGeodeticSurface(s[h],s[h]);if((s=n(s,i.equalsEpsilon,!0),!(s.length<3))&&(l=r(s),f(l))){tt=[];d=y.computeWindingOrder2D(l);d===k.CLOCKWISE&&(l.reverse(),s=s.slice().reverse());var g=s.slice(),ot=f(nt)?nt.length:0,et=[],c;for(h=0;h<ot;h++){if(a=nt[h],o=a.positions,u)for(w=o.length,c=0;c<w;++c)e.scaleToGeodeticSurface(o[c],o[c]);if((o=n(o,i.equalsEpsilon,!0),!(o.length<3))&&(v=r(o),f(v)))for(d=y.computeWindingOrder2D(v),d===k.CLOCKWISE&&(v.reverse(),o=o.slice().reverse()),et.push(o),tt.push(g.length),g=g.concat(o),l=l.concat(v),it=0,f(a.holes)&&(it=a.holes.length),c=0;c<it;c++)p.enqueue(a.holes[c])}rt.push({outerRing:s,holes:et});ut.push({positions:g,positions2D:l,holes:tt})}}return{hierarchy:rt,polygons:ut}};var ft=new t,et=new i,ot=new w,st=new v;d.computeBoundingRectangle=function(n,t,r,u,e){for(var c,o,p=w.fromAxisAngle(n,u,ot),b=v.fromQuaternion(p,st),s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,k=r.length,y=0;y<k;++y)c=i.clone(r[y],et),v.multiplyByVector(b,c,c),o=t(c,ft),f(o)&&(s=Math.min(s,o.x),l=Math.max(l,o.x),h=Math.min(h,o.y),a=Math.max(a,o.y));return e.x=s,e.y=h,e.width=l-s,e.height=a-h,e};d.createGeometryFromPositions=function(n,t,i,u,f){var e=y.triangulate(t.positions2D,t.holes),h,a,v,b;if(e.length<3&&(e=[0,1,2]),h=t.positions,u){var k=h.length,l=new Array(k*3),w=0;for(a=0;a<k;a++)v=h[a],l[w++]=v.x,l[w++]=v.y,l[w++]=v.z;return(b=new o({attributes:{position:new s({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:l})},indices:e,primitiveType:p.TRIANGLES}),f.normal)?c.computeNormal(b):b}return y.computeSubdivision(n,h,e,i)};var ht=[],ct=new i,lt=new i;return d.computeWallGeometry=function(n,t,u,f){var c,y,v,k,w,b=n.length,e=0,ut,ft,it,st,tt,g,nt;if(f)for(y=b*6,c=new Array(y*2),v=0;v<b;v++)k=n[v],w=n[(v+1)%b],c[e]=c[e+y]=k.x,++e,c[e]=c[e+y]=k.y,++e,c[e]=c[e+y]=k.z,++e,c[e]=c[e+y]=w.x,++e,c[e]=c[e+y]=w.y,++e,c[e]=c[e+y]=w.z,++e;else{for(ut=a.chordLength(u,t.maximumRadius),ft=0,v=0;v<b;v++)ft+=d.subdivideLineCount(n[v],n[(v+1)%b],ut);for(y=(ft+b)*3,c=new Array(y*2),v=0;v<b;v++){for(k=n[v],w=n[(v+1)%b],it=d.subdivideLine(k,w,ut,ht),st=it.length,tt=0;tt<st;++tt,++e)c[e]=it[tt],c[e+y]=it[tt];c[e]=w.x;c[e+y]=w.x;++e;c[e]=w.y;c[e+y]=w.y;++e;c[e]=w.z;c[e+y]=w.z;++e}}for(b=c.length,g=l.createTypedArray(b/3,b-n.length*6),nt=0,b/=6,v=0;v<b;v++){var rt=v,et=rt+1,ot=rt+b,at=ot+1;(k=i.fromArray(c,rt*3,ct),w=i.fromArray(c,et*3,lt),i.equalsEpsilon(k,w,a.EPSILON14))||(g[nt++]=rt,g[nt++]=ot,g[nt++]=et,g[nt++]=et,g[nt++]=ot,g[nt++]=at)}return new o({attributes:new h({position:new s({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:c})}),indices:g,primitiveType:p.TRIANGLES})},d});t("Core/CoplanarPolygonGeometry",["./arrayRemoveDuplicates","./BoundingRectangle","./BoundingSphere","./Cartesian2","./Cartesian3","./Check","./ComponentDatatype","./CoplanarPolygonGeometryLibrary","./defaultValue","./defined","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryInstance","./GeometryPipeline","./IndexDatatype","./Math","./Matrix3","./PolygonGeometryLibrary","./PolygonPipeline","./PrimitiveType","./Quaternion","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function kt(n,t,i,f,o,s,h,v){var kt=n.positions,rt=d.triangulate(n.positions2D,n.holes),dt,k,ut,fi,ft,pt,tt,oi,it,si,hi,y;rt.length<3&&(rt=[0,1,2]);dt=p.createTypedArray(kt.length,rt.length);dt.set(rt);k=wt;f!==0?(ut=nt.fromAxisAngle(s,f,et),k=b.fromQuaternion(ut,k),(t.tangent||t.bitangent)&&(ut=nt.fromAxisAngle(s,-f,et),fi=b.fromQuaternion(ut,bt),h=u.normalize(b.multiplyByVector(fi,h,h),h),t.bitangent&&(v=u.normalize(u.cross(s,h,v),v)))):k=b.clone(b.IDENTITY,k);ft=at;t.st&&(ft.x=i.x,ft.y=i.y);var gt=kt.length,ot=gt*3,st=new Float64Array(ot),ct=t.normal?new Float32Array(ot):undefined,vt=t.tangent?new Float32Array(ot):undefined,yt=t.bitangent?new Float32Array(ot):undefined,ni=t.st?new Float32Array(gt*2):undefined,ti=0,ii=0,ri=0,ui=0,ei=0;for(pt=0;pt<gt;pt++)tt=kt[pt],st[ti++]=tt.x,st[ti++]=tt.y,st[ti++]=tt.z,t.st&&(oi=b.multiplyByVector(k,tt,ht),it=o(oi,lt),r.subtract(it,ft,it),si=w.clamp(it.x/i.width,0,1),hi=w.clamp(it.y/i.height,0,1),ni[ei++]=si,ni[ei++]=hi),t.normal&&(ct[ii++]=s.x,ct[ii++]=s.y,ct[ii++]=s.z),t.tangent&&(vt[ui++]=h.x,vt[ui++]=h.y,vt[ui++]=h.z),t.bitangent&&(yt[ri++]=v.x,yt[ri++]=v.y,yt[ri++]=v.z);return y=new a,t.position&&(y.position=new l({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:st})),t.normal&&(y.normal=new l({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ct})),t.tangent&&(y.tangent=new l({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:vt})),t.bitangent&&(y.bitangent=new l({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:yt})),t.st&&(y.st=new l({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:ni})),new c({attributes:y,indices:dt,primitiveType:g.TRIANGLES})}function it(n){var t,i;n=s(n,s.EMPTY_OBJECT);t=n.polygonHierarchy;f.defined("options.polygonHierarchy",t);i=s(n.vertexFormat,tt.DEFAULT);this._vertexFormat=tt.clone(i);this._polygonHierarchy=t;this._stRotation=s(n.stRotation,0);this._workerName="createCoplanarPolygonGeometry";this.packedLength=k.computeHierarchyPackedLength(t)+tt.packedLength+2}var ht=new u,ct=new t,lt=new r,at=new r,vt=new u,yt=new u,pt=new u,ft=new u,rt=new u,ut=new u,et=new nt,wt=new b,bt=new b,ot,st;return it.fromPositions=function(n){n=s(n,s.EMPTY_OBJECT);f.defined("options.positions",n.positions);var t={polygonHierarchy:{positions:n.positions},vertexFormat:n.vertexFormat,stRotation:n.stRotation};return new it(t)},it.pack=function(n,t,i){return f.typeOf.object("value",n),f.defined("array",t),i=s(i,0),i=k.packPolygonHierarchy(n._polygonHierarchy,t,i),tt.pack(n._vertexFormat,t,i),i+=tt.packedLength,t[i++]=n._stRotation,t[i]=n.packedLength,t},ot=new tt,st={polygonHierarchy:{}},it.unpack=function(n,t,i){var r,u,e,o;return f.defined("array",n),t=s(t,0),r=k.unpackPolygonHierarchy(n,t),t=r.startingIndex,delete r.startingIndex,u=tt.unpack(n,t,ot),t+=tt.packedLength,e=n[t++],o=n[t],h(i)||(i=new it(st)),i._polygonHierarchy=r,i._vertexFormat=tt.clone(u,i._vertexFormat),i._stRotation=e,i.packedLength=o,i},it.createGeometry=function(t){var s=t._vertexFormat,d=t._polygonHierarchy,g=t._stRotation,f=d.positions,nt,w,h,st,r,b;if(f=n(f,u.equalsEpsilon,!0),!(f.length<3)){var e=vt,l=yt,a=pt,ht=o.computeProjectTo2DArguments(f,ft,rt,ut);if(!ht)return undefined;nt=o.createProjectPointsTo2DFunction(ft,rt,ut);w=o.createProjectPointTo2DFunction(ft,rt,ut);e=u.cross(rt,ut,e);e=u.normalize(e,e);s.tangent&&(l=u.clone(rt,l));s.bitangent&&(a=u.clone(ut,a));var tt=k.polygonsFromHierarchy(d,nt,!1),it=tt.hierarchy,et=tt.polygons;if(it.length!==0){f=it[0].outerRing;var lt=i.fromPoints(f),at=k.computeBoundingRectangle(e,w,f,g,ct),ot=[];for(h=0;h<et.length;h++)st=new v({geometry:kt(et[h],s,at,g,w,e,l,a)}),ot.push(st);return r=y.combineInstances(ot)[0],r.attributes.position.values=new Float64Array(r.attributes.position.values),r.indices=p.createTypedArray(r.attributes.position.values.length/3,r.indices),b=r.attributes,s.position||delete b.position,new c({attributes:b,indices:r.indices,primitiveType:r.primitiveType,boundingSphere:lt})}}},it});t("Core/CoplanarPolygonOutlineGeometry",["./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./CoplanarPolygonGeometryLibrary","./defaultValue","./defined","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryInstance","./GeometryPipeline","./IndexDatatype","./PolygonGeometryLibrary","./PolygonPipeline","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function k(n){for(var f,a,t=n.length,r=new Float64Array(t*3),e=v.createTypedArray(t,t*2),o=0,l=0,i=0;i<t;i++)f=n[i],r[o++]=f.x,r[o++]=f.y,r[o++]=f.z,e[l++]=i,e[l++]=(i+1)%t;return a=new c({position:new h({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:r})}),new s({attributes:a,indices:e,primitiveType:w.LINES})}function b(n){n=e(n,e.EMPTY_OBJECT);var t=n.polygonHierarchy;r.defined("options.polygonHierarchy",t);this._polygonHierarchy=t;this._workerName="createCoplanarPolygonOutlineGeometry";this.packedLength=y.computeHierarchyPackedLength(t)+1}b.fromPositions=function(n){n=e(n,e.EMPTY_OBJECT);r.defined("options.positions",n.positions);var t={polygonHierarchy:{positions:n.positions}};return new b(t)};b.pack=function(n,t,i){return r.typeOf.object("value",n),r.defined("array",t),i=e(i,0),i=y.packPolygonHierarchy(n._polygonHierarchy,t,i),t[i]=n.packedLength,t};var d={polygonHierarchy:{}};return b.unpack=function(n,t,i){var u,f;return r.defined("array",n),t=e(t,0),u=y.unpackPolygonHierarchy(n,t),t=u.startingIndex,delete u.startingIndex,f=n[t],o(i)||(i=new b(d)),i._polygonHierarchy=u,i.packedLength=f,i},b.createGeometry=function(r){var c=r._polygonHierarchy,u=c.positions,p,e,v,o,w,h,b;if(u=n(u,i.equalsEpsilon,!0),!(u.length<3)){if((p=f.validOutline(u),!p)||(e=y.polygonOutlinesFromHierarchy(c,!1),e.length===0))return undefined;for(v=[],o=0;o<e.length;o++)w=new l({geometry:k(e[o])}),v.push(w);return h=a.combineInstances(v)[0],b=t.fromPoints(c.positions),new s({attributes:h.attributes,indices:h.indices,primitiveType:h.primitiveType,boundingSphere:b})}},b});t("Core/CornerType",["./freezeObject"],function(n){"use strict";return n({ROUNDED:0,MITERED:1,BEVELED:2})});t("Core/EllipsoidGeodesic",["./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./defineProperties","./Ellipsoid","./Math"],function(n,t,i,r,u,f,e,o){"use strict";function a(n){var nt=n._uSquared,o=n._ellipsoid.maximumRadius,l=n._ellipsoid.minimumRadius,a=(o-l)/o,v=Math.cos(n._startHeading),y=Math.sin(n._startHeading),f=(1-a)*Math.tan(n._start.latitude),s=1/Math.sqrt(1+f*f),tt=s*f,u=Math.atan2(f,v),h=s*y,p=h*h,w=1-p,it=Math.sqrt(w),i=nt/4,r=i*i,e=r*i,c=r*r,b=1+i-3*r/4+5*e/4-175*c/64,k=1-i+15*r/8-35*e/8,d=1-3*i+35*r/4,g=1-5*i,rt=b*u-k*Math.sin(2*u)*i/2-d*Math.sin(4*u)*r/16-g*Math.sin(6*u)*e/48-Math.sin(8*u)*5*c/512,t=n._constants;t.a=o;t.b=l;t.f=a;t.cosineHeading=v;t.sineHeading=y;t.tanU=f;t.cosineU=s;t.sineU=tt;t.sigma=u;t.sineAlpha=h;t.sineSquaredAlpha=p;t.cosineSquaredAlpha=w;t.cosineAlpha=it;t.u2Over4=i;t.u4Over16=r;t.u6Over64=e;t.u8Over256=c;t.a0=b;t.a1=k;t.a2=d;t.a3=g;t.distanceRatio=rt}function v(n,t){return n*t*(4+n*(4-3*t))/16}function c(n,t,i,r,u,f,e){var o=v(n,i);return(1-o)*n*t*(r+o*u*(e+o*f*(2*e*e-1)))}function y(n,t,i,r,u,f,e){var d=(t-i)/t,ft=f-r,et=Math.atan((1-d)*Math.tan(u)),ot=Math.atan((1-d)*Math.tan(e)),g=Math.cos(et),st=Math.sin(et),y=Math.cos(ot),ht=Math.sin(ot),ct=g*y,nt=g*ht,lt=st*ht,tt=st*y,a=ft,at=o.TWO_PI,p=Math.cos(a),v=Math.sin(a),it,w,h,b,l,rt,k;do p=Math.cos(a),v=Math.sin(a),rt=nt-tt*p,h=Math.sqrt(y*y*v*v+rt*rt),w=lt+ct*p,it=Math.atan2(h,w),h===0?(k=0,b=1):(k=ct*v/h,b=1-k*k),at=a,l=w-2*lt/b,isNaN(l)&&(l=0),a=ft+c(d,k,b,it,h,w,l);while(Math.abs(a-at)>o.EPSILON12);var s=b*(t*t-i*i)/(i*i),yt=1+s*(4096+s*(s*(320-175*s)-768))/16384,ut=s*(256+s*(s*(74-47*s)-128))/1024,vt=l*l,pt=ut*h*(l+ut*(w*(2*vt-1)-ut*l*(4*h*h-3)*(4*vt-3)/6)/4),wt=i*yt*(it-pt),bt=Math.atan2(y*v,nt-tt*p),kt=Math.atan2(g*v,nt*p-tt);n._distance=wt;n._startHeading=bt;n._endHeading=kt;n._uSquared=s}function l(r,u,f,e){var o=n.normalize(e.cartographicToCartesian(u,h),p),s=n.normalize(e.cartographicToCartesian(f,h),h);i.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(n.angleBetween(o,s))-Math.PI),.0125);y(r,e.maximumRadius,e.minimumRadius,u.longitude,u.latitude,f.longitude,f.latitude);r._start=t.clone(u,r._start);r._end=t.clone(f,r._end);r._start.height=0;r._end.height=0;a(r)}function s(n,i,f){var o=r(f,e.WGS84);this._ellipsoid=o;this._start=new t;this._end=new t;this._constants={};this._startHeading=undefined;this._endHeading=undefined;this._distance=undefined;this._uSquared=undefined;u(n)&&u(i)&&l(this,n,i,o)}var p=new n,h=new n;return f(s.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){return i.defined("distance",this._distance),this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){return i.defined("distance",this._distance),this._startHeading}},endHeading:{get:function(){return i.defined("distance",this._distance),this._endHeading}}}),s.prototype.setEndPoints=function(n,t){i.defined("start",n);i.defined("end",t);l(this,n,t,this._ellipsoid)},s.prototype.interpolateUsingFraction=function(n,t){return this.interpolateUsingSurfaceDistance(this._distance*n,t)},s.prototype.interpolateUsingSurfaceDistance=function(n,r){i.defined("distance",this._distance);var f=this._constants,e=f.distanceRatio+n/f.b,v=Math.cos(2*e),nt=Math.cos(4*e),tt=Math.cos(6*e),y=Math.sin(2*e),p=Math.sin(4*e),it=Math.sin(6*e),rt=Math.sin(8*e),w=e*e,ut=e*w,o=f.u8Over256,b=f.u2Over4,s=f.u6Over64,l=f.u4Over16,h=2*ut*o*v/3+e*(1-b+7*l/4-15*s/4+579*o/64-(l-15*s/4+187*o/16)*v-(5*s/4-115*o/16)*nt-29*o*tt/16)+(b/2-l+71*s/32-85*o/16)*y+(5*l/16-5*s/4+383*o/96)*p-w*((s-11*o/2)*y+5*o*p/2)+(29*s/96-29*o/16)*it+539*o*rt/1536,ft=Math.asin(Math.sin(h)*f.cosineAlpha),k=Math.atan(f.a/f.b*Math.tan(ft));h=h-f.sigma;var et=Math.cos(2*f.sigma+h),a=Math.sin(h),d=Math.cos(h),ot=f.cosineU*d,st=f.sineU*a,ht=Math.atan2(a*f.sineHeading,ot-st*f.cosineHeading),g=ht-c(f.f,f.sineAlpha,f.cosineSquaredAlpha,h,a,d,et);return u(r)?(r.longitude=this._start.longitude+g,r.latitude=k,r.height=0,r):new t(this._start.longitude+g,k,0)},s});t("Core/PolylinePipeline",["./Cartesian3","./Cartographic","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./EllipsoidGeodesic","./IntersectionTests","./isArray","./Math","./Matrix4","./Plane"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function ot(n,t,i){var u=k,r,f,e,o;if(u.length=n,t===i){for(r=0;r<n;r++)u[r]=t;return u}for(f=i-t,e=f/n,r=0;r<n;r++)o=t+r*e,u[r]=o;return u}function ht(t,i,r,u,f,e,o,s){var tt=u.scaleToGeodeticSurface(t,nt),it=u.scaleToGeodeticSurface(i,st),p=a.numberOfPoints(t,i,r),w=u.cartesianToCartographic(tt,d),rt=u.cartesianToCartographic(it,g),ut=ot(p,f,e),k,h,l,c,b;for(y.setEndPoints(w,rt),k=y.surfaceDistance/p,h=s,w.height=f,l=u.cartographicToCartesian(w,v),n.pack(l,o,h),h+=3,c=1;c<p;c++)b=y.interpolateUsingSurfaceDistance(c*k,g),b.height=ut[c],l=u.cartographicToCartesian(b,v),n.pack(l,o,h),h+=3;return h}var a={},p;a.numberOfPoints=function(t,i,r){var u=n.distance(t,i);return Math.ceil(u/r)};p=new t;a.extractHeights=function(n,t){for(var f,r=n.length,u=new Array(r),i=0;i<r;i++)f=n[i],u[i]=t.cartesianToCartographic(f,p).height;return u};var tt=new c,it=new n,w=new n,rt=new l(n.UNIT_X,0),b=new n,ut=new l(n.UNIT_X,0),ft=new n,et=new n,k=[];var d=new t,g=new t,v=new n,nt=new n,st=new n,y=new e;return a.wrapLongitude=function(t,u){var e=[],p=[],s,st,h,v,y,f;if(r(t)&&t.length>0){u=i(u,c.IDENTITY);var k=c.inverseTransformation(u,tt),d=c.multiplyByPoint(k,n.ZERO,it),g=n.normalize(c.multiplyByPointAsVector(k,n.UNIT_Y,w),w),nt=l.fromPointNormal(d,g,rt),ht=n.normalize(c.multiplyByPointAsVector(k,n.UNIT_X,b),b),ot=l.fromPointNormal(d,ht,ut),a=1;for(e.push(n.clone(t[0])),s=e[0],st=t.length,h=1;h<st;++h)v=t[h],(l.getPointDistance(ot,s)<0||l.getPointDistance(ot,v)<0)&&(y=o.lineSegmentPlane(s,v,nt,ft),r(y)&&(f=n.multiplyByScalar(g,5e-9,et),l.getPointDistance(nt,s)<0&&n.negate(f,f),e.push(n.add(y,f,new n)),p.push(a+1),n.negate(f,f),e.push(n.add(y,f,new n)),a=1)),e.push(n.clone(t[h])),a++,s=v;p.push(a)}return{positions:e,lengths:p}},a.generateArc=function(t){var c,l,g,w,ut,tt,o,ot,rt,st;if(r(t)||(t={}),c=t.positions,!r(c))throw new u("options.positions is required.");var y=c.length,p=i(t.ellipsoid,f.WGS84),e=i(t.height,0),b=s(e);if(y<1)return[];if(y===1)return l=p.scaleToGeodeticSurface(c[0],nt),e=b?e[0]:e,e!==0&&(g=p.geodeticSurfaceNormal(l,v),n.multiplyByScalar(g,e,g),n.add(l,g,l)),[l.x,l.y,l.z];for(w=t.minDistance,r(w)||(ut=i(t.granularity,h.RADIANS_PER_DEGREE),w=h.chordLength(ut,p.maximumRadius)),tt=0,o=0;o<y-1;o++)tt+=a.numberOfPoints(c[o],c[o+1],w);var ft=(tt+1)*3,it=new Array(ft),et=0;for(o=0;o<y-1;o++){var ct=c[o],lt=c[o+1],at=b?e[o]:e,vt=b?e[o+1]:e;et=ht(ct,lt,w,p,at,vt,it,et)}return k.length=0,ot=c[y-1],rt=p.cartesianToCartographic(ot,d),rt.height=b?e[y-1]:e,st=p.cartographicToCartesian(rt,v),n.pack(st,it,ft-3),it},a.generateCartesianArc=function(t){for(var r=a.generateArc(t),u=r.length/3,f=new Array(u),i=0;i<u;i++)f[i]=n.unpack(r,i*3);return f},a});t("Core/PolylineVolumeGeometryLibrary",["./Cartesian2","./Cartesian3","./Cartesian4","./Cartographic","./CornerType","./EllipsoidTangentPlane","./Math","./Matrix3","./Matrix4","./PolylinePipeline","./Quaternion","./Transforms"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function gt(n,t){for(var r,u=new Array(n.length),i=0;i<n.length;i++)r=n[i],g=t.cartesianToCartographic(r,g),u[i]=g.height,n[i]=t.scaleToGeodeticSurface(r,r);return u}function nt(n,i,r,u){var l=n[0],a=n[1],v=t.angleBetween(l,a),o=Math.ceil(v/u),e=new Array(o),f,s,h,c;if(i===r){for(f=0;f<o;f++)e[f]=i;return e.push(r),e}for(s=r-i,h=s/o,f=1;f<o;f++)c=i+f*h,e[f]=c;return e[0]=i,e.push(r),e}function ni(i,r,u,e){var h=new f(u,e),o=h.projectPointOntoPlane(t.add(u,i,k),k),s=h.projectPointOntoPlane(t.add(u,r,d),d),c=n.angleBetween(o,s);return s.x*o.y-s.y*o.x>=0?-c:c}function v(n,i,r,u,f,e,h,c){var v=ui,a=fi,k,w,b,p;for(y=l.eastNorthUpToFixedFrame(n,f,y),v=s.multiplyByPointAsVector(y,ti,v),v=t.normalize(v,v),k=ni(v,i,n,f),tt=o.fromRotationZ(k,tt),rt.z=e,y=s.multiplyTransformation(y,s.fromRotationTranslation(tt,rt,ii),y),w=ri,w[0]=h,b=0;b<c;b++)for(p=0;p<r.length;p+=3)a=t.fromArray(r,p,a),a=o.multiplyByVector(w,a,a),a=s.multiplyByPoint(y,a,a),u.push(a.x,a.y,a.z);return u}function it(n,i,r,u,f,e,o){for(var h,s=0;s<n.length;s+=3)h=t.fromArray(n,s,ei),u=v(h,i,r,u,f,e[s/3],o,1);return u}function oi(n,t){var c=n.length,i=new Array(c*6),r=0,e=t.x+t.width/2,o=t.y+t.height/2,u=n[0],f,s,h;for(i[r++]=u.x-e,i[r++]=0,i[r++]=u.y-o,f=1;f<c;f++)u=n[f],s=u.x-e,h=u.y-o,i[r++]=s,i[r++]=0,i[r++]=h,i[r++]=s,i[r++]=0,i[r++]=h;return u=n[0],i[r++]=u.x-e,i[r++]=0,i[r++]=u.y-o,i}function ut(n,t){for(var f=n.length,i=new Array(f*3),u=0,e=t.x+t.width/2,o=t.y+t.height/2,r=0;r<f;r++)i[u++]=n[r].x-e,i[u++]=0,i[u++]=n[r].y-o;return i}function st(n,i,r,f,s,h,l,a,y,w){var nt=t.angleBetween(t.subtract(i,n,p),t.subtract(r,n,b)),g=f===u.BEVELED?0:Math.ceil(nt/e.toRadians(5)),it,k,d,rt,tt;if(it=s?o.fromQuaternion(c.fromAxisAngle(t.negate(n,p),nt/(g+1),ft),ot):o.fromQuaternion(c.fromAxisAngle(n,nt/(g+1),ft),ot),i=t.clone(i,et),g>0)for(rt=w?2:1,tt=0;tt<g;tt++)i=o.multiplyByVector(it,i,i),k=t.subtract(i,n,p),k=t.normalize(k,k),s||(k=t.negate(k,k)),d=h.scaleToGeodeticSurface(i,b),l=v(d,k,a,l,h,y,1,rt);else k=t.subtract(i,n,p),k=t.normalize(k,k),s||(k=t.negate(k,k)),d=h.scaleToGeodeticSurface(i,b),l=v(d,k,a,l,h,y,1,1),r=t.clone(r,et),k=t.subtract(r,n,p),k=t.normalize(k,k),s||(k=t.negate(k,k)),d=h.scaleToGeodeticSurface(r,b),l=v(d,k,a,l,h,y,1,1);return l}var a=[new t,new t],lt=new t,at=new t,vt=new t,yt=new t,pt=new t,wt=new t,bt=new t,kt=new t,dt=new t,p=new t,b=new t,w={},g=new r,k=new t,d=new t,ti=new t(-1,0,0),y=new s,ii=new s,tt=new o,ri=o.IDENTITY.clone(),ui=new t,fi=new i,rt=new t,ei=new t,ft=new c,et=new t,ot=new o,ht,ct;return w.removeDuplicatesFromShape=function(t){for(var o,r,u=t.length,f=[],e=u-1,i=0;i<u;e=i++)o=t[e],r=t[i],n.equals(o,r)||f.push(r);return f},w.angleIsGreaterThanPi=function(n,i,r,u){var e=new f(r,u),o=e.projectPointOntoPlane(t.add(r,n,k),k),s=e.projectPointOntoPlane(t.add(r,i,d),d);return s.x*o.y-s.y*o.x>=0},ht=new t,ct=new t,w.computePositions=function(n,i,r,f,o){var y=f._ellipsoid,ki=gt(n,y),ri=f._granularity,ui=f._cornerType,ti=o?oi(i,r):ut(i,r),gi=o?ut(i,r):undefined,d=r.height/2,fi=r.width/2,ai=n.length,b=[],ei=o?[]:undefined,l=lt,ni=at,c=vt,g=yt,ft=pt,et=wt,ot=bt,s=kt,tt=dt,k=n[0],vi=n[1],ii,rt,si,hi,yi,di,ci,li,nr,pi,wi,tr,bi;for(g=y.geodeticSurfaceNormal(k,g),l=t.subtract(vi,k,l),l=t.normalize(l,l),s=t.cross(g,l,s),s=t.normalize(s,s),ii=ki[0],rt=ki[1],o&&(ei=v(k,s,gi,ei,y,ii+d,1,1)),tt=t.clone(k,tt),k=vi,ni=t.negate(l,ni),yi=1;yi<ai-1;yi++)di=o?2:1,vi=n[yi+1],l=t.subtract(vi,k,l),l=t.normalize(l,l),c=t.add(l,ni,c),c=t.normalize(c,c),g=y.geodeticSurfaceNormal(k,g),ci=t.multiplyByScalar(g,t.dot(l,g),ht),t.subtract(l,ci,ci),t.normalize(ci,ci),li=t.multiplyByScalar(g,t.dot(ni,g),ct),t.subtract(ni,li,li),t.normalize(li,li),nr=!e.equalsEpsilon(Math.abs(t.dot(ci,li)),1,e.EPSILON7),nr?(c=t.cross(c,g,c),c=t.cross(g,c,c),c=t.normalize(c,c),pi=1/Math.max(.25,t.magnitude(t.cross(c,ni,p))),wi=w.angleIsGreaterThanPi(l,ni,k,y),wi?(ft=t.add(k,t.multiplyByScalar(c,pi*fi,c),ft),et=t.add(ft,t.multiplyByScalar(s,fi,et),et),a[0]=t.clone(tt,a[0]),a[1]=t.clone(et,a[1]),si=nt(a,ii+d,rt+d,ri),hi=h.generateArc({positions:a,granularity:ri,ellipsoid:y}),b=it(hi,s,ti,b,y,si,1),s=t.cross(g,l,s),s=t.normalize(s,s),ot=t.add(ft,t.multiplyByScalar(s,fi,ot),ot),ui===u.ROUNDED||ui===u.BEVELED?st(ft,et,ot,ui,wi,y,b,ti,rt+d,o):(c=t.negate(c,c),b=v(k,c,ti,b,y,rt+d,pi,di)),tt=t.clone(ot,tt)):(ft=t.add(k,t.multiplyByScalar(c,pi*fi,c),ft),et=t.add(ft,t.multiplyByScalar(s,-fi,et),et),a[0]=t.clone(tt,a[0]),a[1]=t.clone(et,a[1]),si=nt(a,ii+d,rt+d,ri),hi=h.generateArc({positions:a,granularity:ri,ellipsoid:y}),b=it(hi,s,ti,b,y,si,1),s=t.cross(g,l,s),s=t.normalize(s,s),ot=t.add(ft,t.multiplyByScalar(s,-fi,ot),ot),ui===u.ROUNDED||ui===u.BEVELED?st(ft,et,ot,ui,wi,y,b,ti,rt+d,o):b=v(k,c,ti,b,y,rt+d,pi,di),tt=t.clone(ot,tt)),ni=t.negate(l,ni)):(b=v(tt,s,ti,b,y,ii+d,1,1),tt=k),ii=rt,rt=ki[yi+1],k=vi;return a[0]=t.clone(tt,a[0]),a[1]=t.clone(k,a[1]),si=nt(a,ii+d,rt+d,ri),hi=h.generateArc({positions:a,granularity:ri,ellipsoid:y}),b=it(hi,s,ti,b,y,si,1),o&&(ei=v(k,s,gi,ei,y,rt+d,1,1)),ai=b.length,tr=o?ai+ei.length:ai,bi=new Float64Array(tr),bi.set(b),o&&bi.set(ei,ai),bi},w});t("Core/CorridorGeometryLibrary",["./Cartesian3","./CornerType","./defined","./Math","./Matrix3","./PolylinePipeline","./PolylineVolumeGeometryLibrary","./Quaternion"],function(n,t,i,r,u,f,e,o){"use strict";function c(i,f,e,s,c){var w=n.angleBetween(n.subtract(f,i,h),n.subtract(e,i,v)),a=s===t.BEVELED?1:Math.ceil(w/r.toRadians(5))+1,y=a*3,l=new Array(y),g,p,b;for(l[y-3]=e.x,l[y-2]=e.y,l[y-1]=e.z,g=c?u.fromQuaternion(o.fromAxisAngle(n.negate(i,h),w/a,k),d):u.fromQuaternion(o.fromAxisAngle(i,w/a,k),d),p=0,f=n.clone(f,h),b=0;b<a;b++)f=u.multiplyByVector(g,f,f),l[p++]=f.x,l[p++]=f.y,l[p++]=f.z;return l}function ct(i){var f=p,r=w,u=b,e=i[1],h;r=n.fromArray(i[1],e.length-3,r);u=n.fromArray(i[0],0,u);f=n.midpoint(r,u,f);var l=c(f,r,u,t.ROUNDED,!1),o=i.length-1,s=i[o-1];return e=i[o],r=n.fromArray(s,s.length-3,r),u=n.fromArray(e,0,u),f=n.midpoint(r,u,f),h=c(f,r,u,t.ROUNDED,!1),[l,h]}function g(t,i,r,u){var f=h;return u?f=n.add(t,i,f):(i=n.negate(i,i),f=n.add(t,i,f)),[f.x,f.y,f.z,r.x,r.y,r.z]}function a(t,i,r,u){for(var p,o,s,f=new Array(t.length),e=new Array(t.length),w=n.multiplyByScalar(i,r,h),b=n.negate(w,v),c=0,l=t.length-1,a=0;a<t.length;a+=3)p=n.fromArray(t,a,it),o=n.add(p,b,y),f[c++]=o.x,f[c++]=o.y,f[c++]=o.z,s=n.add(p,w,y),e[l--]=s.z,e[l--]=s.y,e[l--]=s.x;return u.push(f,e),u}var l={},h=new n,v=new n,it=new n,y=new n,s=[new n,new n],p=new n,w=new n,b=new n,rt=new n,ut=new n,ft=new n,et=new n,ot=new n,st=new n,ht=new n,k=new o,d=new u,nt,tt;return l.addAttribute=function(n,t,r,u){var f=t.x,e=t.y,o=t.z;i(r)&&(n[r]=f,n[r+1]=e,n[r+2]=o);i(u)&&(n[u]=o,n[u-1]=e,n[u-2]=f)},nt=new n,tt=new n,l.computePositions=function(i){var si=i.granularity,ei=i.positions,pt=i.ellipsoid,it=i.width/2,wt=i.cornerType,bt=i.saveAttributes,o=p,k=w,at=b,u=rt,l=ut,kt=ft,lt=et,v=ot,y=st,vt=ht,yt=[],ri=bt?[]:undefined,ui=bt?[]:undefined,d=ei[0],fi=ei[1],dt,gt,oi,hi,ni,ti,ci,li,ii,ai;for(k=n.normalize(n.subtract(fi,d,k),k),o=pt.geodeticSurfaceNormal(d,o),u=n.normalize(n.cross(o,k,u),u),bt&&(ri.push(u.x,u.y,u.z),ui.push(o.x,o.y,o.z)),lt=n.clone(d,lt),d=fi,at=n.negate(k,at),gt=[],hi=ei.length,oi=1;oi<hi-1;oi++)o=pt.geodeticSurfaceNormal(d,o),fi=ei[oi+1],k=n.normalize(n.subtract(fi,d,k),k),l=n.normalize(n.add(k,at,l),l),ni=n.multiplyByScalar(o,n.dot(k,o),nt),n.subtract(k,ni,ni),n.normalize(ni,ni),ti=n.multiplyByScalar(o,n.dot(at,o),tt),n.subtract(at,ti,ti),n.normalize(ti,ti),ci=!r.equalsEpsilon(Math.abs(n.dot(ni,ti)),1,r.EPSILON7),ci&&(l=n.cross(l,o,l),l=n.cross(o,l,l),l=n.normalize(l,l),li=it/Math.max(.25,n.magnitude(n.cross(l,at,h))),ii=e.angleIsGreaterThanPi(k,at,d,pt),l=n.multiplyByScalar(l,li,l),ii?(v=n.add(d,l,v),vt=n.add(v,n.multiplyByScalar(u,it,vt),vt),y=n.add(v,n.multiplyByScalar(u,it*2,y),y),s[0]=n.clone(lt,s[0]),s[1]=n.clone(vt,s[1]),dt=f.generateArc({positions:s,granularity:si,ellipsoid:pt}),yt=a(dt,u,it,yt),bt&&(ri.push(u.x,u.y,u.z),ui.push(o.x,o.y,o.z)),kt=n.clone(y,kt),u=n.normalize(n.cross(o,k,u),u),y=n.add(v,n.multiplyByScalar(u,it*2,y),y),lt=n.add(v,n.multiplyByScalar(u,it,lt),lt),wt===t.ROUNDED||wt===t.BEVELED?gt.push({leftPositions:c(v,kt,y,wt,ii)}):gt.push({leftPositions:g(d,n.negate(l,l),y,ii)})):(y=n.add(d,l,y),vt=n.add(y,n.negate(n.multiplyByScalar(u,it,vt),vt),vt),v=n.add(y,n.negate(n.multiplyByScalar(u,it*2,v),v),v),s[0]=n.clone(lt,s[0]),s[1]=n.clone(vt,s[1]),dt=f.generateArc({positions:s,granularity:si,ellipsoid:pt}),yt=a(dt,u,it,yt),bt&&(ri.push(u.x,u.y,u.z),ui.push(o.x,o.y,o.z)),kt=n.clone(v,kt),u=n.normalize(n.cross(o,k,u),u),v=n.add(y,n.negate(n.multiplyByScalar(u,it*2,v),v),v),lt=n.add(y,n.negate(n.multiplyByScalar(u,it,lt),lt),lt),wt===t.ROUNDED||wt===t.BEVELED?gt.push({rightPositions:c(y,kt,v,wt,ii)}):gt.push({rightPositions:g(d,l,v,ii)})),at=n.negate(k,at)),d=fi;return o=pt.geodeticSurfaceNormal(d,o),s[0]=n.clone(lt,s[0]),s[1]=n.clone(d,s[1]),dt=f.generateArc({positions:s,granularity:si,ellipsoid:pt}),yt=a(dt,u,it,yt),bt&&(ri.push(u.x,u.y,u.z),ui.push(o.x,o.y,o.z)),wt===t.ROUNDED&&(ai=ct(yt)),{positions:yt,corners:gt,lefts:ri,normals:ui,endPositions:ai}},l});t("Core/CorridorGeometry",["./arrayFill","./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Cartographic","./Check","./ComponentDatatype","./CornerType","./CorridorGeometryLibrary","./defaultValue","./defined","./defineProperties","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PolygonPipeline","./PrimitiveType","./Rectangle","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function dt(n,t){for(var i=0;i<n.length;i++)n[i]=t.scaleToGeodeticSurface(n[i],n[i]);return n}function et(n,t,i,u,f,e){var o=n.normals,h=n.tangents,c=n.bitangents,l=r.normalize(r.cross(i,t,ht),ht);e.normal&&s.addAttribute(o,t,u,f);e.tangent&&s.addAttribute(h,l,u,f);e.bitangent&&s.addAttribute(c,i,u,f)}function gt(n,t,i){for(var ei=n.positions,hi=n.corners,gi=n.endPositions,ur=n.lefts,nr=n.normals,ci=new p,tr,ni=0,ti=0,pi=0,tt,fr,wi,rt,er,li,ai,d,sr,g,vi,yi,nt,ki,gt,di,u=0;u<ei.length;u+=2)tt=ei[u].length-3,ni+=tt,pi+=tt*2,ti+=ei[u+1].length-3;for(ni+=3,ti+=3,u=0;u<hi.length;u++)tr=hi[u],fr=hi[u].leftPositions,c(fr)?(tt=fr.length,ni+=tt,pi+=tt):(tt=hi[u].rightPositions.length,ti+=tt,pi+=tt);wi=c(gi);wi&&(rt=gi[0].length-3,ni+=rt,ti+=rt,rt/=3,pi+=rt*6);var oi=ni+ti,w=new Float64Array(oi),cr=t.normal?new Float32Array(oi):undefined,lr=t.tangent?new Float32Array(oi):undefined,ar=t.bitangent?new Float32Array(oi):undefined,ut={normals:cr,tangents:lr,bitangents:ar},l=0,a=oi-1,ii,ft,it,pt,v=wt,o=bt,ri,ui,ir=rt/2,f=b.createTypedArray(oi/3,pi),h=0;if(wi)for(ui=vt,ri=yt,er=gi[0],v=r.fromArray(nr,0,v),o=r.fromArray(ur,0,o),u=0;u<ir;u++)ui=r.fromArray(er,(ir-1-u)*3,ui),ri=r.fromArray(er,(ir+u)*3,ri),s.addAttribute(w,ri,l),s.addAttribute(w,ui,undefined,a),et(ut,v,o,l,a,t),ft=l/3,pt=ft+1,ii=(a-2)/3,it=ii-1,f[h++]=ii,f[h++]=ft,f[h++]=it,f[h++]=it,f[h++]=ft,f[h++]=pt,l+=3,a-=3;var rr=0,bi=0,si=ei[rr++],at=ei[rr++];for(w.set(si,l),w.set(at,a-at.length+1),o=r.fromArray(ur,bi,o),tt=at.length-3,u=0;u<tt;u+=3)li=i.geodeticSurfaceNormal(r.fromArray(si,u,ht),ht),ai=i.geodeticSurfaceNormal(r.fromArray(at,tt-u,ct),ct),v=r.normalize(r.add(li,ai,v),v),et(ut,v,o,l,a,t),ft=l/3,pt=ft+1,ii=(a-2)/3,it=ii-1,f[h++]=ii,f[h++]=ft,f[h++]=it,f[h++]=it,f[h++]=ft,f[h++]=pt,l+=3,a-=3;for(li=i.geodeticSurfaceNormal(r.fromArray(si,tt,ht),ht),ai=i.geodeticSurfaceNormal(r.fromArray(at,tt,ct),ct),v=r.normalize(r.add(li,ai,v),v),bi+=3,u=0;u<hi.length;u++){tr=hi[u];var or=tr.leftPositions,hr=tr.rightPositions,fi,dt,ot=kt,st=vt,lt=yt;if(v=r.fromArray(nr,bi,v),c(or)){for(et(ut,v,o,undefined,a,t),a-=3,fi=pt,dt=it,d=0;d<or.length/3;d++)ot=r.fromArray(or,d*3,ot),f[h++]=fi,f[h++]=dt-d-1,f[h++]=dt-d,s.addAttribute(w,ot,undefined,a),st=r.fromArray(w,(dt-d-1)*3,st),lt=r.fromArray(w,fi*3,lt),o=r.normalize(r.subtract(st,lt,o),o),et(ut,v,o,undefined,a,t),a-=3;ot=r.fromArray(w,fi*3,ot);st=r.subtract(r.fromArray(w,dt*3,st),ot,st);lt=r.subtract(r.fromArray(w,(dt-d)*3,lt),ot,lt);o=r.normalize(r.add(st,lt,o),o);et(ut,v,o,l,undefined,t);l+=3}else{for(et(ut,v,o,l,undefined,t),l+=3,fi=it,dt=pt,d=0;d<hr.length/3;d++)ot=r.fromArray(hr,d*3,ot),f[h++]=fi,f[h++]=dt+d,f[h++]=dt+d+1,s.addAttribute(w,ot,l),st=r.fromArray(w,fi*3,st),lt=r.fromArray(w,(dt+d)*3,lt),o=r.normalize(r.subtract(st,lt,o),o),et(ut,v,o,l,undefined,t),l+=3;ot=r.fromArray(w,fi*3,ot);st=r.subtract(r.fromArray(w,(dt+d)*3,st),ot,st);lt=r.subtract(r.fromArray(w,dt*3,lt),ot,lt);o=r.normalize(r.negate(r.add(lt,st,o),o),o);et(ut,v,o,undefined,a,t);a-=3}for(si=ei[rr++],at=ei[rr++],si.splice(0,3),at.splice(at.length-3,3),w.set(si,l),w.set(at,a-at.length+1),tt=at.length-3,bi+=3,o=r.fromArray(ur,bi,o),d=0;d<at.length;d+=3)li=i.geodeticSurfaceNormal(r.fromArray(si,d,ht),ht),ai=i.geodeticSurfaceNormal(r.fromArray(at,tt-d,ct),ct),v=r.normalize(r.add(li,ai,v),v),et(ut,v,o,l,a,t),pt=l/3,ft=pt-1,it=(a-2)/3,ii=it+1,f[h++]=ii,f[h++]=ft,f[h++]=it,f[h++]=it,f[h++]=ft,f[h++]=pt,l+=3,a-=3;l-=3;a+=3}if(v=r.fromArray(nr,nr.length-3,v),et(ut,v,o,l,a,t),wi)for(l+=3,a-=3,ui=vt,ri=yt,sr=gi[1],u=0;u<ir;u++)ui=r.fromArray(sr,(rt-u-1)*3,ui),ri=r.fromArray(sr,u*3,ri),s.addAttribute(w,ui,undefined,a),s.addAttribute(w,ri,l),et(ut,v,o,l,a,t),pt=l/3,ft=pt-1,it=(a-2)/3,ii=it+1,f[h++]=ii,f[h++]=ft,f[h++]=it,f[h++]=it,f[h++]=ft,f[h++]=pt,l+=3,a-=3;if(ci.position=new y({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:w}),t.st){if(g=new Float32Array(oi/3*2),nt=0,wi){for(ni/=3,ti/=3,ki=Math.PI/(rt+1),yi=1/(ni-rt+1),vi=1/(ti-rt+1),di=rt/2,u=di+1;u<rt+1;u++)gt=k.PI_OVER_TWO+ki*u,g[nt++]=vi*(1+Math.cos(gt)),g[nt++]=.5*(1+Math.sin(gt));for(u=1;u<ti-rt+1;u++)g[nt++]=u*vi,g[nt++]=0;for(u=rt;u>di;u--)gt=k.PI_OVER_TWO-u*ki,g[nt++]=1-vi*(1+Math.cos(gt)),g[nt++]=.5*(1+Math.sin(gt));for(u=di;u>0;u--)gt=k.PI_OVER_TWO-ki*u,g[nt++]=1-yi*(1+Math.cos(gt)),g[nt++]=.5*(1+Math.sin(gt));for(u=ni-rt;u>0;u--)g[nt++]=u*yi,g[nt++]=1;for(u=1;u<di+1;u++)gt=k.PI_OVER_TWO+ki*u,g[nt++]=yi*(1+Math.cos(gt)),g[nt++]=.5*(1+Math.sin(gt))}else{for(ni/=3,ti/=3,yi=1/(ni-1),vi=1/(ti-1),u=0;u<ti;u++)g[nt++]=u*vi,g[nt++]=0;for(u=ni;u>0;u--)g[nt++]=(u-1)*yi,g[nt++]=1}ci.st=new y({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:g})}return t.normal&&(ci.normal=new y({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ut.normals})),t.tangent&&(ci.tangent=new y({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ut.tangents})),t.bitangent&&(ci.bitangent=new y({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ut.bitangents})),{attributes:ci,indices:f}}function ei(n,t){var g,b,it,w,rt,o,f,h,ut,ft,et;if(!t.normal&&!t.tangent&&!t.bitangent&&!t.st)return n;g=n.position.values;(t.normal||t.bitangent)&&(b=n.normal.values,it=n.bitangent.values);var ot=n.position.values.length/18,u=ot*3,nt=ot*2,st=u*2,i;if(t.normal||t.bitangent||t.tangent){var e=t.normal?new Float32Array(u*6):undefined,a=t.tangent?new Float32Array(u*6):undefined,v=t.bitangent?new Float32Array(u*6):undefined,tt=wt,k=bt,d=vt,c=yt,y=fi,p=kt,l=st;for(i=0;i<u;i+=3)w=l+st,tt=r.fromArray(g,i,tt),k=r.fromArray(g,i+u,k),d=r.fromArray(g,(i+3)%u,d),k=r.subtract(k,tt,k),d=r.subtract(d,tt,d),c=r.normalize(r.cross(k,d,c),c),t.normal&&(s.addAttribute(e,c,w),s.addAttribute(e,c,w+3),s.addAttribute(e,c,l),s.addAttribute(e,c,l+3)),(t.tangent||t.bitangent)&&(p=r.fromArray(b,i,p),t.bitangent&&(s.addAttribute(v,p,w),s.addAttribute(v,p,w+3),s.addAttribute(v,p,l),s.addAttribute(v,p,l+3)),t.tangent&&(y=r.normalize(r.cross(p,c,y),y),s.addAttribute(a,y,w),s.addAttribute(a,y,w+3),s.addAttribute(a,y,l),s.addAttribute(a,y,l+3))),l+=6;if(t.normal){for(e.set(b),i=0;i<u;i+=3)e[i+u]=-b[i],e[i+u+1]=-b[i+1],e[i+u+2]=-b[i+2];n.normal.values=e}else n.normal=undefined;t.bitangent?(v.set(it),v.set(it,u),n.bitangent.values=v):n.bitangent=undefined;t.tangent&&(rt=n.tangent.values,a.set(rt),a.set(rt,u),n.tangent.values=a)}if(t.st){for(o=n.st.values,f=new Float32Array(nt*6),f.set(o),f.set(o,nt),h=nt*2,ut=0;ut<2;ut++){for(f[h++]=o[0],f[h++]=o[1],i=2;i<nt;i+=2)ft=o[i],et=o[i+1],f[h++]=ft,f[h++]=et,f[h++]=ft,f[h++]=et;f[h++]=o[0];f[h++]=o[1]}n.st.values=f}return n}function pt(n,t,i){var r;for(i[t++]=n[0],i[t++]=n[1],i[t++]=n[2],r=3;r<n.length;r+=3){var u=n[r],f=n[r+1],e=n[r+2];i[t++]=u;i[t++]=f;i[t++]=e;i[t++]=u;i[t++]=f;i[t++]=e}return i[t++]=n[0],i[t++]=n[1],i[t++]=n[2],i}function oi(t,i){var vt=new tt({position:i.position,normal:i.normal||i.bitangent||t.shadowVolume,tangent:i.tangent,bitangent:i.normal||i.bitangent,st:i.st}),ot=t.ellipsoid,yt=s.computePositions(t),ct=gt(yt,vt,ot),wt=t.height,bt=t.extrudedHeight,l=ct.attributes,g=ct.indices,v=l.position.values,u=v.length,nt=new Float64Array(u*6),it=new Float64Array(u),p,r,o,k,rt,a,lt,h,ft,et,ht,at;if(it.set(v),p=new Float64Array(u*4),v=d.scaleToGeodeticHeight(v,wt,ot),p=pt(v,0,p),it=d.scaleToGeodeticHeight(it,bt,ot),p=pt(it,u*2,p),nt.set(v),nt.set(it,u),nt.set(p,u*2),l.position.values=nt,l=ei(l,i),o=u/3,t.shadowVolume){for(k=l.normal.values,u=k.length,rt=new Float32Array(u*6),r=0;r<u;r++)k[r]=-k[r];rt.set(k,u);rt=pt(k,u*4,rt);l.extrudeDirection=new y({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:rt});i.normal||(l.normal=undefined)}c(t.offsetAttribute)&&(a=new Uint8Array(o*6),t.offsetAttribute===w.TOP?(a=n(a,1,0,o),a=n(a,1,o*2,o*4)):(lt=t.offsetAttribute===w.NONE?0:1,a=n(a,lt)),l.applyOffset=new y({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:a}));var st=g.length,ut=o+o,f=b.createTypedArray(nt.length/3,st*2+ut*3);for(f.set(g),h=st,r=0;r<st;r+=3){var kt=g[r],dt=g[r+1],ni=g[r+2];f[h++]=ni+o;f[h++]=dt+o;f[h++]=kt+o}for(r=0;r<ut;r+=2)ft=r+ut,et=ft+ut,ht=ft+1,at=et+1,f[h++]=ft,f[h++]=et,f[h++]=ht,f[h++]=ht,f[h++]=et,f[h++]=at;return{attributes:l,indices:f}}function ti(n,t,i,u,f,e){var y=r.subtract(t,n,ni),p,h,o,s;r.normalize(y,y);p=i.geodeticSurfaceNormal(n,lt);h=r.cross(y,p,ni);r.multiplyByScalar(h,u,h);var c=f.latitude,l=f.longitude,a=e.latitude,v=e.longitude;r.add(n,h,lt);i.cartesianToCartographic(lt,ut);o=ut.latitude;s=ut.longitude;c=Math.min(c,o);l=Math.min(l,s);a=Math.max(a,o);v=Math.max(v,s);r.subtract(n,h,lt);i.cartesianToCartographic(lt,ut);o=ut.latitude;s=ut.longitude;c=Math.min(c,o);l=Math.min(l,s);a=Math.max(a,o);v=Math.max(v,s);f.latitude=c;f.longitude=l;e.latitude=a;e.longitude=v}function ii(n,i,u,f,e){var s,v,y,h,l,b,p,w,a;if(n=dt(n,i),s=t(n,r.equalsEpsilon),v=s.length,v<2||u<=0)return new nt;for(y=u*.5,it.latitude=Number.POSITIVE_INFINITY,it.longitude=Number.POSITIVE_INFINITY,rt.latitude=Number.NEGATIVE_INFINITY,rt.longitude=Number.NEGATIVE_INFINITY,f===o.ROUNDED&&(b=s[0],r.subtract(b,s[1],ft),r.normalize(ft,ft),r.multiplyByScalar(ft,y,ft),r.add(b,ft,at),i.cartesianToCartographic(at,ut),h=ut.latitude,l=ut.longitude,it.latitude=Math.min(it.latitude,h),it.longitude=Math.min(it.longitude,l),rt.latitude=Math.max(rt.latitude,h),rt.longitude=Math.max(rt.longitude,l)),p=0;p<v-1;++p)ti(s[p],s[p+1],i,y,it,rt);return w=s[v-1],r.subtract(w,s[v-2],ft),r.normalize(ft,ft),r.multiplyByScalar(ft,y,ft),r.add(w,ft,at),ti(w,at,i,y,it,rt),f===o.ROUNDED&&(i.cartesianToCartographic(at,ut),h=ut.latitude,l=ut.longitude,it.latitude=Math.min(it.latitude,h),it.longitude=Math.min(it.longitude,l),rt.latitude=Math.max(rt.latitude,h),rt.longitude=Math.max(rt.longitude,l)),a=c(e)?e:new nt,a.north=rt.latitude,a.south=it.latitude,a.east=rt.longitude,a.west=it.longitude,a}function ot(n){var t,u,i,e;n=h(n,h.EMPTY_OBJECT);t=n.positions;u=n.width;f.defined("options.positions",t);f.defined("options.width",u);i=h(n.height,0);e=h(n.extrudedHeight,i);this._positions=t;this._ellipsoid=a.clone(h(n.ellipsoid,a.WGS84));this._vertexFormat=tt.clone(h(n.vertexFormat,tt.DEFAULT));this._width=u;this._height=Math.max(i,e);this._extrudedHeight=Math.min(i,e);this._cornerType=h(n.cornerType,o.ROUNDED);this._granularity=h(n.granularity,k.RADIANS_PER_DEGREE);this._shadowVolume=h(n.shadowVolume,!1);this._workerName="createCorridorGeometry";this._offsetAttribute=n.offsetAttribute;this._rectangle=undefined;this.packedLength=1+t.length*r.packedLength+a.packedLength+tt.packedLength+7}var wt=new r,bt=new r,vt=new r,yt=new r,fi=new r,kt=new r,ht=new r,ct=new r,ni=new r,lt=new r,ut=new u,ft=new r,at=new r,it=new u,rt=new u;ot.pack=function(n,t,i){var e,o,u;for(f.defined("value",n),f.defined("array",t),i=h(i,0),e=n._positions,o=e.length,t[i++]=o,u=0;u<o;++u,i+=r.packedLength)r.pack(e[u],t,i);return a.pack(n._ellipsoid,t,i),i+=a.packedLength,tt.pack(n._vertexFormat,t,i),i+=tt.packedLength,t[i++]=n._width,t[i++]=n._height,t[i++]=n._extrudedHeight,t[i++]=n._cornerType,t[i++]=n._granularity,t[i++]=n._shadowVolume?1:0,t[i]=h(n._offsetAttribute,-1),t};var ri=a.clone(a.UNIT_SPHERE),ui=new tt,st={positions:undefined,ellipsoid:ri,vertexFormat:ui,width:undefined,height:undefined,extrudedHeight:undefined,cornerType:undefined,granularity:undefined,shadowVolume:undefined,offsetAttribute:undefined};return ot.unpack=function(n,t,i){var s,u,e,l,v;for(f.defined("array",n),t=h(t,0),s=n[t++],u=new Array(s),e=0;e<s;++e,t+=r.packedLength)u[e]=r.unpack(n,t);l=a.unpack(n,t,ri);t+=a.packedLength;v=tt.unpack(n,t,ui);t+=tt.packedLength;var y=n[t++],p=n[t++],w=n[t++],b=n[t++],k=n[t++],d=n[t++]===1,o=n[t];return c(i)?(i._positions=u,i._ellipsoid=a.clone(l,i._ellipsoid),i._vertexFormat=tt.clone(v,i._vertexFormat),i._width=y,i._height=p,i._extrudedHeight=w,i._cornerType=b,i._granularity=k,i._shadowVolume=d,i._offsetAttribute=o===-1?undefined:o,i):(st.positions=u,st.width=y,st.height=p,st.extrudedHeight=w,st.cornerType=b,st.granularity=k,st.shadowVolume=d,st.offsetAttribute=o===-1?undefined:o,new ot(st))},ot.computeRectangle=function(n,t){var i,r,u,e;return n=h(n,h.EMPTY_OBJECT),i=n.positions,r=n.width,f.defined("options.positions",i),f.defined("options.width",r),u=h(n.ellipsoid,a.WGS84),e=h(n.cornerType,o.ROUNDED),ii(i,u,r,e,t)},ot.createGeometry=function(u){var l=u._positions,tt=u._width,h=u._ellipsoid,a,rt,nt,ft;if(l=dt(l,h),a=t(l,r.equalsEpsilon),!(a.length<2)&&!(tt<=0)){var p=u._height,it=u._extrudedHeight,et=!k.equalsEpsilon(p,it,0,k.EPSILON2),b=u._vertexFormat,o={ellipsoid:h,positions:a,width:tt,cornerType:u._cornerType,granularity:u._granularity,saveAttributes:!0},f;if(et)o.height=p,o.extrudedHeight=it,o.shadowVolume=u._shadowVolume,o.offsetAttribute=u._offsetAttribute,f=oi(o,b);else if(rt=s.computePositions(o),f=gt(rt,b,h),f.attributes.position.values=d.scaleToGeodeticHeight(f.attributes.position.values,p,h),c(u._offsetAttribute)){var ot=u._offsetAttribute===w.NONE?0:1,st=f.attributes.position.values.length,ut=new Uint8Array(st/3);n(ut,ot);f.attributes.applyOffset=new y({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:ut})}return nt=f.attributes,ft=i.fromVertices(nt.position.values,undefined,3),b.position||(f.attributes.position.values=undefined),new v({attributes:nt,indices:f.indices,primitiveType:g.TRIANGLES,boundingSphere:ft,offsetAttribute:u._offsetAttribute})}},ot.createShadowVolume=function(n,t,i){var r=n._granularity,u=n._ellipsoid,f=t(r,u),e=i(r,u);return new ot({positions:n._positions,width:n._width,cornerType:n._cornerType,ellipsoid:u,granularity:r,extrudedHeight:f,height:e,vertexFormat:tt.POSITION_ONLY,shadowVolume:!0})},l(ot.prototype,{rectangle:{get:function(){return c(this._rectangle)||(this._rectangle=ii(this._positions,this._ellipsoid,this._width,this._cornerType)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}}),ot});t("Core/CorridorOutlineGeometry",["./arrayFill","./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./CornerType","./CorridorGeometryLibrary","./defaultValue","./defined","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PolygonPipeline","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function ft(n,t){for(var i=0;i<n.length;i++)n[i]=t.scaleToGeodeticSurface(n[i],n[i]);return n}function rt(n,t){for(var w=[],ht=n.positions,lt=n.corners,wt=n.endPositions,oi=new v,bt,vt=0,yt=0,pt=0,b,ii,kt,ct,ui,y,ei,i=0;i<ht.length;i+=2)b=ht[i].length-3,vt+=b,pt+=b/3*4,yt+=ht[i+1].length-3;for(vt+=3,yt+=3,i=0;i<lt.length;i++)bt=lt[i],ii=lt[i].leftPositions,h(ii)?(b=ii.length,vt+=b,pt+=b/3*2):(b=lt[i].rightPositions.length,yt+=b,pt+=b/3*2);kt=h(wt);kt&&(ct=wt[0].length-3,vt+=ct,yt+=ct,ct/=3,pt+=ct*4);var ri=vt+yt,g=new Float64Array(ri),u=0,c=ri-1,nt,rt,k,d,et,ot,dt=ct/2,s=p.createTypedArray(ri/3,pt+4),l=0;if(s[l++]=u/3,s[l++]=(c-2)/3,kt)for(w.push(u/3),ot=tt,et=it,ui=wt[0],i=0;i<dt;i++)ot=r.fromArray(ui,(dt-1-i)*3,ot),et=r.fromArray(ui,(dt+i)*3,et),o.addAttribute(g,et,u),o.addAttribute(g,ot,undefined,c),rt=u/3,d=rt+1,nt=(c-2)/3,k=nt-1,s[l++]=nt,s[l++]=k,s[l++]=rt,s[l++]=d,u+=3,c-=3;var gt=0,ni=ht[gt++],ft=ht[gt++];for(g.set(ni,u),g.set(ft,c-ft.length+1),b=ft.length-3,w.push(u/3,(c-2)/3),i=0;i<b;i+=3)rt=u/3,d=rt+1,nt=(c-2)/3,k=nt-1,s[l++]=nt,s[l++]=k,s[l++]=rt,s[l++]=d,u+=3,c-=3;for(i=0;i<lt.length;i++){bt=lt[i];var ti=bt.leftPositions,fi=bt.rightPositions,st,at=ut;if(h(ti)){for(c-=3,st=k,w.push(d),y=0;y<ti.length/3;y++)at=r.fromArray(ti,y*3,at),s[l++]=st-y-1,s[l++]=st-y,o.addAttribute(g,at,undefined,c),c-=3;w.push(st-Math.floor(ti.length/6));t===e.BEVELED&&w.push((c-2)/3+1);u+=3}else{for(u+=3,st=d,w.push(k),y=0;y<fi.length/3;y++)at=r.fromArray(fi,y*3,at),s[l++]=st+y,s[l++]=st+y+1,o.addAttribute(g,at,u),u+=3;w.push(st+Math.floor(fi.length/6));t===e.BEVELED&&w.push(u/3-1);c-=3}for(ni=ht[gt++],ft=ht[gt++],ni.splice(0,3),ft.splice(ft.length-3,3),g.set(ni,u),g.set(ft,c-ft.length+1),b=ft.length-3,y=0;y<ft.length;y+=3)d=u/3,rt=d-1,k=(c-2)/3,nt=k+1,s[l++]=nt,s[l++]=k,s[l++]=rt,s[l++]=d,u+=3,c-=3;u-=3;c+=3;w.push(u/3,(c-2)/3)}if(kt){for(u+=3,c-=3,ot=tt,et=it,ei=wt[1],i=0;i<dt;i++)ot=r.fromArray(ei,(ct-i-1)*3,ot),et=r.fromArray(ei,i*3,et),o.addAttribute(g,ot,undefined,c),o.addAttribute(g,et,u),d=u/3,rt=d-1,k=(c-2)/3,nt=k+1,s[l++]=nt,s[l++]=k,s[l++]=rt,s[l++]=d,u+=3,c-=3;w.push(u/3)}else w.push(u/3,(c-2)/3);return s[l++]=u/3,s[l++]=(c-2)/3,oi.position=new a({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:g}),{attributes:oi,indices:s,wallIndices:w}}function et(t){var it=t.ellipsoid,st=o.computePositions(t),g=rt(st,t.cornerType),nt=g.wallIndices,ht=t.height,ct=t.extrudedHeight,v=g.attributes,w=g.indices,s=v.position.values,i=s.length,k=new Float64Array(i),c,e,ut,r,d,u,l,ft,et,tt,ot;for(k.set(s),c=new Float64Array(i*2),s=b.scaleToGeodeticHeight(s,ht,it),k=b.scaleToGeodeticHeight(k,ct,it),c.set(s),c.set(k,i),v.position.values=c,i/=3,h(t.offsetAttribute)&&(e=new Uint8Array(i*2),t.offsetAttribute===y.TOP?e=n(e,1,0,i):(ut=t.offsetAttribute===y.NONE?0:1,e=n(e,ut)),v.applyOffset=new a({componentDatatype:f.UNSIGNED_BYTE,componentsPerAttribute:1,values:e})),d=w.length,u=p.createTypedArray(c.length/3,(d+nt.length)*2),u.set(w),l=d,r=0;r<d;r+=2)ft=w[r],et=w[r+1],u[l++]=ft+i,u[l++]=et+i;for(r=0;r<nt.length;r++)tt=nt[r],ot=tt+i,u[l++]=tt,u[l++]=ot;return{attributes:v,indices:u}}function g(n){var t,f,i,o;n=s(n,s.EMPTY_OBJECT);t=n.positions;f=n.width;u.typeOf.object("options.positions",t);u.typeOf.number("options.width",f);i=s(n.height,0);o=s(n.extrudedHeight,i);this._positions=t;this._ellipsoid=c.clone(s(n.ellipsoid,c.WGS84));this._width=f;this._height=Math.max(i,o);this._extrudedHeight=Math.min(i,o);this._cornerType=s(n.cornerType,e.ROUNDED);this._granularity=s(n.granularity,w.RADIANS_PER_DEGREE);this._offsetAttribute=n.offsetAttribute;this._workerName="createCorridorOutlineGeometry";this.packedLength=1+t.length*r.packedLength+c.packedLength+6}var tt=new r,it=new r,ut=new r,nt,d;return g.pack=function(n,t,i){var e,o,f;for(u.typeOf.object("value",n),u.typeOf.object("array",t),i=s(i,0),e=n._positions,o=e.length,t[i++]=o,f=0;f<o;++f,i+=r.packedLength)r.pack(e[f],t,i);return c.pack(n._ellipsoid,t,i),i+=c.packedLength,t[i++]=n._width,t[i++]=n._height,t[i++]=n._extrudedHeight,t[i++]=n._cornerType,t[i++]=n._granularity,t[i]=s(n._offsetAttribute,-1),t},nt=c.clone(c.UNIT_SPHERE),d={positions:undefined,ellipsoid:nt,width:undefined,height:undefined,extrudedHeight:undefined,cornerType:undefined,granularity:undefined,offsetAttribute:undefined},g.unpack=function(n,t,i){var l,f,e,a;for(u.typeOf.object("array",n),t=s(t,0),l=n[t++],f=new Array(l),e=0;e<l;++e,t+=r.packedLength)f[e]=r.unpack(n,t);a=c.unpack(n,t,nt);t+=c.packedLength;var v=n[t++],y=n[t++],p=n[t++],w=n[t++],b=n[t++],o=n[t];return h(i)?(i._positions=f,i._ellipsoid=c.clone(a,i._ellipsoid),i._width=v,i._height=y,i._extrudedHeight=p,i._cornerType=w,i._granularity=b,i._offsetAttribute=o===-1?undefined:o,i):(d.positions=f,d.width=v,d.height=y,d.extrudedHeight=p,d.cornerType=w,d.granularity=b,d.offsetAttribute=o===-1?undefined:o,new g(d))},g.createGeometry=function(u){var c=u._positions,nt=u._width,v=u._ellipsoid,p,it,g,ot;if(c=ft(c,v),p=t(c,r.equalsEpsilon),!(p.length<2)&&!(nt<=0)){var d=u._height,tt=u._extrudedHeight,st=!w.equalsEpsilon(d,tt,0,w.EPSILON2),s={ellipsoid:v,positions:p,width:nt,cornerType:u._cornerType,granularity:u._granularity,saveAttributes:!1},e;if(st)s.height=d,s.extrudedHeight=tt,s.offsetAttribute=u._offsetAttribute,e=et(s);else if(it=o.computePositions(s),e=rt(it,s.cornerType),e.attributes.position.values=b.scaleToGeodeticHeight(e.attributes.position.values,d,v),h(u._offsetAttribute)){var ht=e.attributes.position.values.length,ut=new Uint8Array(ht/3),ct=u._offsetAttribute===y.NONE?0:1;n(ut,ct);e.attributes.applyOffset=new a({componentDatatype:f.UNSIGNED_BYTE,componentsPerAttribute:1,values:ut})}return g=e.attributes,ot=i.fromVertices(g.position.values,undefined,3),new l({attributes:g,indices:e.indices,primitiveType:k.LINES,boundingSphere:ot,offsetAttribute:u._offsetAttribute})}},g});t("Core/createGuid",[],function(){"use strict";function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})}return n});t("Core/Ion",["./Credit","./defined","./Resource"],function(n,t,i){"use strict";var u,f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NjcyZDliZC0wOGIzLTRkYTgtODMzZC02ZDgxN2JlOTFlYWMiLCJpZCI6MjU5LCJzY29wZXMiOlsiYXNyIiwiZ2MiXSwiaWF0IjoxNTM4MzI5MzgyfQ.fHaE6XzGnZtUEtSJjF_0X0HkLQyU59bGDD4-9IEePkc",r={};return r.defaultAccessToken=f,r.defaultServer=new i({url:"https://api.cesium.com/"}),r.getDefaultTokenCredit=function(i){if(i!==f)return undefined;if(!t(u))u=new n('<b>             This application is using Cesium\'s default ion access token. Please assign <i>Cesium.Ion.defaultAccessToken<\/i>             with an access token from your ion account before making any Cesium API calls.             You can sign up for a free ion account at <a href="https://cesium.com">https://cesium.com<\/a>.<\/b>',!0);return u},r});t("Core/IonResource",["../ThirdParty/when","./Check","./Credit","./defaultValue","./defined","./defineProperties","./Ion","./Resource","./RuntimeError"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(n,i){t.defined("endpoint",n);t.defined("endpointResource",i);var r,f=n.externalType,e=u(f);if(e)if(f==="3DTILES"||f==="STK_TERRAIN_SERVER")r={url:n.options.url};else throw new s("Ion.createResource does not support external imagery assets; use IonImageryProvider instead.");else r={url:n.url,retryAttempts:1,retryCallback:c};o.call(this,r);this._ionEndpoint=n;this._ionEndpointResource=i;this._ionRoot=undefined;this._pendingPromise=undefined;this._credits=undefined;this._isExternal=e}function c(t,i){var f=r(t._ionRoot,t),e=f._ionEndpointResource;return!u(i)||i.statusCode!==401&&!(i.target instanceof Image)?n.resolve(!1):(u(f._pendingPromise)||(f._pendingPromise=e.fetchJson().then(function(n){return f._ionEndpoint=n,n}).always(function(n){return f._pendingPromise=undefined,n})),f._pendingPromise.then(function(n){return t._ionEndpoint=n,!0}))}return u(Object.create)&&(h.prototype=Object.create(o.prototype),h.prototype.constructor=h),h.fromAssetId=function(n,t){var i=h._createEndpointResource(n,t);return i.fetchJson().then(function(n){return new h(n,i)})},f(h.prototype,{credits:{get:function(){return u(this._ionRoot)?this._ionRoot.credits:u(this._credits)?this._credits:(this._credits=h.getCreditsFromEndpoint(this._ionEndpoint,this._ionEndpointResource),this._credits)}}}),h.getCreditsFromEndpoint=function(n,t){var r=n.attributions.map(i.getIonCredit),f=e.getDefaultTokenCredit(t.queryParameters.access_token);return u(f)&&r.push(i.clone(f)),r},h.prototype.clone=function(n){var t=r(this._ionRoot,this);return u(n)||(n=new h(t._ionEndpoint,t._ionEndpointResource)),n=o.prototype.clone.call(this,n),n._ionRoot=t,n._isExternal=this._isExternal,n},h.prototype.fetchImage=function(n,t){return o.prototype.fetchImage.call(this,this._isExternal?n:!0,t)},h.prototype._makeRequest=function(n){if(this._isExternal)return o.prototype._makeRequest.call(this,n);var t="*/*;access_token="+this._ionEndpoint.accessToken,i=t,r=this.headers;return u(r)&&u(r.Accept)&&(i=r.Accept+","+t),u(n.headers)?n.headers.Accept=u(n.headers.Accept)?n.headers.Accept+","+t:i:n.headers={Accept:i},o.prototype._makeRequest.call(this,n)},h._createEndpointResource=function(n,i){var f,s,h;return t.defined("assetId",n),i=r(i,r.EMPTY_OBJECT),f=r(i.server,e.defaultServer),s=r(i.accessToken,e.defaultAccessToken),f=o.createIfNeeded(f),h={url:"v1/assets/"+n+"/endpoint"},u(s)&&(h.queryParameters={access_token:s}),f.getDerivedResource(h)},h});t("Core/createWorldTerrain",["./CesiumTerrainProvider","./defaultValue","./IonResource"],function(n,t,i){"use strict";function r(r){return r=t(r,t.EMPTY_OBJECT),new n({url:i.fromAssetId(1),requestVertexNormals:t(r.requestVertexNormals,!1),requestWaterMask:t(r.requestWaterMask,!1)})}return r});t("Core/CullingVolume",["./Cartesian3","./Cartesian4","./defaultValue","./defined","./DeveloperError","./Intersect","./Plane"],function(n,t,i,r,u,f,e){"use strict";function o(n){this.planes=i(n,[])}var h=[new n,new n,new n];n.clone(n.UNIT_X,h[0]);n.clone(n.UNIT_Y,h[1]);n.clone(n.UNIT_Z,h[2]);var s=new n,l=new n,c=new e(new n(1,0,0),0);return o.fromBoundingSphere=function(i,f){var w,c,p;if(!r(i))throw new u("boundingSphere is required.");r(f)||(f=new o);w=h.length;c=f.planes;c.length=2*w;var b=i.center,k=i.radius,y=0;for(p=0;p<w;++p){var e=h[p],a=c[y],v=c[y+1];r(a)||(a=c[y]=new t);r(v)||(v=c[y+1]=new t);n.multiplyByScalar(e,-k,s);n.add(b,s,s);a.x=e.x;a.y=e.y;a.z=e.z;a.w=-n.dot(e,s);n.multiplyByScalar(e,k,s);n.add(b,s,s);v.x=-e.x;v.y=-e.y;v.z=-e.z;v.w=-n.dot(n.negate(e,l),s);y+=2}return f},o.prototype.computeVisibility=function(n){var i,o,t,h,s;if(!r(n))throw new u("boundingVolume is required.");for(i=this.planes,o=!1,t=0,h=i.length;t<h;++t){if(s=n.intersectPlane(e.fromCartesian4(i[t],c)),s===f.OUTSIDE)return f.OUTSIDE;s===f.INTERSECTING&&(o=!0)}return o?f.INTERSECTING:f.INSIDE},o.prototype.computeVisibilityWithPlaneMask=function(n,t){var s,h,i,v,l,a;if(!r(n))throw new u("boundingVolume is required.");if(!r(t))throw new u("parentPlaneMask is required.");if(t===o.MASK_OUTSIDE||t===o.MASK_INSIDE)return t;for(s=o.MASK_INSIDE,h=this.planes,i=0,v=h.length;i<v;++i)if(l=i<31?1<<i:0,!(i<31)||(t&l)!=0){if(a=n.intersectPlane(e.fromCartesian4(h[i],c)),a===f.OUTSIDE)return o.MASK_OUTSIDE;a===f.INTERSECTING&&(s|=l)}return s},o.MASK_OUTSIDE=4294967295,o.MASK_INSIDE=0,o.MASK_INDETERMINATE=2147483647,o});t("Core/CylinderGeometryLibrary",["./Math"],function(n){"use strict";var t={};return t.computePositions=function(t,i,r,u,f){for(var l=t*.5,y=-l,h=u+u,tt=f?2*h:h,e=new Float64Array(tt*3),s=0,o=0,a=f?h*3:0,v=f?(h+u)*3:u*3,c=0;c<u;c++){var p=c/u*n.TWO_PI,w=Math.cos(p),b=Math.sin(p),k=w*r,d=b*r,g=w*i,nt=b*i;e[o+a]=k;e[o+a+1]=d;e[o+a+2]=y;e[o+v]=g;e[o+v+1]=nt;e[o+v+2]=l;o+=3;f&&(e[s++]=k,e[s++]=d,e[s++]=y,e[s++]=g,e[s++]=nt,e[s++]=l)}return e},t});t("Core/CylinderGeometry",["./arrayFill","./BoundingSphere","./Cartesian2","./Cartesian3","./ComponentDatatype","./CylinderGeometryLibrary","./defaultValue","./defined","./DeveloperError","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PrimitiveType","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(n){n=e(n,e.EMPTY_OBJECT);var t=n.length,i=n.topRadius,r=n.bottomRadius,f=e(n.vertexFormat,w.DEFAULT),u=e(n.slices,128);if(!o(t))throw new s("options.length must be defined.");if(!o(i))throw new s("options.topRadius must be defined.");if(!o(r))throw new s("options.bottomRadius must be defined.");if(u<3)throw new s("options.slices must be greater than or equal to 3.");if(o(n.offsetAttribute)&&n.offsetAttribute===a.TOP)throw new s("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=t;this._topRadius=i;this._bottomRadius=r;this._vertexFormat=w.clone(f);this._slices=u;this._offsetAttribute=n.offsetAttribute;this._workerName="createCylinderGeometry"}var d=new i,tt=new r,it=new r,rt=new r,ut=new r,g,k,nt;return b.packedLength=w.packedLength+5,b.pack=function(n,t,i){if(!o(n))throw new s("value is required");if(!o(t))throw new s("array is required");return i=e(i,0),w.pack(n._vertexFormat,t,i),i+=w.packedLength,t[i++]=n._length,t[i++]=n._topRadius,t[i++]=n._bottomRadius,t[i++]=n._slices,t[i]=e(n._offsetAttribute,-1),t},g=new w,k={vertexFormat:g,length:undefined,topRadius:undefined,bottomRadius:undefined,slices:undefined,offsetAttribute:undefined},b.unpack=function(n,t,i){var u;if(!o(n))throw new s("array is required");t=e(t,0);u=w.unpack(n,t,g);t+=w.packedLength;var f=n[t++],h=n[t++],c=n[t++],l=n[t++],r=n[t];return o(i)?(i._vertexFormat=w.clone(u,i._vertexFormat),i._length=f,i._topRadius=h,i._bottomRadius=c,i._slices=l,i._offsetAttribute=r===-1?undefined:r,i):(k.length=f,k.topRadius=h,k.bottomRadius=c,k.slices=l,k.offsetAttribute=r===-1?undefined:r,new b(k))},b.createGeometry=function(e){var wt=e._length,bt=e._topRadius,kt=e._bottomRadius,w=e._vertexFormat,et=e._slices,ri,gt,ui,yt,ci,fi,li;if(!(wt<=0)&&!(bt<0)&&!(kt<0)&&(bt!==0||kt!==0)){var at=et+et,ni=et+at,dt=at+at,ti=f.computePositions(wt,bt,kt,et,!0),ii=w.st?new Float32Array(dt*2):undefined,g=w.normal?new Float32Array(dt*3):undefined,nt=w.tangent?new Float32Array(dt*3):undefined,ft=w.bitangent?new Float32Array(dt*3):undefined,s,ei=w.normal||w.tangent||w.bitangent;if(ei){var ai=w.tangent||w.bitangent,ot=0,st=0,ht=0,oi=Math.atan2(kt-bt,wt),ct=tt;ct.z=Math.sin(oi);var si=Math.cos(oi),lt=rt,vt=it;for(s=0;s<et;s++){var hi=s/et*y.TWO_PI,vi=si*Math.cos(hi),yi=si*Math.sin(hi);ei&&(ct.x=vi,ct.y=yi,ai&&(lt=r.normalize(r.cross(r.UNIT_Z,ct,lt),lt)),w.normal&&(g[ot++]=ct.x,g[ot++]=ct.y,g[ot++]=ct.z,g[ot++]=ct.x,g[ot++]=ct.y,g[ot++]=ct.z),w.tangent&&(nt[st++]=lt.x,nt[st++]=lt.y,nt[st++]=lt.z,nt[st++]=lt.x,nt[st++]=lt.y,nt[st++]=lt.z),w.bitangent&&(vt=r.normalize(r.cross(ct,lt,vt),vt),ft[ht++]=vt.x,ft[ht++]=vt.y,ft[ht++]=vt.z,ft[ht++]=vt.x,ft[ht++]=vt.y,ft[ht++]=vt.z))}for(s=0;s<et;s++)w.normal&&(g[ot++]=0,g[ot++]=0,g[ot++]=-1),w.tangent&&(nt[st++]=1,nt[st++]=0,nt[st++]=0),w.bitangent&&(ft[ht++]=0,ft[ht++]=-1,ft[ht++]=0);for(s=0;s<et;s++)w.normal&&(g[ot++]=0,g[ot++]=0,g[ot++]=1),w.tangent&&(nt[st++]=1,nt[st++]=0,nt[st++]=0),w.bitangent&&(ft[ht++]=0,ft[ht++]=1,ft[ht++]=0)}var pi=12*et-12,b=v.createTypedArray(dt,pi),k=0,pt=0;for(s=0;s<et-1;s++)b[k++]=pt,b[k++]=pt+2,b[k++]=pt+3,b[k++]=pt,b[k++]=pt+3,b[k++]=pt+1,pt+=2;for(b[k++]=at-2,b[k++]=0,b[k++]=1,b[k++]=at-2,b[k++]=1,b[k++]=at-1,s=1;s<et-1;s++)b[k++]=at+s+1,b[k++]=at+s,b[k++]=at;for(s=1;s<et-1;s++)b[k++]=ni,b[k++]=ni+s,b[k++]=ni+s+1;if(ri=0,w.st)for(gt=Math.max(bt,kt),s=0;s<dt;s++)ui=r.fromArray(ti,s*3,ut),ii[ri++]=(ui.x+gt)/(2*gt),ii[ri++]=(ui.y+gt)/(2*gt);return yt=new l,w.position&&(yt.position=new c({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:ti})),w.normal&&(yt.normal=new c({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:g})),w.tangent&&(yt.tangent=new c({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:nt})),w.bitangent&&(yt.bitangent=new c({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:ft})),w.st&&(yt.st=new c({componentDatatype:u.FLOAT,componentsPerAttribute:2,values:ii})),d.x=wt*.5,d.y=Math.max(kt,bt),ci=new t(r.ZERO,i.magnitude(d)),o(e._offsetAttribute)&&(wt=ti.length,fi=new Uint8Array(wt/3),li=e._offsetAttribute===a.NONE?0:1,n(fi,li),yt.applyOffset=new c({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:1,values:fi})),new h({attributes:yt,indices:b,primitiveType:p.TRIANGLES,boundingSphere:ci,offsetAttribute:e._offsetAttribute})}},b.getUnitCylinder=function(){return o(nt)||(nt=b.createGeometry(new b({topRadius:1,bottomRadius:1,length:1,vertexFormat:w.POSITION_ONLY}))),nt},b});t("Core/CylinderOutlineGeometry",["./arrayFill","./BoundingSphere","./Cartesian2","./Cartesian3","./Check","./ComponentDatatype","./CylinderGeometryLibrary","./defaultValue","./defined","./DeveloperError","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function b(n){n=o(n,o.EMPTY_OBJECT);var t=n.length,i=n.topRadius,r=n.bottomRadius,f=o(n.slices,128),e=Math.max(o(n.numberOfVerticalLines,16),0);if(u.typeOf.number("options.positions",t),u.typeOf.number("options.topRadius",i),u.typeOf.number("options.bottomRadius",r),u.typeOf.number.greaterThanOrEquals("options.slices",f,3),s(n.offsetAttribute)&&n.offsetAttribute===v.TOP)throw new h("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=t;this._topRadius=i;this._bottomRadius=r;this._slices=f;this._numberOfVerticalLines=e;this._offsetAttribute=n.offsetAttribute;this._workerName="createCylinderOutlineGeometry"}var k=new i,w;return b.packedLength=6,b.pack=function(n,t,i){return u.typeOf.object("value",n),u.defined("array",t),i=o(i,0),t[i++]=n._length,t[i++]=n._topRadius,t[i++]=n._bottomRadius,t[i++]=n._slices,t[i++]=n._numberOfVerticalLines,t[i]=o(n._offsetAttribute,-1),t},w={length:undefined,topRadius:undefined,bottomRadius:undefined,slices:undefined,numberOfVerticalLines:undefined,offsetAttribute:undefined},b.unpack=function(n,t,i){u.defined("array",n);t=o(t,0);var f=n[t++],e=n[t++],h=n[t++],c=n[t++],l=n[t++],r=n[t];return s(i)?(i._length=f,i._topRadius=e,i._bottomRadius=h,i._slices=c,i._numberOfVerticalLines=l,i._offsetAttribute=r===-1?undefined:r,i):(w.length=f,w.topRadius=e,w.bottomRadius=h,w.slices=c,w.numberOfVerticalLines=l,w.offsetAttribute=r===-1?undefined:r,new b(w))},b.createGeometry=function(u){var d=u._length,g=u._topRadius,nt=u._bottomRadius,o=u._slices,it=u._numberOfVerticalLines,rt,h,b,w,tt,st,ut,ht;if(!(d<=0)&&!(g<0)&&!(nt<0)&&(g!==0||nt!==0)){var ct=o*2,ft=e.computePositions(d,g,nt,o,!1),et=o*2,ot;for(it>0&&(rt=Math.min(it,o),ot=Math.round(o/rt),et+=rt),h=y.createTypedArray(ct,et*2),b=0,w=0;w<o-1;w++)h[b++]=w,h[b++]=w+1,h[b++]=w+o,h[b++]=w+1+o;if(h[b++]=o-1,h[b++]=0,h[b++]=o+o-1,h[b++]=o,it>0)for(w=0;w<o;w+=ot)h[b++]=w,h[b++]=w+o;return tt=new a,tt.position=new l({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:ft}),k.x=d*.5,k.y=Math.max(nt,g),st=new t(r.ZERO,i.magnitude(k)),s(u._offsetAttribute)&&(d=ft.length,ut=new Uint8Array(d/3),ht=u._offsetAttribute===v.NONE?0:1,n(ut,ht),tt.applyOffset=new l({componentDatatype:f.UNSIGNED_BYTE,componentsPerAttribute:1,values:ut})),new c({attributes:tt,indices:h,primitiveType:p.LINES,boundingSphere:st,offsetAttribute:u._offsetAttribute})}},b});t("Core/decodeGoogleEarthEnterpriseData",["./Check","./RuntimeError"],function(n,t){"use strict";function i(f,e){var l,h,v;if(i.passThroughDataForTesting)return e;if(n.typeOf.object("key",f),n.typeOf.object("data",e),l=f.byteLength,l===0||l%4!=0)throw new t("The length of key must be greater than 0 and a multiple of 4.");if(h=new DataView(e),v=h.getUint32(0,!0),v===r||v===u)return e;for(var y=new DataView(f),o=0,a=e.byteLength,p=a-a%8,w=l,s,c=8;o<p;)for(c=(c+8)%24,s=c;o<p&&s<w;)h.setUint32(o,h.getUint32(o,!0)^y.getUint32(s,!0),!0),h.setUint32(o+4,h.getUint32(o+4,!0)^y.getUint32(s+4,!0),!0),o+=8,s+=24;if(o<a)for(s>=w&&(c=(c+8)%24,s=c);o<a;)h.setUint8(o,h.getUint8(o)^y.getUint8(s)),o++,s++}var r=1953029805,u=2917034100;return i.passThroughDataForTesting=!1,i});t("Core/DefaultProxy",[],function(){"use strict";function n(n){this.proxy=n}return n.prototype.getURL=function(n){var t=this.proxy.indexOf("?")===-1?"?":"";return this.proxy+t+encodeURIComponent(n)},n});t("Core/DistanceDisplayCondition",["./defaultValue","./defined","./defineProperties","./DeveloperError"],function(n,t,i,r){"use strict";function u(t,i){t=n(t,0);this._near=t;i=n(i,Number.MAX_VALUE);this._far=i}return i(u.prototype,{near:{get:function(){return this._near},set:function(n){this._near=n}},far:{get:function(){return this._far},set:function(n){this._far=n}}}),u.packedLength=2,u.pack=function(i,u,f){if(!t(i))throw new r("value is required");if(!t(u))throw new r("array is required");return f=n(f,0),u[f++]=i.near,u[f]=i.far,u},u.unpack=function(i,f,e){if(!t(i))throw new r("array is required");return f=n(f,0),t(e)||(e=new u),e.near=i[f++],e.far=i[f],e},u.equals=function(n,i){return n===i||t(n)&&t(i)&&n.near===i.near&&n.far===i.far},u.clone=function(n,i){return t(n)?(t(i)||(i=new u),i.near=n.near,i.far=n.far,i):undefined},u.prototype.clone=function(n){return u.clone(this,n)},u.prototype.equals=function(n){return u.equals(this,n)},u});t("Core/DistanceDisplayConditionGeometryInstanceAttribute",["./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError"],function(n,t,i,r,u){"use strict";function f(n,i){if(n=t(n,0),i=t(i,Number.MAX_VALUE),i<=n)throw new u("far distance must be greater than near distance.");this.value=new Float32Array([n,i])}return r(f.prototype,{componentDatatype:{get:function(){return n.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}}),f.fromDistanceDisplayCondition=function(n){if(!i(n))throw new u("distanceDisplayCondition is required.");if(n.far<=n.near)throw new u("distanceDisplayCondition.far distance must be greater than distanceDisplayCondition.near distance.");return new f(n.near,n.far)},f.toValue=function(n,t){if(!i(n))throw new u("distanceDisplayCondition is required.");return i(t)?(t[0]=n.near,t[1]=n.far,t):new Float32Array([n.near,n.far])},f});t("Core/DoublyLinkedList",["./defined","./defineProperties"],function(n,t){"use strict";function i(){this.head=undefined;this.tail=undefined;this._length=0}function u(n,t,i){this.item=n;this.previous=t;this.next=i}function r(t,i){n(i.previous)&&n(i.next)?(i.previous.next=i.next,i.next.previous=i.previous):n(i.previous)?(i.previous.next=undefined,t.tail=i.previous):n(i.next)?(i.next.previous=undefined,t.head=i.next):(t.head=undefined,t.tail=undefined);i.next=undefined;i.previous=undefined}return t(i.prototype,{length:{get:function(){return this._length}}}),i.prototype.add=function(t){var i=new u(t,this.tail,undefined);return n(this.tail)?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i},i.prototype.remove=function(t){n(t)&&(r(this,t),--this._length)},i.prototype.splice=function(n,t){if(n!==t){r(this,t);var i=n.next;n.next=t;this.tail===n?this.tail=t:i.previous=t;t.next=i;t.previous=n}},i});t("ThirdParty/Tween",[],function(){Date.now===undefined&&(Date.now=function(){return(new Date).valueOf()});var n=n||function(){var n=[];return{REVISION:"13",getAll:function(){return n},removeAll:function(){n=[]},add:function(t){n.push(t)},remove:function(t){var i=n.indexOf(t);i!==-1&&n.splice(i,1)},update:function(t){if(n.length===0)return!1;var i=0;for(t=t!==undefined?t:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now();i<n.length;)n[i].update(t)?i++:n.splice(i,1);return!0}}}();return n.Tween=function(t){var r=t,u={},i={},f={},b=1e3,s=0,h=!1,c=!1,k=!1,l=0,e=null,d=n.Easing.Linear.None,g=n.Interpolation.Linear,o=[],a=null,v=!1,y=null,p=null,w=null;for(var nt in t)u[nt]=parseFloat(t[nt],10);this.to=function(n,t){return t!==undefined&&(b=t),i=n,this};this.start=function(t){n.add(this);c=!0;v=!1;e=(t!==undefined?t:typeof window!="undefined"&&window.performance!==undefined&&window.performance.now!==undefined?window.performance.now():Date.now())+l;for(var o in i){if(i[o]instanceof Array){if(i[o].length===0)continue;i[o]=[r[o]].concat(i[o])}u[o]=r[o];u[o]instanceof Array==!1&&(u[o]*=1);f[o]=u[o]||0}return this};this.stop=function(){return c?(n.remove(this),c=!1,w!==null&&w.call(r),this.stopChainedTweens(),this):this};this.stopChainedTweens=function(){for(var n=0,t=o.length;n<t;n++)o[n].stop()};this.delay=function(n){return l=n,this};this.repeat=function(n){return s=n,this};this.yoyo=function(n){return h=n,this};this.easing=function(n){return d=n,this};this.interpolation=function(n){return g=n,this};this.chain=function(){return o=arguments,this};this.onStart=function(n){return a=n,this};this.onUpdate=function(n){return y=n,this};this.onComplete=function(n){return p=n,this};this.onStop=function(n){return w=n,this};this.update=function(n){var t,w,nt,tt,c,rt,it,ut;if(n<e)return!0;v===!1&&(a!==null&&a.call(r),v=!0);w=(n-e)/b;w=w>1?1:w;nt=d(w);for(t in i)tt=u[t]||0,c=i[t],c instanceof Array?r[t]=g(c,nt):(typeof c=="string"&&(c=tt+parseFloat(c,10)),typeof c=="number"&&(r[t]=tt+(c-tt)*nt));if(y!==null&&y.call(r,nt),w==1){if(s>0){isFinite(s)&&s--;for(t in f)typeof i[t]=="string"&&(f[t]=f[t]+parseFloat(i[t],10)),h&&(rt=f[t],f[t]=i[t],i[t]=rt),u[t]=f[t];return h&&(k=!k),e=n+l,!0}for(p!==null&&p.call(r),it=0,ut=o.length;it<ut;it++)o[it].start(n);return!1}return!0}},n.Easing={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},Out:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},InOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(t){return t<.5?n.Easing.Bounce.In(t*2)*.5:n.Easing.Bounce.Out(t*2-1)*.5+.5}}},n.Interpolation={Linear:function(t,i){var r=t.length-1,u=r*i,f=Math.floor(u),e=n.Interpolation.Utils.Linear;return i<0?e(t[0],t[1],u):i>1?e(t[r],t[r-1],r-u):e(t[f],t[f+1>r?r:f+1],u-f)},Bezier:function(t,i){for(var f=0,u=t.length-1,e=Math.pow,o=n.Interpolation.Utils.Bernstein,r=0;r<=u;r++)f+=e(1-i,u-r)*e(i,r)*t[r]*o(u,r);return f},CatmullRom:function(t,i){var r=t.length-1,f=r*i,u=Math.floor(f),e=n.Interpolation.Utils.CatmullRom;return t[0]===t[r]?(i<0&&(u=Math.floor(f=r*(1+i))),e(t[(u-1+r)%r],t[u],t[(u+1)%r],t[(u+2)%r],f-u)):i<0?t[0]-(e(t[0],t[0],t[1],t[1],-f)-t[0]):i>1?t[r]-(e(t[r],t[r],t[r-1],t[r-1],f-r)-t[r]):e(t[u?u-1:0],t[u],t[r<u+1?r:u+1],t[r<u+2?r:u+2],f-u)},Utils:{Linear:function(n,t,i){return(t-n)*i+n},Bernstein:function(t,i){var r=n.Interpolation.Utils.Factorial;return r(t)/r(i)/r(t-i)},Factorial:function(){var n=[1];return function(t){var r=1,i;if(n[t])return n[t];for(i=t;i>1;i--)r*=i;return n[t]=r}}(),CatmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t}}},n});t("Core/EasingFunction",["../ThirdParty/Tween","./freezeObject"],function(n,t){"use strict";var i={LINEAR_NONE:n.Easing.Linear.None,QUADRACTIC_IN:n.Easing.Quadratic.In,QUADRACTIC_OUT:n.Easing.Quadratic.Out,QUADRACTIC_IN_OUT:n.Easing.Quadratic.InOut,CUBIC_IN:n.Easing.Cubic.In,CUBIC_OUT:n.Easing.Cubic.Out,CUBIC_IN_OUT:n.Easing.Cubic.InOut,QUARTIC_IN:n.Easing.Quartic.In,QUARTIC_OUT:n.Easing.Quartic.Out,QUARTIC_IN_OUT:n.Easing.Quartic.InOut,QUINTIC_IN:n.Easing.Quintic.In,QUINTIC_OUT:n.Easing.Quintic.Out,QUINTIC_IN_OUT:n.Easing.Quintic.InOut,SINUSOIDAL_IN:n.Easing.Sinusoidal.In,SINUSOIDAL_OUT:n.Easing.Sinusoidal.Out,SINUSOIDAL_IN_OUT:n.Easing.Sinusoidal.InOut,EXPONENTIAL_IN:n.Easing.Exponential.In,EXPONENTIAL_OUT:n.Easing.Exponential.Out,EXPONENTIAL_IN_OUT:n.Easing.Exponential.InOut,CIRCULAR_IN:n.Easing.Circular.In,CIRCULAR_OUT:n.Easing.Circular.Out,CIRCULAR_IN_OUT:n.Easing.Circular.InOut,ELASTIC_IN:n.Easing.Elastic.In,ELASTIC_OUT:n.Easing.Elastic.Out,ELASTIC_IN_OUT:n.Easing.Elastic.InOut,BACK_IN:n.Easing.Back.In,BACK_OUT:n.Easing.Back.Out,BACK_IN_OUT:n.Easing.Back.InOut,BOUNCE_IN:n.Easing.Bounce.In,BOUNCE_OUT:n.Easing.Bounce.Out,BOUNCE_IN_OUT:n.Easing.Bounce.InOut};return t(i)});t("Core/EllipsoidGeometry",["./arrayFill","./BoundingSphere","./Cartesian2","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PrimitiveType","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(n){n=f(n,f.EMPTY_OBJECT);var u=f(n.radii,st),t=Math.round(f(n.stackPartitions,64)),i=Math.round(f(n.slicePartitions,64)),s=f(n.vertexFormat,w.DEFAULT);if(i<3)throw new o("options.slicePartitions cannot be less than three.");if(t<3)throw new o("options.stackPartitions cannot be less than three.");if(e(n.offsetAttribute)&&n.offsetAttribute===a.TOP)throw new o("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=r.clone(u);this._stackPartitions=t;this._slicePartitions=i;this._vertexFormat=w.clone(s);this._offsetAttribute=n.offsetAttribute;this._workerName="createEllipsoidGeometry"}var rt=new r,ut=new r,ft=new r,et=new r,ot=new r,st=new r(1,1,1),g=Math.cos,nt=Math.sin,d;b.packedLength=r.packedLength+w.packedLength+3;b.pack=function(n,t,i){if(!e(n))throw new o("value is required");if(!e(t))throw new o("array is required");return i=f(i,0),r.pack(n._radii,t,i),i+=r.packedLength,w.pack(n._vertexFormat,t,i),i+=w.packedLength,t[i++]=n._stackPartitions,t[i++]=n._slicePartitions,t[i]=f(n._offsetAttribute,-1),t};var tt=new r,it=new w,k={radii:tt,vertexFormat:it,stackPartitions:undefined,slicePartitions:undefined,offsetAttribute:undefined};return b.unpack=function(n,t,i){var s,h;if(!e(n))throw new o("array is required");t=f(t,0);s=r.unpack(n,t,tt);t+=r.packedLength;h=w.unpack(n,t,it);t+=w.packedLength;var c=n[t++],l=n[t++],u=n[t];return e(i)?(i._radii=r.clone(s,i._radii),i._vertexFormat=w.clone(h,i._vertexFormat),i._stackPartitions=c,i._slicePartitions=l,i._offsetAttribute=u===-1?undefined:u,i):(k.stackPartitions=c,k.slicePartitions=l,k.offsetAttribute=u===-1?undefined:u,new b(k))},b.createGeometry=function(f){var ht=f._radii,ii,yt,li,ct,lt,st,wt,pt,bt;if(!(ht.x<=0)&&!(ht.y<=0)&&!(ht.z<=0)){for(var ni=s.fromCartesian3(ht),d=f._vertexFormat,k=f._slicePartitions+1,at=f._stackPartitions+1,vt=at*k,tt=new Float64Array(vt*3),vi=6*(k-1)*(at-2),it=v.createTypedArray(vt,vi),kt=d.normal?new Float32Array(vt*3):undefined,dt=d.tangent?new Float32Array(vt*3):undefined,gt=d.bitangent?new Float32Array(vt*3):undefined,ti=d.st?new Float32Array(vt*2):undefined,ei=new Array(k),oi=new Array(k),w,b=0,o=0;o<k;o++)ii=y.TWO_PI*o/(k-1),ei[o]=g(ii),oi[o]=nt(ii),tt[b++]=0,tt[b++]=0,tt[b++]=ht.z;for(o=1;o<at-1;o++){var si=Math.PI*o/(at-1),hi=nt(si),yi=ht.x*hi,pi=ht.y*hi,wi=ht.z*g(si);for(w=0;w<k;w++)tt[b++]=ei[w]*yi,tt[b++]=oi[w]*pi,tt[b++]=wi}for(o=0;o<k;o++)tt[b++]=0,tt[b++]=0,tt[b++]=-ht.z;yt=new l;d.position&&(yt.position=new c({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:tt}));var ci=0,ri=0,ui=0,fi=0;if(d.st||d.normal||d.tangent||d.bitangent){for(o=0;o<vt;o++)li=r.fromArray(tt,o*3,rt),ct=ni.geodeticSurfaceNormal(li,ut),d.st&&(lt=i.negate(ct,ot),i.magnitude(lt)<y.EPSILON6&&(b=(o+k*Math.floor(at*.5))*3,b>tt.length&&(b=(o-k*Math.floor(at*.5))*3),r.fromArray(tt,b,lt),ni.geodeticSurfaceNormal(lt,lt),i.negate(lt,lt)),ti[ci++]=Math.atan2(lt.y,lt.x)/y.TWO_PI+.5,ti[ci++]=Math.asin(ct.z)/Math.PI+.5),d.normal&&(kt[ri++]=ct.x,kt[ri++]=ct.y,kt[ri++]=ct.z),(d.tangent||d.bitangent)&&(st=ft,o<k||o>vt-k-1?(r.cross(r.UNIT_X,ct,st),r.normalize(st,st)):(r.cross(r.UNIT_Z,ct,st),r.normalize(st,st)),d.tangent&&(dt[ui++]=st.x,dt[ui++]=st.y,dt[ui++]=st.z),d.bitangent&&(wt=r.cross(ct,st,et),r.normalize(wt,wt),gt[fi++]=wt.x,gt[fi++]=wt.y,gt[fi++]=wt.z));d.st&&(yt.st=new c({componentDatatype:u.FLOAT,componentsPerAttribute:2,values:ti}));d.normal&&(yt.normal=new c({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:kt}));d.tangent&&(yt.tangent=new c({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:dt}));d.bitangent&&(yt.bitangent=new c({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:gt}))}if(e(f._offsetAttribute)){var bi=tt.length,ai=new Uint8Array(bi/3),ki=f._offsetAttribute===a.NONE?0:1;n(ai,ki);yt.applyOffset=new c({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:1,values:ai})}for(b=0,w=0;w<k-1;w++)it[b++]=k+w,it[b++]=k+w+1,it[b++]=w+1;for(o=1;o<at-2;o++)for(pt=o*k,bt=(o+1)*k,w=0;w<k-1;w++)it[b++]=bt+w,it[b++]=bt+w+1,it[b++]=pt+w+1,it[b++]=bt+w,it[b++]=pt+w+1,it[b++]=pt+w;for(o=at-2,pt=o*k,bt=(o+1)*k,w=0;w<k-1;w++)it[b++]=bt+w,it[b++]=pt+w+1,it[b++]=pt+w;return new h({attributes:yt,indices:it,primitiveType:p.TRIANGLES,boundingSphere:t.fromEllipsoid(ni),offsetAttribute:f._offsetAttribute})}},b.getUnitEllipsoid=function(){return e(d)||(d=b.createGeometry(new b({radii:new r(1,1,1),vertexFormat:w.POSITION_ONLY}))),d},b});t("Core/EllipsoidOutlineGeometry",["./arrayFill","./BoundingSphere","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n){n=u(n,u.EMPTY_OBJECT);var s=u(n.radii,g),t=Math.round(u(n.stackPartitions,10)),r=Math.round(u(n.slicePartitions,8)),o=Math.round(u(n.subdivisions,128));if(t<1)throw new e("options.stackPartitions cannot be less than 1");if(r<0)throw new e("options.slicePartitions cannot be less than 0");if(o<0)throw new e("options.subdivisions must be greater than or equal to zero.");if(f(n.offsetAttribute)&&n.offsetAttribute===l.TOP)throw new e("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=i.clone(s);this._stackPartitions=t;this._slicePartitions=r;this._subdivisions=o;this._offsetAttribute=n.offsetAttribute;this._workerName="createEllipsoidOutlineGeometry"}var g=new i(1,1,1),b=Math.cos,k=Math.sin,d,w;return p.packedLength=i.packedLength+4,p.pack=function(n,t,r){if(!f(n))throw new e("value is required");if(!f(t))throw new e("array is required");return r=u(r,0),i.pack(n._radii,t,r),r+=i.packedLength,t[r++]=n._stackPartitions,t[r++]=n._slicePartitions,t[r++]=n._subdivisions,t[r]=u(n._offsetAttribute,-1),t},d=new i,w={radii:d,stackPartitions:undefined,slicePartitions:undefined,subdivisions:undefined,offsetAttribute:undefined},p.unpack=function(n,t,r){var s;if(!f(n))throw new e("array is required");t=u(t,0);s=i.unpack(n,t,d);t+=i.packedLength;var h=n[t++],c=n[t++],l=n[t++],o=n[t];return f(r)?(r._radii=i.clone(s,r._radii),r._stackPartitions=h,r._slicePartitions=c,r._subdivisions=l,r._offsetAttribute=o===-1?undefined:o,r):(w.stackPartitions=h,w.slicePartitions=c,w.subdivisions=l,w.offsetAttribute=o===-1?undefined:o,new p(w))},p.createGeometry=function(i){var tt=i._radii,st,ht,at,vt,lt,yt;if(!(tt.x<=0)&&!(tt.y<=0)&&!(tt.z<=0)){for(var kt=o.fromCartesian3(tt),ft=i._stackPartitions,d=i._slicePartitions,g=i._subdivisions,pt=g*(ft+d-1),wt=pt-d+2,w=new Float64Array(wt*3),nt=a.createTypedArray(wt,pt*2),e,it,rt,ct,ut,p=0,et=new Array(g),ot=new Array(g),u=0;u<g;u++)it=v.TWO_PI*u/g,et[u]=b(it),ot[u]=k(it);for(u=1;u<ft;u++)for(rt=Math.PI*u/ft,ct=b(rt),ut=k(rt),e=0;e<g;e++)w[p++]=tt.x*et[e]*ut,w[p++]=tt.y*ot[e]*ut,w[p++]=tt.z*ct;for(et.length=d,ot.length=d,u=0;u<d;u++)it=v.TWO_PI*u/d,et[u]=b(it),ot[u]=k(it);for(w[p++]=0,w[p++]=0,w[p++]=tt.z,u=1;u<g;u++)for(rt=Math.PI*u/g,ct=b(rt),ut=k(rt),e=0;e<d;e++)w[p++]=tt.x*et[e]*ut,w[p++]=tt.y*ot[e]*ut,w[p++]=tt.z*ct;for(w[p++]=0,w[p++]=0,w[p++]=-tt.z,p=0,u=0;u<ft-1;++u){for(st=u*g,e=0;e<g-1;++e)nt[p++]=st+e,nt[p++]=st+e+1;nt[p++]=st+g-1;nt[p++]=st}for(ht=g*(ft-1),e=1;e<d+1;++e)nt[p++]=ht,nt[p++]=ht+e;for(u=0;u<g-2;++u){for(at=u*d+1+ht,vt=(u+1)*d+1+ht,e=0;e<d-1;++e)nt[p++]=vt+e,nt[p++]=at+e;nt[p++]=vt+d-1;nt[p++]=at+d-1}for(lt=w.length/3-1,e=lt-1;e>lt-d-1;--e)nt[p++]=lt,nt[p++]=e;if(yt=new c({position:new h({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:w})}),f(i._offsetAttribute)){var dt=w.length,bt=new Uint8Array(dt/3),gt=i._offsetAttribute===l.NONE?0:1;n(bt,gt);yt.applyOffset=new h({componentDatatype:r.UNSIGNED_BYTE,componentsPerAttribute:1,values:bt})}return new s({attributes:yt,indices:nt,primitiveType:y.LINES,boundingSphere:t.fromEllipsoid(kt),offsetAttribute:i._offsetAttribute})}},p});t("Core/EllipsoidTerrainProvider",["../ThirdParty/when","./defaultValue","./defined","./defineProperties","./Ellipsoid","./Event","./GeographicTilingScheme","./HeightmapTerrainData","./TerrainProvider"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(r){r=t(r,{});this._tilingScheme=r.tilingScheme;i(this._tilingScheme)||(this._tilingScheme=new e({ellipsoid:t(r.ellipsoid,u.WGS84)}));this._levelZeroMaximumGeometricError=s.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,64,this._tilingScheme.getNumberOfXTilesAtLevel(0));this._errorEvent=new f;this._readyPromise=n.resolve(!0)}return r(h.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return undefined}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}}),h.prototype.requestTileGeometry=function(){var t=16,i=16;return n.resolve(new o({buffer:new Uint8Array(t*i),width:t,height:i}))},h.prototype.getLevelMaximumGeometricError=function(n){return this._levelZeroMaximumGeometricError/(1<<n)},h.prototype.getTileDataAvailable=function(){return undefined},h});t("Core/EventHelper",["./defined","./DeveloperError"],function(n,t){"use strict";function i(){this._removalFunctions=[]}return i.prototype.add=function(i,r,u){var f,e;if(!n(i))throw new t("event is required");return f=i.addEventListener(r,u),this._removalFunctions.push(f),e=this,function(){f();var n=e._removalFunctions;n.splice(n.indexOf(f),1)}},i.prototype.removeAll=function(){for(var n=this._removalFunctions,t=0,i=n.length;t<i;++t)n[t]();n.length=0},i});t("Core/ExtrapolationType",["./freezeObject"],function(n){"use strict";return n({NONE:0,HOLD:1,EXTRAPOLATE:2})});t("Core/OrthographicOffCenterFrustum",["./Cartesian3","./Cartesian4","./CullingVolume","./defaultValue","./defined","./defineProperties","./DeveloperError","./Math","./Matrix4"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(n){n=r(n,r.EMPTY_OBJECT);this.left=n.left;this._left=undefined;this.right=n.right;this._right=undefined;this.top=n.top;this._top=undefined;this.bottom=n.bottom;this._bottom=undefined;this.near=r(n.near,1);this._near=this.near;this.far=r(n.far,5e8);this._far=this.far;this._cullingVolume=new i;this._orthographicMatrix=new s}function l(n){if(!u(n.right)||!u(n.left)||!u(n.top)||!u(n.bottom)||!u(n.near)||!u(n.far))throw new e("right, left, top, bottom, near, or far parameters are not set.");if(n.top!==n._top||n.bottom!==n._bottom||n.left!==n._left||n.right!==n._right||n.near!==n._near||n.far!==n._far){if(n.left>n.right)throw new e("right must be greater than left.");if(n.bottom>n.top)throw new e("top must be greater than bottom.");if(n.near<=0||n.near>n.far)throw new e("near must be greater than zero and less than far.");n._left=n.left;n._right=n.right;n._top=n.top;n._bottom=n.bottom;n._near=n.near;n._far=n.far;n._orthographicMatrix=s.computeOrthographicOffCenter(n.left,n.right,n.bottom,n.top,n.near,n.far,n._orthographicMatrix)}}f(h.prototype,{projectionMatrix:{get:function(){return l(this),this._orthographicMatrix}}});var a=new n,v=new n,y=new n,c=new n;return h.prototype.computeCullingVolume=function(i,r,f){var p,s,o;if(!u(i))throw new e("position is required.");if(!u(r))throw new e("direction is required.");if(!u(f))throw new e("up is required.");var h=this._cullingVolume.planes,w=this.top,b=this.bottom,k=this.right,d=this.left,g=this.near,nt=this.far,l=n.cross(r,f,a);return n.normalize(l,l),p=v,n.multiplyByScalar(r,g,p),n.add(i,p,p),s=y,n.multiplyByScalar(l,d,s),n.add(p,s,s),o=h[0],u(o)||(o=h[0]=new t),o.x=l.x,o.y=l.y,o.z=l.z,o.w=-n.dot(l,s),n.multiplyByScalar(l,k,s),n.add(p,s,s),o=h[1],u(o)||(o=h[1]=new t),o.x=-l.x,o.y=-l.y,o.z=-l.z,o.w=-n.dot(n.negate(l,c),s),n.multiplyByScalar(f,b,s),n.add(p,s,s),o=h[2],u(o)||(o=h[2]=new t),o.x=f.x,o.y=f.y,o.z=f.z,o.w=-n.dot(f,s),n.multiplyByScalar(f,w,s),n.add(p,s,s),o=h[3],u(o)||(o=h[3]=new t),o.x=-f.x,o.y=-f.y,o.z=-f.z,o.w=-n.dot(n.negate(f,c),s),o=h[4],u(o)||(o=h[4]=new t),o.x=r.x,o.y=r.y,o.z=r.z,o.w=-n.dot(r,p),n.multiplyByScalar(r,nt,s),n.add(i,s,s),o=h[5],u(o)||(o=h[5]=new t),o.x=-r.x,o.y=-r.y,o.z=-r.z,o.w=-n.dot(n.negate(r,c),s),this._cullingVolume},h.prototype.getPixelDimensions=function(n,t,i,r){if(l(this),!u(n)||!u(t))throw new e("Both drawingBufferWidth and drawingBufferHeight are required.");if(n<=0)throw new e("drawingBufferWidth must be greater than zero.");if(t<=0)throw new e("drawingBufferHeight must be greater than zero.");if(!u(i))throw new e("distance is required.");if(!u(r))throw new e("A result object is required.");var f=this.right-this.left,o=this.top-this.bottom,s=f/n,h=o/t;return r.x=s,r.y=h,r},h.prototype.clone=function(n){return u(n)||(n=new h),n.left=this.left,n.right=this.right,n.top=this.top,n.bottom=this.bottom,n.near=this.near,n.far=this.far,n._left=undefined,n._right=undefined,n._top=undefined,n._bottom=undefined,n._near=undefined,n._far=undefined,n},h.prototype.equals=function(n){return u(n)&&n instanceof h&&this.right===n.right&&this.left===n.left&&this.top===n.top&&this.bottom===n.bottom&&this.near===n.near&&this.far===n.far},h.prototype.equalsEpsilon=function(n,t,i){return n===this||u(n)&&n instanceof h&&o.equalsEpsilon(this.right,n.right,t,i)&&o.equalsEpsilon(this.left,n.left,t,i)&&o.equalsEpsilon(this.top,n.top,t,i)&&o.equalsEpsilon(this.bottom,n.bottom,t,i)&&o.equalsEpsilon(this.near,n.near,t,i)&&o.equalsEpsilon(this.far,n.far,t,i)},h});t("Core/OrthographicFrustum",["./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./Math","./OrthographicOffCenterFrustum"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this._offCenterFrustum=new e;this.width=n.width;this._width=undefined;this.aspectRatio=n.aspectRatio;this._aspectRatio=undefined;this.near=t(n.near,1);this._near=this.near;this.far=t(n.far,5e8);this._far=this.far}function s(n){var t,r;if(!i(n.width)||!i(n.aspectRatio)||!i(n.near)||!i(n.far))throw new u("width, aspectRatio, near, or far parameters are not set.");if(t=n._offCenterFrustum,n.width!==n._width||n.aspectRatio!==n._aspectRatio||n.near!==n._near||n.far!==n._far){if(n.aspectRatio<0)throw new u("aspectRatio must be positive.");if(n.near<0||n.near>n.far)throw new u("near must be greater than zero and less than far.");n._aspectRatio=n.aspectRatio;n._width=n.width;n._near=n.near;n._far=n.far;r=1/n.aspectRatio;t.right=n.width*.5;t.left=-t.right;t.top=r*t.right;t.bottom=-t.top;t.near=n.near;t.far=n.far}}return o.packedLength=4,o.pack=function(i,r,u){return n.typeOf.object("value",i),n.defined("array",r),u=t(u,0),r[u++]=i.width,r[u++]=i.aspectRatio,r[u++]=i.near,r[u]=i.far,r},o.unpack=function(r,u,f){return n.defined("array",r),u=t(u,0),i(f)||(f=new o),f.width=r[u++],f.aspectRatio=r[u++],f.near=r[u++],f.far=r[u],f},r(o.prototype,{projectionMatrix:{get:function(){return s(this),this._offCenterFrustum.projectionMatrix}}}),o.prototype.computeCullingVolume=function(n,t,i){return s(this),this._offCenterFrustum.computeCullingVolume(n,t,i)},o.prototype.getPixelDimensions=function(n,t,i,r){return s(this),this._offCenterFrustum.getPixelDimensions(n,t,i,r)},o.prototype.clone=function(n){return i(n)||(n=new o),n.aspectRatio=this.aspectRatio,n.width=this.width,n.near=this.near,n.far=this.far,n._aspectRatio=undefined,n._width=undefined,n._near=undefined,n._far=undefined,this._offCenterFrustum.clone(n._offCenterFrustum),n},o.prototype.equals=function(n){return!i(n)||!(n instanceof o)?!1:(s(this),s(n),this.width===n.width&&this.aspectRatio===n.aspectRatio&&this._offCenterFrustum.equals(n._offCenterFrustum))},o.prototype.equalsEpsilon=function(n,t,r){return!i(n)||!(n instanceof o)?!1:(s(this),s(n),f.equalsEpsilon(this.width,n.width,t,r)&&f.equalsEpsilon(this.aspectRatio,n.aspectRatio,t,r)&&this._offCenterFrustum.equalsEpsilon(n._offCenterFrustum,t,r))},o});t("Core/PerspectiveOffCenterFrustum",["./Cartesian3","./Cartesian4","./CullingVolume","./defaultValue","./defined","./defineProperties","./DeveloperError","./Math","./Matrix4"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(n){n=r(n,r.EMPTY_OBJECT);this.left=n.left;this._left=undefined;this.right=n.right;this._right=undefined;this.top=n.top;this._top=undefined;this.bottom=n.bottom;this._bottom=undefined;this.near=r(n.near,1);this._near=this.near;this.far=r(n.far,5e8);this._far=this.far;this._cullingVolume=new i;this._perspectiveMatrix=new s;this._infinitePerspective=new s}function c(n){if(!u(n.right)||!u(n.left)||!u(n.top)||!u(n.bottom)||!u(n.near)||!u(n.far))throw new e("right, left, top, bottom, near, or far parameters are not set.");var t=n.top,i=n.bottom,r=n.right,f=n.left,o=n.near,h=n.far;if(t!==n._top||i!==n._bottom||f!==n._left||r!==n._right||o!==n._near||h!==n._far){if(n.near<=0||n.near>n.far)throw new e("near must be greater than zero and less than far.");n._left=f;n._right=r;n._top=t;n._bottom=i;n._near=o;n._far=h;n._perspectiveMatrix=s.computePerspectiveOffCenter(f,r,i,t,o,h,n._perspectiveMatrix);n._infinitePerspective=s.computeInfinitePerspectiveOffCenter(f,r,i,t,o,n._infinitePerspective)}}f(h.prototype,{projectionMatrix:{get:function(){return c(this),this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){return c(this),this._infinitePerspective}}});var l=new n,a=new n,v=new n,y=new n;return h.prototype.computeCullingVolume=function(i,r,f){var p,o,s;if(!u(i))throw new e("position is required.");if(!u(r))throw new e("direction is required.");if(!u(f))throw new e("up is required.");var h=this._cullingVolume.planes,b=this.top,k=this.bottom,d=this.right,g=this.left,nt=this.near,tt=this.far,w=n.cross(r,f,l),c=a;return n.multiplyByScalar(r,nt,c),n.add(i,c,c),p=v,n.multiplyByScalar(r,tt,p),n.add(i,p,p),o=y,n.multiplyByScalar(w,g,o),n.add(c,o,o),n.subtract(o,i,o),n.normalize(o,o),n.cross(o,f,o),n.normalize(o,o),s=h[0],u(s)||(s=h[0]=new t),s.x=o.x,s.y=o.y,s.z=o.z,s.w=-n.dot(o,i),n.multiplyByScalar(w,d,o),n.add(c,o,o),n.subtract(o,i,o),n.cross(f,o,o),n.normalize(o,o),s=h[1],u(s)||(s=h[1]=new t),s.x=o.x,s.y=o.y,s.z=o.z,s.w=-n.dot(o,i),n.multiplyByScalar(f,k,o),n.add(c,o,o),n.subtract(o,i,o),n.cross(w,o,o),n.normalize(o,o),s=h[2],u(s)||(s=h[2]=new t),s.x=o.x,s.y=o.y,s.z=o.z,s.w=-n.dot(o,i),n.multiplyByScalar(f,b,o),n.add(c,o,o),n.subtract(o,i,o),n.cross(o,w,o),n.normalize(o,o),s=h[3],u(s)||(s=h[3]=new t),s.x=o.x,s.y=o.y,s.z=o.z,s.w=-n.dot(o,i),s=h[4],u(s)||(s=h[4]=new t),s.x=r.x,s.y=r.y,s.z=r.z,s.w=-n.dot(r,c),n.negate(r,o),s=h[5],u(s)||(s=h[5]=new t),s.x=o.x,s.y=o.y,s.z=o.z,s.w=-n.dot(o,p),this._cullingVolume},h.prototype.getPixelDimensions=function(n,t,i,r){var s;if(c(this),!u(n)||!u(t))throw new e("Both drawingBufferWidth and drawingBufferHeight are required.");if(n<=0)throw new e("drawingBufferWidth must be greater than zero.");if(t<=0)throw new e("drawingBufferHeight must be greater than zero.");if(!u(i))throw new e("distance is required.");if(!u(r))throw new e("A result object is required.");var o=1/this.near,f=this.top*o,h=2*i*f/t;return f=this.right*o,s=2*i*f/n,r.x=s,r.y=h,r},h.prototype.clone=function(n){return u(n)||(n=new h),n.right=this.right,n.left=this.left,n.top=this.top,n.bottom=this.bottom,n.near=this.near,n.far=this.far,n._left=undefined,n._right=undefined,n._top=undefined,n._bottom=undefined,n._near=undefined,n._far=undefined,n},h.prototype.equals=function(n){return u(n)&&n instanceof h&&this.right===n.right&&this.left===n.left&&this.top===n.top&&this.bottom===n.bottom&&this.near===n.near&&this.far===n.far},h.prototype.equalsEpsilon=function(n,t,i){return n===this||u(n)&&n instanceof h&&o.equalsEpsilon(this.right,n.right,t,i)&&o.equalsEpsilon(this.left,n.left,t,i)&&o.equalsEpsilon(this.top,n.top,t,i)&&o.equalsEpsilon(this.bottom,n.bottom,t,i)&&o.equalsEpsilon(this.near,n.near,t,i)&&o.equalsEpsilon(this.far,n.far,t,i)},h});t("Core/PerspectiveFrustum",["./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./Math","./PerspectiveOffCenterFrustum"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this._offCenterFrustum=new e;this.fov=n.fov;this._fov=undefined;this._fovy=undefined;this._sseDenominator=undefined;this.aspectRatio=n.aspectRatio;this._aspectRatio=undefined;this.near=t(n.near,1);this._near=this.near;this.far=t(n.far,5e8);this._far=this.far;this.xOffset=t(n.xOffset,0);this._xOffset=this.xOffset;this.yOffset=t(n.yOffset,0);this._yOffset=this.yOffset}function s(n){if(!i(n.fov)||!i(n.aspectRatio)||!i(n.near)||!i(n.far))throw new u("fov, aspectRatio, near, or far parameters are not set.");var t=n._offCenterFrustum;if(n.fov!==n._fov||n.aspectRatio!==n._aspectRatio||n.near!==n._near||n.far!==n._far||n.xOffset!==n._xOffset||n.yOffset!==n._yOffset){if(n.fov<0||n.fov>=Math.PI)throw new u("fov must be in the range [0, PI).");if(n.aspectRatio<0)throw new u("aspectRatio must be positive.");if(n.near<0||n.near>n.far)throw new u("near must be greater than zero and less than far.");n._aspectRatio=n.aspectRatio;n._fov=n.fov;n._fovy=n.aspectRatio<=1?n.fov:Math.atan(Math.tan(n.fov*.5)/n.aspectRatio)*2;n._near=n.near;n._far=n.far;n._sseDenominator=2*Math.tan(.5*n._fovy);n._xOffset=n.xOffset;n._yOffset=n.yOffset;t.top=n.near*Math.tan(.5*n._fovy);t.bottom=-t.top;t.right=n.aspectRatio*t.top;t.left=-t.right;t.near=n.near;t.far=n.far;t.right+=n.xOffset;t.left+=n.xOffset;t.top+=n.yOffset;t.bottom+=n.yOffset}}return o.packedLength=6,o.pack=function(i,r,u){return n.typeOf.object("value",i),n.defined("array",r),u=t(u,0),r[u++]=i.fov,r[u++]=i.aspectRatio,r[u++]=i.near,r[u++]=i.far,r[u++]=i.xOffset,r[u]=i.yOffset,r},o.unpack=function(r,u,f){return n.defined("array",r),u=t(u,0),i(f)||(f=new o),f.fov=r[u++],f.aspectRatio=r[u++],f.near=r[u++],f.far=r[u++],f.xOffset=r[u++],f.yOffset=r[u],f},r(o.prototype,{projectionMatrix:{get:function(){return s(this),this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){return s(this),this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){return s(this),this._fovy}},sseDenominator:{get:function(){return s(this),this._sseDenominator}}}),o.prototype.computeCullingVolume=function(n,t,i){return s(this),this._offCenterFrustum.computeCullingVolume(n,t,i)},o.prototype.getPixelDimensions=function(n,t,i,r){return s(this),this._offCenterFrustum.getPixelDimensions(n,t,i,r)},o.prototype.clone=function(n){return i(n)||(n=new o),n.aspectRatio=this.aspectRatio,n.fov=this.fov,n.near=this.near,n.far=this.far,n._aspectRatio=undefined,n._fov=undefined,n._near=undefined,n._far=undefined,this._offCenterFrustum.clone(n._offCenterFrustum),n},o.prototype.equals=function(n){return!i(n)||!(n instanceof o)?!1:(s(this),s(n),this.fov===n.fov&&this.aspectRatio===n.aspectRatio&&this._offCenterFrustum.equals(n._offCenterFrustum))},o.prototype.equalsEpsilon=function(n,t,r){return!i(n)||!(n instanceof o)?!1:(s(this),s(n),f.equalsEpsilon(this.fov,n.fov,t,r)&&f.equalsEpsilon(this.aspectRatio,n.aspectRatio,t,r)&&this._offCenterFrustum.equalsEpsilon(n._offCenterFrustum,t,r))},o});t("Core/FrustumGeometry",["./BoundingSphere","./Cartesian3","./Cartesian4","./Check","./ComponentDatatype","./defaultValue","./defined","./Geometry","./GeometryAttribute","./GeometryAttributes","./Matrix3","./Matrix4","./OrthographicFrustum","./PerspectiveFrustum","./PrimitiveType","./Quaternion","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function k(n){r.typeOf.object("options",n);r.typeOf.object("options.frustum",n.frustum);r.typeOf.object("options.origin",n.origin);r.typeOf.object("options.orientation",n.orientation);var i=n.frustum,o=n.orientation,s=n.origin,h=f(n.vertexFormat,w.DEFAULT),c=f(n._drawNearPlane,!0),u,e;i instanceof v?(u=nt,e=v.packedLength):i instanceof a&&(u=ot,e=a.packedLength);this._frustumType=u;this._frustum=i.clone();this._origin=t.clone(s);this._orientation=p.clone(o);this._drawNearPlane=c;this._vertexFormat=h;this._workerName="createFrustumGeometry";this.packedLength=2+e+t.packedLength+p.packedLength+w.packedLength}function d(n,t,i,r,u,f,o,s){for(var h=n/3*2,c=0;c<4;++c)e(t)&&(t[n]=f.x,t[n+1]=f.y,t[n+2]=f.z),e(i)&&(i[n]=o.x,i[n+1]=o.y,i[n+2]=o.z),e(r)&&(r[n]=s.x,r[n+1]=s.y,r[n+2]=s.z),n+=3;u[h]=0;u[h+1]=0;u[h+2]=1;u[h+3]=0;u[h+4]=1;u[h+5]=1;u[h+6]=0;u[h+7]=1}var nt=0,ot=1,rt,tt;k.pack=function(n,i,u){r.typeOf.object("value",n);r.defined("array",i);u=f(u,0);var e=n._frustumType,o=n._frustum;return i[u++]=e,e===nt?(v.pack(o,i,u),u+=v.packedLength):(a.pack(o,i,u),u+=a.packedLength),t.pack(n._origin,i,u),u+=t.packedLength,p.pack(n._orientation,i,u),u+=p.packedLength,w.pack(n._vertexFormat,i,u),u+=w.packedLength,i[u]=n._drawNearPlane?1:0,i};var st=new v,ht=new a,ct=new p,lt=new t,at=new w;k.unpack=function(n,i,u){var o,s,h,c,l,y,b;return(r.defined("array",n),i=f(i,0),o=n[i++],o===nt?(s=v.unpack(n,i,st),i+=v.packedLength):(s=a.unpack(n,i,ht),i+=a.packedLength),h=t.unpack(n,i,lt),i+=t.packedLength,c=p.unpack(n,i,ct),i+=p.packedLength,l=w.unpack(n,i,at),i+=w.packedLength,y=n[i]===1,!e(u))?new k({frustum:s,origin:h,orientation:c,vertexFormat:l,_drawNearPlane:y}):(b=o===u._frustumType?u._frustum:undefined,u._frustum=s.clone(b),u._frustumType=o,u._origin=t.clone(h,u._origin),u._orientation=p.clone(c,u._orientation),u._vertexFormat=w.clone(l,u._vertexFormat),u._drawNearPlane=y,u)};var vt=new c,yt=new l,it=new l,ut=new t,ft=new t,et=new t,pt=new t,wt=new t,bt=new t,b=new Array(3),g=new Array(4);for(g[0]=new i(-1,-1,1,1),g[1]=new i(1,-1,1,1),g[2]=new i(1,1,1,1),g[3]=new i(-1,1,1,1),rt=new Array(4),tt=0;tt<4;++tt)rt[tt]=new i;return k._computeNearFarPlanes=function(n,r,u,o,s,h,a,v){var st=c.fromQuaternion(r,vt),k=f(h,ut),tt=f(a,ft),d=f(v,et),ht,at,ot,pt,wt,p,w,y,ct,lt,bt,kt;for(k=c.getColumn(st,0,k),tt=c.getColumn(st,1,tt),d=c.getColumn(st,2,d),t.normalize(k,k),t.normalize(tt,tt),t.normalize(d,d),t.negate(k,k),ht=l.computeView(n,d,tt,k,yt),u===nt?(pt=o.projectionMatrix,wt=l.multiply(pt,ht,it),ot=l.inverse(wt,it)):at=l.inverseTransformation(ht,it),e(ot)?(b[0]=o.near,b[1]=o.far):(b[0]=0,b[1]=o.near,b[2]=o.far),p=0;p<2;++p)for(w=0;w<4;++w)y=i.clone(g[w],rt[w]),e(ot)?(y=l.multiplyByVector(ot,y,y),bt=1/y.w,t.multiplyByScalar(y,bt,y),t.subtract(y,n,y),t.normalize(y,y),kt=t.dot(d,y),t.multiplyByScalar(y,b[p]/kt,y),t.add(y,n,y)):(e(o._offCenterFrustum)&&(o=o._offCenterFrustum),ct=b[p],lt=b[p+1],y.x=(y.x*(o.right-o.left)+o.left+o.right)*.5,y.y=(y.y*(o.top-o.bottom)+o.bottom+o.top)*.5,y.z=(y.z*(ct-lt)-ct-lt)*.5,y.w=1,l.multiplyByVector(at,y,y)),s[12*p+w*3]=y.x,s[12*p+w*3+1]=y.y,s[12*p+w*3+2]=y.z},k.createGeometry=function(i){var at=i._frustumType,vt=i._frustum,yt=i._origin,kt=i._orientation,ht=i._drawNearPlane,c=i._vertexFormat,nt=ht?6:5,r=new Float64Array(72),f,tt,w,rt,b,g;if(k._computeNearFarPlanes(yt,kt,at,vt,r),f=24,r[f]=r[12],r[f+1]=r[13],r[f+2]=r[14],r[f+3]=r[0],r[f+4]=r[1],r[f+5]=r[2],r[f+6]=r[9],r[f+7]=r[10],r[f+8]=r[11],r[f+9]=r[21],r[f+10]=r[22],r[f+11]=r[23],f+=12,r[f]=r[15],r[f+1]=r[16],r[f+2]=r[17],r[f+3]=r[3],r[f+4]=r[4],r[f+5]=r[5],r[f+6]=r[0],r[f+7]=r[1],r[f+8]=r[2],r[f+9]=r[12],r[f+10]=r[13],r[f+11]=r[14],f+=12,r[f]=r[3],r[f+1]=r[4],r[f+2]=r[5],r[f+3]=r[15],r[f+4]=r[16],r[f+5]=r[17],r[f+6]=r[18],r[f+7]=r[19],r[f+8]=r[20],r[f+9]=r[6],r[f+10]=r[7],r[f+11]=r[8],f+=12,r[f]=r[6],r[f+1]=r[7],r[f+2]=r[8],r[f+3]=r[18],r[f+4]=r[19],r[f+5]=r[20],r[f+6]=r[21],r[f+7]=r[22],r[f+8]=r[23],r[f+9]=r[9],r[f+10]=r[10],r[f+11]=r[11],ht||(r=r.subarray(12)),tt=new h({position:new s({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:r})}),e(c.normal)||e(c.tangent)||e(c.bitangent)||e(c.st)){var l=e(c.normal)?new Float32Array(12*nt):undefined,a=e(c.tangent)?new Float32Array(12*nt):undefined,v=e(c.bitangent)?new Float32Array(12*nt):undefined,p=e(c.st)?new Float32Array(8*nt):undefined,ct=ut,it=ft,ot=et,st=t.negate(ct,pt),dt=t.negate(it,wt),lt=t.negate(ot,bt);f=0;ht&&(d(f,l,a,v,p,lt,ct,it),f+=12);d(f,l,a,v,p,ot,st,it);f+=12;d(f,l,a,v,p,st,lt,it);f+=12;d(f,l,a,v,p,dt,lt,st);f+=12;d(f,l,a,v,p,ct,ot,it);f+=12;d(f,l,a,v,p,it,ot,st);e(l)&&(tt.normal=new s({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:l}));e(a)&&(tt.tangent=new s({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:a}));e(v)&&(tt.bitangent=new s({componentDatatype:u.FLOAT,componentsPerAttribute:3,values:v}));e(p)&&(tt.st=new s({componentDatatype:u.FLOAT,componentsPerAttribute:2,values:p}))}for(w=new Uint16Array(6*nt),rt=0;rt<nt;++rt)b=rt*6,g=rt*4,w[b]=g,w[b+1]=g+1,w[b+2]=g+2,w[b+3]=g,w[b+4]=g+2,w[b+5]=g+3;return new o({attributes:tt,indices:w,primitiveType:y.TRIANGLES,boundingSphere:n.fromVertices(r)})},k});t("Core/FrustumOutlineGeometry",["./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./FrustumGeometry","./Geometry","./GeometryAttribute","./GeometryAttributes","./OrthographicFrustum","./PerspectiveFrustum","./PrimitiveType","./Quaternion"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(n){i.typeOf.object("options",n);i.typeOf.object("options.frustum",n.frustum);i.typeOf.object("options.origin",n.origin);i.typeOf.object("options.orientation",n.orientation);var r=n.frustum,o=n.orientation,s=n.origin,h=u(n._drawNearPlane,!0),f,e;r instanceof l?(f=p,e=l.packedLength):r instanceof c&&(f=w,e=c.packedLength);this._frustumType=f;this._frustum=r.clone();this._origin=t.clone(s);this._orientation=v.clone(o);this._drawNearPlane=h;this._workerName="createFrustumOutlineGeometry";this.packedLength=2+e+t.packedLength+v.packedLength}var p=0,w=1;y.pack=function(n,r,f){i.typeOf.object("value",n);i.defined("array",r);f=u(f,0);var e=n._frustumType,o=n._frustum;return r[f++]=e,e===p?(l.pack(o,r,f),f+=l.packedLength):(c.pack(o,r,f),f+=c.packedLength),t.pack(n._origin,r,f),f+=t.packedLength,v.pack(n._orientation,r,f),f+=v.packedLength,r[f]=n._drawNearPlane?1:0,r};var b=new l,k=new c,d=new v,g=new t;return y.unpack=function(n,r,e){var o,s,h,a,w,nt;return(i.defined("array",n),r=u(r,0),o=n[r++],o===p?(s=l.unpack(n,r,b),r+=l.packedLength):(s=c.unpack(n,r,k),r+=c.packedLength),h=t.unpack(n,r,g),r+=t.packedLength,a=v.unpack(n,r,d),r+=v.packedLength,w=n[r]===1,!f(e))?new y({frustum:s,origin:h,orientation:a,_drawNearPlane:w}):(nt=o===e._frustumType?e._frustum:undefined,e._frustum=s.clone(nt),e._frustumType=o,e._origin=t.clone(h,e._origin),e._orientation=v.clone(a,e._orientation),e._drawNearPlane=w,e)},y.createGeometry=function(t){var p=t._frustumType,w=t._frustum,b=t._origin,k=t._orientation,l=t._drawNearPlane,v=new Float64Array(24);e._computeNearFarPlanes(b,k,p,w,v);for(var d=new h({position:new s({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:v})}),i,u,y=l?2:1,f=new Uint16Array(8*(y+1)),c=l?0:1;c<2;++c)i=l?c*8:0,u=c*4,f[i]=u,f[i+1]=u+1,f[i+2]=u+1,f[i+3]=u+2,f[i+4]=u+2,f[i+5]=u+3,f[i+6]=u+3,f[i+7]=u;for(c=0;c<2;++c)i=(y+c)*8,u=c*4,f[i]=u,f[i+1]=u+4,f[i+2]=u+1,f[i+3]=u+5,f[i+4]=u+2,f[i+5]=u+6,f[i+6]=u+3,f[i+7]=u+7;return new o({attributes:d,indices:f,primitiveType:a.LINES,boundingSphere:n.fromVertices(v)})},y});t("Core/GeocoderService",["./DeveloperError"],function(n){"use strict";function t(){}return t.prototype.geocode=n.throwInstantiationError,t});t("Core/GeocodeType",["../Core/freezeObject"],function(n){"use strict";return n({SEARCH:0,AUTOCOMPLETE:1})});t("Core/GeometryInstanceAttribute",["./defaultValue","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(r){if(r=n(r,n.EMPTY_OBJECT),!t(r.componentDatatype))throw new i("options.componentDatatype is required.");if(!t(r.componentsPerAttribute))throw new i("options.componentsPerAttribute is required.");if(r.componentsPerAttribute<1||r.componentsPerAttribute>4)throw new i("options.componentsPerAttribute must be between 1 and 4.");if(!t(r.value))throw new i("options.value is required.");this.componentDatatype=r.componentDatatype;this.componentsPerAttribute=r.componentsPerAttribute;this.normalize=n(r.normalize,!1);this.value=r.value}return r});t("Core/getFilenameFromUri",["../ThirdParty/Uri","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(r){var f,u,e;if(!t(r))throw new i("uri is required.");return f=new n(r),f.normalize(),u=f.path,e=u.lastIndexOf("/"),e!==-1&&(u=u.substr(e+1)),u}return r});t("Core/getImagePixels",["./defined"],function(n){"use strict";function i(i,r,u){var e,f,o;return n(r)||(r=i.width),n(u)||(u=i.height),e=t[r],n(e)||(e={},t[r]=e),f=e[u],n(f)||(o=document.createElement("canvas"),o.width=r,o.height=u,f=o.getContext("2d"),f.globalCompositeOperation="copy",e[u]=f),f.drawImage(i,0,0,r,u),f.getImageData(0,0,r,u).data}var t={};return i});t("Core/getStringFromTypedArray",["./defaultValue","./defined","./DeveloperError","./RuntimeError"],function(n,t,i,r){"use strict";function u(r,f,e){if(!t(r))throw new i("uint8Array is required.");if(f<0)throw new i("byteOffset cannot be negative.");if(e<0)throw new i("byteLength cannot be negative.");if(f+e>r.byteLength)throw new i("sub-region exceeds array bounds.");return f=n(f,0),e=n(e,r.byteLength-f),r=r.subarray(f,f+e),u.decode(r)}function f(n,t,i){return t<=n&&n<=i}function e(n){for(var t,i=0,s=0,u=0,e=128,o=191,c=[],l=n.length,h=0;h<l;++h){if(t=n[h],u===0){if(f(t,0,127)){c.push(t);continue}if(f(t,194,223)){u=1;i=t&31;continue}if(f(t,224,239)){t===224&&(e=160);t===237&&(o=159);u=2;i=t&15;continue}if(f(t,240,244)){t===240&&(e=144);t===244&&(o=143);u=3;i=t&7;continue}throw new r("String decoding failed.");}if(!f(t,e,o)){i=u=s=0;e=128;o=191;--h;continue}e=128;o=191;i=i<<6|t&63;++s;s===u&&(c.push(i),i=u=s=0)}return c}return u.decodeWithTextDecoder=function(n){var t=new TextDecoder("utf-8");return t.decode(n)},u.decodeWithFromCharCode=function(n){for(var t,i="",u=e(n),f=u.length,r=0;r<f;++r)t=u[r],t<=65535?i+=String.fromCharCode(t):(t-=65536,i+=String.fromCharCode((t>>10)+55296,(t&1023)+56320));return i},u.decode=typeof TextDecoder!="undefined"?u.decodeWithTextDecoder:u.decodeWithFromCharCode,u});t("Core/getMagic",["./defaultValue","./getStringFromTypedArray"],function(n,t){"use strict";function i(i,r){return r=n(r,0),t(i,r,Math.min(4,i.length))}return i}),function(n,i){"use strict";(function(i,r,u){function e(n){var t=r[n];return t||i[n][0].call(t=r[n]={exports:{}},e,t,t.exports),t.exports}var f=n.protobuf=e(u[0]);typeof t=="function"&&t.amd&&t("ThirdParty/protobuf-minimal",[],function(){return f.configure(),f});typeof module=="object"&&module&&module.exports&&(module.exports=f)})({1:[function(n,t){function i(n,t){for(var i,r=[],u=2;u<arguments.length;)r.push(arguments[u++]);return i=!0,new Promise(function(u,f){r.push(function(n){var t,r;if(i)if(i=!1,n)f(n);else{for(t=[],r=1;r<arguments.length;)t.push(arguments[r++]);u.apply(null,t)}});try{n.apply(t||this,r)}catch(e){i&&(i=!1,f(e))}})}t.exports=i},{}],2:[function(n,t,r){var e=r,f,o,u,s;for(e.length=function(n){var t=n.length,i;if(!t)return 0;for(i=0;--t%4>1&&n.charAt(t)==="=";)++i;return Math.ceil(n.length*3)/4-i},f=new Array(64),o=new Array(123),u=0;u<64;)o[f[u]=u<26?u+65:u<52?u+71:u<62?u-4:u-59|43]=u++;e.encode=function(n,t,i){for(var r=[],u=0,o=0,s,e;t<i;){e=n[t++];switch(o){case 0:r[u++]=f[e>>2];s=(e&3)<<4;o=1;break;case 1:r[u++]=f[s|e>>4];s=(e&15)<<2;o=2;break;case 2:r[u++]=f[s|e>>6];r[u++]=f[e&63];o=0}}return o&&(r[u++]=f[s],r[u]=61,o===1&&(r[u+1]=61)),String.fromCharCode.apply(String,r)};s="invalid encoding";e.decode=function(n,t,r){for(var u,c=r,f=0,e,h=0;h<n.length;){if(u=n.charCodeAt(h++),u===61&&f>1)break;if((u=o[u])===i)throw Error(s);switch(f){case 0:e=u;f=1;break;case 1:t[r++]=e<<2|(u&48)>>4;e=u;f=2;break;case 2:t[r++]=(e&15)<<4|(u&60)>>2;e=u;f=3;break;case 3:t[r++]=(e&3)<<6|u;f=0}}if(f===1)throw Error(s);return r-c};e.test=function(n){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(n)}},{}],3:[function(n,t){function r(){this._listeners={}}t.exports=r;r.prototype.on=function(n,t,i){return(this._listeners[n]||(this._listeners[n]=[])).push({fn:t,ctx:i||this}),this};r.prototype.off=function(n,t){var u,r;if(n===i)this._listeners={};else if(t===i)this._listeners[n]=[];else for(u=this._listeners[n],r=0;r<u.length;)u[r].fn===t?u.splice(r,1):++r;return this};r.prototype.emit=function(n){var i=this._listeners[n],r,t;if(i){for(r=[],t=1;t<arguments.length;)r.push(arguments[t++]);for(t=0;t<i.length;)i[t].fn.apply(i[t++].ctx,r)}return this}},{}],4:[function(n,t){function i(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}t.exports=i},{}],5:[function(n,t){function i(n,t,i){var u=i||8192,e=u>>>1,f=null,r=u;return function(i){if(i<1||i>e)return n(i);r+i>u&&(f=n(u),r=0);var o=t.call(f,r,r+=i);return r&7&&(r=(r|7)+1),o}}t.exports=i},{}],6:[function(n,t,i){var r=i;r.length=function(n){for(var t=0,r=0,i=0;i<n.length;++i)r=n.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)==55296&&(n.charCodeAt(i+1)&64512)==56320?(++i,t+=4):t+=3;return t};r.read=function(n,t,i){var o=i-t;if(o<1)return"";for(var e=null,f=[],u=0,r;t<i;)r=n[t++],r<128?f[u++]=r:r>191&&r<224?f[u++]=(r&31)<<6|n[t++]&63:r>239&&r<365?(r=((r&7)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,f[u++]=55296+(r>>10),f[u++]=56320+(r&1023)):f[u++]=(r&15)<<12|(n[t++]&63)<<6|n[t++]&63,u>8191&&((e||(e=[])).push(String.fromCharCode.apply(String,f)),u=0);return e?(u&&e.push(String.fromCharCode.apply(String,f.slice(0,u))),e.join("")):String.fromCharCode.apply(String,f.slice(0,u))};r.write=function(n,t,i){for(var e=i,r,f,u=0;u<n.length;++u)r=n.charCodeAt(u),r<128?t[i++]=r:r<2048?(t[i++]=r>>6|192,t[i++]=r&63|128):(r&64512)==55296&&((f=n.charCodeAt(u+1))&64512)==56320?(r=65536+((r&1023)<<10)+(f&1023),++u,t[i++]=r>>18|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128,t[i++]=r&63|128):(t[i++]=r>>12|224,t[i++]=r>>6&63|128,t[i++]=r&63|128);return i-e}},{}],7:[function(n,t,i){function u(){r.Reader._configure(r.BufferReader);r.util._configure()}var r=i;r.build="minimal";r.roots={};r.Writer=n(14);r.BufferWriter=n(15);r.Reader=n(8);r.BufferReader=n(9);r.util=n(13);r.rpc=n(10);r.configure=u;r.Writer._configure(r.BufferWriter);u()},{"10":10,"13":13,"14":14,"15":15,"8":8,"9":9}],8:[function(n,t){function r(n,t){return RangeError("index out of range: "+n.pos+" + "+(t||1)+" > "+n.len)}function i(n){this.buf=n;this.pos=0;this.len=n.length}function o(){var n=new h(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw r(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,n}if(this.len-this.pos>4){for(;t<5;++t)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;t<5;++t){if(this.pos>=this.len)throw r(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding");}function f(n,t){return(n[t-4]|n[t-3]<<8|n[t-2]<<16|n[t-1]<<24)>>>0}function c(){if(this.pos+8>this.len)throw r(this,8);return new h(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}var e,l,a;t.exports=i;var u=n(13),s,h=u.LongBits,v=u.utf8;e=typeof Uint8Array!="undefined"?function(n){if(n instanceof Uint8Array||Array.isArray(n))return new i(n);throw Error("illegal buffer");}:function(n){if(Array.isArray(n))return new i(n);throw Error("illegal buffer");};i.create=u.Buffer?function(n){return(i.create=function(n){return u.Buffer.isBuffer(n)?new s(n):e(n)})(n)}:e;i.prototype._slice=u.Array.prototype.subarray||u.Array.prototype.slice;i.prototype.uint32=function(){var n=4294967295;return function(){if((n=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(n=(n|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return n;if((this.pos+=5)>this.len){this.pos=this.len;throw r(this,10);}return n}}();i.prototype.int32=function(){return this.uint32()|0};i.prototype.sint32=function(){var n=this.uint32();return n>>>1^-(n&1)|0};i.prototype.bool=function(){return this.uint32()!==0};i.prototype.fixed32=function(){if(this.pos+4>this.len)throw r(this,4);return f(this.buf,this.pos+=4)};i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw r(this,4);return f(this.buf,this.pos+=4)|0};l=typeof Float32Array!="undefined"?function(){var t=new Float32Array(1),n=new Uint8Array(t.buffer);return t[0]=-0,n[3]?function(i,r){return n[0]=i[r],n[1]=i[r+1],n[2]=i[r+2],n[3]=i[r+3],t[0]}:function(i,r){return n[0]=i[r+3],n[1]=i[r+2],n[2]=i[r+1],n[3]=i[r],t[0]}}():function(n,t){var i=f(n,t+4),r=(i>>31)*2+1,u=i>>>23&255,e=i&8388607;return u===255?e?NaN:r*Infinity:u===0?r*14012984643248171e-61*e:r*Math.pow(2,u-150)*(e+8388608)};i.prototype.float=function(){if(this.pos+4>this.len)throw r(this,4);var n=l(this.buf,this.pos);return this.pos+=4,n};a=typeof Float64Array!="undefined"?function(){var t=new Float64Array(1),n=new Uint8Array(t.buffer);return t[0]=-0,n[7]?function(i,r){return n[0]=i[r],n[1]=i[r+1],n[2]=i[r+2],n[3]=i[r+3],n[4]=i[r+4],n[5]=i[r+5],n[6]=i[r+6],n[7]=i[r+7],t[0]}:function(i,r){return n[0]=i[r+7],n[1]=i[r+6],n[2]=i[r+5],n[3]=i[r+4],n[4]=i[r+3],n[5]=i[r+2],n[6]=i[r+1],n[7]=i[r],t[0]}}():function(n,t){var o=f(n,t+4),i=f(n,t+8),r=(i>>31)*2+1,u=i>>>20&2047,e=4294967296*(i&1048575)+o;return u===2047?e?NaN:r*Infinity:u===0?r*494065645841247e-338*e:r*Math.pow(2,u-1075)*(e+4503599627370496)};i.prototype.double=function(){if(this.pos+8>this.len)throw r(this,4);var n=a(this.buf,this.pos);return this.pos+=8,n};i.prototype.bytes=function(){var n=this.uint32(),i=this.pos,t=this.pos+n;if(t>this.len)throw r(this,n);return this.pos+=n,i===t?new this.buf.constructor(0):this._slice.call(this.buf,i,t)};i.prototype.string=function(){var n=this.bytes();return v.read(n,0,n.length)};i.prototype.skip=function(n){if(typeof n=="number"){if(this.pos+n>this.len)throw r(this,n);this.pos+=n}else do if(this.pos>=this.len)throw r(this);while(this.buf[this.pos++]&128);return this};i.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:do{if((n=this.uint32()&7)==4)break;this.skipType(n)}while(1);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos);}return this};i._configure=function(n){s=n;var t=u.Long?"toLong":"toNumber";u.merge(i.prototype,{int64:function(){return o.call(this)[t](!1)},uint64:function(){return o.call(this)[t](!0)},sint64:function(){return o.call(this).zzDecode()[t](!1)},fixed64:function(){return c.call(this)[t](!0)},sfixed64:function(){return c.call(this)[t](!1)}})}},{"13":13}],9:[function(n,t){function i(n){r.call(this,n)}var r,u;t.exports=i;r=n(8);(i.prototype=Object.create(r.prototype)).constructor=i;u=n(13);u.Buffer&&(i.prototype._slice=u.Buffer.prototype.slice);i.prototype.string=function(){var n=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+n,this.len))}},{"13":13,"8":8}],10:[function(n,t,i){var r=i;r.Service=n(11)},{"11":11}],11:[function(n,t){function r(n,t,i){if(typeof n!="function")throw TypeError("rpcImpl must be a function");u.EventEmitter.call(this);this.rpcImpl=n;this.requestDelimited=Boolean(t);this.responseDelimited=Boolean(i)}t.exports=r;var u=n(13);(r.prototype=Object.create(u.EventEmitter.prototype)).constructor=r;r.prototype.rpcCall=function f(n,t,r,e,o){if(!e)throw TypeError("request must be specified");var s=this;if(!o)return u.asPromise(f,s,n,t,r,e);if(!s.rpcImpl)return setTimeout(function(){o(Error("already ended"))},0),i;try{return s.rpcImpl(n,t[s.requestDelimited?"encodeDelimited":"encode"](e).finish(),function(t,u){if(t)return s.emit("error",t,n),o(t);if(u===null)return s.end(!0),i;if(!(u instanceof r))try{u=r[s.responseDelimited?"decodeDelimited":"decode"](u)}catch(t){return s.emit("error",t,n),o(t)}return s.emit("data",u,n),o(null,u)})}catch(h){return s.emit("error",h,n),setTimeout(function(){o(h)},0),i}};r.prototype.end=function(n){return this.rpcImpl&&(n||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{"13":13}],12:[function(n,t){function i(n,t){this.lo=n>>>0;this.hi=t>>>0}var f,u,e,r;t.exports=i;f=n(13);u=i.zero=new i(0,0);u.toNumber=function(){return 0};u.zzEncode=u.zzDecode=function(){return this};u.length=function(){return 1};e=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(n){var f,t,r;return n===0?u:(f=n<0,f&&(n=-n),t=n>>>0,r=(n-t)/4294967296>>>0,f&&(r=~r>>>0,t=~t>>>0,++t>4294967295&&(t=0,++r>4294967295&&(r=0))),new i(t,r))};i.from=function(n){if(typeof n=="number")return i.fromNumber(n);if(f.isString(n))if(f.Long)n=f.Long.fromString(n);else return i.fromNumber(parseInt(n,10));return n.low||n.high?new i(n.low>>>0,n.high>>>0):u};i.prototype.toNumber=function(n){if(!n&&this.hi>>>31){var i=~this.lo+1>>>0,t=~this.hi>>>0;return i||(t=t+1>>>0),-(i+t*4294967296)}return this.lo+this.hi*4294967296};i.prototype.toLong=function(n){return f.Long?new f.Long(this.lo|0,this.hi|0,Boolean(n)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(n)}};r=String.prototype.charCodeAt;i.fromHash=function(n){return n===e?u:new i((r.call(n,0)|r.call(n,1)<<8|r.call(n,2)<<16|r.call(n,3)<<24)>>>0,(r.call(n,4)|r.call(n,5)<<8|r.call(n,6)<<16|r.call(n,7)<<24)>>>0)};i.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};i.prototype.zzEncode=function(){var n=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^n)>>>0,this.lo=(this.lo<<1^n)>>>0,this};i.prototype.zzDecode=function(){var n=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^n)>>>0,this.hi=(this.hi>>>1^n)>>>0,this};i.prototype.length=function(){var t=this.lo,n=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?n===0?t<16384?t<128?1:2:t<2097152?3:4:n<16384?n<128?5:6:n<2097152?7:8:i<128?9:10}},{"13":13}],13:[function(t,r,u){function e(n,t,r){for(var f=Object.keys(t),u=0;u<f.length;++u)n[f[u]]!==i&&r||(n[f[u]]=t[f[u]]);return n}function o(n){function t(n,i){if(!(this instanceof t))return new t(n,i);Object.defineProperty(this,"message",{get:function(){return n}});Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""});i&&e(this,i)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return n}}),t.prototype.toString=function(){return this.name+": "+this.message},t}var f=u;f.asPromise=t(1);f.base64=t(2);f.EventEmitter=t(3);f.inquire=t(4);f.utf8=t(6);f.pool=t(5);f.LongBits=t(12);f.emptyArray=Object.freeze?Object.freeze([]):[];f.emptyObject=Object.freeze?Object.freeze({}):{};f.isNode=Boolean(n.process&&n.process.versions&&n.process.versions.node);f.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};f.isString=function(n){return typeof n=="string"||n instanceof String};f.isObject=function(n){return n&&typeof n=="object"};f.Buffer=function(){try{var n=f.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch(t){return null}}();f._Buffer_from=null;f._Buffer_allocUnsafe=null;f.newBuffer=function(n){return typeof n=="number"?f.Buffer?f._Buffer_allocUnsafe(n):new f.Array(n):f.Buffer?f._Buffer_from(n):typeof Uint8Array=="undefined"?n:new Uint8Array(n)};f.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;f.Long=n.dcodeIO&&n.dcodeIO.Long||f.inquire("long");f.key2Re=/^true|false|0|1$/;f.key32Re=/^-?(?:0|[1-9][0-9]*)$/;f.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;f.longToHash=function(n){return n?f.LongBits.from(n).toHash():f.LongBits.zeroHash};f.longFromHash=function(n,t){var i=f.LongBits.fromHash(n);return f.Long?f.Long.fromBits(i.lo,i.hi,t):i.toNumber(Boolean(t))};f.merge=e;f.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};f.newError=o;f.ProtocolError=o("ProtocolError");f.oneOfGetter=function(n){for(var r={},t=0;t<n.length;++t)r[n[t]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(r[t[n]]===1&&this[t[n]]!==i&&this[t[n]]!==null)return t[n]}};f.oneOfSetter=function(n){return function(t){for(var i=0;i<n.length;++i)n[i]!==t&&delete this[n[i]]}};f.lazyResolve=function(n,t){for(var u,r,e,f,i=0;i<t.length;++i)for(u=Object.keys(t[i]),r=0;r<u.length;++r){for(e=t[i][u[r]].split("."),f=n;e.length;)f=f[e.shift()];t[i][u[r]]=f}};f.toJSONOptions={longs:String,enums:String,bytes:String};f._configure=function(){var n=f.Buffer;if(!n){f._Buffer_from=f._Buffer_allocUnsafe=null;return}f._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,i){return new n(t,i)};f._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}},{"1":1,"12":12,"2":2,"3":3,"4":4,"5":5,"6":6}],14:[function(n,t){function e(n,t,r){this.fn=n;this.len=t;this.next=i;this.val=r}function s(){}function k(n){this.head=n.head;this.tail=n.tail;this.len=n.len;this.next=n.states}function r(){this.len=0;this.head=new e(s,0,0);this.tail=this.head;this.states=null}function h(n,t,i){t[i]=n&255}function d(n,t,i){while(n>127)t[i++]=n&127|128,n>>>=7;t[i]=n}function c(n,t){this.len=n;this.next=i;this.val=t}function l(n,t,i){while(n.hi)t[i++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;while(n.lo>127)t[i++]=n.lo&127|128,n.lo=n.lo>>>7;t[i++]=n.lo}function u(n,t,i){t[i++]=n&255;t[i++]=n>>>8&255;t[i++]=n>>>16&255;t[i]=n>>>24}var p,w,b;t.exports=r;var f=n(13),a,o=f.LongBits,v=f.base64,y=f.utf8;r.create=f.Buffer?function(){return(r.create=function(){return new a})()}:function(){return new r};r.alloc=function(n){return new f.Array(n)};f.Array!==Array&&(r.alloc=f.pool(r.alloc,f.Array.prototype.subarray));r.prototype.push=function(n,t,i){return this.tail=this.tail.next=new e(n,t,i),this.len+=t,this};c.prototype=Object.create(e.prototype);c.prototype.fn=d;r.prototype.uint32=function(n){return this.len+=(this.tail=this.tail.next=new c((n=n>>>0)<128?1:n<16384?2:n<2097152?3:n<268435456?4:5,n)).len,this};r.prototype.int32=function(n){return n<0?this.push(l,10,o.fromNumber(n)):this.uint32(n)};r.prototype.sint32=function(n){return this.uint32((n<<1^n>>31)>>>0)};r.prototype.uint64=function(n){var t=o.from(n);return this.push(l,t.length(),t)};r.prototype.int64=r.prototype.uint64;r.prototype.sint64=function(n){var t=o.from(n).zzEncode();return this.push(l,t.length(),t)};r.prototype.bool=function(n){return this.push(h,1,n?1:0)};r.prototype.fixed32=function(n){return this.push(u,4,n>>>0)};r.prototype.sfixed32=r.prototype.fixed32;r.prototype.fixed64=function(n){var t=o.from(n);return this.push(u,4,t.lo).push(u,4,t.hi)};r.prototype.sfixed64=r.prototype.fixed64;p=typeof Float32Array!="undefined"?function(){var t=new Float32Array(1),n=new Uint8Array(t.buffer);return t[0]=-0,n[3]?function(i,r,u){t[0]=i;r[u++]=n[0];r[u++]=n[1];r[u++]=n[2];r[u]=n[3]}:function(i,r,u){t[0]=i;r[u++]=n[3];r[u++]=n[2];r[u++]=n[1];r[u]=n[0]}}():function(n,t,i){var r=n<0?1:0,f,e;r&&(n=-n);n===0?u(1/n>0?0:2147483648,t,i):isNaN(n)?u(2147483647,t,i):n>34028234663852886e22?u((r<<31|2139095040)>>>0,t,i):n<11754943508222875e-54?u((r<<31|Math.round(n/14012984643248171e-61))>>>0,t,i):(f=Math.floor(Math.log(n)/Math.LN2),e=Math.round(n*Math.pow(2,-f)*8388608)&8388607,u((r<<31|f+127<<23|e)>>>0,t,i))};r.prototype.float=function(n){return this.push(p,4,n)};w=typeof Float64Array!="undefined"?function(){var t=new Float64Array(1),n=new Uint8Array(t.buffer);return t[0]=-0,n[7]?function(i,r,u){t[0]=i;r[u++]=n[0];r[u++]=n[1];r[u++]=n[2];r[u++]=n[3];r[u++]=n[4];r[u++]=n[5];r[u++]=n[6];r[u]=n[7]}:function(i,r,u){t[0]=i;r[u++]=n[7];r[u++]=n[6];r[u++]=n[5];r[u++]=n[4];r[u++]=n[3];r[u++]=n[2];r[u++]=n[1];r[u]=n[0]}}():function(n,t,i){var e=n<0?1:0,r,f;e&&(n=-n);n===0?(u(0,t,i),u(1/n>0?0:2147483648,t,i+4)):isNaN(n)?(u(4294967295,t,i),u(2147483647,t,i+4)):n>17976931348623157e292?(u(0,t,i),u((e<<31|2146435072)>>>0,t,i+4)):n<22250738585072014e-324?(r=n/494065645841247e-338,u(r>>>0,t,i),u((e<<31|r/4294967296)>>>0,t,i+4)):(f=Math.floor(Math.log(n)/Math.LN2),f===1024&&(f=1023),r=n*Math.pow(2,-f),u(r*4503599627370496>>>0,t,i),u((e<<31|f+1023<<20|r*1048576&1048575)>>>0,t,i+4))};r.prototype.double=function(n){return this.push(w,8,n)};b=f.Array.prototype.set?function(n,t,i){t.set(n,i)}:function(n,t,i){for(var r=0;r<n.length;++r)t[i+r]=n[r]};r.prototype.bytes=function(n){var t=n.length>>>0,i;return t?(f.isString(n)&&(i=r.alloc(t=v.length(n)),v.decode(n,i,0),n=i),this.uint32(t).push(b,t,n)):this.push(h,1,0)};r.prototype.string=function(n){var t=y.length(n);return t?this.uint32(t).push(y.write,t,n):this.push(h,1,0)};r.prototype.fork=function(){return this.states=new k(this),this.head=this.tail=new e(s,0,0),this.len=0,this};r.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new e(s,0,0),this.len=0),this};r.prototype.ldelim=function(){var t=this.head,i=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=i,this.len+=n),this};r.prototype.finish=function(){for(var n=this.head.next,t=this.constructor.alloc(this.len),i=0;n;)n.fn(n.val,t,i),i+=n.len,n=n.next;return t};r._configure=function(n){a=n}},{"13":13}],15:[function(n,t){function i(){f.call(this)}function o(n,t,i){n.length<40?r.utf8.write(n,t,i):t.utf8Write(n,i)}var f,r,u,e;t.exports=i;f=n(14);(i.prototype=Object.create(f.prototype)).constructor=i;r=n(13);u=r.Buffer;i.alloc=function(n){return(i.alloc=r._Buffer_allocUnsafe)(n)};e=u&&u.prototype instanceof Uint8Array&&u.prototype.set.name==="set"?function(n,t,i){t.set(n,i)}:function(n,t,i){if(n.copy)n.copy(t,i,0,n.length);else for(var r=0;r<n.length;)t[i++]=n[r++]};i.prototype.bytes=function(n){r.isString(n)&&(n=r._Buffer_from(n,"base64"));var t=n.length>>>0;return this.uint32(t),t&&this.push(e,t,n),this};i.prototype.string=function(n){var t=u.byteLength(n);return this.uint32(t),t&&this.push(o,t,n),this}},{"13":13,"14":14}]},{},[7])}(typeof window=="object"&&window||typeof self=="object"&&self||this);t("ThirdParty/google-earth-dbroot-parser",["./protobuf-minimal"],function(n){"use strict";var r=n.Reader,f=n.Writer,i=n.util,u=[],t=n.roots["default"]||(n.roots["default"]={});return t.keyhole=function(){var f={};return f.dbroot=function(){var f={};return f.StringEntryProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.stringId=0,u.prototype.stringValue="",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.StringEntryProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.stringId=n.fixed32();break;case 2:u.stringValue=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":i.isInteger(n.stringId)?i.isString(n.stringValue)?null:"stringValue: string expected":"stringId: integer expected"},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.StringEntryProto)return n;var i=new t.keyhole.dbroot.StringEntryProto;return n.stringId!==undefined&&n.stringId!==null&&(i.stringId=n.stringId>>>0),n.stringValue!==undefined&&n.stringValue!==null&&(i.stringValue=String(n.stringValue)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.stringId=0,i.stringValue=""),n.stringId!==undefined&&n.stringId!==null&&n.hasOwnProperty("stringId")&&(i.stringId=n.stringId),n.stringValue!==undefined&&n.stringValue!==null&&n.hasOwnProperty("stringValue")&&(i.stringValue=n.stringValue),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.StringIdOrValueProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.stringId=0,u.prototype.value="",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.StringIdOrValueProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.stringId=n.fixed32();break;case 2:u.value=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.stringId!==undefined&&!i.isInteger(n.stringId)?"stringId: integer expected":n.value!==undefined&&!i.isString(n.value)?"value: string expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.StringIdOrValueProto)return n;var i=new t.keyhole.dbroot.StringIdOrValueProto;return n.stringId!==undefined&&n.stringId!==null&&(i.stringId=n.stringId>>>0),n.value!==undefined&&n.value!==null&&(i.value=String(n.value)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.stringId=0,i.value=""),n.stringId!==undefined&&n.stringId!==null&&n.hasOwnProperty("stringId")&&(i.stringId=n.stringId),n.value!==undefined&&n.value!==null&&n.hasOwnProperty("value")&&(i.value=n.value),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.PlanetModelProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.radius=6378.137,u.prototype.flattening=.00335281066474748,u.prototype.elevationBias=0,u.prototype.negativeAltitudeExponentBias=0,u.prototype.compressedNegativeAltitudeThreshold=0,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.PlanetModelProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.radius=n.double();break;case 2:u.flattening=n.double();break;case 4:u.elevationBias=n.double();break;case 5:u.negativeAltitudeExponentBias=n.int32();break;case 6:u.compressedNegativeAltitudeThreshold=n.double();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.radius!==undefined&&typeof n.radius!="number"?"radius: number expected":n.flattening!==undefined&&typeof n.flattening!="number"?"flattening: number expected":n.elevationBias!==undefined&&typeof n.elevationBias!="number"?"elevationBias: number expected":n.negativeAltitudeExponentBias!==undefined&&!i.isInteger(n.negativeAltitudeExponentBias)?"negativeAltitudeExponentBias: integer expected":n.compressedNegativeAltitudeThreshold!==undefined&&typeof n.compressedNegativeAltitudeThreshold!="number"?"compressedNegativeAltitudeThreshold: number expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.PlanetModelProto)return n;var i=new t.keyhole.dbroot.PlanetModelProto;return n.radius!==undefined&&n.radius!==null&&(i.radius=Number(n.radius)),n.flattening!==undefined&&n.flattening!==null&&(i.flattening=Number(n.flattening)),n.elevationBias!==undefined&&n.elevationBias!==null&&(i.elevationBias=Number(n.elevationBias)),n.negativeAltitudeExponentBias!==undefined&&n.negativeAltitudeExponentBias!==null&&(i.negativeAltitudeExponentBias=n.negativeAltitudeExponentBias|0),n.compressedNegativeAltitudeThreshold!==undefined&&n.compressedNegativeAltitudeThreshold!==null&&(i.compressedNegativeAltitudeThreshold=Number(n.compressedNegativeAltitudeThreshold)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.radius=6378.137,i.flattening=.00335281066474748,i.elevationBias=0,i.negativeAltitudeExponentBias=0,i.compressedNegativeAltitudeThreshold=0),n.radius!==undefined&&n.radius!==null&&n.hasOwnProperty("radius")&&(i.radius=n.radius),n.flattening!==undefined&&n.flattening!==null&&n.hasOwnProperty("flattening")&&(i.flattening=n.flattening),n.elevationBias!==undefined&&n.elevationBias!==null&&n.hasOwnProperty("elevationBias")&&(i.elevationBias=n.elevationBias),n.negativeAltitudeExponentBias!==undefined&&n.negativeAltitudeExponentBias!==null&&n.hasOwnProperty("negativeAltitudeExponentBias")&&(i.negativeAltitudeExponentBias=n.negativeAltitudeExponentBias),n.compressedNegativeAltitudeThreshold!==undefined&&n.compressedNegativeAltitudeThreshold!==null&&n.hasOwnProperty("compressedNegativeAltitudeThreshold")&&(i.compressedNegativeAltitudeThreshold=n.compressedNegativeAltitudeThreshold),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.ProviderInfoProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.providerId=0;f.prototype.copyrightString=null;f.prototype.verticalPixelOffset=-1;var e={1:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ProviderInfoProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.providerId=n.int32();break;case 2:u.copyrightString=e[1].decode(n,n.uint32());break;case 3:u.verticalPixelOffset=n.int32();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(!i.isInteger(n.providerId))return"providerId: integer expected";if(n.copyrightString!==undefined&&n.copyrightString!==null){var t=e[1].verify(n.copyrightString);if(t)return"copyrightString."+t}return n.verticalPixelOffset!==undefined&&!i.isInteger(n.verticalPixelOffset)?"verticalPixelOffset: integer expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ProviderInfoProto)return n;var i=new t.keyhole.dbroot.ProviderInfoProto;if(n.providerId!==undefined&&n.providerId!==null&&(i.providerId=n.providerId|0),n.copyrightString!==undefined&&n.copyrightString!==null){if(typeof n.copyrightString!="object")throw TypeError(".keyhole.dbroot.ProviderInfoProto.copyrightString: object expected");i.copyrightString=e[1].fromObject(n.copyrightString)}return n.verticalPixelOffset!==undefined&&n.verticalPixelOffset!==null&&(i.verticalPixelOffset=n.verticalPixelOffset|0),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.providerId=0,i.copyrightString=null,i.verticalPixelOffset=-1),n.providerId!==undefined&&n.providerId!==null&&n.hasOwnProperty("providerId")&&(i.providerId=n.providerId),n.copyrightString!==undefined&&n.copyrightString!==null&&n.hasOwnProperty("copyrightString")&&(i.copyrightString=e[1].toObject(n.copyrightString,t)),n.verticalPixelOffset!==undefined&&n.verticalPixelOffset!==null&&n.hasOwnProperty("verticalPixelOffset")&&(i.verticalPixelOffset=n.verticalPixelOffset),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.PopUpProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.isBalloonStyle=!1;f.prototype.text=null;f.prototype.backgroundColorAbgr=4294967295;f.prototype.textColorAbgr=4278190080;var e={1:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.PopUpProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.isBalloonStyle=n.bool();break;case 2:u.text=e[1].decode(n,n.uint32());break;case 3:u.backgroundColorAbgr=n.fixed32();break;case 4:u.textColorAbgr=n.fixed32();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(n.isBalloonStyle!==undefined&&typeof n.isBalloonStyle!="boolean")return"isBalloonStyle: boolean expected";if(n.text!==undefined&&n.text!==null){var t=e[1].verify(n.text);if(t)return"text."+t}return n.backgroundColorAbgr!==undefined&&!i.isInteger(n.backgroundColorAbgr)?"backgroundColorAbgr: integer expected":n.textColorAbgr!==undefined&&!i.isInteger(n.textColorAbgr)?"textColorAbgr: integer expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.PopUpProto)return n;var i=new t.keyhole.dbroot.PopUpProto;if(n.isBalloonStyle!==undefined&&n.isBalloonStyle!==null&&(i.isBalloonStyle=Boolean(n.isBalloonStyle)),n.text!==undefined&&n.text!==null){if(typeof n.text!="object")throw TypeError(".keyhole.dbroot.PopUpProto.text: object expected");i.text=e[1].fromObject(n.text)}return n.backgroundColorAbgr!==undefined&&n.backgroundColorAbgr!==null&&(i.backgroundColorAbgr=n.backgroundColorAbgr>>>0),n.textColorAbgr!==undefined&&n.textColorAbgr!==null&&(i.textColorAbgr=n.textColorAbgr>>>0),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.isBalloonStyle=!1,i.text=null,i.backgroundColorAbgr=4294967295,i.textColorAbgr=4278190080),n.isBalloonStyle!==undefined&&n.isBalloonStyle!==null&&n.hasOwnProperty("isBalloonStyle")&&(i.isBalloonStyle=n.isBalloonStyle),n.text!==undefined&&n.text!==null&&n.hasOwnProperty("text")&&(i.text=e[1].toObject(n.text,t)),n.backgroundColorAbgr!==undefined&&n.backgroundColorAbgr!==null&&n.hasOwnProperty("backgroundColorAbgr")&&(i.backgroundColorAbgr=n.backgroundColorAbgr),n.textColorAbgr!==undefined&&n.textColorAbgr!==null&&n.hasOwnProperty("textColorAbgr")&&(i.textColorAbgr=n.textColorAbgr),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.StyleAttributeProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.styleId="";f.prototype.providerId=0;f.prototype.polyColorAbgr=4294967295;f.prototype.lineColorAbgr=4294967295;f.prototype.lineWidth=1;f.prototype.labelColorAbgr=4294967295;f.prototype.labelScale=1;f.prototype.placemarkIconColorAbgr=4294967295;f.prototype.placemarkIconScale=1;f.prototype.placemarkIconPath=null;f.prototype.placemarkIconX=0;f.prototype.placemarkIconY=0;f.prototype.placemarkIconWidth=32;f.prototype.placemarkIconHeight=32;f.prototype.popUp=null;f.prototype.drawFlag=i.emptyArray;var e={9:"keyhole.dbroot.StringIdOrValueProto",14:"keyhole.dbroot.PopUpProto",15:"keyhole.dbroot.DrawFlagProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.StyleAttributeProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.styleId=n.string();break;case 3:u.providerId=n.int32();break;case 4:u.polyColorAbgr=n.fixed32();break;case 5:u.lineColorAbgr=n.fixed32();break;case 6:u.lineWidth=n.float();break;case 7:u.labelColorAbgr=n.fixed32();break;case 8:u.labelScale=n.float();break;case 9:u.placemarkIconColorAbgr=n.fixed32();break;case 10:u.placemarkIconScale=n.float();break;case 11:u.placemarkIconPath=e[9].decode(n,n.uint32());break;case 12:u.placemarkIconX=n.int32();break;case 13:u.placemarkIconY=n.int32();break;case 14:u.placemarkIconWidth=n.int32();break;case 15:u.placemarkIconHeight=n.int32();break;case 16:u.popUp=e[14].decode(n,n.uint32());break;case 17:u.drawFlag&&u.drawFlag.length||(u.drawFlag=[]);u.drawFlag.push(e[15].decode(n,n.uint32()));break;default:n.skipType(f&7)}}return u},f.verify=function(n){var r,t;if(typeof n!="object"||n===null)return"object expected";if(!i.isString(n.styleId))return"styleId: string expected";if(n.providerId!==undefined&&!i.isInteger(n.providerId))return"providerId: integer expected";if(n.polyColorAbgr!==undefined&&!i.isInteger(n.polyColorAbgr))return"polyColorAbgr: integer expected";if(n.lineColorAbgr!==undefined&&!i.isInteger(n.lineColorAbgr))return"lineColorAbgr: integer expected";if(n.lineWidth!==undefined&&typeof n.lineWidth!="number")return"lineWidth: number expected";if(n.labelColorAbgr!==undefined&&!i.isInteger(n.labelColorAbgr))return"labelColorAbgr: integer expected";if(n.labelScale!==undefined&&typeof n.labelScale!="number")return"labelScale: number expected";if(n.placemarkIconColorAbgr!==undefined&&!i.isInteger(n.placemarkIconColorAbgr))return"placemarkIconColorAbgr: integer expected";if(n.placemarkIconScale!==undefined&&typeof n.placemarkIconScale!="number")return"placemarkIconScale: number expected";if(n.placemarkIconPath!==undefined&&n.placemarkIconPath!==null&&(t=e[9].verify(n.placemarkIconPath),t))return"placemarkIconPath."+t;if(n.placemarkIconX!==undefined&&!i.isInteger(n.placemarkIconX))return"placemarkIconX: integer expected";if(n.placemarkIconY!==undefined&&!i.isInteger(n.placemarkIconY))return"placemarkIconY: integer expected";if(n.placemarkIconWidth!==undefined&&!i.isInteger(n.placemarkIconWidth))return"placemarkIconWidth: integer expected";if(n.placemarkIconHeight!==undefined&&!i.isInteger(n.placemarkIconHeight))return"placemarkIconHeight: integer expected";if(n.popUp!==undefined&&n.popUp!==null&&(t=e[14].verify(n.popUp),t))return"popUp."+t;if(n.drawFlag!==undefined){if(!Array.isArray(n.drawFlag))return"drawFlag: array expected";for(r=0;r<n.drawFlag.length;++r)if(t=e[15].verify(n.drawFlag[r]),t)return"drawFlag."+t}return null},f.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.StyleAttributeProto)return n;if(i=new t.keyhole.dbroot.StyleAttributeProto,n.styleId!==undefined&&n.styleId!==null&&(i.styleId=String(n.styleId)),n.providerId!==undefined&&n.providerId!==null&&(i.providerId=n.providerId|0),n.polyColorAbgr!==undefined&&n.polyColorAbgr!==null&&(i.polyColorAbgr=n.polyColorAbgr>>>0),n.lineColorAbgr!==undefined&&n.lineColorAbgr!==null&&(i.lineColorAbgr=n.lineColorAbgr>>>0),n.lineWidth!==undefined&&n.lineWidth!==null&&(i.lineWidth=Number(n.lineWidth)),n.labelColorAbgr!==undefined&&n.labelColorAbgr!==null&&(i.labelColorAbgr=n.labelColorAbgr>>>0),n.labelScale!==undefined&&n.labelScale!==null&&(i.labelScale=Number(n.labelScale)),n.placemarkIconColorAbgr!==undefined&&n.placemarkIconColorAbgr!==null&&(i.placemarkIconColorAbgr=n.placemarkIconColorAbgr>>>0),n.placemarkIconScale!==undefined&&n.placemarkIconScale!==null&&(i.placemarkIconScale=Number(n.placemarkIconScale)),n.placemarkIconPath!==undefined&&n.placemarkIconPath!==null){if(typeof n.placemarkIconPath!="object")throw TypeError(".keyhole.dbroot.StyleAttributeProto.placemarkIconPath: object expected");i.placemarkIconPath=e[9].fromObject(n.placemarkIconPath)}if(n.placemarkIconX!==undefined&&n.placemarkIconX!==null&&(i.placemarkIconX=n.placemarkIconX|0),n.placemarkIconY!==undefined&&n.placemarkIconY!==null&&(i.placemarkIconY=n.placemarkIconY|0),n.placemarkIconWidth!==undefined&&n.placemarkIconWidth!==null&&(i.placemarkIconWidth=n.placemarkIconWidth|0),n.placemarkIconHeight!==undefined&&n.placemarkIconHeight!==null&&(i.placemarkIconHeight=n.placemarkIconHeight|0),n.popUp!==undefined&&n.popUp!==null){if(typeof n.popUp!="object")throw TypeError(".keyhole.dbroot.StyleAttributeProto.popUp: object expected");i.popUp=e[14].fromObject(n.popUp)}if(n.drawFlag){if(!Array.isArray(n.drawFlag))throw TypeError(".keyhole.dbroot.StyleAttributeProto.drawFlag: array expected");for(i.drawFlag=[],r=0;r<n.drawFlag.length;++r){if(typeof n.drawFlag[r]!="object")throw TypeError(".keyhole.dbroot.StyleAttributeProto.drawFlag: object expected");i.drawFlag[r]=e[15].fromObject(n.drawFlag[r])}}return i},f.from=f.fromObject,f.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.drawFlag=[]),t.defaults&&(i.styleId="",i.providerId=0,i.polyColorAbgr=4294967295,i.lineColorAbgr=4294967295,i.lineWidth=1,i.labelColorAbgr=4294967295,i.labelScale=1,i.placemarkIconColorAbgr=4294967295,i.placemarkIconScale=1,i.placemarkIconPath=null,i.placemarkIconX=0,i.placemarkIconY=0,i.placemarkIconWidth=32,i.placemarkIconHeight=32,i.popUp=null),n.styleId!==undefined&&n.styleId!==null&&n.hasOwnProperty("styleId")&&(i.styleId=n.styleId),n.providerId!==undefined&&n.providerId!==null&&n.hasOwnProperty("providerId")&&(i.providerId=n.providerId),n.polyColorAbgr!==undefined&&n.polyColorAbgr!==null&&n.hasOwnProperty("polyColorAbgr")&&(i.polyColorAbgr=n.polyColorAbgr),n.lineColorAbgr!==undefined&&n.lineColorAbgr!==null&&n.hasOwnProperty("lineColorAbgr")&&(i.lineColorAbgr=n.lineColorAbgr),n.lineWidth!==undefined&&n.lineWidth!==null&&n.hasOwnProperty("lineWidth")&&(i.lineWidth=n.lineWidth),n.labelColorAbgr!==undefined&&n.labelColorAbgr!==null&&n.hasOwnProperty("labelColorAbgr")&&(i.labelColorAbgr=n.labelColorAbgr),n.labelScale!==undefined&&n.labelScale!==null&&n.hasOwnProperty("labelScale")&&(i.labelScale=n.labelScale),n.placemarkIconColorAbgr!==undefined&&n.placemarkIconColorAbgr!==null&&n.hasOwnProperty("placemarkIconColorAbgr")&&(i.placemarkIconColorAbgr=n.placemarkIconColorAbgr),n.placemarkIconScale!==undefined&&n.placemarkIconScale!==null&&n.hasOwnProperty("placemarkIconScale")&&(i.placemarkIconScale=n.placemarkIconScale),n.placemarkIconPath!==undefined&&n.placemarkIconPath!==null&&n.hasOwnProperty("placemarkIconPath")&&(i.placemarkIconPath=e[9].toObject(n.placemarkIconPath,t)),n.placemarkIconX!==undefined&&n.placemarkIconX!==null&&n.hasOwnProperty("placemarkIconX")&&(i.placemarkIconX=n.placemarkIconX),n.placemarkIconY!==undefined&&n.placemarkIconY!==null&&n.hasOwnProperty("placemarkIconY")&&(i.placemarkIconY=n.placemarkIconY),n.placemarkIconWidth!==undefined&&n.placemarkIconWidth!==null&&n.hasOwnProperty("placemarkIconWidth")&&(i.placemarkIconWidth=n.placemarkIconWidth),n.placemarkIconHeight!==undefined&&n.placemarkIconHeight!==null&&n.hasOwnProperty("placemarkIconHeight")&&(i.placemarkIconHeight=n.placemarkIconHeight),n.popUp!==undefined&&n.popUp!==null&&n.hasOwnProperty("popUp")&&(i.popUp=e[14].toObject(n.popUp,t)),n.drawFlag!==undefined&&n.drawFlag!==null&&n.hasOwnProperty("drawFlag"))for(i.drawFlag=[],r=0;r<n.drawFlag.length;++r)i.drawFlag[r]=e[15].toObject(n.drawFlag[r],t);return i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.StyleMapProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.styleMapId=0,u.prototype.channelId=i.emptyArray,u.prototype.normalStyleAttribute=0,u.prototype.highlightStyleAttribute=0,u.decode=function(n,i){var e,u,f,o;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.StyleMapProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.styleMapId=n.int32();break;case 2:if(u.channelId&&u.channelId.length||(u.channelId=[]),(f&7)==2)for(o=n.uint32()+n.pos;n.pos<o;)u.channelId.push(n.int32());else u.channelId.push(n.int32());break;case 3:u.normalStyleAttribute=n.int32();break;case 4:u.highlightStyleAttribute=n.int32();break;default:n.skipType(f&7)}}return u},u.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(!i.isInteger(n.styleMapId))return"styleMapId: integer expected";if(n.channelId!==undefined){if(!Array.isArray(n.channelId))return"channelId: array expected";for(var t=0;t<n.channelId.length;++t)if(!i.isInteger(n.channelId[t]))return"channelId: integer[] expected"}return n.normalStyleAttribute!==undefined&&!i.isInteger(n.normalStyleAttribute)?"normalStyleAttribute: integer expected":n.highlightStyleAttribute!==undefined&&!i.isInteger(n.highlightStyleAttribute)?"highlightStyleAttribute: integer expected":null},u.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.StyleMapProto)return n;if(i=new t.keyhole.dbroot.StyleMapProto,n.styleMapId!==undefined&&n.styleMapId!==null&&(i.styleMapId=n.styleMapId|0),n.channelId){if(!Array.isArray(n.channelId))throw TypeError(".keyhole.dbroot.StyleMapProto.channelId: array expected");for(i.channelId=[],r=0;r<n.channelId.length;++r)i.channelId[r]=n.channelId[r]|0}return n.normalStyleAttribute!==undefined&&n.normalStyleAttribute!==null&&(i.normalStyleAttribute=n.normalStyleAttribute|0),n.highlightStyleAttribute!==undefined&&n.highlightStyleAttribute!==null&&(i.highlightStyleAttribute=n.highlightStyleAttribute|0),i},u.from=u.fromObject,u.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.channelId=[]),t.defaults&&(i.styleMapId=0,i.normalStyleAttribute=0,i.highlightStyleAttribute=0),n.styleMapId!==undefined&&n.styleMapId!==null&&n.hasOwnProperty("styleMapId")&&(i.styleMapId=n.styleMapId),n.channelId!==undefined&&n.channelId!==null&&n.hasOwnProperty("channelId"))for(i.channelId=[],r=0;r<n.channelId.length;++r)i.channelId[r]=n.channelId[r];return n.normalStyleAttribute!==undefined&&n.normalStyleAttribute!==null&&n.hasOwnProperty("normalStyleAttribute")&&(i.normalStyleAttribute=n.normalStyleAttribute),n.highlightStyleAttribute!==undefined&&n.highlightStyleAttribute!==null&&n.hasOwnProperty("highlightStyleAttribute")&&(i.highlightStyleAttribute=n.highlightStyleAttribute),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.ZoomRangeProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.minZoom=0,u.prototype.maxZoom=0,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ZoomRangeProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.minZoom=n.int32();break;case 2:u.maxZoom=n.int32();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":i.isInteger(n.minZoom)?i.isInteger(n.maxZoom)?null:"maxZoom: integer expected":"minZoom: integer expected"},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ZoomRangeProto)return n;var i=new t.keyhole.dbroot.ZoomRangeProto;return n.minZoom!==undefined&&n.minZoom!==null&&(i.minZoom=n.minZoom|0),n.maxZoom!==undefined&&n.maxZoom!==null&&(i.maxZoom=n.maxZoom|0),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.minZoom=0,i.maxZoom=0),n.minZoom!==undefined&&n.minZoom!==null&&n.hasOwnProperty("minZoom")&&(i.minZoom=n.minZoom),n.maxZoom!==undefined&&n.maxZoom!==null&&n.hasOwnProperty("maxZoom")&&(i.maxZoom=n.maxZoom),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.DrawFlagProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}i.prototype.drawFlagType=1;var f={0:"keyhole.dbroot.DrawFlagProto.DrawFlagType"};return u.push(f),i.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.DrawFlagProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.drawFlagType=n.uint32();break;default:n.skipType(f&7)}}return u},i.verify=function(n){if(typeof n!="object"||n===null)return"object expected";switch(n.drawFlagType){default:return"drawFlagType: enum value expected";case 1:case 2:case 3:case 4:case 5:}return null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.DrawFlagProto)return n;var i=new t.keyhole.dbroot.DrawFlagProto;switch(n.drawFlagType){case"TYPE_FILL_ONLY":case 1:i.drawFlagType=1;break;case"TYPE_OUTLINE_ONLY":case 2:i.drawFlagType=2;break;case"TYPE_FILL_AND_OUTLINE":case 3:i.drawFlagType=3;break;case"TYPE_ANTIALIASING":case 4:i.drawFlagType=4;break;case"TYPE_CENTER_LABEL":case 5:i.drawFlagType=5}return i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.drawFlagType=t.enums===String?"TYPE_FILL_ONLY":1),n.drawFlagType!==undefined&&n.drawFlagType!==null&&n.hasOwnProperty("drawFlagType")&&(i.drawFlagType=t.enums===String?f[0][n.drawFlagType]:n.drawFlagType),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i.DrawFlagType=function(){var n=Object.create({});return n.TYPE_FILL_ONLY=1,n.TYPE_OUTLINE_ONLY=2,n.TYPE_FILL_AND_OUTLINE=3,n.TYPE_ANTIALIASING=4,n.TYPE_CENTER_LABEL=5,n}(),i}(),f.LayerProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.zoomRange=i.emptyArray;f.prototype.preserveTextLevel=30;f.prototype.lodBeginTransition=!1;f.prototype.lodEndTransition=!1;var e={0:"keyhole.dbroot.ZoomRangeProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.LayerProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.zoomRange&&u.zoomRange.length||(u.zoomRange=[]);u.zoomRange.push(e[0].decode(n,n.uint32()));break;case 2:u.preserveTextLevel=n.int32();break;case 4:u.lodBeginTransition=n.bool();break;case 5:u.lodEndTransition=n.bool();break;default:n.skipType(f&7)}}return u},f.verify=function(n){var t,r;if(typeof n!="object"||n===null)return"object expected";if(n.zoomRange!==undefined){if(!Array.isArray(n.zoomRange))return"zoomRange: array expected";for(t=0;t<n.zoomRange.length;++t)if(r=e[0].verify(n.zoomRange[t]),r)return"zoomRange."+r}return n.preserveTextLevel!==undefined&&!i.isInteger(n.preserveTextLevel)?"preserveTextLevel: integer expected":n.lodBeginTransition!==undefined&&typeof n.lodBeginTransition!="boolean"?"lodBeginTransition: boolean expected":n.lodEndTransition!==undefined&&typeof n.lodEndTransition!="boolean"?"lodEndTransition: boolean expected":null},f.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.LayerProto)return n;if(i=new t.keyhole.dbroot.LayerProto,n.zoomRange){if(!Array.isArray(n.zoomRange))throw TypeError(".keyhole.dbroot.LayerProto.zoomRange: array expected");for(i.zoomRange=[],r=0;r<n.zoomRange.length;++r){if(typeof n.zoomRange[r]!="object")throw TypeError(".keyhole.dbroot.LayerProto.zoomRange: object expected");i.zoomRange[r]=e[0].fromObject(n.zoomRange[r])}}return n.preserveTextLevel!==undefined&&n.preserveTextLevel!==null&&(i.preserveTextLevel=n.preserveTextLevel|0),n.lodBeginTransition!==undefined&&n.lodBeginTransition!==null&&(i.lodBeginTransition=Boolean(n.lodBeginTransition)),n.lodEndTransition!==undefined&&n.lodEndTransition!==null&&(i.lodEndTransition=Boolean(n.lodEndTransition)),i},f.from=f.fromObject,f.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.zoomRange=[]),t.defaults&&(i.preserveTextLevel=30,i.lodBeginTransition=!1,i.lodEndTransition=!1),n.zoomRange!==undefined&&n.zoomRange!==null&&n.hasOwnProperty("zoomRange"))for(i.zoomRange=[],r=0;r<n.zoomRange.length;++r)i.zoomRange[r]=e[0].toObject(n.zoomRange[r],t);return n.preserveTextLevel!==undefined&&n.preserveTextLevel!==null&&n.hasOwnProperty("preserveTextLevel")&&(i.preserveTextLevel=n.preserveTextLevel),n.lodBeginTransition!==undefined&&n.lodBeginTransition!==null&&n.hasOwnProperty("lodBeginTransition")&&(i.lodBeginTransition=n.lodBeginTransition),n.lodEndTransition!==undefined&&n.lodEndTransition!==null&&n.hasOwnProperty("lodEndTransition")&&(i.lodEndTransition=n.lodEndTransition),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.FolderProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return i.prototype.isExpandable=!0,i.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.FolderProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.isExpandable=n.bool();break;default:n.skipType(f&7)}}return u},i.verify=function(n){return typeof n!="object"||n===null?"object expected":n.isExpandable!==undefined&&typeof n.isExpandable!="boolean"?"isExpandable: boolean expected":null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.FolderProto)return n;var i=new t.keyhole.dbroot.FolderProto;return n.isExpandable!==undefined&&n.isExpandable!==null&&(i.isExpandable=Boolean(n.isExpandable)),i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.isExpandable=!0),n.isExpandable!==undefined&&n.isExpandable!==null&&n.hasOwnProperty("isExpandable")&&(i.isExpandable=n.isExpandable),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),f.RequirementProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.requiredVram="",u.prototype.requiredClientVer="",u.prototype.probability="",u.prototype.requiredUserAgent="",u.prototype.requiredClientCapabilities="",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.RequirementProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 3:u.requiredVram=n.string();break;case 4:u.requiredClientVer=n.string();break;case 5:u.probability=n.string();break;case 6:u.requiredUserAgent=n.string();break;case 7:u.requiredClientCapabilities=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.requiredVram!==undefined&&!i.isString(n.requiredVram)?"requiredVram: string expected":n.requiredClientVer!==undefined&&!i.isString(n.requiredClientVer)?"requiredClientVer: string expected":n.probability!==undefined&&!i.isString(n.probability)?"probability: string expected":n.requiredUserAgent!==undefined&&!i.isString(n.requiredUserAgent)?"requiredUserAgent: string expected":n.requiredClientCapabilities!==undefined&&!i.isString(n.requiredClientCapabilities)?"requiredClientCapabilities: string expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.RequirementProto)return n;var i=new t.keyhole.dbroot.RequirementProto;return n.requiredVram!==undefined&&n.requiredVram!==null&&(i.requiredVram=String(n.requiredVram)),n.requiredClientVer!==undefined&&n.requiredClientVer!==null&&(i.requiredClientVer=String(n.requiredClientVer)),n.probability!==undefined&&n.probability!==null&&(i.probability=String(n.probability)),n.requiredUserAgent!==undefined&&n.requiredUserAgent!==null&&(i.requiredUserAgent=String(n.requiredUserAgent)),n.requiredClientCapabilities!==undefined&&n.requiredClientCapabilities!==null&&(i.requiredClientCapabilities=String(n.requiredClientCapabilities)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.requiredVram="",i.requiredClientVer="",i.probability="",i.requiredUserAgent="",i.requiredClientCapabilities=""),n.requiredVram!==undefined&&n.requiredVram!==null&&n.hasOwnProperty("requiredVram")&&(i.requiredVram=n.requiredVram),n.requiredClientVer!==undefined&&n.requiredClientVer!==null&&n.hasOwnProperty("requiredClientVer")&&(i.requiredClientVer=n.requiredClientVer),n.probability!==undefined&&n.probability!==null&&n.hasOwnProperty("probability")&&(i.probability=n.probability),n.requiredUserAgent!==undefined&&n.requiredUserAgent!==null&&n.hasOwnProperty("requiredUserAgent")&&(i.requiredUserAgent=n.requiredUserAgent),n.requiredClientCapabilities!==undefined&&n.requiredClientCapabilities!==null&&n.hasOwnProperty("requiredClientCapabilities")&&(i.requiredClientCapabilities=n.requiredClientCapabilities),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.LookAtProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return i.prototype.longitude=0,i.prototype.latitude=0,i.prototype.range=0,i.prototype.tilt=0,i.prototype.heading=0,i.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.LookAtProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.longitude=n.float();break;case 2:u.latitude=n.float();break;case 3:u.range=n.float();break;case 4:u.tilt=n.float();break;case 5:u.heading=n.float();break;default:n.skipType(f&7)}}return u},i.verify=function(n){return typeof n!="object"||n===null?"object expected":typeof n.longitude!="number"?"longitude: number expected":typeof n.latitude!="number"?"latitude: number expected":n.range!==undefined&&typeof n.range!="number"?"range: number expected":n.tilt!==undefined&&typeof n.tilt!="number"?"tilt: number expected":n.heading!==undefined&&typeof n.heading!="number"?"heading: number expected":null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.LookAtProto)return n;var i=new t.keyhole.dbroot.LookAtProto;return n.longitude!==undefined&&n.longitude!==null&&(i.longitude=Number(n.longitude)),n.latitude!==undefined&&n.latitude!==null&&(i.latitude=Number(n.latitude)),n.range!==undefined&&n.range!==null&&(i.range=Number(n.range)),n.tilt!==undefined&&n.tilt!==null&&(i.tilt=Number(n.tilt)),n.heading!==undefined&&n.heading!==null&&(i.heading=Number(n.heading)),i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.longitude=0,i.latitude=0,i.range=0,i.tilt=0,i.heading=0),n.longitude!==undefined&&n.longitude!==null&&n.hasOwnProperty("longitude")&&(i.longitude=n.longitude),n.latitude!==undefined&&n.latitude!==null&&n.hasOwnProperty("latitude")&&(i.latitude=n.latitude),n.range!==undefined&&n.range!==null&&n.hasOwnProperty("range")&&(i.range=n.range),n.tilt!==undefined&&n.tilt!==null&&n.hasOwnProperty("tilt")&&(i.tilt=n.tilt),n.heading!==undefined&&n.heading!==null&&n.hasOwnProperty("heading")&&(i.heading=n.heading),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),f.NestedFeatureProto=function(){function e(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}e.prototype.featureType=1;e.prototype.kmlUrl=null;e.prototype.databaseUrl="";e.prototype.layer=null;e.prototype.folder=null;e.prototype.requirement=null;e.prototype.channelId=0;e.prototype.displayName=null;e.prototype.isVisible=!0;e.prototype.isEnabled=!0;e.prototype.isChecked=!1;e.prototype.layerMenuIconPath="icons/773_l.png";e.prototype.description=null;e.prototype.lookAt=null;e.prototype.assetUuid="";e.prototype.isSaveLocked=!0;e.prototype.children=i.emptyArray;e.prototype.clientConfigScriptName="";e.prototype.dioramaDataChannelBase=-1;e.prototype.replicaDataChannelBase=-1;var f={0:"keyhole.dbroot.NestedFeatureProto.FeatureType",1:"keyhole.dbroot.StringIdOrValueProto",3:"keyhole.dbroot.LayerProto",4:"keyhole.dbroot.FolderProto",5:"keyhole.dbroot.RequirementProto",7:"keyhole.dbroot.StringIdOrValueProto",12:"keyhole.dbroot.StringIdOrValueProto",13:"keyhole.dbroot.LookAtProto",16:"keyhole.dbroot.NestedFeatureProto"};return u.push(f),e.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.NestedFeatureProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.featureType=n.uint32();break;case 2:u.kmlUrl=f[1].decode(n,n.uint32());break;case 21:u.databaseUrl=n.string();break;case 3:u.layer=f[3].decode(n,n.uint32());break;case 4:u.folder=f[4].decode(n,n.uint32());break;case 5:u.requirement=f[5].decode(n,n.uint32());break;case 6:u.channelId=n.int32();break;case 7:u.displayName=f[7].decode(n,n.uint32());break;case 8:u.isVisible=n.bool();break;case 9:u.isEnabled=n.bool();break;case 10:u.isChecked=n.bool();break;case 11:u.layerMenuIconPath=n.string();break;case 12:u.description=f[12].decode(n,n.uint32());break;case 13:u.lookAt=f[13].decode(n,n.uint32());break;case 15:u.assetUuid=n.string();break;case 16:u.isSaveLocked=n.bool();break;case 17:u.children&&u.children.length||(u.children=[]);u.children.push(f[16].decode(n,n.uint32()));break;case 18:u.clientConfigScriptName=n.string();break;case 19:u.dioramaDataChannelBase=n.int32();break;case 20:u.replicaDataChannelBase=n.int32();break;default:n.skipType(e&7)}}return u},e.verify=function(n){var r,t;if(typeof n!="object"||n===null)return"object expected";if(n.featureType!==undefined)switch(n.featureType){default:return"featureType: enum value expected";case 1:case 2:case 3:case 4:}if(n.kmlUrl!==undefined&&n.kmlUrl!==null&&(t=f[1].verify(n.kmlUrl),t))return"kmlUrl."+t;if(n.databaseUrl!==undefined&&!i.isString(n.databaseUrl))return"databaseUrl: string expected";if(n.layer!==undefined&&n.layer!==null&&(t=f[3].verify(n.layer),t))return"layer."+t;if(n.folder!==undefined&&n.folder!==null&&(t=f[4].verify(n.folder),t))return"folder."+t;if(n.requirement!==undefined&&n.requirement!==null&&(t=f[5].verify(n.requirement),t))return"requirement."+t;if(!i.isInteger(n.channelId))return"channelId: integer expected";if(n.displayName!==undefined&&n.displayName!==null&&(t=f[7].verify(n.displayName),t))return"displayName."+t;if(n.isVisible!==undefined&&typeof n.isVisible!="boolean")return"isVisible: boolean expected";if(n.isEnabled!==undefined&&typeof n.isEnabled!="boolean")return"isEnabled: boolean expected";if(n.isChecked!==undefined&&typeof n.isChecked!="boolean")return"isChecked: boolean expected";if(n.layerMenuIconPath!==undefined&&!i.isString(n.layerMenuIconPath))return"layerMenuIconPath: string expected";if(n.description!==undefined&&n.description!==null&&(t=f[12].verify(n.description),t))return"description."+t;if(n.lookAt!==undefined&&n.lookAt!==null&&(t=f[13].verify(n.lookAt),t))return"lookAt."+t;if(n.assetUuid!==undefined&&!i.isString(n.assetUuid))return"assetUuid: string expected";if(n.isSaveLocked!==undefined&&typeof n.isSaveLocked!="boolean")return"isSaveLocked: boolean expected";if(n.children!==undefined){if(!Array.isArray(n.children))return"children: array expected";for(r=0;r<n.children.length;++r)if(t=f[16].verify(n.children[r]),t)return"children."+t}return n.clientConfigScriptName!==undefined&&!i.isString(n.clientConfigScriptName)?"clientConfigScriptName: string expected":n.dioramaDataChannelBase!==undefined&&!i.isInteger(n.dioramaDataChannelBase)?"dioramaDataChannelBase: integer expected":n.replicaDataChannelBase!==undefined&&!i.isInteger(n.replicaDataChannelBase)?"replicaDataChannelBase: integer expected":null},e.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.NestedFeatureProto)return n;i=new t.keyhole.dbroot.NestedFeatureProto;switch(n.featureType){case"TYPE_POINT_Z":case 1:i.featureType=1;break;case"TYPE_POLYGON_Z":case 2:i.featureType=2;break;case"TYPE_LINE_Z":case 3:i.featureType=3;break;case"TYPE_TERRAIN":case 4:i.featureType=4}if(n.kmlUrl!==undefined&&n.kmlUrl!==null){if(typeof n.kmlUrl!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.kmlUrl: object expected");i.kmlUrl=f[1].fromObject(n.kmlUrl)}if(n.databaseUrl!==undefined&&n.databaseUrl!==null&&(i.databaseUrl=String(n.databaseUrl)),n.layer!==undefined&&n.layer!==null){if(typeof n.layer!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.layer: object expected");i.layer=f[3].fromObject(n.layer)}if(n.folder!==undefined&&n.folder!==null){if(typeof n.folder!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.folder: object expected");i.folder=f[4].fromObject(n.folder)}if(n.requirement!==undefined&&n.requirement!==null){if(typeof n.requirement!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.requirement: object expected");i.requirement=f[5].fromObject(n.requirement)}if(n.channelId!==undefined&&n.channelId!==null&&(i.channelId=n.channelId|0),n.displayName!==undefined&&n.displayName!==null){if(typeof n.displayName!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.displayName: object expected");i.displayName=f[7].fromObject(n.displayName)}if(n.isVisible!==undefined&&n.isVisible!==null&&(i.isVisible=Boolean(n.isVisible)),n.isEnabled!==undefined&&n.isEnabled!==null&&(i.isEnabled=Boolean(n.isEnabled)),n.isChecked!==undefined&&n.isChecked!==null&&(i.isChecked=Boolean(n.isChecked)),n.layerMenuIconPath!==undefined&&n.layerMenuIconPath!==null&&(i.layerMenuIconPath=String(n.layerMenuIconPath)),n.description!==undefined&&n.description!==null){if(typeof n.description!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.description: object expected");i.description=f[12].fromObject(n.description)}if(n.lookAt!==undefined&&n.lookAt!==null){if(typeof n.lookAt!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.lookAt: object expected");i.lookAt=f[13].fromObject(n.lookAt)}if(n.assetUuid!==undefined&&n.assetUuid!==null&&(i.assetUuid=String(n.assetUuid)),n.isSaveLocked!==undefined&&n.isSaveLocked!==null&&(i.isSaveLocked=Boolean(n.isSaveLocked)),n.children){if(!Array.isArray(n.children))throw TypeError(".keyhole.dbroot.NestedFeatureProto.children: array expected");for(i.children=[],r=0;r<n.children.length;++r){if(typeof n.children[r]!="object")throw TypeError(".keyhole.dbroot.NestedFeatureProto.children: object expected");i.children[r]=f[16].fromObject(n.children[r])}}return n.clientConfigScriptName!==undefined&&n.clientConfigScriptName!==null&&(i.clientConfigScriptName=String(n.clientConfigScriptName)),n.dioramaDataChannelBase!==undefined&&n.dioramaDataChannelBase!==null&&(i.dioramaDataChannelBase=n.dioramaDataChannelBase|0),n.replicaDataChannelBase!==undefined&&n.replicaDataChannelBase!==null&&(i.replicaDataChannelBase=n.replicaDataChannelBase|0),i},e.from=e.fromObject,e.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.children=[]),t.defaults&&(i.featureType=t.enums===String?"TYPE_POINT_Z":1,i.kmlUrl=null,i.databaseUrl="",i.layer=null,i.folder=null,i.requirement=null,i.channelId=0,i.displayName=null,i.isVisible=!0,i.isEnabled=!0,i.isChecked=!1,i.layerMenuIconPath="icons/773_l.png",i.description=null,i.lookAt=null,i.assetUuid="",i.isSaveLocked=!0,i.clientConfigScriptName="",i.dioramaDataChannelBase=-1,i.replicaDataChannelBase=-1),n.featureType!==undefined&&n.featureType!==null&&n.hasOwnProperty("featureType")&&(i.featureType=t.enums===String?f[0][n.featureType]:n.featureType),n.kmlUrl!==undefined&&n.kmlUrl!==null&&n.hasOwnProperty("kmlUrl")&&(i.kmlUrl=f[1].toObject(n.kmlUrl,t)),n.databaseUrl!==undefined&&n.databaseUrl!==null&&n.hasOwnProperty("databaseUrl")&&(i.databaseUrl=n.databaseUrl),n.layer!==undefined&&n.layer!==null&&n.hasOwnProperty("layer")&&(i.layer=f[3].toObject(n.layer,t)),n.folder!==undefined&&n.folder!==null&&n.hasOwnProperty("folder")&&(i.folder=f[4].toObject(n.folder,t)),n.requirement!==undefined&&n.requirement!==null&&n.hasOwnProperty("requirement")&&(i.requirement=f[5].toObject(n.requirement,t)),n.channelId!==undefined&&n.channelId!==null&&n.hasOwnProperty("channelId")&&(i.channelId=n.channelId),n.displayName!==undefined&&n.displayName!==null&&n.hasOwnProperty("displayName")&&(i.displayName=f[7].toObject(n.displayName,t)),n.isVisible!==undefined&&n.isVisible!==null&&n.hasOwnProperty("isVisible")&&(i.isVisible=n.isVisible),n.isEnabled!==undefined&&n.isEnabled!==null&&n.hasOwnProperty("isEnabled")&&(i.isEnabled=n.isEnabled),n.isChecked!==undefined&&n.isChecked!==null&&n.hasOwnProperty("isChecked")&&(i.isChecked=n.isChecked),n.layerMenuIconPath!==undefined&&n.layerMenuIconPath!==null&&n.hasOwnProperty("layerMenuIconPath")&&(i.layerMenuIconPath=n.layerMenuIconPath),n.description!==undefined&&n.description!==null&&n.hasOwnProperty("description")&&(i.description=f[12].toObject(n.description,t)),n.lookAt!==undefined&&n.lookAt!==null&&n.hasOwnProperty("lookAt")&&(i.lookAt=f[13].toObject(n.lookAt,t)),n.assetUuid!==undefined&&n.assetUuid!==null&&n.hasOwnProperty("assetUuid")&&(i.assetUuid=n.assetUuid),n.isSaveLocked!==undefined&&n.isSaveLocked!==null&&n.hasOwnProperty("isSaveLocked")&&(i.isSaveLocked=n.isSaveLocked),n.children!==undefined&&n.children!==null&&n.hasOwnProperty("children"))for(i.children=[],r=0;r<n.children.length;++r)i.children[r]=f[16].toObject(n.children[r],t);return n.clientConfigScriptName!==undefined&&n.clientConfigScriptName!==null&&n.hasOwnProperty("clientConfigScriptName")&&(i.clientConfigScriptName=n.clientConfigScriptName),n.dioramaDataChannelBase!==undefined&&n.dioramaDataChannelBase!==null&&n.hasOwnProperty("dioramaDataChannelBase")&&(i.dioramaDataChannelBase=n.dioramaDataChannelBase),n.replicaDataChannelBase!==undefined&&n.replicaDataChannelBase!==null&&n.hasOwnProperty("replicaDataChannelBase")&&(i.replicaDataChannelBase=n.replicaDataChannelBase),i},e.prototype.toObject=function(n){return this.constructor.toObject(this,n)},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.FeatureType=function(){var n=Object.create({});return n.TYPE_POINT_Z=1,n.TYPE_POLYGON_Z=2,n.TYPE_LINE_Z=3,n.TYPE_TERRAIN=4,n}(),e}(),f.MfeDomainFeaturesProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.countryCode="";f.prototype.domainName="";f.prototype.supportedFeatures=i.emptyArray;var e={2:"keyhole.dbroot.MfeDomainFeaturesProto.SupportedFeature"};return u.push(e),f.decode=function(n,i){var e,u,f,o;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.MfeDomainFeaturesProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.countryCode=n.string();break;case 2:u.domainName=n.string();break;case 3:if(u.supportedFeatures&&u.supportedFeatures.length||(u.supportedFeatures=[]),(f&7)==2)for(o=n.uint32()+n.pos;n.pos<o;)u.supportedFeatures.push(n.uint32());else u.supportedFeatures.push(n.uint32());break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(!i.isString(n.countryCode))return"countryCode: string expected";if(!i.isString(n.domainName))return"domainName: string expected";if(n.supportedFeatures!==undefined){if(!Array.isArray(n.supportedFeatures))return"supportedFeatures: array expected";for(var t=0;t<n.supportedFeatures.length;++t)switch(n.supportedFeatures[t]){default:return"supportedFeatures: enum value[] expected";case 0:case 1:case 2:}}return null},f.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.MfeDomainFeaturesProto)return n;if(i=new t.keyhole.dbroot.MfeDomainFeaturesProto,n.countryCode!==undefined&&n.countryCode!==null&&(i.countryCode=String(n.countryCode)),n.domainName!==undefined&&n.domainName!==null&&(i.domainName=String(n.domainName)),n.supportedFeatures){if(!Array.isArray(n.supportedFeatures))throw TypeError(".keyhole.dbroot.MfeDomainFeaturesProto.supportedFeatures: array expected");for(i.supportedFeatures=[],r=0;r<n.supportedFeatures.length;++r)switch(n.supportedFeatures[r]){default:case"GEOCODING":case 0:i.supportedFeatures[r]=0;break;case"LOCAL_SEARCH":case 1:i.supportedFeatures[r]=1;break;case"DRIVING_DIRECTIONS":case 2:i.supportedFeatures[r]=2}}return i},f.from=f.fromObject,f.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.supportedFeatures=[]),t.defaults&&(i.countryCode="",i.domainName=""),n.countryCode!==undefined&&n.countryCode!==null&&n.hasOwnProperty("countryCode")&&(i.countryCode=n.countryCode),n.domainName!==undefined&&n.domainName!==null&&n.hasOwnProperty("domainName")&&(i.domainName=n.domainName),n.supportedFeatures!==undefined&&n.supportedFeatures!==null&&n.hasOwnProperty("supportedFeatures"))for(i.supportedFeatures=[],r=0;r<n.supportedFeatures.length;++r)i.supportedFeatures[r]=t.enums===String?e[2][n.supportedFeatures[r]]:n.supportedFeatures[r];return i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.SupportedFeature=function(){var n=Object.create({});return n.GEOCODING=0,n.LOCAL_SEARCH=1,n.DRIVING_DIRECTIONS=2,n}(),f}(),f.ClientOptionsProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.disableDiskCache=!1;f.prototype.disableEmbeddedBrowserVista=!1;f.prototype.drawAtmosphere=!0;f.prototype.drawStars=!0;f.prototype.shaderFilePrefix="";f.prototype.useProtobufQuadtreePackets=!1;f.prototype.useExtendedCopyrightIds=!0;f.prototype.precipitationsOptions=null;f.prototype.captureOptions=null;f.prototype.show_2dMapsIcon=!0;f.prototype.disableInternalBrowser=!1;f.prototype.internalBrowserBlacklist="";f.prototype.internalBrowserOriginWhitelist="*";f.prototype.polarTileMergingLevel=0;f.prototype.jsBridgeRequestWhitelist="http://*.google.com/*";f.prototype.mapsOptions=null;var e={7:"keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions",8:"keyhole.dbroot.ClientOptionsProto.CaptureOptions",15:"keyhole.dbroot.ClientOptionsProto.MapsOptions"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ClientOptionsProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.disableDiskCache=n.bool();break;case 2:u.disableEmbeddedBrowserVista=n.bool();break;case 3:u.drawAtmosphere=n.bool();break;case 4:u.drawStars=n.bool();break;case 5:u.shaderFilePrefix=n.string();break;case 6:u.useProtobufQuadtreePackets=n.bool();break;case 7:u.useExtendedCopyrightIds=n.bool();break;case 8:u.precipitationsOptions=e[7].decode(n,n.uint32());break;case 9:u.captureOptions=e[8].decode(n,n.uint32());break;case 10:u.show_2dMapsIcon=n.bool();break;case 11:u.disableInternalBrowser=n.bool();break;case 12:u.internalBrowserBlacklist=n.string();break;case 13:u.internalBrowserOriginWhitelist=n.string();break;case 14:u.polarTileMergingLevel=n.int32();break;case 15:u.jsBridgeRequestWhitelist=n.string();break;case 16:u.mapsOptions=e[15].decode(n,n.uint32());break;default:n.skipType(f&7)}}return u},f.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":n.disableDiskCache!==undefined&&typeof n.disableDiskCache!="boolean"?"disableDiskCache: boolean expected":n.disableEmbeddedBrowserVista!==undefined&&typeof n.disableEmbeddedBrowserVista!="boolean"?"disableEmbeddedBrowserVista: boolean expected":n.drawAtmosphere!==undefined&&typeof n.drawAtmosphere!="boolean"?"drawAtmosphere: boolean expected":n.drawStars!==undefined&&typeof n.drawStars!="boolean"?"drawStars: boolean expected":n.shaderFilePrefix!==undefined&&!i.isString(n.shaderFilePrefix)?"shaderFilePrefix: string expected":n.useProtobufQuadtreePackets!==undefined&&typeof n.useProtobufQuadtreePackets!="boolean"?"useProtobufQuadtreePackets: boolean expected":n.useExtendedCopyrightIds!==undefined&&typeof n.useExtendedCopyrightIds!="boolean"?"useExtendedCopyrightIds: boolean expected":n.precipitationsOptions!==undefined&&n.precipitationsOptions!==null&&(t=e[7].verify(n.precipitationsOptions),t)?"precipitationsOptions."+t:n.captureOptions!==undefined&&n.captureOptions!==null&&(t=e[8].verify(n.captureOptions),t)?"captureOptions."+t:n.show_2dMapsIcon!==undefined&&typeof n.show_2dMapsIcon!="boolean"?"show_2dMapsIcon: boolean expected":n.disableInternalBrowser!==undefined&&typeof n.disableInternalBrowser!="boolean"?"disableInternalBrowser: boolean expected":n.internalBrowserBlacklist!==undefined&&!i.isString(n.internalBrowserBlacklist)?"internalBrowserBlacklist: string expected":n.internalBrowserOriginWhitelist!==undefined&&!i.isString(n.internalBrowserOriginWhitelist)?"internalBrowserOriginWhitelist: string expected":n.polarTileMergingLevel!==undefined&&!i.isInteger(n.polarTileMergingLevel)?"polarTileMergingLevel: integer expected":n.jsBridgeRequestWhitelist!==undefined&&!i.isString(n.jsBridgeRequestWhitelist)?"jsBridgeRequestWhitelist: string expected":n.mapsOptions!==undefined&&n.mapsOptions!==null&&(t=e[15].verify(n.mapsOptions),t)?"mapsOptions."+t:null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ClientOptionsProto)return n;var i=new t.keyhole.dbroot.ClientOptionsProto;if(n.disableDiskCache!==undefined&&n.disableDiskCache!==null&&(i.disableDiskCache=Boolean(n.disableDiskCache)),n.disableEmbeddedBrowserVista!==undefined&&n.disableEmbeddedBrowserVista!==null&&(i.disableEmbeddedBrowserVista=Boolean(n.disableEmbeddedBrowserVista)),n.drawAtmosphere!==undefined&&n.drawAtmosphere!==null&&(i.drawAtmosphere=Boolean(n.drawAtmosphere)),n.drawStars!==undefined&&n.drawStars!==null&&(i.drawStars=Boolean(n.drawStars)),n.shaderFilePrefix!==undefined&&n.shaderFilePrefix!==null&&(i.shaderFilePrefix=String(n.shaderFilePrefix)),n.useProtobufQuadtreePackets!==undefined&&n.useProtobufQuadtreePackets!==null&&(i.useProtobufQuadtreePackets=Boolean(n.useProtobufQuadtreePackets)),n.useExtendedCopyrightIds!==undefined&&n.useExtendedCopyrightIds!==null&&(i.useExtendedCopyrightIds=Boolean(n.useExtendedCopyrightIds)),n.precipitationsOptions!==undefined&&n.precipitationsOptions!==null){if(typeof n.precipitationsOptions!="object")throw TypeError(".keyhole.dbroot.ClientOptionsProto.precipitationsOptions: object expected");i.precipitationsOptions=e[7].fromObject(n.precipitationsOptions)}if(n.captureOptions!==undefined&&n.captureOptions!==null){if(typeof n.captureOptions!="object")throw TypeError(".keyhole.dbroot.ClientOptionsProto.captureOptions: object expected");i.captureOptions=e[8].fromObject(n.captureOptions)}if(n.show_2dMapsIcon!==undefined&&n.show_2dMapsIcon!==null&&(i.show_2dMapsIcon=Boolean(n.show_2dMapsIcon)),n.disableInternalBrowser!==undefined&&n.disableInternalBrowser!==null&&(i.disableInternalBrowser=Boolean(n.disableInternalBrowser)),n.internalBrowserBlacklist!==undefined&&n.internalBrowserBlacklist!==null&&(i.internalBrowserBlacklist=String(n.internalBrowserBlacklist)),n.internalBrowserOriginWhitelist!==undefined&&n.internalBrowserOriginWhitelist!==null&&(i.internalBrowserOriginWhitelist=String(n.internalBrowserOriginWhitelist)),n.polarTileMergingLevel!==undefined&&n.polarTileMergingLevel!==null&&(i.polarTileMergingLevel=n.polarTileMergingLevel|0),n.jsBridgeRequestWhitelist!==undefined&&n.jsBridgeRequestWhitelist!==null&&(i.jsBridgeRequestWhitelist=String(n.jsBridgeRequestWhitelist)),n.mapsOptions!==undefined&&n.mapsOptions!==null){if(typeof n.mapsOptions!="object")throw TypeError(".keyhole.dbroot.ClientOptionsProto.mapsOptions: object expected");i.mapsOptions=e[15].fromObject(n.mapsOptions)}return i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.disableDiskCache=!1,i.disableEmbeddedBrowserVista=!1,i.drawAtmosphere=!0,i.drawStars=!0,i.shaderFilePrefix="",i.useProtobufQuadtreePackets=!1,i.useExtendedCopyrightIds=!0,i.precipitationsOptions=null,i.captureOptions=null,i.show_2dMapsIcon=!0,i.disableInternalBrowser=!1,i.internalBrowserBlacklist="",i.internalBrowserOriginWhitelist="*",i.polarTileMergingLevel=0,i.jsBridgeRequestWhitelist="http://*.google.com/*",i.mapsOptions=null),n.disableDiskCache!==undefined&&n.disableDiskCache!==null&&n.hasOwnProperty("disableDiskCache")&&(i.disableDiskCache=n.disableDiskCache),n.disableEmbeddedBrowserVista!==undefined&&n.disableEmbeddedBrowserVista!==null&&n.hasOwnProperty("disableEmbeddedBrowserVista")&&(i.disableEmbeddedBrowserVista=n.disableEmbeddedBrowserVista),n.drawAtmosphere!==undefined&&n.drawAtmosphere!==null&&n.hasOwnProperty("drawAtmosphere")&&(i.drawAtmosphere=n.drawAtmosphere),n.drawStars!==undefined&&n.drawStars!==null&&n.hasOwnProperty("drawStars")&&(i.drawStars=n.drawStars),n.shaderFilePrefix!==undefined&&n.shaderFilePrefix!==null&&n.hasOwnProperty("shaderFilePrefix")&&(i.shaderFilePrefix=n.shaderFilePrefix),n.useProtobufQuadtreePackets!==undefined&&n.useProtobufQuadtreePackets!==null&&n.hasOwnProperty("useProtobufQuadtreePackets")&&(i.useProtobufQuadtreePackets=n.useProtobufQuadtreePackets),n.useExtendedCopyrightIds!==undefined&&n.useExtendedCopyrightIds!==null&&n.hasOwnProperty("useExtendedCopyrightIds")&&(i.useExtendedCopyrightIds=n.useExtendedCopyrightIds),n.precipitationsOptions!==undefined&&n.precipitationsOptions!==null&&n.hasOwnProperty("precipitationsOptions")&&(i.precipitationsOptions=e[7].toObject(n.precipitationsOptions,t)),n.captureOptions!==undefined&&n.captureOptions!==null&&n.hasOwnProperty("captureOptions")&&(i.captureOptions=e[8].toObject(n.captureOptions,t)),n.show_2dMapsIcon!==undefined&&n.show_2dMapsIcon!==null&&n.hasOwnProperty("show_2dMapsIcon")&&(i.show_2dMapsIcon=n.show_2dMapsIcon),n.disableInternalBrowser!==undefined&&n.disableInternalBrowser!==null&&n.hasOwnProperty("disableInternalBrowser")&&(i.disableInternalBrowser=n.disableInternalBrowser),n.internalBrowserBlacklist!==undefined&&n.internalBrowserBlacklist!==null&&n.hasOwnProperty("internalBrowserBlacklist")&&(i.internalBrowserBlacklist=n.internalBrowserBlacklist),n.internalBrowserOriginWhitelist!==undefined&&n.internalBrowserOriginWhitelist!==null&&n.hasOwnProperty("internalBrowserOriginWhitelist")&&(i.internalBrowserOriginWhitelist=n.internalBrowserOriginWhitelist),n.polarTileMergingLevel!==undefined&&n.polarTileMergingLevel!==null&&n.hasOwnProperty("polarTileMergingLevel")&&(i.polarTileMergingLevel=n.polarTileMergingLevel),n.jsBridgeRequestWhitelist!==undefined&&n.jsBridgeRequestWhitelist!==null&&n.hasOwnProperty("jsBridgeRequestWhitelist")&&(i.jsBridgeRequestWhitelist=n.jsBridgeRequestWhitelist),n.mapsOptions!==undefined&&n.mapsOptions!==null&&n.hasOwnProperty("mapsOptions")&&(i.mapsOptions=e[15].toObject(n.mapsOptions,t)),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.PrecipitationsOptions=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.imageUrl="";f.prototype.imageExpireTime=900;f.prototype.maxColorDistance=20;f.prototype.imageLevel=5;f.prototype.weatherMapping=i.emptyArray;f.prototype.cloudsLayerUrl="";f.prototype.animationDecelerationDelay=20;var e={4:"keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.WeatherMapping"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.imageUrl=n.string();break;case 2:u.imageExpireTime=n.int32();break;case 3:u.maxColorDistance=n.int32();break;case 4:u.imageLevel=n.int32();break;case 5:u.weatherMapping&&u.weatherMapping.length||(u.weatherMapping=[]);u.weatherMapping.push(e[4].decode(n,n.uint32()));break;case 6:u.cloudsLayerUrl=n.string();break;case 7:u.animationDecelerationDelay=n.float();break;default:n.skipType(f&7)}}return u},f.verify=function(n){var t,r;if(typeof n!="object"||n===null)return"object expected";if(n.imageUrl!==undefined&&!i.isString(n.imageUrl))return"imageUrl: string expected";if(n.imageExpireTime!==undefined&&!i.isInteger(n.imageExpireTime))return"imageExpireTime: integer expected";if(n.maxColorDistance!==undefined&&!i.isInteger(n.maxColorDistance))return"maxColorDistance: integer expected";if(n.imageLevel!==undefined&&!i.isInteger(n.imageLevel))return"imageLevel: integer expected";if(n.weatherMapping!==undefined){if(!Array.isArray(n.weatherMapping))return"weatherMapping: array expected";for(t=0;t<n.weatherMapping.length;++t)if(r=e[4].verify(n.weatherMapping[t]),r)return"weatherMapping."+r}return n.cloudsLayerUrl!==undefined&&!i.isString(n.cloudsLayerUrl)?"cloudsLayerUrl: string expected":n.animationDecelerationDelay!==undefined&&typeof n.animationDecelerationDelay!="number"?"animationDecelerationDelay: number expected":null},f.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions)return n;if(i=new t.keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions,n.imageUrl!==undefined&&n.imageUrl!==null&&(i.imageUrl=String(n.imageUrl)),n.imageExpireTime!==undefined&&n.imageExpireTime!==null&&(i.imageExpireTime=n.imageExpireTime|0),n.maxColorDistance!==undefined&&n.maxColorDistance!==null&&(i.maxColorDistance=n.maxColorDistance|0),n.imageLevel!==undefined&&n.imageLevel!==null&&(i.imageLevel=n.imageLevel|0),n.weatherMapping){if(!Array.isArray(n.weatherMapping))throw TypeError(".keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.weatherMapping: array expected");for(i.weatherMapping=[],r=0;r<n.weatherMapping.length;++r){if(typeof n.weatherMapping[r]!="object")throw TypeError(".keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.weatherMapping: object expected");i.weatherMapping[r]=e[4].fromObject(n.weatherMapping[r])}}return n.cloudsLayerUrl!==undefined&&n.cloudsLayerUrl!==null&&(i.cloudsLayerUrl=String(n.cloudsLayerUrl)),n.animationDecelerationDelay!==undefined&&n.animationDecelerationDelay!==null&&(i.animationDecelerationDelay=Number(n.animationDecelerationDelay)),i},f.from=f.fromObject,f.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.weatherMapping=[]),t.defaults&&(i.imageUrl="",i.imageExpireTime=900,i.maxColorDistance=20,i.imageLevel=5,i.cloudsLayerUrl="",i.animationDecelerationDelay=20),n.imageUrl!==undefined&&n.imageUrl!==null&&n.hasOwnProperty("imageUrl")&&(i.imageUrl=n.imageUrl),n.imageExpireTime!==undefined&&n.imageExpireTime!==null&&n.hasOwnProperty("imageExpireTime")&&(i.imageExpireTime=n.imageExpireTime),n.maxColorDistance!==undefined&&n.maxColorDistance!==null&&n.hasOwnProperty("maxColorDistance")&&(i.maxColorDistance=n.maxColorDistance),n.imageLevel!==undefined&&n.imageLevel!==null&&n.hasOwnProperty("imageLevel")&&(i.imageLevel=n.imageLevel),n.weatherMapping!==undefined&&n.weatherMapping!==null&&n.hasOwnProperty("weatherMapping"))for(i.weatherMapping=[],r=0;r<n.weatherMapping.length;++r)i.weatherMapping[r]=e[4].toObject(n.weatherMapping[r],t);return n.cloudsLayerUrl!==undefined&&n.cloudsLayerUrl!==null&&n.hasOwnProperty("cloudsLayerUrl")&&(i.cloudsLayerUrl=n.cloudsLayerUrl),n.animationDecelerationDelay!==undefined&&n.animationDecelerationDelay!==null&&n.hasOwnProperty("animationDecelerationDelay")&&(i.animationDecelerationDelay=n.animationDecelerationDelay),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.WeatherMapping=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.colorAbgr=0;f.prototype.weatherType=0;f.prototype.elongation=1;f.prototype.opacity=0;f.prototype.fogDensity=0;f.prototype.speed0=0;f.prototype.speed1=0;f.prototype.speed2=0;f.prototype.speed3=0;var e={1:"keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.WeatherMapping.WeatherType"};return u.push(e),f.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.WeatherMapping;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.colorAbgr=n.uint32();break;case 2:u.weatherType=n.uint32();break;case 3:u.elongation=n.float();break;case 4:u.opacity=n.float();break;case 5:u.fogDensity=n.float();break;case 6:u.speed0=n.float();break;case 7:u.speed1=n.float();break;case 8:u.speed2=n.float();break;case 9:u.speed3=n.float();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(!i.isInteger(n.colorAbgr))return"colorAbgr: integer expected";switch(n.weatherType){default:return"weatherType: enum value expected";case 0:case 1:case 2:}return n.elongation!==undefined&&typeof n.elongation!="number"?"elongation: number expected":n.opacity!==undefined&&typeof n.opacity!="number"?"opacity: number expected":n.fogDensity!==undefined&&typeof n.fogDensity!="number"?"fogDensity: number expected":n.speed0!==undefined&&typeof n.speed0!="number"?"speed0: number expected":n.speed1!==undefined&&typeof n.speed1!="number"?"speed1: number expected":n.speed2!==undefined&&typeof n.speed2!="number"?"speed2: number expected":n.speed3!==undefined&&typeof n.speed3!="number"?"speed3: number expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.WeatherMapping)return n;var i=new t.keyhole.dbroot.ClientOptionsProto.PrecipitationsOptions.WeatherMapping;n.colorAbgr!==undefined&&n.colorAbgr!==null&&(i.colorAbgr=n.colorAbgr>>>0);switch(n.weatherType){case"NO_PRECIPITATION":case 0:i.weatherType=0;break;case"RAIN":case 1:i.weatherType=1;break;case"SNOW":case 2:i.weatherType=2}return n.elongation!==undefined&&n.elongation!==null&&(i.elongation=Number(n.elongation)),n.opacity!==undefined&&n.opacity!==null&&(i.opacity=Number(n.opacity)),n.fogDensity!==undefined&&n.fogDensity!==null&&(i.fogDensity=Number(n.fogDensity)),n.speed0!==undefined&&n.speed0!==null&&(i.speed0=Number(n.speed0)),n.speed1!==undefined&&n.speed1!==null&&(i.speed1=Number(n.speed1)),n.speed2!==undefined&&n.speed2!==null&&(i.speed2=Number(n.speed2)),n.speed3!==undefined&&n.speed3!==null&&(i.speed3=Number(n.speed3)),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.colorAbgr=0,i.weatherType=t.enums===String?"NO_PRECIPITATION":0,i.elongation=1,i.opacity=0,i.fogDensity=0,i.speed0=0,i.speed1=0,i.speed2=0,i.speed3=0),n.colorAbgr!==undefined&&n.colorAbgr!==null&&n.hasOwnProperty("colorAbgr")&&(i.colorAbgr=n.colorAbgr),n.weatherType!==undefined&&n.weatherType!==null&&n.hasOwnProperty("weatherType")&&(i.weatherType=t.enums===String?e[1][n.weatherType]:n.weatherType),n.elongation!==undefined&&n.elongation!==null&&n.hasOwnProperty("elongation")&&(i.elongation=n.elongation),n.opacity!==undefined&&n.opacity!==null&&n.hasOwnProperty("opacity")&&(i.opacity=n.opacity),n.fogDensity!==undefined&&n.fogDensity!==null&&n.hasOwnProperty("fogDensity")&&(i.fogDensity=n.fogDensity),n.speed0!==undefined&&n.speed0!==null&&n.hasOwnProperty("speed0")&&(i.speed0=n.speed0),n.speed1!==undefined&&n.speed1!==null&&n.hasOwnProperty("speed1")&&(i.speed1=n.speed1),n.speed2!==undefined&&n.speed2!==null&&n.hasOwnProperty("speed2")&&(i.speed2=n.speed2),n.speed3!==undefined&&n.speed3!==null&&n.hasOwnProperty("speed3")&&(i.speed3=n.speed3),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.WeatherType=function(){var n=Object.create({});return n.NO_PRECIPITATION=0,n.RAIN=1,n.SNOW=2,n}(),f}(),f}(),f.CaptureOptions=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.allowSaveAsImage=!0,u.prototype.maxFreeCaptureRes=2400,u.prototype.maxPremiumCaptureRes=4800,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ClientOptionsProto.CaptureOptions;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.allowSaveAsImage=n.bool();break;case 2:u.maxFreeCaptureRes=n.int32();break;case 3:u.maxPremiumCaptureRes=n.int32();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.allowSaveAsImage!==undefined&&typeof n.allowSaveAsImage!="boolean"?"allowSaveAsImage: boolean expected":n.maxFreeCaptureRes!==undefined&&!i.isInteger(n.maxFreeCaptureRes)?"maxFreeCaptureRes: integer expected":n.maxPremiumCaptureRes!==undefined&&!i.isInteger(n.maxPremiumCaptureRes)?"maxPremiumCaptureRes: integer expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ClientOptionsProto.CaptureOptions)return n;var i=new t.keyhole.dbroot.ClientOptionsProto.CaptureOptions;return n.allowSaveAsImage!==undefined&&n.allowSaveAsImage!==null&&(i.allowSaveAsImage=Boolean(n.allowSaveAsImage)),n.maxFreeCaptureRes!==undefined&&n.maxFreeCaptureRes!==null&&(i.maxFreeCaptureRes=n.maxFreeCaptureRes|0),n.maxPremiumCaptureRes!==undefined&&n.maxPremiumCaptureRes!==null&&(i.maxPremiumCaptureRes=n.maxPremiumCaptureRes|0),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.allowSaveAsImage=!0,i.maxFreeCaptureRes=2400,i.maxPremiumCaptureRes=4800),n.allowSaveAsImage!==undefined&&n.allowSaveAsImage!==null&&n.hasOwnProperty("allowSaveAsImage")&&(i.allowSaveAsImage=n.allowSaveAsImage),n.maxFreeCaptureRes!==undefined&&n.maxFreeCaptureRes!==null&&n.hasOwnProperty("maxFreeCaptureRes")&&(i.maxFreeCaptureRes=n.maxFreeCaptureRes),n.maxPremiumCaptureRes!==undefined&&n.maxPremiumCaptureRes!==null&&n.hasOwnProperty("maxPremiumCaptureRes")&&(i.maxPremiumCaptureRes=n.maxPremiumCaptureRes),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.MapsOptions=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.enableMaps=!1,u.prototype.docsAutoDownloadEnabled=!1,u.prototype.docsAutoDownloadInterval=0,u.prototype.docsAutoUploadEnabled=!1,u.prototype.docsAutoUploadDelay=0,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ClientOptionsProto.MapsOptions;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.enableMaps=n.bool();break;case 2:u.docsAutoDownloadEnabled=n.bool();break;case 3:u.docsAutoDownloadInterval=n.int32();break;case 4:u.docsAutoUploadEnabled=n.bool();break;case 5:u.docsAutoUploadDelay=n.int32();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.enableMaps!==undefined&&typeof n.enableMaps!="boolean"?"enableMaps: boolean expected":n.docsAutoDownloadEnabled!==undefined&&typeof n.docsAutoDownloadEnabled!="boolean"?"docsAutoDownloadEnabled: boolean expected":n.docsAutoDownloadInterval!==undefined&&!i.isInteger(n.docsAutoDownloadInterval)?"docsAutoDownloadInterval: integer expected":n.docsAutoUploadEnabled!==undefined&&typeof n.docsAutoUploadEnabled!="boolean"?"docsAutoUploadEnabled: boolean expected":n.docsAutoUploadDelay!==undefined&&!i.isInteger(n.docsAutoUploadDelay)?"docsAutoUploadDelay: integer expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ClientOptionsProto.MapsOptions)return n;var i=new t.keyhole.dbroot.ClientOptionsProto.MapsOptions;return n.enableMaps!==undefined&&n.enableMaps!==null&&(i.enableMaps=Boolean(n.enableMaps)),n.docsAutoDownloadEnabled!==undefined&&n.docsAutoDownloadEnabled!==null&&(i.docsAutoDownloadEnabled=Boolean(n.docsAutoDownloadEnabled)),n.docsAutoDownloadInterval!==undefined&&n.docsAutoDownloadInterval!==null&&(i.docsAutoDownloadInterval=n.docsAutoDownloadInterval|0),n.docsAutoUploadEnabled!==undefined&&n.docsAutoUploadEnabled!==null&&(i.docsAutoUploadEnabled=Boolean(n.docsAutoUploadEnabled)),n.docsAutoUploadDelay!==undefined&&n.docsAutoUploadDelay!==null&&(i.docsAutoUploadDelay=n.docsAutoUploadDelay|0),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.enableMaps=!1,i.docsAutoDownloadEnabled=!1,i.docsAutoDownloadInterval=0,i.docsAutoUploadEnabled=!1,i.docsAutoUploadDelay=0),n.enableMaps!==undefined&&n.enableMaps!==null&&n.hasOwnProperty("enableMaps")&&(i.enableMaps=n.enableMaps),n.docsAutoDownloadEnabled!==undefined&&n.docsAutoDownloadEnabled!==null&&n.hasOwnProperty("docsAutoDownloadEnabled")&&(i.docsAutoDownloadEnabled=n.docsAutoDownloadEnabled),n.docsAutoDownloadInterval!==undefined&&n.docsAutoDownloadInterval!==null&&n.hasOwnProperty("docsAutoDownloadInterval")&&(i.docsAutoDownloadInterval=n.docsAutoDownloadInterval),n.docsAutoUploadEnabled!==undefined&&n.docsAutoUploadEnabled!==null&&n.hasOwnProperty("docsAutoUploadEnabled")&&(i.docsAutoUploadEnabled=n.docsAutoUploadEnabled),n.docsAutoUploadDelay!==undefined&&n.docsAutoUploadDelay!==null&&n.hasOwnProperty("docsAutoUploadDelay")&&(i.docsAutoUploadDelay=n.docsAutoUploadDelay),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f}(),f.FetchingOptionsProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.maxRequestsPerQuery=1,u.prototype.forceMaxRequestsPerQuery=!1,u.prototype.sortBatches=!1,u.prototype.maxDrawable=2,u.prototype.maxImagery=2,u.prototype.maxTerrain=5,u.prototype.maxQuadtree=5,u.prototype.maxDioramaMetadata=1,u.prototype.maxDioramaData=0,u.prototype.maxConsumerFetchRatio=1,u.prototype.maxProEcFetchRatio=0,u.prototype.safeOverallQps=0,u.prototype.safeImageryQps=0,u.prototype.domainsForHttps="google.com gstatic.com",u.prototype.hostsForHttp="",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.FetchingOptionsProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.maxRequestsPerQuery=n.int32();break;case 12:u.forceMaxRequestsPerQuery=n.bool();break;case 13:u.sortBatches=n.bool();break;case 2:u.maxDrawable=n.int32();break;case 3:u.maxImagery=n.int32();break;case 4:u.maxTerrain=n.int32();break;case 5:u.maxQuadtree=n.int32();break;case 6:u.maxDioramaMetadata=n.int32();break;case 7:u.maxDioramaData=n.int32();break;case 8:u.maxConsumerFetchRatio=n.float();break;case 9:u.maxProEcFetchRatio=n.float();break;case 10:u.safeOverallQps=n.float();break;case 11:u.safeImageryQps=n.float();break;case 14:u.domainsForHttps=n.string();break;case 15:u.hostsForHttp=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.maxRequestsPerQuery!==undefined&&!i.isInteger(n.maxRequestsPerQuery)?"maxRequestsPerQuery: integer expected":n.forceMaxRequestsPerQuery!==undefined&&typeof n.forceMaxRequestsPerQuery!="boolean"?"forceMaxRequestsPerQuery: boolean expected":n.sortBatches!==undefined&&typeof n.sortBatches!="boolean"?"sortBatches: boolean expected":n.maxDrawable!==undefined&&!i.isInteger(n.maxDrawable)?"maxDrawable: integer expected":n.maxImagery!==undefined&&!i.isInteger(n.maxImagery)?"maxImagery: integer expected":n.maxTerrain!==undefined&&!i.isInteger(n.maxTerrain)?"maxTerrain: integer expected":n.maxQuadtree!==undefined&&!i.isInteger(n.maxQuadtree)?"maxQuadtree: integer expected":n.maxDioramaMetadata!==undefined&&!i.isInteger(n.maxDioramaMetadata)?"maxDioramaMetadata: integer expected":n.maxDioramaData!==undefined&&!i.isInteger(n.maxDioramaData)?"maxDioramaData: integer expected":n.maxConsumerFetchRatio!==undefined&&typeof n.maxConsumerFetchRatio!="number"?"maxConsumerFetchRatio: number expected":n.maxProEcFetchRatio!==undefined&&typeof n.maxProEcFetchRatio!="number"?"maxProEcFetchRatio: number expected":n.safeOverallQps!==undefined&&typeof n.safeOverallQps!="number"?"safeOverallQps: number expected":n.safeImageryQps!==undefined&&typeof n.safeImageryQps!="number"?"safeImageryQps: number expected":n.domainsForHttps!==undefined&&!i.isString(n.domainsForHttps)?"domainsForHttps: string expected":n.hostsForHttp!==undefined&&!i.isString(n.hostsForHttp)?"hostsForHttp: string expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.FetchingOptionsProto)return n;var i=new t.keyhole.dbroot.FetchingOptionsProto;return n.maxRequestsPerQuery!==undefined&&n.maxRequestsPerQuery!==null&&(i.maxRequestsPerQuery=n.maxRequestsPerQuery|0),n.forceMaxRequestsPerQuery!==undefined&&n.forceMaxRequestsPerQuery!==null&&(i.forceMaxRequestsPerQuery=Boolean(n.forceMaxRequestsPerQuery)),n.sortBatches!==undefined&&n.sortBatches!==null&&(i.sortBatches=Boolean(n.sortBatches)),n.maxDrawable!==undefined&&n.maxDrawable!==null&&(i.maxDrawable=n.maxDrawable|0),n.maxImagery!==undefined&&n.maxImagery!==null&&(i.maxImagery=n.maxImagery|0),n.maxTerrain!==undefined&&n.maxTerrain!==null&&(i.maxTerrain=n.maxTerrain|0),n.maxQuadtree!==undefined&&n.maxQuadtree!==null&&(i.maxQuadtree=n.maxQuadtree|0),n.maxDioramaMetadata!==undefined&&n.maxDioramaMetadata!==null&&(i.maxDioramaMetadata=n.maxDioramaMetadata|0),n.maxDioramaData!==undefined&&n.maxDioramaData!==null&&(i.maxDioramaData=n.maxDioramaData|0),n.maxConsumerFetchRatio!==undefined&&n.maxConsumerFetchRatio!==null&&(i.maxConsumerFetchRatio=Number(n.maxConsumerFetchRatio)),n.maxProEcFetchRatio!==undefined&&n.maxProEcFetchRatio!==null&&(i.maxProEcFetchRatio=Number(n.maxProEcFetchRatio)),n.safeOverallQps!==undefined&&n.safeOverallQps!==null&&(i.safeOverallQps=Number(n.safeOverallQps)),n.safeImageryQps!==undefined&&n.safeImageryQps!==null&&(i.safeImageryQps=Number(n.safeImageryQps)),n.domainsForHttps!==undefined&&n.domainsForHttps!==null&&(i.domainsForHttps=String(n.domainsForHttps)),n.hostsForHttp!==undefined&&n.hostsForHttp!==null&&(i.hostsForHttp=String(n.hostsForHttp)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.maxRequestsPerQuery=1,i.forceMaxRequestsPerQuery=!1,i.sortBatches=!1,i.maxDrawable=2,i.maxImagery=2,i.maxTerrain=5,i.maxQuadtree=5,i.maxDioramaMetadata=1,i.maxDioramaData=0,i.maxConsumerFetchRatio=1,i.maxProEcFetchRatio=0,i.safeOverallQps=0,i.safeImageryQps=0,i.domainsForHttps="google.com gstatic.com",i.hostsForHttp=""),n.maxRequestsPerQuery!==undefined&&n.maxRequestsPerQuery!==null&&n.hasOwnProperty("maxRequestsPerQuery")&&(i.maxRequestsPerQuery=n.maxRequestsPerQuery),n.forceMaxRequestsPerQuery!==undefined&&n.forceMaxRequestsPerQuery!==null&&n.hasOwnProperty("forceMaxRequestsPerQuery")&&(i.forceMaxRequestsPerQuery=n.forceMaxRequestsPerQuery),n.sortBatches!==undefined&&n.sortBatches!==null&&n.hasOwnProperty("sortBatches")&&(i.sortBatches=n.sortBatches),n.maxDrawable!==undefined&&n.maxDrawable!==null&&n.hasOwnProperty("maxDrawable")&&(i.maxDrawable=n.maxDrawable),n.maxImagery!==undefined&&n.maxImagery!==null&&n.hasOwnProperty("maxImagery")&&(i.maxImagery=n.maxImagery),n.maxTerrain!==undefined&&n.maxTerrain!==null&&n.hasOwnProperty("maxTerrain")&&(i.maxTerrain=n.maxTerrain),n.maxQuadtree!==undefined&&n.maxQuadtree!==null&&n.hasOwnProperty("maxQuadtree")&&(i.maxQuadtree=n.maxQuadtree),n.maxDioramaMetadata!==undefined&&n.maxDioramaMetadata!==null&&n.hasOwnProperty("maxDioramaMetadata")&&(i.maxDioramaMetadata=n.maxDioramaMetadata),n.maxDioramaData!==undefined&&n.maxDioramaData!==null&&n.hasOwnProperty("maxDioramaData")&&(i.maxDioramaData=n.maxDioramaData),n.maxConsumerFetchRatio!==undefined&&n.maxConsumerFetchRatio!==null&&n.hasOwnProperty("maxConsumerFetchRatio")&&(i.maxConsumerFetchRatio=n.maxConsumerFetchRatio),n.maxProEcFetchRatio!==undefined&&n.maxProEcFetchRatio!==null&&n.hasOwnProperty("maxProEcFetchRatio")&&(i.maxProEcFetchRatio=n.maxProEcFetchRatio),n.safeOverallQps!==undefined&&n.safeOverallQps!==null&&n.hasOwnProperty("safeOverallQps")&&(i.safeOverallQps=n.safeOverallQps),n.safeImageryQps!==undefined&&n.safeImageryQps!==null&&n.hasOwnProperty("safeImageryQps")&&(i.safeImageryQps=n.safeImageryQps),n.domainsForHttps!==undefined&&n.domainsForHttps!==null&&n.hasOwnProperty("domainsForHttps")&&(i.domainsForHttps=n.domainsForHttps),n.hostsForHttp!==undefined&&n.hostsForHttp!==null&&n.hasOwnProperty("hostsForHttp")&&(i.hostsForHttp=n.hostsForHttp),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.TimeMachineOptionsProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.serverUrl="",u.prototype.isTimemachine=!1,u.prototype.dwellTimeMs=500,u.prototype.discoverabilityAltitudeMeters=15e3,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.TimeMachineOptionsProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.serverUrl=n.string();break;case 2:u.isTimemachine=n.bool();break;case 3:u.dwellTimeMs=n.int32();break;case 4:u.discoverabilityAltitudeMeters=n.int32();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.serverUrl!==undefined&&!i.isString(n.serverUrl)?"serverUrl: string expected":n.isTimemachine!==undefined&&typeof n.isTimemachine!="boolean"?"isTimemachine: boolean expected":n.dwellTimeMs!==undefined&&!i.isInteger(n.dwellTimeMs)?"dwellTimeMs: integer expected":n.discoverabilityAltitudeMeters!==undefined&&!i.isInteger(n.discoverabilityAltitudeMeters)?"discoverabilityAltitudeMeters: integer expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.TimeMachineOptionsProto)return n;var i=new t.keyhole.dbroot.TimeMachineOptionsProto;return n.serverUrl!==undefined&&n.serverUrl!==null&&(i.serverUrl=String(n.serverUrl)),n.isTimemachine!==undefined&&n.isTimemachine!==null&&(i.isTimemachine=Boolean(n.isTimemachine)),n.dwellTimeMs!==undefined&&n.dwellTimeMs!==null&&(i.dwellTimeMs=n.dwellTimeMs|0),n.discoverabilityAltitudeMeters!==undefined&&n.discoverabilityAltitudeMeters!==null&&(i.discoverabilityAltitudeMeters=n.discoverabilityAltitudeMeters|0),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.serverUrl="",i.isTimemachine=!1,i.dwellTimeMs=500,i.discoverabilityAltitudeMeters=15e3),n.serverUrl!==undefined&&n.serverUrl!==null&&n.hasOwnProperty("serverUrl")&&(i.serverUrl=n.serverUrl),n.isTimemachine!==undefined&&n.isTimemachine!==null&&n.hasOwnProperty("isTimemachine")&&(i.isTimemachine=n.isTimemachine),n.dwellTimeMs!==undefined&&n.dwellTimeMs!==null&&n.hasOwnProperty("dwellTimeMs")&&(i.dwellTimeMs=n.dwellTimeMs),n.discoverabilityAltitudeMeters!==undefined&&n.discoverabilityAltitudeMeters!==null&&n.hasOwnProperty("discoverabilityAltitudeMeters")&&(i.discoverabilityAltitudeMeters=n.discoverabilityAltitudeMeters),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.AutopiaOptionsProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.metadataServerUrl="http://cbk0.google.com/cbk",u.prototype.depthmapServerUrl="http://cbk0.google.com/cbk",u.prototype.coverageOverlayUrl="",u.prototype.maxImageryQps=0,u.prototype.maxMetadataDepthmapQps=0,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.AutopiaOptionsProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.metadataServerUrl=n.string();break;case 2:u.depthmapServerUrl=n.string();break;case 3:u.coverageOverlayUrl=n.string();break;case 4:u.maxImageryQps=n.float();break;case 5:u.maxMetadataDepthmapQps=n.float();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.metadataServerUrl!==undefined&&!i.isString(n.metadataServerUrl)?"metadataServerUrl: string expected":n.depthmapServerUrl!==undefined&&!i.isString(n.depthmapServerUrl)?"depthmapServerUrl: string expected":n.coverageOverlayUrl!==undefined&&!i.isString(n.coverageOverlayUrl)?"coverageOverlayUrl: string expected":n.maxImageryQps!==undefined&&typeof n.maxImageryQps!="number"?"maxImageryQps: number expected":n.maxMetadataDepthmapQps!==undefined&&typeof n.maxMetadataDepthmapQps!="number"?"maxMetadataDepthmapQps: number expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.AutopiaOptionsProto)return n;var i=new t.keyhole.dbroot.AutopiaOptionsProto;return n.metadataServerUrl!==undefined&&n.metadataServerUrl!==null&&(i.metadataServerUrl=String(n.metadataServerUrl)),n.depthmapServerUrl!==undefined&&n.depthmapServerUrl!==null&&(i.depthmapServerUrl=String(n.depthmapServerUrl)),n.coverageOverlayUrl!==undefined&&n.coverageOverlayUrl!==null&&(i.coverageOverlayUrl=String(n.coverageOverlayUrl)),n.maxImageryQps!==undefined&&n.maxImageryQps!==null&&(i.maxImageryQps=Number(n.maxImageryQps)),n.maxMetadataDepthmapQps!==undefined&&n.maxMetadataDepthmapQps!==null&&(i.maxMetadataDepthmapQps=Number(n.maxMetadataDepthmapQps)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.metadataServerUrl="http://cbk0.google.com/cbk",i.depthmapServerUrl="http://cbk0.google.com/cbk",i.coverageOverlayUrl="",i.maxImageryQps=0,i.maxMetadataDepthmapQps=0),n.metadataServerUrl!==undefined&&n.metadataServerUrl!==null&&n.hasOwnProperty("metadataServerUrl")&&(i.metadataServerUrl=n.metadataServerUrl),n.depthmapServerUrl!==undefined&&n.depthmapServerUrl!==null&&n.hasOwnProperty("depthmapServerUrl")&&(i.depthmapServerUrl=n.depthmapServerUrl),n.coverageOverlayUrl!==undefined&&n.coverageOverlayUrl!==null&&n.hasOwnProperty("coverageOverlayUrl")&&(i.coverageOverlayUrl=n.coverageOverlayUrl),n.maxImageryQps!==undefined&&n.maxImageryQps!==null&&n.hasOwnProperty("maxImageryQps")&&(i.maxImageryQps=n.maxImageryQps),n.maxMetadataDepthmapQps!==undefined&&n.maxMetadataDepthmapQps!==null&&n.hasOwnProperty("maxMetadataDepthmapQps")&&(i.maxMetadataDepthmapQps=n.maxMetadataDepthmapQps),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.CSIOptionsProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.samplingPercentage=0,u.prototype.experimentId="",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.CSIOptionsProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.samplingPercentage=n.int32();break;case 2:u.experimentId=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.samplingPercentage!==undefined&&!i.isInteger(n.samplingPercentage)?"samplingPercentage: integer expected":n.experimentId!==undefined&&!i.isString(n.experimentId)?"experimentId: string expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.CSIOptionsProto)return n;var i=new t.keyhole.dbroot.CSIOptionsProto;return n.samplingPercentage!==undefined&&n.samplingPercentage!==null&&(i.samplingPercentage=n.samplingPercentage|0),n.experimentId!==undefined&&n.experimentId!==null&&(i.experimentId=String(n.experimentId)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.samplingPercentage=0,i.experimentId=""),n.samplingPercentage!==undefined&&n.samplingPercentage!==null&&n.hasOwnProperty("samplingPercentage")&&(i.samplingPercentage=n.samplingPercentage),n.experimentId!==undefined&&n.experimentId!==null&&n.hasOwnProperty("experimentId")&&(i.experimentId=n.experimentId),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.SearchTabProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.isVisible=!1;f.prototype.tabLabel=null;f.prototype.baseUrl="";f.prototype.viewportPrefix="";f.prototype.inputBox=i.emptyArray;f.prototype.requirement=null;var e={1:"keyhole.dbroot.StringIdOrValueProto",4:"keyhole.dbroot.SearchTabProto.InputBoxInfo",5:"keyhole.dbroot.RequirementProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.SearchTabProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.isVisible=n.bool();break;case 2:u.tabLabel=e[1].decode(n,n.uint32());break;case 3:u.baseUrl=n.string();break;case 4:u.viewportPrefix=n.string();break;case 5:u.inputBox&&u.inputBox.length||(u.inputBox=[]);u.inputBox.push(e[4].decode(n,n.uint32()));break;case 6:u.requirement=e[5].decode(n,n.uint32());break;default:n.skipType(f&7)}}return u},f.verify=function(n){var r,t;if(typeof n!="object"||n===null)return"object expected";if(typeof n.isVisible!="boolean")return"isVisible: boolean expected";if(n.tabLabel!==undefined&&n.tabLabel!==null&&(t=e[1].verify(n.tabLabel),t))return"tabLabel."+t;if(n.baseUrl!==undefined&&!i.isString(n.baseUrl))return"baseUrl: string expected";if(n.viewportPrefix!==undefined&&!i.isString(n.viewportPrefix))return"viewportPrefix: string expected";if(n.inputBox!==undefined){if(!Array.isArray(n.inputBox))return"inputBox: array expected";for(r=0;r<n.inputBox.length;++r)if(t=e[4].verify(n.inputBox[r]),t)return"inputBox."+t}return n.requirement!==undefined&&n.requirement!==null&&(t=e[5].verify(n.requirement),t)?"requirement."+t:null},f.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.SearchTabProto)return n;if(i=new t.keyhole.dbroot.SearchTabProto,n.isVisible!==undefined&&n.isVisible!==null&&(i.isVisible=Boolean(n.isVisible)),n.tabLabel!==undefined&&n.tabLabel!==null){if(typeof n.tabLabel!="object")throw TypeError(".keyhole.dbroot.SearchTabProto.tabLabel: object expected");i.tabLabel=e[1].fromObject(n.tabLabel)}if(n.baseUrl!==undefined&&n.baseUrl!==null&&(i.baseUrl=String(n.baseUrl)),n.viewportPrefix!==undefined&&n.viewportPrefix!==null&&(i.viewportPrefix=String(n.viewportPrefix)),n.inputBox){if(!Array.isArray(n.inputBox))throw TypeError(".keyhole.dbroot.SearchTabProto.inputBox: array expected");for(i.inputBox=[],r=0;r<n.inputBox.length;++r){if(typeof n.inputBox[r]!="object")throw TypeError(".keyhole.dbroot.SearchTabProto.inputBox: object expected");i.inputBox[r]=e[4].fromObject(n.inputBox[r])}}if(n.requirement!==undefined&&n.requirement!==null){if(typeof n.requirement!="object")throw TypeError(".keyhole.dbroot.SearchTabProto.requirement: object expected");i.requirement=e[5].fromObject(n.requirement)}return i},f.from=f.fromObject,f.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.inputBox=[]),t.defaults&&(i.isVisible=!1,i.tabLabel=null,i.baseUrl="",i.viewportPrefix="",i.requirement=null),n.isVisible!==undefined&&n.isVisible!==null&&n.hasOwnProperty("isVisible")&&(i.isVisible=n.isVisible),n.tabLabel!==undefined&&n.tabLabel!==null&&n.hasOwnProperty("tabLabel")&&(i.tabLabel=e[1].toObject(n.tabLabel,t)),n.baseUrl!==undefined&&n.baseUrl!==null&&n.hasOwnProperty("baseUrl")&&(i.baseUrl=n.baseUrl),n.viewportPrefix!==undefined&&n.viewportPrefix!==null&&n.hasOwnProperty("viewportPrefix")&&(i.viewportPrefix=n.viewportPrefix),n.inputBox!==undefined&&n.inputBox!==null&&n.hasOwnProperty("inputBox"))for(i.inputBox=[],r=0;r<n.inputBox.length;++r)i.inputBox[r]=e[4].toObject(n.inputBox[r],t);return n.requirement!==undefined&&n.requirement!==null&&n.hasOwnProperty("requirement")&&(i.requirement=e[5].toObject(n.requirement,t)),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.InputBoxInfo=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.label=null;f.prototype.queryVerb="";f.prototype.queryPrepend="";var e={0:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.SearchTabProto.InputBoxInfo;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.label=e[0].decode(n,n.uint32());break;case 2:u.queryVerb=n.string();break;case 3:u.queryPrepend=n.string();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";var t=e[0].verify(n.label);return t?"label."+t:i.isString(n.queryVerb)?n.queryPrepend!==undefined&&!i.isString(n.queryPrepend)?"queryPrepend: string expected":null:"queryVerb: string expected"},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.SearchTabProto.InputBoxInfo)return n;var i=new t.keyhole.dbroot.SearchTabProto.InputBoxInfo;if(n.label!==undefined&&n.label!==null){if(typeof n.label!="object")throw TypeError(".keyhole.dbroot.SearchTabProto.InputBoxInfo.label: object expected");i.label=e[0].fromObject(n.label)}return n.queryVerb!==undefined&&n.queryVerb!==null&&(i.queryVerb=String(n.queryVerb)),n.queryPrepend!==undefined&&n.queryPrepend!==null&&(i.queryPrepend=String(n.queryPrepend)),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.label=null,i.queryVerb="",i.queryPrepend=""),n.label!==undefined&&n.label!==null&&n.hasOwnProperty("label")&&(i.label=e[0].toObject(n.label,t)),n.queryVerb!==undefined&&n.queryVerb!==null&&n.hasOwnProperty("queryVerb")&&(i.queryVerb=n.queryVerb),n.queryPrepend!==undefined&&n.queryPrepend!==null&&n.hasOwnProperty("queryPrepend")&&(i.queryPrepend=n.queryPrepend),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f}(),f.CobrandProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.logoUrl="";f.prototype.xCoord=null;f.prototype.yCoord=null;f.prototype.tiePoint=6;f.prototype.screenSize=0;var e={1:"keyhole.dbroot.CobrandProto.Coord",2:"keyhole.dbroot.CobrandProto.Coord",3:"keyhole.dbroot.CobrandProto.TiePoint"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.CobrandProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.logoUrl=n.string();break;case 2:u.xCoord=e[1].decode(n,n.uint32());break;case 3:u.yCoord=e[2].decode(n,n.uint32());break;case 4:u.tiePoint=n.uint32();break;case 5:u.screenSize=n.double();break;default:n.skipType(f&7)}}return u},f.verify=function(n){var t;if(typeof n!="object"||n===null)return"object expected";if(!i.isString(n.logoUrl))return"logoUrl: string expected";if(n.xCoord!==undefined&&n.xCoord!==null&&(t=e[1].verify(n.xCoord),t))return"xCoord."+t;if(n.yCoord!==undefined&&n.yCoord!==null&&(t=e[2].verify(n.yCoord),t))return"yCoord."+t;if(n.tiePoint!==undefined)switch(n.tiePoint){default:return"tiePoint: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:}return n.screenSize!==undefined&&typeof n.screenSize!="number"?"screenSize: number expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.CobrandProto)return n;var i=new t.keyhole.dbroot.CobrandProto;if(n.logoUrl!==undefined&&n.logoUrl!==null&&(i.logoUrl=String(n.logoUrl)),n.xCoord!==undefined&&n.xCoord!==null){if(typeof n.xCoord!="object")throw TypeError(".keyhole.dbroot.CobrandProto.xCoord: object expected");i.xCoord=e[1].fromObject(n.xCoord)}if(n.yCoord!==undefined&&n.yCoord!==null){if(typeof n.yCoord!="object")throw TypeError(".keyhole.dbroot.CobrandProto.yCoord: object expected");i.yCoord=e[2].fromObject(n.yCoord)}switch(n.tiePoint){case"TOP_LEFT":case 0:i.tiePoint=0;break;case"TOP_CENTER":case 1:i.tiePoint=1;break;case"TOP_RIGHT":case 2:i.tiePoint=2;break;case"MID_LEFT":case 3:i.tiePoint=3;break;case"MID_CENTER":case 4:i.tiePoint=4;break;case"MID_RIGHT":case 5:i.tiePoint=5;break;case"BOTTOM_LEFT":case 6:i.tiePoint=6;break;case"BOTTOM_CENTER":case 7:i.tiePoint=7;break;case"BOTTOM_RIGHT":case 8:i.tiePoint=8}return n.screenSize!==undefined&&n.screenSize!==null&&(i.screenSize=Number(n.screenSize)),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.logoUrl="",i.xCoord=null,i.yCoord=null,i.tiePoint=t.enums===String?"BOTTOM_LEFT":6,i.screenSize=0),n.logoUrl!==undefined&&n.logoUrl!==null&&n.hasOwnProperty("logoUrl")&&(i.logoUrl=n.logoUrl),n.xCoord!==undefined&&n.xCoord!==null&&n.hasOwnProperty("xCoord")&&(i.xCoord=e[1].toObject(n.xCoord,t)),n.yCoord!==undefined&&n.yCoord!==null&&n.hasOwnProperty("yCoord")&&(i.yCoord=e[2].toObject(n.yCoord,t)),n.tiePoint!==undefined&&n.tiePoint!==null&&n.hasOwnProperty("tiePoint")&&(i.tiePoint=t.enums===String?e[3][n.tiePoint]:n.tiePoint),n.screenSize!==undefined&&n.screenSize!==null&&n.hasOwnProperty("screenSize")&&(i.screenSize=n.screenSize),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.Coord=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return i.prototype.value=0,i.prototype.isRelative=!1,i.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.CobrandProto.Coord;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.value=n.double();break;case 2:u.isRelative=n.bool();break;default:n.skipType(f&7)}}return u},i.verify=function(n){return typeof n!="object"||n===null?"object expected":typeof n.value!="number"?"value: number expected":n.isRelative!==undefined&&typeof n.isRelative!="boolean"?"isRelative: boolean expected":null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.CobrandProto.Coord)return n;var i=new t.keyhole.dbroot.CobrandProto.Coord;return n.value!==undefined&&n.value!==null&&(i.value=Number(n.value)),n.isRelative!==undefined&&n.isRelative!==null&&(i.isRelative=Boolean(n.isRelative)),i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.value=0,i.isRelative=!1),n.value!==undefined&&n.value!==null&&n.hasOwnProperty("value")&&(i.value=n.value),n.isRelative!==undefined&&n.isRelative!==null&&n.hasOwnProperty("isRelative")&&(i.isRelative=n.isRelative),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),f.TiePoint=function(){var n=Object.create({});return n.TOP_LEFT=0,n.TOP_CENTER=1,n.TOP_RIGHT=2,n.MID_LEFT=3,n.MID_CENTER=4,n.MID_RIGHT=5,n.BOTTOM_LEFT=6,n.BOTTOM_CENTER=7,n.BOTTOM_RIGHT=8,n}(),f}(),f.DatabaseDescriptionProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.databaseName=null;f.prototype.databaseUrl="";var e={0:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.DatabaseDescriptionProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.databaseName=e[0].decode(n,n.uint32());break;case 2:u.databaseUrl=n.string();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(n.databaseName!==undefined&&n.databaseName!==null){var t=e[0].verify(n.databaseName);if(t)return"databaseName."+t}return i.isString(n.databaseUrl)?null:"databaseUrl: string expected"},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.DatabaseDescriptionProto)return n;var i=new t.keyhole.dbroot.DatabaseDescriptionProto;if(n.databaseName!==undefined&&n.databaseName!==null){if(typeof n.databaseName!="object")throw TypeError(".keyhole.dbroot.DatabaseDescriptionProto.databaseName: object expected");i.databaseName=e[0].fromObject(n.databaseName)}return n.databaseUrl!==undefined&&n.databaseUrl!==null&&(i.databaseUrl=String(n.databaseUrl)),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.databaseName=null,i.databaseUrl=""),n.databaseName!==undefined&&n.databaseName!==null&&n.hasOwnProperty("databaseName")&&(i.databaseName=e[0].toObject(n.databaseName,t)),n.databaseUrl!==undefined&&n.databaseUrl!==null&&n.hasOwnProperty("databaseUrl")&&(i.databaseUrl=n.databaseUrl),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.ConfigScriptProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.scriptName="",u.prototype.scriptData="",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.ConfigScriptProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.scriptName=n.string();break;case 2:u.scriptData=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":i.isString(n.scriptName)?i.isString(n.scriptData)?null:"scriptData: string expected":"scriptName: string expected"},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.ConfigScriptProto)return n;var i=new t.keyhole.dbroot.ConfigScriptProto;return n.scriptName!==undefined&&n.scriptName!==null&&(i.scriptName=String(n.scriptName)),n.scriptData!==undefined&&n.scriptData!==null&&(i.scriptData=String(n.scriptData)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.scriptName="",i.scriptData=""),n.scriptName!==undefined&&n.scriptName!==null&&n.hasOwnProperty("scriptName")&&(i.scriptName=n.scriptName),n.scriptData!==undefined&&n.scriptData!==null&&n.hasOwnProperty("scriptData")&&(i.scriptData=n.scriptData),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.SwoopParamsProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return i.prototype.startDistInMeters=0,i.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.SwoopParamsProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.startDistInMeters=n.double();break;default:n.skipType(f&7)}}return u},i.verify=function(n){return typeof n!="object"||n===null?"object expected":n.startDistInMeters!==undefined&&typeof n.startDistInMeters!="number"?"startDistInMeters: number expected":null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.SwoopParamsProto)return n;var i=new t.keyhole.dbroot.SwoopParamsProto;return n.startDistInMeters!==undefined&&n.startDistInMeters!==null&&(i.startDistInMeters=Number(n.startDistInMeters)),i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.startDistInMeters=0),n.startDistInMeters!==undefined&&n.startDistInMeters!==null&&n.hasOwnProperty("startDistInMeters")&&(i.startDistInMeters=n.startDistInMeters),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),f.PostingServerProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.name=null;f.prototype.baseUrl=null;f.prototype.postWizardPath=null;f.prototype.fileSubmitPath=null;var i={0:"keyhole.dbroot.StringIdOrValueProto",1:"keyhole.dbroot.StringIdOrValueProto",2:"keyhole.dbroot.StringIdOrValueProto",3:"keyhole.dbroot.StringIdOrValueProto"};return u.push(i),f.decode=function(n,u){var o,f,e;for(n instanceof r||(n=r.create(n)),o=u===undefined?n.len:n.pos+u,f=new t.keyhole.dbroot.PostingServerProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:f.name=i[0].decode(n,n.uint32());break;case 2:f.baseUrl=i[1].decode(n,n.uint32());break;case 3:f.postWizardPath=i[2].decode(n,n.uint32());break;case 4:f.fileSubmitPath=i[3].decode(n,n.uint32());break;default:n.skipType(e&7)}}return f},f.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":n.name!==undefined&&n.name!==null&&(t=i[0].verify(n.name),t)?"name."+t:n.baseUrl!==undefined&&n.baseUrl!==null&&(t=i[1].verify(n.baseUrl),t)?"baseUrl."+t:n.postWizardPath!==undefined&&n.postWizardPath!==null&&(t=i[2].verify(n.postWizardPath),t)?"postWizardPath."+t:n.fileSubmitPath!==undefined&&n.fileSubmitPath!==null&&(t=i[3].verify(n.fileSubmitPath),t)?"fileSubmitPath."+t:null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.PostingServerProto)return n;var r=new t.keyhole.dbroot.PostingServerProto;if(n.name!==undefined&&n.name!==null){if(typeof n.name!="object")throw TypeError(".keyhole.dbroot.PostingServerProto.name: object expected");r.name=i[0].fromObject(n.name)}if(n.baseUrl!==undefined&&n.baseUrl!==null){if(typeof n.baseUrl!="object")throw TypeError(".keyhole.dbroot.PostingServerProto.baseUrl: object expected");r.baseUrl=i[1].fromObject(n.baseUrl)}if(n.postWizardPath!==undefined&&n.postWizardPath!==null){if(typeof n.postWizardPath!="object")throw TypeError(".keyhole.dbroot.PostingServerProto.postWizardPath: object expected");r.postWizardPath=i[2].fromObject(n.postWizardPath)}if(n.fileSubmitPath!==undefined&&n.fileSubmitPath!==null){if(typeof n.fileSubmitPath!="object")throw TypeError(".keyhole.dbroot.PostingServerProto.fileSubmitPath: object expected");r.fileSubmitPath=i[3].fromObject(n.fileSubmitPath)}return r},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var r={};return t.defaults&&(r.name=null,r.baseUrl=null,r.postWizardPath=null,r.fileSubmitPath=null),n.name!==undefined&&n.name!==null&&n.hasOwnProperty("name")&&(r.name=i[0].toObject(n.name,t)),n.baseUrl!==undefined&&n.baseUrl!==null&&n.hasOwnProperty("baseUrl")&&(r.baseUrl=i[1].toObject(n.baseUrl,t)),n.postWizardPath!==undefined&&n.postWizardPath!==null&&n.hasOwnProperty("postWizardPath")&&(r.postWizardPath=i[2].toObject(n.postWizardPath,t)),n.fileSubmitPath!==undefined&&n.fileSubmitPath!==null&&n.hasOwnProperty("fileSubmitPath")&&(r.fileSubmitPath=i[3].toObject(n.fileSubmitPath,t)),r},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.PlanetaryDatabaseProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}i.prototype.url=null;i.prototype.name=null;var f={0:"keyhole.dbroot.StringIdOrValueProto",1:"keyhole.dbroot.StringIdOrValueProto"};return u.push(f),i.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.PlanetaryDatabaseProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.url=f[0].decode(n,n.uint32());break;case 2:u.name=f[1].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},i.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":(t=f[0].verify(n.url),t)?"url."+t:(t=f[1].verify(n.name),t)?"name."+t:null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.PlanetaryDatabaseProto)return n;var i=new t.keyhole.dbroot.PlanetaryDatabaseProto;if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.PlanetaryDatabaseProto.url: object expected");i.url=f[0].fromObject(n.url)}if(n.name!==undefined&&n.name!==null){if(typeof n.name!="object")throw TypeError(".keyhole.dbroot.PlanetaryDatabaseProto.name: object expected");i.name=f[1].fromObject(n.name)}return i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.url=null,i.name=null),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=f[0].toObject(n.url,t)),n.name!==undefined&&n.name!==null&&n.hasOwnProperty("name")&&(i.name=f[1].toObject(n.name,t)),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),f.LogServerProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.url=null;f.prototype.enable=!1;f.prototype.throttlingFactor=1;var e={0:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.LogServerProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.url=e[0].decode(n,n.uint32());break;case 2:u.enable=n.bool();break;case 3:u.throttlingFactor=n.int32();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(n.url!==undefined&&n.url!==null){var t=e[0].verify(n.url);if(t)return"url."+t}return n.enable!==undefined&&typeof n.enable!="boolean"?"enable: boolean expected":n.throttlingFactor!==undefined&&!i.isInteger(n.throttlingFactor)?"throttlingFactor: integer expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.LogServerProto)return n;var i=new t.keyhole.dbroot.LogServerProto;if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.LogServerProto.url: object expected");i.url=e[0].fromObject(n.url)}return n.enable!==undefined&&n.enable!==null&&(i.enable=Boolean(n.enable)),n.throttlingFactor!==undefined&&n.throttlingFactor!==null&&(i.throttlingFactor=n.throttlingFactor|0),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.url=null,i.enable=!1,i.throttlingFactor=1),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=e[0].toObject(n.url,t)),n.enable!==undefined&&n.enable!==null&&n.hasOwnProperty("enable")&&(i.enable=n.enable),n.throttlingFactor!==undefined&&n.throttlingFactor!==null&&n.hasOwnProperty("throttlingFactor")&&(i.throttlingFactor=n.throttlingFactor),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.EndSnippetProto=function(){function e(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}e.prototype.model=null;e.prototype.authServerUrl=null;e.prototype.disableAuthentication=!1;e.prototype.mfeDomains=i.emptyArray;e.prototype.mfeLangParam="hl=$5Bhl5D";e.prototype.adsUrlPatterns="";e.prototype.reverseGeocoderUrl=null;e.prototype.reverseGeocoderProtocolVersion=3;e.prototype.skyDatabaseIsAvailable=!0;e.prototype.skyDatabaseUrl=null;e.prototype.defaultWebPageIntlUrl=null;e.prototype.numStartUpTips=17;e.prototype.startUpTipsUrl=null;e.prototype.numProStartUpTips=0;e.prototype.proStartUpTipsUrl=null;e.prototype.startupTipsIntlUrl=null;e.prototype.userGuideIntlUrl=null;e.prototype.supportCenterIntlUrl=null;e.prototype.businessListingIntlUrl=null;e.prototype.supportAnswerIntlUrl=null;e.prototype.supportTopicIntlUrl=null;e.prototype.supportRequestIntlUrl=null;e.prototype.earthIntlUrl=null;e.prototype.addContentUrl=null;e.prototype.sketchupNotInstalledUrl=null;e.prototype.sketchupErrorUrl=null;e.prototype.freeLicenseUrl=null;e.prototype.proLicenseUrl=null;e.prototype.tutorialUrl=null;e.prototype.keyboardShortcutsUrl=null;e.prototype.releaseNotesUrl=null;e.prototype.hideUserData=!1;e.prototype.useGeLogo=!0;e.prototype.dioramaDescriptionUrlBase=null;e.prototype.dioramaDefaultColor=4291281607;e.prototype.dioramaBlacklistUrl=null;e.prototype.clientOptions=null;e.prototype.fetchingOptions=null;e.prototype.timeMachineOptions=null;e.prototype.csiOptions=null;e.prototype.searchTab=i.emptyArray;e.prototype.cobrandInfo=i.emptyArray;e.prototype.validDatabase=i.emptyArray;e.prototype.configScript=i.emptyArray;e.prototype.deauthServerUrl=null;e.prototype.swoopParameters=null;e.prototype.bbsServerInfo=null;e.prototype.dataErrorServerInfo=null;e.prototype.planetaryDatabase=i.emptyArray;e.prototype.logServer=null;e.prototype.autopiaOptions=null;e.prototype.searchConfig=null;e.prototype.searchInfo=null;e.prototype.elevationServiceBaseUrl="http://maps.google.com/maps/api/elevation/";e.prototype.elevationProfileQueryDelay=500;e.prototype.proUpgradeUrl=null;e.prototype.earthCommunityUrl=null;e.prototype.googleMapsUrl=null;e.prototype.sharingUrl=null;e.prototype.privacyPolicyUrl=null;e.prototype.doGplusUserCheck=!1;e.prototype.rocktreeDataProto=null;e.prototype.filmstripConfig=i.emptyArray;e.prototype.showSigninButton=!1;e.prototype.proMeasureUpsellUrl=null;e.prototype.proPrintUpsellUrl=null;e.prototype.starDataProto=null;e.prototype.feedbackUrl=null;e.prototype.oauth2LoginUrl=null;var f={0:"keyhole.dbroot.PlanetModelProto",1:"keyhole.dbroot.StringIdOrValueProto",3:"keyhole.dbroot.MfeDomainFeaturesProto",6:"keyhole.dbroot.StringIdOrValueProto",9:"keyhole.dbroot.StringIdOrValueProto",10:"keyhole.dbroot.StringIdOrValueProto",12:"keyhole.dbroot.StringIdOrValueProto",14:"keyhole.dbroot.StringIdOrValueProto",15:"keyhole.dbroot.StringIdOrValueProto",16:"keyhole.dbroot.StringIdOrValueProto",17:"keyhole.dbroot.StringIdOrValueProto",18:"keyhole.dbroot.StringIdOrValueProto",19:"keyhole.dbroot.StringIdOrValueProto",20:"keyhole.dbroot.StringIdOrValueProto",21:"keyhole.dbroot.StringIdOrValueProto",22:"keyhole.dbroot.StringIdOrValueProto",23:"keyhole.dbroot.StringIdOrValueProto",24:"keyhole.dbroot.StringIdOrValueProto",25:"keyhole.dbroot.StringIdOrValueProto",26:"keyhole.dbroot.StringIdOrValueProto",27:"keyhole.dbroot.StringIdOrValueProto",28:"keyhole.dbroot.StringIdOrValueProto",29:"keyhole.dbroot.StringIdOrValueProto",30:"keyhole.dbroot.StringIdOrValueProto",33:"keyhole.dbroot.StringIdOrValueProto",35:"keyhole.dbroot.StringIdOrValueProto",36:"keyhole.dbroot.ClientOptionsProto",37:"keyhole.dbroot.FetchingOptionsProto",38:"keyhole.dbroot.TimeMachineOptionsProto",39:"keyhole.dbroot.CSIOptionsProto",40:"keyhole.dbroot.SearchTabProto",41:"keyhole.dbroot.CobrandProto",42:"keyhole.dbroot.DatabaseDescriptionProto",43:"keyhole.dbroot.ConfigScriptProto",44:"keyhole.dbroot.StringIdOrValueProto",45:"keyhole.dbroot.SwoopParamsProto",46:"keyhole.dbroot.PostingServerProto",47:"keyhole.dbroot.PostingServerProto",48:"keyhole.dbroot.PlanetaryDatabaseProto",49:"keyhole.dbroot.LogServerProto",50:"keyhole.dbroot.AutopiaOptionsProto",51:"keyhole.dbroot.EndSnippetProto.SearchConfigProto",52:"keyhole.dbroot.EndSnippetProto.SearchInfoProto",55:"keyhole.dbroot.StringIdOrValueProto",56:"keyhole.dbroot.StringIdOrValueProto",57:"keyhole.dbroot.StringIdOrValueProto",58:"keyhole.dbroot.StringIdOrValueProto",59:"keyhole.dbroot.StringIdOrValueProto",61:"keyhole.dbroot.EndSnippetProto.RockTreeDataProto",62:"keyhole.dbroot.EndSnippetProto.FilmstripConfigProto",64:"keyhole.dbroot.StringIdOrValueProto",65:"keyhole.dbroot.StringIdOrValueProto",66:"keyhole.dbroot.EndSnippetProto.StarDataProto",67:"keyhole.dbroot.StringIdOrValueProto",68:"keyhole.dbroot.StringIdOrValueProto"};return u.push(f),e.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.model=f[0].decode(n,n.uint32());break;case 2:u.authServerUrl=f[1].decode(n,n.uint32());break;case 3:u.disableAuthentication=n.bool();break;case 4:u.mfeDomains&&u.mfeDomains.length||(u.mfeDomains=[]);u.mfeDomains.push(f[3].decode(n,n.uint32()));break;case 5:u.mfeLangParam=n.string();break;case 6:u.adsUrlPatterns=n.string();break;case 7:u.reverseGeocoderUrl=f[6].decode(n,n.uint32());break;case 8:u.reverseGeocoderProtocolVersion=n.int32();break;case 9:u.skyDatabaseIsAvailable=n.bool();break;case 10:u.skyDatabaseUrl=f[9].decode(n,n.uint32());break;case 11:u.defaultWebPageIntlUrl=f[10].decode(n,n.uint32());break;case 12:u.numStartUpTips=n.int32();break;case 13:u.startUpTipsUrl=f[12].decode(n,n.uint32());break;case 51:u.numProStartUpTips=n.int32();break;case 52:u.proStartUpTipsUrl=f[14].decode(n,n.uint32());break;case 64:u.startupTipsIntlUrl=f[15].decode(n,n.uint32());break;case 14:u.userGuideIntlUrl=f[16].decode(n,n.uint32());break;case 15:u.supportCenterIntlUrl=f[17].decode(n,n.uint32());break;case 16:u.businessListingIntlUrl=f[18].decode(n,n.uint32());break;case 17:u.supportAnswerIntlUrl=f[19].decode(n,n.uint32());break;case 18:u.supportTopicIntlUrl=f[20].decode(n,n.uint32());break;case 19:u.supportRequestIntlUrl=f[21].decode(n,n.uint32());break;case 20:u.earthIntlUrl=f[22].decode(n,n.uint32());break;case 21:u.addContentUrl=f[23].decode(n,n.uint32());break;case 22:u.sketchupNotInstalledUrl=f[24].decode(n,n.uint32());break;case 23:u.sketchupErrorUrl=f[25].decode(n,n.uint32());break;case 24:u.freeLicenseUrl=f[26].decode(n,n.uint32());break;case 25:u.proLicenseUrl=f[27].decode(n,n.uint32());break;case 48:u.tutorialUrl=f[28].decode(n,n.uint32());break;case 49:u.keyboardShortcutsUrl=f[29].decode(n,n.uint32());break;case 50:u.releaseNotesUrl=f[30].decode(n,n.uint32());break;case 26:u.hideUserData=n.bool();break;case 27:u.useGeLogo=n.bool();break;case 28:u.dioramaDescriptionUrlBase=f[33].decode(n,n.uint32());break;case 29:u.dioramaDefaultColor=n.uint32();break;case 53:u.dioramaBlacklistUrl=f[35].decode(n,n.uint32());break;case 30:u.clientOptions=f[36].decode(n,n.uint32());break;case 31:u.fetchingOptions=f[37].decode(n,n.uint32());break;case 32:u.timeMachineOptions=f[38].decode(n,n.uint32());break;case 33:u.csiOptions=f[39].decode(n,n.uint32());break;case 34:u.searchTab&&u.searchTab.length||(u.searchTab=[]);u.searchTab.push(f[40].decode(n,n.uint32()));break;case 35:u.cobrandInfo&&u.cobrandInfo.length||(u.cobrandInfo=[]);u.cobrandInfo.push(f[41].decode(n,n.uint32()));break;case 36:u.validDatabase&&u.validDatabase.length||(u.validDatabase=[]);u.validDatabase.push(f[42].decode(n,n.uint32()));break;case 37:u.configScript&&u.configScript.length||(u.configScript=[]);u.configScript.push(f[43].decode(n,n.uint32()));break;case 38:u.deauthServerUrl=f[44].decode(n,n.uint32());break;case 39:u.swoopParameters=f[45].decode(n,n.uint32());break;case 40:u.bbsServerInfo=f[46].decode(n,n.uint32());break;case 41:u.dataErrorServerInfo=f[47].decode(n,n.uint32());break;case 42:u.planetaryDatabase&&u.planetaryDatabase.length||(u.planetaryDatabase=[]);u.planetaryDatabase.push(f[48].decode(n,n.uint32()));break;case 43:u.logServer=f[49].decode(n,n.uint32());break;case 44:u.autopiaOptions=f[50].decode(n,n.uint32());break;case 54:u.searchConfig=f[51].decode(n,n.uint32());break;case 45:u.searchInfo=f[52].decode(n,n.uint32());break;case 46:u.elevationServiceBaseUrl=n.string();break;case 47:u.elevationProfileQueryDelay=n.int32();break;case 55:u.proUpgradeUrl=f[55].decode(n,n.uint32());break;case 56:u.earthCommunityUrl=f[56].decode(n,n.uint32());break;case 57:u.googleMapsUrl=f[57].decode(n,n.uint32());break;case 58:u.sharingUrl=f[58].decode(n,n.uint32());break;case 59:u.privacyPolicyUrl=f[59].decode(n,n.uint32());break;case 60:u.doGplusUserCheck=n.bool();break;case 61:u.rocktreeDataProto=f[61].decode(n,n.uint32());break;case 62:u.filmstripConfig&&u.filmstripConfig.length||(u.filmstripConfig=[]);u.filmstripConfig.push(f[62].decode(n,n.uint32()));break;case 63:u.showSigninButton=n.bool();break;case 65:u.proMeasureUpsellUrl=f[64].decode(n,n.uint32());break;case 66:u.proPrintUpsellUrl=f[65].decode(n,n.uint32());break;case 67:u.starDataProto=f[66].decode(n,n.uint32());break;case 68:u.feedbackUrl=f[67].decode(n,n.uint32());break;case 69:u.oauth2LoginUrl=f[68].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},e.verify=function(n){var r,t;if(typeof n!="object"||n===null)return"object expected";if(n.model!==undefined&&n.model!==null&&(t=f[0].verify(n.model),t))return"model."+t;if(n.authServerUrl!==undefined&&n.authServerUrl!==null&&(t=f[1].verify(n.authServerUrl),t))return"authServerUrl."+t;if(n.disableAuthentication!==undefined&&typeof n.disableAuthentication!="boolean")return"disableAuthentication: boolean expected";if(n.mfeDomains!==undefined){if(!Array.isArray(n.mfeDomains))return"mfeDomains: array expected";for(r=0;r<n.mfeDomains.length;++r)if(t=f[3].verify(n.mfeDomains[r]),t)return"mfeDomains."+t}if(n.mfeLangParam!==undefined&&!i.isString(n.mfeLangParam))return"mfeLangParam: string expected";if(n.adsUrlPatterns!==undefined&&!i.isString(n.adsUrlPatterns))return"adsUrlPatterns: string expected";if(n.reverseGeocoderUrl!==undefined&&n.reverseGeocoderUrl!==null&&(t=f[6].verify(n.reverseGeocoderUrl),t))return"reverseGeocoderUrl."+t;if(n.reverseGeocoderProtocolVersion!==undefined&&!i.isInteger(n.reverseGeocoderProtocolVersion))return"reverseGeocoderProtocolVersion: integer expected";if(n.skyDatabaseIsAvailable!==undefined&&typeof n.skyDatabaseIsAvailable!="boolean")return"skyDatabaseIsAvailable: boolean expected";if(n.skyDatabaseUrl!==undefined&&n.skyDatabaseUrl!==null&&(t=f[9].verify(n.skyDatabaseUrl),t))return"skyDatabaseUrl."+t;if(n.defaultWebPageIntlUrl!==undefined&&n.defaultWebPageIntlUrl!==null&&(t=f[10].verify(n.defaultWebPageIntlUrl),t))return"defaultWebPageIntlUrl."+t;if(n.numStartUpTips!==undefined&&!i.isInteger(n.numStartUpTips))return"numStartUpTips: integer expected";if(n.startUpTipsUrl!==undefined&&n.startUpTipsUrl!==null&&(t=f[12].verify(n.startUpTipsUrl),t))return"startUpTipsUrl."+t;if(n.numProStartUpTips!==undefined&&!i.isInteger(n.numProStartUpTips))return"numProStartUpTips: integer expected";if(n.proStartUpTipsUrl!==undefined&&n.proStartUpTipsUrl!==null&&(t=f[14].verify(n.proStartUpTipsUrl),t))return"proStartUpTipsUrl."+t;if(n.startupTipsIntlUrl!==undefined&&n.startupTipsIntlUrl!==null&&(t=f[15].verify(n.startupTipsIntlUrl),t))return"startupTipsIntlUrl."+t;if(n.userGuideIntlUrl!==undefined&&n.userGuideIntlUrl!==null&&(t=f[16].verify(n.userGuideIntlUrl),t))return"userGuideIntlUrl."+t;if(n.supportCenterIntlUrl!==undefined&&n.supportCenterIntlUrl!==null&&(t=f[17].verify(n.supportCenterIntlUrl),t))return"supportCenterIntlUrl."+t;if(n.businessListingIntlUrl!==undefined&&n.businessListingIntlUrl!==null&&(t=f[18].verify(n.businessListingIntlUrl),t))return"businessListingIntlUrl."+t;if(n.supportAnswerIntlUrl!==undefined&&n.supportAnswerIntlUrl!==null&&(t=f[19].verify(n.supportAnswerIntlUrl),t))return"supportAnswerIntlUrl."+t;if(n.supportTopicIntlUrl!==undefined&&n.supportTopicIntlUrl!==null&&(t=f[20].verify(n.supportTopicIntlUrl),t))return"supportTopicIntlUrl."+t;if(n.supportRequestIntlUrl!==undefined&&n.supportRequestIntlUrl!==null&&(t=f[21].verify(n.supportRequestIntlUrl),t))return"supportRequestIntlUrl."+t;if(n.earthIntlUrl!==undefined&&n.earthIntlUrl!==null&&(t=f[22].verify(n.earthIntlUrl),t))return"earthIntlUrl."+t;if(n.addContentUrl!==undefined&&n.addContentUrl!==null&&(t=f[23].verify(n.addContentUrl),t))return"addContentUrl."+t;if(n.sketchupNotInstalledUrl!==undefined&&n.sketchupNotInstalledUrl!==null&&(t=f[24].verify(n.sketchupNotInstalledUrl),t))return"sketchupNotInstalledUrl."+t;if(n.sketchupErrorUrl!==undefined&&n.sketchupErrorUrl!==null&&(t=f[25].verify(n.sketchupErrorUrl),t))return"sketchupErrorUrl."+t;if(n.freeLicenseUrl!==undefined&&n.freeLicenseUrl!==null&&(t=f[26].verify(n.freeLicenseUrl),t))return"freeLicenseUrl."+t;if(n.proLicenseUrl!==undefined&&n.proLicenseUrl!==null&&(t=f[27].verify(n.proLicenseUrl),t))return"proLicenseUrl."+t;if(n.tutorialUrl!==undefined&&n.tutorialUrl!==null&&(t=f[28].verify(n.tutorialUrl),t))return"tutorialUrl."+t;if(n.keyboardShortcutsUrl!==undefined&&n.keyboardShortcutsUrl!==null&&(t=f[29].verify(n.keyboardShortcutsUrl),t))return"keyboardShortcutsUrl."+t;if(n.releaseNotesUrl!==undefined&&n.releaseNotesUrl!==null&&(t=f[30].verify(n.releaseNotesUrl),t))return"releaseNotesUrl."+t;if(n.hideUserData!==undefined&&typeof n.hideUserData!="boolean")return"hideUserData: boolean expected";if(n.useGeLogo!==undefined&&typeof n.useGeLogo!="boolean")return"useGeLogo: boolean expected";if(n.dioramaDescriptionUrlBase!==undefined&&n.dioramaDescriptionUrlBase!==null&&(t=f[33].verify(n.dioramaDescriptionUrlBase),t))return"dioramaDescriptionUrlBase."+t;if(n.dioramaDefaultColor!==undefined&&!i.isInteger(n.dioramaDefaultColor))return"dioramaDefaultColor: integer expected";if(n.dioramaBlacklistUrl!==undefined&&n.dioramaBlacklistUrl!==null&&(t=f[35].verify(n.dioramaBlacklistUrl),t))return"dioramaBlacklistUrl."+t;if(n.clientOptions!==undefined&&n.clientOptions!==null&&(t=f[36].verify(n.clientOptions),t))return"clientOptions."+t;if(n.fetchingOptions!==undefined&&n.fetchingOptions!==null&&(t=f[37].verify(n.fetchingOptions),t))return"fetchingOptions."+t;if(n.timeMachineOptions!==undefined&&n.timeMachineOptions!==null&&(t=f[38].verify(n.timeMachineOptions),t))return"timeMachineOptions."+t;if(n.csiOptions!==undefined&&n.csiOptions!==null&&(t=f[39].verify(n.csiOptions),t))return"csiOptions."+t;if(n.searchTab!==undefined){if(!Array.isArray(n.searchTab))return"searchTab: array expected";for(r=0;r<n.searchTab.length;++r)if(t=f[40].verify(n.searchTab[r]),t)return"searchTab."+t}if(n.cobrandInfo!==undefined){if(!Array.isArray(n.cobrandInfo))return"cobrandInfo: array expected";for(r=0;r<n.cobrandInfo.length;++r)if(t=f[41].verify(n.cobrandInfo[r]),t)return"cobrandInfo."+t}if(n.validDatabase!==undefined){if(!Array.isArray(n.validDatabase))return"validDatabase: array expected";for(r=0;r<n.validDatabase.length;++r)if(t=f[42].verify(n.validDatabase[r]),t)return"validDatabase."+t}if(n.configScript!==undefined){if(!Array.isArray(n.configScript))return"configScript: array expected";for(r=0;r<n.configScript.length;++r)if(t=f[43].verify(n.configScript[r]),t)return"configScript."+t}if(n.deauthServerUrl!==undefined&&n.deauthServerUrl!==null&&(t=f[44].verify(n.deauthServerUrl),t))return"deauthServerUrl."+t;if(n.swoopParameters!==undefined&&n.swoopParameters!==null&&(t=f[45].verify(n.swoopParameters),t))return"swoopParameters."+t;if(n.bbsServerInfo!==undefined&&n.bbsServerInfo!==null&&(t=f[46].verify(n.bbsServerInfo),t))return"bbsServerInfo."+t;if(n.dataErrorServerInfo!==undefined&&n.dataErrorServerInfo!==null&&(t=f[47].verify(n.dataErrorServerInfo),t))return"dataErrorServerInfo."+t;if(n.planetaryDatabase!==undefined){if(!Array.isArray(n.planetaryDatabase))return"planetaryDatabase: array expected";for(r=0;r<n.planetaryDatabase.length;++r)if(t=f[48].verify(n.planetaryDatabase[r]),t)return"planetaryDatabase."+t}if(n.logServer!==undefined&&n.logServer!==null&&(t=f[49].verify(n.logServer),t))return"logServer."+t;if(n.autopiaOptions!==undefined&&n.autopiaOptions!==null&&(t=f[50].verify(n.autopiaOptions),t))return"autopiaOptions."+t;if(n.searchConfig!==undefined&&n.searchConfig!==null&&(t=f[51].verify(n.searchConfig),t))return"searchConfig."+t;if(n.searchInfo!==undefined&&n.searchInfo!==null&&(t=f[52].verify(n.searchInfo),t))return"searchInfo."+t;if(n.elevationServiceBaseUrl!==undefined&&!i.isString(n.elevationServiceBaseUrl))return"elevationServiceBaseUrl: string expected";if(n.elevationProfileQueryDelay!==undefined&&!i.isInteger(n.elevationProfileQueryDelay))return"elevationProfileQueryDelay: integer expected";if(n.proUpgradeUrl!==undefined&&n.proUpgradeUrl!==null&&(t=f[55].verify(n.proUpgradeUrl),t))return"proUpgradeUrl."+t;if(n.earthCommunityUrl!==undefined&&n.earthCommunityUrl!==null&&(t=f[56].verify(n.earthCommunityUrl),t))return"earthCommunityUrl."+t;if(n.googleMapsUrl!==undefined&&n.googleMapsUrl!==null&&(t=f[57].verify(n.googleMapsUrl),t))return"googleMapsUrl."+t;if(n.sharingUrl!==undefined&&n.sharingUrl!==null&&(t=f[58].verify(n.sharingUrl),t))return"sharingUrl."+t;if(n.privacyPolicyUrl!==undefined&&n.privacyPolicyUrl!==null&&(t=f[59].verify(n.privacyPolicyUrl),t))return"privacyPolicyUrl."+t;if(n.doGplusUserCheck!==undefined&&typeof n.doGplusUserCheck!="boolean")return"doGplusUserCheck: boolean expected";if(n.rocktreeDataProto!==undefined&&n.rocktreeDataProto!==null&&(t=f[61].verify(n.rocktreeDataProto),t))return"rocktreeDataProto."+t;if(n.filmstripConfig!==undefined){if(!Array.isArray(n.filmstripConfig))return"filmstripConfig: array expected";for(r=0;r<n.filmstripConfig.length;++r)if(t=f[62].verify(n.filmstripConfig[r]),t)return"filmstripConfig."+t}return n.showSigninButton!==undefined&&typeof n.showSigninButton!="boolean"?"showSigninButton: boolean expected":n.proMeasureUpsellUrl!==undefined&&n.proMeasureUpsellUrl!==null&&(t=f[64].verify(n.proMeasureUpsellUrl),t)?"proMeasureUpsellUrl."+t:n.proPrintUpsellUrl!==undefined&&n.proPrintUpsellUrl!==null&&(t=f[65].verify(n.proPrintUpsellUrl),t)?"proPrintUpsellUrl."+t:n.starDataProto!==undefined&&n.starDataProto!==null&&(t=f[66].verify(n.starDataProto),t)?"starDataProto."+t:n.feedbackUrl!==undefined&&n.feedbackUrl!==null&&(t=f[67].verify(n.feedbackUrl),t)?"feedbackUrl."+t:n.oauth2LoginUrl!==undefined&&n.oauth2LoginUrl!==null&&(t=f[68].verify(n.oauth2LoginUrl),t)?"oauth2LoginUrl."+t:null},e.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.EndSnippetProto)return n;if(i=new t.keyhole.dbroot.EndSnippetProto,n.model!==undefined&&n.model!==null){if(typeof n.model!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.model: object expected");i.model=f[0].fromObject(n.model)}if(n.authServerUrl!==undefined&&n.authServerUrl!==null){if(typeof n.authServerUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.authServerUrl: object expected");i.authServerUrl=f[1].fromObject(n.authServerUrl)}if(n.disableAuthentication!==undefined&&n.disableAuthentication!==null&&(i.disableAuthentication=Boolean(n.disableAuthentication)),n.mfeDomains){if(!Array.isArray(n.mfeDomains))throw TypeError(".keyhole.dbroot.EndSnippetProto.mfeDomains: array expected");for(i.mfeDomains=[],r=0;r<n.mfeDomains.length;++r){if(typeof n.mfeDomains[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.mfeDomains: object expected");i.mfeDomains[r]=f[3].fromObject(n.mfeDomains[r])}}if(n.mfeLangParam!==undefined&&n.mfeLangParam!==null&&(i.mfeLangParam=String(n.mfeLangParam)),n.adsUrlPatterns!==undefined&&n.adsUrlPatterns!==null&&(i.adsUrlPatterns=String(n.adsUrlPatterns)),n.reverseGeocoderUrl!==undefined&&n.reverseGeocoderUrl!==null){if(typeof n.reverseGeocoderUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.reverseGeocoderUrl: object expected");i.reverseGeocoderUrl=f[6].fromObject(n.reverseGeocoderUrl)}if(n.reverseGeocoderProtocolVersion!==undefined&&n.reverseGeocoderProtocolVersion!==null&&(i.reverseGeocoderProtocolVersion=n.reverseGeocoderProtocolVersion|0),n.skyDatabaseIsAvailable!==undefined&&n.skyDatabaseIsAvailable!==null&&(i.skyDatabaseIsAvailable=Boolean(n.skyDatabaseIsAvailable)),n.skyDatabaseUrl!==undefined&&n.skyDatabaseUrl!==null){if(typeof n.skyDatabaseUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.skyDatabaseUrl: object expected");i.skyDatabaseUrl=f[9].fromObject(n.skyDatabaseUrl)}if(n.defaultWebPageIntlUrl!==undefined&&n.defaultWebPageIntlUrl!==null){if(typeof n.defaultWebPageIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.defaultWebPageIntlUrl: object expected");i.defaultWebPageIntlUrl=f[10].fromObject(n.defaultWebPageIntlUrl)}if(n.numStartUpTips!==undefined&&n.numStartUpTips!==null&&(i.numStartUpTips=n.numStartUpTips|0),n.startUpTipsUrl!==undefined&&n.startUpTipsUrl!==null){if(typeof n.startUpTipsUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.startUpTipsUrl: object expected");i.startUpTipsUrl=f[12].fromObject(n.startUpTipsUrl)}if(n.numProStartUpTips!==undefined&&n.numProStartUpTips!==null&&(i.numProStartUpTips=n.numProStartUpTips|0),n.proStartUpTipsUrl!==undefined&&n.proStartUpTipsUrl!==null){if(typeof n.proStartUpTipsUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.proStartUpTipsUrl: object expected");i.proStartUpTipsUrl=f[14].fromObject(n.proStartUpTipsUrl)}if(n.startupTipsIntlUrl!==undefined&&n.startupTipsIntlUrl!==null){if(typeof n.startupTipsIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.startupTipsIntlUrl: object expected");i.startupTipsIntlUrl=f[15].fromObject(n.startupTipsIntlUrl)}if(n.userGuideIntlUrl!==undefined&&n.userGuideIntlUrl!==null){if(typeof n.userGuideIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.userGuideIntlUrl: object expected");i.userGuideIntlUrl=f[16].fromObject(n.userGuideIntlUrl)}if(n.supportCenterIntlUrl!==undefined&&n.supportCenterIntlUrl!==null){if(typeof n.supportCenterIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.supportCenterIntlUrl: object expected");i.supportCenterIntlUrl=f[17].fromObject(n.supportCenterIntlUrl)}if(n.businessListingIntlUrl!==undefined&&n.businessListingIntlUrl!==null){if(typeof n.businessListingIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.businessListingIntlUrl: object expected");i.businessListingIntlUrl=f[18].fromObject(n.businessListingIntlUrl)}if(n.supportAnswerIntlUrl!==undefined&&n.supportAnswerIntlUrl!==null){if(typeof n.supportAnswerIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.supportAnswerIntlUrl: object expected");i.supportAnswerIntlUrl=f[19].fromObject(n.supportAnswerIntlUrl)}if(n.supportTopicIntlUrl!==undefined&&n.supportTopicIntlUrl!==null){if(typeof n.supportTopicIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.supportTopicIntlUrl: object expected");i.supportTopicIntlUrl=f[20].fromObject(n.supportTopicIntlUrl)}if(n.supportRequestIntlUrl!==undefined&&n.supportRequestIntlUrl!==null){if(typeof n.supportRequestIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.supportRequestIntlUrl: object expected");i.supportRequestIntlUrl=f[21].fromObject(n.supportRequestIntlUrl)}if(n.earthIntlUrl!==undefined&&n.earthIntlUrl!==null){if(typeof n.earthIntlUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.earthIntlUrl: object expected");i.earthIntlUrl=f[22].fromObject(n.earthIntlUrl)}if(n.addContentUrl!==undefined&&n.addContentUrl!==null){if(typeof n.addContentUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.addContentUrl: object expected");i.addContentUrl=f[23].fromObject(n.addContentUrl)}if(n.sketchupNotInstalledUrl!==undefined&&n.sketchupNotInstalledUrl!==null){if(typeof n.sketchupNotInstalledUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.sketchupNotInstalledUrl: object expected");i.sketchupNotInstalledUrl=f[24].fromObject(n.sketchupNotInstalledUrl)}if(n.sketchupErrorUrl!==undefined&&n.sketchupErrorUrl!==null){if(typeof n.sketchupErrorUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.sketchupErrorUrl: object expected");i.sketchupErrorUrl=f[25].fromObject(n.sketchupErrorUrl)}if(n.freeLicenseUrl!==undefined&&n.freeLicenseUrl!==null){if(typeof n.freeLicenseUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.freeLicenseUrl: object expected");i.freeLicenseUrl=f[26].fromObject(n.freeLicenseUrl)}if(n.proLicenseUrl!==undefined&&n.proLicenseUrl!==null){if(typeof n.proLicenseUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.proLicenseUrl: object expected");i.proLicenseUrl=f[27].fromObject(n.proLicenseUrl)}if(n.tutorialUrl!==undefined&&n.tutorialUrl!==null){if(typeof n.tutorialUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.tutorialUrl: object expected");i.tutorialUrl=f[28].fromObject(n.tutorialUrl)}if(n.keyboardShortcutsUrl!==undefined&&n.keyboardShortcutsUrl!==null){if(typeof n.keyboardShortcutsUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.keyboardShortcutsUrl: object expected");i.keyboardShortcutsUrl=f[29].fromObject(n.keyboardShortcutsUrl)}if(n.releaseNotesUrl!==undefined&&n.releaseNotesUrl!==null){if(typeof n.releaseNotesUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.releaseNotesUrl: object expected");i.releaseNotesUrl=f[30].fromObject(n.releaseNotesUrl)}if(n.hideUserData!==undefined&&n.hideUserData!==null&&(i.hideUserData=Boolean(n.hideUserData)),n.useGeLogo!==undefined&&n.useGeLogo!==null&&(i.useGeLogo=Boolean(n.useGeLogo)),n.dioramaDescriptionUrlBase!==undefined&&n.dioramaDescriptionUrlBase!==null){if(typeof n.dioramaDescriptionUrlBase!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.dioramaDescriptionUrlBase: object expected");i.dioramaDescriptionUrlBase=f[33].fromObject(n.dioramaDescriptionUrlBase)}if(n.dioramaDefaultColor!==undefined&&n.dioramaDefaultColor!==null&&(i.dioramaDefaultColor=n.dioramaDefaultColor>>>0),n.dioramaBlacklistUrl!==undefined&&n.dioramaBlacklistUrl!==null){if(typeof n.dioramaBlacklistUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.dioramaBlacklistUrl: object expected");i.dioramaBlacklistUrl=f[35].fromObject(n.dioramaBlacklistUrl)}if(n.clientOptions!==undefined&&n.clientOptions!==null){if(typeof n.clientOptions!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.clientOptions: object expected");i.clientOptions=f[36].fromObject(n.clientOptions)}if(n.fetchingOptions!==undefined&&n.fetchingOptions!==null){if(typeof n.fetchingOptions!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.fetchingOptions: object expected");i.fetchingOptions=f[37].fromObject(n.fetchingOptions)}if(n.timeMachineOptions!==undefined&&n.timeMachineOptions!==null){if(typeof n.timeMachineOptions!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.timeMachineOptions: object expected");i.timeMachineOptions=f[38].fromObject(n.timeMachineOptions)}if(n.csiOptions!==undefined&&n.csiOptions!==null){if(typeof n.csiOptions!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.csiOptions: object expected");i.csiOptions=f[39].fromObject(n.csiOptions)}if(n.searchTab){if(!Array.isArray(n.searchTab))throw TypeError(".keyhole.dbroot.EndSnippetProto.searchTab: array expected");for(i.searchTab=[],r=0;r<n.searchTab.length;++r){if(typeof n.searchTab[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.searchTab: object expected");i.searchTab[r]=f[40].fromObject(n.searchTab[r])}}if(n.cobrandInfo){if(!Array.isArray(n.cobrandInfo))throw TypeError(".keyhole.dbroot.EndSnippetProto.cobrandInfo: array expected");for(i.cobrandInfo=[],r=0;r<n.cobrandInfo.length;++r){if(typeof n.cobrandInfo[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.cobrandInfo: object expected");i.cobrandInfo[r]=f[41].fromObject(n.cobrandInfo[r])}}if(n.validDatabase){if(!Array.isArray(n.validDatabase))throw TypeError(".keyhole.dbroot.EndSnippetProto.validDatabase: array expected");for(i.validDatabase=[],r=0;r<n.validDatabase.length;++r){if(typeof n.validDatabase[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.validDatabase: object expected");i.validDatabase[r]=f[42].fromObject(n.validDatabase[r])}}if(n.configScript){if(!Array.isArray(n.configScript))throw TypeError(".keyhole.dbroot.EndSnippetProto.configScript: array expected");for(i.configScript=[],r=0;r<n.configScript.length;++r){if(typeof n.configScript[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.configScript: object expected");i.configScript[r]=f[43].fromObject(n.configScript[r])}}if(n.deauthServerUrl!==undefined&&n.deauthServerUrl!==null){if(typeof n.deauthServerUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.deauthServerUrl: object expected");i.deauthServerUrl=f[44].fromObject(n.deauthServerUrl)}if(n.swoopParameters!==undefined&&n.swoopParameters!==null){if(typeof n.swoopParameters!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.swoopParameters: object expected");i.swoopParameters=f[45].fromObject(n.swoopParameters)}if(n.bbsServerInfo!==undefined&&n.bbsServerInfo!==null){if(typeof n.bbsServerInfo!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.bbsServerInfo: object expected");i.bbsServerInfo=f[46].fromObject(n.bbsServerInfo)}if(n.dataErrorServerInfo!==undefined&&n.dataErrorServerInfo!==null){if(typeof n.dataErrorServerInfo!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.dataErrorServerInfo: object expected");i.dataErrorServerInfo=f[47].fromObject(n.dataErrorServerInfo)}if(n.planetaryDatabase){if(!Array.isArray(n.planetaryDatabase))throw TypeError(".keyhole.dbroot.EndSnippetProto.planetaryDatabase: array expected");for(i.planetaryDatabase=[],r=0;r<n.planetaryDatabase.length;++r){if(typeof n.planetaryDatabase[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.planetaryDatabase: object expected");i.planetaryDatabase[r]=f[48].fromObject(n.planetaryDatabase[r])}}if(n.logServer!==undefined&&n.logServer!==null){if(typeof n.logServer!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.logServer: object expected");i.logServer=f[49].fromObject(n.logServer)}if(n.autopiaOptions!==undefined&&n.autopiaOptions!==null){if(typeof n.autopiaOptions!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.autopiaOptions: object expected");i.autopiaOptions=f[50].fromObject(n.autopiaOptions)}if(n.searchConfig!==undefined&&n.searchConfig!==null){if(typeof n.searchConfig!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.searchConfig: object expected");i.searchConfig=f[51].fromObject(n.searchConfig)}if(n.searchInfo!==undefined&&n.searchInfo!==null){if(typeof n.searchInfo!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.searchInfo: object expected");i.searchInfo=f[52].fromObject(n.searchInfo)}if(n.elevationServiceBaseUrl!==undefined&&n.elevationServiceBaseUrl!==null&&(i.elevationServiceBaseUrl=String(n.elevationServiceBaseUrl)),n.elevationProfileQueryDelay!==undefined&&n.elevationProfileQueryDelay!==null&&(i.elevationProfileQueryDelay=n.elevationProfileQueryDelay|0),n.proUpgradeUrl!==undefined&&n.proUpgradeUrl!==null){if(typeof n.proUpgradeUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.proUpgradeUrl: object expected");i.proUpgradeUrl=f[55].fromObject(n.proUpgradeUrl)}if(n.earthCommunityUrl!==undefined&&n.earthCommunityUrl!==null){if(typeof n.earthCommunityUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.earthCommunityUrl: object expected");i.earthCommunityUrl=f[56].fromObject(n.earthCommunityUrl)}if(n.googleMapsUrl!==undefined&&n.googleMapsUrl!==null){if(typeof n.googleMapsUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.googleMapsUrl: object expected");i.googleMapsUrl=f[57].fromObject(n.googleMapsUrl)}if(n.sharingUrl!==undefined&&n.sharingUrl!==null){if(typeof n.sharingUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.sharingUrl: object expected");i.sharingUrl=f[58].fromObject(n.sharingUrl)}if(n.privacyPolicyUrl!==undefined&&n.privacyPolicyUrl!==null){if(typeof n.privacyPolicyUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.privacyPolicyUrl: object expected");i.privacyPolicyUrl=f[59].fromObject(n.privacyPolicyUrl)}if(n.doGplusUserCheck!==undefined&&n.doGplusUserCheck!==null&&(i.doGplusUserCheck=Boolean(n.doGplusUserCheck)),n.rocktreeDataProto!==undefined&&n.rocktreeDataProto!==null){if(typeof n.rocktreeDataProto!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.rocktreeDataProto: object expected");i.rocktreeDataProto=f[61].fromObject(n.rocktreeDataProto)}if(n.filmstripConfig){if(!Array.isArray(n.filmstripConfig))throw TypeError(".keyhole.dbroot.EndSnippetProto.filmstripConfig: array expected");for(i.filmstripConfig=[],r=0;r<n.filmstripConfig.length;++r){if(typeof n.filmstripConfig[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.filmstripConfig: object expected");i.filmstripConfig[r]=f[62].fromObject(n.filmstripConfig[r])}}if(n.showSigninButton!==undefined&&n.showSigninButton!==null&&(i.showSigninButton=Boolean(n.showSigninButton)),n.proMeasureUpsellUrl!==undefined&&n.proMeasureUpsellUrl!==null){if(typeof n.proMeasureUpsellUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.proMeasureUpsellUrl: object expected");i.proMeasureUpsellUrl=f[64].fromObject(n.proMeasureUpsellUrl)}if(n.proPrintUpsellUrl!==undefined&&n.proPrintUpsellUrl!==null){if(typeof n.proPrintUpsellUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.proPrintUpsellUrl: object expected");i.proPrintUpsellUrl=f[65].fromObject(n.proPrintUpsellUrl)}if(n.starDataProto!==undefined&&n.starDataProto!==null){if(typeof n.starDataProto!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.starDataProto: object expected");i.starDataProto=f[66].fromObject(n.starDataProto)}if(n.feedbackUrl!==undefined&&n.feedbackUrl!==null){if(typeof n.feedbackUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.feedbackUrl: object expected");i.feedbackUrl=f[67].fromObject(n.feedbackUrl)}if(n.oauth2LoginUrl!==undefined&&n.oauth2LoginUrl!==null){if(typeof n.oauth2LoginUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.oauth2LoginUrl: object expected");i.oauth2LoginUrl=f[68].fromObject(n.oauth2LoginUrl)}return i},e.from=e.fromObject,e.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.mfeDomains=[],i.searchTab=[],i.cobrandInfo=[],i.validDatabase=[],i.configScript=[],i.planetaryDatabase=[],i.filmstripConfig=[]),t.defaults&&(i.model=null,i.authServerUrl=null,i.disableAuthentication=!1,i.mfeLangParam="hl=$5Bhl5D",i.adsUrlPatterns="",i.reverseGeocoderUrl=null,i.reverseGeocoderProtocolVersion=3,i.skyDatabaseIsAvailable=!0,i.skyDatabaseUrl=null,i.defaultWebPageIntlUrl=null,i.numStartUpTips=17,i.startUpTipsUrl=null,i.numProStartUpTips=0,i.proStartUpTipsUrl=null,i.startupTipsIntlUrl=null,i.userGuideIntlUrl=null,i.supportCenterIntlUrl=null,i.businessListingIntlUrl=null,i.supportAnswerIntlUrl=null,i.supportTopicIntlUrl=null,i.supportRequestIntlUrl=null,i.earthIntlUrl=null,i.addContentUrl=null,i.sketchupNotInstalledUrl=null,i.sketchupErrorUrl=null,i.freeLicenseUrl=null,i.proLicenseUrl=null,i.tutorialUrl=null,i.keyboardShortcutsUrl=null,i.releaseNotesUrl=null,i.hideUserData=!1,i.useGeLogo=!0,i.dioramaDescriptionUrlBase=null,i.dioramaDefaultColor=4291281607,i.dioramaBlacklistUrl=null,i.clientOptions=null,i.fetchingOptions=null,i.timeMachineOptions=null,i.csiOptions=null,i.deauthServerUrl=null,i.swoopParameters=null,i.bbsServerInfo=null,i.dataErrorServerInfo=null,i.logServer=null,i.autopiaOptions=null,i.searchConfig=null,i.searchInfo=null,i.elevationServiceBaseUrl="http://maps.google.com/maps/api/elevation/",i.elevationProfileQueryDelay=500,i.proUpgradeUrl=null,i.earthCommunityUrl=null,i.googleMapsUrl=null,i.sharingUrl=null,i.privacyPolicyUrl=null,i.doGplusUserCheck=!1,i.rocktreeDataProto=null,i.showSigninButton=!1,i.proMeasureUpsellUrl=null,i.proPrintUpsellUrl=null,i.starDataProto=null,i.feedbackUrl=null,i.oauth2LoginUrl=null),n.model!==undefined&&n.model!==null&&n.hasOwnProperty("model")&&(i.model=f[0].toObject(n.model,t)),n.authServerUrl!==undefined&&n.authServerUrl!==null&&n.hasOwnProperty("authServerUrl")&&(i.authServerUrl=f[1].toObject(n.authServerUrl,t)),n.disableAuthentication!==undefined&&n.disableAuthentication!==null&&n.hasOwnProperty("disableAuthentication")&&(i.disableAuthentication=n.disableAuthentication),n.mfeDomains!==undefined&&n.mfeDomains!==null&&n.hasOwnProperty("mfeDomains"))for(i.mfeDomains=[],r=0;r<n.mfeDomains.length;++r)i.mfeDomains[r]=f[3].toObject(n.mfeDomains[r],t);if(n.mfeLangParam!==undefined&&n.mfeLangParam!==null&&n.hasOwnProperty("mfeLangParam")&&(i.mfeLangParam=n.mfeLangParam),n.adsUrlPatterns!==undefined&&n.adsUrlPatterns!==null&&n.hasOwnProperty("adsUrlPatterns")&&(i.adsUrlPatterns=n.adsUrlPatterns),n.reverseGeocoderUrl!==undefined&&n.reverseGeocoderUrl!==null&&n.hasOwnProperty("reverseGeocoderUrl")&&(i.reverseGeocoderUrl=f[6].toObject(n.reverseGeocoderUrl,t)),n.reverseGeocoderProtocolVersion!==undefined&&n.reverseGeocoderProtocolVersion!==null&&n.hasOwnProperty("reverseGeocoderProtocolVersion")&&(i.reverseGeocoderProtocolVersion=n.reverseGeocoderProtocolVersion),n.skyDatabaseIsAvailable!==undefined&&n.skyDatabaseIsAvailable!==null&&n.hasOwnProperty("skyDatabaseIsAvailable")&&(i.skyDatabaseIsAvailable=n.skyDatabaseIsAvailable),n.skyDatabaseUrl!==undefined&&n.skyDatabaseUrl!==null&&n.hasOwnProperty("skyDatabaseUrl")&&(i.skyDatabaseUrl=f[9].toObject(n.skyDatabaseUrl,t)),n.defaultWebPageIntlUrl!==undefined&&n.defaultWebPageIntlUrl!==null&&n.hasOwnProperty("defaultWebPageIntlUrl")&&(i.defaultWebPageIntlUrl=f[10].toObject(n.defaultWebPageIntlUrl,t)),n.numStartUpTips!==undefined&&n.numStartUpTips!==null&&n.hasOwnProperty("numStartUpTips")&&(i.numStartUpTips=n.numStartUpTips),n.startUpTipsUrl!==undefined&&n.startUpTipsUrl!==null&&n.hasOwnProperty("startUpTipsUrl")&&(i.startUpTipsUrl=f[12].toObject(n.startUpTipsUrl,t)),n.numProStartUpTips!==undefined&&n.numProStartUpTips!==null&&n.hasOwnProperty("numProStartUpTips")&&(i.numProStartUpTips=n.numProStartUpTips),n.proStartUpTipsUrl!==undefined&&n.proStartUpTipsUrl!==null&&n.hasOwnProperty("proStartUpTipsUrl")&&(i.proStartUpTipsUrl=f[14].toObject(n.proStartUpTipsUrl,t)),n.startupTipsIntlUrl!==undefined&&n.startupTipsIntlUrl!==null&&n.hasOwnProperty("startupTipsIntlUrl")&&(i.startupTipsIntlUrl=f[15].toObject(n.startupTipsIntlUrl,t)),n.userGuideIntlUrl!==undefined&&n.userGuideIntlUrl!==null&&n.hasOwnProperty("userGuideIntlUrl")&&(i.userGuideIntlUrl=f[16].toObject(n.userGuideIntlUrl,t)),n.supportCenterIntlUrl!==undefined&&n.supportCenterIntlUrl!==null&&n.hasOwnProperty("supportCenterIntlUrl")&&(i.supportCenterIntlUrl=f[17].toObject(n.supportCenterIntlUrl,t)),n.businessListingIntlUrl!==undefined&&n.businessListingIntlUrl!==null&&n.hasOwnProperty("businessListingIntlUrl")&&(i.businessListingIntlUrl=f[18].toObject(n.businessListingIntlUrl,t)),n.supportAnswerIntlUrl!==undefined&&n.supportAnswerIntlUrl!==null&&n.hasOwnProperty("supportAnswerIntlUrl")&&(i.supportAnswerIntlUrl=f[19].toObject(n.supportAnswerIntlUrl,t)),n.supportTopicIntlUrl!==undefined&&n.supportTopicIntlUrl!==null&&n.hasOwnProperty("supportTopicIntlUrl")&&(i.supportTopicIntlUrl=f[20].toObject(n.supportTopicIntlUrl,t)),n.supportRequestIntlUrl!==undefined&&n.supportRequestIntlUrl!==null&&n.hasOwnProperty("supportRequestIntlUrl")&&(i.supportRequestIntlUrl=f[21].toObject(n.supportRequestIntlUrl,t)),n.earthIntlUrl!==undefined&&n.earthIntlUrl!==null&&n.hasOwnProperty("earthIntlUrl")&&(i.earthIntlUrl=f[22].toObject(n.earthIntlUrl,t)),n.addContentUrl!==undefined&&n.addContentUrl!==null&&n.hasOwnProperty("addContentUrl")&&(i.addContentUrl=f[23].toObject(n.addContentUrl,t)),n.sketchupNotInstalledUrl!==undefined&&n.sketchupNotInstalledUrl!==null&&n.hasOwnProperty("sketchupNotInstalledUrl")&&(i.sketchupNotInstalledUrl=f[24].toObject(n.sketchupNotInstalledUrl,t)),n.sketchupErrorUrl!==undefined&&n.sketchupErrorUrl!==null&&n.hasOwnProperty("sketchupErrorUrl")&&(i.sketchupErrorUrl=f[25].toObject(n.sketchupErrorUrl,t)),n.freeLicenseUrl!==undefined&&n.freeLicenseUrl!==null&&n.hasOwnProperty("freeLicenseUrl")&&(i.freeLicenseUrl=f[26].toObject(n.freeLicenseUrl,t)),n.proLicenseUrl!==undefined&&n.proLicenseUrl!==null&&n.hasOwnProperty("proLicenseUrl")&&(i.proLicenseUrl=f[27].toObject(n.proLicenseUrl,t)),n.tutorialUrl!==undefined&&n.tutorialUrl!==null&&n.hasOwnProperty("tutorialUrl")&&(i.tutorialUrl=f[28].toObject(n.tutorialUrl,t)),n.keyboardShortcutsUrl!==undefined&&n.keyboardShortcutsUrl!==null&&n.hasOwnProperty("keyboardShortcutsUrl")&&(i.keyboardShortcutsUrl=f[29].toObject(n.keyboardShortcutsUrl,t)),n.releaseNotesUrl!==undefined&&n.releaseNotesUrl!==null&&n.hasOwnProperty("releaseNotesUrl")&&(i.releaseNotesUrl=f[30].toObject(n.releaseNotesUrl,t)),n.hideUserData!==undefined&&n.hideUserData!==null&&n.hasOwnProperty("hideUserData")&&(i.hideUserData=n.hideUserData),n.useGeLogo!==undefined&&n.useGeLogo!==null&&n.hasOwnProperty("useGeLogo")&&(i.useGeLogo=n.useGeLogo),n.dioramaDescriptionUrlBase!==undefined&&n.dioramaDescriptionUrlBase!==null&&n.hasOwnProperty("dioramaDescriptionUrlBase")&&(i.dioramaDescriptionUrlBase=f[33].toObject(n.dioramaDescriptionUrlBase,t)),n.dioramaDefaultColor!==undefined&&n.dioramaDefaultColor!==null&&n.hasOwnProperty("dioramaDefaultColor")&&(i.dioramaDefaultColor=n.dioramaDefaultColor),n.dioramaBlacklistUrl!==undefined&&n.dioramaBlacklistUrl!==null&&n.hasOwnProperty("dioramaBlacklistUrl")&&(i.dioramaBlacklistUrl=f[35].toObject(n.dioramaBlacklistUrl,t)),n.clientOptions!==undefined&&n.clientOptions!==null&&n.hasOwnProperty("clientOptions")&&(i.clientOptions=f[36].toObject(n.clientOptions,t)),n.fetchingOptions!==undefined&&n.fetchingOptions!==null&&n.hasOwnProperty("fetchingOptions")&&(i.fetchingOptions=f[37].toObject(n.fetchingOptions,t)),n.timeMachineOptions!==undefined&&n.timeMachineOptions!==null&&n.hasOwnProperty("timeMachineOptions")&&(i.timeMachineOptions=f[38].toObject(n.timeMachineOptions,t)),n.csiOptions!==undefined&&n.csiOptions!==null&&n.hasOwnProperty("csiOptions")&&(i.csiOptions=f[39].toObject(n.csiOptions,t)),n.searchTab!==undefined&&n.searchTab!==null&&n.hasOwnProperty("searchTab"))for(i.searchTab=[],r=0;r<n.searchTab.length;++r)i.searchTab[r]=f[40].toObject(n.searchTab[r],t);if(n.cobrandInfo!==undefined&&n.cobrandInfo!==null&&n.hasOwnProperty("cobrandInfo"))for(i.cobrandInfo=[],r=0;r<n.cobrandInfo.length;++r)i.cobrandInfo[r]=f[41].toObject(n.cobrandInfo[r],t);if(n.validDatabase!==undefined&&n.validDatabase!==null&&n.hasOwnProperty("validDatabase"))for(i.validDatabase=[],r=0;r<n.validDatabase.length;++r)i.validDatabase[r]=f[42].toObject(n.validDatabase[r],t);if(n.configScript!==undefined&&n.configScript!==null&&n.hasOwnProperty("configScript"))for(i.configScript=[],r=0;r<n.configScript.length;++r)i.configScript[r]=f[43].toObject(n.configScript[r],t);if(n.deauthServerUrl!==undefined&&n.deauthServerUrl!==null&&n.hasOwnProperty("deauthServerUrl")&&(i.deauthServerUrl=f[44].toObject(n.deauthServerUrl,t)),n.swoopParameters!==undefined&&n.swoopParameters!==null&&n.hasOwnProperty("swoopParameters")&&(i.swoopParameters=f[45].toObject(n.swoopParameters,t)),n.bbsServerInfo!==undefined&&n.bbsServerInfo!==null&&n.hasOwnProperty("bbsServerInfo")&&(i.bbsServerInfo=f[46].toObject(n.bbsServerInfo,t)),n.dataErrorServerInfo!==undefined&&n.dataErrorServerInfo!==null&&n.hasOwnProperty("dataErrorServerInfo")&&(i.dataErrorServerInfo=f[47].toObject(n.dataErrorServerInfo,t)),n.planetaryDatabase!==undefined&&n.planetaryDatabase!==null&&n.hasOwnProperty("planetaryDatabase"))for(i.planetaryDatabase=[],r=0;r<n.planetaryDatabase.length;++r)i.planetaryDatabase[r]=f[48].toObject(n.planetaryDatabase[r],t);if(n.logServer!==undefined&&n.logServer!==null&&n.hasOwnProperty("logServer")&&(i.logServer=f[49].toObject(n.logServer,t)),n.autopiaOptions!==undefined&&n.autopiaOptions!==null&&n.hasOwnProperty("autopiaOptions")&&(i.autopiaOptions=f[50].toObject(n.autopiaOptions,t)),n.searchConfig!==undefined&&n.searchConfig!==null&&n.hasOwnProperty("searchConfig")&&(i.searchConfig=f[51].toObject(n.searchConfig,t)),n.searchInfo!==undefined&&n.searchInfo!==null&&n.hasOwnProperty("searchInfo")&&(i.searchInfo=f[52].toObject(n.searchInfo,t)),n.elevationServiceBaseUrl!==undefined&&n.elevationServiceBaseUrl!==null&&n.hasOwnProperty("elevationServiceBaseUrl")&&(i.elevationServiceBaseUrl=n.elevationServiceBaseUrl),n.elevationProfileQueryDelay!==undefined&&n.elevationProfileQueryDelay!==null&&n.hasOwnProperty("elevationProfileQueryDelay")&&(i.elevationProfileQueryDelay=n.elevationProfileQueryDelay),n.proUpgradeUrl!==undefined&&n.proUpgradeUrl!==null&&n.hasOwnProperty("proUpgradeUrl")&&(i.proUpgradeUrl=f[55].toObject(n.proUpgradeUrl,t)),n.earthCommunityUrl!==undefined&&n.earthCommunityUrl!==null&&n.hasOwnProperty("earthCommunityUrl")&&(i.earthCommunityUrl=f[56].toObject(n.earthCommunityUrl,t)),n.googleMapsUrl!==undefined&&n.googleMapsUrl!==null&&n.hasOwnProperty("googleMapsUrl")&&(i.googleMapsUrl=f[57].toObject(n.googleMapsUrl,t)),n.sharingUrl!==undefined&&n.sharingUrl!==null&&n.hasOwnProperty("sharingUrl")&&(i.sharingUrl=f[58].toObject(n.sharingUrl,t)),n.privacyPolicyUrl!==undefined&&n.privacyPolicyUrl!==null&&n.hasOwnProperty("privacyPolicyUrl")&&(i.privacyPolicyUrl=f[59].toObject(n.privacyPolicyUrl,t)),n.doGplusUserCheck!==undefined&&n.doGplusUserCheck!==null&&n.hasOwnProperty("doGplusUserCheck")&&(i.doGplusUserCheck=n.doGplusUserCheck),n.rocktreeDataProto!==undefined&&n.rocktreeDataProto!==null&&n.hasOwnProperty("rocktreeDataProto")&&(i.rocktreeDataProto=f[61].toObject(n.rocktreeDataProto,t)),n.filmstripConfig!==undefined&&n.filmstripConfig!==null&&n.hasOwnProperty("filmstripConfig"))for(i.filmstripConfig=[],r=0;r<n.filmstripConfig.length;++r)i.filmstripConfig[r]=f[62].toObject(n.filmstripConfig[r],t);return n.showSigninButton!==undefined&&n.showSigninButton!==null&&n.hasOwnProperty("showSigninButton")&&(i.showSigninButton=n.showSigninButton),n.proMeasureUpsellUrl!==undefined&&n.proMeasureUpsellUrl!==null&&n.hasOwnProperty("proMeasureUpsellUrl")&&(i.proMeasureUpsellUrl=f[64].toObject(n.proMeasureUpsellUrl,t)),n.proPrintUpsellUrl!==undefined&&n.proPrintUpsellUrl!==null&&n.hasOwnProperty("proPrintUpsellUrl")&&(i.proPrintUpsellUrl=f[65].toObject(n.proPrintUpsellUrl,t)),n.starDataProto!==undefined&&n.starDataProto!==null&&n.hasOwnProperty("starDataProto")&&(i.starDataProto=f[66].toObject(n.starDataProto,t)),n.feedbackUrl!==undefined&&n.feedbackUrl!==null&&n.hasOwnProperty("feedbackUrl")&&(i.feedbackUrl=f[67].toObject(n.feedbackUrl,t)),n.oauth2LoginUrl!==undefined&&n.oauth2LoginUrl!==null&&n.hasOwnProperty("oauth2LoginUrl")&&(i.oauth2LoginUrl=f[68].toObject(n.oauth2LoginUrl,t)),i},e.prototype.toObject=function(n){return this.constructor.toObject(this,n)},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.SearchConfigProto=function(){function e(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}e.prototype.searchServer=i.emptyArray;e.prototype.oneboxService=i.emptyArray;e.prototype.kmlSearchUrl=null;e.prototype.kmlRenderUrl=null;e.prototype.searchHistoryUrl=null;e.prototype.errorPageUrl=null;var f={0:"keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer",1:"keyhole.dbroot.EndSnippetProto.SearchConfigProto.OneboxServiceProto",2:"keyhole.dbroot.StringIdOrValueProto",3:"keyhole.dbroot.StringIdOrValueProto",4:"keyhole.dbroot.StringIdOrValueProto",5:"keyhole.dbroot.StringIdOrValueProto"};return u.push(f),e.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.searchServer&&u.searchServer.length||(u.searchServer=[]);u.searchServer.push(f[0].decode(n,n.uint32()));break;case 2:u.oneboxService&&u.oneboxService.length||(u.oneboxService=[]);u.oneboxService.push(f[1].decode(n,n.uint32()));break;case 3:u.kmlSearchUrl=f[2].decode(n,n.uint32());break;case 4:u.kmlRenderUrl=f[3].decode(n,n.uint32());break;case 6:u.searchHistoryUrl=f[4].decode(n,n.uint32());break;case 5:u.errorPageUrl=f[5].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},e.verify=function(n){var i,t;if(typeof n!="object"||n===null)return"object expected";if(n.searchServer!==undefined){if(!Array.isArray(n.searchServer))return"searchServer: array expected";for(i=0;i<n.searchServer.length;++i)if(t=f[0].verify(n.searchServer[i]),t)return"searchServer."+t}if(n.oneboxService!==undefined){if(!Array.isArray(n.oneboxService))return"oneboxService: array expected";for(i=0;i<n.oneboxService.length;++i)if(t=f[1].verify(n.oneboxService[i]),t)return"oneboxService."+t}return n.kmlSearchUrl!==undefined&&n.kmlSearchUrl!==null&&(t=f[2].verify(n.kmlSearchUrl),t)?"kmlSearchUrl."+t:n.kmlRenderUrl!==undefined&&n.kmlRenderUrl!==null&&(t=f[3].verify(n.kmlRenderUrl),t)?"kmlRenderUrl."+t:n.searchHistoryUrl!==undefined&&n.searchHistoryUrl!==null&&(t=f[4].verify(n.searchHistoryUrl),t)?"searchHistoryUrl."+t:n.errorPageUrl!==undefined&&n.errorPageUrl!==null&&(t=f[5].verify(n.errorPageUrl),t)?"errorPageUrl."+t:null},e.fromObject=function(n){var r,i;if(n instanceof t.keyhole.dbroot.EndSnippetProto.SearchConfigProto)return n;if(r=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto,n.searchServer){if(!Array.isArray(n.searchServer))throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.searchServer: array expected");for(r.searchServer=[],i=0;i<n.searchServer.length;++i){if(typeof n.searchServer[i]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.searchServer: object expected");r.searchServer[i]=f[0].fromObject(n.searchServer[i])}}if(n.oneboxService){if(!Array.isArray(n.oneboxService))throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.oneboxService: array expected");for(r.oneboxService=[],i=0;i<n.oneboxService.length;++i){if(typeof n.oneboxService[i]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.oneboxService: object expected");r.oneboxService[i]=f[1].fromObject(n.oneboxService[i])}}if(n.kmlSearchUrl!==undefined&&n.kmlSearchUrl!==null){if(typeof n.kmlSearchUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.kmlSearchUrl: object expected");r.kmlSearchUrl=f[2].fromObject(n.kmlSearchUrl)}if(n.kmlRenderUrl!==undefined&&n.kmlRenderUrl!==null){if(typeof n.kmlRenderUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.kmlRenderUrl: object expected");r.kmlRenderUrl=f[3].fromObject(n.kmlRenderUrl)}if(n.searchHistoryUrl!==undefined&&n.searchHistoryUrl!==null){if(typeof n.searchHistoryUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.searchHistoryUrl: object expected");r.searchHistoryUrl=f[4].fromObject(n.searchHistoryUrl)}if(n.errorPageUrl!==undefined&&n.errorPageUrl!==null){if(typeof n.errorPageUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.errorPageUrl: object expected");r.errorPageUrl=f[5].fromObject(n.errorPageUrl)}return r},e.from=e.fromObject,e.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.searchServer=[],i.oneboxService=[]),t.defaults&&(i.kmlSearchUrl=null,i.kmlRenderUrl=null,i.searchHistoryUrl=null,i.errorPageUrl=null),n.searchServer!==undefined&&n.searchServer!==null&&n.hasOwnProperty("searchServer"))for(i.searchServer=[],r=0;r<n.searchServer.length;++r)i.searchServer[r]=f[0].toObject(n.searchServer[r],t);if(n.oneboxService!==undefined&&n.oneboxService!==null&&n.hasOwnProperty("oneboxService"))for(i.oneboxService=[],r=0;r<n.oneboxService.length;++r)i.oneboxService[r]=f[1].toObject(n.oneboxService[r],t);return n.kmlSearchUrl!==undefined&&n.kmlSearchUrl!==null&&n.hasOwnProperty("kmlSearchUrl")&&(i.kmlSearchUrl=f[2].toObject(n.kmlSearchUrl,t)),n.kmlRenderUrl!==undefined&&n.kmlRenderUrl!==null&&n.hasOwnProperty("kmlRenderUrl")&&(i.kmlRenderUrl=f[3].toObject(n.kmlRenderUrl,t)),n.searchHistoryUrl!==undefined&&n.searchHistoryUrl!==null&&n.hasOwnProperty("searchHistoryUrl")&&(i.searchHistoryUrl=f[4].toObject(n.searchHistoryUrl,t)),n.errorPageUrl!==undefined&&n.errorPageUrl!==null&&n.hasOwnProperty("errorPageUrl")&&(i.errorPageUrl=f[5].toObject(n.errorPageUrl,t)),i},e.prototype.toObject=function(n){return this.constructor.toObject(this,n)},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.SearchServer=function(){function e(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}e.prototype.name=null;e.prototype.url=null;e.prototype.type=0;e.prototype.htmlTransformUrl=null;e.prototype.kmlTransformUrl=null;e.prototype.supplementalUi=null;e.prototype.suggestion=i.emptyArray;e.prototype.searchlet=i.emptyArray;e.prototype.requirements=null;e.prototype.suggestServer=null;var f={0:"keyhole.dbroot.StringIdOrValueProto",1:"keyhole.dbroot.StringIdOrValueProto",2:"keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.ResultType",3:"keyhole.dbroot.StringIdOrValueProto",4:"keyhole.dbroot.StringIdOrValueProto",5:"keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SupplementalUi",6:"keyhole.dbroot.StringIdOrValueProto",7:"keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto",8:"keyhole.dbroot.RequirementProto",9:"keyhole.dbroot.StringIdOrValueProto"};return u.push(f),e.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.name=f[0].decode(n,n.uint32());break;case 2:u.url=f[1].decode(n,n.uint32());break;case 3:u.type=n.uint32();break;case 4:u.htmlTransformUrl=f[3].decode(n,n.uint32());break;case 5:u.kmlTransformUrl=f[4].decode(n,n.uint32());break;case 6:u.supplementalUi=f[5].decode(n,n.uint32());break;case 9:u.suggestion&&u.suggestion.length||(u.suggestion=[]);u.suggestion.push(f[6].decode(n,n.uint32()));break;case 7:u.searchlet&&u.searchlet.length||(u.searchlet=[]);u.searchlet.push(f[7].decode(n,n.uint32()));break;case 8:u.requirements=f[8].decode(n,n.uint32());break;case 10:u.suggestServer=f[9].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},e.verify=function(n){var i,t;if(typeof n!="object"||n===null)return"object expected";if(n.name!==undefined&&n.name!==null&&(t=f[0].verify(n.name),t))return"name."+t;if(n.url!==undefined&&n.url!==null&&(t=f[1].verify(n.url),t))return"url."+t;if(n.type!==undefined)switch(n.type){default:return"type: enum value expected";case 0:case 1:}if(n.htmlTransformUrl!==undefined&&n.htmlTransformUrl!==null&&(t=f[3].verify(n.htmlTransformUrl),t))return"htmlTransformUrl."+t;if(n.kmlTransformUrl!==undefined&&n.kmlTransformUrl!==null&&(t=f[4].verify(n.kmlTransformUrl),t))return"kmlTransformUrl."+t;if(n.supplementalUi!==undefined&&n.supplementalUi!==null&&(t=f[5].verify(n.supplementalUi),t))return"supplementalUi."+t;if(n.suggestion!==undefined){if(!Array.isArray(n.suggestion))return"suggestion: array expected";for(i=0;i<n.suggestion.length;++i)if(t=f[6].verify(n.suggestion[i]),t)return"suggestion."+t}if(n.searchlet!==undefined){if(!Array.isArray(n.searchlet))return"searchlet: array expected";for(i=0;i<n.searchlet.length;++i)if(t=f[7].verify(n.searchlet[i]),t)return"searchlet."+t}return n.requirements!==undefined&&n.requirements!==null&&(t=f[8].verify(n.requirements),t)?"requirements."+t:n.suggestServer!==undefined&&n.suggestServer!==null&&(t=f[9].verify(n.suggestServer),t)?"suggestServer."+t:null},e.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer)return n;if(i=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer,n.name!==undefined&&n.name!==null){if(typeof n.name!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.name: object expected");i.name=f[0].fromObject(n.name)}if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.url: object expected");i.url=f[1].fromObject(n.url)}switch(n.type){case"RESULT_TYPE_KML":case 0:i.type=0;break;case"RESULT_TYPE_XML":case 1:i.type=1}if(n.htmlTransformUrl!==undefined&&n.htmlTransformUrl!==null){if(typeof n.htmlTransformUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.htmlTransformUrl: object expected");i.htmlTransformUrl=f[3].fromObject(n.htmlTransformUrl)}if(n.kmlTransformUrl!==undefined&&n.kmlTransformUrl!==null){if(typeof n.kmlTransformUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.kmlTransformUrl: object expected");i.kmlTransformUrl=f[4].fromObject(n.kmlTransformUrl)}if(n.supplementalUi!==undefined&&n.supplementalUi!==null){if(typeof n.supplementalUi!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.supplementalUi: object expected");i.supplementalUi=f[5].fromObject(n.supplementalUi)}if(n.suggestion){if(!Array.isArray(n.suggestion))throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.suggestion: array expected");for(i.suggestion=[],r=0;r<n.suggestion.length;++r){if(typeof n.suggestion[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.suggestion: object expected");i.suggestion[r]=f[6].fromObject(n.suggestion[r])}}if(n.searchlet){if(!Array.isArray(n.searchlet))throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.searchlet: array expected");for(i.searchlet=[],r=0;r<n.searchlet.length;++r){if(typeof n.searchlet[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.searchlet: object expected");i.searchlet[r]=f[7].fromObject(n.searchlet[r])}}if(n.requirements!==undefined&&n.requirements!==null){if(typeof n.requirements!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.requirements: object expected");i.requirements=f[8].fromObject(n.requirements)}if(n.suggestServer!==undefined&&n.suggestServer!==null){if(typeof n.suggestServer!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.suggestServer: object expected");i.suggestServer=f[9].fromObject(n.suggestServer)}return i},e.from=e.fromObject,e.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.suggestion=[],i.searchlet=[]),t.defaults&&(i.name=null,i.url=null,i.type=t.enums===String?"RESULT_TYPE_KML":0,i.htmlTransformUrl=null,i.kmlTransformUrl=null,i.supplementalUi=null,i.requirements=null,i.suggestServer=null),n.name!==undefined&&n.name!==null&&n.hasOwnProperty("name")&&(i.name=f[0].toObject(n.name,t)),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=f[1].toObject(n.url,t)),n.type!==undefined&&n.type!==null&&n.hasOwnProperty("type")&&(i.type=t.enums===String?f[2][n.type]:n.type),n.htmlTransformUrl!==undefined&&n.htmlTransformUrl!==null&&n.hasOwnProperty("htmlTransformUrl")&&(i.htmlTransformUrl=f[3].toObject(n.htmlTransformUrl,t)),n.kmlTransformUrl!==undefined&&n.kmlTransformUrl!==null&&n.hasOwnProperty("kmlTransformUrl")&&(i.kmlTransformUrl=f[4].toObject(n.kmlTransformUrl,t)),n.supplementalUi!==undefined&&n.supplementalUi!==null&&n.hasOwnProperty("supplementalUi")&&(i.supplementalUi=f[5].toObject(n.supplementalUi,t)),n.suggestion!==undefined&&n.suggestion!==null&&n.hasOwnProperty("suggestion"))for(i.suggestion=[],r=0;r<n.suggestion.length;++r)i.suggestion[r]=f[6].toObject(n.suggestion[r],t);if(n.searchlet!==undefined&&n.searchlet!==null&&n.hasOwnProperty("searchlet"))for(i.searchlet=[],r=0;r<n.searchlet.length;++r)i.searchlet[r]=f[7].toObject(n.searchlet[r],t);return n.requirements!==undefined&&n.requirements!==null&&n.hasOwnProperty("requirements")&&(i.requirements=f[8].toObject(n.requirements,t)),n.suggestServer!==undefined&&n.suggestServer!==null&&n.hasOwnProperty("suggestServer")&&(i.suggestServer=f[9].toObject(n.suggestServer,t)),i},e.prototype.toObject=function(n){return this.constructor.toObject(this,n)},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.ResultType=function(){var n=Object.create({});return n.RESULT_TYPE_KML=0,n.RESULT_TYPE_XML=1,n}(),e.SupplementalUi=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.url=null;f.prototype.label=null;f.prototype.height=160;var e={0:"keyhole.dbroot.StringIdOrValueProto",1:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SupplementalUi;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.url=e[0].decode(n,n.uint32());break;case 2:u.label=e[1].decode(n,n.uint32());break;case 3:u.height=n.int32();break;default:n.skipType(f&7)}}return u},f.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":n.url!==undefined&&n.url!==null&&(t=e[0].verify(n.url),t)?"url."+t:n.label!==undefined&&n.label!==null&&(t=e[1].verify(n.label),t)?"label."+t:n.height!==undefined&&!i.isInteger(n.height)?"height: integer expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SupplementalUi)return n;var i=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SupplementalUi;if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SupplementalUi.url: object expected");i.url=e[0].fromObject(n.url)}if(n.label!==undefined&&n.label!==null){if(typeof n.label!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SupplementalUi.label: object expected");i.label=e[1].fromObject(n.label)}return n.height!==undefined&&n.height!==null&&(i.height=n.height|0),i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.url=null,i.label=null,i.height=160),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=e[0].toObject(n.url,t)),n.label!==undefined&&n.label!==null&&n.hasOwnProperty("label")&&(i.label=e[1].toObject(n.label,t)),n.height!==undefined&&n.height!==null&&n.hasOwnProperty("height")&&(i.height=n.height),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),e.SearchletProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.url=null;f.prototype.name=null;f.prototype.requirements=null;var i={0:"keyhole.dbroot.StringIdOrValueProto",1:"keyhole.dbroot.StringIdOrValueProto",2:"keyhole.dbroot.RequirementProto"};return u.push(i),f.decode=function(n,u){var o,f,e;for(n instanceof r||(n=r.create(n)),o=u===undefined?n.len:n.pos+u,f=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:f.url=i[0].decode(n,n.uint32());break;case 2:f.name=i[1].decode(n,n.uint32());break;case 3:f.requirements=i[2].decode(n,n.uint32());break;default:n.skipType(e&7)}}return f},f.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":n.url!==undefined&&n.url!==null&&(t=i[0].verify(n.url),t)?"url."+t:n.name!==undefined&&n.name!==null&&(t=i[1].verify(n.name),t)?"name."+t:n.requirements!==undefined&&n.requirements!==null&&(t=i[2].verify(n.requirements),t)?"requirements."+t:null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto)return n;var r=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto;if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto.url: object expected");r.url=i[0].fromObject(n.url)}if(n.name!==undefined&&n.name!==null){if(typeof n.name!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto.name: object expected");r.name=i[1].fromObject(n.name)}if(n.requirements!==undefined&&n.requirements!==null){if(typeof n.requirements!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.SearchServer.SearchletProto.requirements: object expected");r.requirements=i[2].fromObject(n.requirements)}return r},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var r={};return t.defaults&&(r.url=null,r.name=null,r.requirements=null),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(r.url=i[0].toObject(n.url,t)),n.name!==undefined&&n.name!==null&&n.hasOwnProperty("name")&&(r.name=i[1].toObject(n.name,t)),n.requirements!==undefined&&n.requirements!==null&&n.hasOwnProperty("requirements")&&(r.requirements=i[2].toObject(n.requirements,t)),r},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),e}(),e.OneboxServiceProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}i.prototype.serviceUrl=null;i.prototype.requirements=null;var f={0:"keyhole.dbroot.StringIdOrValueProto",1:"keyhole.dbroot.RequirementProto"};return u.push(f),i.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.OneboxServiceProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.serviceUrl=f[0].decode(n,n.uint32());break;case 2:u.requirements=f[1].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},i.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":n.serviceUrl!==undefined&&n.serviceUrl!==null&&(t=f[0].verify(n.serviceUrl),t)?"serviceUrl."+t:n.requirements!==undefined&&n.requirements!==null&&(t=f[1].verify(n.requirements),t)?"requirements."+t:null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.OneboxServiceProto)return n;var i=new t.keyhole.dbroot.EndSnippetProto.SearchConfigProto.OneboxServiceProto;if(n.serviceUrl!==undefined&&n.serviceUrl!==null){if(typeof n.serviceUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.OneboxServiceProto.serviceUrl: object expected");i.serviceUrl=f[0].fromObject(n.serviceUrl)}if(n.requirements!==undefined&&n.requirements!==null){if(typeof n.requirements!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.SearchConfigProto.OneboxServiceProto.requirements: object expected");i.requirements=f[1].fromObject(n.requirements)}return i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.serviceUrl=null,i.requirements=null),n.serviceUrl!==undefined&&n.serviceUrl!==null&&n.hasOwnProperty("serviceUrl")&&(i.serviceUrl=f[0].toObject(n.serviceUrl,t)),n.requirements!==undefined&&n.requirements!==null&&n.hasOwnProperty("requirements")&&(i.requirements=f[1].toObject(n.requirements,t)),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),e}(),e.SearchInfoProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.defaultUrl="http://maps.google.com/maps",u.prototype.geocodeParam="q",u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.SearchInfoProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.defaultUrl=n.string();break;case 2:u.geocodeParam=n.string();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":n.defaultUrl!==undefined&&!i.isString(n.defaultUrl)?"defaultUrl: string expected":n.geocodeParam!==undefined&&!i.isString(n.geocodeParam)?"geocodeParam: string expected":null},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.SearchInfoProto)return n;var i=new t.keyhole.dbroot.EndSnippetProto.SearchInfoProto;return n.defaultUrl!==undefined&&n.defaultUrl!==null&&(i.defaultUrl=String(n.defaultUrl)),n.geocodeParam!==undefined&&n.geocodeParam!==null&&(i.geocodeParam=String(n.geocodeParam)),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.defaultUrl="http://maps.google.com/maps",i.geocodeParam="q"),n.defaultUrl!==undefined&&n.defaultUrl!==null&&n.hasOwnProperty("defaultUrl")&&(i.defaultUrl=n.defaultUrl),n.geocodeParam!==undefined&&n.geocodeParam!==null&&n.hasOwnProperty("geocodeParam")&&(i.geocodeParam=n.geocodeParam),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),e.RockTreeDataProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}i.prototype.url=null;var f={0:"keyhole.dbroot.StringIdOrValueProto"};return u.push(f),i.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.RockTreeDataProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.url=f[0].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},i.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(n.url!==undefined&&n.url!==null){var t=f[0].verify(n.url);if(t)return"url."+t}return null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.RockTreeDataProto)return n;var i=new t.keyhole.dbroot.EndSnippetProto.RockTreeDataProto;if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.RockTreeDataProto.url: object expected");i.url=f[0].fromObject(n.url)}return i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.url=null),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=f[0].toObject(n.url,t)),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),e.FilmstripConfigProto=function(){function e(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}e.prototype.requirements=null;e.prototype.alleycatUrlTemplate=null;e.prototype.fallbackAlleycatUrlTemplate=null;e.prototype.metadataUrlTemplate=null;e.prototype.thumbnailUrlTemplate=null;e.prototype.kmlUrlTemplate=null;e.prototype.featuredToursUrl=null;e.prototype.enableViewportFallback=!1;e.prototype.viewportFallbackDistance=0;e.prototype.imageryType=i.emptyArray;var f={0:"keyhole.dbroot.RequirementProto",1:"keyhole.dbroot.StringIdOrValueProto",2:"keyhole.dbroot.StringIdOrValueProto",3:"keyhole.dbroot.StringIdOrValueProto",4:"keyhole.dbroot.StringIdOrValueProto",5:"keyhole.dbroot.StringIdOrValueProto",6:"keyhole.dbroot.StringIdOrValueProto",9:"keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto"};return u.push(f),e.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.FilmstripConfigProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.requirements=f[0].decode(n,n.uint32());break;case 2:u.alleycatUrlTemplate=f[1].decode(n,n.uint32());break;case 9:u.fallbackAlleycatUrlTemplate=f[2].decode(n,n.uint32());break;case 3:u.metadataUrlTemplate=f[3].decode(n,n.uint32());break;case 4:u.thumbnailUrlTemplate=f[4].decode(n,n.uint32());break;case 5:u.kmlUrlTemplate=f[5].decode(n,n.uint32());break;case 6:u.featuredToursUrl=f[6].decode(n,n.uint32());break;case 7:u.enableViewportFallback=n.bool();break;case 8:u.viewportFallbackDistance=n.uint32();break;case 10:u.imageryType&&u.imageryType.length||(u.imageryType=[]);u.imageryType.push(f[9].decode(n,n.uint32()));break;default:n.skipType(e&7)}}return u},e.verify=function(n){var r,t;if(typeof n!="object"||n===null)return"object expected";if(n.requirements!==undefined&&n.requirements!==null&&(t=f[0].verify(n.requirements),t))return"requirements."+t;if(n.alleycatUrlTemplate!==undefined&&n.alleycatUrlTemplate!==null&&(t=f[1].verify(n.alleycatUrlTemplate),t))return"alleycatUrlTemplate."+t;if(n.fallbackAlleycatUrlTemplate!==undefined&&n.fallbackAlleycatUrlTemplate!==null&&(t=f[2].verify(n.fallbackAlleycatUrlTemplate),t))return"fallbackAlleycatUrlTemplate."+t;if(n.metadataUrlTemplate!==undefined&&n.metadataUrlTemplate!==null&&(t=f[3].verify(n.metadataUrlTemplate),t))return"metadataUrlTemplate."+t;if(n.thumbnailUrlTemplate!==undefined&&n.thumbnailUrlTemplate!==null&&(t=f[4].verify(n.thumbnailUrlTemplate),t))return"thumbnailUrlTemplate."+t;if(n.kmlUrlTemplate!==undefined&&n.kmlUrlTemplate!==null&&(t=f[5].verify(n.kmlUrlTemplate),t))return"kmlUrlTemplate."+t;if(n.featuredToursUrl!==undefined&&n.featuredToursUrl!==null&&(t=f[6].verify(n.featuredToursUrl),t))return"featuredToursUrl."+t;if(n.enableViewportFallback!==undefined&&typeof n.enableViewportFallback!="boolean")return"enableViewportFallback: boolean expected";if(n.viewportFallbackDistance!==undefined&&!i.isInteger(n.viewportFallbackDistance))return"viewportFallbackDistance: integer expected";if(n.imageryType!==undefined){if(!Array.isArray(n.imageryType))return"imageryType: array expected";for(r=0;r<n.imageryType.length;++r)if(t=f[9].verify(n.imageryType[r]),t)return"imageryType."+t}return null},e.fromObject=function(n){var i,r;if(n instanceof t.keyhole.dbroot.EndSnippetProto.FilmstripConfigProto)return n;if(i=new t.keyhole.dbroot.EndSnippetProto.FilmstripConfigProto,n.requirements!==undefined&&n.requirements!==null){if(typeof n.requirements!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.requirements: object expected");i.requirements=f[0].fromObject(n.requirements)}if(n.alleycatUrlTemplate!==undefined&&n.alleycatUrlTemplate!==null){if(typeof n.alleycatUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.alleycatUrlTemplate: object expected");i.alleycatUrlTemplate=f[1].fromObject(n.alleycatUrlTemplate)}if(n.fallbackAlleycatUrlTemplate!==undefined&&n.fallbackAlleycatUrlTemplate!==null){if(typeof n.fallbackAlleycatUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.fallbackAlleycatUrlTemplate: object expected");i.fallbackAlleycatUrlTemplate=f[2].fromObject(n.fallbackAlleycatUrlTemplate)}if(n.metadataUrlTemplate!==undefined&&n.metadataUrlTemplate!==null){if(typeof n.metadataUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.metadataUrlTemplate: object expected");i.metadataUrlTemplate=f[3].fromObject(n.metadataUrlTemplate)}if(n.thumbnailUrlTemplate!==undefined&&n.thumbnailUrlTemplate!==null){if(typeof n.thumbnailUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.thumbnailUrlTemplate: object expected");i.thumbnailUrlTemplate=f[4].fromObject(n.thumbnailUrlTemplate)}if(n.kmlUrlTemplate!==undefined&&n.kmlUrlTemplate!==null){if(typeof n.kmlUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.kmlUrlTemplate: object expected");i.kmlUrlTemplate=f[5].fromObject(n.kmlUrlTemplate)}if(n.featuredToursUrl!==undefined&&n.featuredToursUrl!==null){if(typeof n.featuredToursUrl!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.featuredToursUrl: object expected");i.featuredToursUrl=f[6].fromObject(n.featuredToursUrl)}if(n.enableViewportFallback!==undefined&&n.enableViewportFallback!==null&&(i.enableViewportFallback=Boolean(n.enableViewportFallback)),n.viewportFallbackDistance!==undefined&&n.viewportFallbackDistance!==null&&(i.viewportFallbackDistance=n.viewportFallbackDistance>>>0),n.imageryType){if(!Array.isArray(n.imageryType))throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.imageryType: array expected");for(i.imageryType=[],r=0;r<n.imageryType.length;++r){if(typeof n.imageryType[r]!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.imageryType: object expected");i.imageryType[r]=f[9].fromObject(n.imageryType[r])}}return i},e.from=e.fromObject,e.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.imageryType=[]),t.defaults&&(i.requirements=null,i.alleycatUrlTemplate=null,i.fallbackAlleycatUrlTemplate=null,i.metadataUrlTemplate=null,i.thumbnailUrlTemplate=null,i.kmlUrlTemplate=null,i.featuredToursUrl=null,i.enableViewportFallback=!1,i.viewportFallbackDistance=0),n.requirements!==undefined&&n.requirements!==null&&n.hasOwnProperty("requirements")&&(i.requirements=f[0].toObject(n.requirements,t)),n.alleycatUrlTemplate!==undefined&&n.alleycatUrlTemplate!==null&&n.hasOwnProperty("alleycatUrlTemplate")&&(i.alleycatUrlTemplate=f[1].toObject(n.alleycatUrlTemplate,t)),n.fallbackAlleycatUrlTemplate!==undefined&&n.fallbackAlleycatUrlTemplate!==null&&n.hasOwnProperty("fallbackAlleycatUrlTemplate")&&(i.fallbackAlleycatUrlTemplate=f[2].toObject(n.fallbackAlleycatUrlTemplate,t)),n.metadataUrlTemplate!==undefined&&n.metadataUrlTemplate!==null&&n.hasOwnProperty("metadataUrlTemplate")&&(i.metadataUrlTemplate=f[3].toObject(n.metadataUrlTemplate,t)),n.thumbnailUrlTemplate!==undefined&&n.thumbnailUrlTemplate!==null&&n.hasOwnProperty("thumbnailUrlTemplate")&&(i.thumbnailUrlTemplate=f[4].toObject(n.thumbnailUrlTemplate,t)),n.kmlUrlTemplate!==undefined&&n.kmlUrlTemplate!==null&&n.hasOwnProperty("kmlUrlTemplate")&&(i.kmlUrlTemplate=f[5].toObject(n.kmlUrlTemplate,t)),n.featuredToursUrl!==undefined&&n.featuredToursUrl!==null&&n.hasOwnProperty("featuredToursUrl")&&(i.featuredToursUrl=f[6].toObject(n.featuredToursUrl,t)),n.enableViewportFallback!==undefined&&n.enableViewportFallback!==null&&n.hasOwnProperty("enableViewportFallback")&&(i.enableViewportFallback=n.enableViewportFallback),n.viewportFallbackDistance!==undefined&&n.viewportFallbackDistance!==null&&n.hasOwnProperty("viewportFallbackDistance")&&(i.viewportFallbackDistance=n.viewportFallbackDistance),n.imageryType!==undefined&&n.imageryType!==null&&n.hasOwnProperty("imageryType"))for(i.imageryType=[],r=0;r<n.imageryType.length;++r)i.imageryType[r]=f[9].toObject(n.imageryType[r],t);return i},e.prototype.toObject=function(n){return this.constructor.toObject(this,n)},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e.AlleycatImageryTypeProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.imageryTypeId=0;f.prototype.imageryTypeLabel="";f.prototype.metadataUrlTemplate=null;f.prototype.thumbnailUrlTemplate=null;f.prototype.kmlUrlTemplate=null;var e={2:"keyhole.dbroot.StringIdOrValueProto",3:"keyhole.dbroot.StringIdOrValueProto",4:"keyhole.dbroot.StringIdOrValueProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 1:u.imageryTypeId=n.int32();break;case 2:u.imageryTypeLabel=n.string();break;case 3:u.metadataUrlTemplate=e[2].decode(n,n.uint32());break;case 4:u.thumbnailUrlTemplate=e[3].decode(n,n.uint32());break;case 5:u.kmlUrlTemplate=e[4].decode(n,n.uint32());break;default:n.skipType(f&7)}}return u},f.verify=function(n){var t;return typeof n!="object"||n===null?"object expected":n.imageryTypeId!==undefined&&!i.isInteger(n.imageryTypeId)?"imageryTypeId: integer expected":n.imageryTypeLabel!==undefined&&!i.isString(n.imageryTypeLabel)?"imageryTypeLabel: string expected":n.metadataUrlTemplate!==undefined&&n.metadataUrlTemplate!==null&&(t=e[2].verify(n.metadataUrlTemplate),t)?"metadataUrlTemplate."+t:n.thumbnailUrlTemplate!==undefined&&n.thumbnailUrlTemplate!==null&&(t=e[3].verify(n.thumbnailUrlTemplate),t)?"thumbnailUrlTemplate."+t:n.kmlUrlTemplate!==undefined&&n.kmlUrlTemplate!==null&&(t=e[4].verify(n.kmlUrlTemplate),t)?"kmlUrlTemplate."+t:null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto)return n;var i=new t.keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto;if(n.imageryTypeId!==undefined&&n.imageryTypeId!==null&&(i.imageryTypeId=n.imageryTypeId|0),n.imageryTypeLabel!==undefined&&n.imageryTypeLabel!==null&&(i.imageryTypeLabel=String(n.imageryTypeLabel)),n.metadataUrlTemplate!==undefined&&n.metadataUrlTemplate!==null){if(typeof n.metadataUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto.metadataUrlTemplate: object expected");i.metadataUrlTemplate=e[2].fromObject(n.metadataUrlTemplate)}if(n.thumbnailUrlTemplate!==undefined&&n.thumbnailUrlTemplate!==null){if(typeof n.thumbnailUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto.thumbnailUrlTemplate: object expected");i.thumbnailUrlTemplate=e[3].fromObject(n.thumbnailUrlTemplate)}if(n.kmlUrlTemplate!==undefined&&n.kmlUrlTemplate!==null){if(typeof n.kmlUrlTemplate!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.FilmstripConfigProto.AlleycatImageryTypeProto.kmlUrlTemplate: object expected");i.kmlUrlTemplate=e[4].fromObject(n.kmlUrlTemplate)}return i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.imageryTypeId=0,i.imageryTypeLabel="",i.metadataUrlTemplate=null,i.thumbnailUrlTemplate=null,i.kmlUrlTemplate=null),n.imageryTypeId!==undefined&&n.imageryTypeId!==null&&n.hasOwnProperty("imageryTypeId")&&(i.imageryTypeId=n.imageryTypeId),n.imageryTypeLabel!==undefined&&n.imageryTypeLabel!==null&&n.hasOwnProperty("imageryTypeLabel")&&(i.imageryTypeLabel=n.imageryTypeLabel),n.metadataUrlTemplate!==undefined&&n.metadataUrlTemplate!==null&&n.hasOwnProperty("metadataUrlTemplate")&&(i.metadataUrlTemplate=e[2].toObject(n.metadataUrlTemplate,t)),n.thumbnailUrlTemplate!==undefined&&n.thumbnailUrlTemplate!==null&&n.hasOwnProperty("thumbnailUrlTemplate")&&(i.thumbnailUrlTemplate=e[3].toObject(n.thumbnailUrlTemplate,t)),n.kmlUrlTemplate!==undefined&&n.kmlUrlTemplate!==null&&n.hasOwnProperty("kmlUrlTemplate")&&(i.kmlUrlTemplate=e[4].toObject(n.kmlUrlTemplate,t)),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),e}(),e.StarDataProto=function(){function i(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}i.prototype.url=null;var f={0:"keyhole.dbroot.StringIdOrValueProto"};return u.push(f),i.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EndSnippetProto.StarDataProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 1:u.url=f[0].decode(n,n.uint32());break;default:n.skipType(e&7)}}return u},i.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(n.url!==undefined&&n.url!==null){var t=f[0].verify(n.url);if(t)return"url."+t}return null},i.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EndSnippetProto.StarDataProto)return n;var i=new t.keyhole.dbroot.EndSnippetProto.StarDataProto;if(n.url!==undefined&&n.url!==null){if(typeof n.url!="object")throw TypeError(".keyhole.dbroot.EndSnippetProto.StarDataProto.url: object expected");i.url=f[0].fromObject(n.url)}return i},i.from=i.fromObject,i.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.url=null),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=f[0].toObject(n.url,t)),i},i.prototype.toObject=function(n){return this.constructor.toObject(this,n)},i.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},i}(),e}(),f.DbRootRefProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.url="";f.prototype.isCritical=!1;f.prototype.requirements=null;var e={2:"keyhole.dbroot.RequirementProto"};return u.push(e),f.decode=function(n,i){var o,u,f;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.DbRootRefProto;n.pos<o;){f=n.uint32();switch(f>>>3){case 2:u.url=n.string();break;case 1:u.isCritical=n.bool();break;case 3:u.requirements=e[2].decode(n,n.uint32());break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(!i.isString(n.url))return"url: string expected";if(n.isCritical!==undefined&&typeof n.isCritical!="boolean")return"isCritical: boolean expected";if(n.requirements!==undefined&&n.requirements!==null){var t=e[2].verify(n.requirements);if(t)return"requirements."+t}return null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.DbRootRefProto)return n;var i=new t.keyhole.dbroot.DbRootRefProto;if(n.url!==undefined&&n.url!==null&&(i.url=String(n.url)),n.isCritical!==undefined&&n.isCritical!==null&&(i.isCritical=Boolean(n.isCritical)),n.requirements!==undefined&&n.requirements!==null){if(typeof n.requirements!="object")throw TypeError(".keyhole.dbroot.DbRootRefProto.requirements: object expected");i.requirements=e[2].fromObject(n.requirements)}return i},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.url="",i.isCritical=!1,i.requirements=null),n.url!==undefined&&n.url!==null&&n.hasOwnProperty("url")&&(i.url=n.url),n.isCritical!==undefined&&n.isCritical!==null&&n.hasOwnProperty("isCritical")&&(i.isCritical=n.isCritical),n.requirements!==undefined&&n.requirements!==null&&n.hasOwnProperty("requirements")&&(i.requirements=e[2].toObject(n.requirements,t)),i},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f}(),f.DatabaseVersionProto=function(){function u(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}return u.prototype.quadtreeVersion=0,u.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.DatabaseVersionProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.quadtreeVersion=n.uint32();break;default:n.skipType(f&7)}}return u},u.verify=function(n){return typeof n!="object"||n===null?"object expected":i.isInteger(n.quadtreeVersion)?null:"quadtreeVersion: integer expected"},u.fromObject=function(n){if(n instanceof t.keyhole.dbroot.DatabaseVersionProto)return n;var i=new t.keyhole.dbroot.DatabaseVersionProto;return n.quadtreeVersion!==undefined&&n.quadtreeVersion!==null&&(i.quadtreeVersion=n.quadtreeVersion>>>0),i},u.from=u.fromObject,u.toObject=function(n,t){t||(t={});var i={};return t.defaults&&(i.quadtreeVersion=0),n.quadtreeVersion!==undefined&&n.quadtreeVersion!==null&&n.hasOwnProperty("quadtreeVersion")&&(i.quadtreeVersion=n.quadtreeVersion),i},u.prototype.toObject=function(n){return this.constructor.toObject(this,n)},u.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},u}(),f.DbRootProto=function(){function e(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}e.prototype.databaseName=null;e.prototype.imageryPresent=!0;e.prototype.protoImagery=!1;e.prototype.terrainPresent=!1;e.prototype.providerInfo=i.emptyArray;e.prototype.nestedFeature=i.emptyArray;e.prototype.styleAttribute=i.emptyArray;e.prototype.styleMap=i.emptyArray;e.prototype.endSnippet=null;e.prototype.translationEntry=i.emptyArray;e.prototype.language="en";e.prototype.version=5;e.prototype.dbrootReference=i.emptyArray;e.prototype.databaseVersion=null;e.prototype.refreshTimeout=0;var f={0:"keyhole.dbroot.StringIdOrValueProto",4:"keyhole.dbroot.ProviderInfoProto",5:"keyhole.dbroot.NestedFeatureProto",6:"keyhole.dbroot.StyleAttributeProto",7:"keyhole.dbroot.StyleMapProto",8:"keyhole.dbroot.EndSnippetProto",9:"keyhole.dbroot.StringEntryProto",12:"keyhole.dbroot.DbRootRefProto",13:"keyhole.dbroot.DatabaseVersionProto"};return u.push(f),e.decode=function(n,i){var o,u,e;for(n instanceof r||(n=r.create(n)),o=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.DbRootProto;n.pos<o;){e=n.uint32();switch(e>>>3){case 15:u.databaseName=f[0].decode(n,n.uint32());break;case 1:u.imageryPresent=n.bool();break;case 14:u.protoImagery=n.bool();break;case 2:u.terrainPresent=n.bool();break;case 3:u.providerInfo&&u.providerInfo.length||(u.providerInfo=[]);u.providerInfo.push(f[4].decode(n,n.uint32()));break;case 4:u.nestedFeature&&u.nestedFeature.length||(u.nestedFeature=[]);u.nestedFeature.push(f[5].decode(n,n.uint32()));break;case 5:u.styleAttribute&&u.styleAttribute.length||(u.styleAttribute=[]);u.styleAttribute.push(f[6].decode(n,n.uint32()));break;case 6:u.styleMap&&u.styleMap.length||(u.styleMap=[]);u.styleMap.push(f[7].decode(n,n.uint32()));break;case 7:u.endSnippet=f[8].decode(n,n.uint32());break;case 8:u.translationEntry&&u.translationEntry.length||(u.translationEntry=[]);u.translationEntry.push(f[9].decode(n,n.uint32()));break;case 9:u.language=n.string();break;case 10:u.version=n.int32();break;case 11:u.dbrootReference&&u.dbrootReference.length||(u.dbrootReference=[]);u.dbrootReference.push(f[12].decode(n,n.uint32()));break;case 13:u.databaseVersion=f[13].decode(n,n.uint32());break;case 16:u.refreshTimeout=n.int32();break;default:n.skipType(e&7)}}return u},e.verify=function(n){var r,t;if(typeof n!="object"||n===null)return"object expected";if(n.databaseName!==undefined&&n.databaseName!==null&&(t=f[0].verify(n.databaseName),t))return"databaseName."+t;if(n.imageryPresent!==undefined&&typeof n.imageryPresent!="boolean")return"imageryPresent: boolean expected";if(n.protoImagery!==undefined&&typeof n.protoImagery!="boolean")return"protoImagery: boolean expected";if(n.terrainPresent!==undefined&&typeof n.terrainPresent!="boolean")return"terrainPresent: boolean expected";if(n.providerInfo!==undefined){if(!Array.isArray(n.providerInfo))return"providerInfo: array expected";for(r=0;r<n.providerInfo.length;++r)if(t=f[4].verify(n.providerInfo[r]),t)return"providerInfo."+t}if(n.nestedFeature!==undefined){if(!Array.isArray(n.nestedFeature))return"nestedFeature: array expected";for(r=0;r<n.nestedFeature.length;++r)if(t=f[5].verify(n.nestedFeature[r]),t)return"nestedFeature."+t}if(n.styleAttribute!==undefined){if(!Array.isArray(n.styleAttribute))return"styleAttribute: array expected";for(r=0;r<n.styleAttribute.length;++r)if(t=f[6].verify(n.styleAttribute[r]),t)return"styleAttribute."+t}if(n.styleMap!==undefined){if(!Array.isArray(n.styleMap))return"styleMap: array expected";for(r=0;r<n.styleMap.length;++r)if(t=f[7].verify(n.styleMap[r]),t)return"styleMap."+t}if(n.endSnippet!==undefined&&n.endSnippet!==null&&(t=f[8].verify(n.endSnippet),t))return"endSnippet."+t;if(n.translationEntry!==undefined){if(!Array.isArray(n.translationEntry))return"translationEntry: array expected";for(r=0;r<n.translationEntry.length;++r)if(t=f[9].verify(n.translationEntry[r]),t)return"translationEntry."+t}if(n.language!==undefined&&!i.isString(n.language))return"language: string expected";if(n.version!==undefined&&!i.isInteger(n.version))return"version: integer expected";if(n.dbrootReference!==undefined){if(!Array.isArray(n.dbrootReference))return"dbrootReference: array expected";for(r=0;r<n.dbrootReference.length;++r)if(t=f[12].verify(n.dbrootReference[r]),t)return"dbrootReference."+t}return n.databaseVersion!==undefined&&n.databaseVersion!==null&&(t=f[13].verify(n.databaseVersion),t)?"databaseVersion."+t:n.refreshTimeout!==undefined&&!i.isInteger(n.refreshTimeout)?"refreshTimeout: integer expected":null},e.fromObject=function(n){var r,i;if(n instanceof t.keyhole.dbroot.DbRootProto)return n;if(r=new t.keyhole.dbroot.DbRootProto,n.databaseName!==undefined&&n.databaseName!==null){if(typeof n.databaseName!="object")throw TypeError(".keyhole.dbroot.DbRootProto.databaseName: object expected");r.databaseName=f[0].fromObject(n.databaseName)}if(n.imageryPresent!==undefined&&n.imageryPresent!==null&&(r.imageryPresent=Boolean(n.imageryPresent)),n.protoImagery!==undefined&&n.protoImagery!==null&&(r.protoImagery=Boolean(n.protoImagery)),n.terrainPresent!==undefined&&n.terrainPresent!==null&&(r.terrainPresent=Boolean(n.terrainPresent)),n.providerInfo){if(!Array.isArray(n.providerInfo))throw TypeError(".keyhole.dbroot.DbRootProto.providerInfo: array expected");for(r.providerInfo=[],i=0;i<n.providerInfo.length;++i){if(typeof n.providerInfo[i]!="object")throw TypeError(".keyhole.dbroot.DbRootProto.providerInfo: object expected");r.providerInfo[i]=f[4].fromObject(n.providerInfo[i])}}if(n.nestedFeature){if(!Array.isArray(n.nestedFeature))throw TypeError(".keyhole.dbroot.DbRootProto.nestedFeature: array expected");for(r.nestedFeature=[],i=0;i<n.nestedFeature.length;++i){if(typeof n.nestedFeature[i]!="object")throw TypeError(".keyhole.dbroot.DbRootProto.nestedFeature: object expected");r.nestedFeature[i]=f[5].fromObject(n.nestedFeature[i])}}if(n.styleAttribute){if(!Array.isArray(n.styleAttribute))throw TypeError(".keyhole.dbroot.DbRootProto.styleAttribute: array expected");for(r.styleAttribute=[],i=0;i<n.styleAttribute.length;++i){if(typeof n.styleAttribute[i]!="object")throw TypeError(".keyhole.dbroot.DbRootProto.styleAttribute: object expected");r.styleAttribute[i]=f[6].fromObject(n.styleAttribute[i])}}if(n.styleMap){if(!Array.isArray(n.styleMap))throw TypeError(".keyhole.dbroot.DbRootProto.styleMap: array expected");for(r.styleMap=[],i=0;i<n.styleMap.length;++i){if(typeof n.styleMap[i]!="object")throw TypeError(".keyhole.dbroot.DbRootProto.styleMap: object expected");r.styleMap[i]=f[7].fromObject(n.styleMap[i])}}if(n.endSnippet!==undefined&&n.endSnippet!==null){if(typeof n.endSnippet!="object")throw TypeError(".keyhole.dbroot.DbRootProto.endSnippet: object expected");r.endSnippet=f[8].fromObject(n.endSnippet)}if(n.translationEntry){if(!Array.isArray(n.translationEntry))throw TypeError(".keyhole.dbroot.DbRootProto.translationEntry: array expected");for(r.translationEntry=[],i=0;i<n.translationEntry.length;++i){if(typeof n.translationEntry[i]!="object")throw TypeError(".keyhole.dbroot.DbRootProto.translationEntry: object expected");r.translationEntry[i]=f[9].fromObject(n.translationEntry[i])}}if(n.language!==undefined&&n.language!==null&&(r.language=String(n.language)),n.version!==undefined&&n.version!==null&&(r.version=n.version|0),n.dbrootReference){if(!Array.isArray(n.dbrootReference))throw TypeError(".keyhole.dbroot.DbRootProto.dbrootReference: array expected");for(r.dbrootReference=[],i=0;i<n.dbrootReference.length;++i){if(typeof n.dbrootReference[i]!="object")throw TypeError(".keyhole.dbroot.DbRootProto.dbrootReference: object expected");r.dbrootReference[i]=f[12].fromObject(n.dbrootReference[i])}}if(n.databaseVersion!==undefined&&n.databaseVersion!==null){if(typeof n.databaseVersion!="object")throw TypeError(".keyhole.dbroot.DbRootProto.databaseVersion: object expected");r.databaseVersion=f[13].fromObject(n.databaseVersion)}return n.refreshTimeout!==undefined&&n.refreshTimeout!==null&&(r.refreshTimeout=n.refreshTimeout|0),r},e.from=e.fromObject,e.toObject=function(n,t){var i,r;if(t||(t={}),i={},(t.arrays||t.defaults)&&(i.providerInfo=[],i.nestedFeature=[],i.styleAttribute=[],i.styleMap=[],i.translationEntry=[],i.dbrootReference=[]),t.defaults&&(i.databaseName=null,i.imageryPresent=!0,i.protoImagery=!1,i.terrainPresent=!1,i.endSnippet=null,i.language="en",i.version=5,i.databaseVersion=null,i.refreshTimeout=0),n.databaseName!==undefined&&n.databaseName!==null&&n.hasOwnProperty("databaseName")&&(i.databaseName=f[0].toObject(n.databaseName,t)),n.imageryPresent!==undefined&&n.imageryPresent!==null&&n.hasOwnProperty("imageryPresent")&&(i.imageryPresent=n.imageryPresent),n.protoImagery!==undefined&&n.protoImagery!==null&&n.hasOwnProperty("protoImagery")&&(i.protoImagery=n.protoImagery),n.terrainPresent!==undefined&&n.terrainPresent!==null&&n.hasOwnProperty("terrainPresent")&&(i.terrainPresent=n.terrainPresent),n.providerInfo!==undefined&&n.providerInfo!==null&&n.hasOwnProperty("providerInfo"))for(i.providerInfo=[],r=0;r<n.providerInfo.length;++r)i.providerInfo[r]=f[4].toObject(n.providerInfo[r],t);if(n.nestedFeature!==undefined&&n.nestedFeature!==null&&n.hasOwnProperty("nestedFeature"))for(i.nestedFeature=[],r=0;r<n.nestedFeature.length;++r)i.nestedFeature[r]=f[5].toObject(n.nestedFeature[r],t);if(n.styleAttribute!==undefined&&n.styleAttribute!==null&&n.hasOwnProperty("styleAttribute"))for(i.styleAttribute=[],r=0;r<n.styleAttribute.length;++r)i.styleAttribute[r]=f[6].toObject(n.styleAttribute[r],t);if(n.styleMap!==undefined&&n.styleMap!==null&&n.hasOwnProperty("styleMap"))for(i.styleMap=[],r=0;r<n.styleMap.length;++r)i.styleMap[r]=f[7].toObject(n.styleMap[r],t);if(n.endSnippet!==undefined&&n.endSnippet!==null&&n.hasOwnProperty("endSnippet")&&(i.endSnippet=f[8].toObject(n.endSnippet,t)),n.translationEntry!==undefined&&n.translationEntry!==null&&n.hasOwnProperty("translationEntry"))for(i.translationEntry=[],r=0;r<n.translationEntry.length;++r)i.translationEntry[r]=f[9].toObject(n.translationEntry[r],t);if(n.language!==undefined&&n.language!==null&&n.hasOwnProperty("language")&&(i.language=n.language),n.version!==undefined&&n.version!==null&&n.hasOwnProperty("version")&&(i.version=n.version),n.dbrootReference!==undefined&&n.dbrootReference!==null&&n.hasOwnProperty("dbrootReference"))for(i.dbrootReference=[],r=0;r<n.dbrootReference.length;++r)i.dbrootReference[r]=f[12].toObject(n.dbrootReference[r],t);return n.databaseVersion!==undefined&&n.databaseVersion!==null&&n.hasOwnProperty("databaseVersion")&&(i.databaseVersion=f[13].toObject(n.databaseVersion,t)),n.refreshTimeout!==undefined&&n.refreshTimeout!==null&&n.hasOwnProperty("refreshTimeout")&&(i.refreshTimeout=n.refreshTimeout),i},e.prototype.toObject=function(n){return this.constructor.toObject(this,n)},e.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},e}(),f.EncryptedDbRootProto=function(){function f(n){if(n)for(var i=Object.keys(n),t=0;t<i.length;++t)this[i[t]]=n[i[t]]}f.prototype.encryptionType=0;f.prototype.encryptionData=i.newBuffer([]);f.prototype.dbrootData=i.newBuffer([]);var e={0:"keyhole.dbroot.EncryptedDbRootProto.EncryptionType"};return u.push(e),f.decode=function(n,i){var e,u,f;for(n instanceof r||(n=r.create(n)),e=i===undefined?n.len:n.pos+i,u=new t.keyhole.dbroot.EncryptedDbRootProto;n.pos<e;){f=n.uint32();switch(f>>>3){case 1:u.encryptionType=n.uint32();break;case 2:u.encryptionData=n.bytes();break;case 3:u.dbrootData=n.bytes();break;default:n.skipType(f&7)}}return u},f.verify=function(n){if(typeof n!="object"||n===null)return"object expected";if(n.encryptionType!==undefined)switch(n.encryptionType){default:return"encryptionType: enum value expected";case 0:}return n.encryptionData!==undefined&&!(n.encryptionData&&typeof n.encryptionData.length=="number"||i.isString(n.encryptionData))?"encryptionData: buffer expected":n.dbrootData!==undefined&&!(n.dbrootData&&typeof n.dbrootData.length=="number"||i.isString(n.dbrootData))?"dbrootData: buffer expected":null},f.fromObject=function(n){if(n instanceof t.keyhole.dbroot.EncryptedDbRootProto)return n;var r=new t.keyhole.dbroot.EncryptedDbRootProto;switch(n.encryptionType){case"ENCRYPTION_XOR":case 0:r.encryptionType=0}return n.encryptionData!==undefined&&n.encryptionData!==null&&(typeof n.encryptionData=="string"?i.base64.decode(n.encryptionData,r.encryptionData=i.newBuffer(i.base64.length(n.encryptionData)),0):n.encryptionData.length&&(r.encryptionData=n.encryptionData)),n.dbrootData!==undefined&&n.dbrootData!==null&&(typeof n.dbrootData=="string"?i.base64.decode(n.dbrootData,r.dbrootData=i.newBuffer(i.base64.length(n.dbrootData)),0):n.dbrootData.length&&(r.dbrootData=n.dbrootData)),r},f.from=f.fromObject,f.toObject=function(n,t){t||(t={});var r={};return t.defaults&&(r.encryptionType=t.enums===String?"ENCRYPTION_XOR":0,r.encryptionData=t.bytes===String?"":[],r.dbrootData=t.bytes===String?"":[]),n.encryptionType!==undefined&&n.encryptionType!==null&&n.hasOwnProperty("encryptionType")&&(r.encryptionType=t.enums===String?e[0][n.encryptionType]:n.encryptionType),n.encryptionData!==undefined&&n.encryptionData!==null&&n.hasOwnProperty("encryptionData")&&(r.encryptionData=t.bytes===String?i.base64.encode(n.encryptionData,0,n.encryptionData.length):t.bytes===Array?Array.prototype.slice.call(n.encryptionData):n.encryptionData),n.dbrootData!==undefined&&n.dbrootData!==null&&n.hasOwnProperty("dbrootData")&&(r.dbrootData=t.bytes===String?i.base64.encode(n.dbrootData,0,n.dbrootData.length):t.bytes===Array?Array.prototype.slice.call(n.dbrootData):n.dbrootData),r},f.prototype.toObject=function(n){return this.constructor.toObject(this,n)},f.prototype.toJSON=function(){return this.constructor.toObject(this,n.util.toJSONOptions)},f.EncryptionType=function(){var n=Object.create({});return n.ENCRYPTION_XOR=0,n}(),f}(),f}(),f}(),i.lazyResolve(t,u),t.keyhole.dbroot});t("Core/isBitSet",[],function(){"use strict";function n(n,t){return(n&t)!=0}return n});t("Core/GoogleEarthEnterpriseTileInformation",["./defined","./isBitSet"],function(n,t){"use strict";function i(n,t,i,r,u,f){this._bits=n;this.cnodeVersion=t;this.imageryVersion=i;this.terrainVersion=r;this.imageryProvider=u;this.terrainProvider=f;this.ancestorHasTerrain=!1;this.terrainState=undefined}var u=[1,2,4,8],r=15,f=16,e=64,o=128;return i.clone=function(t,r){return n(r)?(r._bits=t._bits,r.cnodeVersion=t.cnodeVersion,r.imageryVersion=t.imageryVersion,r.terrainVersion=t.terrainVersion,r.imageryProvider=t.imageryProvider,r.terrainProvider=t.terrainProvider):r=new i(t._bits,t.cnodeVersion,t.imageryVersion,t.terrainVersion,t.imageryProvider,t.terrainProvider),r.ancestorHasTerrain=t.ancestorHasTerrain,r.terrainState=t.terrainState,r},i.prototype.setParent=function(n){this.ancestorHasTerrain=n.ancestorHasTerrain||this.hasTerrain()},i.prototype.hasSubtree=function(){return t(this._bits,f)},i.prototype.hasImagery=function(){return t(this._bits,e)},i.prototype.hasTerrain=function(){return t(this._bits,o)},i.prototype.hasChildren=function(){return t(this._bits,r)},i.prototype.hasChild=function(n){return t(this._bits,u[n])},i.prototype.getChildBitmask=function(){return this._bits&r},i});t("Core/GoogleEarthEnterpriseMetadata",["../ThirdParty/google-earth-dbroot-parser","../ThirdParty/when","./Check","./Credit","./defaultValue","./defined","./defineProperties","./GoogleEarthEnterpriseTileInformation","./isBitSet","./Math","./Request","./Resource","./RuntimeError","./TaskProcessor"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function k(n){for(var i=n.length,r=new ArrayBuffer(i),u=new Uint8Array(r),t=0;t<i;++t)u[t]=n.charCodeAt(t);return r}function y(n){var r,f,u;i.defined("resourceOrUrl",n);r=n;typeof r=="string"||r instanceof l||(i.typeOf.string("resourceOrUrl.url",n.url),r=n.url);f=l.createIfNeeded(r);f.appendForwardSlash();this._resource=f;this.imageryPresent=!0;this.protoImagery=undefined;this.terrainPresent=!0;this.negativeAltitudeExponentBias=32;this.negativeAltitudeThreshold=h.EPSILON12;this.providers={};this.key=undefined;this._quadPacketVersion=1;this._tileInfo={};this._subtreePromises={};u=this;this._readyPromise=g(this).then(function(){return u.getQuadTreePacket("",u._quadPacketVersion)}).then(function(){return!0}).otherwise(function(){var n="An error occurred while accessing "+b(u,"",1).url+".";return t.reject(new a(n))})}function w(n,i,r){var l=n._tileInfo,u=i,e=l[u],s,h,o;if(f(e)&&(!e.hasSubtree()||e.hasChildren()))return e;while(e===undefined&&u.length>1)u=u.substring(0,u.length-1),e=l[u];return(h=n._subtreePromises,o=h[u],f(o))?o.then(function(){return s=new c({throttle:r.throttle,throttleByServer:r.throttleByServer,type:r.type,priorityFunction:r.priorityFunction}),w(n,i,s)}):!f(e)||!e.hasSubtree()?t.reject(new a("Couldn't load metadata for tile "+i)):(o=n.getQuadTreePacket(u,e.cnodeVersion,r),!f(o))?undefined:(h[u]=o,o.then(function(){return s=new c({throttle:r.throttle,throttleByServer:r.throttleByServer,type:r.type,priorityFunction:r.priorityFunction}),w(n,i,s)}).always(function(){delete h[u]}))}function b(n,t,i,r){return n._resource.getDerivedResource({url:"flatfile?q2-0"+t+"-q."+i.toString(),request:r})}function g(t){var i=t._resource.getDerivedResource({url:"dbRoot.v5",queryParameters:{output:"proto"}});return i.fetchArrayBuffer().then(function(i){var o=n.EncryptedDbRootProto.decode(new Uint8Array(i)),r=o.encryptionData,u=r.byteOffset,f=u+r.byteLength,s=t.key=r.buffer.slice(u,f),e;return r=o.dbrootData,u=r.byteOffset,f=u+r.byteLength,e=r.buffer.slice(u,f),p.scheduleTask({buffer:e,type:"DbRoot",key:s},[e])}).then(function(i){var e=n.DbRootProto.decode(new Uint8Array(i.buffer)),s,o,h,c;t.imageryPresent=u(e.imageryPresent,t.imageryPresent);t.protoImagery=e.protoImagery;t.terrainPresent=u(e.terrainPresent,t.terrainPresent);f(e.endSnippet)&&f(e.endSnippet.model)&&(s=e.endSnippet.model,t.negativeAltitudeExponentBias=u(s.negativeAltitudeExponentBias,t.negativeAltitudeExponentBias),t.negativeAltitudeThreshold=u(s.compressedNegativeAltitudeThreshold,t.negativeAltitudeThreshold));f(e.databaseVersion)&&(t._quadPacketVersion=u(e.databaseVersion.quadtreeVersion,t._quadPacketVersion));var a=t.providers,l=u(e.providerInfo,[]),v=l.length;for(o=0;o<v;++o)h=l[o],c=h.copyrightString,f(c)&&(a[h.providerId]=new r(c.value))}).otherwise(function(){console.log("Failed to retrieve "+i.url+". Using defaults.");t.key=d})}var d=k('E\x0byjE"\x05,\x17\x06qI\x10FgQ\x00B%a,f)\b4jb%y\nw\x1dmikNuA\x04[@V\fr|\x103SOlq\x05{E\x03VZwUe\x0b3*\x19l5\x14\x1d0s3>mF8J.\x17u\x16Dt"\x06a"\f3"So9D\x0b\x0e99\x13L\\P_"ux\x1f\x07qh;<VqH\x05\'UfYNe\x1duaF}a?\x15A\x00\x14\x064M\x13F\x1a\x05\x1c\'{+Mg0\\P[/Fn5\x18/\'C.\n\f^\x10\x05\x10s\x1be4l.jC\'c\x14#U?q{gC}:TUK/(\\-f\x07;/\x18*"N\x0ek.\r}}GC\x11+>M>}Ix\fa1\x05-\x01O~q \r1N\x0b\x00nPh}\x17=\b\r\x17nh$[k\x17#s\r\x0b@\x04Q]\x1a\x17".\x15jI\x00wU\x10j{GL\x17\x05FS\x07+S4\x06\x07\x14Y\x19\x0281NXFk-#p\x005"1&/u-6,rt#G&\x167r\x00D\x103-\x1a`i#i*|KQ\rT9w.)\x1bPjoP\\>TP[\x0b\x07E\x17m(\x13w7\x1d\x1eJ\x05fJo pq~\fmI\x04-zrY0\x02]s x B\x17|G\x19`\x16&q\x0e3=c+SD\\q\x01D\x1f2O<)=Ra\x19X}e\r=\bB#\t^PIMGL\x1cO{+\x16\x181;ol\r\x16?_FaZ\x1cU\x00gJi\x1c H]~q \x0eNV\x01<\x1d\x0frv)I]-6\x06;f\x13j=P^RKsWx.Y\x07oK\x17W\x19>\'\'`;\x0eSD\x16>?mw\n?RU^1I7\x1f&-\x1c\'Tj *x\x04prh\x02_H~XL?f\x1a>ep8iVldI\'xtOV9\x00w\x0b-\x1b5O\x02\bQ\x13`\nZGM&\x1c30xFG[y`In7gS\n>F94\rSun\fY\x1e)\x10{IIwyIV.6\x0b:O\x03b{M1/8{O!Fpv})"x\n\\\x19QYRe|3\x13H*u`\x02\x15\x19\x1b5(1\x07-\x12F|["'),p;return e(y.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},resource:{get:function(){return this._resource}},readyPromise:{get:function(){return this._readyPromise}}}),y.tileXYToQuadKey=function(n,t,i){for(var u,r,e="",f=i;f>=0;--f)u=1<<f,r=0,s(t,u)?s(n,u)&&(r|=1):(r|=2,s(n,u)||(r|=1)),e+=r;return e},y.quadKeyToTileXY=function(n){for(var i,r,u=0,e=0,f=n.length-1,t=f;t>=0;--t)i=1<<t,r=+n[f-t],s(r,2)?s(r,1)||(u|=i):(e|=i,s(r,1)&&(u|=i));return{x:u,y:e,level:f}},y.prototype.isValid=function(n){var i=this.getTileInformationFromQuadKey(n),r,t,u;if(f(i))return i!==null;for(r=!0,t=n;t.length>1;)if(u=t.substring(t.length-1),t=t.substring(0,t.length-1),i=this.getTileInformationFromQuadKey(t),f(i)){i.hasSubtree()||i.hasChild(parseInt(u))||(r=!1);break}else if(i===null){r=!1;break}return r},p=new v("decodeGoogleEarthEnterprisePacket",Number.POSITIVE_INFINITY),y.prototype.getQuadTreePacket=function(n,t,i){var s,e,r,h;return(t=u(t,1),n=u(n,""),s=b(this,n,t,i),e=s.fetchArrayBuffer(),!f(e))?undefined:(r=this._tileInfo,h=this.key,e.then(function(t){var i=p.scheduleTask({buffer:t,quadKey:n,type:"Metadata",key:h},[t]);return i.then(function(t){var s,c=-1,l,u,a,f,i,v,e,h,y;for(n!==""&&(c=n.length+1,l=t[n],s=r[n],s._bits|=l._bits,delete t[n]),u=Object.keys(t),u.sort(function(n,t){return n.length-t.length}),a=u.length,f=0;f<a;++f)i=u[f],v=t[i],v!==null?(e=o.clone(t[i]),h=i.length,h===c?e.setParent(s):h>1&&(y=r[i.substring(0,i.length-1)],e.setParent(y)),r[i]=e):r[i]=null})}))},y.prototype.populateSubtree=function(n,t,i,r){var u=y.tileXYToQuadKey(n,t,i);return w(this,u,r)},y.prototype.getTileInformation=function(n,t,i){var r=y.tileXYToQuadKey(n,t,i);return this._tileInfo[r]},y.prototype.getTileInformationFromQuadKey=function(n){return this._tileInfo[n]},y});t("Core/GoogleEarthEnterpriseTerrainData",["./BoundingSphere","./Cartesian2","./Cartesian3","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./IndexDatatype","./Intersections2D","./Math","./OrientedBoundingBox","./QuantizedMeshTerrainData","./Rectangle","./TaskProcessor","./TerrainEncoding","./TerrainMesh"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(n){n=u(n,u.EMPTY_OBJECT);r.typeOf.object("options.buffer",n.buffer);r.typeOf.number("options.negativeAltitudeExponentBias",n.negativeAltitudeExponentBias);r.typeOf.number("options.negativeElevationThreshold",n.negativeElevationThreshold);this._buffer=n.buffer;this._credits=n.credits;this._negativeAltitudeExponentBias=n.negativeAltitudeExponentBias;this._negativeElevationThreshold=n.negativeElevationThreshold;var t=u(n.childTileMask,15),i=t&3;i|=t&4?8:0;i|=t&8?4:0;this._childTileMask=i;this._createdByUpsampling=u(n.createdByUpsampling,!1);this._skirtHeight=undefined;this._bufferType=this._buffer.constructor;this._mesh=undefined;this._minimumHeight=undefined;this._maximumHeight=undefined;this._vertexCountWithoutSkirts=undefined;this._skirtIndex=undefined}function st(n,t,i){for(var s=n._mesh,r=s.vertices,u=s.encoding,o=s.indices,e=0,w=o.length;e<w;e+=3){var c=o[e],l=o[e+1],a=o[e+2],v=u.decodeTextureCoordinates(r,c,ft),y=u.decodeTextureCoordinates(r,l,et),p=u.decodeTextureCoordinates(r,a,ot),f=h.computeBarycentricCoordinates(t,i,v.x,v.y,y.x,y.y,p.x,p.y,it);if(f.x>=-1e-15&&f.y>=-1e-15&&f.z>=-1e-15){var b=u.decodeHeight(r,c),k=u.decodeHeight(r,l),d=u.decodeHeight(r,a);return f.x*b+f.y*k+f.z*d}}return undefined}function lt(n,t,i,r){var st=n._buffer,l=0,b=0,ft=0,e,u,k,et,ot,v,s;for(i>.5?(t>.5?(l=2,b=.5):l=3,ft=.5):t>.5&&(l=1,b=.5),e=new DataView(st),u=0,k=0;k<l;++k)u+=e.getUint32(u,!0),u+=rt;u+=rt;u+=2*g;et=c.toRadians(e.getFloat64(u,!0)*180);u+=g;ot=c.toRadians(e.getFloat64(u,!0)*180);u+=g;var lt=r.width/et/2,at=r.height/ot/2,a=e.getInt32(u,!0);u+=d;v=e.getInt32(u,!0)*3;u+=d;u+=d;for(var y=new Array(a),p=new Array(a),w=new Array(a),f=0;f<a;++f)y[f]=b+e.getUint8(u++)*lt,p[f]=ft+e.getUint8(u++)*at,w[f]=e.getFloat32(u,!0)*6371010,u+=ct;for(s=new Array(v),f=0;f<v;++f)s[f]=e.getUint16(u,!0),u+=ht;for(f=0;f<v;f+=3){var nt=s[f],tt=s[f+1],ut=s[f+2],vt=y[nt],yt=y[tt],pt=y[ut],wt=p[nt],bt=p[tt],kt=p[ut],o=h.computeBarycentricCoordinates(t,i,vt,wt,yt,bt,pt,kt,it);if(o.x>=-1e-15&&o.y>=-1e-15&&o.z>=-1e-15)return o.x*w[nt]+o.y*w[tt]+o.z*w[ut]}return undefined}var tt;e(b.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){return undefined}}});var ut=new y("createVerticesFromGoogleEarthEnterpriseBuffer"),nt=new v,k=new v;b.prototype.createMesh=function(n,t,i,e,o){var h,c,s;r.typeOf.object("tilingScheme",n);r.typeOf.number("x",t);r.typeOf.number("y",i);r.typeOf.number("level",e);h=n.ellipsoid;n.tileXYToNativeRectangle(t,i,e,nt);n.tileXYToRectangle(t,i,e,k);o=u(o,1);var l=h.cartographicToCartesian(v.center(k)),a=40075.16/(1<<e);return(this._skirtHeight=Math.min(a*8,1e3),c=ut.scheduleTask({buffer:this._buffer,nativeRectangle:nt,rectangle:k,relativeToCenter:l,ellipsoid:h,skirtHeight:this._skirtHeight,exaggeration:o,includeWebMercatorT:!0,negativeAltitudeExponentBias:this._negativeAltitudeExponentBias,negativeElevationThreshold:this._negativeElevationThreshold}),!f(c))?undefined:(s=this,c.then(function(n){return s._mesh=new w(l,new Float32Array(n.vertices),new Uint16Array(n.indices),n.minimumHeight,n.maximumHeight,n.boundingSphere3D,n.occludeePointInScaledSpace,n.numberOfAttributes,n.orientedBoundingBox,p.clone(n.encoding),o),s._vertexCountWithoutSkirts=n.vertexCountWithoutSkirts,s._skirtIndex=n.skirtIndex,s._minimumHeight=n.minimumHeight,s._maximumHeight=n.maximumHeight,s._buffer=undefined,s._mesh}))};b.prototype.interpolateHeight=function(n,t,i){var r=c.clamp((t-n.west)/n.width,0,1),u=c.clamp((i-n.south)/n.height,0,1);return f(this._mesh)?st(this,r,u):lt(this,r,u,n)};tt=new y("upsampleQuantizedTerrainMesh");b.prototype.upsample=function(t,u,e,h,c,v,y){var b,p,w;if(r.typeOf.object("tilingScheme",t),r.typeOf.number("thisX",u),r.typeOf.number("thisY",e),r.typeOf.number("thisLevel",h),r.typeOf.number("descendantX",c),r.typeOf.number("descendantY",v),r.typeOf.number("descendantLevel",y),b=y-h,b>1)throw new o("Upsampling through more than one level at a time is not currently supported.");if(p=this._mesh,!f(this._mesh))return undefined;var d=u*2!==c,g=e*2===v,nt=t.ellipsoid,it=t.tileXYToRectangle(c,v,y),k=tt.scheduleTask({vertices:p.vertices,vertexCountWithoutSkirts:this._vertexCountWithoutSkirts,indices:p.indices,skirtIndex:this._skirtIndex,encoding:p.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:d,isNorthChild:g,childRectangle:it,ellipsoid:nt,exaggeration:p.exaggeration});return f(k)?(w=this,k.then(function(t){var u=new Uint16Array(t.vertices),f=s.createTypedArray(u.length/3,t.indices),r=w._skirtHeight;return new a({quantizedVertices:u,indices:f,minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight,boundingSphere:n.clone(t.boundingSphere),orientedBoundingBox:l.clone(t.orientedBoundingBox),horizonOcclusionPoint:i.clone(t.horizonOcclusionPoint),westIndices:t.westIndices,southIndices:t.southIndices,eastIndices:t.eastIndices,northIndices:t.northIndices,westSkirtHeight:r,southSkirtHeight:r,eastSkirtHeight:r,northSkirtHeight:r,childTileMask:0,createdByUpsampling:!0,credits:w._credits})})):undefined};b.prototype.isChildAvailable=function(n,t,i,u){r.typeOf.number("thisX",n);r.typeOf.number("thisY",t);r.typeOf.number("childX",i);r.typeOf.number("childY",u);var f=2;return i!==n*2&&++f,u!==t*2&&(f-=2),(this._childTileMask&1<<f)!=0};b.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};var ft=new t,et=new t,ot=new t,it=new i;var ht=Uint16Array.BYTES_PER_ELEMENT,rt=Uint32Array.BYTES_PER_ELEMENT,d=Int32Array.BYTES_PER_ELEMENT,ct=Float32Array.BYTES_PER_ELEMENT,g=Float64Array.BYTES_PER_ELEMENT;return b});t("Core/GoogleEarthEnterpriseTerrainProvider",["../ThirdParty/when","./Credit","./defaultValue","./defined","./defineProperties","./DeveloperError","./Event","./GeographicTilingScheme","./GoogleEarthEnterpriseMetadata","./GoogleEarthEnterpriseTerrainData","./HeightmapTerrainData","./JulianDate","./Math","./Rectangle","./Request","./RequestState","./RequestType","./Resource","./RuntimeError","./TaskProcessor","./TileProviderError"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";function rt(){this._terrainCache={};this._lastTidy=l.now()}function tt(u){var h,p,l,c,y;if(u=i(u,{}),!(r(u.url)||r(u.metadata)))throw new f("options.url or options.metadata is required.");r(u.metadata)?h=u.metadata:(p=b.createIfNeeded(u.url),h=new s(p));this._metadata=h;this._tilingScheme=new o({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new v(-a.PI,-a.PI,a.PI,a.PI),ellipsoid:u.ellipsoid});l=u.credit;typeof l=="string"&&(l=new t(l));this._credit=l;this._levelZeroMaximumGeometricError=40075.16;this._terrainCache=new rt;this._terrainPromises={};this._terrainRequests={};this._errorEvent=new e;this._ready=!1;c=this;this._readyPromise=h.readyPromise.then(function(t){if(!h.terrainPresent){var i=new k("The server "+h.url+" doesn't have terrain");return y=g.handleError(y,c,c._errorEvent,i.message,undefined,undefined,undefined,i),n.reject(i)}return g.handleSuccess(y),c._ready=t,t}).otherwise(function(t){return y=g.handleError(y,c,c._errorEvent,t.message,undefined,undefined,undefined,t),n.reject(t)})}function ft(n,t,i){var f=t.getChildBitmask(),u,e;if(t.terrainState===nt.PARENT)for(f=0,u=0;u<4;++u)e=i.getTileInformationFromQuadKey(n+u.toString()),r(e)&&e.hasTerrain()&&(f|=1<<u);return f}function et(n,t,i,u){return i=r(i)&&i>0?i:1,n._metadata.resource.getDerivedResource({url:"flatfile?f1c-0"+t+"-t."+i.toString(),request:u})}var nt={UNKNOWN:0,NONE:1,SELF:2,PARENT:3},it=new l,ut;return rt.prototype.add=function(n,t){this._terrainCache[n]={buffer:t,timestamp:l.now()}},rt.prototype.get=function(n){var i=this._terrainCache,t=i[n];if(r(t))return delete this._terrainCache[n],t.buffer},rt.prototype.tidy=function(){var n,i,u;if(l.now(it),l.secondsDifference(it,this._lastTidy)>10){var t=this._terrainCache,r=Object.keys(t),f=r.length;for(n=0;n<f;++n)i=r[n],u=t[i],l.secondsDifference(it,u.timestamp)>10&&delete t[i];l.clone(it,this._lastTidy)}},u(tt.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tilingScheme:{get:function(){if(!this._ready)throw new f("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){return undefined}}}),ut=new d("decodeGoogleEarthEnterprisePacket",Number.POSITIVE_INFINITY),tt.prototype.requestTileGeometry=function(t,i,u,e){var tt,ot,st,w,o,v,it,rt,b,d,ht;if(!this._ready)throw new f("requestTileGeometry must not be called before the terrain provider is ready.");var y=s.tileXYToQuadKey(t,i,u),g=this._terrainCache,l=this._metadata,a=l.getTileInformationFromQuadKey(y);if(!r(a))return n.reject(new k("Terrain tile doesn't exist"));if(tt=a.terrainState,r(tt)||(tt=a.terrainState=nt.UNKNOWN),ot=g.get(y),r(ot))return st=l.providers[a.terrainProvider],n.resolve(new h({buffer:ot,childTileMask:ft(y,a,l),credits:r(st)?[st]:undefined,negativeAltitudeExponentBias:l.negativeAltitudeExponentBias,negativeElevationThreshold:l.negativeAltitudeThreshold}));if(g.tidy(),a.ancestorHasTerrain){if(tt===nt.NONE)return n.reject(new k("Terrain tile doesn't exist"))}else return n.resolve(new c({buffer:new Uint8Array(256),width:16,height:16}));o=y;v=-1;switch(tt){case nt.SELF:v=a.terrainVersion;break;case nt.PARENT:o=o.substring(0,o.length-1);w=l.getTileInformationFromQuadKey(o);v=w.terrainVersion;break;case nt.UNKNOWN:a.hasTerrain()?v=a.terrainVersion:(o=o.substring(0,o.length-1),w=l.getTileInformationFromQuadKey(o),r(w)&&w.hasTerrain()&&(v=w.terrainVersion))}if(v<0)return n.reject(new k("Terrain tile doesn't exist"));if(it=this._terrainPromises,rt=this._terrainRequests,r(it[o]))b=it[o],d=rt[o];else{if(d=e,ht=et(this,o,v,d).fetchArrayBuffer(),!r(ht))return undefined;b=ht.then(function(t){return r(t)?ut.scheduleTask({buffer:t,type:"Terrain",key:l.key},[t]).then(function(n){var f=l.getTileInformationFromQuadKey(o),e,s,t,u,i;for(f.terrainState=nt.SELF,g.add(o,n[0]),e=f.terrainProvider,s=n.length-1,t=0;t<s;++t)u=o+t.toString(),i=l.getTileInformationFromQuadKey(u),r(i)&&(g.add(u,n[t+1]),i.terrainState=nt.PARENT,i.terrainProvider===0&&(i.terrainProvider=e))}):n.reject(new k("Failed to load terrain."))});it[o]=b;rt[o]=d;b=b.always(function(){delete it[o];delete rt[o]})}return b.then(function(){var i=g.get(y),t;return r(i)?(t=l.providers[a.terrainProvider],new h({buffer:i,childTileMask:ft(y,a,l),credits:r(t)?[t]:undefined,negativeAltitudeExponentBias:l.negativeAltitudeExponentBias,negativeElevationThreshold:l.negativeAltitudeThreshold})):n.reject(new k("Failed to load terrain."))}).otherwise(function(t){return d.state===p.CANCELLED?(e.state=d.state,n.reject(t)):(a.terrainState=nt.NONE,n.reject(t))})},tt.prototype.getLevelMaximumGeometricError=function(n){return this._levelZeroMaximumGeometricError/(1<<n)},tt.prototype.getTileDataAvailable=function(n,t,i){var e=this._metadata,f=s.tileXYToQuadKey(n,t,i),u=e.getTileInformation(n,t,i),o,h,c;return u===null?!1:r(u)?u.ancestorHasTerrain?(o=u.terrainState,o===nt.NONE)?!1:(!r(o)||o===nt.UNKNOWN)&&(u.terrainState=nt.UNKNOWN,!u.hasTerrain()&&(f=f.substring(0,f.length-1),h=e.getTileInformationFromQuadKey(f),!r(h)||!h.hasTerrain()))?!1:!0:!0:(e.isValid(f)&&(c=new y({throttle:!0,throttleByServer:!0,type:w.TERRAIN}),e.populateSubtree(n,t,i,c)),!1)},tt});t("Core/GroundPolylineGeometry",["./ApproximateTerrainHeights","./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Cartographic","./Check","./ComponentDatatype","./DeveloperError","./Math","./defaultValue","./defined","./defineProperties","./Ellipsoid","./EllipsoidGeodesic","./EncodedCartesian3","./GeographicProjection","./Geometry","./GeometryAttribute","./IntersectionTests","./Matrix3","./Plane","./Quaternion","./Rectangle","./WebMercatorProjection"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){"use strict";function ft(n){n=h(n,h.EMPTY_OBJECT);var t=n.positions;if(!c(t)||t.length<2)throw new o("At least two positions are required.");this.width=h(n.width,1);this._positions=t;this.granularity=h(n.granularity,9999);this.loop=h(n.loop,!1);this._ellipsoid=a.WGS84;this._projectionIndex=0;this._workerName="createGroundPolylineGeometry";this._scene3DOnly=!1}function at(n,t,i,u,f){var e=rt(u,n,0,rr),o=rt(u,n,i,ii),s=rt(u,t,0,ri),h=ut(o,e,ii),c=ut(s,e,ri);return r.cross(c,h,f),r.normalize(f,f)}function vt(n,t,i,u,f,e,o,s,h,c){var p,l,w;if(f!==0&&(p=new v(n,t,e),l=p.surfaceDistance,!(l<f))){var g=at(n,t,u,e,or),b=Math.ceil(l/f),k=l/b,d=k,nt=b-1,a=o.length;for(w=0;w<nt;w++){var y=p.interpolateUsingSurfaceDistance(d,ur),tt=rt(e,y,i,fr),it=rt(e,y,u,er);r.pack(g,o,a);r.pack(tt,s,a);r.pack(it,h,a);c.push(y.latitude);c.push(y.longitude);a+=3;d+=k}}}function rt(n,t,i,r){return u.clone(t,st),st.height=i,u.toCartesian(st,n,r)}function ut(n,t,i){return r.subtract(n,t,i),r.normalize(i,i),i}function yt(n,t,i,u,f){var h=ut(i,t,ui),c=ut(n,t,sr),l=ut(u,t,hr),e=r.cross(h,c,lr),a,v,o;return(e=r.normalize(e,e),a=g.fromPointNormal(t,e,ar),v=g.getPointDistance(a,u),s.equalsEpsilon(v,0,s.EPSILON7))?(r.clone(e,f),f):(f=r.add(l,c,f),f=r.normalize(f,f),o=r.cross(h,f,cr),r.normalize(o,o),r.cross(o,h,f),r.normalize(f,f),r.dot(l,o)<vr&&(f=r.negate(f,f)),f)}function ei(n,t,i,u){var e=ut(i,t,dr),f=r.dot(e,n);if(f>dt||f<gt){var o=ut(u,i,ui),h=f<gt?s.PI_OVER_TWO:-s.PI_OVER_TWO,c=nt.fromAxisAngle(o,h,nu),l=d.fromQuaternion(c,gr);return d.multiplyByVector(l,n,n),!0}return!1}function ot(n,t,i,f,e){var c=u.toCartesian(t,n._ellipsoid,tu),h=r.add(c,i,si),l=!1,a=n._ellipsoid,o=a.cartesianToCartographic(h,oi),v;return Math.abs(t.longitude-o.longitude)>s.PI_OVER_TWO&&(l=!0,h=r.subtract(c,i,si),o=a.cartesianToCartographic(h,oi)),o.height=0,v=n.project(o,e),e=r.subtract(v,f,e),e.z=0,e=r.normalize(e,e),l&&r.negate(e,e),e}function ci(n,t,i,u,f,e){var o=r.subtract(t,n,hi),h,s,c;r.normalize(o,o);h=i-ni;s=r.multiplyByScalar(o,h,pt);r.add(n,s,f);c=u-ti;s=r.multiplyByScalar(o,c,pt);r.add(t,s,e)}function ct(n,t){var u=g.getPointDistance(ht,n),f=g.getPointDistance(ht,t),i=li;s.equalsEpsilon(u,0,s.EPSILON2)?(i=ut(t,n,i),r.multiplyByScalar(i,s.EPSILON2,i),r.add(n,i,n)):s.equalsEpsilon(f,0,s.EPSILON2)&&(i=ut(n,t,i),r.multiplyByScalar(i,s.EPSILON2,i),r.add(t,i,t))}function iu(n,t){var i=Math.abs(n.longitude),r=Math.abs(t.longitude),u,f;return s.equalsEpsilon(i,s.PI,s.EPSILON11)?(u=s.sign(t.longitude),n.longitude=u*(i-s.EPSILON11),1):s.equalsEpsilon(r,s.PI,s.EPSILON11)?(f=s.sign(n.longitude),t.longitude=f*(r-s.EPSILON11),2):0}function nf(t,u,f,o,h,c,l){var d,v,ce=u._ellipsoid,fr=f.length/3-1,yr=fr*8,yt=yr*4,yf=fr*36,pf=yr>65535?new Uint32Array(yf):new Uint16Array(yf),ft=new Float64Array(yr*3),tu=new Float32Array(yt),nf=new Float32Array(yt),tf=new Float32Array(yt),rf=new Float32Array(yt),uf=new Float32Array(yt),si,hi,li,pr,k,ti,nt,wf,wr,p,gf,ui,rr,pt,gt,sf,br,fi,hr,cr,lr,ee,ni,rt,af,nu,vf,ur;l&&(si=new Float32Array(yt),hi=new Float32Array(yt),li=new Float32Array(yt),pr=new Float32Array(yr*2));var le=c.length/2,ff=0,g=ai;if(g.height=0,k=vi,k.height=0,ti=yi,nt=wt,l)for(v=0,d=1;d<le;d++)g.latitude=c[v],g.longitude=c[v+1],k.latitude=c[v+2],k.longitude=c[v+3],ti=u.project(g,ti),nt=u.project(k,nt),ff+=r.distance(ti,nt),v+=2;for(wf=o.length/3,nt=r.unpack(o,0,nt),wr=0,v=3,d=1;d<wf;d++)ti=r.clone(nt,ti),nt=r.unpack(o,v,nt),wr+=r.distance(ti,nt),v+=3;v=3;var er=0,bf=0,st=0,kf=0,df=!1,ii=r.unpack(f,0,wi),ri=r.unpack(o,0,wt),it=r.unpack(h,0,bi);t&&(gf=r.unpack(f,f.length-6,pi),ei(it,gf,ii,ri)&&(it=r.negate(it,it)));var ne=0,te=0,ef=0;for(d=0;d<fr;d++){var or=r.clone(ii,pi),of=r.clone(ri,yi),ir=r.clone(it,ru);df&&(ir=r.negate(ir,ir));ii=r.unpack(f,v,wi);ri=r.unpack(o,v,wt);it=r.unpack(h,v,bi);df=ei(it,or,ii,ri);g.latitude=c[er];g.longitude=c[er+1];k.latitude=c[er+2];k.longitude=c[er+3];l&&(sf=iu(g,k),ui=u.project(g,cu),rr=u.project(k,lu),br=ut(rr,ui,di),br.y=Math.abs(br.y),pt=bt,gt=kt,sf===0||r.dot(br,r.UNIT_Y)>dt?(pt=ot(u,g,ir,ui,bt),gt=ot(u,k,it,rr,kt)):sf===1?(gt=ot(u,k,it,rr,kt),pt.x=0,pt.y=s.sign(g.longitude-Math.abs(k.longitude)),pt.z=0):(pt=ot(u,g,ir,ui,bt),gt.x=0,gt.y=s.sign(g.longitude-k.longitude),gt.z=0));var ie=r.distance(of,ri),re=y.fromCartesian(or,bu),kr=r.subtract(ii,or,au),ae=r.normalize(kr,ki),sr=r.subtract(of,or,vu);sr=r.normalize(sr,sr);fi=r.cross(ae,sr,ki);fi=r.normalize(fi,fi);hr=r.cross(sr,ir,pu);hr=r.normalize(hr,hr);cr=r.subtract(ri,ii,yu);cr=r.normalize(cr,cr);lr=r.cross(it,cr,wu);lr=r.normalize(lr,lr);var ve=ie/wr,ye=ne/wr,hf=0,ar,dr,oi,ue=0,fe=0;for(l&&(hf=r.distance(ui,rr),ar=y.fromCartesian(ui,ku),dr=r.subtract(rr,ui,di),oi=r.normalize(dr,du),ee=oi.x,oi.x=oi.y,oi.y=-ee,ue=hf/ff,fe=te/ff),p=0;p<8;p++){var a=kf+p*4,oe=bf+p*2,vr=a+3,se=p<4?1:-1,gr=p===2||p===3||p===6||p===7?1:-1;r.pack(re.high,tu,a);tu[vr]=kr.x;r.pack(re.low,nf,a);nf[vr]=kr.y;r.pack(hr,tf,a);tf[vr]=kr.z;r.pack(lr,rf,a);rf[vr]=ve*se;r.pack(fi,uf,a);ni=ye*gr;ni===0&&gr<0&&(ni=Number.POSITIVE_INFINITY);uf[vr]=ni;l&&(si[a]=ar.high.x,si[a+1]=ar.high.y,si[a+2]=ar.low.x,si[a+3]=ar.low.y,li[a]=-pt.y,li[a+1]=pt.x,li[a+2]=gt.y,li[a+3]=-gt.x,hi[a]=dr.x,hi[a+1]=dr.y,hi[a+2]=oi.x,hi[a+3]=oi.y,pr[oe]=ue*se,ni=fe*gr,ni===0&&gr<0&&(ni=Number.POSITIVE_INFINITY),pr[oe+1]=ni)}var ht=su,lt=hu,at=eu,vt=ou,pe=tt.fromCartographicArray(uu,fu),he=n.getApproximateTerrainHeights(pe,ce),cf=he.minimumTerrainHeight,lf=he.maximumTerrainHeight;ef+=cf;ef+=lf;ci(or,of,cf,lf,ht,at);ci(ii,ri,cf,lf,lt,vt);rt=r.multiplyByScalar(fi,s.EPSILON5,gi);r.add(ht,rt,ht);r.add(lt,rt,lt);r.add(at,rt,at);r.add(vt,rt,vt);ct(ht,lt);ct(at,vt);r.pack(ht,ft,st);r.pack(lt,ft,st+3);r.pack(vt,ft,st+6);r.pack(at,ft,st+9);rt=r.multiplyByScalar(fi,-2*s.EPSILON5,gi);r.add(ht,rt,ht);r.add(lt,rt,lt);r.add(at,rt,at);r.add(vt,rt,vt);ct(ht,lt);ct(at,vt);r.pack(ht,ft,st+12);r.pack(lt,ft,st+15);r.pack(vt,ft,st+18);r.pack(at,ft,st+21);er+=2;v+=3;bf+=16;st+=24;kf+=32;ne+=ie;te+=hf}for(v=0,af=0,d=0;d<fr;d++){for(p=0;p<tr;p++)pf[v+p]=nr[p]+af;af+=8;v+=tr}return nu=gu,i.fromVertices(f,r.ZERO,3,nu[0]),i.fromVertices(o,r.ZERO,3,nu[1]),vf=i.fromBoundingSpheres(nu),vf.radius+=ef/(fr*2),ur={position:new b({componentDatatype:e.DOUBLE,componentsPerAttribute:3,normalize:!1,values:ft}),startHiAndForwardOffsetX:et(tu),startLoAndForwardOffsetY:et(nf),startNormalAndForwardOffsetZ:et(tf),endNormalAndTextureCoordinateNormalizationX:et(rf),rightNormalAndTextureCoordinateNormalizationY:et(uf)},l&&(ur.startHiLo2D=et(si),ur.offsetAndRight2D=et(hi),ur.startEndNormals2D=et(li),ur.texcoordNormalization2D=new b({componentDatatype:e.FLOAT,componentsPerAttribute:2,normalize:!1,values:pr})),new w({attributes:ur,indices:pf,boundingSphere:vf})}function et(n){return new b({componentDatatype:e.FLOAT,componentsPerAttribute:4,normalize:!1,values:n})}var lt=[p,it],ir=lt.length,dt=Math.cos(s.toRadians(30)),gt=Math.cos(s.toRadians(150)),ni=0,ti=1e3,st,hi,pt,li;l(ft.prototype,{packedLength:{get:function(){return 1+this._positions.length*3+1+1+a.packedLength+1+1}}});ft.setProjectionAndEllipsoid=function(n,t){for(var r=0,i=0;i<ir;i++)if(t instanceof lt[i]){r=i;break}n._projectionIndex=r;n._ellipsoid=t.ellipsoid};var rr=new r,ii=new r,ri=new r;var ur=new u,fr=new r,er=new r,or=new r;st=new u;ft.pack=function(n,t,i){var e,c;f.typeOf.object("value",n);f.defined("array",t);var u=h(i,0),o=n._positions,s=o.length;for(t[u++]=s,e=0;e<s;++e)c=o[e],r.pack(c,t,u),u+=3;return t[u++]=n.granularity,t[u++]=n.loop?1:0,a.pack(n._ellipsoid,t,u),u+=a.packedLength,t[u++]=n._projectionIndex,t[u++]=n._scene3DOnly?1:0,t};ft.unpack=function(n,t,i){var e,l,v,o;f.defined("array",n);var u=h(t,0),y=n[u++],s=new Array(y);for(e=0;e<y;e++)s[e]=r.unpack(n,u),u+=3;var p=n[u++],w=n[u++]===1,b=a.unpack(n,u);return(u+=a.packedLength,l=n[u++],v=n[u++]===1,!c(i))?(o=new ft({positions:s,granularity:p,loop:w,ellipsoid:b}),o._projectionIndex=l,o._scene3DOnly=v,o):(i._positions=s,i.granularity=p,i.loop=w,i._ellipsoid=b,i._projectionIndex=l,i._scene3DOnly=v,i)};var sr=new r,hr=new r,cr=new r,lr=new r,ar=new g(r.UNIT_X,0),ui=new r,vr=0;var ht=g.fromPointNormal(r.ZERO,r.UNIT_Y),yr=new r,pr=new r,wr=new r,br=new r,kr=new r,fi=new r;ft.createGeometry=function(n){var ui=!n._scene3DOnly,ot=n.loop,f=n._ellipsoid,bt=n.granularity,ei=new lt[n._projectionIndex](f),p=ni,ut=ti,h,i,st=n._positions,kt=st.length,ct,ft,w,pt,b,e,dt,wt,et,ii,ri;for(kt===2&&(ot=!1),pt=[st[0]],i=0;i<kt-1;i++)ct=st[i],ft=st[i+1],w=k.lineSegmentPlane(ct,ft,ht,fi),!c(w)||r.equalsEpsilon(w,ct,s.EPSILON7)||r.equalsEpsilon(w,ft,s.EPSILON7)||pt.push(r.clone(w)),pt.push(ft);for(ot&&(ct=st[kt-1],ft=st[0],w=k.lineSegmentPlane(ct,ft,ht,fi),!c(w)||r.equalsEpsilon(w,ct,s.EPSILON7)||r.equalsEpsilon(w,ft,s.EPSILON7)||pt.push(r.clone(w))),b=pt.length,e=new Array(b),i=0;i<b;i++)dt=u.fromCartesian(pt[i],f),dt.height=0,e[i]=dt;if(e=t(e,u.equalsEpsilon),b=e.length,b<2)return undefined;var l=[],a=[],d=[],g=[],nt=yr,o=pr,v=wr,tt=br,y=kr,it=e[0],gt=e[1],oi=e[b-1];for(nt=rt(f,oi,p,nt),tt=rt(f,gt,p,tt),o=rt(f,it,p,o),v=rt(f,it,ut,v),y=ot?yt(nt,o,v,tt,y):at(it,gt,ut,f,y),r.pack(y,a,0),r.pack(o,d,0),r.pack(v,g,0),l.push(it.latitude),l.push(it.longitude),vt(it,gt,p,ut,bt,f,a,d,g,l),i=1;i<b-1;++i)nt=r.clone(o,nt),o=r.clone(tt,o),wt=e[i],rt(f,wt,ut,v),rt(f,e[i+1],p,tt),yt(nt,o,v,tt,y),h=a.length,r.pack(y,a,h),r.pack(o,d,h),r.pack(v,g,h),l.push(wt.latitude),l.push(wt.longitude),vt(e[i],e[i+1],p,ut,bt,f,a,d,g,l);if(et=e[b-1],ii=e[b-2],o=rt(f,et,p,o),v=rt(f,et,ut,v),ot?(ri=e[0],nt=rt(f,ii,p,nt),tt=rt(f,ri,p,tt),y=yt(nt,o,v,tt,y)):y=at(ii,et,ut,f,y),h=a.length,r.pack(y,a,h),r.pack(o,d,h),r.pack(v,g,h),l.push(et.latitude),l.push(et.longitude),ot){for(vt(et,it,p,ut,bt,f,a,d,g,l),h=a.length,i=0;i<3;++i)a[h+i]=a[i],d[h+i]=d[i],g[h+i]=g[i];l.push(it.latitude);l.push(it.longitude)}return nf(ot,ei,d,g,a,l,ui)};var dr=new r,gr=new d,nu=new nt;var oi=new u,tu=new r,si=new r;hi=new r;pt=new r;li=new r;var ai=new u,vi=new u,yi=new r,wt=new r,pi=new r,wi=new r,ru=new r,bi=new r,uu=[ai,vi],fu=new tt,eu=new r,ou=new r,su=new r,hu=new r,cu=new r,lu=new r,bt=new r,kt=new r,au=new r,vu=new r,yu=new r,ki=new r,pu=new r,wu=new r,bu=new y,ku=new y,di=new r,du=new r,gi=new r,gu=[new i,new i],nr=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],tr=nr.length;return ft._projectNormal=ot,ft});t("Core/HeadingPitchRange",["./defaultValue","./defined"],function(n,t){"use strict";function i(t,i,r){this.heading=n(t,0);this.pitch=n(i,0);this.range=n(r,0)}return i.clone=function(n,r){return t(n)?(t(r)||(r=new i),r.heading=n.heading,r.pitch=n.pitch,r.range=n.range,r):undefined},i});t("Core/HeadingPitchRoll",["./defaultValue","./defined","./DeveloperError","./Math"],function(n,t,i,r){"use strict";function u(t,i,r){this.heading=n(t,0);this.pitch=n(i,0);this.roll=n(r,0)}return u.fromQuaternion=function(n,r){if(!t(n))throw new i("quaternion is required");t(r)||(r=new u);var f=2*(n.w*n.y-n.z*n.x),e=1-2*(n.x*n.x+n.y*n.y),o=2*(n.w*n.x+n.y*n.z),s=1-2*(n.y*n.y+n.z*n.z),h=2*(n.w*n.z+n.x*n.y);return r.heading=-Math.atan2(h,s),r.roll=Math.atan2(o,e),r.pitch=-Math.asin(f),r},u.fromDegrees=function(n,f,e,o){if(!t(n))throw new i("heading is required");if(!t(f))throw new i("pitch is required");if(!t(e))throw new i("roll is required");return t(o)||(o=new u),o.heading=n*r.RADIANS_PER_DEGREE,o.pitch=f*r.RADIANS_PER_DEGREE,o.roll=e*r.RADIANS_PER_DEGREE,o},u.clone=function(n,i){return t(n)?t(i)?(i.heading=n.heading,i.pitch=n.pitch,i.roll=n.roll,i):new u(n.heading,n.pitch,n.roll):undefined},u.equals=function(n,i){return n===i||t(n)&&t(i)&&n.heading===i.heading&&n.pitch===i.pitch&&n.roll===i.roll},u.equalsEpsilon=function(n,i,u,f){return n===i||t(n)&&t(i)&&r.equalsEpsilon(n.heading,i.heading,u,f)&&r.equalsEpsilon(n.pitch,i.pitch,u,f)&&r.equalsEpsilon(n.roll,i.roll,u,f)},u.prototype.clone=function(n){return u.clone(this,n)},u.prototype.equals=function(n){return u.equals(this,n)},u.prototype.equalsEpsilon=function(n,t,i){return u.equalsEpsilon(this,n,t,i)},u.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"},u});t("Core/HermitePolynomialApproximation",["./defaultValue","./defined","./DeveloperError","./Math"],function(n,t,i,r){"use strict";function f(n,t,i,r,u,e){var c=0,s,o,h;if(r>0){for(o=0;o<u;o++){for(s=!1,h=0;h<e.length&&!s;h++)o===e[h]&&(s=!0);s||(e.push(o),c+=f(n,t,i,r-1,u,e),e.splice(e.length-1,1))}return c}for(c=1,o=0;o<u;o++){for(s=!1,h=0;h<e.length&&!s;h++)o===e[h]&&(s=!0);s||(c*=n-i[t[o]])}return c}function s(n,t,i,u,f,e){for(var c,o,k,d,a,p,g,s,v,w=-1,h=t.length,tt=h*(h+1)/2,l=0;l<f;l++){for(c=Math.floor(l*tt),s=0;s<h;s++)v=t[s]*f*(e+1)+l,n[c+s]=u[v];for(o=1;o<h;o++){var y=0,nt=Math.floor(o*(1-o)/2)+h*o,b=!1;for(s=0;s<h-o;s++)k=i[t[s]],d=i[t[s+o]],d-k<=0?(v=t[s]*f*(e+1)+f*o+l,a=u[v],p=a/r.factorial(o),n[c+nt+y]=p,y++):(g=Math.floor((o-1)*(2-o)/2)+h*(o-1),a=n[c+g+s+1]-n[c+g+s],p=a/(d-k),n[c+nt+y]=p,y++),b=b||a!==0;b&&(w=Math.max(w,o))}}return w}var o=r.factorial,u={type:"Hermite"},e;return u.getRequiredDataPoints=function(r,u){if(u=n(u,0),!t(r))throw new i("degree is required.");if(r<0)throw new i("degree must be 0 or greater.");if(u<0)throw new i("inputOrder must be 0 or greater.");return Math.max(Math.floor((r+1)/(u+1)),2)},u.interpolateOrderZero=function(n,i,r,u,e){var s,h,v,c,it,b,p,l,d,y,a,g,k,nt,tt,w,rt,ut;for(t(e)||(e=new Array(u)),p=i.length,l=new Array(u),s=0;s<u;s++)for(e[s]=0,d=new Array(p),l[s]=d,h=0;h<p;h++)d[h]=[];for(y=p,a=new Array(y),s=0;s<y;s++)a[s]=s;for(g=p-1,c=0;c<u;c++){for(h=0;h<y;h++)b=a[h]*u+c,l[c][0].push(r[b]);for(s=1;s<y;s++){for(k=!1,h=0;h<y-s;h++)nt=i[a[h]],tt=i[a[h+s]],tt-nt<=0?(b=a[h]*u+u*s+c,w=r[b],l[c][s].push(w/o(s))):(w=l[c][s-1][h+1]-l[c][s-1][h],l[c][s].push(w/(tt-nt))),k=k||w!==0;k||(g=s-1)}}for(v=0,it=0;v<=it;v++)for(s=v;s<=g;s++)for(rt=f(n,a,i,v,s,[]),c=0;c<u;c++)ut=l[c][s][0],e[c+v*u]+=ut*rt;return e},e=[],u.interpolate=function(n,i,r,u,o,h,c){var d=u*(h+1),p,b,v,l,w,a,it,rt,y,ut,ft;for(t(c)||(c=new Array(d)),p=0;p<d;p++)c[p]=0;for(b=i.length,v=new Array(b*(o+1)),l=0;l<b;l++)for(w=0;w<o+1;w++)v[l*(o+1)+w]=l;var k=v.length,g=e,nt=s(g,v,i,r,u,o),tt=[],et=k*(k+1)/2,ot=Math.min(nt,h);for(a=0;a<=ot;a++)for(l=a;l<=nt;l++)for(tt.length=0,it=f(n,v,i,a,l,tt),rt=Math.floor(l*(1-l)/2)+k*l,y=0;y<u;y++)ut=Math.floor(y*et),ft=g[ut+rt],c[y+a*u]+=ft*it;return c},u});t("Core/IauOrientationParameters",[],function(){"use strict";function n(n,t,i,r){this.rightAscension=n;this.declination=t;this.rotation=i;this.rotationRate=r}return n});t("Core/Iau2000Orientation",["./defined","./IauOrientationParameters","./JulianDate","./Math","./TimeConstants"],function(n,t,i,r,u){"use strict";var e={},g=32.184,nt=2451545,o=-.0529921,s=-.1059842,h=13.0120009,c=13.3407154,l=.9856003,a=26.4057084,v=13.064993,y=.3287146,p=1.7484877,w=-.1589763,b=.0036096,k=.1643573,d=12.9590088,f=new i;return e.ComputeMoon=function(e,tt){n(e)||(e=i.now());f=i.addSeconds(e,g,f);var it=i.totalDays(f)-nt,rt=it/u.DAYS_PER_JULIAN_CENTURY,ut=(125.045+o*it)*r.RADIANS_PER_DEGREE,ft=(250.089+s*it)*r.RADIANS_PER_DEGREE,et=(260.008+h*it)*r.RADIANS_PER_DEGREE,ot=(176.625+c*it)*r.RADIANS_PER_DEGREE,st=(357.529+l*it)*r.RADIANS_PER_DEGREE,ht=(311.589+a*it)*r.RADIANS_PER_DEGREE,ct=(134.963+v*it)*r.RADIANS_PER_DEGREE,lt=(276.617+y*it)*r.RADIANS_PER_DEGREE,at=(34.226+p*it)*r.RADIANS_PER_DEGREE,vt=(15.134+w*it)*r.RADIANS_PER_DEGREE,yt=(119.743+b*it)*r.RADIANS_PER_DEGREE,pt=(239.961+k*it)*r.RADIANS_PER_DEGREE,wt=(25.053+d*it)*r.RADIANS_PER_DEGREE,bt=Math.sin(ut),kt=Math.sin(ft),dt=Math.sin(et),gt=Math.sin(ot),li=Math.sin(st),ni=Math.sin(ht),ai=Math.sin(ct),vi=Math.sin(lt),yi=Math.sin(at),ti=Math.sin(vt),pi=Math.sin(yt),wi=Math.sin(pt),ii=Math.sin(wt),ri=Math.cos(ut),ui=Math.cos(ft),fi=Math.cos(et),ei=Math.cos(ot),bi=Math.cos(st),oi=Math.cos(ht),si=Math.cos(ct),ki=Math.cos(lt),di=Math.cos(at),hi=Math.cos(vt),gi=Math.cos(yt),nr=Math.cos(pt),ci=Math.cos(wt),tr=(269.9949+.0031*rt-3.8787*bt-.1204*kt+.07*dt-.0172*gt+.0072*ni-.0052*ti+.0043*ii)*r.RADIANS_PER_DEGREE,ir=(66.5392+.013*rt+1.5419*ri+.0239*ui-.0278*fi+.0068*ei-.0029*oi+.0009*si+.0008*hi-.0009*ci)*r.RADIANS_PER_DEGREE,rr=(38.3213+13.17635815*it-14e-13*it*it+3.561*bt+.1208*kt-.0642*dt+.0158*gt+.0252*li-.0066*ni-.0047*ai-.0046*vi+.0028*yi+.0052*ti+.004*pi+.0019*wi-.0044*ii)*r.RADIANS_PER_DEGREE,ur=(13.17635815-14e-13*2*it+3.561*ri*o+.1208*ui*s-.0642*fi*h+.0158*ei*c+.0252*bi*l-.0066*oi*a-.0047*si*v-.0046*ki*y+.0028*di*p+.0052*hi*w+.004*gi*b+.0019*nr*k-.0044*ci*d)/86400*r.RADIANS_PER_DEGREE;return n(tt)||(tt=new t),tt.rightAscension=tr,tt.declination=ir,tt.rotation=rr,tt.rotationRate=ur,tt},e});t("Core/IauOrientationAxes",["./Cartesian3","./defined","./Iau2000Orientation","./JulianDate","./Math","./Matrix3","./Quaternion"],function(n,t,i,r,u,f,e){"use strict";function o(n){t(n)&&typeof n=="function"||(n=i.ComputeMoon);this._computeFunction=n}function l(i,r,e){var l=s,v,o,a;return l.x=Math.cos(i+u.PI_OVER_TWO),l.y=Math.sin(i+u.PI_OVER_TWO),l.z=0,v=Math.cos(r),o=c,o.x=v*Math.cos(i),o.y=v*Math.sin(i),o.z=Math.sin(r),a=n.cross(o,l,h),t(e)||(e=new f),e[0]=l.x,e[1]=a.x,e[2]=o.x,e[3]=l.y,e[4]=a.y,e[5]=o.y,e[6]=l.z,e[7]=a.z,e[8]=o.z,e}var s=new n,h=new n,c=new n,a=new f,v=new e;return o.prototype.evaluate=function(i,o){t(i)||(i=r.now());var s=this._computeFunction(i),h=l(s.rightAscension,s.declination,o),y=u.zeroToTwoPi(s.rotation),c=e.fromAxisAngle(n.UNIT_Z,y,v),p=f.fromQuaternion(e.conjugate(c,c),a);return f.multiply(p,h,h)},o});t("Core/InterpolationAlgorithm",["./DeveloperError"],function(n){"use strict";var t={};return t.type=undefined,t.getRequiredDataPoints=n.throwInstantiationError,t.interpolateOrderZero=n.throwInstantiationError,t.interpolate=n.throwInstantiationError,t});t("Core/PeliasGeocoderService",["./Cartesian3","./Check","./defined","./defineProperties","./GeocodeType","./Rectangle","./Resource"],function(n,t,i,r,u,f,e){"use strict";function o(n){t.defined("url",n);this._url=e.createIfNeeded(n);this._url.appendForwardSlash()}return r(o.prototype,{url:{get:function(){return this._url}}}),o.prototype.geocode=function(r,e){t.typeOf.string("query",r);var o=this._url.getDerivedResource({url:e===u.AUTOCOMPLETE?"autocomplete":"search",queryParameters:{text:r}});return o.fetchJson().then(function(t){return t.features.map(function(t){var u,r=t.bbox,e,o;return i(r)?u=f.fromDegrees(r[0],r[1],r[2],r[3]):(e=t.geometry.coordinates[0],o=t.geometry.coordinates[1],u=n.fromDegrees(e,o)),{displayName:t.properties.label,destination:u}})})},o});t("Core/IonGeocoderService",["./Check","./Credit","./defaultValue","./defined","./defineProperties","./Ion","./PeliasGeocoderService","./Rectangle","./Resource"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(u){var o,h,c,l;u=i(u,i.EMPTY_OBJECT);n.typeOf.object("options.scene",u.scene);o=i(u.accessToken,f.defaultAccessToken);h=s.createIfNeeded(i(u.server,f.defaultServer));h.appendForwardSlash();c=f.getDefaultTokenCredit(o);r(c)&&u.scene.frameState.creditDisplay.addDefaultCredit(t.clone(c));l=h.getDerivedResource({url:"v1/geocode"});r(o)&&l.appendQueryParameters({access_token:o});this._accessToken=o;this._server=h;this._pelias=new e(l)}return h.prototype.geocode=function(n,t){return this._pelias.geocode(n,t)},h});t("Core/TimeInterval",["./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./freezeObject","./JulianDate"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this.start=i(n.start)?e.clone(n.start):new e;this.stop=i(n.stop)?e.clone(n.stop):new e;this.data=n.data;this.isStartIncluded=t(n.isStartIncluded,!0);this.isStopIncluded=t(n.isStopIncluded,!0)}r(o.prototype,{isEmpty:{get:function(){var n=e.compare(this.stop,this.start);return n<0||n===0&&(!this.isStartIncluded||!this.isStopIncluded)}}});var s={start:undefined,stop:undefined,isStartIncluded:undefined,isStopIncluded:undefined,data:undefined};return o.fromIso8601=function(r,f){var h;if(n.typeOf.object("options",r),n.typeOf.string("options.iso8601",r.iso8601),h=r.iso8601.split("/"),h.length!==2)throw new u("options.iso8601 is an invalid ISO 8601 interval.");var c=e.fromIso8601(h[0]),l=e.fromIso8601(h[1]),a=t(r.isStartIncluded,!0),v=t(r.isStopIncluded,!0),y=r.data;return i(f)?(f.start=c,f.stop=l,f.isStartIncluded=a,f.isStopIncluded=v,f.data=y,f):(s.start=c,s.stop=l,s.isStartIncluded=a,s.isStopIncluded=v,s.data=y,new o(s))},o.toIso8601=function(t,i){return n.typeOf.object("timeInterval",t),e.toIso8601(t.start,i)+"/"+e.toIso8601(t.stop,i)},o.clone=function(n,t){return i(n)?i(t)?(t.start=n.start,t.stop=n.stop,t.isStartIncluded=n.isStartIncluded,t.isStopIncluded=n.isStopIncluded,t.data=n.data,t):new o(n):undefined},o.equals=function(n,t,r){return n===t||i(n)&&i(t)&&(n.isEmpty&&t.isEmpty||n.isStartIncluded===t.isStartIncluded&&n.isStopIncluded===t.isStopIncluded&&e.equals(n.start,t.start)&&e.equals(n.stop,t.stop)&&(n.data===t.data||i(r)&&r(n.data,t.data)))},o.equalsEpsilon=function(t,r,u,f){return n.typeOf.number("epsilon",u),t===r||i(t)&&i(r)&&(t.isEmpty&&r.isEmpty||t.isStartIncluded===r.isStartIncluded&&t.isStopIncluded===r.isStopIncluded&&e.equalsEpsilon(t.start,r.start,u)&&e.equalsEpsilon(t.stop,r.stop,u)&&(t.data===r.data||i(f)&&f(t.data,r.data)))},o.intersect=function(t,r,u,f){if(n.typeOf.object("left",t),n.typeOf.object("result",u),!i(r))return o.clone(o.EMPTY,u);var s=t.start,c=t.stop,h=r.start,l=r.stop,a=e.greaterThanOrEquals(h,s)&&e.greaterThanOrEquals(c,h),v=!a&&e.lessThanOrEquals(h,s)&&e.lessThanOrEquals(s,l);if(!a&&!v)return o.clone(o.EMPTY,u);var y=t.isStartIncluded,p=t.isStopIncluded,w=r.isStartIncluded,b=r.isStopIncluded,k=e.lessThan(c,l);return u.start=a?h:s,u.isStartIncluded=y&&w||!e.equals(h,s)&&(a&&w||v&&y),u.stop=k?c:l,u.isStopIncluded=k?p:p&&b||!e.equals(l,c)&&b,u.data=i(f)?f(t.data,r.data):t.data,u},o.contains=function(t,i){var r,u;return(n.typeOf.object("timeInterval",t),n.typeOf.object("julianDate",i),t.isEmpty)?!1:(r=e.compare(t.start,i),r===0)?t.isStartIncluded:(u=e.compare(i,t.stop),u===0)?t.isStopIncluded:r<0&&u<0},o.prototype.clone=function(n){return o.clone(this,n)},o.prototype.equals=function(n,t){return o.equals(this,n,t)},o.prototype.equalsEpsilon=function(n,t,i){return o.equalsEpsilon(this,n,t,i)},o.prototype.toString=function(){return o.toIso8601(this)},o.EMPTY=f(new o({start:new e,stop:new e,isStartIncluded:!1,isStopIncluded:!1})),o});t("Core/Iso8601",["./freezeObject","./JulianDate","./TimeInterval"],function(n,t,i){"use strict";var r=n(t.fromIso8601("0000-01-01T00:00:00Z")),u=n(t.fromIso8601("9999-12-31T24:00:00Z")),f=n(new i({start:r,stop:u}));return{MINIMUM_VALUE:r,MAXIMUM_VALUE:u,MAXIMUM_INTERVAL:f}});t("Core/KeyboardEventModifier",["./freezeObject"],function(n){"use strict";return n({SHIFT:0,CTRL:1,ALT:2})});t("Core/LagrangePolynomialApproximation",["./defined"],function(n){"use strict";var t={type:"Lagrange"};return t.getRequiredDataPoints=function(n){return Math.max(n+1,2)},t.interpolateOrderZero=function(t,i,r,u,f){var o,e,s,h,c;for(n(f)||(f=new Array(u)),s=i.length,o=0;o<u;o++)f[o]=0;for(o=0;o<s;o++){for(h=1,e=0;e<s;e++)e!==o&&(c=i[o]-i[e],h*=(t-i[e])/c);for(e=0;e<u;e++)f[e]+=h*r[o*u+e]}return f},t});t("Core/LinearApproximation",["./defined","./DeveloperError"],function(n,t){"use strict";var i={type:"Linear"};return i.getRequiredDataPoints=function(){return 2},i.interpolateOrderZero=function(i,r,u,f,e){if(r.length!==2)throw new t("The xTable provided to the linear interpolator must have exactly two elements.");else if(f<=0)throw new t("There must be at least 1 dependent variable for each independent variable.");n(e)||(e=new Array(f));var o,s,h,c=r[0],l=r[1];if(c===l)throw new t("Divide by zero error: xTable[0] and xTable[1] are equal");for(o=0;o<f;o++)s=u[o],h=u[o+f],e[o]=((h-s)*i+l*s-c*h)/(l-c);return e},i});t("Core/loadCRN",["../ThirdParty/when","./CompressedTextureBuffer","./defined","./DeveloperError","./Resource","./TaskProcessor"],function(n,t,i,r,u,f){"use strict";function o(f){var o,s;if(!i(f))throw new r("resourceOrUrlOrBuffer is required.");return(f instanceof ArrayBuffer||ArrayBuffer.isView(f)?o=n.resolve(f):(s=u.createIfNeeded(f),o=s.fetchArrayBuffer()),!i(o))?undefined:o.then(function(n){if(i(n)){var t=[];return n instanceof ArrayBuffer?t.push(n):n.byteOffset===0&&n.byteLength===n.buffer.byteLength?t.push(n.buffer):(n=n.slice(0,n.length),t.push(n.buffer)),e.scheduleTask(n,t)}}).then(function(n){return t.clone(n)})}var e=new f("transcodeCRNToDXT",Number.POSITIVE_INFINITY);return o});t("Core/loadImageFromTypedArray",["../ThirdParty/when","./Check","./Resource"],function(n,t,i){"use strict";function r(r,u,f){t.typeOf.object("uint8Array",r);t.typeOf.string("format",u);var o=new Blob([r],{type:u}),e=window.URL.createObjectURL(o),s=new i({url:e,request:f});return s.fetchImage().then(function(n){return window.URL.revokeObjectURL(e),n},function(t){return window.URL.revokeObjectURL(e),n.reject(t)})}return r});t("Renderer/PixelDatatype",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={UNSIGNED_BYTE:t.UNSIGNED_BYTE,UNSIGNED_SHORT:t.UNSIGNED_SHORT,UNSIGNED_INT:t.UNSIGNED_INT,FLOAT:t.FLOAT,HALF_FLOAT:t.HALF_FLOAT_OES,UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:t.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:t.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:t.UNSIGNED_SHORT_5_6_5,isPacked:function(n){return n===i.UNSIGNED_INT_24_8||n===i.UNSIGNED_SHORT_4_4_4_4||n===i.UNSIGNED_SHORT_5_5_5_1||n===i.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(n){switch(n){case i.UNSIGNED_BYTE:return 1;case i.UNSIGNED_SHORT:case i.UNSIGNED_SHORT_4_4_4_4:case i.UNSIGNED_SHORT_5_5_5_1:case i.UNSIGNED_SHORT_5_6_5:case i.HALF_FLOAT:return 2;case i.UNSIGNED_INT:case i.FLOAT:case i.UNSIGNED_INT_24_8:return 4}},validate:function(n){return n===i.UNSIGNED_BYTE||n===i.UNSIGNED_SHORT||n===i.UNSIGNED_INT||n===i.FLOAT||n===i.HALF_FLOAT||n===i.UNSIGNED_INT_24_8||n===i.UNSIGNED_SHORT_4_4_4_4||n===i.UNSIGNED_SHORT_5_5_5_1||n===i.UNSIGNED_SHORT_5_6_5}};return n(i)});t("Core/PixelFormat",["../Renderer/PixelDatatype","./freezeObject","./WebGLConstants"],function(n,t,i){"use strict";var r={DEPTH_COMPONENT:i.DEPTH_COMPONENT,DEPTH_STENCIL:i.DEPTH_STENCIL,ALPHA:i.ALPHA,RGB:i.RGB,RGBA:i.RGBA,LUMINANCE:i.LUMINANCE,LUMINANCE_ALPHA:i.LUMINANCE_ALPHA,RGB_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:i.COMPRESSED_RGB_ETC1_WEBGL,componentsLength:function(n){switch(n){case r.RGB:return 3;case r.RGBA:return 4;case r.LUMINANCE_ALPHA:return 2;case r.ALPHA:case r.LUMINANCE:return 1;default:return 1}},validate:function(n){return n===r.DEPTH_COMPONENT||n===r.DEPTH_STENCIL||n===r.ALPHA||n===r.RGB||n===r.RGBA||n===r.LUMINANCE||n===r.LUMINANCE_ALPHA||n===r.RGB_DXT1||n===r.RGBA_DXT1||n===r.RGBA_DXT3||n===r.RGBA_DXT5||n===r.RGB_PVRTC_4BPPV1||n===r.RGB_PVRTC_2BPPV1||n===r.RGBA_PVRTC_4BPPV1||n===r.RGBA_PVRTC_2BPPV1||n===r.RGB_ETC1},isColorFormat:function(n){return n===r.ALPHA||n===r.RGB||n===r.RGBA||n===r.LUMINANCE||n===r.LUMINANCE_ALPHA},isDepthFormat:function(n){return n===r.DEPTH_COMPONENT||n===r.DEPTH_STENCIL},isCompressedFormat:function(n){return n===r.RGB_DXT1||n===r.RGBA_DXT1||n===r.RGBA_DXT3||n===r.RGBA_DXT5||n===r.RGB_PVRTC_4BPPV1||n===r.RGB_PVRTC_2BPPV1||n===r.RGBA_PVRTC_4BPPV1||n===r.RGBA_PVRTC_2BPPV1||n===r.RGB_ETC1},isDXTFormat:function(n){return n===r.RGB_DXT1||n===r.RGBA_DXT1||n===r.RGBA_DXT3||n===r.RGBA_DXT5},isPVRTCFormat:function(n){return n===r.RGB_PVRTC_4BPPV1||n===r.RGB_PVRTC_2BPPV1||n===r.RGBA_PVRTC_4BPPV1||n===r.RGBA_PVRTC_2BPPV1},isETC1Format:function(n){return n===r.RGB_ETC1},compressedTextureSizeInBytes:function(n,t,i){switch(n){case r.RGB_DXT1:case r.RGBA_DXT1:case r.RGB_ETC1:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*8;case r.RGBA_DXT3:case r.RGBA_DXT5:return Math.floor((t+3)/4)*Math.floor((i+3)/4)*16;case r.RGB_PVRTC_4BPPV1:case r.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(t,8)*Math.max(i,8)*4+7)/8);case r.RGB_PVRTC_2BPPV1:case r.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(t,16)*Math.max(i,8)*2+7)/8);default:return 0}},textureSizeInBytes:function(t,i,u,f){var e=r.componentsLength(t);return n.isPacked(i)&&(e=1),e*n.sizeInBytes(i)*u*f},createTypedArray:function(t,i,u,f){var o,e=n.sizeInBytes(i),s;return o=e===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:e===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:e===Float32Array.BYTES_PER_ELEMENT&&i===n.FLOAT?Float32Array:Uint32Array,s=r.componentsLength(t)*u*f,new o(s)},flipY:function(n,t,i,u,f){var e,c,l,o;if(f===1)return n;var h=r.createTypedArray(t,i,u,f),s=r.componentsLength(t),a=u*s;for(e=0;e<f;++e)for(c=e*f*s,l=(f-e-1)*f*s,o=0;o<a;++o)h[l+o]=n[c+o];return h}};return t(r)});t("Core/loadKTX",["../ThirdParty/when","./Check","./CompressedTextureBuffer","./defined","./PixelFormat","./Resource","./RuntimeError"],function(n,t,i,r,u,f,e){"use strict";function h(i){var u,e;return(t.defined("resourceOrUrlOrBuffer",i),i instanceof ArrayBuffer||ArrayBuffer.isView(i)?u=n.resolve(i):(e=f.createIfNeeded(i),u=e.fetchArrayBuffer()),!r(u))?undefined:u.then(function(n){if(r(n))return l(n)})}function l(n){for(var f,t,k,d,g,p,h,nt,v,y,tt,it,rt,ut,ft,w,l,et,ot=new Uint8Array(n),b=!0,a=0;a<s.length;++a)if(s[a]!==ot[a]){b=!1;break}if(!b)throw new e("Invalid KTX file.");if(r(n.buffer)?(f=new DataView(n.buffer),t=n.byteOffset):(f=new DataView(n),t=0),t+=12,k=f.getUint32(t,!0),t+=o,k!==c)throw new e("File is the wrong endianness.");if(d=f.getUint32(t,!0),t+=o,g=f.getUint32(t,!0),t+=o,p=f.getUint32(t,!0),t+=o,h=f.getUint32(t,!0),t+=o,nt=f.getUint32(t,!0),t+=o,v=f.getUint32(t,!0),t+=o,y=f.getUint32(t,!0),t+=o,tt=f.getUint32(t,!0),t+=o,it=f.getUint32(t,!0),t+=o,rt=f.getUint32(t,!0),t+=o,ut=f.getUint32(t,!0),t+=o,ft=f.getUint32(t,!0),t+=o,t+=ft,w=f.getUint32(t,!0),t+=o,l=r(n.buffer)?new Uint8Array(n.buffer,t,w):new Uint8Array(n,t,w),h===32849?h=u.RGB:h===32856&&(h=u.RGBA),!u.validate(h))throw new e("glInternalFormat is not a valid format.");if(u.isCompressedFormat(h)){if(d!==0)throw new e("glType must be zero when the texture is compressed.");if(g!==1)throw new e("The type size for compressed textures must be 1.");if(p!==0)throw new e("glFormat must be zero when the texture is compressed.");}else if(nt!==p)throw new e("The base internal format must be the same as the format for uncompressed textures.");if(tt!==0)throw new e("3D textures are unsupported.");if(it!==0)throw new e("Texture arrays are unsupported.");if(rt!==1)throw new e("Cubemaps are unsupported.");return ut>1&&(et=u.isCompressedFormat(h)?u.compressedTextureSizeInBytes(h,v,y):u.textureSizeInBytes(h,v,y),l=new Uint8Array(l.buffer,l.byteOffset,et)),new i(h,v,y,l)}var s=[171,75,84,88,32,49,49,187,13,10,26,10],c=67305985,o=4;return h});t("Core/ManagedArray",["./Check","./defaultValue","./defineProperties"],function(n,t,i){"use strict";function r(n){n=t(n,0);this._array=new Array(n);this._length=n}return i(r.prototype,{length:{get:function(){return this._length},set:function(n){this._length=n;n>this._array.length&&(this._array.length=n)}},values:{get:function(){return this._array}}}),r.prototype.get=function(t){return n.typeOf.number.lessThan("index",t,this._array.length),this._array[t]},r.prototype.set=function(t,i){n.typeOf.number("index",t);t>=this.length&&(this.length=t+1);this._array[t]=i},r.prototype.peek=function(){return this._array[this._length-1]},r.prototype.push=function(n){var t=this.length++;this._array[t]=n},r.prototype.pop=function(){return this._array[--this.length]},r.prototype.reserve=function(t){n.typeOf.number.greaterThanOrEquals("length",t,0);t>this._array.length&&(this._array.length=t)},r.prototype.resize=function(t){n.typeOf.number.greaterThanOrEquals("length",t,0);this.length=t},r.prototype.trim=function(n){n=t(n,this.length);this._array.length=n},r});t("Core/MapboxApi",["./Credit","./defined"],function(n,t){"use strict";var i={},r,u,f;return i.defaultAccessToken=undefined,r=!1,f="<b>This application is using Cesium's default Mapbox access token.  Please create a new access token for the application as soon as possible and prior to deployment by visiting <a href=https://www.mapbox.com/account/apps/>https://www.mapbox.com/account/apps/<\/a>, and provide your token to Cesium by setting the Cesium.MapboxApi.defaultAccessToken property before constructing the CesiumWidget or any other object that uses the Mapbox API.<\/b>",i.getAccessToken=function(n){return t(n)?n:t(i.defaultAccessToken)?i.defaultAccessToken:(r||(console.log(f),r=!0),"pk.eyJ1IjoiYW5hbHl0aWNhbGdyYXBoaWNzIiwiYSI6ImNpd204Zm4wejAwNzYyeW5uNjYyZmFwdWEifQ.7i-VIZZWX8pd1bTfxIVj9g")},i.getErrorCredit=function(r){return t(r)||t(i.defaultAccessToken)?undefined:(t(u)||(u=new n(f,!0)),u)},i});t("Core/MapProjection",["./defineProperties","./DeveloperError"],function(n,t){"use strict";function i(){t.throwInstantiationError()}return n(i.prototype,{ellipsoid:{get:t.throwInstantiationError}}),i.prototype.project=t.throwInstantiationError,i.prototype.unproject=t.throwInstantiationError,i});t("Core/mergeSort",["./defined","./DeveloperError"],function(n,t){"use strict";function f(n,t,u,f,e,o){for(var y=e-f+1,l=o-e,p=i,w=r,s,c,a,v,h=0;h<y;++h)p[h]=n[f+h];for(s=0;s<l;++s)w[s]=n[e+s+1];for(h=0,s=0,c=f;c<=o;++c)a=p[h],v=w[s],h<y&&(s>=l||t(a,v,u)<=0)?(n[c]=a,++h):s<l&&(n[c]=v,++s)}function u(n,t,i,r,e){if(!(r>=e)){var o=Math.floor((r+e)*.5);u(n,t,i,r,o);u(n,t,i,o+1,e);f(n,t,i,r,o,e)}}function e(f,e,o){if(!n(f))throw new t("array is required.");if(!n(e))throw new t("comparator is required.");var s=f.length,h=Math.ceil(s*.5);i.length=h;r.length=h;u(f,e,o,0,s-1);i.length=0;r.length=0}var i=[],r=[];return e});t("Core/NearFarScalar",["./defaultValue","./defined","./DeveloperError"],function(n,t,i){"use strict";function r(t,i,r,u){this.near=n(t,0);this.nearValue=n(i,0);this.far=n(r,1);this.farValue=n(u,0)}return r.clone=function(n,i){return t(n)?t(i)?(i.near=n.near,i.nearValue=n.nearValue,i.far=n.far,i.farValue=n.farValue,i):new r(n.near,n.nearValue,n.far,n.farValue):undefined},r.packedLength=4,r.pack=function(r,u,f){if(!t(r))throw new i("value is required");if(!t(u))throw new i("array is required");return f=n(f,0),u[f++]=r.near,u[f++]=r.nearValue,u[f++]=r.far,u[f]=r.farValue,u},r.unpack=function(u,f,e){if(!t(u))throw new i("array is required");return f=n(f,0),t(e)||(e=new r),e.near=u[f++],e.nearValue=u[f++],e.far=u[f++],e.farValue=u[f],e},r.equals=function(n,i){return n===i||t(n)&&t(i)&&n.near===i.near&&n.nearValue===i.nearValue&&n.far===i.far&&n.farValue===i.farValue},r.prototype.clone=function(n){return r.clone(this,n)},r.prototype.equals=function(n){return r.equals(this,n)},r});t("Core/Visibility",["./freezeObject"],function(n){"use strict";return n({NONE:-1,PARTIAL:0,FULL:1})});t("Core/Occluder",["./BoundingSphere","./Cartesian3","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./Math","./Rectangle","./Visibility"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n,i){if(!r(n))throw new f("occluderBoundingSphere is required.");if(!r(i))throw new f("camera position is required.");this._occluderPosition=t.clone(n.center);this._occluderRadius=n.radius;this._horizonDistance=0;this._horizonPlaneNormal=undefined;this._horizonPlanePosition=undefined;this._cameraPosition=undefined;this.cameraPosition=i}var a=new t,y,w,b,l,k,d,g;u(c.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(n){var c;if(!r(n))throw new f("cameraPosition is required.");n=t.clone(n,this._cameraPosition);var o=t.subtract(this._occluderPosition,n,a),i=t.magnitudeSquared(o),s=this._occluderRadius*this._occluderRadius,u,e,h;i>s?(u=Math.sqrt(i-s),i=1/Math.sqrt(i),e=t.multiplyByScalar(o,i,a),c=u*u*i,h=t.add(n,t.multiplyByScalar(e,c,a),a)):u=Number.MAX_VALUE;this._horizonDistance=u;this._horizonPlaneNormal=e;this._horizonPlanePosition=h;this._cameraPosition=n}}});c.fromBoundingSphere=function(n,i,u){if(!r(n))throw new f("occluderBoundingSphere is required.");if(!r(i))throw new f("camera position is required.");return r(u)?(t.clone(n.center,u._occluderPosition),u._occluderRadius=n.radius,u.cameraPosition=i,u):new c(n,i)};y=new t;c.prototype.isPointVisible=function(n){if(this._horizonDistance!==Number.MAX_VALUE){var r=t.subtract(n,this._occluderPosition,y),i=this._occluderRadius;if(i=t.magnitudeSquared(r)-i*i,i>0)return i=Math.sqrt(i)+this._horizonDistance,r=t.subtract(n,this._cameraPosition,r),i*i>t.magnitudeSquared(r)}return!1};w=new t;c.prototype.isBoundingSphereVisible=function(n){var f=t.clone(n.center,w),u=n.radius,r,i;if(this._horizonDistance!==Number.MAX_VALUE){if(r=t.subtract(f,this._occluderPosition,y),i=this._occluderRadius-u,i=t.magnitudeSquared(r)-i*i,u<this._occluderRadius)return i>0?(i=Math.sqrt(i)+this._horizonDistance,r=t.subtract(f,this._cameraPosition,r),i*i+u*u>t.magnitudeSquared(r)):!1;if(i>0){r=t.subtract(f,this._cameraPosition,r);var e=t.magnitudeSquared(r),o=this._occluderRadius*this._occluderRadius,s=u*u;return(this._horizonDistance*this._horizonDistance+o)*s>e*o?!0:(i=Math.sqrt(i)+this._horizonDistance,i*i+s>e)}return!0}return!1};b=new t;c.prototype.computeVisibility=function(n){var o,u,s;if(!r(n))throw new f("occludeeBS is required.");if(o=t.clone(n.center),u=n.radius,u>this._occluderRadius)return h.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var e=t.subtract(o,this._occluderPosition,b),i=this._occluderRadius-u,c=t.magnitudeSquared(e);if(i=c-i*i,i>0)return(i=Math.sqrt(i)+this._horizonDistance,e=t.subtract(o,this._cameraPosition,e),s=t.magnitudeSquared(e),i*i+u*u<s)?h.NONE:(i=this._occluderRadius+u,i=c-i*i,i>0)?(i=Math.sqrt(i)+this._horizonDistance,s<i*i+u*u?h.FULL:h.PARTIAL):(e=t.subtract(o,this._horizonPlanePosition,e),t.dot(e,this._horizonPlaneNormal)>-u?h.PARTIAL:h.FULL)}return h.NONE};l=new t;c.computeOccludeePoint=function(n,i,u){var h,a,p;if(!r(n))throw new f("occluderBoundingSphere is required.");if(!r(u))throw new f("positions is required.");if(u.length===0)throw new f("positions must contain at least one element");var w=t.clone(i),e=t.clone(n.center),b=n.radius,k=u.length;if(t.equals(e,i))throw new f("occludeePosition must be different than occluderBoundingSphere.center");var o=t.normalize(t.subtract(w,e,l),l),v=-t.dot(o,e),y=c._anyRotationVector(e,o,v),s=c._horizonToPlaneNormalDotProduct(n,o,v,y,u[0]);if(!s)return undefined;for(a=1;a<k;++a){if(h=c._horizonToPlaneNormalDotProduct(n,o,v,y,u[a]),!h)return undefined;h<s&&(s=h)}return s<.0017453283658983088?undefined:(p=b/s,t.add(e,t.multiplyByScalar(o,p,l),l))};k=[];c.computeOccludeePointFromRectangle=function(u,o){if(!r(u))throw new f("rectangle is required.");o=i(o,e.WGS84);var h=s.subsample(u,o,0,k),l=n.fromPoints(h),a=t.ZERO;return t.equals(a,l.center)?undefined:c.computeOccludeePoint(new n(a,o.minimumRadius),l.center,h)};d=new t;c._anyRotationVector=function(n,i,r){var u=t.abs(i,d),f=u.x>u.y?0:1,o,e,s;return(f===0&&u.z>u.x||f===1&&u.z>u.y)&&(f=2),o=new t,f===0?(u.x=n.x,u.y=n.y+1,u.z=n.z+1,e=t.UNIT_X):f===1?(u.x=n.x+1,u.y=n.y,u.z=n.z+1,e=t.UNIT_Y):(u.x=n.x+1,u.y=n.y+1,u.z=n.z,e=t.UNIT_Z),s=(t.dot(i,u)+r)/-t.dot(i,e),t.normalize(t.subtract(t.add(u,t.multiplyByScalar(e,s,o),u),n,u),u)};g=new t;c._rotationVector=function(n,i,r,u,f){var e=t.subtract(u,n,g),s,h;return(e=t.normalize(e,e),t.dot(i,e)<.9999999847691291&&(s=t.cross(i,e,e),h=t.magnitude(s),h>o.EPSILON13))?t.normalize(s,new t):f};var p=new t,tt=new t,v=new t,nt=new t;return c._horizonToPlaneNormalDotProduct=function(n,i,r,u,f){var c=t.clone(f,p),s=t.clone(n.center,tt),k=n.radius,o=t.subtract(s,c,v),l=t.magnitudeSquared(o),d=k*k,y,w,b;if(l<d)return!1;var g=l-d,it=Math.sqrt(g),ut=Math.sqrt(l),ft=1/ut,et=it*ft,a=et*it;o=t.normalize(o,o);var rt=t.add(c,t.multiplyByScalar(o,a,nt),nt),ot=Math.sqrt(g-a*a),e=this._rotationVector(s,i,r,c,u),h=t.fromElements(e.x*e.x*o.x+(e.x*e.y-e.z)*o.y+(e.x*e.z+e.y)*o.z,(e.x*e.y+e.z)*o.x+e.y*e.y*o.y+(e.y*e.z-e.x)*o.z,(e.x*e.z-e.y)*o.x+(e.y*e.z+e.x)*o.y+e.z*e.z*o.z,p);return h=t.normalize(h,h),y=t.multiplyByScalar(h,ot,p),e=t.normalize(t.subtract(t.add(rt,y,v),s,v),v),w=t.dot(i,e),e=t.normalize(t.subtract(t.subtract(rt,y,e),s,e),e),b=t.dot(i,e),w<b?w:b},c});t("Core/OffsetGeometryInstanceAttribute",["./Check","./ComponentDatatype","./defaultValue","./defined","./defineProperties"],function(n,t,i,r,u){"use strict";function f(n,t,r){n=i(n,0);t=i(t,0);r=i(r,0);this.value=new Float32Array([n,t,r])}return u(f.prototype,{componentDatatype:{get:function(){return t.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),f.fromCartesian3=function(t){return n.defined("offset",t),new f(t.x,t.y,t.z)},f.toValue=function(t,i){return n.defined("offset",t),r(i)||(i=new Float32Array([t.x,t.y,t.z])),i[0]=t.x,i[1]=t.y,i[2]=t.z,i},f});t("Core/OpenCageGeocoderService",["./Cartesian3","./Check","./combine","./defaultValue","./defined","./defineProperties","./GeocodeType","./Rectangle","./Resource"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(n,i,f){t.defined("url",n);t.defined("apiKey",i);u(f)&&t.typeOf.object("params",f);n=s.createIfNeeded(n);n.appendForwardSlash();n.setQueryParameters({key:i});this._url=n;this._params=r(f,{})}return f(h.prototype,{url:{get:function(){return this._url}},params:{get:function(){return this._params}}}),h.prototype.geocode=function(r){t.typeOf.string("query",r);var f=this._url.getDerivedResource({url:"json",queryParameters:i(this._params,{q:r})});return f.fetchJson().then(function(t){return t.results.map(function(t){var r,i=t.bounds,f,e;return u(i)?r=o.fromDegrees(i.southwest.lng,i.southwest.lat,i.northeast.lng,i.northeast.lat):(f=t.geometry.lat,e=t.geometry.lng,r=n.fromDegrees(f,e)),{displayName:t.formatted,destination:r}})})},h});t("Core/Packable",["./DeveloperError"],function(n){"use strict";return{packedLength:undefined,pack:n.throwInstantiationError,unpack:n.throwInstantiationError}});t("Core/PackableForInterpolation",["./DeveloperError"],function(n){"use strict";return{packedInterpolationLength:undefined,convertPackedArrayForInterpolation:n.throwInstantiationError,unpackInterpolationResult:n.throwInstantiationError}});t("ThirdParty/measureText",[],function(){var n=function(n,t){return document.defaultView.getComputedStyle(n,null).getPropertyValue(t)};return function(t,i,r,u){var e=t.measureText(i),d=n(t.canvas,"font-family"),c=n(t.canvas,"font-size").replace("px",""),g=n(t.canvas,"font-style"),nt=n(t.canvas,"font-weight"),et=!/\S/.test(i),h,y,o,a,s,b,k,rt,ut,ft;if(e.fontsize=c,h=document.createElement("div"),h.style.position="absolute",h.style.opacity=0,h.style.font=g+" "+nt+" "+c+"px "+d,h.innerHTML=i+"<br/>"+i,document.body.appendChild(h),e.leading=1.2*c,y=n(h,"height"),y=y.replace("px",""),y>=c*2&&(e.leading=y/2|0),document.body.removeChild(h),et)e.ascent=0,e.descent=0,e.bounds={minx:0,maxx:e.width,miny:0,maxy:0},e.height=0;else{o=document.createElement("canvas");a=100;o.width=e.width+a;o.height=3*c;o.style.opacity=1;o.style.fontFamily=d;o.style.fontSize=c;o.style.fontStyle=g;o.style.fontWeight=nt;s=o.getContext("2d");s.font=g+" "+nt+" "+c+"px "+d;var tt=o.width,it=o.height,w=it/2;s.fillStyle="white";s.fillRect(-1,-1,tt+2,it+2);r&&(s.strokeStyle="black",s.lineWidth=t.lineWidth,s.strokeText(i,a/2,w));u&&(s.fillStyle="black",s.fillText(i,a/2,w));for(var p=s.getImageData(0,0,tt,it).data,f=0,v=tt*4,l=p.length;++f<l&&p[f]===255;);for(b=f/v|0,f=l-1;--f>0&&p[f]===255;);for(k=f/v|0,f=0;f<l&&p[f]===255;)f+=v,f>=l&&(f=f-l+4);for(rt=f%v/4|0,ut=1,f=l-3;f>=0&&p[f]===255;)f-=v,f<0&&(f=l-3-ut++*4);ft=f%v/4+1|0;e.ascent=w-b;e.descent=k-w;e.bounds={minx:rt-a/2,maxx:ft-a/2,miny:0,maxy:k-b};e.height=1+(k-b)}return e}});t("Core/writeTextToCanvas",["../ThirdParty/measureText","./Color","./defaultValue","./defined","./DeveloperError"],function(n,t,i,r,u){"use strict";function e(e,o){var s,c,nt,tt;if(!r(e))throw new u("text is required.");if(e==="")return undefined;o=i(o,i.EMPTY_OBJECT);var a=i(o.font,"10px sans-serif"),w=i(o.stroke,!1),b=i(o.fill,!0),k=i(o.strokeWidth,1),d=i(o.backgroundColor,t.TRANSPARENT),v=i(o.padding,0),l=v*2,h=document.createElement("canvas");h.width=1;h.height=1;h.style.font=a;s=h.getContext("2d");r(f)||(r(s.imageSmoothingEnabled)?f="imageSmoothingEnabled":r(s.mozImageSmoothingEnabled)?f="mozImageSmoothingEnabled":r(s.webkitImageSmoothingEnabled)?f="webkitImageSmoothingEnabled":r(s.msImageSmoothingEnabled)&&(f="msImageSmoothingEnabled"));s.font=a;s.lineJoin="round";s.lineWidth=k;s[f]=!1;s.textBaseline=i(o.textBaseline,"bottom");h.style.visibility="hidden";document.body.appendChild(h);c=n(s,e,w,b);h.dimensions=c;document.body.removeChild(h);h.style.visibility="";var y=-c.bounds.minx,it=Math.ceil(c.width)+y+l,p=c.height+l,rt=p-c.ascent+l,g=p-rt+l;return h.width=it,h.height=p,s.font=a,s.lineJoin="round",s.lineWidth=k,s[f]=!1,d!==t.TRANSPARENT&&(s.fillStyle=d.toCssColorString(),s.fillRect(0,0,h.width,h.height)),w&&(nt=i(o.strokeColor,t.BLACK),s.strokeStyle=nt.toCssColorString(),s.strokeText(e,y+v,g)),b&&(tt=i(o.fillColor,t.WHITE),s.fillStyle=tt.toCssColorString(),s.fillText(e,y+v,g)),h}var f;return e});t("Core/PinBuilder",["./buildModuleUrl","./Color","./defined","./DeveloperError","./Resource","./writeTextToCanvas"],function(n,t,i,r,u,f){"use strict";function o(){this._cache={}}function l(n,t,i){n.save();n.scale(i/24,i/24);n.fillStyle=t.toCssColorString();n.strokeStyle=t.brighten(.6,h).toCssColorString();n.lineWidth=.846;n.beginPath();n.moveTo(6.72,.422);n.lineTo(17.28,.422);n.bezierCurveTo(18.553,.422,19.577,1.758,19.577,3.415);n.lineTo(19.577,10.973);n.bezierCurveTo(19.577,12.63,18.553,13.966,17.282,13.966);n.lineTo(14.386,14.008);n.lineTo(11.826,23.578);n.lineTo(9.614,14.008);n.lineTo(6.719,13.965);n.bezierCurveTo(5.446,13.983,4.422,12.629,4.422,10.972);n.lineTo(4.422,3.416);n.bezierCurveTo(4.423,1.76,5.447,.423,6.718,.423);n.closePath();n.fill();n.stroke();n.restore()}function c(n,i,r){var s=r/2.5,u=s,f=s,e,o;i.width>i.height?f=s*(i.height/i.width):i.width<i.height&&(u=s*(i.width/i.height));e=Math.round((r-u)/2);o=Math.round(7/24*r-f/2);n.globalCompositeOperation="destination-out";n.drawImage(i,e-1,o,u,f);n.drawImage(i,e,o-1,u,f);n.drawImage(i,e+1,o,u,f);n.drawImage(i,e,o+1,u,f);n.globalCompositeOperation="destination-over";n.fillStyle=t.BLACK.toCssColorString();n.fillRect(e-1,o-1,u+2,f+2);n.globalCompositeOperation="destination-out";n.drawImage(i,e,o,u,f);n.globalCompositeOperation="destination-over";n.fillStyle=t.WHITE.toCssColorString();n.fillRect(e-1,o-2,u+2,f+2)}function s(n,t,r,o,s){var a,y,h,v,w,p,b;return(e[0]=n,e[1]=t,e[2]=r,e[3]=o,a=JSON.stringify(e),y=s[a],i(y))?y:(h=document.createElement("canvas"),h.width=o,h.height=o,v=h.getContext("2d"),l(v,r,o),i(n))?(w=u.createIfNeeded(n),p=w.fetchImage().then(function(n){return c(v,n,o),s[a]=h,h}),s[a]=p,p):(i(t)&&(b=f(t,{font:"bold "+o+"px sans-serif"}),c(v,b,o)),s[a]=h,h)}var h,e;return o.prototype.fromColor=function(n,t){if(!i(n))throw new r("color is required");if(!i(t))throw new r("size is required");return s(undefined,undefined,n,t,this._cache)},o.prototype.fromUrl=function(n,t,u){if(!i(n))throw new r("url is required");if(!i(t))throw new r("color is required");if(!i(u))throw new r("size is required");return s(n,undefined,t,u,this._cache)},o.prototype.fromMakiIconId=function(t,u,f){if(!i(t))throw new r("id is required");if(!i(u))throw new r("color is required");if(!i(f))throw new r("size is required");return s(n("Assets/Textures/maki/"+encodeURIComponent(t)+".png"),undefined,u,f,this._cache)},o.prototype.fromText=function(n,t,u){if(!i(n))throw new r("text is required");if(!i(t))throw new r("color is required");if(!i(u))throw new r("size is required");return s(undefined,n,t,u,this._cache)},h=new t,e=new Array(4),o});t("Core/PlaneGeometry",["./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./Geometry","./GeometryAttribute","./GeometryAttributes","./PrimitiveType","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function l(n){n=u(n,u.EMPTY_OBJECT);var t=u(n.vertexFormat,c.DEFAULT);this._vertexFormat=t;this._workerName="createPlaneGeometry"}var y,p,a,v;return l.packedLength=c.packedLength,l.pack=function(n,t,r){return i.typeOf.object("value",n),i.defined("array",t),r=u(r,0),c.pack(n._vertexFormat,t,r),t},y=new c,p={vertexFormat:y},l.unpack=function(n,t,r){i.defined("array",n);t=u(t,0);var e=c.unpack(n,t,y);return f(r)?(r._vertexFormat=c.clone(e,r._vertexFormat),r):new l(p)},a=new t(-.5,-.5,0),v=new t(.5,.5,0),l.createGeometry=function(i){var b=i._vertexFormat,w=new s,p,u,f,y,c,l;return b.position&&(u=new Float64Array(12),u[0]=a.x,u[1]=a.y,u[2]=0,u[3]=v.x,u[4]=a.y,u[5]=0,u[6]=v.x,u[7]=v.y,u[8]=0,u[9]=a.x,u[10]=v.y,u[11]=0,w.position=new o({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:u}),b.normal&&(f=new Float32Array(12),f[0]=0,f[1]=0,f[2]=1,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=1,f[9]=0,f[10]=0,f[11]=1,w.normal=new o({componentDatatype:r.FLOAT,componentsPerAttribute:3,values:f})),b.st&&(y=new Float32Array(8),y[0]=0,y[1]=0,y[2]=1,y[3]=0,y[4]=1,y[5]=1,y[6]=0,y[7]=1,w.st=new o({componentDatatype:r.FLOAT,componentsPerAttribute:2,values:y})),b.tangent&&(c=new Float32Array(12),c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=0,c[5]=0,c[6]=1,c[7]=0,c[8]=0,c[9]=1,c[10]=0,c[11]=0,w.tangent=new o({componentDatatype:r.FLOAT,componentsPerAttribute:3,values:c})),b.bitangent&&(l=new Float32Array(12),l[0]=0,l[1]=1,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=1,l[8]=0,l[9]=0,l[10]=1,l[11]=0,w.bitangent=new o({componentDatatype:r.FLOAT,componentsPerAttribute:3,values:l})),p=new Uint16Array(6),p[0]=0,p[1]=1,p[2]=2,p[3]=0,p[4]=2,p[5]=3),new e({attributes:w,indices:p,primitiveType:h.TRIANGLES,boundingSphere:new n(t.ZERO,Math.sqrt(2))})},l});t("Core/PlaneOutlineGeometry",["./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defined","./Geometry","./GeometryAttribute","./GeometryAttributes","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s){"use strict";function c(){this._workerName="createPlaneOutlineGeometry"}c.packedLength=0;c.pack=function(n,t){return i.defined("value",n),i.defined("array",t),t};c.unpack=function(n,t,r){return(i.defined("array",n),!u(r))?new c:r};var h=new t(-.5,-.5,0),l=new t(.5,.5,0);return c.createGeometry=function(){var c=new o,u=new Uint16Array(8),i=new Float64Array(12);return i[0]=h.x,i[1]=h.y,i[2]=h.z,i[3]=l.x,i[4]=h.y,i[5]=h.z,i[6]=l.x,i[7]=l.y,i[8]=h.z,i[9]=h.x,i[10]=l.y,i[11]=h.z,c.position=new e({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:i}),u[0]=0,u[1]=1,u[2]=1,u[3]=2,u[4]=2,u[5]=3,u[6]=3,u[7]=0,new f({attributes:c,indices:u,primitiveType:s.LINES,boundingSphere:new n(t.ZERO,Math.sqrt(2))})},c});t("Core/pointInsideTriangle",["./barycentricCoordinates","./Cartesian3"],function(n,t){"use strict";function r(t,r,u,f){return n(t,r,u,f,i),i.x>0&&i.y>0&&i.z>0}var i=new t;return r});t("Core/PolygonGeometry",["./arrayFill","./BoundingRectangle","./BoundingSphere","./Cartesian2","./Cartesian3","./Cartographic","./Check","./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./EllipsoidTangentPlane","./Geometry","./GeometryAttribute","./GeometryInstance","./GeometryOffsetAttribute","./GeometryPipeline","./IndexDatatype","./Math","./Matrix2","./Matrix3","./PolygonGeometryLibrary","./PolygonPipeline","./Quaternion","./Rectangle","./VertexFormat","./WindingOrder"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot){"use strict";function kt(n,t,i,r){var o=r.cartesianToCartographic(n,bt),f=o.height,e=r.cartesianToCartographic(t,vt),u;e.height=f;r.cartographicToCartesian(e,t);u=r.cartesianToCartographic(i,vt);u.height=f-100;r.cartographicToCartesian(u,i)}function at(t){var i=t.vertexFormat,nt=t.geometry,bt=t.shadowVolume,dt=nt.attributes.position.values,k=dt.length,et=t.wall,rt=t.top||et,st=t.bottom||et,vt,a,ki,e,di,ot,it,vi,yi,rr,ur,y,w,wt,pi,fr,ft,er;if(i.st||i.normal||i.tangent||i.bitangent||bt){var wi=t.boundingRectangle,gi=t.tangentPlane,ci=t.ellipsoid,nr=t.stRotation,at=t.perPositionHeight,tr=fi;tr.x=wi.x;tr.y=wi.y;vt=i.st?new Float32Array(2*(k/3)):undefined;i.normal&&(a=at&&rt&&!et?nt.attributes.normal.values:new Float32Array(k));var l=i.tangent?new Float32Array(k):undefined,d=i.bitangent?new Float32Array(k):undefined,bi=bt?new Float32Array(k):undefined,li=0,c=0,f=ni,s=ti,v=ii,ir=!0,ai=si,pt=hi;for(nr!==0?(ki=ut.fromAxisAngle(gi._plane.normal,nr,yt),ai=tt.fromQuaternion(ki,ai),ki=ut.fromAxisAngle(gi._plane.normal,-nr,yt),pt=tt.fromQuaternion(ki,pt)):(ai=tt.clone(tt.IDENTITY,ai),pt=tt.clone(tt.IDENTITY,pt)),e=0,di=0,rt&&st&&(e=k/2,di=k/3,k/=2),ot=0;ot<k;ot+=3)it=u.fromArray(dt,ot,oi),i.st&&(vi=tt.multiplyByVector(ai,it,gt),vi=ci.scaleToGeodeticSurface(vi,vi),yi=gi.projectPointOntoPlane(vi,ei),r.subtract(yi,tr,yi),rr=g.clamp(yi.x/wi.width,0,1),ur=g.clamp(yi.y/wi.height,0,1),st&&(vt[li+di]=rr,vt[li+1+di]=ur),rt&&(vt[li]=rr,vt[li+1]=ur),li+=2),(i.normal||i.tangent||i.bitangent||bt)&&(y=c+1,w=c+2,et?(ot+3<k&&(wt=u.fromArray(dt,ot+3,ri),ir&&(pi=u.fromArray(dt,ot+k,ui),at&&kt(it,wt,pi,ci),u.subtract(wt,it,wt),u.subtract(pi,it,pi),f=u.normalize(u.cross(pi,wt,f),f),ir=!1),u.equalsEpsilon(wt,it,g.EPSILON10)&&(ir=!0)),(i.tangent||i.bitangent)&&(v=ci.geodeticSurfaceNormal(it,v),i.tangent&&(s=u.normalize(u.cross(v,f,s),s)))):(f=ci.geodeticSurfaceNormal(it,f),(i.tangent||i.bitangent)&&(at&&(lt=u.fromArray(a,c,lt),ht=u.cross(u.UNIT_Z,lt,ht),ht=u.normalize(tt.multiplyByVector(pt,ht,ht),ht),i.bitangent&&(ct=u.normalize(u.cross(lt,ht,ct),ct))),s=u.cross(u.UNIT_Z,f,s),s=u.normalize(tt.multiplyByVector(pt,s,s),s),i.bitangent&&(v=u.normalize(u.cross(f,s,v),v)))),i.normal&&(t.wall?(a[c+e]=f.x,a[y+e]=f.y,a[w+e]=f.z):st&&(a[c+e]=-f.x,a[y+e]=-f.y,a[w+e]=-f.z),(rt&&!at||et)&&(a[c]=f.x,a[y]=f.y,a[w]=f.z)),bt&&(et&&(f=ci.geodeticSurfaceNormal(it,f)),bi[c+e]=-f.x,bi[y+e]=-f.y,bi[w+e]=-f.z),i.tangent&&(t.wall?(l[c+e]=s.x,l[y+e]=s.y,l[w+e]=s.z):st&&(l[c+e]=-s.x,l[y+e]=-s.y,l[w+e]=-s.z),rt&&(at?(l[c]=ht.x,l[y]=ht.y,l[w]=ht.z):(l[c]=s.x,l[y]=s.y,l[w]=s.z))),i.bitangent&&(st&&(d[c+e]=v.x,d[y+e]=v.y,d[w+e]=v.z),rt&&(at?(d[c]=ct.x,d[y]=ct.y,d[w]=ct.z):(d[c]=v.x,d[y]=v.y,d[w]=v.z))),c+=3);i.st&&(nt.attributes.st=new p({componentDatatype:o.FLOAT,componentsPerAttribute:2,values:vt}));i.normal&&(nt.attributes.normal=new p({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:a}));i.tangent&&(nt.attributes.tangent=new p({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:l}));i.bitangent&&(nt.attributes.bitangent=new p({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:d}));bt&&(nt.attributes.extrudeDirection=new p({componentDatatype:o.FLOAT,componentsPerAttribute:3,values:bi}))}return t.extrude&&h(t.offsetAttribute)&&(fr=dt.length/3,ft=new Uint8Array(fr),t.offsetAttribute===b.TOP?rt&&st||et?ft=n(ft,1,0,fr/2):rt&&(ft=n(ft,1)):(er=t.offsetAttribute===b.NONE?0:1,ft=n(ft,er)),nt.attributes.applyOffset=new p({componentDatatype:o.UNSIGNED_BYTE,componentsPerAttribute:1,values:ft})),nt}function pt(n,t,i){return!h(n)||n.length<3?h(i)?(i.west=0,i.north=0,i.south=0,i.east=0,i):new ft:ft.fromCartesianArray(n,t,i)}function ci(n,t,i,r,u,f,e,o){var k={walls:[]},s,g,p,nt,ct,tt,ht,a;if(f||e){var c=it.createGeometryFromPositions(n,t,i,u,o),ut=c.attributes.position.values,l=c.indices,y,h;if(f&&e){for(g=ut.concat(ut),y=g.length/3,h=d.createTypedArray(y,l.length*2),h.set(l),p=l.length,nt=y/2,s=0;s<p;s+=3){var lt=h[s]+nt,at=h[s+1]+nt,vt=h[s+2]+nt;h[s+p]=vt;h[s+1+p]=at;h[s+2+p]=lt}c.attributes.position.values=g;u&&o.normal&&(ct=c.attributes.normal.values,c.attributes.normal.values=new Float32Array(g.length),c.attributes.normal.values.set(ct));c.indices=h}else if(e){for(y=ut.length/3,h=d.createTypedArray(y,l.length),s=0;s<l.length;s+=3)h[s]=l[s+2],h[s+1]=l[s+1],h[s+2]=l[s];c.indices=h}k.topAndBottom=new w({geometry:c})}var b=r.outerRing,ft=v.fromPoints(b,n),et=ft.projectPointsOntoPlane(b,wt),st=rt.computeWindingOrder2D(et);for(st===ot.CLOCKWISE&&(b=b.slice().reverse()),tt=it.computeWallGeometry(b,n,i,u),k.walls.push(new w({geometry:tt})),ht=r.holes,s=0;s<ht.length;s++)a=ht[s],ft=v.fromPoints(a,n),et=ft.projectPointsOntoPlane(a,wt),st=rt.computeWindingOrder2D(et),st===ot.COUNTER_CLOCKWISE&&(a=a.slice().reverse()),tt=it.computeWallGeometry(a,n,i),k.walls.push(new w({geometry:tt}));return k}function st(n){var o;if(e.typeOf.object("options",n),e.typeOf.object("options.polygonHierarchy",n.polygonHierarchy),h(n.perPositionHeight)&&n.perPositionHeight&&h(n.height))throw new l("Cannot use both options.perPositionHeight and options.height");var r=n.polygonHierarchy,c=s(n.vertexFormat,et.DEFAULT),v=s(n.ellipsoid,a.WGS84),y=s(n.granularity,g.RADIANS_PER_DEGREE),p=s(n.stRotation,0),u=s(n.perPositionHeight,!1),f=u&&h(n.extrudedHeight),t=s(n.height,0),i=s(n.extrudedHeight,t);f||(o=Math.max(t,i),i=Math.min(t,i),t=o);this._vertexFormat=et.clone(c);this._ellipsoid=a.clone(v);this._granularity=y;this._stRotation=p;this._height=t;this._extrudedHeight=i;this._closeTop=s(n.closeTop,!0);this._closeBottom=s(n.closeBottom,!0);this._polygonHierarchy=r;this._perPositionHeight=u;this._perPositionHeightExtrude=f;this._shadowVolume=s(n.shadowVolume,!1);this._workerName="createPolygonGeometry";this._offsetAttribute=n.offsetAttribute;this._rectangle=undefined;this._textureCoordinateRotationPoints=undefined;this.packedLength=it.computeHierarchyPackedLength(r)+a.packedLength+et.packedLength+11}function yi(n){var t=-n._stRotation;if(t===0)return[0,0,0,1,1,0];var i=n._ellipsoid,r=n._polygonHierarchy.positions,u=n.rectangle;return y._textureCoordinateRotationPoints(r,t,i,u)}var bt=new f,vt=new f,dt=new t,gt=new u,ni=new u,ti=new u,ii=new u,ri=new u,ui=new u,lt=new u,ht=new u,ct=new u,fi=new r,ei=new r,oi=new u,yt=new ut,si=new tt,hi=new tt,wt=[];st.fromPositions=function(n){n=s(n,s.EMPTY_OBJECT);e.defined("options.positions",n.positions);var t={polygonHierarchy:{positions:n.positions},height:n.height,extrudedHeight:n.extrudedHeight,vertexFormat:n.vertexFormat,stRotation:n.stRotation,ellipsoid:n.ellipsoid,granularity:n.granularity,perPositionHeight:n.perPositionHeight,closeTop:n.closeTop,closeBottom:n.closeBottom,offsetAttribute:n.offsetAttribute};return new st(t)};st.pack=function(n,t,i){return e.typeOf.object("value",n),e.defined("array",t),i=s(i,0),i=it.packPolygonHierarchy(n._polygonHierarchy,t,i),a.pack(n._ellipsoid,t,i),i+=a.packedLength,et.pack(n._vertexFormat,t,i),i+=et.packedLength,t[i++]=n._height,t[i++]=n._extrudedHeight,t[i++]=n._granularity,t[i++]=n._stRotation,t[i++]=n._perPositionHeightExtrude?1:0,t[i++]=n._perPositionHeight?1:0,t[i++]=n._closeTop?1:0,t[i++]=n._closeBottom?1:0,t[i++]=n._shadowVolume?1:0,t[i++]=s(n._offsetAttribute,-1),t[i]=n.packedLength,t};var li=a.clone(a.UNIT_SPHERE),ai=new et,vi={polygonHierarchy:{}};return st.unpack=function(n,t,i){var r,u,f;e.defined("array",n);t=s(t,0);r=it.unpackPolygonHierarchy(n,t);t=r.startingIndex;delete r.startingIndex;u=a.unpack(n,t,li);t+=a.packedLength;f=et.unpack(n,t,ai);t+=et.packedLength;var c=n[t++],l=n[t++],v=n[t++],y=n[t++],p=n[t++]===1,w=n[t++]===1,b=n[t++]===1,k=n[t++]===1,d=n[t++]===1,o=n[t++],g=n[t];return h(i)||(i=new st(vi)),i._polygonHierarchy=r,i._ellipsoid=a.clone(u,i._ellipsoid),i._vertexFormat=et.clone(f,i._vertexFormat),i._height=c,i._extrudedHeight=l,i._granularity=v,i._stRotation=y,i._perPositionHeightExtrude=p,i._perPositionHeight=w,i._closeTop=b,i._closeBottom=k,i._shadowVolume=d,i._offsetAttribute=o===-1?undefined:o,i.packedLength=g,i},st.computeRectangle=function(n,t){e.typeOf.object("options",n);e.typeOf.object("options.polygonHierarchy",n.polygonHierarchy);var i=n.polygonHierarchy,r=s(n.ellipsoid,a.WGS84);return pt(i.positions,r,t)},st.createGeometry=function(t){var et=t._vertexFormat,f=t._ellipsoid,bt=t._granularity,kt=t._stRotation,gt=t._polygonHierarchy,c=t._perPositionHeight,nt=t._closeTop,tt=t._closeBottom,ot=gt.positions,ft,u,wt,lt,vt,l,s,yt,ii;if(!(ot.length<3)){var a=v.fromPoints(ot,f),ni=it.polygonsFromHierarchy(gt,a.projectPointsOntoPlane.bind(a),!c,f),pt=ni.hierarchy,st=ni.polygons;if(pt.length!==0){ot=pt[0].outerRing;var ri=it.computeBoundingRectangle(a.plane.normal,a.projectPointOntoPlane.bind(a),ot,kt,dt),ht=[],ut=t._height,ct=t._extrudedHeight,ui=t._perPositionHeightExtrude||!g.equalsEpsilon(ut,ct,0,g.EPSILON2),r={perPositionHeight:c,vertexFormat:et,geometry:undefined,tangentPlane:a,boundingRectangle:ri,ellipsoid:f,stRotation:kt,bottom:!1,top:!0,wall:!1,extrude:!1},e;if(ui)for(r.extrude=!0,r.top=nt,r.bottom=tt,r.shadowVolume=t._shadowVolume,r.offsetAttribute=t._offsetAttribute,e=0;e<st.length;e++)for(ft=ci(f,st[e],bt,pt[e],c,nt,tt,et),nt&&tt?(u=ft.topAndBottom,r.geometry=it.scaleToGeodeticHeightExtruded(u.geometry,ut,ct,f,c)):nt?(u=ft.topAndBottom,u.geometry.attributes.position.values=rt.scaleToGeodeticHeight(u.geometry.attributes.position.values,ut,f,!c),r.geometry=u.geometry):tt&&(u=ft.topAndBottom,u.geometry.attributes.position.values=rt.scaleToGeodeticHeight(u.geometry.attributes.position.values,ct,f,!0),r.geometry=u.geometry),(nt||tt)&&(r.wall=!1,u.geometry=at(r),ht.push(u)),wt=ft.walls,r.wall=!0,lt=0;lt<wt.length;lt++)vt=wt[lt],r.geometry=it.scaleToGeodeticHeightExtruded(vt.geometry,ut,ct,f,c),vt.geometry=at(r),ht.push(vt);else for(e=0;e<st.length;e++){if(l=new w({geometry:it.createGeometryFromPositions(f,st[e],bt,c,et)}),l.geometry.attributes.position.values=rt.scaleToGeodeticHeight(l.geometry.attributes.position.values,ut,f,!c),r.geometry=l.geometry,l.geometry=at(r),h(t._offsetAttribute)){var fi=l.geometry.attributes.position.values.length,ti=new Uint8Array(fi/3),ei=t._offsetAttribute===b.NONE?0:1;n(ti,ei);l.geometry.attributes.applyOffset=new p({componentDatatype:o.UNSIGNED_BYTE,componentsPerAttribute:1,values:ti})}ht.push(l)}return s=k.combineInstances(ht)[0],s.attributes.position.values=new Float64Array(s.attributes.position.values),s.indices=d.createTypedArray(s.attributes.position.values.length/3,s.indices),yt=s.attributes,ii=i.fromVertices(yt.position.values),et.position||delete yt.position,new y({attributes:yt,indices:s.indices,primitiveType:s.primitiveType,boundingSphere:ii,offsetAttribute:t._offsetAttribute})}}},st.createShadowVolume=function(n,t,i){var r=n._granularity,u=n._ellipsoid,f=t(r,u),e=i(r,u);return new st({polygonHierarchy:n._polygonHierarchy,ellipsoid:u,stRotation:n._stRotation,granularity:r,perPositionHeight:!1,extrudedHeight:f,height:e,vertexFormat:et.POSITION_ONLY,shadowVolume:!0})},c(st.prototype,{rectangle:{get:function(){if(!h(this._rectangle)){var n=this._polygonHierarchy.positions;this._rectangle=pt(n,this._ellipsoid)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return h(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=yi(this)),this._textureCoordinateRotationPoints}}}),st});t("Core/PolygonHierarchy",["./defined"],function(n){"use strict";function t(t,i){this.positions=n(t)?t:[];this.holes=n(i)?i:[]}return t});t("Core/PolygonOutlineGeometry",["./arrayFill","./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Check","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./EllipsoidTangentPlane","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryInstance","./GeometryOffsetAttribute","./GeometryPipeline","./IndexDatatype","./Math","./PolygonGeometryLibrary","./PolygonPipeline","./PrimitiveType","./Queue","./WindingOrder"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){"use strict";function st(n,t,i,r){var ht=c.fromPoints(t,n),et=ht.projectPointsOntoPlane(t,ut),ct=g.computeWindingOrder2D(et),s,u,e,o,tt,rt,ot,p,w,k,st,h;if(ct===it.CLOCKWISE&&(et.reverse(),t=t.slice().reverse()),e=t.length,o=0,r)for(s=new Float64Array(e*6),u=0;u<e;u++)w=t[u],k=t[(u+1)%e],s[o++]=w.x,s[o++]=w.y,s[o++]=w.z,s[o++]=k.x,s[o++]=k.y,s[o++]=k.z;else{for(tt=0,u=0;u<e;u++)tt+=d.subdivideLineCount(t[u],t[(u+1)%e],i);for(s=new Float64Array(tt*3),u=0;u<e;u++)for(rt=d.subdivideLine(t[u],t[(u+1)%e],i,ft),ot=rt.length,p=0;p<ot;++p)s[o++]=rt[p]}for(e=s.length/3,st=e*2,h=b.createTypedArray(e,st),o=0,u=0;u<e-1;u++)h[o++]=u,h[o++]=u+1;return h[o++]=e-1,h[o++]=0,new y({geometry:new l({attributes:new v({position:new a({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:s})}),indices:h,primitiveType:nt.LINES})})}function ht(n,t,i,r){var lt=c.fromPoints(t,n),st=lt.projectPointsOntoPlane(t,ut),at=g.computeWindingOrder2D(st),rt,et,ht,w,k,tt,ot;at===it.CLOCKWISE&&(st.reverse(),t=t.slice().reverse());var s,u,e=t.length,p=new Array(e),o=0;if(r)for(s=new Float64Array(e*12),u=0;u<e;++u)p[u]=o/3,k=t[u],tt=t[(u+1)%e],s[o++]=k.x,s[o++]=k.y,s[o++]=k.z,s[o++]=tt.x,s[o++]=tt.y,s[o++]=tt.z;else{for(rt=0,u=0;u<e;u++)rt+=d.subdivideLineCount(t[u],t[(u+1)%e],i);for(s=new Float64Array(rt*6),u=0;u<e;++u)for(p[u]=o/3,et=d.subdivideLine(t[u],t[(u+1)%e],i,ft),ht=et.length,w=0;w<ht;++w)s[o++]=et[w]}e=s.length/6;var ct=p.length,vt=(e*2+ct)*2,h=b.createTypedArray(e,vt);for(o=0,u=0;u<e;++u)h[o++]=u,h[o++]=(u+1)%e,h[o++]=u+e,h[o++]=(u+1)%e+e;for(u=0;u<ct;u++)ot=p[u],h[o++]=ot,h[o++]=ot+e;return new y({geometry:new l({attributes:new v({position:new a({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:s})}),indices:h,primitiveType:nt.LINES})})}function rt(n){var l;if(u.typeOf.object("options",n),u.typeOf.object("options.polygonHierarchy",n.polygonHierarchy),n.perPositionHeight&&o(n.height))throw new s("Cannot use both options.perPositionHeight and options.height");var r=n.polygonHierarchy,a=e(n.ellipsoid,h.WGS84),v=e(n.granularity,k.RADIANS_PER_DEGREE),f=e(n.perPositionHeight,!1),c=f&&o(n.extrudedHeight),t=e(n.height,0),i=e(n.extrudedHeight,t);c||(l=Math.max(t,i),i=Math.min(t,i),t=l);this._ellipsoid=h.clone(a);this._granularity=v;this._height=t;this._extrudedHeight=i;this._polygonHierarchy=r;this._perPositionHeight=f;this._perPositionHeightExtrude=c;this._offsetAttribute=n.offsetAttribute;this._workerName="createPolygonOutlineGeometry";this.packedLength=d.computeHierarchyPackedLength(r)+h.packedLength+7}var ut=[],ft=[],et,ot;return rt.pack=function(n,t,i){return u.typeOf.object("value",n),u.defined("array",t),i=e(i,0),i=d.packPolygonHierarchy(n._polygonHierarchy,t,i),h.pack(n._ellipsoid,t,i),i+=h.packedLength,t[i++]=n._height,t[i++]=n._extrudedHeight,t[i++]=n._granularity,t[i++]=n._perPositionHeightExtrude?1:0,t[i++]=n._perPositionHeight?1:0,t[i++]=e(n._offsetAttribute,-1),t[i]=n.packedLength,t},et=h.clone(h.UNIT_SPHERE),ot={polygonHierarchy:{}},rt.unpack=function(n,t,i){var r,f;u.defined("array",n);t=e(t,0);r=d.unpackPolygonHierarchy(n,t);t=r.startingIndex;delete r.startingIndex;f=h.unpack(n,t,et);t+=h.packedLength;var c=n[t++],l=n[t++],a=n[t++],v=n[t++]===1,y=n[t++]===1,s=n[t++],p=n[t];return o(i)||(i=new rt(ot)),i._polygonHierarchy=r,i._ellipsoid=h.clone(f,i._ellipsoid),i._height=c,i._extrudedHeight=l,i._granularity=a,i._perPositionHeight=y,i._perPositionHeightExtrude=v,i._offsetAttribute=s===-1?undefined:s,i.packedLength=p,i},rt.fromPositions=function(n){n=e(n,e.EMPTY_OBJECT);u.defined("options.positions",n.positions);var t={polygonHierarchy:{positions:n.positions},height:n.height,extrudedHeight:n.extrudedHeight,ellipsoid:n.ellipsoid,granularity:n.granularity,perPositionHeight:n.perPositionHeight,offsetAttribute:n.offsetAttribute};return new rt(t)},rt.createGeometry=function(t){var e=t._ellipsoid,ot=t._granularity,ct=t._polygonHierarchy,h=t._perPositionHeight,c=d.polygonOutlinesFromHierarchy(ct,!h,e),tt,s,ft,it,v,et;if(c.length===0)return undefined;var r,b=[],rt=k.chordLength(ot,e.maximumRadius),nt=t._height,ut=t._extrudedHeight,lt=t._perPositionHeightExtrude||!k.equalsEpsilon(nt,ut,0,k.EPSILON2),y,u;if(lt)for(u=0;u<c.length;u++)r=ht(e,c[u],rt,h),r.geometry=d.scaleToGeodeticHeightExtruded(r.geometry,nt,ut,e,h),o(t._offsetAttribute)&&(tt=r.geometry.attributes.position.values.length/3,s=new Uint8Array(tt),t._offsetAttribute===p.TOP?s=n(s,1,0,tt/2):(y=t._offsetAttribute===p.NONE?0:1,s=n(s,y)),r.geometry.attributes.applyOffset=new a({componentDatatype:f.UNSIGNED_BYTE,componentsPerAttribute:1,values:s})),b.push(r);else for(u=0;u<c.length;u++)r=st(e,c[u],rt,h),r.geometry.attributes.position.values=g.scaleToGeodeticHeight(r.geometry.attributes.position.values,nt,e,!h),o(t._offsetAttribute)&&(ft=r.geometry.attributes.position.values.length,it=new Uint8Array(ft/3),y=t._offsetAttribute===p.NONE?0:1,n(it,y),r.geometry.attributes.applyOffset=new a({componentDatatype:f.UNSIGNED_BYTE,componentsPerAttribute:1,values:it})),b.push(r);return v=w.combineInstances(b)[0],et=i.fromVertices(v.attributes.position.values),new l({attributes:v.attributes,indices:v.indices,primitiveType:v.primitiveType,boundingSphere:et,offsetAttribute:t._offsetAttribute})},rt});t("Core/PolylineGeometry",["./arrayRemoveDuplicates","./BoundingSphere","./Cartesian3","./Color","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryType","./IndexDatatype","./Math","./PolylinePipeline","./PrimitiveType","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function et(n,t,i,u,f){var o=g;o.length=f;var e,s=i.red,h=i.green,c=i.blue,l=i.alpha,a=u.red,v=u.green,y=u.blue,p=u.alpha;if(r.equals(i,u)){for(e=0;e<f;e++)o[e]=r.clone(i);return o}var w=(a-s)/f,b=(v-h)/f,k=(y-c)/f,d=(p-l)/f;for(e=0;e<f;e++)o[e]=new r(s+e*w,h+e*b,c+e*k,l+e*d);return o}function d(n){var c;n=f(n,f.EMPTY_OBJECT);var t=n.positions,u=n.colors,l=f(n.width,1),h=f(n.colorsPerVertex,!1);if(!e(t)||t.length<2)throw new o("At least two positions are required.");if(typeof l!="number")throw new o("width must be a number");if(e(u)&&(h&&u.length<t.length||!h&&u.length<t.length-1))throw new o("colors has an invalid length.");this._positions=t;this._colors=u;this._width=l;this._colorsPerVertex=h;this._vertexFormat=b.clone(f(n.vertexFormat,b.DEFAULT));this._followSurface=f(n.followSurface,!0);this._granularity=f(n.granularity,y.RADIANS_PER_DEGREE);this._ellipsoid=s.clone(f(n.ellipsoid,s.WGS84));this._workerName="createPolylineGeometry";c=1+t.length*i.packedLength;c+=e(u)?1+u.length*r.packedLength:1;this.packedLength=c+s.packedLength+b.packedLength+4}var g=[];d.pack=function(n,t,u){var h,a,c,l;if(!e(n))throw new o("value is required");if(!e(t))throw new o("array is required");for(u=f(u,0),a=n._positions,c=a.length,t[u++]=c,h=0;h<c;++h,u+=i.packedLength)i.pack(a[h],t,u);for(l=n._colors,c=e(l)?l.length:0,t[u++]=c,h=0;h<c;++h,u+=r.packedLength)r.pack(l[h],t,u);return s.pack(n._ellipsoid,t,u),u+=s.packedLength,b.pack(n._vertexFormat,t,u),u+=b.packedLength,t[u++]=n._width,t[u++]=n._colorsPerVertex?1:0,t[u++]=n._followSurface?1:0,t[u]=n._granularity,t};var nt=s.clone(s.UNIT_SPHERE),tt=new b,k={positions:undefined,colors:undefined,ellipsoid:nt,vertexFormat:tt,width:undefined,colorsPerVertex:undefined,followSurface:undefined,granularity:undefined};d.unpack=function(n,t,u){var h,c,l,a,v,y;if(!e(n))throw new o("array is required");for(t=f(t,0),c=n[t++],l=new Array(c),h=0;h<c;++h,t+=i.packedLength)l[h]=i.unpack(n,t);for(c=n[t++],a=c>0?new Array(c):undefined,h=0;h<c;++h,t+=r.packedLength)a[h]=r.unpack(n,t);v=s.unpack(n,t,nt);t+=s.packedLength;y=b.unpack(n,t,tt);t+=b.packedLength;var p=n[t++],w=n[t++]===1,g=n[t++]===1,it=n[t];return e(u)?(u._positions=l,u._colors=a,u._ellipsoid=s.clone(v,u._ellipsoid),u._vertexFormat=b.clone(y,u._vertexFormat),u._width=p,u._colorsPerVertex=w,u._followSurface=g,u._granularity=it,u):(k.positions=l,k.colors=a,k.width=p,k.colorsPerVertex=w,k.followSurface=g,k.granularity=it,new d(k))};var it=new i,rt=new i,ut=new i,ft=new i;return d.createGeometry=function(f){var ui=f._width,ni=f._vertexFormat,nt=f._colors,fi=f._colorsPerVertex,nr=f._followSurface,tr=f._granularity,ti=f._ellipsoid,k,o,lt,s=n(f._positions,i.equalsEpsilon),b=s.length,ei,pt,wt,vt,bt,wi,bi,ki,di,gi,yt,ot;if(b<2||ui<=0)return undefined;if(nr){if(ei=p.extractHeights(s,ti),pt=y.chordLength(tr,ti.maximumRadius),e(nt)){for(wt=1,k=0;k<b-1;++k)wt+=p.numberOfPoints(s[k],s[k+1],pt);for(vt=new Array(wt),bt=0,k=0;k<b-1;++k){var oi=s[k],si=s[k+1],hi=nt[k],ci=p.numberOfPoints(oi,si,pt);if(fi&&k<wt){var ir=nt[k+1],li=et(oi,si,hi,ir,ci),rr=li.length;for(o=0;o<rr;++o)vt[bt++]=li[o]}else for(o=0;o<ci;++o)vt[bt++]=r.clone(hi)}vt[bt]=r.clone(nt[nt.length-1]);nt=vt;g.length=0}s=p.generateCartesianArc({positions:s,minDistance:pt,ellipsoid:ti,height:ei})}b=s.length;var st=b*4-4,ai=new Float64Array(st*3),vi=new Float64Array(st*3),yi=new Float64Array(st*3),kt=new Float32Array(st*2),ii=ni.st?new Float32Array(st*2):undefined,tt=e(nt)?new Uint8Array(st*4):undefined,dt=0,ri=0,pi=0,gt=0,d;for(o=0;o<b;++o)for(o===0?(d=it,i.subtract(s[0],s[1],d),i.add(s[0],d,d)):d=s[o-1],i.clone(d,ut),i.clone(s[o],rt),o===b-1?(d=it,i.subtract(s[b-1],s[b-2],d),i.add(s[b-1],d,d)):d=s[o+1],i.clone(d,ft),e(tt)&&(wi=o===0||fi?nt[o]:nt[o-1],o!==b-1&&(bi=nt[o])),ki=o===0?2:0,di=o===b-1?2:4,lt=ki;lt<di;++lt)i.pack(rt,ai,dt),i.pack(ut,vi,dt),i.pack(ft,yi,dt),dt+=3,gi=lt-2<0?-1:1,kt[ri++]=2*(lt%2)-1,kt[ri++]=gi*ui,ni.st&&(ii[pi++]=o/(b-1),ii[pi++]=Math.max(kt[ri-2],0)),e(tt)&&(yt=lt<2?wi:bi,tt[gt++]=r.floatToByte(yt.red),tt[gt++]=r.floatToByte(yt.green),tt[gt++]=r.floatToByte(yt.blue),tt[gt++]=r.floatToByte(yt.alpha));ot=new l;ot.position=new c({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:ai});ot.prevPosition=new c({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:vi});ot.nextPosition=new c({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:yi});ot.expandAndWidth=new c({componentDatatype:u.FLOAT,componentsPerAttribute:2,values:kt});ni.st&&(ot.st=new c({componentDatatype:u.FLOAT,componentsPerAttribute:2,values:ii}));e(tt)&&(ot.color=new c({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:4,values:tt,normalize:!0}));var ht=v.createTypedArray(st,b*6-6),ct=0,at=0,ur=b-1;for(o=0;o<ur;++o)ht[at++]=ct,ht[at++]=ct+2,ht[at++]=ct+1,ht[at++]=ct+1,ht[at++]=ct+2,ht[at++]=ct+3,ct+=4;return new h({attributes:ot,indices:ht,primitiveType:w.TRIANGLES,boundingSphere:t.fromPoints(s),geometryType:a.POLYLINES})},d});t("Core/PolylineVolumeGeometry",["./arrayRemoveDuplicates","./BoundingRectangle","./BoundingSphere","./Cartesian2","./Cartesian3","./ComponentDatatype","./CornerType","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryPipeline","./IndexDatatype","./Math","./oneTimeWarning","./PolygonPipeline","./PolylineVolumeGeometryLibrary","./PrimitiveType","./VertexFormat","./WindingOrder"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function ot(n,t,r,u){var yt=new v,vt,rt;u.position&&(yt.position=new a({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:n}));for(var h=t.length,ct=n.length/3,et=(ct-h*2)/(h*2),ot=k.triangulate(t),dt=(et-1)*h*6+ot.length*2,e=p.createTypedArray(ct,dt),s,tt,ut,ft,lt,at=h*2,o=0,c=0;c<et-1;c++){for(s=0;s<h-1;s++)tt=s*2+c*h*2,lt=tt+at,ut=tt+1,ft=ut+at,e[o++]=ut,e[o++]=tt,e[o++]=ft,e[o++]=ft,e[o++]=tt,e[o++]=lt;tt=h*2-2+c*h*2;ut=tt+1;ft=ut+at;lt=tt+at;e[o++]=ut;e[o++]=tt;e[o++]=ft;e[o++]=ft;e[o++]=tt;e[o++]=lt}if(u.st||u.tangent||u.bitangent){var w=new Float32Array(ct*2),pt=1/(et-1),st=1/r.height,ht=r.height/2,it,nt,d=0;for(c=0;c<et;c++){for(it=c*pt,nt=st*(t[0].y+ht),w[d++]=it,w[d++]=nt,s=1;s<h;s++)nt=st*(t[s].y+ht),w[d++]=it,w[d++]=nt,w[d++]=it,w[d++]=nt;nt=st*(t[0].y+ht);w[d++]=it;w[d++]=nt}for(s=0;s<h;s++)it=0,nt=st*(t[s].y+ht),w[d++]=it,w[d++]=nt;for(s=0;s<h;s++)it=(et-1)*pt,nt=st*(t[s].y+ht),w[d++]=it,w[d++]=nt;yt.st=new a({componentDatatype:f.FLOAT,componentsPerAttribute:2,values:new Float32Array(w)})}for(vt=ct-h*2,c=0;c<ot.length;c+=3){var wt=ot[c]+vt,bt=ot[c+1]+vt,kt=ot[c+2]+vt;e[o++]=wt;e[o++]=bt;e[o++]=kt;e[o++]=kt+h;e[o++]=bt+h;e[o++]=wt+h}if(rt=new l({attributes:yt,indices:e,boundingSphere:i.fromVertices(n),primitiveType:g.TRIANGLES}),u.normal&&(rt=y.computeNormal(rt)),u.tangent||u.bitangent){try{rt=y.computeTangentAndBitangent(rt)}catch(gt){b("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}u.tangent||(rt.attributes.tangent=undefined);u.bitangent||(rt.attributes.bitangent=undefined);u.st||(rt.attributes.st=undefined)}return rt}function it(n){var t,i,f;if(n=o(n,o.EMPTY_OBJECT),t=n.polylinePositions,i=n.shapePositions,!s(t))throw new h("options.polylinePositions is required.");if(!s(i))throw new h("options.shapePositions is required.");this._positions=t;this._shape=i;this._ellipsoid=c.clone(o(n.ellipsoid,c.WGS84));this._cornerType=o(n.cornerType,e.ROUNDED);this._vertexFormat=nt.clone(o(n.vertexFormat,nt.DEFAULT));this._granularity=o(n.granularity,w.RADIANS_PER_DEGREE);this._workerName="createPolylineVolumeGeometry";f=1+t.length*u.packedLength;f+=1+i.length*r.packedLength;this.packedLength=f+c.packedLength+nt.packedLength+2}var et;it.pack=function(n,t,i){var f,l,e,a;if(!s(n))throw new h("value is required");if(!s(t))throw new h("array is required");for(i=o(i,0),l=n._positions,e=l.length,t[i++]=e,f=0;f<e;++f,i+=u.packedLength)u.pack(l[f],t,i);for(a=n._shape,e=a.length,t[i++]=e,f=0;f<e;++f,i+=r.packedLength)r.pack(a[f],t,i);return c.pack(n._ellipsoid,t,i),i+=c.packedLength,nt.pack(n._vertexFormat,t,i),i+=nt.packedLength,t[i++]=n._cornerType,t[i]=n._granularity,t};var ut=c.clone(c.UNIT_SPHERE),ft=new nt,rt={polylinePositions:undefined,shapePositions:undefined,ellipsoid:ut,vertexFormat:ft,cornerType:undefined,granularity:undefined};return it.unpack=function(n,t,i){var f,e,l,a,p,w,v,y;if(!s(n))throw new h("array is required");for(t=o(t,0),e=n[t++],l=new Array(e),f=0;f<e;++f,t+=u.packedLength)l[f]=u.unpack(n,t);for(e=n[t++],a=new Array(e),f=0;f<e;++f,t+=r.packedLength)a[f]=r.unpack(n,t);return(p=c.unpack(n,t,ut),t+=c.packedLength,w=nt.unpack(n,t,ft),t+=nt.packedLength,v=n[t++],y=n[t],!s(i))?(rt.polylinePositions=l,rt.shapePositions=a,rt.cornerType=v,rt.granularity=y,new it(rt)):(i._positions=l,i._shape=a,i._ellipsoid=c.clone(p,i._ellipsoid),i._vertexFormat=nt.clone(w,i._vertexFormat),i._cornerType=v,i._granularity=y,i)},et=new t,it.createGeometry=function(i){var s=i._positions,e=n(s,u.equalsEpsilon),r=i._shape,f,o;return(r=d.removeDuplicatesFromShape(r),e.length<2||r.length<3)?undefined:(k.computeWindingOrder2D(r)===tt.CLOCKWISE&&r.reverse(),f=t.fromPoints(r,et),o=d.computePositions(e,r,f,i,!0),ot(o,r,f,i._vertexFormat))},it});t("Core/PolylineVolumeOutlineGeometry",["./arrayRemoveDuplicates","./BoundingRectangle","./BoundingSphere","./Cartesian2","./Cartesian3","./ComponentDatatype","./CornerType","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./IndexDatatype","./Math","./PolygonPipeline","./PolylineVolumeGeometryLibrary","./PrimitiveType","./WindingOrder"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function rt(n,t){var c=new v,s,w,d;c.position=new a({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:n});var u=t.length,b=c.position.values.length/3,g=n.length/3,p=g/u,e=y.createTypedArray(b,2*u*(p+1)),h,r,o=0;for(h=0,s=h*u,r=0;r<u-1;r++)e[o++]=r+s,e[o++]=r+s+1;for(e[o++]=u-1+s,e[o++]=s,h=p-1,s=h*u,r=0;r<u-1;r++)e[o++]=r+s,e[o++]=r+s+1;for(e[o++]=u-1+s,e[o++]=s,h=0;h<p-1;h++)for(w=u*h,d=w+u,r=0;r<u;r++)e[o++]=r+w,e[o++]=r+d;return new l({attributes:c,indices:y.createTypedArray(b,e),boundingSphere:i.fromVertices(n),primitiveType:k.LINES})}function nt(n){var t,i,f;if(n=o(n,o.EMPTY_OBJECT),t=n.polylinePositions,i=n.shapePositions,!s(t))throw new h("options.polylinePositions is required.");if(!s(i))throw new h("options.shapePositions is required.");this._positions=t;this._shape=i;this._ellipsoid=c.clone(o(n.ellipsoid,c.WGS84));this._cornerType=o(n.cornerType,e.ROUNDED);this._granularity=o(n.granularity,p.RADIANS_PER_DEGREE);this._workerName="createPolylineVolumeOutlineGeometry";f=1+t.length*u.packedLength;f+=1+i.length*r.packedLength;this.packedLength=f+c.packedLength+2}var tt,g,it;return nt.pack=function(n,t,i){var f,l,e,a;if(!s(n))throw new h("value is required");if(!s(t))throw new h("array is required");for(i=o(i,0),l=n._positions,e=l.length,t[i++]=e,f=0;f<e;++f,i+=u.packedLength)u.pack(l[f],t,i);for(a=n._shape,e=a.length,t[i++]=e,f=0;f<e;++f,i+=r.packedLength)r.pack(a[f],t,i);return c.pack(n._ellipsoid,t,i),i+=c.packedLength,t[i++]=n._cornerType,t[i]=n._granularity,t},tt=c.clone(c.UNIT_SPHERE),g={polylinePositions:undefined,shapePositions:undefined,ellipsoid:tt,height:undefined,cornerType:undefined,granularity:undefined},nt.unpack=function(n,t,i){var f,e,l,a,p,v,y;if(!s(n))throw new h("array is required");for(t=o(t,0),e=n[t++],l=new Array(e),f=0;f<e;++f,t+=u.packedLength)l[f]=u.unpack(n,t);for(e=n[t++],a=new Array(e),f=0;f<e;++f,t+=r.packedLength)a[f]=r.unpack(n,t);return(p=c.unpack(n,t,tt),t+=c.packedLength,v=n[t++],y=n[t],!s(i))?(g.polylinePositions=l,g.shapePositions=a,g.cornerType=v,g.granularity=y,new nt(g)):(i._positions=l,i._shape=a,i._ellipsoid=c.clone(p,i._ellipsoid),i._cornerType=v,i._granularity=y,i)},it=new t,nt.createGeometry=function(i){var s=i._positions,f=n(s,u.equalsEpsilon),r=i._shape,e,o;return(r=b.removeDuplicatesFromShape(r),f.length<2||r.length<3)?undefined:(w.computeWindingOrder2D(r)===d.CLOCKWISE&&r.reverse(),e=t.fromPoints(r,it),o=b.computePositions(f,r,e,i,!1),rt(o,r))},nt});t("Core/QuaternionSpline",["./defaultValue","./defined","./defineProperties","./DeveloperError","./Quaternion","./Spline"],function(n,t,i,r,u,f){"use strict";function o(n){var r=n.points,i=n.times;return function(f,e){t(e)||(e=new u);var o=n._lastTimeIndex=n.findTimeInterval(f,n._lastTimeIndex),s=(f-i[o])/(i[o+1]-i[o]),h=r[o],c=r[o+1];return u.fastSlerp(h,c,s,e)}}function e(i){i=n(i,n.EMPTY_OBJECT);var u=i.points,f=i.times;if(!t(u)||!t(f))throw new r("points and times are required.");if(u.length<2)throw new r("points.length must be greater than or equal to 2.");if(f.length!==u.length)throw new r("times.length must be equal to points.length.");this._times=f;this._points=u;this._evaluateFunction=o(this);this._lastTimeIndex=0}return i(e.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}}),e.prototype.findTimeInterval=f.prototype.findTimeInterval,e.prototype.wrapTime=f.prototype.wrapTime,e.prototype.clampTime=f.prototype.clampTime,e.prototype.evaluate=function(n,t){return this._evaluateFunction(n,t)},e});t("ThirdParty/quickselect",[],function(){"use strict";function i(n,i,u,f,e){t(n,i,u||0,f||n.length-1,e||r)}function t(i,r,u,f,e){while(f>u){if(f-u>600){var s=f-u+1,a=r-u+1,v=Math.log(s),c=.5*Math.exp(2*v/3),y=.5*Math.sqrt(v*c*(s-c)/s)*(a-s/2<0?-1:1),p=Math.max(u,Math.floor(r-a*c/s+y)),w=Math.min(f,Math.floor(r+(s-a)*c/s+y));t(i,r,p,w,e)}var l=i[r],h=u,o=f;for(n(i,u,r),e(i[f],l)>0&&n(i,u,f);h<o;){for(n(i,h,o),h++,o--;e(i[h],l)<0;)h++;while(e(i[o],l)>0)o--}e(i[u],l)===0?n(i,u,o):(o++,n(i,o,f));o<=r&&(u=o+1);r<=o&&(f=o-1)}}function n(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}function r(n,t){return n<t?-1:n>t?1:0}return i});t("ThirdParty/rbush",["./quickselect"],function(n){"use strict";function f(n,t){if(!(this instanceof f))return new f(n,t);this._maxEntries=Math.max(4,n||9);this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4));t&&this._initFormat(t);this.clear()}function v(n,t,i){if(!i)return t.indexOf(n);for(var r=0;r<t.length;r++)if(i(n,t[r]))return r;return-1}function t(n,t){r(n,0,n.children.length,t,n)}function r(n,t,r,f,e){e||(e=i(null));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var o=t,s;o<r;o++)s=n.children[o],u(e,n.leaf?f(s):s);return e}function u(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function c(n,t){return n.minX-t.minX}function l(n,t){return n.minY-t.minY}function s(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function e(n){return n.maxX-n.minX+(n.maxY-n.minY)}function y(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function p(n,t){var i=Math.max(n.minX,t.minX),r=Math.max(n.minY,t.minY),u=Math.min(n.maxX,t.maxX),f=Math.min(n.maxY,t.maxY);return Math.max(0,u-i)*Math.max(0,f-r)}function h(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function o(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function i(n){return{children:n,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function a(t,i,r,u,f){for(var e=[i,r],o;e.length;)(r=e.pop(),i=e.pop(),r-i<=u)||(o=i+Math.ceil((r-i)/u/2)*u,n(t,o,i,r,f),e.push(i,o,o,r))}return f.prototype={all:function(){return this._all(this.data,[])},search:function(n){var t=this.data,r=[],c=this.toBBox,f,u,s,i,e;if(!o(n,t))return r;for(f=[];t;){for(u=0,s=t.children.length;u<s;u++)i=t.children[u],e=t.leaf?c(i):i,o(n,e)&&(t.leaf?r.push(i):h(n,e)?this._all(i,r):f.push(i));t=f.pop()}return r},collides:function(n){var t=this.data,s=this.toBBox,u,i,e,r,f;if(!o(n,t))return!1;for(u=[];t;){for(i=0,e=t.children.length;i<e;i++)if(r=t.children[i],f=t.leaf?s(r):r,o(n,f)){if(t.leaf||h(n,f))return!0;u.push(r)}t=u.pop()}return!1},load:function(n){var i,r,t,u;if(!(n&&n.length))return this;if(n.length<this._minEntries){for(i=0,r=n.length;i<r;i++)this.insert(n[i]);return this}return t=this._build(n.slice(),0,n.length-1,0),this.data.children.length?this.data.height===t.height?this._splitRoot(this.data,t):(this.data.height<t.height&&(u=this.data,this.data=t,t=u),this._insert(t,this.data.height-t.height-1,!0)):this.data=t,this},insert:function(n){return n&&this._insert(n,this.data.height-1),this},clear:function(){return this.data=i([]),this},remove:function(n,t){if(!n)return this;for(var i=this.data,c=this.toBBox(n),r=[],s=[],u,f,e,o;i||r.length;){if(i||(i=r.pop(),f=r[r.length-1],u=s.pop(),o=!0),i.leaf&&(e=v(n,i.children,t),e!==-1))return i.children.splice(e,1),r.push(i),this._condense(r),this;o||i.leaf||!h(i,c)?f?(u++,i=f.children[u],o=!1):i=null:(r.push(i),s.push(u),u=0,f=i,i=i.children[0])}return this},toBBox:function(n){return n},compareMinX:c,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(n){return this.data=n,this},_all:function(n,t){for(var i=[];n;)n.leaf?t.push.apply(t,n.children):i.push.apply(i,n.children),n=i.pop();return t},_build:function(n,r,u,f){var l=u-r+1,o=this._maxEntries,e,h,v,s,c,y,p;if(l<=o)return e=i(n.slice(r,u+1)),t(e,this.toBBox),e;for(f||(f=Math.ceil(Math.log(l)/Math.log(o)),o=Math.ceil(l/Math.pow(o,f-1))),e=i([]),e.leaf=!1,e.height=f,h=Math.ceil(l/o),v=h*Math.ceil(Math.sqrt(o)),a(n,r,u,v,this.compareMinX),s=r;s<=u;s+=v)for(y=Math.min(s+v-1,u),a(n,s,y,h,this.compareMinY),c=s;c<=y;c+=h)p=Math.min(c+h-1,y),e.children.push(this._build(n,c,p,f-1));return t(e,this.toBBox),e},_chooseSubtree:function(n,t,i,r){for(var o,a,e,l,u,h,f,c;;){if(r.push(t),t.leaf||r.length-1===i)break;for(f=c=Infinity,o=0,a=t.children.length;o<a;o++)e=t.children[o],u=s(e),h=y(n,e)-u,h<c?(c=h,f=u<f?u:f,l=e):h===c&&u<f&&(f=u,l=e);t=l||t.children[0]}return t},_insert:function(n,t,i){var o=this.toBBox,f=i?n:o(n),r=[],e=this._chooseSubtree(f,this.data,t,r);for(e.children.push(n),u(e,f);t>=0;)if(r[t].children.length>this._maxEntries)this._split(r,t),t--;else break;this._adjustParentBBoxes(f,r,t)},_split:function(n,r){var u=n[r],o=u.children.length,s=this._minEntries,e,f;this._chooseSplitAxis(u,s,o);e=this._chooseSplitIndex(u,s,o);f=i(u.children.splice(e,u.children.length-e));f.height=u.height;f.leaf=u.leaf;t(u,this.toBBox);t(f,this.toBBox);r?n[r-1].children.push(f):this._splitRoot(u,f)},_splitRoot:function(n,r){this.data=i([n,r]);this.data.height=n.height+1;this.data.leaf=!1;t(this.data,this.toBBox)},_chooseSplitIndex:function(n,t,i){for(var c,l,o,e,f,a,h=f=Infinity,u=t;u<=i-t;u++)c=r(n,0,u,this.toBBox),l=r(n,u,i,this.toBBox),o=p(c,l),e=s(c)+s(l),o<h?(h=o,a=u,f=e<f?e:f):o===h&&e<f&&(f=e,a=u);return a},_chooseSplitAxis:function(n,t,i){var r=n.leaf?this.compareMinX:c,u=n.leaf?this.compareMinY:l,f=this._allDistMargin(n,t,i,r),e=this._allDistMargin(n,t,i,u);f<e&&n.children.sort(r)},_allDistMargin:function(n,t,i,f){n.children.sort(f);for(var h=this.toBBox,c=r(n,0,t,h),l=r(n,i-t,i,h),a=e(c)+e(l),s,o=t;o<i-t;o++)s=n.children[o],u(c,n.leaf?h(s):s),a+=e(c);for(o=i-t-1;o>=t;o--)s=n.children[o],u(l,n.leaf?h(s):s),a+=e(l);return a},_adjustParentBBoxes:function(n,t,i){for(var r=i;r>=0;r--)u(t[r],n)},_condense:function(n){for(var i=n.length-1,r;i>=0;i--)n[i].children.length===0?i>0?(r=n[i-1].children,r.splice(r.indexOf(n[i]),1)):this.clear():t(n[i],this.toBBox)},_initFormat:function(n){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(n[0]));this.compareMinY=new Function("a","b",t.join(n[1]));this.toBBox=new Function("a","return {minX: a"+n[0]+", minY: a"+n[1]+", maxX: a"+n[2]+", maxY: a"+n[3]+"};")}},f});t("Core/RectangleCollisionChecker",["../ThirdParty/rbush","./Check"],function(n,t){"use strict";function r(){this._tree=n()}function i(){this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.id=""}function e(n,t){return n.id===t.id}var u,f;return i.fromRectangleAndId=function(n,t,i){return i.minX=t.west,i.minY=t.south,i.maxX=t.east,i.maxY=t.north,i.id=n,i},r.prototype.insert=function(n,r){t.typeOf.string("id",n);t.typeOf.object("rectangle",r);var u=i.fromRectangleAndId(n,r,new i);this._tree.insert(u)},u=new i,r.prototype.remove=function(n,r){t.typeOf.string("id",n);t.typeOf.object("rectangle",r);var f=i.fromRectangleAndId(n,r,u);this._tree.remove(f,e)},f=new i,r.prototype.collides=function(n){t.typeOf.object("rectangle",n);var r=i.fromRectangleAndId("",n,f);return this._tree.collides(r)},r});t("Core/RectangleGeometryLibrary",["./Cartesian3","./Cartographic","./defined","./DeveloperError","./GeographicProjection","./Math","./Matrix2","./Rectangle"],function(n,t,i,r,u,f,e,o){"use strict";function y(t,i,r,u,f,o,c){var d=Math.cos(i),y=u*d,p=r*d,g=Math.sin(i),b=u*g,k=r*g,nt;s=l.project(t,s);s=n.subtract(s,h,s);nt=e.fromRotation(i,w);s=e.multiplyByVector(nt,s,s);s=n.add(s,h,s);t=l.unproject(s,t);o-=1;c-=1;var a=t.latitude,tt=a+o*k,it=a-y*c,rt=a-y*c+o*k,ot=Math.max(a,tt,it,rt),st=Math.min(a,tt,it,rt),v=t.longitude,ut=v+o*p,ft=v+c*b,et=v+c*b+o*p,ht=Math.max(v,ut,ft,et),ct=Math.min(v,ut,ft,et);return{north:ot,south:st,east:ht,west:ct,granYCos:y,granYSin:b,granXCos:p,granXSin:k,nwCorner:t}}var a=Math.cos,v=Math.sin,p=Math.sqrt,c={};c.computePosition=function(n,t,r,u,f,e,o){var l=t.radiiSquared,w=n.nwCorner,b=n.boundingRectangle,s=w.latitude-n.granYCos*u+f*n.granXSin,k=a(s),d=v(s),g=l.z*d,h=w.longitude+u*n.granYSin+f*n.granXCos,nt=k*a(h),tt=k*v(h),it=l.x*nt,rt=l.y*tt,y=p(it*nt+rt*tt+g*d),c;e.x=it/y;e.y=rt/y;e.z=g/y;r&&(c=n.stNwCorner,i(c)?(s=c.latitude-n.stGranYCos*u+f*n.stGranXSin,h=c.longitude+u*n.stGranYSin+f*n.stGranXCos,o.x=(h-n.stWest)*n.lonScalar,o.y=(s-n.stSouth)*n.latScalar):(o.x=(h-b.west)*n.lonScalar,o.y=(s-b.south)*n.latScalar))};var w=new e,s=new n,b=new t,h=new n,l=new u;return c.computeOptions=function(n,t,i,u,e,s,c){var tt=n.east,it=n.west,rt=n.north,ut=n.south,p,w,ft,et,d,ot=rt-ut,st,g,v,ht,k;it>tt?(d=f.TWO_PI-it+tt,p=Math.ceil(d/t)+1,w=Math.ceil(ot/t)+1,ft=d/(p-1),et=ot/(w-1)):(d=tt-it,p=Math.ceil(d/t)+1,w=Math.ceil(ot/t)+1,ft=d/(p-1),et=ot/(w-1));st=o.northwest(n,s);g=o.center(n,b);(i!==0||u!==0)&&(g.longitude<st.longitude&&(g.longitude+=f.TWO_PI),h=l.project(g,h));var ct=et,lt=ft,nt=o.clone(n,e),a={granYCos:ct,granYSin:0,granXCos:lt,granXSin:0,nwCorner:st,boundingRectangle:nt,width:p,height:w};if(i!==0){if(v=y(st,i,ft,et,g,p,w),rt=v.north,ut=v.south,tt=v.east,it=v.west,rt<-f.PI_OVER_TWO||rt>f.PI_OVER_TWO||ut<-f.PI_OVER_TWO||ut>f.PI_OVER_TWO)throw new r("Rotated rectangle is invalid.  It crosses over either the north or south pole.");a.granYCos=v.granYCos;a.granYSin=v.granYSin;a.granXCos=v.granXCos;a.granXSin=v.granXSin;nt.north=rt;nt.south=ut;nt.east=tt;nt.west=it}return u!==0&&(i=i-u,ht=o.northwest(nt,c),k=y(ht,i,ft,et,g,p,w),a.stGranYCos=k.granYCos,a.stGranXCos=k.granXCos,a.stGranYSin=k.granYSin,a.stGranXSin=k.granXSin,a.stNwCorner=ht,a.stWest=k.west,a.stSouth=k.south),a},c});t("Core/RectangleGeometry",["./arrayFill","./BoundingSphere","./Cartesian2","./Cartesian3","./Cartographic","./Check","./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryInstance","./GeometryOffsetAttribute","./GeometryPipeline","./IndexDatatype","./Math","./Matrix2","./Matrix3","./PolygonPipeline","./PrimitiveType","./Quaternion","./Rectangle","./RectangleGeometryLibrary","./VertexFormat"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et){"use strict";function dt(n,t){var i=new a({attributes:new y,primitiveType:it.TRIANGLES});return i.attributes.position=new v({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:t.positions}),n.normal&&(i.attributes.normal=new v({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:t.normals})),n.tangent&&(i.attributes.tangent=new v({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:t.tangents})),n.bitangent&&(i.attributes.bitangent=new v({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:t.bitangents})),i}function hi(n,t,i,u){var h=n.length,c=t.normal?new Float32Array(h):undefined,l=t.tangent?new Float32Array(h):undefined,a=t.bitangent?new Float32Array(h):undefined,o=0,s=bt,f=wt,e=pt,v;if(t.normal||t.tangent||t.bitangent)for(v=0;v<h;v+=3){var w=r.fromArray(n,v,lt),y=o+1,p=o+2;e=i.geodeticSurfaceNormal(w,e);(t.tangent||t.bitangent)&&(r.cross(r.UNIT_Z,e,f),nt.multiplyByVector(u,f,f),r.normalize(f,f),t.bitangent&&r.normalize(r.cross(e,f,s),s));t.normal&&(c[o]=e.x,c[y]=e.y,c[p]=e.z);t.tangent&&(l[o]=f.x,l[y]=f.y,l[p]=f.z);t.bitangent&&(a[o]=s.x,a[y]=s.y,a[p]=s.z);o+=3}return dt(t,{positions:n,normals:c,tangents:l,bitangents:a})}function ci(n,t,i){var c=n.length,o=t.normal?new Float32Array(c):undefined,s=t.tangent?new Float32Array(c):undefined,h=t.bitangent?new Float32Array(c):undefined,l=0,a=0,v=0,k=!0,f=bt,e=wt,u=pt,y,p,w,b;if(t.normal||t.tangent||t.bitangent)for(y=0;y<c;y+=6)p=r.fromArray(n,y,lt),w=r.fromArray(n,(y+6)%c,at),k&&(b=r.fromArray(n,(y+3)%c,gt),r.subtract(w,p,w),r.subtract(b,p,b),u=r.normalize(r.cross(b,w,u),u),k=!1),r.equalsEpsilon(w,p,d.EPSILON10)&&(k=!0),(t.tangent||t.bitangent)&&(f=i.geodeticSurfaceNormal(p,f),t.tangent&&(e=r.normalize(r.cross(f,u,e),e))),t.normal&&(o[l++]=u.x,o[l++]=u.y,o[l++]=u.z,o[l++]=u.x,o[l++]=u.y,o[l++]=u.z),t.tangent&&(s[a++]=e.x,s[a++]=e.y,s[a++]=e.z,s[a++]=e.x,s[a++]=e.y,s[a++]=e.z),t.bitangent&&(h[v++]=f.x,h[v++]=f.y,h[v++]=f.z,h[v++]=f.x,h[v++]=f.y,h[v++]=f.z);return dt(t,{positions:n,normals:o,tangents:s,bitangents:h})}function ni(n,t){for(var b,f,ut,et,r=n._vertexFormat,ht=n._ellipsoid,d=t.size,g=t.height,l=t.width,a=r.position?new Float64Array(d*3):undefined,i=r.st?new Float32Array(d*2):undefined,nt=0,ct=0,y=lt,u=ei,h=Number.MAX_VALUE,c=Number.MAX_VALUE,p=-Number.MAX_VALUE,w=-Number.MAX_VALUE,tt=0;tt<g;++tt)for(b=0;b<l;++b)ft.computePosition(t,ht,r.st,tt,b,y,u),a[nt++]=y.x,a[nt++]=y.y,a[nt++]=y.z,r.st&&(i[ct++]=u.x,i[ct++]=u.y,h=Math.min(h,u.x),c=Math.min(c,u.y),p=Math.max(p,u.x),w=Math.max(w,u.y));if(r.st&&(h<0||c<0||p>1||w>1))for(f=0;f<i.length;f+=2)i[f]=(i[f]-h)/(p-h),i[f+1]=(i[f+1]-c)/(w-c);var it=hi(a,r,ht,t.tangentRotationMatrix),vt=6*(l-1)*(g-1),o=k.createTypedArray(d,vt),rt=0,s=0;for(ut=0;ut<g-1;++ut){for(et=0;et<l-1;++et){var ot=rt,st=ot+l,yt=st+1,at=ot+1;o[s++]=ot;o[s++]=st;o[s++]=at;o[s++]=at;o[s++]=st;o[s++]=yt;++rt}++rt}return it.indices=o,r.st&&(it.attributes.st=new v({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:i})),it}function ht(n,t,i,r,u){return n[t++]=r[i],n[t++]=r[i+1],n[t++]=r[i+2],n[t++]=u[i],n[t++]=u[i+1],n[t++]=u[i+2],n}function ct(n,t,i,r){return n[t++]=r[i],n[t++]=r[i+1],n[t++]=r[i],n[t++]=r[i+1],n}function li(t,i){var nt=t._shadowVolume,ii=t._offsetAttribute,c=t._vertexFormat,lr=t._extrudedHeight,ar=t._surfaceHeight,wi=t._ellipsoid,er=i.height,kt=i.width,u,bi,h,it,dt,ir,ai,ri,rr,ti,ui,ur,st,lt,li,yi,sr,pi,bt,hr,cr;nt&&(bi=et.clone(c,vt),bi.normal=!0,t._vertexFormat=bi);h=ni(t,i);nt&&(t._vertexFormat=c);it=tt.scaleToGeodeticHeight(h.attributes.position.values,ar,wi,!1);it=new Float64Array(it);var l=it.length,yt=l*2,ki=new Float64Array(yt);ki.set(it);dt=tt.scaleToGeodeticHeight(h.attributes.position.values,lr,wi);ki.set(dt,l);h.attributes.position.values=ki;var di=c.normal?new Float32Array(yt):undefined,gi=c.tangent?new Float32Array(yt):undefined,nr=c.bitangent?new Float32Array(yt):undefined,tr=c.st?new Float32Array(yt/3*2):undefined,pt,f;if(c.normal){for(f=h.attributes.normal.values,di.set(f),u=0;u<l;u++)f[u]=-f[u];di.set(f,l);h.attributes.normal.values=di}if(nt){for(f=h.attributes.normal.values,c.normal||(h.attributes.normal=undefined),ir=new Float32Array(yt),u=0;u<l;u++)f[u]=-f[u];ir.set(f,l);h.attributes.extrudeDirection=new v({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:ir})}if(ri=s(ii),ri&&(rr=l/3*2,ti=new Uint8Array(rr),ii===w.TOP?ti=n(ti,1,0,rr/2):(ai=ii===w.NONE?0:1,ti=n(ti,ai)),h.attributes.applyOffset=new v({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:ti})),c.tangent){for(ui=h.attributes.tangent.values,gi.set(ui),u=0;u<l;u++)ui[u]=-ui[u];gi.set(ui,l);h.attributes.tangent.values=gi}c.bitangent&&(ur=h.attributes.bitangent.values,nr.set(ur),nr.set(ur,l),h.attributes.bitangent.values=nr);c.st&&(pt=h.attributes.st.values,tr.set(pt),tr.set(pt,l/3*2),h.attributes.st.values=tr);var fi=h.indices,ei=fi.length,fr=l/3,oi=k.createTypedArray(yt/3,ei*2);for(oi.set(fi),u=0;u<ei;u+=3)oi[u+ei]=fi[u+2]+fr,oi[u+1+ei]=fi[u+1]+fr,oi[u+2+ei]=fi[u]+fr;h.indices=oi;var or=2*kt+2*er-4,si=(or+4)*2,g=new Float64Array(si*3),y=nt?new Float32Array(si*3):undefined,wt=ri?new Uint8Array(si):undefined,rt=c.st?new Float32Array(si*2):undefined,hi=ii===w.TOP;ri&&!hi&&(ai=ii===w.ALL?1:0,wt=n(wt,ai));var ut=0,ft=0,a=0,ot=0,vi=kt*er,o;for(u=0;u<vi;u+=kt)o=u*3,g=ht(g,ut,o,it,dt),ut+=6,c.st&&(rt=ct(rt,ft,u*2,pt),ft+=4),nt&&(a+=3,y[a++]=f[o],y[a++]=f[o+1],y[a++]=f[o+2]),hi&&(wt[ot++]=1,ot+=1);for(u=vi-kt;u<vi;u++)o=u*3,g=ht(g,ut,o,it,dt),ut+=6,c.st&&(rt=ct(rt,ft,u*2,pt),ft+=4),nt&&(a+=3,y[a++]=f[o],y[a++]=f[o+1],y[a++]=f[o+2]),hi&&(wt[ot++]=1,ot+=1);for(u=vi-1;u>0;u-=kt)o=u*3,g=ht(g,ut,o,it,dt),ut+=6,c.st&&(rt=ct(rt,ft,u*2,pt),ft+=4),nt&&(a+=3,y[a++]=f[o],y[a++]=f[o+1],y[a++]=f[o+2]),hi&&(wt[ot++]=1,ot+=1);for(u=kt-1;u>=0;u--)o=u*3,g=ht(g,ut,o,it,dt),ut+=6,c.st&&(rt=ct(rt,ft,u*2,pt),ft+=4),nt&&(a+=3,y[a++]=f[o],y[a++]=f[o+1],y[a++]=f[o+2]),hi&&(wt[ot++]=1,ot+=1);for(st=ci(g,c,wi),c.st&&(st.attributes.st=new v({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:rt})),nt&&(st.attributes.extrudeDirection=new v({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:y})),ri&&(st.attributes.applyOffset=new v({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:wt})),lt=k.createTypedArray(si,or*6),l=g.length/3,bt=0,u=0;u<l-1;u+=2)(li=u,pi=(li+2)%l,hr=r.fromArray(g,li*3,at),cr=r.fromArray(g,pi*3,gt),r.equalsEpsilon(hr,cr,d.EPSILON10))||(yi=(li+1)%l,sr=(yi+2)%l,lt[bt++]=li,lt[bt++]=yi,lt[bt++]=pi,lt[bt++]=pi,lt[bt++]=yi,lt[bt++]=sr);return st.indices=lt,st=b.combineInstances([new p({geometry:h}),new p({geometry:st})]),st[0]}function yt(n,t,i,r,u){if(i===0)return ut.clone(n,u);var f=ft.computeOptions(n,t,i,0,kt,ti),o=f.height,s=f.width,e=ai;return ft.computePosition(f,r,!1,0,0,e[0]),ft.computePosition(f,r,!1,0,s-1,e[1]),ft.computePosition(f,r,!1,o-1,0,e[2]),ft.computePosition(f,r,!1,o-1,s-1,e[3]),ut.fromCartesianArray(e,r,u)}function ot(n){var t,i,r;if(n=o(n,o.EMPTY_OBJECT),t=n.rectangle,f.typeOf.object("rectangle",t),ut.validate(t),t.north<t.south)throw new c("options.rectangle.north must be greater than or equal to options.rectangle.south");i=o(n.height,0);r=o(n.extrudedHeight,i);this._rectangle=ut.clone(t);this._granularity=o(n.granularity,d.RADIANS_PER_DEGREE);this._ellipsoid=l.clone(o(n.ellipsoid,l.WGS84));this._surfaceHeight=Math.max(i,r);this._rotation=o(n.rotation,0);this._stRotation=o(n.stRotation,0);this._vertexFormat=et.clone(o(n.vertexFormat,et.DEFAULT));this._extrudedHeight=Math.min(i,r);this._shadowVolume=o(n.shadowVolume,!1);this._workerName="createRectangleGeometry";this._offsetAttribute=n.offsetAttribute;this._rotatedRectangle=undefined;this._textureCoordinateRotationPoints=undefined}function di(n){var o,t;if(n._stRotation===0)return[0,0,0,1,1,0];var h=ut.clone(n._rectangle,fi),c=n._granularity,l=n._ellipsoid,a=n._rotation-n._stRotation,u=yt(h,c,a,l,fi),r=wi;r[0].x=u.west;r[0].y=u.south;r[1].x=u.west;r[1].y=u.north;r[2].x=u.east;r[2].y=u.south;var f=n.rectangle,v=g.fromRotation(n._stRotation,bi),e=ut.center(f,ki);for(o=0;o<3;++o)t=r[o],t.x-=e.longitude,t.y-=e.latitude,g.multiplyByVector(v,t,t),t.x+=e.longitude,t.y+=e.latitude,t.x=(t.x-f.west)/f.width,t.y=(t.y-f.south)/f.height;var y=r[0],p=r[1],w=r[2],s=new Array(6);return i.pack(y,s),i.pack(p,s,2),i.pack(w,s,4),s}var lt=new r,pt=new r,wt=new r,bt=new r,kt=new ut,ei=new i,oi=new t,si=new t,at=new r,gt=new r,vt=new et,ai=[new r,new r,new r,new r],ti=new u,vi=new u;ot.packedLength=ut.packedLength+l.packedLength+et.packedLength+7;ot.pack=function(n,t,i){return f.typeOf.object("value",n),f.defined("array",t),i=o(i,0),ut.pack(n._rectangle,t,i),i+=ut.packedLength,l.pack(n._ellipsoid,t,i),i+=l.packedLength,et.pack(n._vertexFormat,t,i),i+=et.packedLength,t[i++]=n._granularity,t[i++]=n._surfaceHeight,t[i++]=n._rotation,t[i++]=n._stRotation,t[i++]=n._extrudedHeight,t[i++]=n._shadowVolume?1:0,t[i]=o(n._offsetAttribute,-1),t};var ii=new ut,ri=l.clone(l.UNIT_SPHERE),st={rectangle:ii,ellipsoid:ri,vertexFormat:vt,granularity:undefined,height:undefined,rotation:undefined,stRotation:undefined,extrudedHeight:undefined,shadowVolume:undefined,offsetAttribute:undefined};ot.unpack=function(n,t,i){var u,e,h;f.defined("array",n);t=o(t,0);u=ut.unpack(n,t,ii);t+=ut.packedLength;e=l.unpack(n,t,ri);t+=l.packedLength;h=et.unpack(n,t,vt);t+=et.packedLength;var c=n[t++],a=n[t++],v=n[t++],y=n[t++],p=n[t++],w=n[t++]===1,r=n[t];return s(i)?(i._rectangle=ut.clone(u,i._rectangle),i._ellipsoid=l.clone(e,i._ellipsoid),i._vertexFormat=et.clone(h,i._vertexFormat),i._granularity=c,i._surfaceHeight=a,i._rotation=v,i._stRotation=y,i._extrudedHeight=p,i._shadowVolume=w,i._offsetAttribute=r===-1?undefined:r,i):(st.granularity=c,st.height=a,st.rotation=v,st.stRotation=y,st.extrudedHeight=p,st.shadowVolume=w,st.offsetAttribute=r===-1?undefined:r,new ot(st))};ot.computeRectangle=function(n,t){var i;if(n=o(n,o.EMPTY_OBJECT),i=n.rectangle,f.typeOf.object("rectangle",i),ut.validate(i),i.north<i.south)throw new c("options.rectangle.north must be greater than or equal to options.rectangle.south");var r=o(n.granularity,d.RADIANS_PER_DEGREE),u=o(n.ellipsoid,l.WGS84),e=o(n.rotation,0);return yt(i,r,e,u,t)};var yi=new nt,ui=new rt,pi=new u;ot.createGeometry=function(i){var b,k,r,y,it,et;if(d.equalsEpsilon(i._rectangle.north,i._rectangle.south,d.EPSILON10)||d.equalsEpsilon(i._rectangle.east,i._rectangle.west,d.EPSILON10))return undefined;var f=i._rectangle,o=i._ellipsoid,p=i._rotation,c=i._stRotation,st=i._vertexFormat,u=ft.computeOptions(f,i._granularity,p,c,kt,ti,vi),l=yi;c!==0||p!==0?(b=ut.center(f,pi),k=o.geodeticSurfaceNormalCartographic(b,at),rt.fromAxisAngle(k,-c,ui),nt.fromQuaternion(ui,l)):nt.clone(nt.IDENTITY,l);var h=i._surfaceHeight,g=i._extrudedHeight,ht=!d.equalsEpsilon(h,g,0,d.EPSILON2);if(u.lonScalar=1/i._rectangle.width,u.latScalar=1/i._rectangle.height,u.tangentRotationMatrix=l,u.size=u.width*u.height,f=i._rectangle,ht)r=li(i,u),it=t.fromRectangle3D(f,o,h,si),et=t.fromRectangle3D(f,o,g,oi),y=t.union(it,et);else{if(r=ni(i,u),r.attributes.position.values=tt.scaleToGeodeticHeight(r.attributes.position.values,h,o,!1),s(i._offsetAttribute)){var ct=r.attributes.position.values.length,ot=new Uint8Array(ct/3),lt=i._offsetAttribute===w.NONE?0:1;n(ot,lt);r.attributes.applyOffset=new v({componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:1,values:ot})}y=t.fromRectangle3D(f,o,h)}return st.position||delete r.attributes.position,new a({attributes:r.attributes,indices:r.indices,primitiveType:r.primitiveType,boundingSphere:y,offsetAttribute:i._offsetAttribute})};ot.createShadowVolume=function(n,t,i){var r=n._granularity,u=n._ellipsoid,f=t(r,u),e=i(r,u);return new ot({rectangle:n._rectangle,rotation:n._rotation,ellipsoid:u,stRotation:n._stRotation,granularity:r,extrudedHeight:e,height:f,vertexFormat:et.POSITION_ONLY,shadowVolume:!0})};var fi=new ut,wi=[new i,new i,new i],bi=new g,ki=new u;return h(ot.prototype,{rectangle:{get:function(){return s(this._rotatedRectangle)||(this._rotatedRectangle=yt(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return s(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=di(this)),this._textureCoordinateRotationPoints}}}),ot});t("Core/RectangleOutlineGeometry",["./arrayFill","./BoundingSphere","./Cartesian3","./Cartographic","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./GeometryOffsetAttribute","./IndexDatatype","./Math","./PolygonPipeline","./PrimitiveType","./Rectangle","./RectangleGeometryLibrary"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function nt(n,t){for(var y=n._ellipsoid,nt=t.size,d=t.height,g=t.width,i=new Float64Array(nt*3),f=0,o=0,r=et,a,b,e=0;e<g;e++)k.computePosition(t,y,!1,o,e,r),i[f++]=r.x,i[f++]=r.y,i[f++]=r.z;for(e=g-1,o=1;o<d;o++)k.computePosition(t,y,!1,o,e,r),i[f++]=r.x,i[f++]=r.y,i[f++]=r.z;for(o=d-1,e=g-2;e>=0;e--)k.computePosition(t,y,!1,o,e,r),i[f++]=r.x,i[f++]=r.y,i[f++]=r.z;for(e=0,o=d-2;o>0;o--)k.computePosition(t,y,!1,o,e,r),i[f++]=r.x,i[f++]=r.y,i[f++]=r.z;var tt=i.length/3*2,s=v.createTypedArray(i.length/3,tt),p=0;for(a=0;a<i.length/3-1;a++)s[p++]=a,s[p++]=a+1;return s[p++]=i.length/3-1,s[p++]=0,b=new h({attributes:new l,primitiveType:w.LINES}),b.attributes.position=new c({componentDatatype:u.DOUBLE,componentsPerAttribute:3,values:i}),b.indices=s,b}function st(n,t){var w=n._surfaceHeight,b=n._extrudedHeight,c=n._ellipsoid,k=b,d=w,s=nt(n,t),h=t.height,e=t.width,l=p.scaleToGeodeticHeight(s.attributes.position.values,d,c,!1),u=l.length,o=new Float64Array(u*2),a,y,i,r,f;for(o.set(l),a=p.scaleToGeodeticHeight(s.attributes.position.values,k,c),o.set(a,u),s.attributes.position.values=o,y=o.length/3*2+8,i=v.createTypedArray(o.length/3,y),u=o.length/6,r=0,f=0;f<u-1;f++)i[r++]=f,i[r++]=f+1,i[r++]=f+u,i[r++]=f+u+1;return i[r++]=u-1,i[r++]=0,i[r++]=u+u-1,i[r++]=u,i[r++]=0,i[r++]=u,i[r++]=e-1,i[r++]=u+e-1,i[r++]=e+h-2,i[r++]=e+h-2+u,i[r++]=2*e+h-3,i[r++]=2*e+h-3+u,s.indices=i,s}function d(n){var i,r;n=f(n,f.EMPTY_OBJECT);var t=n.rectangle,u=f(n.granularity,y.RADIANS_PER_DEGREE),h=f(n.ellipsoid,s.WGS84),c=f(n.rotation,0);if(!e(t))throw new o("rectangle is required.");if(b.validate(t),t.north<t.south)throw new o("options.rectangle.north must be greater than options.rectangle.south");i=f(n.height,0);r=f(n.extrudedHeight,i);this._rectangle=b.clone(t);this._granularity=u;this._ellipsoid=h;this._surfaceHeight=Math.max(i,r);this._rotation=c;this._extrudedHeight=Math.min(i,r);this._offsetAttribute=n.offsetAttribute;this._workerName="createRectangleOutlineGeometry"}var ut=new t,ft=new t,et=new i,ot=new b,rt;d.packedLength=b.packedLength+s.packedLength+5;d.pack=function(n,t,i){if(!e(n))throw new o("value is required");if(!e(t))throw new o("array is required");return i=f(i,0),b.pack(n._rectangle,t,i),i+=b.packedLength,s.pack(n._ellipsoid,t,i),i+=s.packedLength,t[i++]=n._granularity,t[i++]=n._surfaceHeight,t[i++]=n._rotation,t[i++]=n._extrudedHeight,t[i]=f(n._offsetAttribute,-1),t};var tt=new b,it=s.clone(s.UNIT_SPHERE),g={rectangle:tt,ellipsoid:it,granularity:undefined,height:undefined,rotation:undefined,extrudedHeight:undefined,offsetAttribute:undefined};return d.unpack=function(n,t,i){var u,h;if(!e(n))throw new o("array is required");t=f(t,0);u=b.unpack(n,t,tt);t+=b.packedLength;h=s.unpack(n,t,it);t+=s.packedLength;var v=n[t++],c=n[t++],l=n[t++],a=n[t++],r=n[t];return e(i)?(i._rectangle=b.clone(u,i._rectangle),i._ellipsoid=s.clone(h,i._ellipsoid),i._surfaceHeight=c,i._rotation=l,i._extrudedHeight=a,i._offsetAttribute=r===-1?undefined:r,i):(g.granularity=v,g.height=c,g.rotation=l,g.extrudedHeight=a,g.offsetAttribute=r===-1?undefined:r,new d(g))},rt=new r,d.createGeometry=function(i){var f=i._rectangle,l=i._ellipsoid,s=k.computeOptions(f,i._granularity,i._rotation,0,ot,rt),r,d,g,o,et,ht,ct,tt;if(s.size=2*s.width+2*s.height-4,y.equalsEpsilon(f.north,f.south,y.EPSILON10)||y.equalsEpsilon(f.east,f.west,y.EPSILON10))return undefined;var v=i._surfaceHeight,it=i._extrudedHeight,lt=!y.equalsEpsilon(v,it,0,y.EPSILON2),b;return lt?(r=st(i,s),e(i._offsetAttribute)&&(g=r.attributes.position.values.length/3,o=new Uint8Array(g),i._offsetAttribute===a.TOP?o=n(o,1,0,g/2):(b=i._offsetAttribute===a.NONE?0:1,o=n(o,b)),r.attributes.applyOffset=new c({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:1,values:o})),et=t.fromRectangle3D(f,l,v,ft),ht=t.fromRectangle3D(f,l,it,ut),d=t.union(et,ht)):(r=nt(i,s),r.attributes.position.values=p.scaleToGeodeticHeight(r.attributes.position.values,v,l,!1),e(i._offsetAttribute)&&(ct=r.attributes.position.values.length,tt=new Uint8Array(ct/3),b=i._offsetAttribute===a.NONE?0:1,n(tt,b),r.attributes.applyOffset=new c({componentDatatype:u.UNSIGNED_BYTE,componentsPerAttribute:1,values:tt})),d=t.fromRectangle3D(f,l,v)),new h({attributes:r.attributes,indices:r.indices,primitiveType:w.LINES,boundingSphere:d,offsetAttribute:i._offsetAttribute})},d});t("Core/ReferenceFrame",["./freezeObject"],function(n){"use strict";return n({FIXED:0,INERTIAL:1})});t("Core/requestAnimationFrame",["./defined","./getTimestamp"],function(n,t){"use strict";function r(n){return i(n)}if(typeof window!="undefined"){var i=window.requestAnimationFrame;return function(){var e,r;if(!n(i))for(var f=["webkit","moz","ms","o"],u=0,o=f.length;u<o&&!n(i);)i=window[f[u]+"RequestAnimationFrame"],++u;n(i)||(e=1e3/60,r=0,i=function(n){var i=t(),u=Math.max(e-(i-r),0);return r=i+u,setTimeout(function(){n(r)},u)})}(),r}});t("Core/sampleTerrain",["../ThirdParty/when","./Check"],function(n,t){"use strict";function i(n,i,u){return t.typeOf.object("terrainProvider",n),t.typeOf.number("level",i),t.defined("positions",u),n.readyPromise.then(function(){return r(n,i,u)})}function r(t,i,r){for(var y=t.tilingScheme,c=[],l={},s,h,a,v,e=0;e<r.length;++e)s=y.positionToTileXY(r[e],i),h=s.toString(),l.hasOwnProperty(h)||(a={x:s.x,y:s.y,level:i,tilingScheme:y,terrainProvider:t,positions:[]},l[h]=a,c.push(a)),l[h].positions.push(r[e]);for(v=[],e=0;e<c.length;++e){var o=c[e],p=o.terrainProvider.requestTileGeometry(o.x,o.y,o.level),w=p.then(u(o)).otherwise(f(o));v.push(w)}return n.all(v,function(){return r})}function u(n){var t=n.positions,i=n.tilingScheme.tileXYToRectangle(n.x,n.y,n.level);return function(n){for(var u,r=0;r<t.length;++r)u=t[r],u.height=n.interpolateHeight(i,u.longitude,u.latitude)}}function f(n){var t=n.positions;return function(){for(var i,n=0;n<t.length;++n)i=t[n],i.height=undefined}}return i});t("Core/sampleTerrainMostDetailed",["../ThirdParty/when","./defined","./DeveloperError","./sampleTerrain"],function(n,t,i,r){"use strict";function u(u,f){if(!t(u))throw new i("terrainProvider is required.");if(!t(f))throw new i("positions is required.");return u.readyPromise.then(function(){var o=[],h=u.availability,e;if(!t(h))throw new i("sampleTerrainMostDetailed requires a terrain provider that has tile availability.");for(e=0;e<f.length;++e){var c=f[e],l=h.computeMaximumLevelAtPosition(c),s=o[l];t(s)||(o[l]=s=[]);s.push(c)}return n.all(o.map(function(n,i){if(t(n))return r(u,i,n)})).then(function(){return f})})}return u});t("Core/ScreenSpaceEventType",["./freezeObject"],function(n){"use strict";return n({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19})});t("Core/ScreenSpaceEventHandler",["./AssociativeArray","./Cartesian2","./defaultValue","./defined","./destroyObject","./DeveloperError","./FeatureDetection","./getTimestamp","./KeyboardEventModifier","./ScreenSpaceEventType"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function v(n,t,i){var u=n._element,r;return u===document?(i.x=t.clientX,i.y=t.clientY,i):(r=u.getBoundingClientRect(),i.x=t.clientX-r.left,i.y=t.clientY-r.top,i)}function b(n,t){var i=n;return r(t)&&(i+="+"+t),i}function y(n){return n.shiftKey?s.SHIFT:n.ctrlKey?s.CTRL:n.altKey?s.ALT:undefined}function c(n,t,i,r){function u(t){r(n,t)}i.addEventListener(t,u,!1);n._removalFunctions.push(function(){i.removeEventListener(t,u,!1)})}function pt(n){var t=n._element,i=r(t.disableRootEvents)?t:document,u;e.supportsPointerEvents()?(c(n,"pointerdown",t,ni),c(n,"pointerup",t,yt),c(n,"pointermove",t,ti),c(n,"pointercancel",t,yt)):(c(n,"mousedown",t,rt),c(n,"mouseup",i,et),c(n,"mousemove",i,ot),c(n,"touchstart",t,dt),c(n,"touchend",i,ht),c(n,"touchmove",i,gt),c(n,"touchcancel",i,ht));c(n,"dblclick",t,bt);u="onwheel"in t?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";c(n,u,t,kt)}function wt(n){for(var i=n._removalFunctions,t=0;t<i.length;++t)i[t]()}function k(n){n._lastSeenTouchEvent=o()}function d(n){return o()-n._lastSeenTouchEvent>a.mouseEmulationIgnoreMilliseconds}function rt(n,i){var u,f,e,s,o;if(d(n)){if(u=i.button,n._buttonDown=u,u===l.LEFT)f=h.LEFT_DOWN;else if(u===l.MIDDLE)f=h.MIDDLE_DOWN;else if(u===l.RIGHT)f=h.RIGHT_DOWN;else return;e=v(n,i,n._primaryPosition);t.clone(e,n._primaryStartPosition);t.clone(e,n._primaryPreviousPosition);s=y(i);o=n.getInputAction(f,s);r(o)&&(t.clone(e,it.position),o(it),i.preventDefault())}}function et(n,i){var f,e,o,u;if(d(n)){if(f=i.button,n._buttonDown=undefined,f===l.LEFT)e=h.LEFT_UP,o=h.LEFT_CLICK;else if(f===l.MIDDLE)e=h.MIDDLE_UP,o=h.MIDDLE_CLICK;else if(f===l.RIGHT)e=h.RIGHT_UP,o=h.RIGHT_CLICK;else return;var a=y(i),s=n.getInputAction(e,a),c=n.getInputAction(o,a);if((r(s)||r(c))&&(u=v(n,i,n._primaryPosition),r(s)&&(t.clone(u,ut.position),s(ut)),r(c))){var p=n._primaryStartPosition,w=p.x-u.x,b=p.y-u.y,k=Math.sqrt(w*w+b*b);k<n._clickPixelTolerance&&(t.clone(u,ft.position),c(ft))}}}function ot(n,i){if(d(n)){var o=y(i),u=v(n,i,n._primaryPosition),f=n._primaryPreviousPosition,e=n.getInputAction(h.MOUSE_MOVE,o);r(e)&&(t.clone(f,g.startPosition),t.clone(u,g.endPosition),e(g));t.clone(u,f);r(n._buttonDown)&&i.preventDefault()}}function bt(n,t){var e=t.button,u,f,i;if(e===l.LEFT)u=h.LEFT_DOUBLE_CLICK;else return;f=y(t);i=n.getInputAction(u,f);r(i)&&(v(n,t,st.position),i(st))}function kt(n,t){var i,u,e,f;(r(t.deltaY)?(u=t.deltaMode,i=u===t.DOM_DELTA_PIXEL?-t.deltaY:u===t.DOM_DELTA_LINE?-t.deltaY*40:-t.deltaY*120):i=t.detail>0?t.detail*-120:t.wheelDelta,r(i))&&(e=y(t),f=n.getInputAction(h.WHEEL,e),r(f)&&(f(i),t.preventDefault()))}function dt(n,i){var h;k(n);for(var e=i.changedTouches,o=e.length,u,f,s=n._positions,r=0;r<o;++r)u=e[r],f=u.identifier,s.set(f,v(n,u,new t));for(w(n,i),h=n._previousPositions,r=0;r<o;++r)u=e[r],f=u.identifier,h.set(f,t.clone(s.get(f)))}function ht(n,t){var o;k(n);for(var f=t.changedTouches,e=f.length,r,u,s=n._positions,i=0;i<e;++i)r=f[i],u=r.identifier,s.remove(u);for(w(n,t),o=n._previousPositions,i=0;i<e;++i)r=f[i],u=r.identifier,o.remove(u)}function w(n,i){var f=y(i),s=n._positions,k=n._previousPositions,e=s.length,u,c,a=n._isPinching,o;if(e!==1&&n._buttonDown===l.LEFT&&(n._buttonDown=undefined,u=n.getInputAction(h.LEFT_UP,f),r(u)&&(t.clone(n._primaryPosition,lt.position),u(lt)),e===0&&(c=n.getInputAction(h.LEFT_CLICK,f),r(c)))){var v=n._primaryStartPosition,p=k.values[0],w=v.x-p.x,b=v.y-p.y,d=Math.sqrt(w*w+b*b);d<n._clickPixelTolerance&&(t.clone(n._primaryPosition,at.position),c(at))}e===0&&a&&(n._isPinching=!1,u=n.getInputAction(h.PINCH_END,f),r(u)&&u());e!==1||a||(o=s.values[0],t.clone(o,n._primaryPosition),t.clone(o,n._primaryStartPosition),t.clone(o,n._primaryPreviousPosition),n._buttonDown=l.LEFT,u=n.getInputAction(h.LEFT_DOWN,f),r(u)&&(t.clone(o,ct.position),u(ct)),i.preventDefault());e!==2||a||(n._isPinching=!0,u=n.getInputAction(h.PINCH_START,f),r(u)&&(t.clone(s.values[0],nt.position1),t.clone(s.values[1],nt.position2),u(nt),i.preventDefault()))}function gt(n,i){var s,l;k(n);for(var o=i.changedTouches,h=o.length,f,e,c=n._positions,u=0;u<h;++u)f=o[u],e=f.identifier,s=c.get(e),r(s)&&v(n,f,s);for(vt(n,i),l=n._previousPositions,u=0;u<h;++u)f=o[u],e=f.identifier,t.clone(c.get(e),l.get(e))}function vt(n,i){var g=y(i),f=n._positions,nt=n._previousPositions,it=f.length,u,e,o;if(it===1&&n._buttonDown===l.LEFT)e=f.values[0],t.clone(e,n._primaryPosition),o=n._primaryPreviousPosition,u=n.getInputAction(h.MOUSE_MOVE,g),r(u)&&(t.clone(o,tt.startPosition),t.clone(e,tt.endPosition),u(tt)),t.clone(e,o),i.preventDefault();else if(it===2&&n._isPinching&&(u=n.getInputAction(h.PINCH_MOVE,g),r(u))){var s=f.values[0],c=f.values[1],a=nt.values[0],v=nt.values[1],w=c.x-s.x,b=c.y-s.y,rt=Math.sqrt(w*w+b*b)*.25,k=v.x-a.x,d=v.y-a.y,ut=Math.sqrt(k*k+d*d)*.25,ft=(c.y+s.y)*.125,et=(v.y+a.y)*.125,ot=Math.atan2(b,w),st=Math.atan2(d,k);t.fromElements(0,ut,p.distance.startPosition);t.fromElements(0,rt,p.distance.endPosition);t.fromElements(st,et,p.angleAndHeight.startPosition);t.fromElements(ot,ft,p.angleAndHeight.endPosition);u(p)}}function ni(n,i){var u,r,f;i.target.setPointerCapture(i.pointerId);i.pointerType==="touch"?(u=n._positions,r=i.pointerId,u.set(r,v(n,i,new t)),w(n,i),f=n._previousPositions,f.set(r,t.clone(u.get(r)))):rt(n,i)}function yt(n,t){var r,i,u;t.pointerType==="touch"?(r=n._positions,i=t.pointerId,r.remove(i),w(n,t),u=n._previousPositions,u.remove(i)):et(n,t)}function ti(n,i){var o;if(i.pointerType==="touch"){var f=n._positions,u=i.pointerId,e=f.get(u);if(!r(e))return;v(n,i,e);vt(n,i);o=n._previousPositions;t.clone(f.get(u),o.get(u))}else ot(n,i)}function a(r){this._inputEvents={};this._buttonDown=undefined;this._isPinching=!1;this._lastSeenTouchEvent=-a.mouseEmulationIgnoreMilliseconds;this._primaryStartPosition=new t;this._primaryPosition=new t;this._primaryPreviousPosition=new t;this._positions=new n;this._previousPositions=new n;this._removalFunctions=[];this._clickPixelTolerance=5;this._element=i(r,document);pt(this)}var l={LEFT:0,MIDDLE:1,RIGHT:2},it={position:new t},ut={position:new t},ft={position:new t},g={startPosition:new t,endPosition:new t},st={position:new t},ct={position:new t},nt={position1:new t,position2:new t},lt={position:new t},at={position:new t},tt={startPosition:new t,endPosition:new t},p={distance:{startPosition:new t,endPosition:new t},angleAndHeight:{startPosition:new t,endPosition:new t}};return a.prototype.setInputAction=function(n,t,i){if(!r(n))throw new f("action is required.");if(!r(t))throw new f("type is required.");var u=b(t,i);this._inputEvents[u]=n},a.prototype.getInputAction=function(n,t){if(!r(n))throw new f("type is required.");var i=b(n,t);return this._inputEvents[i]},a.prototype.removeInputAction=function(n,t){if(!r(n))throw new f("type is required.");var i=b(n,t);delete this._inputEvents[i]},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return wt(this),u(this)},a.mouseEmulationIgnoreMilliseconds=800,a});t("Core/ShowGeometryInstanceAttribute",["./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError"],function(n,t,i,r,u){"use strict";function f(n){n=t(n,!0);this.value=f.toValue(n)}return r(f.prototype,{componentDatatype:{get:function(){return n.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}}),f.toValue=function(n,t){if(!i(n))throw new u("show is required.");return i(t)?(t[0]=n,t):new Uint8Array([n])},f});t("Core/Simon1994PlanetaryPositions",["./Cartesian3","./defined","./DeveloperError","./JulianDate","./Math","./Matrix3","./TimeConstants","./TimeStandard"],function(n,t,i,r,u,f,e,o){"use strict";function bt(n){var t=6.239996+.0172019696544*n;return.001657*Math.sin(t+.01671*Math.sin(t))}function p(n,t){t=r.addSeconds(n,kt,t);var i=r.totalDays(t)-dt;return r.addSeconds(t,bt(i),t)}function b(r,e,o,s,h,c,l){var a;if(o<0&&(o=-o,h+=u.PI),o<0||o>u.PI)throw new i("The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.");var k=r*(1-e),d=s-h,g=h,v=ti(c-s,e),nt=ni(e,0);if(nt==="Hyperbolic"&&Math.abs(u.negativePiToPi(v))>=Math.acos(-1/e))throw new i("The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.");fi(d,o,g,w);var tt=k*(1+e),y=Math.cos(v),p=Math.sin(v),b=1+e*y;if(b<=u.Epsilon10)throw new i("elements cannot be converted to cartesian");return a=tt/b,t(l)?(l.x=a*y,l.y=a*p,l.z=0):l=new n(a*y,a*p,0),f.multiplyByVector(w,l,l)}function ni(n,t){if(n<0)throw new i("eccentricity cannot be negative.");return n<=t?"Circular":n<1-t?"Elliptical":n<=1+t?"Parabolic":"Hyperbolic"}function ti(n,t){if(t<0||t>=1)throw new i("eccentricity out of range.");var r=ri(n,t);return ui(r,t)}function ri(n,t){var o,f,r,e,s,h;if(t<0||t>=1)throw new i("eccentricity out of range.");for(o=Math.floor(n/u.TWO_PI),n-=o*u.TWO_PI,f=n+t*Math.sin(n)/(1-Math.sin(n+t)+Math.sin(n)),r=Number.MAX_VALUE,e=0;e<k&&Math.abs(r-f)>ii;++e)r=f,s=r-t*Math.sin(r)-n,h=1-t*Math.cos(r),f=r-s/h;if(e>=k)throw new i("Kepler equation did not converge");return f+o*u.TWO_PI}function ui(n,t){var f;if(t<0||t>=1)throw new i("eccentricity out of range.");f=Math.floor(n/u.TWO_PI);n-=f*u.TWO_PI;var e=Math.cos(n)-t,o=Math.sin(n)*Math.sqrt(1-t*t),r=Math.atan2(o,e);return r=u.zeroToTwoPi(r),n<0&&(r-=u.TWO_PI),r+f*u.TWO_PI}function fi(n,r,e,o){if(r<0||r>u.PI)throw new i("inclination out of range");var s=Math.cos(n),h=Math.sin(n),c=Math.cos(r),v=Math.sin(r),l=Math.cos(e),a=Math.sin(e);return t(o)?(o[0]=l*s-a*h*c,o[1]=a*s+l*h*c,o[2]=h*v,o[3]=-l*h-a*s*c,o[4]=-a*h+l*s*c,o[5]=s*v,o[6]=a*v,o[7]=-l*v,o[8]=c):o=new f(l*s-a*h*c,-l*h-a*s*c,a*v,a*s+l*h*c,-a*h+l*s*c,-l*v,h*v,s*v,c),o}function gr(n,t){p(n,l);var u=l.dayNumber-v.dayNumber+(l.secondsOfDay-v.secondsOfDay)/e.SECONDS_PER_DAY,r=u/(e.DAYS_PER_JULIAN_CENTURY*10),i=.3595362*r,f=ei+hi*Math.cos(d*i)+bi*Math.sin(d*i)+ci*Math.cos(g*i)+ki*Math.sin(g*i)+li*Math.cos(nt*i)+di*Math.sin(nt*i)+ai*Math.cos(tt*i)+gi*Math.sin(tt*i)+vi*Math.cos(it*i)+nr*Math.sin(it*i)+yi*Math.cos(rt*i)+tr*Math.sin(rt*i)+pi*Math.cos(ut*i)+ir*Math.sin(ut*i)+wi*Math.cos(ft*i)+rr*Math.sin(ft*i),o=oi+si*r+ur*Math.cos(et*i)+ar*Math.sin(et*i)+fr*Math.cos(ot*i)+vr*Math.sin(ot*i)+er*Math.cos(st*i)+yr*Math.sin(st*i)+or*Math.cos(ht*i)+pr*Math.sin(ht*i)+sr*Math.cos(ct*i)+wr*Math.sin(ct*i)+hr*Math.cos(lt*i)+br*Math.sin(lt*i)+cr*Math.cos(at*i)+kr*Math.sin(at*i)+lr*Math.cos(vt*i)+dr*Math.sin(vt*i),s=.0167086342-.0004203654*r,a=102.93734808*c+11612.3529*h*r,y=469.97289*h*r,w=174.87317577*c-8679.27034*h*r;return b(f,s,y,a,w,o,t)}function yt(n,t){var g,ht,ct;p(n,l);var at=l.dayNumber-v.dayNumber+(l.secondsOfDay-v.secondsOfDay)/e.SECONDS_PER_DAY,r=at/e.DAYS_PER_JULIAN_CENTURY,u=r*r,s=u*r,w=s*r,ut=383397.7725+.004*r,lt=.055545526-16e-9*r,vt=5.15668983*c,ft=-8e-5*r+.02966*u-42e-6*s-13e-8*w,yt=83.35324312*c,et=14643420.2669*r-38.2702*u-.045047*s+.00021301*w,pt=125.04455501*c,ot=-6967919.3631*r+6.3602*u+.007625*s-3586e-8*w,wt=218.31664563*c,st=1732559343.4847*r-6.391*u+.006588*s-3169e-8*w,nt=297.85019547*c+h*(1602961601.209*r-6.3706*u+.006593*s-3169e-8*w),bt=93.27209062*c+h*(1739527262.8478*r-12.7512*u-.001037*s+417e-8*w),f=134.96340251*c+h*(1717915923.2178*r+31.8792*u+.051635*s-.0002447*w),k=357.52910918*c+h*(129596581.0481*r-.5532*u+.000136*s-1149e-8*w),o=310.17137918*c-h*(6967051.436*r+6.2068*u+.007618*s-3219e-8*w),i=2*nt,d=4*nt,tt=6*nt,y=2*f,it=3*f,rt=4*f,a=2*bt;ut+=3400.4*Math.cos(i)-635.6*Math.cos(i-f)-235.6*Math.cos(f)+218.1*Math.cos(i-k)+181*Math.cos(i+f);lt+=.014216*Math.cos(i-f)+.008551*Math.cos(i-y)-.001383*Math.cos(f)+.001356*Math.cos(i+f)-.001147*Math.cos(d-it)-.000914*Math.cos(d-y)+.000869*Math.cos(i-k-f)-.000627*Math.cos(i)-.000394*Math.cos(d-rt)+.000282*Math.cos(i-k-y)-.000279*Math.cos(nt-f)-.000236*Math.cos(y)+.000231*Math.cos(d)+.000229*Math.cos(tt-rt)-.000201*Math.cos(y-a);ft+=486.26*Math.cos(i-a)-40.13*Math.cos(i)+37.51*Math.cos(a)+25.73*Math.cos(y-a)+19.97*Math.cos(i-k-a);et+=-55609*Math.sin(i-f)-34711*Math.sin(i-y)-9792*Math.sin(f)+9385*Math.sin(d-it)+7505*Math.sin(d-y)+5318*Math.sin(i+f)+3484*Math.sin(d-rt)-3417*Math.sin(i-k-f)-2530*Math.sin(tt-rt)-2376*Math.sin(i)-2075*Math.sin(i-it)-1883*Math.sin(y)-1736*Math.sin(tt-5*f)+1626*Math.sin(k)-1370*Math.sin(tt-it);ot+=-5392*Math.sin(i-a)-540*Math.sin(k)-441*Math.sin(i)+423*Math.sin(a)-288*Math.sin(y-a);st+=-3332.9*Math.sin(i)+1197.4*Math.sin(i-f)-662.5*Math.sin(k)+396.3*Math.sin(f)-218*Math.sin(i-k);g=2*o;ht=3*o;ft+=46.997*Math.cos(o)*r-.614*Math.cos(i-a+o)*r+.614*Math.cos(i-a-o)*r-.0297*Math.cos(g)*u-.0335*Math.cos(o)*u+.0012*Math.cos(i-a+g)*u-.00016*Math.cos(o)*s+4e-5*Math.cos(ht)*s+4e-5*Math.cos(g)*s;ct=2.116*Math.sin(o)*r-.111*Math.sin(i-a-o)*r-.0015*Math.sin(o)*u;et+=ct;st+=ct;ot+=-520.77*Math.sin(o)*r+13.66*Math.sin(i-a+o)*r+1.12*Math.sin(i-o)*r-1.06*Math.sin(a-o)*r+.66*Math.sin(g)*u+.371*Math.sin(o)*u-.035*Math.sin(i-a+g)*u-.015*Math.sin(i-a+o)*u+.0014*Math.sin(o)*s-.0011*Math.sin(ht)*s-.0009*Math.sin(g)*s;ut*=gt;var kt=vt+ft*h,dt=yt+et*h,ni=wt+st*h,ti=pt+ot*h;return b(ut,lt,kt,dt,ti,ni,t)}function tu(t,i){return i=yt(t,i),n.multiplyByScalar(i,nu,i)}var y={},kt=32.184,dt=2451545,v=new r(2451545,0,o.TAI),gt=1e3,c=u.RADIANS_PER_DEGREE,h=u.RADIANS_PER_ARCSECOND,s=14959787e4,w=new f,k=50,ii=u.EPSILON8,ei=1.0000010178*s,oi=100.46645683*c,si=1295977422.83429*h,d=16002,g=21863,nt=32004,tt=10931,it=14529,rt=16368,ut=15318,ft=32794,hi=64*1e-7*s,ci=-152*1e-7*s,li=62*1e-7*s,ai=-8*1e-7*s,vi=32*1e-7*s,yi=-41*1e-7*s,pi=19*1e-7*s,wi=-11*1e-7*s,bi=-150*1e-7*s,ki=-46*1e-7*s,di=68*1e-7*s,gi=54*1e-7*s,nr=14*1e-7*s,tr=24*1e-7*s,ir=-28*1e-7*s,rr=22*1e-7*s,et=10,ot=16002,st=21863,ht=10931,ct=1473,lt=32004,at=4387,vt=73,ur=-325*1e-7,fr=-322*1e-7,er=-79*1e-7,or=232*1e-7,sr=-52*1e-7,hr=97*1e-7,cr=55*1e-7,lr=-41*1e-7,ar=-105*1e-7,vr=-137*1e-7,yr=258*1e-7,pr=35*1e-7,wr=-116*1e-7,br=-88*1e-7,kr=-112*1e-7,dr=-80*1e-7,l=new r(0,0,o.TAI),pt=.012300034,nu=pt/(pt+1)*-1,wt=new f(1.0000000000000002,56197231737858219e-32,46905115101462993e-35,-51541294274146114e-32,.91748206206918193,-.39777715593191376,-223970096136568e-30,.39777715593191376,.91748206206918193),a=new n;return y.computeSunPositionInEarthInertialFrame=function(i,u){return t(i)||(i=r.now()),t(u)||(u=new n),a=gr(i,a),u=n.negate(a,u),tu(i,a),n.subtract(u,a,u),f.multiplyByVector(wt,u,u),u},y.computeMoonPositionInEarthInertialFrame=function(n,i){return t(n)||(n=r.now()),i=yt(n,i),f.multiplyByVector(wt,i,i),i},y});t("Core/SimplePolylineGeometry",["./BoundingSphere","./Cartesian3","./Color","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./IndexDatatype","./Math","./PolylinePipeline","./PrimitiveType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function k(n,t,r,u,f,e,o){var h=v.numberOfPoints(n,t,f),s,l=r.red,a=r.green,y=r.blue,p=r.alpha,w=u.red,b=u.green,k=u.blue,d=u.alpha;if(i.equals(r,u)){for(s=0;s<h;s++)e[o++]=i.floatToByte(l),e[o++]=i.floatToByte(a),e[o++]=i.floatToByte(y),e[o++]=i.floatToByte(p);return o}var g=(w-l)/h,nt=(b-a)/h,tt=(k-y)/h,it=(d-p)/h,c=o;for(s=0;s<h;s++)e[c++]=i.floatToByte(l+s*g),e[c++]=i.floatToByte(a+s*nt),e[c++]=i.floatToByte(y+s*tt),e[c++]=i.floatToByte(p+s*it);return c}function p(n){var c;n=u(n,u.EMPTY_OBJECT);var r=n.positions,s=n.colors,h=u(n.colorsPerVertex,!1);if(!f(r)||r.length<2)throw new e("At least two positions are required.");if(f(s)&&(h&&s.length<r.length||!h&&s.length<r.length-1))throw new e("colors has an invalid length.");this._positions=r;this._colors=s;this._colorsPerVertex=h;this._followSurface=u(n.followSurface,!0);this._granularity=u(n.granularity,a.RADIANS_PER_DEGREE);this._ellipsoid=u(n.ellipsoid,o.WGS84);this._workerName="createSimplePolylineGeometry";c=1+r.length*t.packedLength;c+=f(s)?1+s.length*i.packedLength:1;this.packedLength=c+o.packedLength+3}p.pack=function(n,r,s){var h,a,c,l;if(!f(n))throw new e("value is required");if(!f(r))throw new e("array is required");for(s=u(s,0),a=n._positions,c=a.length,r[s++]=c,h=0;h<c;++h,s+=t.packedLength)t.pack(a[h],r,s);for(l=n._colors,c=f(l)?l.length:0,r[s++]=c,h=0;h<c;++h,s+=i.packedLength)i.pack(l[h],r,s);return o.pack(n._ellipsoid,r,s),s+=o.packedLength,r[s++]=n._colorsPerVertex?1:0,r[s++]=n._followSurface?1:0,r[s]=n._granularity,r};p.unpack=function(n,r,s){var h,c,l,a,v;if(!f(n))throw new e("array is required");for(r=u(r,0),c=n[r++],l=new Array(c),h=0;h<c;++h,r+=t.packedLength)l[h]=t.unpack(n,r);for(c=n[r++],a=c>0?new Array(c):undefined,h=0;h<c;++h,r+=i.packedLength)a[h]=i.unpack(n,r);v=o.unpack(n,r);r+=o.packedLength;var y=n[r++]===1,w=n[r++]===1,b=n[r];return f(s)?(s._positions=l,s._colors=a,s._ellipsoid=v,s._colorsPerVertex=y,s._followSurface=w,s._granularity=b,s):new p({positions:l,colors:a,ellipsoid:v,colorsPerVertex:y,followSurface:w,granularity:b})};var w=new Array(2),b=new Array(2),d={positions:w,height:b,ellipsoid:undefined,minDistance:undefined};return p.createGeometry=function(u){var nt=u._positions,g=u._colors,ti=u._colorsPerVertex,ii=u._followSurface,ri=u._granularity,pt=u._ellipsoid,wt=a.chordLength(ri,pt.maximumRadius),ct=f(g)&&!ti,e,ut=nt.length,tt,et,o,p,ft=0,lt,it,at,ot,vt,gt,bt,st,ht,rt,kt,yt;if(ii){if(lt=v.extractHeights(nt,pt),it=d,it.minDistance=wt,it.ellipsoid=pt,ct){for(at=0,e=0;e<ut-1;e++)at+=v.numberOfPoints(nt[e],nt[e+1],wt)+1;for(tt=new Float64Array(at*3),o=new Uint8Array(at*4),it.positions=w,it.height=b,ot=0,e=0;e<ut-1;++e){if(w[0]=nt[e],w[1]=nt[e+1],b[0]=lt[e],b[1]=lt[e+1],vt=v.generateArc(it),f(g))for(gt=vt.length/3,p=g[e],bt=0;bt<gt;++bt)o[ot++]=i.floatToByte(p.red),o[ot++]=i.floatToByte(p.green),o[ot++]=i.floatToByte(p.blue),o[ot++]=i.floatToByte(p.alpha);tt.set(vt,ft);ft+=vt.length}}else if(it.positions=nt,it.height=lt,tt=new Float64Array(v.generateArc(it)),f(g)){for(o=new Uint8Array(tt.length/3*4),e=0;e<ut-1;++e){var ui=nt[e],fi=nt[e+1],ei=g[e],oi=g[e+1];ft=k(ui,fi,ei,oi,wt,o,ft)}st=g[ut-1];o[ft++]=i.floatToByte(st.red);o[ft++]=i.floatToByte(st.green);o[ft++]=i.floatToByte(st.blue);o[ft++]=i.floatToByte(st.alpha)}}else for(et=ct?ut*2-2:ut,tt=new Float64Array(et*3),o=f(g)?new Uint8Array(et*4):undefined,ht=0,rt=0,e=0;e<ut;++e){if(kt=nt[e],ct&&e>0&&(t.pack(kt,tt,ht),ht+=3,p=g[e-1],o[rt++]=i.floatToByte(p.red),o[rt++]=i.floatToByte(p.green),o[rt++]=i.floatToByte(p.blue),o[rt++]=i.floatToByte(p.alpha)),ct&&e===ut-1)break;t.pack(kt,tt,ht);ht+=3;f(g)&&(p=g[e],o[rt++]=i.floatToByte(p.red),o[rt++]=i.floatToByte(p.green),o[rt++]=i.floatToByte(p.blue),o[rt++]=i.floatToByte(p.alpha))}yt=new c;yt.position=new h({componentDatatype:r.DOUBLE,componentsPerAttribute:3,values:tt});f(g)&&(yt.color=new h({componentDatatype:r.UNSIGNED_BYTE,componentsPerAttribute:4,values:o,normalize:!0}));et=tt.length/3;var si=(et-1)*2,dt=l.createTypedArray(et,si),ni=0;for(e=0;e<et-1;++e)dt[ni++]=e,dt[ni++]=e+1;return new s({attributes:yt,indices:dt,primitiveType:y.LINES,boundingSphere:n.fromPoints(nt)})},p});t("Core/SphereGeometry",["./Cartesian3","./Check","./defaultValue","./defined","./EllipsoidGeometry","./VertexFormat"],function(n,t,i,r,u,f){"use strict";function o(t){var r=i(t.radius,1),f=new n(r,r,r),e={radii:f,stackPartitions:t.stackPartitions,slicePartitions:t.slicePartitions,vertexFormat:t.vertexFormat};this._ellipsoidGeometry=new u(e);this._workerName="createSphereGeometry"}o.packedLength=u.packedLength;o.pack=function(n,i,r){return t.typeOf.object("value",n),u.pack(n._ellipsoidGeometry,i,r)};var s=new u,e={radius:undefined,radii:new n,vertexFormat:new f,stackPartitions:undefined,slicePartitions:undefined};return o.unpack=function(t,i,h){var c=u.unpack(t,i,s);return(e.vertexFormat=f.clone(c._vertexFormat,e.vertexFormat),e.stackPartitions=c._stackPartitions,e.slicePartitions=c._slicePartitions,!r(h))?(e.radius=c._radii.x,new o(e)):(n.clone(c._radii,e.radii),h._ellipsoidGeometry=new u(e),h)},o.createGeometry=function(n){return u.createGeometry(n._ellipsoidGeometry)},o});t("Core/SphereOutlineGeometry",["./Cartesian3","./Check","./defaultValue","./defined","./EllipsoidOutlineGeometry"],function(n,t,i,r,u){"use strict";function e(t){var r=i(t.radius,1),f=new n(r,r,r),e={radii:f,stackPartitions:t.stackPartitions,slicePartitions:t.slicePartitions,subdivisions:t.subdivisions};this._ellipsoidGeometry=new u(e);this._workerName="createSphereOutlineGeometry"}e.packedLength=u.packedLength;e.pack=function(n,i,r){return t.typeOf.object("value",n),u.pack(n._ellipsoidGeometry,i,r)};var o=new u,f={radius:undefined,radii:new n,stackPartitions:undefined,slicePartitions:undefined,subdivisions:undefined};return e.unpack=function(t,i,s){var h=u.unpack(t,i,o);return(f.stackPartitions=h._stackPartitions,f.slicePartitions=h._slicePartitions,f.subdivisions=h._subdivisions,!r(s))?(f.radius=h._radii.x,new e(f)):(n.clone(h._radii,f.radii),s._ellipsoidGeometry=new u(f),s)},e.createGeometry=function(n){return u.createGeometry(n._ellipsoidGeometry)},e});t("Core/Spherical",["./Check","./defaultValue","./defined"],function(n,t,i){"use strict";function r(n,i,r){this.clock=t(n,0);this.cone=t(i,0);this.magnitude=t(r,1)}return r.fromCartesian3=function(t,u){n.typeOf.object("cartesian3",t);var f=t.x,e=t.y,o=t.z,s=f*f+e*e;return i(u)||(u=new r),u.clock=Math.atan2(e,f),u.cone=Math.atan2(Math.sqrt(s),o),u.magnitude=Math.sqrt(s+o*o),u},r.clone=function(n,t){return i(n)?i(t)?(t.clock=n.clock,t.cone=n.cone,t.magnitude=n.magnitude,t):new r(n.clock,n.cone,n.magnitude):undefined},r.normalize=function(t,u){return(n.typeOf.object("spherical",t),!i(u))?new r(t.clock,t.cone,1):(u.clock=t.clock,u.cone=t.cone,u.magnitude=1,u)},r.equals=function(n,t){return n===t||i(n)&&i(t)&&n.clock===t.clock&&n.cone===t.cone&&n.magnitude===t.magnitude},r.equalsEpsilon=function(n,r,u){return u=t(u,0),n===r||i(n)&&i(r)&&Math.abs(n.clock-r.clock)<=u&&Math.abs(n.cone-r.cone)<=u&&Math.abs(n.magnitude-r.magnitude)<=u},r.prototype.equals=function(n){return r.equals(this,n)},r.prototype.clone=function(n){return r.clone(this,n)},r.prototype.equalsEpsilon=function(n,t){return r.equalsEpsilon(this,n,t)},r.prototype.toString=function(){return"("+this.clock+", "+this.cone+", "+this.magnitude+")"},r});t("Core/subdivideArray",["./defined","./DeveloperError"],function(n,t){"use strict";function i(i,r){var f;if(!n(i))throw new t("array is required.");if(!n(r)||r<1)throw new t("numberOfArrays must be greater than 0.");for(var e=[],o=i.length,u=0;u<o;)f=Math.ceil((o-u)/r--),e.push(i.slice(u,u+f)),u+=f;return e}return i});t("Core/TerrainData",["./defineProperties","./DeveloperError"],function(n,t){"use strict";function i(){t.throwInstantiationError()}return n(i.prototype,{credits:{get:t.throwInstantiationError},waterMask:{get:t.throwInstantiationError}}),i.prototype.interpolateHeight=t.throwInstantiationError,i.prototype.isChildAvailable=t.throwInstantiationError,i.prototype.createMesh=t.throwInstantiationError,i.prototype.upsample=t.throwInstantiationError,i.prototype.wasCreatedByUpsampling=t.throwInstantiationError,i});t("Core/TilingScheme",["./defineProperties","./DeveloperError"],function(n,t){"use strict";function i(){throw new t("This type should not be instantiated directly.  Instead, use WebMercatorTilingScheme or GeographicTilingScheme.");}return n(i.prototype,{ellipsoid:{get:t.throwInstantiationError},rectangle:{get:t.throwInstantiationError},projection:{get:t.throwInstantiationError}}),i.prototype.getNumberOfXTilesAtLevel=t.throwInstantiationError,i.prototype.getNumberOfYTilesAtLevel=t.throwInstantiationError,i.prototype.rectangleToNativeRectangle=t.throwInstantiationError,i.prototype.tileXYToNativeRectangle=t.throwInstantiationError,i.prototype.tileXYToRectangle=t.throwInstantiationError,i.prototype.positionToTileXY=t.throwInstantiationError,i});t("Core/TimeIntervalCollection",["./binarySearch","./defaultValue","./defined","./defineProperties","./DeveloperError","./Event","./GregorianDate","./isLeapYear","./Iso8601","./JulianDate","./TimeInterval"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function w(n,t){return h.compare(n.start,t.start)}function l(n){var r,t;if(this._intervals=[],this._changedEvent=new f,i(n))for(r=n.length,t=0;t<r;t++)this.addInterval(n[t])}function b(n,t,r){i(r)||(r=new h);h.toGregorianDate(n,a);var c=a.millisecond+t.millisecond,f=a.second+t.second,e=a.minute+t.minute,s=a.hour+t.hour,l=a.day+t.day,u=a.month+t.month,y=a.year+t.year;for(c>=1e3&&(f+=Math.floor(c/1e3),c=c%1e3),f>=60&&(e+=Math.floor(f/60),f=f%60),e>=60&&(s+=Math.floor(e/60),e=e%60),s>=24&&(l+=Math.floor(s/24),s=s%24),v[2]=o(y)?29:28;l>v[u]||u>=13;)l>v[u]&&(l-=v[u],++u),u>=13&&(--u,y+=Math.floor(u/12),u=u%12,++u),v[2]=o(y)?29:28;return a.millisecond=c,a.second=f,a.minute=e,a.hour=s,a.day=l,a.month=u,a.year=y,h.fromGregorianDate(a,r)}function g(n,t){var r,u;if(!i(n)||n.length===0)return!1;if(t.year=0,t.month=0,t.day=0,t.hour=0,t.minute=0,t.second=0,t.millisecond=0,n[0]==="P"){if(r=n.match(d),!i(r))return!1;i(r[1])&&(t.year=Number(r[1].replace(",",".")));i(r[2])&&(t.month=Number(r[2].replace(",",".")));i(r[3])&&(t.day=Number(r[3].replace(",","."))*7);i(r[4])&&(t.day+=Number(r[4].replace(",",".")));i(r[5])&&(t.hour=Number(r[5].replace(",",".")));i(r[6])&&(t.minute=Number(r[6].replace(",",".")));i(r[7])&&(u=Number(r[7].replace(",",".")),t.second=Math.floor(u),t.millisecond=u%1*1e3)}else n[n.length-1]!=="Z"&&(n+="Z"),h.toGregorianDate(h.fromIso8601(n,k),t);return t.year||t.month||t.day||t.hour||t.minute||t.second||t.millisecond}var p,a,v,k,d,y;return r(l.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){var n=this._intervals;return n.length===0?undefined:n[0].start}},isStartIncluded:{get:function(){var n=this._intervals;return n.length===0?!1:n[0].isStartIncluded}},stop:{get:function(){var n=this._intervals,t=n.length;return t===0?undefined:n[t-1].stop}},isStopIncluded:{get:function(){var n=this._intervals,t=n.length;return t===0?!1:n[t-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return this._intervals.length===0}}}),l.prototype.equals=function(n,t){var i;if(this===n)return!0;if(!(n instanceof l))return!1;var r=this._intervals,u=n._intervals,f=r.length;if(f!==u.length)return!1;for(i=0;i<f;i++)if(!c.equals(r[i],u[i],t))return!1;return!0},l.prototype.get=function(n){if(!i(n))throw new u("index is required.");return this._intervals[n]},l.prototype.removeAll=function(){this._intervals.length>0&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))},l.prototype.findIntervalContainingDate=function(n){var t=this.indexOf(n);return t>=0?this._intervals[t]:undefined},l.prototype.findDataForIntervalContainingDate=function(n){var t=this.indexOf(n);return t>=0?this._intervals[t].data:undefined},l.prototype.contains=function(n){return this.indexOf(n)>=0},p=new c,l.prototype.indexOf=function(t){var f,r;if(!i(t))throw new u("date is required");return(f=this._intervals,p.start=t,p.stop=t,r=n(f,p,w),r>=0)?f[r].isStartIncluded?r:r>0&&f[r-1].stop.equals(t)&&f[r-1].isStopIncluded?r-1:~r:(r=~r,r>0&&r-1<f.length&&c.contains(f[r-1],t))?r-1:~r},l.prototype.findInterval=function(n){var r,c,u;n=t(n,t.EMPTY_OBJECT);var e=n.start,o=n.stop,s=n.isStartIncluded,h=n.isStopIncluded,f=this._intervals;for(r=0,c=f.length;r<c;r++)if(u=f[r],(!i(e)||u.start.equals(e))&&(!i(o)||u.stop.equals(o))&&(!i(s)||u.isStartIncluded===s)&&(!i(h)||u.isStopIncluded===h))return f[r];return undefined},l.prototype.addInterval=function(t,r){var e,f,o;if(!i(t))throw new u("interval is required");if(!t.isEmpty){if(e=this._intervals,e.length===0||h.greaterThan(t.start,e[e.length-1].stop)){e.push(t);this._changedEvent.raiseEvent(this);return}for(f=n(e,t,w),f<0?f=~f:f>0&&t.isStartIncluded&&e[f-1].isStartIncluded&&e[f-1].start.equals(t.start)?--f:f<e.length&&!t.isStartIncluded&&e[f].isStartIncluded&&e[f].start.equals(t.start)&&++f,f>0&&(o=h.compare(e[f-1].stop,t.start),(o>0||o===0&&(e[f-1].isStopIncluded||t.isStartIncluded))&&((i(r)?r(e[f-1].data,t.data):e[f-1].data===t.data)?(t=h.greaterThan(t.stop,e[f-1].stop)?new c({start:e[f-1].start,stop:t.stop,isStartIncluded:e[f-1].isStartIncluded,isStopIncluded:t.isStopIncluded,data:t.data}):new c({start:e[f-1].start,stop:e[f-1].stop,isStartIncluded:e[f-1].isStartIncluded,isStopIncluded:e[f-1].isStopIncluded||t.stop.equals(e[f-1].stop)&&t.isStopIncluded,data:t.data}),e.splice(f-1,1),--f):(o=h.compare(e[f-1].stop,t.stop),(o>0||o===0&&e[f-1].isStopIncluded&&!t.isStopIncluded)&&e.splice(f,0,new c({start:t.stop,stop:e[f-1].stop,isStartIncluded:!t.isStopIncluded,isStopIncluded:e[f-1].isStopIncluded,data:e[f-1].data})),e[f-1]=new c({start:e[f-1].start,stop:t.start,isStartIncluded:e[f-1].isStartIncluded,isStopIncluded:!t.isStartIncluded,data:e[f-1].data}))));f<e.length;)if(o=h.compare(t.stop,e[f].start),o>0||o===0&&(t.isStopIncluded||e[f].isStartIncluded))if(i(r)?r(e[f].data,t.data):e[f].data===t.data)t=new c({start:t.start,stop:h.greaterThan(e[f].stop,t.stop)?e[f].stop:t.stop,isStartIncluded:t.isStartIncluded,isStopIncluded:h.greaterThan(e[f].stop,t.stop)?e[f].isStopIncluded:t.isStopIncluded,data:t.data}),e.splice(f,1);else if(e[f]=new c({start:t.stop,stop:e[f].stop,isStartIncluded:!t.isStopIncluded,isStopIncluded:e[f].isStopIncluded,data:e[f].data}),e[f].isEmpty)e.splice(f,1);else break;else break;e.splice(f,0,t);this._changedEvent.raiseEvent(this)}},l.prototype.removeInterval=function(t){var f,r,e;if(!i(t))throw new u("interval is required");if(t.isEmpty)return!1;for(f=this._intervals,r=n(f,t,w),r<0&&(r=~r),e=!1,r>0&&(h.greaterThan(f[r-1].stop,t.start)||f[r-1].stop.equals(t.start)&&f[r-1].isStopIncluded&&t.isStartIncluded)&&(e=!0,(h.greaterThan(f[r-1].stop,t.stop)||f[r-1].isStopIncluded&&!t.isStopIncluded&&f[r-1].stop.equals(t.stop))&&f.splice(r,0,new c({start:t.stop,stop:f[r-1].stop,isStartIncluded:!t.isStopIncluded,isStopIncluded:f[r-1].isStopIncluded,data:f[r-1].data})),f[r-1]=new c({start:f[r-1].start,stop:t.start,isStartIncluded:f[r-1].isStartIncluded,isStopIncluded:!t.isStartIncluded,data:f[r-1].data})),r<f.length&&!t.isStartIncluded&&f[r].isStartIncluded&&t.start.equals(f[r].start)&&(e=!0,f.splice(r,0,new c({start:f[r].start,stop:f[r].start,isStartIncluded:!0,isStopIncluded:!0,data:f[r].data})),++r);r<f.length&&h.greaterThan(t.stop,f[r].stop);)e=!0,f.splice(r,1);return r<f.length&&t.stop.equals(f[r].stop)&&(e=!0,!t.isStopIncluded&&f[r].isStopIncluded?r+1<f.length&&f[r+1].start.equals(t.stop)&&f[r].data===f[r+1].data?(f.splice(r,1),f[r]=new c({start:f[r].start,stop:f[r].stop,isStartIncluded:!0,isStopIncluded:f[r].isStopIncluded,data:f[r].data})):f[r]=new c({start:t.stop,stop:t.stop,isStartIncluded:!0,isStopIncluded:!0,data:f[r].data}):f.splice(r,1)),r<f.length&&(h.greaterThan(t.stop,f[r].start)||t.stop.equals(f[r].start)&&t.isStopIncluded&&f[r].isStartIncluded)&&(e=!0,f[r]=new c({start:t.stop,stop:f[r].stop,isStartIncluded:!t.isStopIncluded,isStopIncluded:f[r].isStopIncluded,data:f[r].data})),e&&this._changedEvent.raiseEvent(this),e},l.prototype.intersect=function(n,t,r){var f,e,a;if(!i(n))throw new u("other is required.");for(var v=new l,o=0,s=0,y=this._intervals,p=n._intervals;o<y.length&&s<p.length;)f=y[o],e=p[s],h.lessThan(f.stop,e.start)?++o:h.lessThan(e.stop,f.start)?++s:((i(r)||i(t)&&t(f.data,e.data)||!i(t)&&e.data===f.data)&&(a=c.intersect(f,e,new c,r),a.isEmpty||v.addInterval(a,t)),h.lessThan(f.stop,e.stop)||f.stop.equals(e.stop)&&!f.isStopIncluded&&e.isStopIncluded?++o:++s);return v},l.fromJulianDateArray=function(n,r){var o,v,y;if(!i(n))throw new u("options is required.");if(!i(n.julianDates))throw new u("options.iso8601Array is required.");i(r)||(r=new l);var h=n.julianDates,a=h.length,e=n.dataCallback,p=t(n.isStartIncluded,!0),w=t(n.isStopIncluded,!0),k=t(n.leadingInterval,!1),d=t(n.trailingInterval,!1),f,b=0;for(k&&(++b,f=new c({start:s.MINIMUM_VALUE,stop:h[0],isStartIncluded:!0,isStopIncluded:!p}),f.data=i(e)?e(f,r.length):r.length,r.addInterval(f)),o=0;o<a-1;++o)v=h[o],y=h[o+1],f=new c({start:v,stop:y,isStartIncluded:r.length===b?p:!0,isStopIncluded:o===a-2?w:!1}),f.data=i(e)?e(f,r.length):r.length,r.addInterval(f),v=y;return d&&(f=new c({start:h[a-1],stop:s.MAXIMUM_VALUE,isStartIncluded:!w,isStopIncluded:!0}),f.data=i(e)?e(f,r.length):r.length,r.addInterval(f)),r},a=new e,v=[0,31,28,31,30,31,30,31,31,30,31,30,31],k=new h,d=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/,y=new e,l.fromIso8601=function(n,t){var r,c;if(!i(n))throw new u("options is required.");if(!i(n.iso8601))throw new u("options.iso8601 is required.");var o=n.iso8601.split("/"),s=h.fromIso8601(o[0]),f=h.fromIso8601(o[1]),e=[];if(g(o[2],y))for(r=h.clone(s),e.push(r);h.compare(r,f)<0;)r=b(r,y),c=h.compare(f,r)<=0,c&&h.clone(f,r),e.push(r);else e.push(s,f);return l.fromJulianDateArray({julianDates:e,isStartIncluded:n.isStartIncluded,isStopIncluded:n.isStopIncluded,leadingInterval:n.leadingInterval,trailingInterval:n.trailingInterval,dataCallback:n.dataCallback},t)},l.fromIso8601DateArray=function(n,t){if(!i(n))throw new u("options is required.");if(!i(n.iso8601Dates))throw new u("options.iso8601Dates is required.");return l.fromJulianDateArray({julianDates:n.iso8601Dates.map(function(n){return h.fromIso8601(n)}),isStartIncluded:n.isStartIncluded,isStopIncluded:n.isStopIncluded,leadingInterval:n.leadingInterval,trailingInterval:n.trailingInterval,dataCallback:n.dataCallback},t)},l.fromIso8601DurationArray=function(n,r){var f;if(!i(n))throw new u("options is required.");if(!i(n.epoch))throw new u("options.epoch is required.");if(!i(n.iso8601Durations))throw new u("options.iso8601Durations is required.");var c=n.epoch,s=n.iso8601Durations,a=t(n.relativeToPrevious,!1),h=[],e,o,v=s.length;for(f=0;f<v;++f)(g(s[f],y)||f===0)&&(e=a&&i(o)?b(o,y):b(c,y),h.push(e),o=e);return l.fromJulianDateArray({julianDates:h,isStartIncluded:n.isStartIncluded,isStopIncluded:n.isStopIncluded,leadingInterval:n.leadingInterval,trailingInterval:n.trailingInterval,dataCallback:n.dataCallback},r)},l});t("Core/TranslationRotationScale",["./Cartesian3","./defaultValue","./defined","./Quaternion"],function(n,t,i,r){"use strict";var f=new n(1,1,1),e=n.ZERO,o=r.IDENTITY,u=function(i,u,s){this.translation=n.clone(t(i,e));this.rotation=r.clone(t(u,o));this.scale=n.clone(t(s,f))};return u.prototype.equals=function(t){return this===t||i(t)&&n.equals(this.translation,t.translation)&&r.equals(this.rotation,t.rotation)&&n.equals(this.scale,t.scale)},u});t("Core/VideoSynchronizer",["./defaultValue","./defined","./defineProperties","./destroyObject","./Iso8601","./JulianDate"],function(n,t,i,r,u,f){"use strict";function e(t){t=n(t,n.EMPTY_OBJECT);this._clock=undefined;this._element=undefined;this._clockSubscription=undefined;this._seekFunction=undefined;this._lastPlaybackRate=undefined;this.clock=t.clock;this.element=t.element;this.epoch=n(t.epoch,u.MINIMUM_VALUE);this.tolerance=n(t.tolerance,1);this._seeking=!1;this._seekFunction=undefined;this._firstTickAfterSeek=!1}function o(n){return function(){n._seeking=!1;n._firstTickAfterSeek=!0}}return i(e.prototype,{clock:{get:function(){return this._clock},set:function(n){var i=this._clock;i!==n&&(t(i)&&(this._clockSubscription(),this._clockSubscription=undefined),t(n)&&(this._clockSubscription=n.onTick.addEventListener(e.prototype._onTick,this)),this._clock=n)}},element:{get:function(){return this._element},set:function(n){var i=this._element;i!==n&&(t(i)&&i.removeEventListener("seeked",this._seekFunction,!1),t(n)&&(this._seeking=!1,this._seekFunction=o(this),n.addEventListener("seeked",this._seekFunction,!1)),this._element=n,this._seeking=!1,this._firstTickAfterSeek=!1)}}}),e.prototype.destroy=function(){return this.element=undefined,this.clock=undefined,r(this)},e.prototype.isDestroyed=function(){return!1},e.prototype._trySetPlaybackRate=function(n){if(this._lastPlaybackRate!==n.multiplier){var t=this._element;try{t.playbackRate=n.multiplier}catch(i){t.playbackRate=0}this._lastPlaybackRate=n.multiplier}},e.prototype._onTick=function(i){var r=this._element,c,o,l;if(t(r)&&!(r.readyState<2)){if(c=r.paused,o=i.shouldAnimate,o===c&&(o?r.play():r.pause()),this._seeking||this._firstTickAfterSeek){this._firstTickAfterSeek=!1;return}this._trySetPlaybackRate(i);var a=i.currentTime,v=n(this.epoch,u.MINIMUM_VALUE),e=f.secondsDifference(a,v),s=r.duration,h,y=r.currentTime;r.loop?(e=e%s,e<0&&(e=s-e),h=e):h=e>s?s:e<0?0:e;l=o?n(this.tolerance,1):.001;Math.abs(h-y)>l&&(this._seeking=!0,r.currentTime=h)}},e});t("Core/VRTheWorldTerrainProvider",["../ThirdParty/when","./Credit","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid","./Event","./GeographicTilingScheme","./getImagePixels","./HeightmapTerrainData","./Math","./Rectangle","./Resource","./TerrainProvider","./TileProviderError"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function d(n,t){this.rectangle=n;this.maxLevel=t}function w(u){function tt(n){var f=n.getElementsByTagName("SRS")[0].textContent,r,u,i;if(f==="EPSG:4326")h._tilingScheme=new s({ellipsoid:w});else{g("SRS "+f+" is not supported.");return}for(r=n.getElementsByTagName("TileFormat")[0],h._heightmapWidth=parseInt(r.getAttribute("width"),10),h._heightmapHeight=parseInt(r.getAttribute("height"),10),h._levelZeroMaximumGeometricError=y.getEstimatedLevelZeroGeometricErrorForAHeightmap(w,Math.min(h._heightmapWidth,h._heightmapHeight),h._tilingScheme.getNumberOfXTilesAtLevel(0)),u=n.getElementsByTagName("DataExtent"),i=0;i<u.length;++i){var t=u[i],e=l.toRadians(parseFloat(t.getAttribute("minx"))),o=l.toRadians(parseFloat(t.getAttribute("miny"))),c=l.toRadians(parseFloat(t.getAttribute("maxx"))),v=l.toRadians(parseFloat(t.getAttribute("maxy"))),p=parseInt(t.getAttribute("maxlevel"),10);h._rectangles.push(new d(new a(e,o,c,v),p))}h._ready=!0;h._readyPromise.resolve(!0)}function g(n){var t=i(n,"An error occurred while accessing "+h._resource.url+".");k=p.handleError(k,h,h._errorEvent,t,undefined,undefined,undefined,nt)}function nt(){n(h._resource.fetchXML(),tt,g)}var b,c,h,k,w;if(u=i(u,i.EMPTY_OBJECT),!r(u.url))throw new f("options.url is required.");b=v.createIfNeeded(u.url);this._resource=b;this._errorEvent=new o;this._ready=!1;this._readyPromise=n.defer();this._terrainDataStructure={heightScale:1/1e3,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0,lowestEncodedHeight:0,highestEncodedHeight:16777215};c=u.credit;typeof c=="string"&&(c=new t(c));this._credit=c;this._tilingScheme=undefined;this._rectangles=[];h=this;w=i(u.ellipsoid,e.WGS84);nt()}function g(n,t,i,u){for(var h,e,l,o=n._tilingScheme,c=n._rectangles,v=o.tileXYToRectangle(t,i,u),f=0,s=0;s<c.length&&f!==15;++s)(h=c[s],h.maxLevel<=u)||(e=h.rectangle,l=a.intersection(e,v,k),r(l)&&(b(o,e,t*2,i*2,u+1)&&(f|=4),b(o,e,t*2+1,i*2,u+1)&&(f|=8),b(o,e,t*2,i*2+1,u+1)&&(f|=1),b(o,e,t*2+1,i*2+1,u+1)&&(f|=2)));return f}function b(n,t,i,u,f){var e=n.tileXYToRectangle(i,u,f);return r(a.intersection(e,t,k))}u(w.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new f("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}});w.prototype.requestTileGeometry=function(t,i,u,e){var o;if(!this.ready)throw new f("requestTileGeometry must not be called before ready returns true.");var l=this._tilingScheme.getNumberOfYTilesAtLevel(u),a=this._resource.getDerivedResource({url:u+"/"+t+"/"+(l-i-1)+".tif",queryParameters:{cesium:!0},request:e}),s=a.fetchImage();return r(s)?(o=this,n(s).then(function(n){return new c({buffer:h(n),width:o._heightmapWidth,height:o._heightmapHeight,childTileMask:g(o,t,i,u),structure:o._terrainDataStructure})})):undefined};w.prototype.getLevelMaximumGeometricError=function(n){if(!this.ready)throw new f("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<n)};var k=new a;return w.prototype.getTileDataAvailable=function(){return undefined},w});t("Core/WallGeometryLibrary",["./Cartographic","./defined","./EllipsoidTangentPlane","./Math","./PolygonPipeline","./PolylinePipeline","./WindingOrder"],function(n,t,i,r,u,f,e){"use strict";function s(n,t){return r.equalsEpsilon(n.latitude,t.latitude,r.EPSILON14)&&r.equalsEpsilon(n.longitude,t.longitude,r.EPSILON14)}function l(i,r,u,f){var v=r.length,l,e,a,k,o;if(!(v<2)){var d=t(f),g=t(u),y=!0,w=new Array(v),p=new Array(v),b=new Array(v),nt=r[0];for(w[0]=nt,l=i.cartesianToCartographic(nt,h),g&&(l.height=u[0]),y=y&&l.height<=0,p[0]=l.height,b[0]=d?f[0]:0,e=1,a=1;a<v;++a)k=r[a],o=i.cartesianToCartographic(k,c),g&&(o.height=u[a]),y=y&&o.height<=0,s(l,o)?l.height<o.height&&(p[e-1]=o.height):(w[e]=k,p[e]=o.height,b[e]=d?f[a]:0,n.clone(o,l),++e);if(!y&&!(e<2))return w.length=e,p.length=e,b.length=e,{positions:w,topHeights:p,bottomHeights:b}}}var o={},h=new n,c=new n,a=new Array(2),v=new Array(2),y={positions:undefined,height:undefined,granularity:undefined,ellipsoid:undefined};return o.computePositions=function(n,o,s,h,c,p){var d=l(n,o,s,h),et,ot,tt,w,it,k,rt,ft;if(t(d)){o=d.positions;s=d.topHeights;h=d.bottomHeights;o.length>=3&&(et=i.fromPoints(o,n),ot=et.projectPointsOntoPlane(o),u.computeWindingOrder2D(ot)===e.CLOCKWISE&&(o.reverse(),s.reverse(),h.reverse()));var ut=o.length,ht=ut-2,g,nt,st=r.chordLength(c,n.maximumRadius),b=y;if(b.minDistance=st,b.ellipsoid=n,p){for(tt=0,w=0;w<ut-1;w++)tt+=f.numberOfPoints(o[w],o[w+1],st)+1;for(g=new Float64Array(tt*3),nt=new Float64Array(tt*3),it=a,k=v,b.positions=it,b.height=k,rt=0,w=0;w<ut-1;w++)it[0]=o[w],it[1]=o[w+1],k[0]=s[w],k[1]=s[w+1],ft=f.generateArc(b),g.set(ft,rt),k[0]=h[w],k[1]=h[w+1],nt.set(f.generateArc(b),rt),rt+=ft.length}else b.positions=o,b.height=s,g=new Float64Array(f.generateArc(b)),b.height=h,nt=new Float64Array(f.generateArc(b));return{bottomPositions:nt,topPositions:g,numCorners:ht}}},o});t("Core/WallGeometry",["./BoundingSphere","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./IndexDatatype","./Math","./PrimitiveType","./VertexFormat","./WallGeometryLibrary"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n){var h;n=r(n,r.EMPTY_OBJECT);var i=n.positions,o=n.maximumHeights,s=n.minimumHeights;if(!u(i))throw new f("options.positions is required.");if(u(o)&&o.length!==i.length)throw new f("options.positions and options.maximumHeights must have the same length.");if(u(s)&&s.length!==i.length)throw new f("options.positions and options.minimumHeights must have the same length.");var c=r(n.vertexFormat,v.DEFAULT),a=r(n.granularity,l.RADIANS_PER_DEGREE),y=r(n.ellipsoid,e.WGS84);this._positions=i;this._minimumHeights=s;this._maximumHeights=o;this._vertexFormat=v.clone(c);this._granularity=a;this._ellipsoid=e.clone(y);this._workerName="createWallGeometry";h=1+i.length*t.packedLength+2;u(s)&&(h+=s.length);u(o)&&(h+=o.length);this.packedLength=h+e.packedLength+v.packedLength+1}var k=new t,b=new t,d=new t,it=new t,g=new t,rt=new t,ut=new t,ft=new t;p.pack=function(n,i,o){var s,a,h,c,l;if(!u(n))throw new f("value is required");if(!u(i))throw new f("array is required");for(o=r(o,0),a=n._positions,h=a.length,i[o++]=h,s=0;s<h;++s,o+=t.packedLength)t.pack(a[s],i,o);if(c=n._minimumHeights,h=u(c)?c.length:0,i[o++]=h,u(c))for(s=0;s<h;++s)i[o++]=c[s];if(l=n._maximumHeights,h=u(l)?l.length:0,i[o++]=h,u(l))for(s=0;s<h;++s)i[o++]=l[s];return e.pack(n._ellipsoid,i,o),o+=e.packedLength,v.pack(n._vertexFormat,i,o),o+=v.packedLength,i[o]=n._granularity,i};var nt=e.clone(e.UNIT_SPHERE),tt=new v,w={positions:undefined,minimumHeights:undefined,maximumHeights:undefined,ellipsoid:nt,vertexFormat:tt,granularity:undefined};return p.unpack=function(n,i,o){var s,h,c,l,a,b,k,y;if(!u(n))throw new f("array is required");for(i=r(i,0),h=n[i++],c=new Array(h),s=0;s<h;++s,i+=t.packedLength)c[s]=t.unpack(n,i);if(h=n[i++],h>0)for(l=new Array(h),s=0;s<h;++s)l[s]=n[i++];if(h=n[i++],h>0)for(a=new Array(h),s=0;s<h;++s)a[s]=n[i++];return(b=e.unpack(n,i,nt),i+=e.packedLength,k=v.unpack(n,i,tt),i+=v.packedLength,y=n[i],!u(o))?(w.positions=c,w.minimumHeights=l,w.maximumHeights=a,w.granularity=y,new p(w)):(o._positions=c,o._minimumHeights=l,o._maximumHeights=a,o._ellipsoid=e.clone(b,o._ellipsoid),o._vertexFormat=v.clone(k,o._vertexFormat),o._granularity=y,o)},p.fromConstantHeights=function(n){var i,e,t,v;if(n=r(n,r.EMPTY_OBJECT),i=n.positions,!u(i))throw new f("options.positions is required.");var o,s,l=n.minimumHeight,a=n.maximumHeight,h=u(l),c=u(a);if(h||c)for(e=i.length,o=h?new Array(e):undefined,s=c?new Array(e):undefined,t=0;t<e;++t)h&&(o[t]=l),c&&(s[t]=a);return v={positions:i,maximumHeights:s,minimumHeights:o,ellipsoid:n.ellipsoid,vertexFormat:n.vertexFormat},new p(v)},p.createGeometry=function(r){var ai=r._positions,ki=r._minimumHeights,di=r._maximumHeights,f=r._vertexFormat,gi=r._granularity,ui=r._ellipsoid,ni=y.computePositions(ui,ai,di,ki,gi,!0),e,ii,vi,oi,si,ri,yi,pi,ct,hi,et,lt,bi,li;if(u(ni)){var nr=ni.bottomPositions,wt=ni.topPositions,tr=ni.numCorners,bt=wt.length,tt=bt*2,v=f.position?new Float64Array(tt):undefined,ot=f.normal?new Float32Array(tt):undefined,st=f.tangent?new Float32Array(tt):undefined,ht=f.bitangent?new Float32Array(tt):undefined,kt=f.st?new Float32Array(tt/3*2):undefined,at=0,vt=0,yt=0,pt=0,ti=0,p=ft,w=ut,nt=rt,fi=!0;for(bt/=3,ii=0,vi=1/(bt-ai.length+1),e=0;e<bt;++e){var dt=e*3,gt=t.fromArray(wt,dt,k),ei=t.fromArray(nr,dt,b);f.position&&(v[at++]=ei.x,v[at++]=ei.y,v[at++]=ei.z,v[at++]=gt.x,v[at++]=gt.y,v[at++]=gt.z);f.st&&(kt[ti++]=ii,kt[ti++]=0,kt[ti++]=ii,kt[ti++]=1);(f.normal||f.tangent||f.bitangent)&&(si=t.clone(t.ZERO,g),ri=ui.scaleToGeodeticSurface(t.fromArray(wt,dt,b),b),e+1<bt&&(oi=ui.scaleToGeodeticSurface(t.fromArray(wt,dt+3,d),d),si=t.fromArray(wt,dt+3,g)),fi&&(yi=t.subtract(si,gt,it),pi=t.subtract(ri,gt,k),p=t.normalize(t.cross(pi,yi,p),p),fi=!1),t.equalsEpsilon(oi,ri,l.EPSILON10)?fi=!0:(ii+=vi,f.tangent&&(w=t.normalize(t.subtract(oi,ri,w),w)),f.bitangent&&(nt=t.normalize(t.cross(p,w,nt),nt))),f.normal&&(ot[vt++]=p.x,ot[vt++]=p.y,ot[vt++]=p.z,ot[vt++]=p.x,ot[vt++]=p.y,ot[vt++]=p.z),f.tangent&&(st[pt++]=w.x,st[pt++]=w.y,st[pt++]=w.z,st[pt++]=w.x,st[pt++]=w.y,st[pt++]=w.z),f.bitangent&&(ht[yt++]=nt.x,ht[yt++]=nt.y,ht[yt++]=nt.z,ht[yt++]=nt.x,ht[yt++]=nt.y,ht[yt++]=nt.z))}for(ct=new h,f.position&&(ct.position=new s({componentDatatype:i.DOUBLE,componentsPerAttribute:3,values:v})),f.normal&&(ct.normal=new s({componentDatatype:i.FLOAT,componentsPerAttribute:3,values:ot})),f.tangent&&(ct.tangent=new s({componentDatatype:i.FLOAT,componentsPerAttribute:3,values:st})),f.bitangent&&(ct.bitangent=new s({componentDatatype:i.FLOAT,componentsPerAttribute:3,values:ht})),f.st&&(ct.st=new s({componentDatatype:i.FLOAT,componentsPerAttribute:2,values:kt})),hi=tt/3,tt-=6*(tr+1),et=c.createTypedArray(hi,tt),lt=0,e=0;e<hi-2;e+=2){var ci=e,wi=e+2,ir=t.fromArray(v,ci*3,k),rr=t.fromArray(v,wi*3,b);t.equalsEpsilon(ir,rr,l.EPSILON10)||(bi=e+1,li=e+3,et[lt++]=bi,et[lt++]=ci,et[lt++]=li,et[lt++]=li,et[lt++]=ci,et[lt++]=wi)}return new o({attributes:ct,indices:et,primitiveType:a.TRIANGLES,boundingSphere:new n.fromVertices(v)})}},p});t("Core/WallOutlineGeometry",["./BoundingSphere","./Cartesian3","./ComponentDatatype","./defaultValue","./defined","./DeveloperError","./Ellipsoid","./Geometry","./GeometryAttribute","./GeometryAttributes","./IndexDatatype","./Math","./PrimitiveType","./WallGeometryLibrary"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(n){var c,a,h;n=r(n,r.EMPTY_OBJECT);var i=n.positions,o=n.maximumHeights,s=n.minimumHeights;if(!u(i))throw new f("options.positions is required.");if(u(o)&&o.length!==i.length)throw new f("options.positions and options.maximumHeights must have the same length.");if(u(s)&&s.length!==i.length)throw new f("options.positions and options.minimumHeights must have the same length.");c=r(n.granularity,l.RADIANS_PER_DEGREE);a=r(n.ellipsoid,e.WGS84);this._positions=i;this._minimumHeights=s;this._maximumHeights=o;this._granularity=c;this._ellipsoid=e.clone(a);this._workerName="createWallOutlineGeometry";h=1+i.length*t.packedLength+2;u(s)&&(h+=s.length);u(o)&&(h+=o.length);this.packedLength=h+e.packedLength+1}var b=new t,k=new t,w,p;return y.pack=function(n,i,o){var s,a,h,c,l;if(!u(n))throw new f("value is required");if(!u(i))throw new f("array is required");for(o=r(o,0),a=n._positions,h=a.length,i[o++]=h,s=0;s<h;++s,o+=t.packedLength)t.pack(a[s],i,o);if(c=n._minimumHeights,h=u(c)?c.length:0,i[o++]=h,u(c))for(s=0;s<h;++s)i[o++]=c[s];if(l=n._maximumHeights,h=u(l)?l.length:0,i[o++]=h,u(l))for(s=0;s<h;++s)i[o++]=l[s];return e.pack(n._ellipsoid,i,o),o+=e.packedLength,i[o]=n._granularity,i},w=e.clone(e.UNIT_SPHERE),p={positions:undefined,minimumHeights:undefined,maximumHeights:undefined,ellipsoid:w,granularity:undefined},y.unpack=function(n,i,o){var s,h,c,l,a,b,v;if(!u(n))throw new f("array is required");for(i=r(i,0),h=n[i++],c=new Array(h),s=0;s<h;++s,i+=t.packedLength)c[s]=t.unpack(n,i);if(h=n[i++],h>0)for(l=new Array(h),s=0;s<h;++s)l[s]=n[i++];if(h=n[i++],h>0)for(a=new Array(h),s=0;s<h;++s)a[s]=n[i++];return(b=e.unpack(n,i,w),i+=e.packedLength,v=n[i],!u(o))?(p.positions=c,p.minimumHeights=l,p.maximumHeights=a,p.granularity=v,new y(p)):(o._positions=c,o._minimumHeights=l,o._maximumHeights=a,o._ellipsoid=e.clone(b,o._ellipsoid),o._granularity=v,o)},y.fromConstantHeights=function(n){var i,e,t,v;if(n=r(n,r.EMPTY_OBJECT),i=n.positions,!u(i))throw new f("options.positions is required.");var o,s,l=n.minimumHeight,a=n.maximumHeight,h=u(l),c=u(a);if(h||c)for(e=i.length,o=h?new Array(e):undefined,s=c?new Array(e):undefined,t=0;t<e;++t)h&&(o[t]=l),c&&(s[t]=a);return v={positions:i,maximumHeights:s,minimumHeights:o,ellipsoid:n.ellipsoid},new y(v)},y.createGeometry=function(r){var lt=r._positions,at=r._minimumHeights,vt=r._maximumHeights,yt=r._granularity,pt=r._ellipsoid,nt=v.computePositions(pt,lt,vt,at,yt,!1),f,st,w,y,p,ft,ct;if(u(nt)){var wt=nt.bottomPositions,et=nt.topPositions,tt=et.length,g=tt*2,e=new Float64Array(g),d=0;for(tt/=3,f=0;f<tt;++f){var ot=f*3,it=t.fromArray(et,ot,b),rt=t.fromArray(wt,ot,k);e[d++]=rt.x;e[d++]=rt.y;e[d++]=rt.z;e[d++]=it.x;e[d++]=it.y;e[d++]=it.z}for(st=new h({position:new s({componentDatatype:i.DOUBLE,componentsPerAttribute:3,values:e})}),w=g/3,g=2*w-4+w,y=c.createTypedArray(w,g),p=0,f=0;f<w-2;f+=2){var ut=f,ht=f+2,bt=t.fromArray(e,ut*3,b),kt=t.fromArray(e,ht*3,k);t.equalsEpsilon(bt,kt,l.EPSILON10)||(ft=f+1,ct=f+3,y[p++]=ft,y[p++]=ut,y[p++]=ft,y[p++]=ct,y[p++]=ut,y[p++]=ht)}return y[p++]=w-2,y[p++]=w-1,new o({attributes:st,indices:y,primitiveType:a.LINES,boundingSphere:new n.fromVertices(e)})}},y});t("Core/webGLConstantToGlslType",["./WebGLConstants"],function(n){"use strict";function t(t){switch(t){case n.FLOAT:return"float";case n.FLOAT_VEC2:return"vec2";case n.FLOAT_VEC3:return"vec3";case n.FLOAT_VEC4:return"vec4";case n.FLOAT_MAT2:return"mat2";case n.FLOAT_MAT3:return"mat3";case n.FLOAT_MAT4:return"mat4";case n.SAMPLER_2D:return"sampler2D";case n.BOOL:return"bool"}}return t});t("Core/WebMercatorTilingScheme",["./Cartesian2","./defaultValue","./defined","./defineProperties","./Ellipsoid","./Rectangle","./WebMercatorProjection"],function(n,t,i,r,u,f,e){"use strict";function o(r){var o,s,h;r=t(r,{});this._ellipsoid=t(r.ellipsoid,u.WGS84);this._numberOfLevelZeroTilesX=t(r.numberOfLevelZeroTilesX,1);this._numberOfLevelZeroTilesY=t(r.numberOfLevelZeroTilesY,1);this._projection=new e(this._ellipsoid);i(r.rectangleSouthwestInMeters)&&i(r.rectangleNortheastInMeters)?(this._rectangleSouthwestInMeters=r.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=r.rectangleNortheastInMeters):(o=this._ellipsoid.maximumRadius*Math.PI,this._rectangleSouthwestInMeters=new n(-o,-o),this._rectangleNortheastInMeters=new n(o,o));s=this._projection.unproject(this._rectangleSouthwestInMeters);h=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new f(s.longitude,s.latitude,h.longitude,h.latitude)}return r(o.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),o.prototype.getNumberOfXTilesAtLevel=function(n){return this._numberOfLevelZeroTilesX<<n},o.prototype.getNumberOfYTilesAtLevel=function(n){return this._numberOfLevelZeroTilesY<<n},o.prototype.rectangleToNativeRectangle=function(n,t){var e=this._projection,r=e.project(f.southwest(n)),u=e.project(f.northeast(n));return i(t)?(t.west=r.x,t.south=r.y,t.east=u.x,t.north=u.y,t):new f(r.x,r.y,u.x,u.y)},o.prototype.tileXYToNativeRectangle=function(n,t,r,u){var a=this.getNumberOfXTilesAtLevel(r),v=this.getNumberOfYTilesAtLevel(r),e=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/a,o=this._rectangleSouthwestInMeters.x+n*e,s=this._rectangleSouthwestInMeters.x+(n+1)*e,h=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/v,c=this._rectangleNortheastInMeters.y-t*h,l=this._rectangleNortheastInMeters.y-(t+1)*h;return i(u)?(u.west=o,u.south=l,u.east=s,u.north=c,u):new f(o,l,s,c)},o.prototype.tileXYToRectangle=function(t,i,r,u){var f=this.tileXYToNativeRectangle(t,i,r,u),e=this._projection,o=e.unproject(new n(f.west,f.south)),s=e.unproject(new n(f.east,f.north));return f.west=o.longitude,f.south=o.latitude,f.east=s.longitude,f.north=s.latitude,f},o.prototype.positionToTileXY=function(t,r,u){var l=this._rectangle,e;if(!f.contains(l,t))return undefined;var s=this.getNumberOfXTilesAtLevel(r),h=this.getNumberOfYTilesAtLevel(r),a=this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x,v=a/s,y=this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y,p=y/h,w=this._projection,c=w.project(t),b=c.x-this._rectangleSouthwestInMeters.x,k=this._rectangleNortheastInMeters.y-c.y,o=b/v|0;return(o>=s&&(o=s-1),e=k/p|0,e>=h&&(e=h-1),!i(u))?new n(o,e):(u.x=o,u.y=e,u)},o});t("Core/WeightSpline",["./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./Spline"],function(n,t,i,r,u,f){"use strict";function e(i){i=t(i,t.EMPTY_OBJECT);var r=i.weights,f=i.times;if(n.defined("weights",r),n.defined("times",f),n.typeOf.number.greaterThanOrEquals("weights.length",r.length,3),r.length%f.length!=0)throw new u("times.length must be a factor of weights.length.");this._times=f;this._weights=r;this._count=r.length/f.length;this._lastTimeIndex=0}return r(e.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}}),e.prototype.findTimeInterval=f.prototype.findTimeInterval,e.prototype.wrapTime=f.prototype.wrapTime,e.prototype.clampTime=f.prototype.clampTime,e.prototype.evaluate=function(n,t){var o=this.weights,f=this.times,u=this._lastTimeIndex=this.findTimeInterval(n,this._lastTimeIndex),s=(n-f[u])/(f[u+1]-f[u]),r,e;for(i(t)||(t=new Array(this._count)),r=0;r<this._count;r++)e=u*this._count+r,t[r]=o[e]*(1-s)+o[e+this._count]*s;return t},e});t("Core/wrapFunction",["./DeveloperError"],function(n){"use strict";function t(t,i,r){if(typeof i!="function")throw new n("oldFunction is required to be a function.");if(typeof r!="function")throw new n("oldFunction is required to be a function.");return function(){r.apply(t,arguments);i.apply(t,arguments)}}return t});t("DataSources/ConstantProperty",["../Core/defined","../Core/defineProperties","../Core/Event"],function(n,t,i){"use strict";function r(n){this._value=undefined;this._hasClone=!1;this._hasEquals=!1;this._definitionChanged=new i;this.setValue(n)}return t(r.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}}),r.prototype.getValue=function(n,t){return this._hasClone?this._value.clone(t):this._value},r.prototype.setValue=function(t){var i=this._value;if(i!==t){var r=n(t),u=r&&typeof t.clone=="function",f=r&&typeof t.equals=="function",e=!f||!t.equals(i);e&&(this._hasClone=u,this._hasEquals=f,this._value=u?t.clone(this._value):t,this._definitionChanged.raiseEvent(this))}},r.prototype.equals=function(n){return this===n||n instanceof r&&(!this._hasEquals&&this._value===n._value||this._hasEquals&&this._value.equals(n._value))},r.prototype.valueOf=function(){return this._value},r.prototype.toString=function(){return String(this._value)},r});t("DataSources/createPropertyDescriptor",["../Core/defaultValue","../Core/defined","./ConstantProperty"],function(n,t,i){"use strict";function r(n,i,r,u,f){return{configurable:u,get:function(){return this[i]},set:function(u){var e=this[i],o=this[r],s;t(o)&&(o(),this[r]=undefined);s=u!==undefined;s&&(!t(u)||!t(u.getValue))&&t(f)&&(u=f(u));e!==u&&(this[i]=u,this._definitionChanged.raiseEvent(this,n,u,e));t(u)&&t(u.definitionChanged)&&(this[r]=u.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,n,u,u)},this))}}}function u(n){return new i(n)}function f(t,i,f){return r(t,"_"+t.toString(),"_"+t.toString()+"Subscription",n(i,!1),n(f,u))}return f});t("DataSources/BillboardGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createPropertyDescriptor"],function(n,t,i,r,u,f){"use strict";function e(t){this._image=undefined;this._imageSubscription=undefined;this._imageSubRegion=undefined;this._imageSubRegionSubscription=undefined;this._width=undefined;this._widthSubscription=undefined;this._height=undefined;this._heightSubscription=undefined;this._scale=undefined;this._scaleSubscription=undefined;this._rotation=undefined;this._rotationSubscription=undefined;this._alignedAxis=undefined;this._alignedAxisSubscription=undefined;this._horizontalOrigin=undefined;this._horizontalOriginSubscription=undefined;this._verticalOrigin=undefined;this._verticalOriginSubscription=undefined;this._color=undefined;this._colorSubscription=undefined;this._eyeOffset=undefined;this._eyeOffsetSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._pixelOffset=undefined;this._pixelOffsetSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._scaleByDistance=undefined;this._scaleByDistanceSubscription=undefined;this._translucencyByDistance=undefined;this._translucencyByDistanceSubscription=undefined;this._pixelOffsetScaleByDistance=undefined;this._pixelOffsetScaleByDistanceSubscription=undefined;this._sizeInMeters=undefined;this._sizeInMetersSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._disableDepthTestDistance=undefined;this._disableDepthTestDistanceSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},image:f("image"),imageSubRegion:f("imageSubRegion"),scale:f("scale"),rotation:f("rotation"),alignedAxis:f("alignedAxis"),horizontalOrigin:f("horizontalOrigin"),verticalOrigin:f("verticalOrigin"),color:f("color"),eyeOffset:f("eyeOffset"),heightReference:f("heightReference"),pixelOffset:f("pixelOffset"),show:f("show"),width:f("width"),height:f("height"),scaleByDistance:f("scaleByDistance"),translucencyByDistance:f("translucencyByDistance"),pixelOffsetScaleByDistance:f("pixelOffsetScaleByDistance"),sizeInMeters:f("sizeInMeters"),distanceDisplayCondition:f("distanceDisplayCondition"),disableDepthTestDistance:f("disableDepthTestDistance")}),e.prototype.clone=function(n){return t(n)?(n.color=this._color,n.eyeOffset=this._eyeOffset,n.heightReference=this._heightReference,n.horizontalOrigin=this._horizontalOrigin,n.image=this._image,n.imageSubRegion=this._imageSubRegion,n.pixelOffset=this._pixelOffset,n.scale=this._scale,n.rotation=this._rotation,n.alignedAxis=this._alignedAxis,n.show=this._show,n.verticalOrigin=this._verticalOrigin,n.width=this._width,n.height=this._height,n.scaleByDistance=this._scaleByDistance,n.translucencyByDistance=this._translucencyByDistance,n.pixelOffsetScaleByDistance=this._pixelOffsetScaleByDistance,n.sizeInMeters=this._sizeInMeters,n.distanceDisplayCondition=this._distanceDisplayCondition,n.disableDepthTestDistance=this._disableDepthTestDistance,n):new e(this)},e.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.color=n(this._color,i.color);this.eyeOffset=n(this._eyeOffset,i.eyeOffset);this.heightReference=n(this._heightReference,i.heightReference);this.horizontalOrigin=n(this._horizontalOrigin,i.horizontalOrigin);this.image=n(this._image,i.image);this.imageSubRegion=n(this._imageSubRegion,i.imageSubRegion);this.pixelOffset=n(this._pixelOffset,i.pixelOffset);this.scale=n(this._scale,i.scale);this.rotation=n(this._rotation,i.rotation);this.alignedAxis=n(this._alignedAxis,i.alignedAxis);this.show=n(this._show,i.show);this.verticalOrigin=n(this._verticalOrigin,i.verticalOrigin);this.width=n(this._width,i.width);this.height=n(this._height,i.height);this.scaleByDistance=n(this._scaleByDistance,i.scaleByDistance);this.translucencyByDistance=n(this._translucencyByDistance,i.translucencyByDistance);this.pixelOffsetScaleByDistance=n(this._pixelOffsetScaleByDistance,i.pixelOffsetScaleByDistance);this.sizeInMeters=n(this._sizeInMeters,i.sizeInMeters);this.distanceDisplayCondition=n(this._distanceDisplayCondition,i.distanceDisplayCondition);this.disableDepthTestDistance=n(this._disableDepthTestDistance,i.disableDepthTestDistance)},e});t("Scene/HeightReference",["../Core/freezeObject"],function(n){"use strict";return n({NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2})});t("Scene/HorizontalOrigin",["../Core/freezeObject"],function(n){"use strict";return n({CENTER:0,LEFT:1,RIGHT:-1})});t("Scene/VerticalOrigin",["../Core/freezeObject"],function(n){"use strict";return n({CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1})});t("DataSources/BoundingSphereState",["../Core/freezeObject"],function(n){"use strict";return n({DONE:0,PENDING:1,FAILED:2})});t("DataSources/Property",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError"],function(n,t,i,r){"use strict";function u(){r.throwInstantiationError()}return i(u.prototype,{isConstant:{get:r.throwInstantiationError},definitionChanged:{get:r.throwInstantiationError}}),u.prototype.getValue=r.throwInstantiationError,u.prototype.equals=r.throwInstantiationError,u.equals=function(n,i){return n===i||t(n)&&n.equals(i)},u.arrayEquals=function(n,i){var f,r;if(n===i)return!0;if(!t(n)||!t(i)||n.length!==i.length)return!1;for(f=n.length,r=0;r<f;r++)if(!u.equals(n[r],i[r]))return!1;return!0},u.isConstant=function(n){return!t(n)||n.isConstant},u.getValueOrUndefined=function(n,i,r){return t(n)?n.getValue(i,r):undefined},u.getValueOrDefault=function(i,r,u,f){return t(i)?n(i.getValue(r,f),u):u},u.getValueOrClonedDefault=function(n,i,r,u){var f;return t(n)&&(f=n.getValue(i,u)),t(f)||(f=r.clone(f)),f},u});t("DataSources/BillboardVisualizer",["../Core/AssociativeArray","../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/NearFarScalar","../Scene/HeightReference","../Scene/HorizontalOrigin","../Scene/VerticalOrigin","./BoundingSphereState","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function b(n){this.entity=n;this.billboard=undefined;this.textureValue=undefined}function p(t,i){if(!f(t))throw new o("entityCluster is required.");if(!f(i))throw new o("entityCollection is required.");i.collectionChanged.addEventListener(p.prototype._onCollectionChanged,this);this._cluster=t;this._entityCollection=i;this._items=new n;this._onCollectionChanged(i,i.values,[],[])}function w(n,t,i){f(n)&&(n.billboard=undefined,i.removeBillboard(t))}var k=u.WHITE,d=r.ZERO,g=c.NONE,nt=i.ZERO,tt=1,it=0,rt=r.ZERO,ut=l.CENTER,ft=a.CENTER,et=!1,ot=new r,st=new u,ht=new r,ct=new i,lt=new h,at=new h,vt=new h,yt=new t,pt=new s;return p.prototype.update=function(n){var l,s,h,p,v;if(!f(n))throw new o("time is required.");for(l=this._items.values,s=this._cluster,h=0,p=l.length;h<p;h++){var u=l[h],r=u.entity,i=r._billboard,e,t=u.billboard,c=r.isShowing&&r.isAvailable(n)&&y.getValueOrDefault(i._show,n,!0),a;if(c&&(a=y.getValueOrUndefined(r._position,n,ot),e=y.getValueOrUndefined(i._image,n),c=f(a)&&f(e)),!c){w(u,r,s);continue}y.isConstant(r._position)||(s._clusterDirty=!0);f(t)||(t=s.getBillboard(r),t.id=r,t.image=undefined,u.billboard=t);t.show=c;f(t.image)&&u.textureValue===e||(t.image=e,u.textureValue=e);t.position=a;t.color=y.getValueOrDefault(i._color,n,k,st);t.eyeOffset=y.getValueOrDefault(i._eyeOffset,n,d,ht);t.heightReference=y.getValueOrDefault(i._heightReference,n,g);t.pixelOffset=y.getValueOrDefault(i._pixelOffset,n,nt,ct);t.scale=y.getValueOrDefault(i._scale,n,tt);t.rotation=y.getValueOrDefault(i._rotation,n,it);t.alignedAxis=y.getValueOrDefault(i._alignedAxis,n,rt);t.horizontalOrigin=y.getValueOrDefault(i._horizontalOrigin,n,ut);t.verticalOrigin=y.getValueOrDefault(i._verticalOrigin,n,ft);t.width=y.getValueOrUndefined(i._width,n);t.height=y.getValueOrUndefined(i._height,n);t.scaleByDistance=y.getValueOrUndefined(i._scaleByDistance,n,lt);t.translucencyByDistance=y.getValueOrUndefined(i._translucencyByDistance,n,at);t.pixelOffsetScaleByDistance=y.getValueOrUndefined(i._pixelOffsetScaleByDistance,n,vt);t.sizeInMeters=y.getValueOrDefault(i._sizeInMeters,n,et);t.distanceDisplayCondition=y.getValueOrUndefined(i._distanceDisplayCondition,n,pt);t.disableDepthTestDistance=y.getValueOrUndefined(i._disableDepthTestDistance,n);v=y.getValueOrUndefined(i._imageSubRegion,n,yt);f(v)&&t.setImageSubRegion(t._imageId,v)}return!0},p.prototype.getBoundingSphere=function(n,t){var u,i;if(!f(n))throw new o("entity is required.");if(!f(t))throw new o("result is required.");if(u=this._items.get(n.id),!f(u)||!f(u.billboard))return v.FAILED;if(i=u.billboard,i.heightReference===c.NONE)t.center=r.clone(i.position,t.center);else{if(!f(i._clampedPosition))return v.PENDING;t.center=r.clone(i._clampedPosition,t.center)}return t.radius=0,v.DONE},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){var t,n;for(this._entityCollection.collectionChanged.removeEventListener(p.prototype._onCollectionChanged,this),t=this._entityCollection.values,n=0;n<t.length;n++)this._cluster.removeBillboard(t[n]);return e(this)},p.prototype._onCollectionChanged=function(n,t,i,r){for(var u,o=this._items,s=this._cluster,e=t.length-1;e>-1;e--)u=t[e],f(u._billboard)&&f(u._position)&&o.set(u.id,new b(u));for(e=r.length-1;e>-1;e--)u=r[e],f(u._billboard)&&f(u._position)?o.contains(u.id)||o.set(u.id,new b(u)):(w(o.get(u.id),u,s),o.remove(u.id));for(e=i.length-1;e>-1;e--)u=i[e],w(o.get(u.id),u,s),o.remove(u.id)},p});t("Shaders/Appearances/AllMaterialAppearanceFS",[],function(){"use strict";return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nmat3 tangentToEyeMatrix = czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = tangentToEyeMatrix;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nmaterialInput.st = v_st;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});t("Shaders/Appearances/AllMaterialAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_tangentEC = czm_normal * tangent;\nv_bitangentEC = czm_normal * bitangent;\nv_st = st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"});t("Shaders/Appearances/BasicMaterialAppearanceFS",[],function(){"use strict";return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});t("Shaders/Appearances/BasicMaterialAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"});t("Shaders/Appearances/TexturedMaterialAppearanceFS",[],function(){"use strict";return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nmaterialInput.st = v_st;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});t("Shaders/Appearances/TexturedMaterialAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_st = st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"});t("Scene/BlendEquation",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={ADD:t.FUNC_ADD,SUBTRACT:t.FUNC_SUBTRACT,REVERSE_SUBTRACT:t.FUNC_REVERSE_SUBTRACT,MIN:t.MIN,MAX:t.MAX};return n(i)});t("Scene/BlendFunction",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={ZERO:t.ZERO,ONE:t.ONE,SOURCE_COLOR:t.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:t.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:t.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:t.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:t.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:t.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:t.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:t.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:t.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:t.ONE_MINUS_CONSTANT_ALPHA,CONSTANT_ALPHA:t.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:t.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:t.SRC_ALPHA_SATURATE};return n(i)});t("Scene/BlendingState",["../Core/freezeObject","./BlendEquation","./BlendFunction"],function(n,t,i){"use strict";var r={DISABLED:n({enabled:!1}),ALPHA_BLEND:n({enabled:!0,equationRgb:t.ADD,equationAlpha:t.ADD,functionSourceRgb:i.SOURCE_ALPHA,functionSourceAlpha:i.SOURCE_ALPHA,functionDestinationRgb:i.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:i.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:n({enabled:!0,equationRgb:t.ADD,equationAlpha:t.ADD,functionSourceRgb:i.ONE,functionSourceAlpha:i.ONE,functionDestinationRgb:i.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:i.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:n({enabled:!0,equationRgb:t.ADD,equationAlpha:t.ADD,functionSourceRgb:i.SOURCE_ALPHA,functionSourceAlpha:i.SOURCE_ALPHA,functionDestinationRgb:i.ONE,functionDestinationAlpha:i.ONE})};return n(r)});t("Scene/CullFace",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={FRONT:t.FRONT,BACK:t.BACK,FRONT_AND_BACK:t.FRONT_AND_BACK};return n(i)});t("Scene/Appearance",["../Core/clone","../Core/combine","../Core/defaultValue","../Core/defined","../Core/defineProperties","./BlendingState","./CullFace"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=i(n,i.EMPTY_OBJECT);this.material=n.material;this.translucent=i(n.translucent,!0);this._vertexShaderSource=n.vertexShaderSource;this._fragmentShaderSource=n.fragmentShaderSource;this._renderState=n.renderState;this._closed=i(n.closed,!1)}return u(o.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}}),o.prototype.getFragmentShaderSource=function(){var n=[];return this.flat&&n.push("#define FLAT"),this.faceForward&&n.push("#define FACE_FORWARD"),r(this.material)&&n.push(this.material.shaderSource),n.push(this.fragmentShaderSource),n.join("\n")},o.prototype.isTranslucent=function(){return r(this.material)&&this.material.isTranslucent()||!r(this.material)&&this.translucent},o.prototype.getRenderState=function(){var i=this.isTranslucent(),t=n(this.renderState,!1);return i?(t.depthMask=!1,t.blending=f.ALPHA_BLEND):t.depthMask=!0,t},o.getDefaultRenderState=function(n,i,u){var o={depthTest:{enabled:!0}};return n&&(o.depthMask=!1,o.blending=f.ALPHA_BLEND),i&&(o.cull={enabled:!0,face:e.BACK}),r(u)&&(o=t(u,o,!0)),o},o});t("Renderer/ContextLimits",["../Core/defineProperties"],function(n){"use strict";var t={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};return n(t,{maximumCombinedTextureImageUnits:{get:function(){return t._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return t._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return t._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return t._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return t._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return t._maximumTextureSize}},maximumVaryingVectors:{get:function(){return t._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return t._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return t._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return t._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return t._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return t._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return t._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return t._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return t._maximumViewportWidth}},maximumViewportHeight:{get:function(){return t._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return t._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return t._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return t._maximumColorAttachments}},highpFloatSupported:{get:function(){return t._highpFloatSupported}},highpIntSupported:{get:function(){return t._highpIntSupported}}}),t});t("Renderer/CubeMapFace",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/PixelFormat","./PixelDatatype"],function(n,t,i,r,u,f,e){"use strict";function o(n,t,i,r,u,f,e,o,s,h){this._gl=n;this._texture=t;this._textureTarget=i;this._targetFace=r;this._pixelFormat=u;this._pixelDatatype=f;this._size=e;this._preMultiplyAlpha=o;this._flipY=s;this._initialized=h}return r(o.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}}),o.prototype.copyFrom=function(r,e,o){var g;if(e=t(e,0),o=t(o,0),n.defined("source",r),n.typeOf.number.greaterThanOrEquals("xOffset",e,0),n.typeOf.number.greaterThanOrEquals("yOffset",o,0),e+r.width>this._size)throw new u("xOffset + source.width must be less than or equal to width.");if(o+r.height>this._size)throw new u("yOffset + source.height must be less than or equal to height.");var s=this._gl,b=this._textureTarget,v=this._targetFace;s.activeTexture(s.TEXTURE0);s.bindTexture(b,this._texture);var p=r.width,w=r.height,l=r.arrayBufferView,c=this._size,h=this._pixelFormat,a=this._pixelDatatype,k=this._preMultiplyAlpha,y=this._flipY,d=!1;this._initialized||(e===0&&o===0&&p===c&&w===c?(i(l)?(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),y&&(l=f.flipY(l,h,a,c,c)),s.texImage2D(v,0,h,c,c,0,h,a,l)):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,y),s.texImage2D(v,0,h,h,a,r)),d=!0):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),g=f.createTypedArray(h,a,c,c),s.texImage2D(v,0,h,c,c,0,h,a,g)),this._initialized=!0);d||(l?(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),y&&(l=f.flipY(l,h,a,p,w)),s.texSubImage2D(v,0,e,o,p,w,h,a,l)):(s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,y),s.texSubImage2D(v,0,e,o,h,a,r)));s.bindTexture(b,null)},o.prototype.copyFromFramebuffer=function(i,r,f,o,s,h){if(i=t(i,0),r=t(r,0),f=t(f,0),o=t(o,0),s=t(s,this._size),h=t(h,this._size),n.typeOf.number.greaterThanOrEquals("xOffset",i,0),n.typeOf.number.greaterThanOrEquals("yOffset",r,0),n.typeOf.number.greaterThanOrEquals("framebufferXOffset",f,0),n.typeOf.number.greaterThanOrEquals("framebufferYOffset",o,0),i+s>this._size)throw new u("xOffset + source.width must be less than or equal to width.");if(r+h>this._size)throw new u("yOffset + source.height must be less than or equal to height.");if(this._pixelDatatype===e.FLOAT)throw new u("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===e.HALF_FLOAT)throw new u("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");var c=this._gl,l=this._textureTarget;c.activeTexture(c.TEXTURE0);c.bindTexture(l,this._texture);c.copyTexSubImage2D(this._targetFace,0,i,r,f,o,s,h);c.bindTexture(l,null);this._initialized=!0},o});t("Renderer/MipmapHint",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={DONT_CARE:t.DONT_CARE,FASTEST:t.FASTEST,NICEST:t.NICEST,validate:function(n){return n===i.DONT_CARE||n===i.FASTEST||n===i.NICEST}};return n(i)});t("Renderer/TextureMagnificationFilter",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={NEAREST:t.NEAREST,LINEAR:t.LINEAR,validate:function(n){return n===i.NEAREST||n===i.LINEAR}};return n(i)});t("Renderer/TextureMinificationFilter",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={NEAREST:t.NEAREST,LINEAR:t.LINEAR,NEAREST_MIPMAP_NEAREST:t.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:t.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:t.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:t.LINEAR_MIPMAP_LINEAR,validate:function(n){return n===i.NEAREST||n===i.LINEAR||n===i.NEAREST_MIPMAP_NEAREST||n===i.LINEAR_MIPMAP_NEAREST||n===i.NEAREST_MIPMAP_LINEAR||n===i.LINEAR_MIPMAP_LINEAR}};return n(i)});t("Renderer/TextureWrap",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={CLAMP_TO_EDGE:t.CLAMP_TO_EDGE,REPEAT:t.REPEAT,MIRRORED_REPEAT:t.MIRRORED_REPEAT,validate:function(n){return n===i.CLAMP_TO_EDGE||n===i.REPEAT||n===i.MIRRORED_REPEAT}};return n(i)});t("Renderer/Sampler",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","./TextureMagnificationFilter","./TextureMinificationFilter","./TextureWrap"],function(n,t,i,r,u,f,e,o){"use strict";function s(r){r=t(r,t.EMPTY_OBJECT);var s=t(r.wrapS,o.CLAMP_TO_EDGE),h=t(r.wrapT,o.CLAMP_TO_EDGE),c=t(r.minificationFilter,e.LINEAR),l=t(r.magnificationFilter,f.LINEAR),a=i(r.maximumAnisotropy)?r.maximumAnisotropy:1;if(!o.validate(s))throw new u("Invalid sampler.wrapS.");if(!o.validate(h))throw new u("Invalid sampler.wrapT.");if(!e.validate(c))throw new u("Invalid sampler.minificationFilter.");if(!f.validate(l))throw new u("Invalid sampler.magnificationFilter.");n.typeOf.number.greaterThanOrEquals("maximumAnisotropy",a,1);this._wrapS=s;this._wrapT=h;this._minificationFilter=c;this._magnificationFilter=l;this._maximumAnisotropy=a}return r(s.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}}),s.equals=function(n,t){return n===t||i(n)&&i(t)&&n._wrapS===t._wrapS&&n._wrapT===t._wrapT&&n._minificationFilter===t._minificationFilter&&n._magnificationFilter===t._magnificationFilter&&n._maximumAnisotropy===t._maximumAnisotropy},s});t("Renderer/CubeMap",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/PixelFormat","./ContextLimits","./CubeMapFace","./MipmapHint","./PixelDatatype","./Sampler","./TextureMagnificationFilter","./TextureMinificationFilter"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(r){function it(n,t,i,r){var f=t.arrayBufferView;f?(u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!1),r&&(f=o.flipY(f,e,v,c,c)),u.texImage2D(n,0,e,c,c,0,e,v,f)):(u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,r),u.texImage2D(n,0,e,e,v,t))}var nt,y,tt,rt,b,ut,g;if(r=t(r,t.EMPTY_OBJECT),n.defined("options.context",r.context),nt=r.context,y=r.source,i(y)){if(b=[y.positiveX,y.negativeX,y.positiveY,y.negativeY,y.positiveZ,y.negativeZ],!b[0]||!b[1]||!b[2]||!b[3]||!b[4]||!b[5])throw new f("options.source requires positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ faces.");for(tt=b[0].width,rt=b[0].height,ut=1;ut<6;++ut)if(Number(b[ut].width)!==tt||Number(b[ut].height)!==rt)throw new f("Each face in options.source must have the same width and height.");}else tt=r.width,rt=r.height;var c=tt,e=t(r.pixelFormat,o.RGBA),v=t(r.pixelDatatype,l.UNSIGNED_BYTE);if(!i(tt)||!i(rt))throw new f("options requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(tt!==rt)throw new f("Width must equal height.");if(c<=0)throw new f("Width and height must be greater than zero.");if(c>s.maximumCubeMapSize)throw new f("Width and height must be less than or equal to the maximum cube map size ("+s.maximumCubeMapSize+").  Check maximumCubeMapSize.");if(!o.validate(e))throw new f("Invalid options.pixelFormat.");if(o.isDepthFormat(e))throw new f("options.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(!l.validate(v))throw new f("Invalid options.pixelDatatype.");if(v===l.FLOAT&&!nt.floatingPointTexture)throw new f("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.");if(v===l.HALF_FLOAT&&!nt.halfFloatingPointTexture)throw new f("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension.");var ft=o.textureSizeInBytes(e,v,c,c)*6,p=r.preMultiplyAlpha||e===o.RGB||e===o.LUMINANCE,w=t(r.flipY,!0),u=nt._gl,k=u.TEXTURE_CUBE_MAP,d=u.createTexture();u.activeTexture(u.TEXTURE0);u.bindTexture(k,d);i(y)?(it(u.TEXTURE_CUBE_MAP_POSITIVE_X,y.positiveX,p,w),it(u.TEXTURE_CUBE_MAP_NEGATIVE_X,y.negativeX,p,w),it(u.TEXTURE_CUBE_MAP_POSITIVE_Y,y.positiveY,p,w),it(u.TEXTURE_CUBE_MAP_NEGATIVE_Y,y.negativeY,p,w),it(u.TEXTURE_CUBE_MAP_POSITIVE_Z,y.positiveZ,p,w),it(u.TEXTURE_CUBE_MAP_NEGATIVE_Z,y.negativeZ,p,w)):(u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,c,c,0,e,v,null),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,c,c,0,e,v,null),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,c,c,0,e,v,null),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,c,c,0,e,v,null),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,c,c,0,e,v,null),u.texImage2D(u.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,c,c,0,e,v,null));u.bindTexture(k,null);this._context=nt;this._textureFilterAnisotropic=nt._textureFilterAnisotropic;this._textureTarget=k;this._texture=d;this._pixelFormat=e;this._pixelDatatype=v;this._size=c;this._hasMipmap=!1;this._sizeInBytes=ft;this._preMultiplyAlpha=p;this._flipY=w;this._sampler=undefined;g=i(y);this._positiveX=new h(u,d,k,u.TEXTURE_CUBE_MAP_POSITIVE_X,e,v,c,p,w,g);this._negativeX=new h(u,d,k,u.TEXTURE_CUBE_MAP_NEGATIVE_X,e,v,c,p,w,g);this._positiveY=new h(u,d,k,u.TEXTURE_CUBE_MAP_POSITIVE_Y,e,v,c,p,w,g);this._negativeY=new h(u,d,k,u.TEXTURE_CUBE_MAP_NEGATIVE_Y,e,v,c,p,w,g);this._positiveZ=new h(u,d,k,u.TEXTURE_CUBE_MAP_POSITIVE_Z,e,v,c,p,w,g);this._negativeZ=new h(u,d,k,u.TEXTURE_CUBE_MAP_NEGATIVE_Z,e,v,c,p,w,g);this.sampler=i(r.sampler)?r.sampler:new a}return r(p.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(n){var u=n.minificationFilter,e=n.magnificationFilter,s=u===y.NEAREST_MIPMAP_NEAREST||u===y.NEAREST_MIPMAP_LINEAR||u===y.LINEAR_MIPMAP_NEAREST||u===y.LINEAR_MIPMAP_LINEAR,f=this._context,o=this._pixelDatatype,t,r;(o!==l.FLOAT||f.textureFloatLinear)&&(o!==l.HALF_FLOAT||f.textureHalfFloatLinear)||(u=s?y.NEAREST_MIPMAP_NEAREST:y.NEAREST,e=v.NEAREST);t=f._gl;r=this._textureTarget;t.activeTexture(t.TEXTURE0);t.bindTexture(r,this._texture);t.texParameteri(r,t.TEXTURE_MIN_FILTER,u);t.texParameteri(r,t.TEXTURE_MAG_FILTER,e);t.texParameteri(r,t.TEXTURE_WRAP_S,n.wrapS);t.texParameteri(r,t.TEXTURE_WRAP_T,n.wrapT);i(this._textureFilterAnisotropic)&&t.texParameteri(r,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.maximumAnisotropy);t.bindTexture(r,null);this._sampler=n}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}}),p.prototype.generateMipmap=function(n){if(n=t(n,c.DONT_CARE),this._size>1&&!e.isPowerOfTwo(this._size))throw new f("width and height must be a power of two to call generateMipmap().");if(!c.validate(n))throw new f("hint is invalid.");this._hasMipmap=!0;var i=this._context._gl,r=this._textureTarget;i.hint(i.GENERATE_MIPMAP_HINT,n);i.activeTexture(i.TEXTURE0);i.bindTexture(r,this._texture);i.generateMipmap(r);i.bindTexture(r,null)},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),this._positiveX=u(this._positiveX),this._negativeX=u(this._negativeX),this._positiveY=u(this._positiveY),this._negativeY=u(this._negativeY),this._positiveZ=u(this._positiveZ),this._negativeZ=u(this._negativeZ),u(this)},p});t("Renderer/Texture",["../Core/Cartesian2","../Core/Check","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/PixelFormat","../Core/WebGLConstants","./ContextLimits","./MipmapHint","./PixelDatatype","./Sampler","./TextureMagnificationFilter","./TextureMinificationFilter"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(f){var nt,et;f=r(f,r.EMPTY_OBJECT);t.defined("options.context",f.context);var d=f.context,b=f.width,k=f.height,a=f.source;u(a)&&(u(b)||(b=r(a.videoWidth,a.width)),u(k)||(k=r(a.videoHeight,a.height)));var p=r(f.pixelFormat,h.RGBA),w=r(f.pixelDatatype,v.UNSIGNED_BYTE),s=p,tt=h.isCompressedFormat(s);if(d.webgl2)if(p===h.DEPTH_STENCIL?s=c.DEPTH24_STENCIL8:p===h.DEPTH_COMPONENT&&(w===v.UNSIGNED_SHORT?s=c.DEPTH_COMPONENT16:w===v.UNSIGNED_INT&&(s=c.DEPTH_COMPONENT24)),w===v.FLOAT)switch(p){case h.RGBA:s=c.RGBA32F;break;case h.RGB:s=c.RGB32F;break;case h.RG:s=c.RG32F;break;case h.R:s=c.R32F}else if(w===v.HALF_FLOAT)switch(p){case h.RGBA:s=c.RGBA16F;break;case h.RGB:s=c.RGB16F;break;case h.RG:s=c.RG16F;break;case h.R:s=c.R16F}if(!u(b)||!u(k))throw new o("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");if(t.typeOf.number.greaterThan("width",b,0),b>l.maximumTextureSize)throw new o("Width must be less than or equal to the maximum texture size ("+l.maximumTextureSize+").  Check maximumTextureSize.");if(t.typeOf.number.greaterThan("height",k,0),k>l.maximumTextureSize)throw new o("Height must be less than or equal to the maximum texture size ("+l.maximumTextureSize+").  Check maximumTextureSize.");if(!h.validate(p))throw new o("Invalid options.pixelFormat.");if(!tt&&!v.validate(w))throw new o("Invalid options.pixelDatatype.");if(p===h.DEPTH_COMPONENT&&w!==v.UNSIGNED_SHORT&&w!==v.UNSIGNED_INT)throw new o("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(p===h.DEPTH_STENCIL&&w!==v.UNSIGNED_INT_24_8)throw new o("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(w===v.FLOAT&&!d.floatingPointTexture)throw new o("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(w===v.HALF_FLOAT&&!d.halfFloatingPointTexture)throw new o("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(h.isDepthFormat(p)){if(u(a))throw new o("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!d.depthTexture)throw new o("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.");}if(tt){if(!u(a)||!u(a.arrayBufferView))throw new o("When options.pixelFormat is compressed, options.source.arrayBufferView must be defined.");if(h.isDXTFormat(s)&&!d.s3tc)throw new o("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc.");else if(h.isPVRTCFormat(s)&&!d.pvrtc)throw new o("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc.");else if(h.isETC1Format(s)&&!d.etc1)throw new o("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.");if(h.compressedTextureSizeInBytes(s,b,k)!==a.arrayBufferView.byteLength)throw new o("The byte length of the array buffer is invalid for the compressed texture with the given width and height.");}var rt=f.preMultiplyAlpha||p===h.RGB||p===h.LUMINANCE,it=r(f.flipY,!0),ut=!0,e=d._gl,g=e.TEXTURE_2D,ft=e.createTexture();e.activeTexture(e.TEXTURE0);e.bindTexture(g,ft);u(a)?u(a.arrayBufferView)?(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),nt=a.arrayBufferView,tt?e.compressedTexImage2D(g,0,s,b,k,0,nt):(it&&(nt=h.flipY(nt,p,w,b,k)),e.texImage2D(g,0,s,b,k,0,p,w,nt))):u(a.framebuffer)?(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),a.framebuffer!==d.defaultFramebuffer&&a.framebuffer._bind(),e.copyTexImage2D(g,0,s,a.xOffset,a.yOffset,b,k,0),a.framebuffer!==d.defaultFramebuffer&&a.framebuffer._unBind()):(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,rt),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,it),e.texImage2D(g,0,s,p,w,a)):(e.texImage2D(g,0,s,b,k,0,p,w,null),ut=!1);e.bindTexture(g,null);et=tt?h.compressedTextureSizeInBytes(p,b,k):h.textureSizeInBytes(p,w,b,k);this._id=i();this._context=d;this._textureFilterAnisotropic=d._textureFilterAnisotropic;this._textureTarget=g;this._texture=ft;this._pixelFormat=p;this._pixelDatatype=w;this._width=b;this._height=k;this._dimensions=new n(b,k);this._hasMipmap=!1;this._sizeInBytes=et;this._preMultiplyAlpha=rt;this._flipY=it;this._initialized=ut;this._sampler=undefined;this.sampler=u(f.sampler)?f.sampler:new y}return b.fromFramebuffer=function(n){n=r(n,r.EMPTY_OBJECT);t.defined("options.context",n.context);var e=n.context,i=e._gl,f=r(n.pixelFormat,h.RGB),s=r(n.framebufferXOffset,0),c=r(n.framebufferYOffset,0),l=r(n.width,i.drawingBufferWidth),a=r(n.height,i.drawingBufferHeight),v=n.framebuffer;if(!h.validate(f))throw new o("Invalid pixelFormat.");if(h.isDepthFormat(f)||h.isCompressedFormat(f))throw new o("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");if(t.defined("options.context",n.context),t.typeOf.number.greaterThanOrEquals("framebufferXOffset",s,0),t.typeOf.number.greaterThanOrEquals("framebufferYOffset",c,0),s+l>i.drawingBufferWidth)throw new o("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(c+a>i.drawingBufferHeight)throw new o("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");return new b({context:e,width:l,height:a,pixelFormat:f,source:{framebuffer:u(v)?v:e.defaultFramebuffer,xOffset:s,yOffset:c,width:l,height:a}})},f(b.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(n){var r=n.minificationFilter,e=n.magnificationFilter,s=r===w.NEAREST_MIPMAP_NEAREST||r===w.NEAREST_MIPMAP_LINEAR||r===w.LINEAR_MIPMAP_NEAREST||r===w.LINEAR_MIPMAP_LINEAR,f=this._context,o=this._pixelDatatype,t,i;(o!==v.FLOAT||f.textureFloatLinear)&&(o!==v.HALF_FLOAT||f.textureHalfFloatLinear)||(r=s?w.NEAREST_MIPMAP_NEAREST:w.NEAREST,e=p.NEAREST);t=f._gl;i=this._textureTarget;t.activeTexture(t.TEXTURE0);t.bindTexture(i,this._texture);t.texParameteri(i,t.TEXTURE_MIN_FILTER,r);t.texParameteri(i,t.TEXTURE_MAG_FILTER,e);t.texParameteri(i,t.TEXTURE_WRAP_S,n.wrapS);t.texParameteri(i,t.TEXTURE_WRAP_T,n.wrapT);u(this._textureFilterAnisotropic)&&t.texParameteri(i,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.maximumAnisotropy);t.bindTexture(i,null);this._sampler=n}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(this._sizeInBytes*4/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}}),b.prototype.copyFrom=function(n,i,f){var e,c,g;if(i=r(i,0),f=r(f,0),t.defined("source",n),h.isDepthFormat(this._pixelFormat))throw new o("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(h.isCompressedFormat(this._pixelFormat))throw new o("Cannot call copyFrom with a compressed texture pixel format.");t.typeOf.number.greaterThanOrEquals("xOffset",i,0);t.typeOf.number.greaterThanOrEquals("yOffset",f,0);t.typeOf.number.lessThanOrEquals("xOffset + source.width",i+n.width,this._width);t.typeOf.number.lessThanOrEquals("yOffset + source.height",f+n.height,this._height);e=this._context._gl;c=this._textureTarget;e.activeTexture(e.TEXTURE0);e.bindTexture(c,this._texture);var w=n.width,b=n.height,l=n.arrayBufferView,v=this._width,y=this._height,s=this._pixelFormat,a=this._pixelDatatype,k=this._preMultiplyAlpha,p=this._flipY,d=!1;this._initialized||(i===0&&f===0&&w===v&&b===y?(u(l)?(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),p&&(l=h.flipY(l,s,a,v,y)),e.texImage2D(c,0,s,v,y,0,s,a,l)):(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,p),e.texImage2D(c,0,s,s,a,n)),d=!0):(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),g=h.createTypedArray(s,a,v,y),e.texImage2D(c,0,s,v,y,0,s,a,g)),this._initialized=!0);d||(l?(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),p&&(l=h.flipY(l,s,a,w,b)),e.texSubImage2D(c,0,i,f,w,b,s,a,l)):(e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,p),e.texSubImage2D(c,0,i,f,s,a,n)));e.bindTexture(c,null)},b.prototype.copyFromFramebuffer=function(n,i,u,f,e,s){if(n=r(n,0),i=r(i,0),u=r(u,0),f=r(f,0),e=r(e,this._width),s=r(s,this._height),h.isDepthFormat(this._pixelFormat))throw new o("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===v.FLOAT)throw new o("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===v.HALF_FLOAT)throw new o("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(h.isCompressedFormat(this._pixelFormat))throw new o("Cannot call copyFrom with a compressed texture pixel format.");t.typeOf.number.greaterThanOrEquals("xOffset",n,0);t.typeOf.number.greaterThanOrEquals("yOffset",i,0);t.typeOf.number.greaterThanOrEquals("framebufferXOffset",u,0);t.typeOf.number.greaterThanOrEquals("framebufferYOffset",f,0);t.typeOf.number.lessThanOrEquals("xOffset + width",n+e,this._width);t.typeOf.number.lessThanOrEquals("yOffset + height",i+s,this._height);var c=this._context._gl,l=this._textureTarget;c.activeTexture(c.TEXTURE0);c.bindTexture(l,this._texture);c.copyTexSubImage2D(l,0,n,i,u,f,e,s);c.bindTexture(l,null);this._initialized=!0},b.prototype.generateMipmap=function(n){if(n=r(n,a.DONT_CARE),h.isDepthFormat(this._pixelFormat))throw new o("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(h.isCompressedFormat(this._pixelFormat))throw new o("Cannot call generateMipmap with a compressed pixel format.");if(this._width>1&&!s.isPowerOfTwo(this._width))throw new o("width must be a power of two to call generateMipmap().");if(this._height>1&&!s.isPowerOfTwo(this._height))throw new o("height must be a power of two to call generateMipmap().");if(!a.validate(n))throw new o("hint is invalid.");this._hasMipmap=!0;var t=this._context._gl,i=this._textureTarget;t.hint(t.GENERATE_MIPMAP_HINT,n);t.activeTexture(t.TEXTURE0);t.bindTexture(i,this._texture);t.generateMipmap(i);t.bindTexture(i,null)},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return this._context._gl.deleteTexture(this._texture),e(this)},b});t("Shaders/Materials/BumpMapMaterial",[],function(){"use strict";return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nvec2 centerPixel = fract(repeat * st);\nfloat centerBump = texture2D(image, centerPixel).channel;\nfloat imageWidth = float(imageDimensions.x);\nvec2 rightPixel = fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\nfloat rightBump = texture2D(image, rightPixel).channel;\nfloat imageHeight = float(imageDimensions.y);\nvec2 leftPixel = fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\nfloat topBump = texture2D(image, leftPixel).channel;\nvec3 normalTangentSpace = normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nmaterial.diffuse = vec3(0.01);\nreturn material;\n}\n"});t("Shaders/Materials/CheckerboardMaterial",[],function(){"use strict";return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat b = mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);\nfloat scaledWidth = fract(repeat.s * st.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(repeat.t * st.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value = min(scaledWidth, scaledHeight);\nvec4 currentColor = mix(lightColor, darkColor, b);\nvec4 color = czm_antialias(lightColor, darkColor, currentColor, value, 0.03);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"});t("Shaders/Materials/DotMaterial",[],function(){"use strict";return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat b = smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));\nvec4 color = mix(lightColor, darkColor, b);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"});t("Shaders/Materials/ElevationContourMaterial",[],function(){"use strict";return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float spacing;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat distanceToContour = mod(materialInput.height, spacing);\n#ifdef GL_OES_standard_derivatives\nfloat dxc = abs(dFdx(materialInput.height));\nfloat dyc = abs(dFdy(materialInput.height));\nfloat dF = max(dxc, dyc) * width;\nmaterial.alpha = (distanceToContour < dF) ? 1.0 : 0.0;\n#else\nmaterial.alpha = (distanceToContour < (czm_resolutionScale * width)) ? 1.0 : 0.0;\n#endif\nmaterial.diffuse = color.rgb;\nreturn material;\n}\n"});t("Shaders/Materials/ElevationRampMaterial",[],function(){"use strict";return"uniform sampler2D image;\nuniform float minimumHeight;\nuniform float maximumHeight;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat scaledHeight = clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);\nvec4 rampColor = texture2D(image, vec2(scaledHeight, 0.5));\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"});t("Shaders/Materials/FadeMaterial",[],function(){"use strict";return"uniform vec4 fadeInColor;\nuniform vec4 fadeOutColor;\nuniform float maximumDistance;\nuniform bool repeat;\nuniform vec2 fadeDirection;\nuniform vec2 time;\nfloat getTime(float t, float coord)\n{\nfloat scalar = 1.0 / maximumDistance;\nfloat q  = distance(t, coord) * scalar;\nif (repeat)\n{\nfloat r = distance(t, coord + 1.0) * scalar;\nfloat s = distance(t, coord - 1.0) * scalar;\nq = min(min(r, s), q);\n}\nreturn clamp(q, 0.0, 1.0);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat s = getTime(time.x, st.s) * fadeDirection.s;\nfloat t = getTime(time.y, st.t) * fadeDirection.t;\nfloat u = length(vec2(s, t));\nvec4 color = mix(fadeInColor, fadeOutColor, u);\nmaterial.emission = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"});t("Shaders/Materials/GridMaterial",[],function(){"use strict";return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float cellAlpha;\nuniform vec2 lineCount;\nuniform vec2 lineThickness;\nuniform vec2 lineOffset;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat scaledWidth = fract(lineCount.s * st.s - lineOffset.s);\nscaledWidth = abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight = fract(lineCount.t * st.t - lineOffset.t);\nscaledHeight = abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value;\n#ifdef GL_OES_standard_derivatives\nconst float fuzz = 1.2;\nvec2 thickness = (lineThickness * czm_resolutionScale) - 1.0;\nvec2 dx = abs(dFdx(st));\nvec2 dy = abs(dFdy(st));\nvec2 dF = vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;\nvalue = min(\nsmoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),\nsmoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));\n#else\nconst float fuzz = 0.05;\nvec2 range = 0.5 - (lineThickness * 0.05);\nvalue = min(\n1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),\n1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));\n#endif\nfloat dRim = 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));\nfloat sRim = smoothstep(0.8, 1.0, dRim);\nvalue *= (1.0 - sRim);\nvec3 halfColor = color.rgb * 0.5;\nmaterial.diffuse = halfColor;\nmaterial.emission = halfColor;\nmaterial.alpha = color.a * (1.0 - ((1.0 - cellAlpha) * value));\nreturn material;\n}\n"});t("Shaders/Materials/NormalMapMaterial",[],function(){"use strict";return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 textureValue = texture2D(image, fract(repeat * materialInput.st));\nvec3 normalTangentSpace = textureValue.channels;\nnormalTangentSpace.xy = normalTangentSpace.xy * 2.0 - 1.0;\nnormalTangentSpace.z = clamp(1.0 - strength, 0.1, 1.0);\nnormalTangentSpace = normalize(normalTangentSpace);\nvec3 normalEC = materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal = normalEC;\nreturn material;\n}\n"});t("Shaders/Materials/PolylineArrowMaterial",[],function(){"use strict";return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nvarying float v_width;\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\nfloat slope = (p0.y - p1.y) / (p0.x - p1.x);\nreturn slope * (x - p0.x) + p0.y;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\n#ifdef GL_OES_standard_derivatives\nfloat base = 1.0 - abs(fwidth(st.s)) * 10.0;\n#else\nfloat base = 0.99;\n#endif\nvec2 center = vec2(1.0, 0.5);\nfloat ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\nfloat ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\nfloat halfWidth = 0.15;\nfloat s = step(0.5 - halfWidth, st.t);\ns *= 1.0 - step(0.5 + halfWidth, st.t);\ns *= 1.0 - step(base, st.s);\nfloat t = step(base, materialInput.st.s);\nt *= 1.0 - step(ptOnUpperLine, st.t);\nt *= step(ptOnLowerLine, st.t);\nfloat dist;\nif (st.s < base)\n{\nfloat d1 = abs(st.t - (0.5 - halfWidth));\nfloat d2 = abs(st.t - (0.5 + halfWidth));\ndist = min(d1, d2);\n}\nelse\n{\nfloat d1 = czm_infinity;\nif (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\n{\nd1 = abs(st.s - base);\n}\nfloat d2 = abs(st.t - ptOnUpperLine);\nfloat d3 = abs(st.t - ptOnLowerLine);\ndist = min(min(d1, d2), d3);\n}\nvec4 outsideColor = vec4(0.0);\nvec4 currentColor = mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\nvec4 outColor = czm_antialias(outsideColor, color, currentColor, dist);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"});t("Shaders/Materials/PolylineDashMaterial",[],function(){"use strict";return"uniform vec4 color;\nuniform vec4 gapColor;\nuniform float dashLength;\nuniform float dashPattern;\nvarying float v_polylineAngle;\nconst float maskLength = 16.0;\nmat2 rotate(float rad) {\nfloat c = cos(rad);\nfloat s = sin(rad);\nreturn mat2(\nc, s,\n-s, c\n);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\nfloat dashPosition = fract(pos.x / dashLength);\nfloat maskIndex = floor(dashPosition * maskLength);\nfloat maskTest = floor(dashPattern / pow(2.0, maskIndex));\nvec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\nif (fragColor.a < 0.005) {\ndiscard;\n}\nmaterial.emission = fragColor.rgb;\nmaterial.alpha = fragColor.a;\nreturn material;\n}\n"});t("Shaders/Materials/PolylineGlowMaterial",[],function(){"use strict";return"uniform vec4 color;\nuniform float glowPower;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat glow = glowPower / abs(st.t - 0.5) - (glowPower / 0.5);\nmaterial.emission = max(vec3(glow - 1.0 + color.rgb), color.rgb);\nmaterial.alpha = clamp(0.0, 1.0, glow) * color.a;\nreturn material;\n}\n"});t("Shaders/Materials/PolylineOutlineMaterial",[],function(){"use strict";return"uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec2 st = materialInput.st;\nfloat halfInteriorWidth =  0.5 * (v_width - outlineWidth) / v_width;\nfloat b = step(0.5 - halfInteriorWidth, st.t);\nb *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\nfloat d1 = abs(st.t - (0.5 - halfInteriorWidth));\nfloat d2 = abs(st.t - (0.5 + halfInteriorWidth));\nfloat dist = min(d1, d2);\nvec4 currentColor = mix(outlineColor, color, b);\nvec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\nmaterial.diffuse = outColor.rgb;\nmaterial.alpha = outColor.a;\nreturn material;\n}\n"});t("Shaders/Materials/RimLightingMaterial",[],function(){"use strict";return"uniform vec4 color;\nuniform vec4 rimColor;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat d = 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\nfloat s = smoothstep(1.0 - width, 1.0, d);\nmaterial.diffuse = color.rgb;\nmaterial.emission = rimColor.rgb * s;\nmaterial.alpha = mix(color.a, rimColor.a, s);\nreturn material;\n}\n"});t("Shaders/Materials/SlopeRampMaterial",[],function(){"use strict";return"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nvec4 rampColor = texture2D(image, vec2(materialInput.slope, 0.5));\nmaterial.diffuse = rampColor.rgb;\nmaterial.alpha = rampColor.a;\nreturn material;\n}\n"});t("Shaders/Materials/StripeMaterial",[],function(){"use strict";return"uniform vec4 evenColor;\nuniform vec4 oddColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat coord = mix(materialInput.st.s, materialInput.st.t, float(horizontal));\nfloat value = fract((coord - offset) * (repeat * 0.5));\nfloat dist = min(value, min(abs(value - 0.5), 1.0 - value));\nvec4 currentColor = mix(evenColor, oddColor, step(0.5, value));\nvec4 color = czm_antialias(evenColor, oddColor, currentColor, dist);\nmaterial.diffuse = color.rgb;\nmaterial.alpha = color.a;\nreturn material;\n}\n"});t("Shaders/Materials/Water",[],function(){"use strict";return"uniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material = czm_getDefaultMaterial(materialInput);\nfloat time = czm_frameNumber * animationSpeed;\nfloat fade = max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\nfloat specularMapValue = texture2D(specularMap, materialInput.st).r;\nvec4 noise = czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);\nvec3 normalTangentSpace = noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\nnormalTangentSpace.xy /= fade;\nnormalTangentSpace = mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\nnormalTangentSpace = normalize(normalTangentSpace);\nfloat tsPerturbationRatio = clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\nmaterial.alpha = specularMapValue;\nmaterial.diffuse = mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\nmaterial.diffuse += (0.1 * tsPerturbationRatio);\nmaterial.normal = normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\nmaterial.specular = specularIntensity;\nmaterial.shininess = 10.0;\nreturn material;\n}\n"});t("Scene/Material",["../Core/Cartesian2","../Core/clone","../Core/Color","../Core/combine","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/isArray","../Core/loadCRN","../Core/loadKTX","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","../Core/Resource","../Renderer/CubeMap","../Renderer/Texture","../Shaders/Materials/BumpMapMaterial","../Shaders/Materials/CheckerboardMaterial","../Shaders/Materials/DotMaterial","../Shaders/Materials/ElevationContourMaterial","../Shaders/Materials/ElevationRampMaterial","../Shaders/Materials/FadeMaterial","../Shaders/Materials/GridMaterial","../Shaders/Materials/NormalMapMaterial","../Shaders/Materials/PolylineArrowMaterial","../Shaders/Materials/PolylineDashMaterial","../Shaders/Materials/PolylineGlowMaterial","../Shaders/Materials/PolylineOutlineMaterial","../Shaders/Materials/RimLightingMaterial","../Shaders/Materials/SlopeRampMaterial","../Shaders/Materials/StripeMaterial","../Shaders/Materials/Water","../ThirdParty/when"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt){"use strict";function pt(n){this.type=undefined;this.shaderSource=undefined;this.materials=undefined;this.uniforms=undefined;this._uniforms=undefined;this.translucent=undefined;this._strict=undefined;this._template=undefined;this._count=undefined;this._texturePaths={};this._loadedImages=[];this._loadedCubeMaps=[];this._textures={};this._updateFunctions=[];this._defaultTexture=undefined;ii(n,this);o(this,{type:{value:this.type,writable:!1}});e(pt._uniformList[this.type])||(pt._uniformList[this.type]=Object.keys(this._uniforms))}function ii(n,i){var o,s,h,c,l;n=f(n,f.EMPTY_OBJECT);i._strict=f(n.strict,!1);i._count=f(n.count,0);i._template=t(f(n.fabric,f.EMPTY_OBJECT));i._template.uniforms=t(f(i._template.uniforms,f.EMPTY_OBJECT));i._template.materials=t(f(i._template.materials,f.EMPTY_OBJECT));i.type=e(i._template.type)?i._template.type:u();i.shaderSource="";i.materials={};i.uniforms={};i._uniforms={};i._translucentFunctions=[];s=pt._materialCache.getMaterial(i.type);e(s)&&(h=t(s.fabric,!0),i._template=r(i._template,h,!0),o=s.translucent);ui(i);e(s)||pt._materialCache.addMaterial(i.type,i);fi(i);ci(i);ai(i);c=i._translucentFunctions.length===0?!0:undefined;o=f(o,c);o=f(n.translucent,o);e(o)&&(typeof o=="function"?(l=function(){return o(i)},i._translucentFunctions.push(l)):i._translucentFunctions.push(o))}function bt(n,t,i,r){var u,f;if(e(n))for(u in n)n.hasOwnProperty(u)&&(f=t.indexOf(u)!==-1,(r&&!f||!r&&f)&&i(u,t))}function kt(n,t){for(var r,u="fabric: property name '"+n+"' is not valid. It should be ",i=0;i<t.length;i++)r="'"+t[i]+"'",u+=i===t.length-1?"or "+r+".":r+", ";throw new h(u);}function ri(n){var t="fabric: uniforms and materials cannot share the same property '"+n+"'";throw new h(t);}function ui(n){var t=n._template,o=t.uniforms,u=t.materials,f=t.components,i,r;if(e(f)&&e(t.source))throw new h("fabric: cannot have source and components in the same template.");bt(t,dt,kt,!0);bt(f,gt,kt,!0);i=[];for(r in u)u.hasOwnProperty(r)&&i.push(r);bt(o,i,ri,!1)}function fi(n){var t=n._template.components,r=n._template.source,i;if(e(r))n.shaderSource+=r+"\n";else{if(n.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n",n.shaderSource+="czm_material material = czm_getDefaultMaterial(materialInput);\n",e(t))for(i in t)t.hasOwnProperty(i)&&(n.shaderSource+="material."+i+" = "+t[i]+";\n");n.shaderSource+="return material;\n}\n"}}function si(n){var t;return function(i,r){var h=i.uniforms,u=h[n],b=t!==u,f,o,s,y,c,v,p;if(t=u,f=i._textures[n],u instanceof HTMLVideoElement){if(u.readyState>=2){if(b&&e(f)&&(f!==r.defaultTexture&&f.destroy(),f=undefined),!e(f)||f===r.defaultTexture){f=new k({context:r,source:u});i._textures[n]=f;return}f.copyFrom(u)}else e(f)||(i._textures[n]=r.defaultTexture);return}if(u instanceof k&&u!==f){i._texturePaths[n]=undefined;y=i._textures[n];y!==i._defaultTexture&&y.destroy();i._textures[n]=u;o=n+"Dimensions";h.hasOwnProperty(o)&&(s=h[o],s.x=u._width,s.y=u._height);return}(e(f)||(i._texturePaths[n]=undefined,e(i._defaultTexture)||(i._defaultTexture=r.defaultTexture),f=i._textures[n]=i._defaultTexture,o=n+"Dimensions",h.hasOwnProperty(o)&&(s=h[o],s.x=f._width,s.y=f._height)),u!==pt.DefaultImageId)&&(c=u instanceof w,e(i._texturePaths[n])&&(!c||u.url===i._texturePaths[n].url)&&(c||u===i._texturePaths[n])||(typeof u=="string"||c?(v=c?u:w.createIfNeeded(u),p=ei.test(u)?a(v):oi.test(u)?l(v):v.fetchImage(),yt(p,function(t){i._loadedImages.push({id:n,image:t})})):(u instanceof HTMLCanvasElement||u instanceof HTMLImageElement)&&i._loadedImages.push({id:n,image:u}),i._texturePaths[n]=u))}}function hi(n){return function(t,i){var r=t.uniforms[n],u,f,o;if(r instanceof b){u=t._textures[n];u!==t._defaultTexture&&u.destroy();t._texturePaths[n]=undefined;t._textures[n]=r;return}(e(t._textures[n])||(t._texturePaths[n]=undefined,t._textures[n]=i.defaultCubeMap),r!==pt.DefaultCubeMapId)&&(f=r.positiveX+r.negativeX+r.positiveY+r.negativeY+r.positiveZ+r.negativeZ,f!==t._texturePaths[n]&&(o=[w.createIfNeeded(r.positiveX).fetchImage(),w.createIfNeeded(r.negativeX).fetchImage(),w.createIfNeeded(r.positiveY).fetchImage(),w.createIfNeeded(r.negativeY).fetchImage(),w.createIfNeeded(r.positiveZ).fetchImage(),w.createIfNeeded(r.negativeZ).fetchImage()],yt.all(o).then(function(i){t._loadedCubeMaps.push({id:n,images:i})}),t._texturePaths[n]=f))}}function ci(n){var t=n._template.uniforms;for(var i in t)t.hasOwnProperty(i)&&ti(n,i)}function ti(n,t){var s=n._strict,c=n._template.uniforms,o=c[t],i=li(o),u,f,l,a,r,v;if(!e(i))throw new h("fabric: uniform '"+t+"' has invalid type.");if(i==="channels"){if(u=wt(n,t,o,!1),u===0&&s)throw new h("strict: shader source does not use channels '"+t+"'.");}else{if(i==="sampler2D"&&(f=t+"Dimensions",vi(n,f)>0&&(c[f]={type:"ivec3",x:1,y:1},ti(n,f))),l=new RegExp("uniform\\s+"+i+"\\s+"+t+"\\s*;"),l.test(n.shaderSource)||(a="uniform "+i+" "+t+";",n.shaderSource=a+n.shaderSource),r=t+"_"+n._count++,u=wt(n,t,r),u===1&&s)throw new h("strict: shader source does not use uniform '"+t+"'.");n.uniforms[t]=o;i==="sampler2D"?(n._uniforms[r]=function(){return n._textures[t]},n._updateFunctions.push(si(t))):i==="samplerCube"?(n._uniforms[r]=function(){return n._textures[t]},n._updateFunctions.push(hi(t))):i.indexOf("mat")!==-1?(v=new ni[i],n._uniforms[r]=function(){return ni[i].fromColumnMajorArray(n.uniforms[t],v)}):n._uniforms[r]=function(){return n.uniforms[t]}}}function li(n){var t=n.type,r,i,u;if(!e(t))if(r=typeof n,r==="number")t="float";else if(r==="boolean")t="bool";else if(r==="string"||n instanceof w||n instanceof HTMLCanvasElement||n instanceof HTMLImageElement)t=/^([rgba]){1,4}$/i.test(n)?"channels":n===pt.DefaultCubeMapId?"samplerCube":"sampler2D";else if(r==="object")if(c(n))(n.length===4||n.length===9||n.length===16)&&(t="mat"+Math.sqrt(n.length));else{i=0;for(u in n)n.hasOwnProperty(u)&&(i+=1);i>=2&&i<=4?t="vec"+i:i===6&&(t="samplerCube")}return t}function ai(n){var o=n._strict,u=n._template.materials,i,t,f,e,s,c;for(i in u)if(u.hasOwnProperty(i)&&(t=new pt({strict:o,fabric:u[i],count:n._count}),n._count=t._count,n._uniforms=r(n._uniforms,t._uniforms,!0),n.materials[i]=t,n._translucentFunctions=n._translucentFunctions.concat(t._translucentFunctions),f="czm_getMaterial",e=f+"_"+n._count++,wt(t,f,e),n.shaderSource=t.shaderSource+n.shaderSource,s=e+"(materialInput)",c=wt(n,i,s),c===0&&o))throw new h("strict: shader source does not use material '"+i+"'.");}function wt(n,t,i,r){r=f(r,!0);var u=0,e="([\\w"+(r?".":"")+"])?",o=new RegExp(e+t+"([\\w])?","g");return n.shaderSource=n.shaderSource.replace(o,function(n,t,r){return t||r?n:(u+=1,i)}),u}function vi(n,t,i){return wt(n,t,t,i)}var dt,gt;pt._uniformList={};pt.fromType=function(n,t){var r,i;if(!e(pt._materialCache.getMaterial(n)))throw new h("material with type '"+n+"' does not exist.");if(r=new pt({fabric:{type:n}}),e(t))for(i in t)t.hasOwnProperty(i)&&(r.uniforms[i]=t[i]);return r};pt.prototype.isTranslucent=function(){var t,i;if(e(this.translucent))return typeof this.translucent=="function"?this.translucent():this.translucent;var n=!0,r=this._translucentFunctions,u=r.length;for(t=0;t<u;++t)if(i=r[t],n=typeof i=="function"?n&&i():n&&i,!n)break;return n};pt.prototype.update=function(n){for(var u,c=this._loadedImages,f=c.length,l,i,o,a,v,s,y,r,d,p,h,w,t=0;t<f;++t)l=c[t],u=l.id,i=l.image,o=e(i.internalFormat)?new k({context:n,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView}}):new k({context:n,source:i}),this._textures[u]=o,a=u+"Dimensions",this.uniforms.hasOwnProperty(a)&&(v=this.uniforms[a],v.x=o._width,v.y=o._height);for(c.length=0,s=this._loadedCubeMaps,f=s.length,t=0;t<f;++t)y=s[t],u=y.id,r=y.images,d=new b({context:n,source:{positiveX:r[0],negativeX:r[1],positiveY:r[2],negativeY:r[3],positiveZ:r[4],negativeZ:r[5]}}),this._textures[u]=d;for(s.length=0,p=this._updateFunctions,f=p.length,t=0;t<f;++t)p[t](this,n);h=this.materials;for(w in h)h.hasOwnProperty(w)&&h[w].update(n)};pt.prototype.isDestroyed=function(){return!1};pt.prototype.destroy=function(){var t=this._textures,i,r,n,u;for(i in t)t.hasOwnProperty(i)&&(r=t[i],r!==this._defaultTexture&&r.destroy());n=this.materials;for(u in n)n.hasOwnProperty(u)&&n[u].destroy();return s(this)};dt=["type","materials","uniforms","components","source"];gt=["diffuse","specular","shininess","normal","emission","alpha"];var ni={mat2:v,mat3:y,mat4:p},ei=/\.ktx$/i,oi=/\.crn$/i;return pt._materialCache={_materials:{},addMaterial:function(n,t){this._materials[n]=t},getMaterial:function(n){return this._materials[n]}},pt.DefaultImageId="czm_defaultImage",pt.DefaultCubeMapId="czm_defaultCubeMap",pt.ColorType="Color",pt._materialCache.addMaterial(pt.ColorType,{fabric:{type:pt.ColorType,uniforms:{color:new i(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(n){return n.uniforms.color.alpha<1}}),pt.ImageType="Image",pt._materialCache.addMaterial(pt.ImageType,{fabric:{type:pt.ImageType,uniforms:{image:pt.DefaultImageId,repeat:new n(1,1),color:new i(1,1,1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(n){return n.uniforms.color.alpha<1}}),pt.DiffuseMapType="DiffuseMap",pt._materialCache.addMaterial(pt.DiffuseMapType,{fabric:{type:pt.DiffuseMapType,uniforms:{image:pt.DefaultImageId,channels:"rgb",repeat:new n(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),pt.AlphaMapType="AlphaMap",pt._materialCache.addMaterial(pt.AlphaMapType,{fabric:{type:pt.AlphaMapType,uniforms:{image:pt.DefaultImageId,channel:"a",repeat:new n(1,1)},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!0}),pt.SpecularMapType="SpecularMap",pt._materialCache.addMaterial(pt.SpecularMapType,{fabric:{type:pt.SpecularMapType,uniforms:{image:pt.DefaultImageId,channel:"r",repeat:new n(1,1)},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!1}),pt.EmissionMapType="EmissionMap",pt._materialCache.addMaterial(pt.EmissionMapType,{fabric:{type:pt.EmissionMapType,uniforms:{image:pt.DefaultImageId,channels:"rgb",repeat:new n(1,1)},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1}),pt.BumpMapType="BumpMap",pt._materialCache.addMaterial(pt.BumpMapType,{fabric:{type:pt.BumpMapType,uniforms:{image:pt.DefaultImageId,channel:"r",strength:.8,repeat:new n(1,1)},source:d},translucent:!1}),pt.NormalMapType="NormalMap",pt._materialCache.addMaterial(pt.NormalMapType,{fabric:{type:pt.NormalMapType,uniforms:{image:pt.DefaultImageId,channels:"rgb",strength:.8,repeat:new n(1,1)},source:ft},translucent:!1}),pt.GridType="Grid",pt._materialCache.addMaterial(pt.GridType,{fabric:{type:pt.GridType,uniforms:{color:new i(0,1,0,1),cellAlpha:.1,lineCount:new n(8,8),lineThickness:new n(1,1),lineOffset:new n(0,0)},source:ut},translucent:function(n){var t=n.uniforms;return t.color.alpha<1||t.cellAlpha<1}}),pt.StripeType="Stripe",pt._materialCache.addMaterial(pt.StripeType,{fabric:{type:pt.StripeType,uniforms:{horizontal:!0,evenColor:new i(1,1,1,.5),oddColor:new i(0,0,1,.5),offset:0,repeat:5},source:at},translucent:function(n){var t=n.uniforms;return t.evenColor.alpha<1||t.oddColor.alpha<1}}),pt.CheckerboardType="Checkerboard",pt._materialCache.addMaterial(pt.CheckerboardType,{fabric:{type:pt.CheckerboardType,uniforms:{lightColor:new i(1,1,1,.5),darkColor:new i(0,0,0,.5),repeat:new n(5,5)},source:g},translucent:function(n){var t=n.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),pt.DotType="Dot",pt._materialCache.addMaterial(pt.DotType,{fabric:{type:pt.DotType,uniforms:{lightColor:new i(1,1,0,.75),darkColor:new i(0,1,1,.75),repeat:new n(5,5)},source:nt},translucent:function(n){var t=n.uniforms;return t.lightColor.alpha<1||t.darkColor.alpha<1}}),pt.WaterType="Water",pt._materialCache.addMaterial(pt.WaterType,{fabric:{type:pt.WaterType,uniforms:{baseWaterColor:new i(.2,.3,.6,1),blendColor:new i(0,1,.699,1),specularMap:pt.DefaultImageId,normalMap:pt.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:vt},translucent:function(n){var t=n.uniforms;return t.baseWaterColor.alpha<1||t.blendColor.alpha<1}}),pt.RimLightingType="RimLighting",pt._materialCache.addMaterial(pt.RimLightingType,{fabric:{type:pt.RimLightingType,uniforms:{color:new i(1,0,0,.7),rimColor:new i(1,1,1,.4),width:.3},source:ct},translucent:function(n){var t=n.uniforms;return t.color.alpha<1||t.rimColor.alpha<1}}),pt.FadeType="Fade",pt._materialCache.addMaterial(pt.FadeType,{fabric:{type:pt.FadeType,uniforms:{fadeInColor:new i(1,0,0,1),fadeOutColor:new i(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new n(.5,.5)},source:rt},translucent:function(n){var t=n.uniforms;return t.fadeInColor.alpha<1||t.fadeOutColor.alpha<1}}),pt.PolylineArrowType="PolylineArrow",pt._materialCache.addMaterial(pt.PolylineArrowType,{fabric:{type:pt.PolylineArrowType,uniforms:{color:new i(1,1,1,1)},source:et},translucent:!0}),pt.PolylineDashType="PolylineDash",pt._materialCache.addMaterial(pt.PolylineDashType,{fabric:{type:pt.PolylineDashType,uniforms:{color:new i(1,0,1,1),gapColor:new i(0,0,0,0),dashLength:16,dashPattern:255},source:ot},translucent:!0}),pt.PolylineGlowType="PolylineGlow",pt._materialCache.addMaterial(pt.PolylineGlowType,{fabric:{type:pt.PolylineGlowType,uniforms:{color:new i(0,.5,1,1),glowPower:.25},source:st},translucent:!0}),pt.PolylineOutlineType="PolylineOutline",pt._materialCache.addMaterial(pt.PolylineOutlineType,{fabric:{type:pt.PolylineOutlineType,uniforms:{color:new i(1,1,1,1),outlineColor:new i(1,0,0,1),outlineWidth:1},source:ht},translucent:function(n){var t=n.uniforms;return t.color.alpha<1||t.outlineColor.alpha<1}}),pt.ElevationContourType="ElevationContour",pt._materialCache.addMaterial(pt.ElevationContourType,{fabric:{type:pt.ElevationContourType,uniforms:{spacing:100,color:new i(1,0,0,1),width:1},source:tt},translucent:!1}),pt.ElevationRampType="ElevationRamp",pt._materialCache.addMaterial(pt.ElevationRampType,{fabric:{type:pt.ElevationRampType,uniforms:{image:pt.DefaultImageId,minimumHeight:0,maximumHeight:1e4},source:it},translucent:!1}),pt.SlopeRampMaterialType="SlopeRamp",pt._materialCache.addMaterial(pt.SlopeRampMaterialType,{fabric:{type:pt.SlopeRampMaterialType,uniforms:{image:pt.DefaultImageId},source:lt},translucent:!1}),pt});t("Scene/MaterialAppearance",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/freezeObject","../Core/VertexFormat","../Shaders/Appearances/AllMaterialAppearanceFS","../Shaders/Appearances/AllMaterialAppearanceVS","../Shaders/Appearances/BasicMaterialAppearanceFS","../Shaders/Appearances/BasicMaterialAppearanceVS","../Shaders/Appearances/TexturedMaterialAppearanceFS","../Shaders/Appearances/TexturedMaterialAppearanceVS","./Appearance","./Material"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(i){i=n(i,n.EMPTY_OBJECT);var f=n(i.translucent,!0),u=n(i.closed,!1),r=n(i.materialSupport,v.MaterialSupport.TEXTURED);this.material=t(i.material)?i.material:a.fromType(a.ColorType);this.translucent=f;this._vertexShaderSource=n(i.vertexShaderSource,r.vertexShaderSource);this._fragmentShaderSource=n(i.fragmentShaderSource,r.fragmentShaderSource);this._renderState=l.getDefaultRenderState(f,u,i.renderState);this._closed=u;this._materialSupport=r;this._vertexFormat=r.vertexFormat;this._flat=n(i.flat,!1);this._faceForward=n(i.faceForward,!u)}return i(v.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),v.prototype.getFragmentShaderSource=l.prototype.getFragmentShaderSource,v.prototype.isTranslucent=l.prototype.isTranslucent,v.prototype.getRenderState=l.prototype.getRenderState,v.MaterialSupport={BASIC:r({vertexFormat:u.POSITION_AND_NORMAL,vertexShaderSource:s,fragmentShaderSource:o}),TEXTURED:r({vertexFormat:u.POSITION_NORMAL_AND_ST,vertexShaderSource:c,fragmentShaderSource:h}),ALL:r({vertexFormat:u.ALL,vertexShaderSource:e,fragmentShaderSource:f})},v});t("Shaders/Appearances/PerInstanceColorAppearanceFS",[],function(){"use strict";return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec3 positionToEyeEC = -v_positionEC;\nvec3 normalEC = normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getDefaultMaterial(materialInput);\nmaterial.diffuse = v_color.rgb;\nmaterial.alpha = v_color.a;\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n}\n"});t("Shaders/Appearances/PerInstanceColorAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC = czm_normal * normal;\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"});t("Shaders/Appearances/PerInstanceFlatColorAppearanceFS",[],function(){"use strict";return"varying vec4 v_color;\nvoid main()\n{\ngl_FragColor = v_color;\n}\n"});t("Shaders/Appearances/PerInstanceFlatColorAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_color = color;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"});t("Scene/PerInstanceColorAppearance",["../Core/defaultValue","../Core/defineProperties","../Core/VertexFormat","../Shaders/Appearances/PerInstanceColorAppearanceFS","../Shaders/Appearances/PerInstanceColorAppearanceVS","../Shaders/Appearances/PerInstanceFlatColorAppearanceFS","../Shaders/Appearances/PerInstanceFlatColorAppearanceVS","./Appearance"],function(n,t,i,r,u,f,e,o){"use strict";function s(t){t=n(t,n.EMPTY_OBJECT);var c=n(t.translucent,!0),h=n(t.closed,!1),i=n(t.flat,!1),l=i?e:u,a=i?f:r,v=i?s.FLAT_VERTEX_FORMAT:s.VERTEX_FORMAT;this.material=undefined;this.translucent=c;this._vertexShaderSource=n(t.vertexShaderSource,l);this._fragmentShaderSource=n(t.fragmentShaderSource,a);this._renderState=o.getDefaultRenderState(c,h,t.renderState);this._closed=h;this._vertexFormat=v;this._flat=i;this._faceForward=n(t.faceForward,!h)}return t(s.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}}),s.VERTEX_FORMAT=i.POSITION_AND_NORMAL,s.FLAT_VERTEX_FORMAT=i.POSITION_ONLY,s.prototype.getFragmentShaderSource=o.prototype.getFragmentShaderSource,s.prototype.isTranslucent=o.prototype.isTranslucent,s.prototype.getRenderState=o.prototype.getRenderState,s});t("DataSources/CallbackProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event"],function(n,t,i,r){"use strict";function u(n,t){this._callback=undefined;this._isConstant=undefined;this._definitionChanged=new r;this.setCallback(n,t)}return t(u.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}}),u.prototype.getValue=function(n,t){return this._callback(n,t)},u.prototype.setCallback=function(t,r){if(!n(t))throw new i("callback is required.");if(!n(r))throw new i("isConstant is required.");var u=this._callback!==t||this._isConstant!==r;this._callback=t;this._isConstant=r;u&&this._definitionChanged.raiseEvent(this)},u.prototype.equals=function(n){return this===n||n instanceof u&&this._callback===n._callback&&this._isConstant===n._isConstant},u});t("Scene/ClassificationType",["../Core/freezeObject"],function(n){"use strict";return n({TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2,NUMBER_OF_CLASSIFICATION_TYPES:3})});t("Scene/ShadowMode",["../Core/freezeObject"],function(n){"use strict";var t={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4};return t.castShadows=function(n){return n===t.ENABLED||n===t.CAST_ONLY},t.receiveShadows=function(n){return n===t.ENABLED||n===t.RECEIVE_ONLY},t.fromCastReceive=function(n,i){return n&&i?t.ENABLED:n?t.CAST_ONLY:i?t.RECEIVE_ONLY:t.DISABLED},n(t)});t("DataSources/ColorMaterialProperty",["../Core/Color","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f){"use strict";function e(n){this._definitionChanged=new r;this._color=undefined;this._colorSubscription=undefined;this.color=n}return i(e.prototype,{isConstant:{get:function(){return f.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:u("color")}),e.prototype.getType=function(){return"Color"},e.prototype.getValue=function(i,r){return t(r)||(r={}),r.color=f.getValueOrClonedDefault(this._color,i,n.WHITE,r.color),r},e.prototype.equals=function(n){return this===n||n instanceof e&&f.equals(this._color,n._color)},e});t("Renderer/DrawCommand",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/PrimitiveType"],function(n,t,i,r){"use strict";function u(t){t=n(t,n.EMPTY_OBJECT);this._boundingVolume=t.boundingVolume;this._orientedBoundingBox=t.orientedBoundingBox;this._cull=n(t.cull,!0);this._modelMatrix=t.modelMatrix;this._primitiveType=n(t.primitiveType,r.TRIANGLES);this._vertexArray=t.vertexArray;this._count=t.count;this._offset=n(t.offset,0);this._instanceCount=n(t.instanceCount,0);this._shaderProgram=t.shaderProgram;this._uniformMap=t.uniformMap;this._renderState=t.renderState;this._framebuffer=t.framebuffer;this._pass=t.pass;this._executeInClosestFrustum=n(t.executeInClosestFrustum,!1);this._owner=t.owner;this._debugShowBoundingVolume=n(t.debugShowBoundingVolume,!1);this._debugOverlappingFrustums=0;this._castShadows=n(t.castShadows,!1);this._receiveShadows=n(t.receiveShadows,!1);this._pickId=t.pickId;this._pickOnly=n(t.pickOnly,!1);this.dirty=!0;this.lastDirtyTime=0;this.derivedCommands={}}return i(u.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(n){this._boundingVolume!==n&&(this._boundingVolume=n,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(n){this._orientedBoundingBox!==n&&(this._orientedBoundingBox=n,this.dirty=!0)}},cull:{get:function(){return this._cull},set:function(n){this._cull!==n&&(this._cull=n,this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(n){this._modelMatrix!==n&&(this._modelMatrix=n,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(n){this._primitiveType!==n&&(this._primitiveType=n,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(n){this._vertexArray!==n&&(this._vertexArray=n,this.dirty=!0)}},count:{get:function(){return this._count},set:function(n){this._count!==n&&(this._count=n,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(n){this._offset!==n&&(this._offset=n,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(n){this._instanceCount!==n&&(this._instanceCount=n,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(n){this._shaderProgram!==n&&(this._shaderProgram=n,this.dirty=!0)}},castShadows:{get:function(){return this._castShadows},set:function(n){this._castShadows!==n&&(this._castShadows=n,this.dirty=!0)}},receiveShadows:{get:function(){return this._receiveShadows},set:function(n){this._receiveShadows!==n&&(this._receiveShadows=n,this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(n){this._uniformMap!==n&&(this._uniformMap=n,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(n){this._renderState!==n&&(this._renderState=n,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(n){this._framebuffer!==n&&(this._framebuffer=n,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(n){this._pass!==n&&(this._pass=n,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return this._executeInClosestFrustum},set:function(n){this._executeInClosestFrustum!==n&&(this._executeInClosestFrustum=n,this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(n){this._owner!==n&&(this._owner=n,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(n){this._debugShowBoundingVolume!==n&&(this._debugShowBoundingVolume=n,this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(n){this._debugOverlappingFrustums!==n&&(this._debugOverlappingFrustums=n,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(n){this._pickId!==n&&(this._pickId=n,this.dirty=!0)}},pickOnly:{get:function(){return this._pickOnly}}}),u.shallowClone=function(n,i){return t(n)?(t(i)||(i=new u),i._boundingVolume=n._boundingVolume,i._orientedBoundingBox=n._orientedBoundingBox,i._cull=n._cull,i._modelMatrix=n._modelMatrix,i._primitiveType=n._primitiveType,i._vertexArray=n._vertexArray,i._count=n._count,i._offset=n._offset,i._instanceCount=n._instanceCount,i._shaderProgram=n._shaderProgram,i._uniformMap=n._uniformMap,i._renderState=n._renderState,i._framebuffer=n._framebuffer,i._pass=n._pass,i._executeInClosestFrustum=n._executeInClosestFrustum,i._owner=n._owner,i._debugShowBoundingVolume=n._debugShowBoundingVolume,i._debugOverlappingFrustums=n._debugOverlappingFrustums,i._castShadows=n._castShadows,i._receiveShadows=n._receiveShadows,i._pickId=n._pickId,i._pickOnly=n._pickOnly,i.dirty=!0,i.lastDirtyTime=0,i):undefined},u.prototype.execute=function(n,t){n.draw(this,t)},u});t("Renderer/Pass",["../Core/freezeObject"],function(n){"use strict";return n({ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,CLASSIFICATION:7,OPAQUE:8,TRANSLUCENT:9,OVERLAY:10,NUMBER_OF_PASSES:11})});t("Renderer/freezeRenderState",["../Core/freezeObject"],function(n){"use strict";function t(i){var r,f,u;if(typeof i!="object"||i===null)return i;for(f=Object.keys(i),u=0;u<f.length;u++)r=f[u],i.hasOwnProperty(r)&&r!=="_applyFunctions"&&(i[r]=t(i[r]));return n(i)}return t});t("Renderer/RenderState",["../Core/BoundingRectangle","../Core/Color","../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/WebGLConstants","../Core/WindingOrder","./ContextLimits","./freezeRenderState"],function(n,t,i,r,u,f,e,o,s){"use strict";function y(n){return n===f.FUNC_ADD||n===f.FUNC_SUBTRACT||n===f.FUNC_REVERSE_SUBTRACT||n===f.MIN||n===f.MAX}function v(n){return n===f.ZERO||n===f.ONE||n===f.SRC_COLOR||n===f.ONE_MINUS_SRC_COLOR||n===f.DST_COLOR||n===f.ONE_MINUS_DST_COLOR||n===f.SRC_ALPHA||n===f.ONE_MINUS_SRC_ALPHA||n===f.DST_ALPHA||n===f.ONE_MINUS_DST_ALPHA||n===f.CONSTANT_COLOR||n===f.ONE_MINUS_CONSTANT_COLOR||n===f.CONSTANT_ALPHA||n===f.ONE_MINUS_CONSTANT_ALPHA||n===f.SRC_ALPHA_SATURATE}function ct(n){return n===f.FRONT||n===f.BACK||n===f.FRONT_AND_BACK}function lt(n){return n===f.NEVER||n===f.LESS||n===f.EQUAL||n===f.LEQUAL||n===f.GREATER||n===f.NOTEQUAL||n===f.GEQUAL||n===f.ALWAYS}function p(n){return n===f.NEVER||n===f.LESS||n===f.EQUAL||n===f.LEQUAL||n===f.GREATER||n===f.NOTEQUAL||n===f.GEQUAL||n===f.ALWAYS}function a(n){return n===f.ZERO||n===f.KEEP||n===f.REPLACE||n===f.INCR||n===f.DECR||n===f.INVERT||n===f.INCR_WRAP||n===f.DECR_WRAP}function h(s){var h=i(s,{}),it=i(h.cull,{}),d=i(h.polygonOffset,{}),rt=i(h.scissorTest,{}),et=i(rt.rectangle,{}),ut=i(h.depthRange,{}),ft=i(h.depthTest,{}),b=i(h.colorMask,{}),c=i(h.blending,{}),k=i(c.color,{}),l=i(h.stencilTest,{}),g=i(l.frontOperation,{}),nt=i(l.backOperation,{}),tt=i(h.sampleCoverage,{}),w=h.viewport;if(this.frontFace=i(h.frontFace,e.COUNTER_CLOCKWISE),this.cull={enabled:i(it.enabled,!1),face:i(it.face,f.BACK)},this.lineWidth=i(h.lineWidth,1),this.polygonOffset={enabled:i(d.enabled,!1),factor:i(d.factor,0),units:i(d.units,0)},this.scissorTest={enabled:i(rt.enabled,!1),rectangle:n.clone(et)},this.depthRange={near:i(ut.near,0),far:i(ut.far,1)},this.depthTest={enabled:i(ft.enabled,!1),func:i(ft.func,f.LESS)},this.colorMask={red:i(b.red,!0),green:i(b.green,!0),blue:i(b.blue,!0),alpha:i(b.alpha,!0)},this.depthMask=i(h.depthMask,!0),this.stencilMask=i(h.stencilMask,-1),this.blending={enabled:i(c.enabled,!1),color:new t(i(k.red,0),i(k.green,0),i(k.blue,0),i(k.alpha,0)),equationRgb:i(c.equationRgb,f.FUNC_ADD),equationAlpha:i(c.equationAlpha,f.FUNC_ADD),functionSourceRgb:i(c.functionSourceRgb,f.ONE),functionSourceAlpha:i(c.functionSourceAlpha,f.ONE),functionDestinationRgb:i(c.functionDestinationRgb,f.ZERO),functionDestinationAlpha:i(c.functionDestinationAlpha,f.ZERO)},this.stencilTest={enabled:i(l.enabled,!1),frontFunction:i(l.frontFunction,f.ALWAYS),backFunction:i(l.backFunction,f.ALWAYS),reference:i(l.reference,0),mask:i(l.mask,-1),frontOperation:{fail:i(g.fail,f.KEEP),zFail:i(g.zFail,f.KEEP),zPass:i(g.zPass,f.KEEP)},backOperation:{fail:i(nt.fail,f.KEEP),zFail:i(nt.zFail,f.KEEP),zPass:i(nt.zPass,f.KEEP)}},this.sampleCoverage={enabled:i(tt.enabled,!1),value:i(tt.value,1),invert:i(tt.invert,!1)},this.viewport=r(w)?new n(w.x,w.y,w.width,w.height):undefined,this.lineWidth<o.minimumAliasedLineWidth||this.lineWidth>o.maximumAliasedLineWidth)throw new u("renderState.lineWidth is out of range.  Check minimumAliasedLineWidth and maximumAliasedLineWidth.");if(!e.validate(this.frontFace))throw new u("Invalid renderState.frontFace.");if(!ct(this.cull.face))throw new u("Invalid renderState.cull.face.");if(this.scissorTest.rectangle.width<0||this.scissorTest.rectangle.height<0)throw new u("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new u("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(this.depthRange.near<0)throw new u("renderState.depthRange.near must be greater than or equal to zero.");if(this.depthRange.far>1)throw new u("renderState.depthRange.far must be less than or equal to one.");if(!lt(this.depthTest.func))throw new u("Invalid renderState.depthTest.func.");if(this.blending.color.red<0||this.blending.color.red>1||this.blending.color.green<0||this.blending.color.green>1||this.blending.color.blue<0||this.blending.color.blue>1||this.blending.color.alpha<0||this.blending.color.alpha>1)throw new u("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!y(this.blending.equationRgb))throw new u("Invalid renderState.blending.equationRgb.");if(!y(this.blending.equationAlpha))throw new u("Invalid renderState.blending.equationAlpha.");if(!v(this.blending.functionSourceRgb))throw new u("Invalid renderState.blending.functionSourceRgb.");if(!v(this.blending.functionSourceAlpha))throw new u("Invalid renderState.blending.functionSourceAlpha.");if(!v(this.blending.functionDestinationRgb))throw new u("Invalid renderState.blending.functionDestinationRgb.");if(!v(this.blending.functionDestinationAlpha))throw new u("Invalid renderState.blending.functionDestinationAlpha.");if(!p(this.stencilTest.frontFunction))throw new u("Invalid renderState.stencilTest.frontFunction.");if(!p(this.stencilTest.backFunction))throw new u("Invalid renderState.stencilTest.backFunction.");if(!a(this.stencilTest.frontOperation.fail))throw new u("Invalid renderState.stencilTest.frontOperation.fail.");if(!a(this.stencilTest.frontOperation.zFail))throw new u("Invalid renderState.stencilTest.frontOperation.zFail.");if(!a(this.stencilTest.frontOperation.zPass))throw new u("Invalid renderState.stencilTest.frontOperation.zPass.");if(!a(this.stencilTest.backOperation.fail))throw new u("Invalid renderState.stencilTest.backOperation.fail.");if(!a(this.stencilTest.backOperation.zFail))throw new u("Invalid renderState.stencilTest.backOperation.zFail.");if(!a(this.stencilTest.backOperation.zPass))throw new u("Invalid renderState.stencilTest.backOperation.zPass.");if(r(this.viewport)){if(this.viewport.width<0)throw new u("renderState.viewport.width must be greater than or equal to zero.");if(this.viewport.height<0)throw new u("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.width>o.maximumViewportWidth)throw new u("renderState.viewport.width must be less than or equal to the maximum viewport width ("+o.maximumViewportWidth.toString()+").  Check maximumViewportWidth.");if(this.viewport.height>o.maximumViewportHeight)throw new u("renderState.viewport.height must be less than or equal to the maximum viewport height ("+o.maximumViewportHeight.toString()+").  Check maximumViewportHeight.");}this.id=0;this._applyFunctions=[]}function l(n,t,i){i?n.enable(t):n.disable(t)}function w(n,t){n.frontFace(t.frontFace)}function b(n,t){var i=t.cull,r=i.enabled;l(n,n.CULL_FACE,r);r&&n.cullFace(i.face)}function k(n,t){n.lineWidth(t.lineWidth)}function d(n,t){var i=t.polygonOffset,r=i.enabled;l(n,n.POLYGON_OFFSET_FILL,r);r&&n.polygonOffset(i.factor,i.units)}function g(n,t,i){var f=t.scissorTest,e=r(i.scissorTest)?i.scissorTest.enabled:f.enabled,u;l(n,n.SCISSOR_TEST,e);e&&(u=r(i.scissorTest)?i.scissorTest.rectangle:f.rectangle,n.scissor(u.x,u.y,u.width,u.height))}function nt(n,t){var i=t.depthRange;n.depthRange(i.near,i.far)}function tt(n,t){var i=t.depthTest,r=i.enabled;l(n,n.DEPTH_TEST,r);r&&n.depthFunc(i.func)}function it(n,t){var i=t.colorMask;n.colorMask(i.red,i.green,i.blue,i.alpha)}function rt(n,t){n.depthMask(t.depthMask)}function ut(n,t){n.stencilMask(t.stencilMask)}function vt(n,t){n.blendColor(t.red,t.green,t.blue,t.alpha)}function ft(n,t,i){var u=t.blending,f=r(i.blendingEnabled)?i.blendingEnabled:u.enabled;l(n,n.BLEND,f);f&&(vt(n,u.color),n.blendEquationSeparate(u.equationRgb,u.equationAlpha),n.blendFuncSeparate(u.functionSourceRgb,u.functionDestinationRgb,u.functionSourceAlpha,u.functionDestinationAlpha))}function et(n,t){var i=t.stencilTest,o=i.enabled;if(l(n,n.STENCIL_TEST,o),o){var s=i.frontFunction,h=i.backFunction,r=i.reference,u=i.mask;n.stencilFunc(s,r,u);n.stencilFuncSeparate(n.BACK,h,r,u);n.stencilFuncSeparate(n.FRONT,s,r,u);var f=i.frontOperation,c=f.fail,a=f.zFail,v=f.zPass;n.stencilOpSeparate(n.FRONT,c,a,v);var e=i.backOperation,y=e.fail,p=e.zFail,w=e.zPass;n.stencilOpSeparate(n.BACK,y,p,w)}}function ot(n,t){var i=t.sampleCoverage,r=i.enabled;l(n,n.SAMPLE_COVERAGE,r);r&&n.sampleCoverage(i.value,i.invert)}function ht(n,t,u){var f=i(t.viewport,u.viewport);r(f)||(f=st,f.width=u.context.drawingBufferWidth,f.height=u.context.drawingBufferHeight);u.context.uniformState.viewport=f;n.viewport(f.x,f.y,f.width,f.height)}function yt(n,t){var i=[];return n.frontFace!==t.frontFace&&i.push(w),(n.cull.enabled!==t.cull.enabled||n.cull.face!==t.cull.face)&&i.push(b),n.lineWidth!==t.lineWidth&&i.push(k),(n.polygonOffset.enabled!==t.polygonOffset.enabled||n.polygonOffset.factor!==t.polygonOffset.factor||n.polygonOffset.units!==t.polygonOffset.units)&&i.push(d),(n.depthRange.near!==t.depthRange.near||n.depthRange.far!==t.depthRange.far)&&i.push(nt),(n.depthTest.enabled!==t.depthTest.enabled||n.depthTest.func!==t.depthTest.func)&&i.push(tt),(n.colorMask.red!==t.colorMask.red||n.colorMask.green!==t.colorMask.green||n.colorMask.blue!==t.colorMask.blue||n.colorMask.alpha!==t.colorMask.alpha)&&i.push(it),n.depthMask!==t.depthMask&&i.push(rt),n.stencilMask!==t.stencilMask&&i.push(ut),(n.stencilTest.enabled!==t.stencilTest.enabled||n.stencilTest.frontFunction!==t.stencilTest.frontFunction||n.stencilTest.backFunction!==t.stencilTest.backFunction||n.stencilTest.reference!==t.stencilTest.reference||n.stencilTest.mask!==t.stencilTest.mask||n.stencilTest.frontOperation.fail!==t.stencilTest.frontOperation.fail||n.stencilTest.frontOperation.zFail!==t.stencilTest.frontOperation.zFail||n.stencilTest.backOperation.fail!==t.stencilTest.backOperation.fail||n.stencilTest.backOperation.zFail!==t.stencilTest.backOperation.zFail||n.stencilTest.backOperation.zPass!==t.stencilTest.backOperation.zPass)&&i.push(et),(n.sampleCoverage.enabled!==t.sampleCoverage.enabled||n.sampleCoverage.value!==t.sampleCoverage.value||n.sampleCoverage.invert!==t.sampleCoverage.invert)&&i.push(ot),i}var at=0,c={},st;return h.fromCache=function(n){var f=JSON.stringify(n),t=c[f],i,u;return r(t)?(++t.referenceCount,t.state):(i=new h(n),u=JSON.stringify(i),t=c[u],r(t)||(i.id=at++,i=s(i),t={referenceCount:0,state:i},c[u]=t),++t.referenceCount,c[f]={referenceCount:1,state:t.state},t.state)},h.removeFromCache=function(n){var e=new h(n),u=JSON.stringify(e),t=c[u],f=JSON.stringify(n),i=c[f];r(i)&&(--i.referenceCount,i.referenceCount===0&&(delete c[f],r(t)&&--t.referenceCount));r(t)&&t.referenceCount===0&&delete c[u]},h.getCache=function(){return c},h.clearCache=function(){c={}},st=new n,h.apply=function(n,t,i){w(n,t);b(n,t);k(n,t);d(n,t);nt(n,t);tt(n,t);it(n,t);rt(n,t);ut(n,t);et(n,t);ot(n,t);g(n,t,i);ft(n,t,i);ht(n,t,i)},h.partialApply=function(n,t,i,u,f,e){var o,c,s,l,a,v,h;if(t!==i)for(o=i._applyFunctions[t.id],r(o)||(o=yt(t,i),i._applyFunctions[t.id]=o),c=o.length,s=0;s<c;++s)o[s](n,i);l=r(u.scissorTest)?u.scissorTest:t.scissorTest;a=r(f.scissorTest)?f.scissorTest:i.scissorTest;(l!==a||e)&&g(n,i,f);v=r(u.blendingEnabled)?u.blendingEnabled:t.blending.enabled;h=r(f.blendingEnabled)?f.blendingEnabled:i.blending.enabled;(v!==h||h&&t.blending!==i.blending)&&ft(n,i,f);(t!==i||u!==f||u.context!==f.context)&&ht(n,i,f)},h.getState=function(i){if(!r(i))throw new u("renderState is required.");return{frontFace:i.frontFace,cull:{enabled:i.cull.enabled,face:i.cull.face},lineWidth:i.lineWidth,polygonOffset:{enabled:i.polygonOffset.enabled,factor:i.polygonOffset.factor,units:i.polygonOffset.units},scissorTest:{enabled:i.scissorTest.enabled,rectangle:n.clone(i.scissorTest.rectangle)},depthRange:{near:i.depthRange.near,far:i.depthRange.far},depthTest:{enabled:i.depthTest.enabled,func:i.depthTest.func},colorMask:{red:i.colorMask.red,green:i.colorMask.green,blue:i.colorMask.blue,alpha:i.colorMask.alpha},depthMask:i.depthMask,stencilMask:i.stencilMask,blending:{enabled:i.blending.enabled,color:t.clone(i.blending.color),equationRgb:i.blending.equationRgb,equationAlpha:i.blending.equationAlpha,functionSourceRgb:i.blending.functionSourceRgb,functionSourceAlpha:i.blending.functionSourceAlpha,functionDestinationRgb:i.blending.functionDestinationRgb,functionDestinationAlpha:i.blending.functionDestinationAlpha},stencilTest:{enabled:i.stencilTest.enabled,frontFunction:i.stencilTest.frontFunction,backFunction:i.stencilTest.backFunction,reference:i.stencilTest.reference,mask:i.stencilTest.mask,frontOperation:{fail:i.stencilTest.frontOperation.fail,zFail:i.stencilTest.frontOperation.zFail,zPass:i.stencilTest.frontOperation.zPass},backOperation:{fail:i.stencilTest.backOperation.fail,zFail:i.stencilTest.backOperation.zFail,zPass:i.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:i.sampleCoverage.enabled,value:i.sampleCoverage.value,invert:i.sampleCoverage.invert},viewport:r(i.viewport)?n.clone(i.viewport):undefined}},h});t("Renderer/AutomaticUniforms",["../Core/Cartesian3","../Core/Math","../Core/Matrix4","../Core/WebGLConstants"],function(n,t,i,r){"use strict";function u(n){this._size=n.size;this._datatype=n.datatype;this.getValue=n.getValue}var e=new n,f;return typeof WebGLRenderingContext=="undefined"?{}:(f={},f[r.FLOAT]="float",f[r.FLOAT_VEC2]="vec2",f[r.FLOAT_VEC3]="vec3",f[r.FLOAT_VEC4]="vec4",f[r.INT]="int",f[r.INT_VEC2]="ivec2",f[r.INT_VEC3]="ivec3",f[r.INT_VEC4]="ivec4",f[r.BOOL]="bool",f[r.BOOL_VEC2]="bvec2",f[r.BOOL_VEC3]="bvec3",f[r.BOOL_VEC4]="bvec4",f[r.FLOAT_MAT2]="mat2",f[r.FLOAT_MAT3]="mat3",f[r.FLOAT_MAT4]="mat4",f[r.SAMPLER_2D]="sampler2D",f[r.SAMPLER_CUBE]="samplerCube",u.prototype.getDeclaration=function(n){var i="uniform "+f[this._datatype]+" "+n,t=this._size;return i+(t===1?";":"["+t.toString()+"];")},{czm_viewport:new u({size:1,datatype:r.FLOAT_VEC4,getValue:function(n){return n.viewportCartesian4}}),czm_viewportOrthographic:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.viewportOrthographic}}),czm_viewportTransformation:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.viewportTransformation}}),czm_globeDepthTexture:new u({size:1,datatype:r.SAMPLER_2D,getValue:function(n){return n.globeDepthTexture}}),czm_model:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.model}}),czm_inverseModel:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseModel}}),czm_view:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.view}}),czm_view3D:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.view3D}}),czm_viewRotation:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.viewRotation}}),czm_viewRotation3D:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.viewRotation3D}}),czm_inverseView:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseView}}),czm_inverseView3D:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseView3D}}),czm_inverseViewRotation:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.inverseViewRotation}}),czm_inverseViewRotation3D:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.inverseViewRotation3D}}),czm_projection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.projection}}),czm_inverseProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseProjection}}),czm_infiniteProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.infiniteProjection}}),czm_modelView:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.modelView}}),czm_modelView3D:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.modelView3D}}),czm_modelViewRelativeToEye:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.modelViewRelativeToEye}}),czm_inverseModelView:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseModelView}}),czm_inverseModelView3D:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseModelView3D}}),czm_viewProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.viewProjection}}),czm_inverseViewProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseViewProjection}}),czm_modelViewProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.modelViewProjection}}),czm_inverseModelViewProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new u({size:1,datatype:r.FLOAT_MAT4,getValue:function(n){return n.modelViewInfiniteProjection}}),czm_orthographicIn3D:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.orthographicIn3D?1:0}}),czm_normal:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.normal}}),czm_normal3D:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.normal3D}}),czm_inverseNormal:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.inverseNormal}}),czm_inverseNormal3D:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.inverseNormal3D}}),czm_eyeHeight2D:new u({size:1,datatype:r.FLOAT_VEC2,getValue:function(n){return n.eyeHeight2D}}),czm_entireFrustum:new u({size:1,datatype:r.FLOAT_VEC2,getValue:function(n){return n.entireFrustum}}),czm_currentFrustum:new u({size:1,datatype:r.FLOAT_VEC2,getValue:function(n){return n.currentFrustum}}),czm_frustumPlanes:new u({size:1,datatype:r.FLOAT_VEC4,getValue:function(n){return n.frustumPlanes}}),czm_log2FarDistance:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.log2FarDistance}}),czm_log2FarPlusOne:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.log2FarPlusOne}}),czm_log2NearDistance:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.log2NearDistance}}),czm_sunPositionWC:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.sunPositionWC}}),czm_sunPositionColumbusView:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.sunPositionColumbusView}}),czm_sunDirectionEC:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.sunDirectionEC}}),czm_sunDirectionWC:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.sunDirectionWC}}),czm_moonDirectionEC:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.moonDirectionEC}}),czm_encodedCameraPositionMCHigh:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return n.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new u({size:1,datatype:r.FLOAT_VEC3,getValue:function(n){return i.getTranslation(n.inverseView,e)}}),czm_frameNumber:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.frameState.frameNumber}}),czm_morphTime:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.frameState.morphTime}}),czm_sceneMode:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.frameState.mode}}),czm_pass:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.pass}}),czm_backgroundColor:new u({size:1,datatype:r.FLOAT_VEC4,getValue:function(n){return n.backgroundColor}}),czm_brdfLut:new u({size:1,datatype:r.SAMPLER_2D,getValue:function(n){return n.brdfLut}}),czm_environmentMap:new u({size:1,datatype:r.SAMPLER_CUBE,getValue:function(n){return n.environmentMap}}),czm_temeToPseudoFixed:new u({size:1,datatype:r.FLOAT_MAT3,getValue:function(n){return n.temeToPseudoFixedMatrix}}),czm_resolutionScale:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.resolutionScale}}),czm_fogDensity:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.fogDensity}}),czm_imagerySplitPosition:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.imagerySplitPosition}}),czm_geometricToleranceOverMeter:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new u({size:1,datatype:r.FLOAT,getValue:function(n){return n.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new u({size:1,datatype:r.FLOAT_VEC4,getValue:function(n){return n.invertClassificationColor}})})});t("Renderer/createUniform",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Color","../Core/defined","../Core/DeveloperError","../Core/FeatureDetection","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","../Core/RuntimeError"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function ft(n,t,i,r){switch(t.type){case n.FLOAT:return new a(n,t,i,r);case n.FLOAT_VEC2:return new v(n,t,i,r);case n.FLOAT_VEC3:return new y(n,t,i,r);case n.FLOAT_VEC4:return new p(n,t,i,r);case n.SAMPLER_2D:case n.SAMPLER_CUBE:return new l(n,t,i,r);case n.INT:case n.BOOL:return new w(n,t,i,r);case n.INT_VEC2:case n.BOOL_VEC2:return new b(n,t,i,r);case n.INT_VEC3:case n.BOOL_VEC3:return new k(n,t,i,r);case n.INT_VEC4:case n.BOOL_VEC4:return new d(n,t,i,r);case n.FLOAT_MAT2:return new nt(n,t,i,r);case n.FLOAT_MAT3:return new it(n,t,i,r);case n.FLOAT_MAT4:return new ut(n,t,i,r);default:throw new c("Unrecognized uniform type: "+t.type+' for uniform "'+i+'".');}}function a(n,t,i,r){this.name=i;this.value=undefined;this._value=0;this._gl=n;this._location=r}function v(t,i,r,u){this.name=r;this.value=undefined;this._value=new n;this._gl=t;this._location=u}function y(n,t,i,r){this.name=i;this.value=undefined;this._value=undefined;this._gl=n;this._location=r}function p(n,t,i,r){this.name=i;this.value=undefined;this._value=undefined;this._gl=n;this._location=r}function l(n,t,i,r){this.name=i;this.value=undefined;this._gl=n;this._location=r;this.textureUnitIndex=undefined}function w(n,t,i,r){this.name=i;this.value=undefined;this._value=0;this._gl=n;this._location=r}function b(t,i,r,u){this.name=r;this.value=undefined;this._value=new n;this._gl=t;this._location=u}function k(n,i,r,u){this.name=r;this.value=undefined;this._value=new t;this._gl=n;this._location=u}function d(n,t,r,u){this.name=r;this.value=undefined;this._value=new i;this._gl=n;this._location=u}function nt(n,t,i,r){this.name=i;this.value=undefined;this._value=new o;this._gl=n;this._location=r}function it(n,t,i,r){this.name=i;this.value=undefined;this._value=new s;this._gl=n;this._location=r}function ut(n,t,i,r){this.name=i;this.value=undefined;this._value=new h;this._gl=n;this._location=r}var g,tt,rt;return e.supportsTypedArrays()?(a.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))},v.prototype.set=function(){var t=this.value;n.equals(t,this._value)||(n.clone(t,this._value),this._gl.uniform2f(this._location,t.x,t.y))},y.prototype.set=function(){var n=this.value;if(u(n.red))r.equals(n,this._value)||(this._value=r.clone(n,this._value),this._gl.uniform3f(this._location,n.red,n.green,n.blue));else if(u(n.x))t.equals(n,this._value)||(this._value=t.clone(n,this._value),this._gl.uniform3f(this._location,n.x,n.y,n.z));else throw new f('Invalid vec3 value for uniform "'+this.name+'".');},p.prototype.set=function(){var n=this.value;if(u(n.red))r.equals(n,this._value)||(this._value=r.clone(n,this._value),this._gl.uniform4f(this._location,n.red,n.green,n.blue,n.alpha));else if(u(n.x))i.equals(n,this._value)||(this._value=i.clone(n,this._value),this._gl.uniform4f(this._location,n.x,n.y,n.z,n.w));else throw new f('Invalid vec4 value for uniform "'+this.name+'".');},l.prototype.set=function(){var n=this._gl,t;n.activeTexture(n.TEXTURE0+this.textureUnitIndex);t=this.value;n.bindTexture(t._target,t._texture)},l.prototype._setSampler=function(n){return this.textureUnitIndex=n,this._gl.uniform1i(this._location,n),n+1},w.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))},b.prototype.set=function(){var t=this.value;n.equals(t,this._value)||(n.clone(t,this._value),this._gl.uniform2i(this._location,t.x,t.y))},k.prototype.set=function(){var n=this.value;t.equals(n,this._value)||(t.clone(n,this._value),this._gl.uniform3i(this._location,n.x,n.y,n.z))},d.prototype.set=function(){var n=this.value;i.equals(n,this._value)||(i.clone(n,this._value),this._gl.uniform4i(this._location,n.x,n.y,n.z,n.w))},g=new Float32Array(4),nt.prototype.set=function(){if(!o.equalsArray(this.value,this._value,0)){o.clone(this.value,this._value);var n=o.toArray(this.value,g);this._gl.uniformMatrix2fv(this._location,!1,n)}},tt=new Float32Array(9),it.prototype.set=function(){if(!s.equalsArray(this.value,this._value,0)){s.clone(this.value,this._value);var n=s.toArray(this.value,tt);this._gl.uniformMatrix3fv(this._location,!1,n)}},rt=new Float32Array(16),ut.prototype.set=function(){if(!h.equalsArray(this.value,this._value,0)){h.clone(this.value,this._value);var n=h.toArray(this.value,rt);this._gl.uniformMatrix4fv(this._location,!1,n)}},ft):{}});t("Renderer/createUniformArray",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Color","../Core/defined","../Core/DeveloperError","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","../Core/RuntimeError"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function tt(n,t,i,r){switch(t.type){case n.FLOAT:return new l(n,t,i,r);case n.FLOAT_VEC2:return new a(n,t,i,r);case n.FLOAT_VEC3:return new v(n,t,i,r);case n.FLOAT_VEC4:return new y(n,t,i,r);case n.SAMPLER_2D:case n.SAMPLER_CUBE:return new c(n,t,i,r);case n.INT:case n.BOOL:return new p(n,t,i,r);case n.INT_VEC2:case n.BOOL_VEC2:return new w(n,t,i,r);case n.INT_VEC3:case n.BOOL_VEC3:return new b(n,t,i,r);case n.INT_VEC4:case n.BOOL_VEC4:return new k(n,t,i,r);case n.FLOAT_MAT2:return new d(n,t,i,r);case n.FLOAT_MAT3:return new g(n,t,i,r);case n.FLOAT_MAT4:return new nt(n,t,i,r);default:throw new h("Unrecognized uniform type: "+t.type+' for uniform "'+i+'".');}}function l(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u);this._gl=n;this._location=r[0]}function a(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u*2);this._gl=n;this._location=r[0]}function v(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u*3);this._gl=n;this._location=r[0]}function y(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u*4);this._gl=n;this._location=r[0]}function c(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u);this._gl=n;this._locations=r;this.textureUnitIndex=undefined}function p(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Int32Array(u);this._gl=n;this._location=r[0]}function w(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Int32Array(u*2);this._gl=n;this._location=r[0]}function b(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Int32Array(u*3);this._gl=n;this._location=r[0]}function k(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Int32Array(u*4);this._gl=n;this._location=r[0]}function d(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u*4);this._gl=n;this._location=r[0]}function g(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u*9);this._gl=n;this._location=r[0]}function nt(n,t,i,r){var u=r.length;this.name=i;this.value=new Array(u);this._value=new Float32Array(u*16);this._gl=n;this._location=r[0]}return l.prototype.set=function(){for(var i,r=this.value,f=r.length,t=this._value,u=!1,n=0;n<f;++n)i=r[n],i!==t[n]&&(t[n]=i,u=!0);u&&this._gl.uniform1fv(this._location,t)},a.prototype.set=function(){for(var u,f=this.value,o=f.length,t=this._value,e=!1,i=0,r=0;r<o;++r)u=f[r],n.equalsArray(u,t,i)||(n.pack(u,t,i),e=!0),i+=2;e&&this._gl.uniform2fv(this._location,t)},v.prototype.set=function(){for(var n,s=this.value,h=s.length,i=this._value,e=!1,r=0,o=0;o<h;++o){if(n=s[o],u(n.red))(n.red!==i[r]||n.green!==i[r+1]||n.blue!==i[r+2])&&(i[r]=n.red,i[r+1]=n.green,i[r+2]=n.blue,e=!0);else if(u(n.x))t.equalsArray(n,i,r)||(t.pack(n,i,r),e=!0);else throw new f("Invalid vec3 value.");r+=3}e&&this._gl.uniform3fv(this._location,i)},y.prototype.set=function(){for(var n,h=this.value,c=h.length,t=this._value,o=!1,e=0,s=0;s<c;++s){if(n=h[s],u(n.red))r.equalsArray(n,t,e)||(r.pack(n,t,e),o=!0);else if(u(n.x))i.equalsArray(n,t,e)||(i.pack(n,t,e),o=!0);else throw new f("Invalid vec4 value.");e+=4}o&&this._gl.uniform4fv(this._location,t)},c.prototype.set=function(){for(var i,t=this._gl,u=t.TEXTURE0+this.textureUnitIndex,r=this.value,f=r.length,n=0;n<f;++n)i=r[n],t.activeTexture(u+n),t.bindTexture(i._target,i._texture)},c.prototype._setSampler=function(n){var i,r,t,u;for(this.textureUnitIndex=n,i=this._locations,r=i.length,t=0;t<r;++t)u=n+t,this._gl.uniform1i(i[t],u);return n+r},p.prototype.set=function(){for(var i,r=this.value,f=r.length,t=this._value,u=!1,n=0;n<f;++n)i=r[n],i!==t[n]&&(t[n]=i,u=!0);u&&this._gl.uniform1iv(this._location,t)},w.prototype.set=function(){for(var u,f=this.value,o=f.length,t=this._value,e=!1,i=0,r=0;r<o;++r)u=f[r],n.equalsArray(u,t,i)||(n.pack(u,t,i),e=!0),i+=2;e&&this._gl.uniform2iv(this._location,t)},b.prototype.set=function(){for(var u,f=this.value,o=f.length,n=this._value,e=!1,i=0,r=0;r<o;++r)u=f[r],t.equalsArray(u,n,i)||(t.pack(u,n,i),e=!0),i+=3;e&&this._gl.uniform3iv(this._location,n)},k.prototype.set=function(){for(var u,f=this.value,o=f.length,n=this._value,e=!1,t=0,r=0;r<o;++r)u=f[r],i.equalsArray(u,n,t)||(i.pack(u,n,t),e=!0),t+=4;e&&this._gl.uniform4iv(this._location,n)},d.prototype.set=function(){for(var r,u=this.value,o=u.length,n=this._value,f=!1,t=0,i=0;i<o;++i)r=u[i],e.equalsArray(r,n,t)||(e.pack(r,n,t),f=!0),t+=4;f&&this._gl.uniformMatrix2fv(this._location,!1,n)},g.prototype.set=function(){for(var r,u=this.value,e=u.length,n=this._value,f=!1,t=0,i=0;i<e;++i)r=u[i],o.equalsArray(r,n,t)||(o.pack(r,n,t),f=!0),t+=9;f&&this._gl.uniformMatrix3fv(this._location,!1,n)},nt.prototype.set=function(){for(var r,u=this.value,e=u.length,n=this._value,f=!1,t=0,i=0;i<e;++i)r=u[i],s.equalsArray(r,n,t)||(s.pack(r,n,t),f=!0),t+=16;f&&this._gl.uniformMatrix4fv(this._location,!1,n)},tt});t("Renderer/ShaderProgram",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/RuntimeError","./AutomaticUniforms","./ContextLimits","./createUniform","./createUniformArray"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function a(n){var t=w(n.vertexShaderText,n.fragmentShaderText);this._gl=n.gl;this._logShaderCompilation=n.logShaderCompilation;this._debugShaders=n.debugShaders;this._attributeLocations=n.attributeLocations;this._program=undefined;this._numberOfVertexAttributes=undefined;this._vertexAttributes=undefined;this._uniformsByName=undefined;this._uniforms=undefined;this._automaticUniforms=undefined;this._manualUniforms=undefined;this._duplicateUniformNames=t.duplicateUniformNames;this._cachedShader=undefined;this.maximumTextureUnitIndex=undefined;this._vertexShaderSource=n.vertexShaderSource;this._vertexShaderText=n.vertexShaderText;this._fragmentShaderSource=n.fragmentShaderSource;this._fragmentShaderText=t.fragmentShaderText;this.id=p++}function y(n){var f=[],r=n.match(/uniform.*?(?![^{]*})(?=[=\[;])/g),e,t,u,o;if(i(r))for(e=r.length,t=0;t<e;t++)u=r[t].trim(),o=u.slice(u.lastIndexOf(" ")+1),f.push(o);return f}function w(n,t){var o={},c;if(!s.highpFloatSupported||!s.highpIntSupported)for(var r,u,f,e=y(n),h=y(t),l=e.length,a=h.length,i=0;i<l;i++)for(r=0;r<a;r++)e[i]===h[r]&&(u=e[i],f="czm_mediump_"+u,c=new RegExp(u+"\\b","g"),t=t.replace(c,f),o[f]=u);return{fragmentShaderText:t,duplicateUniformNames:o}}function b(n,t){var p=t._vertexShaderText,w=t._fragmentShaderText,o=n.createShader(n.VERTEX_SHADER),f,u,h,c,r,s,v,y,a;if(n.shaderSource(o,p),n.compileShader(o),f=n.createShader(n.FRAGMENT_SHADER),n.shaderSource(f,w),n.compileShader(f),u=n.createProgram(),n.attachShader(u,o),n.attachShader(u,f),n.deleteShader(o),n.deleteShader(f),h=t._attributeLocations,i(h))for(c in h)h.hasOwnProperty(c)&&n.bindAttribLocation(u,h[c],c);if(n.linkProgram(u),!n.getProgramParameter(u,n.LINK_STATUS)){if(s=t._debugShaders,!n.getShaderParameter(f,n.COMPILE_STATUS)){r=n.getShaderInfoLog(f);console.error(l+"Fragment shader compile log: "+r);i(s)&&(v=s.getTranslatedShaderSource(f),v!==""?console.error(l+"Translated fragment shader source:\n"+v):console.error(l+"Fragment shader translation failed."));n.deleteProgram(u);throw new e("Fragment shader failed to compile.  Compile log: "+r);}if(!n.getShaderParameter(o,n.COMPILE_STATUS)){r=n.getShaderInfoLog(o);console.error(l+"Vertex shader compile log: "+r);i(s)&&(y=s.getTranslatedShaderSource(o),y!==""?console.error(l+"Translated vertex shader source:\n"+y):console.error(l+"Vertex shader translation failed."));n.deleteProgram(u);throw new e("Vertex shader failed to compile.  Compile log: "+r);}r=n.getProgramInfoLog(u);console.error(l+"Shader program link log: "+r);i(s)&&(console.error(l+"Translated vertex shader source:\n"+s.getTranslatedShaderSource(o)),console.error(l+"Translated fragment shader source:\n"+s.getTranslatedShaderSource(f)));n.deleteProgram(u);throw new e("Program failed to link.  Link log: "+r);}return a=t._logShaderCompilation,a&&(r=n.getShaderInfoLog(o),i(r)&&r.length>0&&console.log(l+"Vertex shader compile log: "+r)),a&&(r=n.getShaderInfoLog(f),i(r)&&r.length>0&&console.log(l+"Fragment shader compile log: "+r)),a&&(r=n.getProgramInfoLog(u),i(r)&&r.length>0&&console.log(l+"Shader program link log: "+r)),u}function k(n,t,i){for(var r,e,f={},u=0;u<i;++u)r=n.getActiveAttrib(t,u),e=n.getAttribLocation(t,r.name),f[r.name]={name:r.name,type:r.type,index:e};return f}function d(n,t){for(var w,s,f,o,d,e,b,a,l={},v=[],y=[],g=n.getProgramParameter(t,n.ACTIVE_UNIFORMS),p=0;p<g;++p){var u=n.getActiveUniform(t,p),k="[0]",r=u.name.indexOf(k,u.name.length-k.length)!==-1?u.name.slice(0,u.name.length-3):u.name;if(r.indexOf("gl_")!==0)if(u.name.indexOf("[")<0)w=n.getUniformLocation(t,r),w!==null&&(s=h(n,u,r,w),l[r]=s,v.push(s),s._setSampler&&y.push(s));else if(b=r.indexOf("["),b>=0){if(f=l[r.slice(0,b)],!i(f))continue;o=f._locations;o.length<=1&&(d=f.value,e=n.getUniformLocation(t,r),e!==null&&(o.push(e),d.push(n.getUniform(t,e))))}else{for(o=[],a=0;a<u.size;++a)e=n.getUniformLocation(t,r+"["+a+"]"),e!==null&&o.push(e);f=c(n,u,r,o);l[r]=f;v.push(f);f._setSampler&&y.push(f)}}return{uniformsByName:l,uniforms:v,samplerUniforms:y}}function g(n,t){var h=[],c=[],r,s;for(r in t)if(t.hasOwnProperty(r)){var u=t[r],f=r,e=n._duplicateUniformNames[f];i(e)&&(u.name=e,f=e);s=o[f];i(s)?h.push({uniform:u,automaticUniform:s}):c.push(u)}return{automaticUniforms:h,manualUniforms:c}}function nt(n,t,i){var r,f,u;for(n.useProgram(t),r=0,f=i.length,u=0;u<f;++u)r=i[u]._setSampler(r);return n.useProgram(null),r}function v(n){if(!i(n._program)){var t=n._gl,r=b(t,n,n._debugShaders),f=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),u=d(t,r),e=g(n,u.uniformsByName);n._program=r;n._numberOfVertexAttributes=f;n._vertexAttributes=k(t,r,f);n._uniformsByName=u.uniformsByName;n._uniforms=u.uniforms;n._automaticUniforms=e.automaticUniforms;n._manualUniforms=e.manualUniforms;n.maximumTextureUnitIndex=nt(t,r,u.samplerUniforms)}}var p=0,l;return a.fromCache=function(i){return i=t(i,t.EMPTY_OBJECT),n.defined("options.context",i.context),i.context.shaderCache.getShaderProgram(i)},a.replaceCache=function(i){return i=t(i,t.EMPTY_OBJECT),n.defined("options.context",i.context),i.context.shaderCache.replaceShaderProgram(i)},r(a.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){return v(this),this._vertexAttributes}},numberOfVertexAttributes:{get:function(){return v(this),this._numberOfVertexAttributes}},allUniforms:{get:function(){return v(this),this._uniformsByName}}}),l="[Cesium WebGL] ",a.prototype._bind=function(){v(this);this._gl.useProgram(this._program)},a.prototype._setUniforms=function(n,t,r){var e,u,h,c,l,a,v,o,s;if(i(n))for(h=this._manualUniforms,e=h.length,u=0;u<e;++u)c=h[u],c.value=n[c.name]();for(l=this._automaticUniforms,e=l.length,u=0;u<e;++u)a=l[u],a.uniform.value=a.automaticUniform.getValue(t);for(v=this._uniforms,e=v.length,u=0;u<e;++u)v[u].set();if(r&&(o=this._gl,s=this._program,o.validateProgram(s),!o.getProgramParameter(s,o.VALIDATE_STATUS)))throw new f("Program validation failed.  Program info log: "+o.getProgramInfoLog(s));},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return this._cachedShader.cache.releaseShaderProgram(this),undefined},a.prototype.finalDestroy=function(){return this._gl.deleteProgram(this._program),u(this)},a});t("Renderer/modernizeShader",["../Core/defined","../Core/DeveloperError"],function(n,t){"use strict";function f(n,f){var e=n.split("\n"),a,c,v,p,g,w,y,b,et,k,rt,ut;if(/#version 300 es/g.test(n))return n;for(a=-1,c=0;c<e.length;++c)if(v=e[c],/#define OUTPUT_DECLARATION/.test(v)){a=c;break}if(a===-1)throw new t("Could not find a #define OUTPUT_DECLARATION!");for(p=[],c=0;c<10;c++){var ft="gl_FragData\\["+c+"\\]",d="czm_out"+c,ot=new RegExp(ft,"g");ot.test(n)&&(r(d,p),i(ft,d,e),e.splice(a,0,"layout(location = "+c+") out vec4 "+d+";"),a+=1)}for(g="czm_fragColor",o("gl_FragColor",e)&&(r(g,p),i("gl_FragColor",g,e),e.splice(a,0,"layout(location = 0) out vec4 czm_fragColor;"),a+=1),w=h(p,e),y={},c=0;c<e.length;c++){v=e[c];for(b in w)w.hasOwnProperty(b)&&(et=new RegExp("(layout)[^]+(out)[^]+("+b+")[^]+","g"),et.test(v)&&(y[v]=b))}for(k in y)if(y.hasOwnProperty(k)){for(var st=y[k],nt=e.indexOf(k),tt=w[st],it=tt.length,l=0;l<it;l++)e.splice(nt,0,tt[l]);for(nt+=it+1,l=it-1;l>=0;l--)e.splice(nt,0,"#endif //"+tt[l])}for(rt="#version 300 es",ut=!1,c=0;c<e.length;c++)/#version/.test(e[c])&&(e[c]=rt,ut=!0);return ut||e.splice(0,0,rt),u("EXT_draw_buffers",e),u("EXT_frag_depth",e),i("texture2D","texture",e),i("texture3D","texture",e),i("textureCube","texture",e),i("gl_FragDepthEXT","gl_FragDepth",e),f?i("varying","in",e):(i("attribute","in",e),i("varying","out",e)),s(e)}function i(n,t,i){for(var u,f="(^|[^\\w])("+n+")($|[^\\w])",e=new RegExp(f,"g"),o=i.length,r=0;r<o;++r)u=i[r],i[r]=u.replace(e,"$1"+t+"$3")}function e(n,t,i){for(var u,f=i.length,r=0;r<f;++r)u=i[r],i[r]=u.replace(n,t)}function o(n,t){for(var r,u="(^|[^\\w])("+n+")($|[^\\w])",f=new RegExp(u,"g"),e=t.length,i=0;i<e;++i)if(r=t[i],f.test(r))return!0;return!1}function s(n){for(var i="",r=n.length,t=0;t<r;++t)i+=n[t]+"\n";return i}function r(n,t){t.indexOf(n)===-1&&t.push(n)}function h(t,i){for(var c,f,s,e,o={},l=t.length,r=[],h=0;h<i.length;++h){var u=i[h],a=/(#ifdef|#if)/g.test(u),v=/#else/g.test(u),y=/#endif/g.test(u);if(a)r.push(u);else if(v)c=r[r.length-1],f=c.replace("ifdef","ifndef"),/if/g.test(f)&&(f=f.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),r.pop(),r.push(f);else if(y)r.pop();else if(!/layout/g.test(u))for(s=0;s<l;++s)e=t[s],u.indexOf(e)!==-1&&(o[e]=n(o[e])?o[e].filter(function(n){return r.indexOf(n)>=0}):r.slice())}return o}function u(n,t){var i="#extension\\s+GL_"+n+"\\s+:\\s+[a-zA-Z0-9]+\\s*$";e(new RegExp(i,"g"),"",t)}return f});t("Shaders/Builtin/Constants/degreesPerRadian",[],function(){"use strict";return"const float czm_degreesPerRadian = 57.29577951308232;\n"});t("Shaders/Builtin/Constants/depthRange",[],function(){"use strict";return"const czm_depthRangeStruct czm_depthRange = czm_depthRangeStruct(0.0, 1.0);\n"});t("Shaders/Builtin/Constants/epsilon1",[],function(){"use strict";return"const float czm_epsilon1 = 0.1;\n"});t("Shaders/Builtin/Constants/epsilon2",[],function(){"use strict";return"const float czm_epsilon2 = 0.01;\n"});t("Shaders/Builtin/Constants/epsilon3",[],function(){"use strict";return"const float czm_epsilon3 = 0.001;\n"});t("Shaders/Builtin/Constants/epsilon4",[],function(){"use strict";return"const float czm_epsilon4 = 0.0001;\n"});t("Shaders/Builtin/Constants/epsilon5",[],function(){"use strict";return"const float czm_epsilon5 = 0.00001;\n"});t("Shaders/Builtin/Constants/epsilon6",[],function(){"use strict";return"const float czm_epsilon6 = 0.000001;\n"});t("Shaders/Builtin/Constants/epsilon7",[],function(){"use strict";return"const float czm_epsilon7 = 0.0000001;\n"});t("Shaders/Builtin/Constants/infinity",[],function(){"use strict";return"const float czm_infinity = 5906376272000.0;\n"});t("Shaders/Builtin/Constants/oneOverPi",[],function(){"use strict";return"const float czm_oneOverPi = 0.3183098861837907;\n"});t("Shaders/Builtin/Constants/oneOverTwoPi",[],function(){"use strict";return"const float czm_oneOverTwoPi = 0.15915494309189535;\n"});t("Shaders/Builtin/Constants/passCesium3DTile",[],function(){"use strict";return"const float czm_passCesium3DTile = 4.0;\n"});t("Shaders/Builtin/Constants/passCesium3DTileClassification",[],function(){"use strict";return"const float czm_passCesium3DTileClassification = 5.0;\n"});t("Shaders/Builtin/Constants/passCesium3DTileClassificationIgnoreShow",[],function(){"use strict";return"const float czm_passCesium3DTileClassificationIgnoreShow = 6.0;\n"});t("Shaders/Builtin/Constants/passClassification",[],function(){"use strict";return"const float czm_passClassification = 7.0;\n"});t("Shaders/Builtin/Constants/passCompute",[],function(){"use strict";return"const float czm_passCompute = 1.0;\n"});t("Shaders/Builtin/Constants/passEnvironment",[],function(){"use strict";return"const float czm_passEnvironment = 0.0;\n"});t("Shaders/Builtin/Constants/passGlobe",[],function(){"use strict";return"const float czm_passGlobe = 2.0;\n"});t("Shaders/Builtin/Constants/passOpaque",[],function(){"use strict";return"const float czm_passOpaque = 8.0;\n"});t("Shaders/Builtin/Constants/passOverlay",[],function(){"use strict";return"const float czm_passOverlay = 10.0;\n"});t("Shaders/Builtin/Constants/passTerrainClassification",[],function(){"use strict";return"const float czm_passTerrainClassification = 3.0;\n"});t("Shaders/Builtin/Constants/passTranslucent",[],function(){"use strict";return"const float czm_passTranslucent = 9.0;\n"});t("Shaders/Builtin/Constants/pi",[],function(){"use strict";return"const float czm_pi = 3.141592653589793;\n"});t("Shaders/Builtin/Constants/piOverFour",[],function(){"use strict";return"const float czm_piOverFour = 0.7853981633974483;\n"});t("Shaders/Builtin/Constants/piOverSix",[],function(){"use strict";return"const float czm_piOverSix = 0.5235987755982988;\n"});t("Shaders/Builtin/Constants/piOverThree",[],function(){"use strict";return"const float czm_piOverThree = 1.0471975511965976;\n"});t("Shaders/Builtin/Constants/piOverTwo",[],function(){"use strict";return"const float czm_piOverTwo = 1.5707963267948966;\n"});t("Shaders/Builtin/Constants/radiansPerDegree",[],function(){"use strict";return"const float czm_radiansPerDegree = 0.017453292519943295;\n"});t("Shaders/Builtin/Constants/sceneMode2D",[],function(){"use strict";return"const float czm_sceneMode2D = 2.0;\n"});t("Shaders/Builtin/Constants/sceneMode3D",[],function(){"use strict";return"const float czm_sceneMode3D = 3.0;\n"});t("Shaders/Builtin/Constants/sceneModeColumbusView",[],function(){"use strict";return"const float czm_sceneModeColumbusView = 1.0;\n"});t("Shaders/Builtin/Constants/sceneModeMorphing",[],function(){"use strict";return"const float czm_sceneModeMorphing = 0.0;\n"});t("Shaders/Builtin/Constants/solarRadius",[],function(){"use strict";return"const float czm_solarRadius = 695500000.0;\n"});t("Shaders/Builtin/Constants/threePiOver2",[],function(){"use strict";return"const float czm_threePiOver2 = 4.71238898038469;\n"});t("Shaders/Builtin/Constants/twoPi",[],function(){"use strict";return"const float czm_twoPi = 6.283185307179586;\n"});t("Shaders/Builtin/Constants/webMercatorMaxLatitude",[],function(){"use strict";return"const float czm_webMercatorMaxLatitude = 1.4844222297453324;\n"});t("Shaders/Builtin/Structs/depthRangeStruct",[],function(){"use strict";return"struct czm_depthRangeStruct\n{\nfloat near;\nfloat far;\n};\n"});t("Shaders/Builtin/Structs/ellipsoid",[],function(){"use strict";return"struct czm_ellipsoid\n{\nvec3 center;\nvec3 radii;\nvec3 inverseRadii;\nvec3 inverseRadiiSquared;\n};\n"});t("Shaders/Builtin/Structs/material",[],function(){"use strict";return"struct czm_material\n{\nvec3 diffuse;\nfloat specular;\nfloat shininess;\nvec3 normal;\nvec3 emission;\nfloat alpha;\n};\n"});t("Shaders/Builtin/Structs/materialInput",[],function(){"use strict";return"struct czm_materialInput\n{\nfloat s;\nvec2 st;\nvec3 str;\nvec3 normalEC;\nmat3 tangentToEyeMatrix;\nvec3 positionToEyeEC;\nfloat height;\nfloat slope;\n};\n"});t("Shaders/Builtin/Structs/ray",[],function(){"use strict";return"struct czm_ray\n{\nvec3 origin;\nvec3 direction;\n};\n"});t("Shaders/Builtin/Structs/raySegment",[],function(){"use strict";return"struct czm_raySegment\n{\nfloat start;\nfloat stop;\n};\nconst czm_raySegment czm_emptyRaySegment = czm_raySegment(-czm_infinity, -czm_infinity);\nconst czm_raySegment czm_fullRaySegment = czm_raySegment(0.0, czm_infinity);\n"});t("Shaders/Builtin/Structs/shadowParameters",[],function(){"use strict";return"struct czm_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\nvec3 texCoords;\n#else\nvec2 texCoords;\n#endif\nfloat depthBias;\nfloat depth;\nfloat nDotL;\nvec2 texelStepSize;\nfloat normalShadingSmooth;\nfloat darkness;\n};\n"});t("Shaders/Builtin/Functions/alphaWeight",[],function(){"use strict";return"float czm_alphaWeight(float a)\n{\nfloat z = (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nreturn pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));\n}\n"});t("Shaders/Builtin/Functions/antialias",[],function(){"use strict";return"vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\nfloat val1 = clamp(dist / fuzzFactor, 0.0, 1.0);\nfloat val2 = clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\nval1 = val1 * (1.0 - val2);\nval1 = val1 * val1 * (3.0 - (2.0 * val1));\nval1 = pow(val1, 0.5);\nvec4 midColor = (color1 + color2) * 0.5;\nreturn mix(midColor, currentColor, val1);\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\nreturn czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\n"});t("Shaders/Builtin/Functions/approximateSphericalCoordinates",[],function(){"use strict";return"vec2 czm_approximateSphericalCoordinates(vec3 normal) {\nfloat latitudeApproximation = czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);\nfloat longitudeApproximation = czm_fastApproximateAtan(normal.x, normal.y);\nreturn vec2(latitudeApproximation, longitudeApproximation);\n}\n"});t("Shaders/Builtin/Functions/branchFreeTernary",[],function(){"use strict";return"float czm_branchFreeTernary(bool comparison, float a, float b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {\nfloat useA = float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\n"});t("Shaders/Builtin/Functions/cascadeColor",[],function(){"use strict";return"vec4 czm_cascadeColor(vec4 weights)\n{\nreturn vec4(1.0, 0.0, 0.0, 1.0) * weights.x +\nvec4(0.0, 1.0, 0.0, 1.0) * weights.y +\nvec4(0.0, 0.0, 1.0, 1.0) * weights.z +\nvec4(1.0, 0.0, 1.0, 1.0) * weights.w;\n}\n"});t("Shaders/Builtin/Functions/cascadeDistance",[],function(){"use strict";return"uniform vec4 shadowMap_cascadeDistances;\nfloat czm_cascadeDistance(vec4 weights)\n{\nreturn dot(shadowMap_cascadeDistances, weights);\n}\n"});t("Shaders/Builtin/Functions/cascadeMatrix",[],function(){"use strict";return"uniform mat4 shadowMap_cascadeMatrices[4];\nmat4 czm_cascadeMatrix(vec4 weights)\n{\nreturn shadowMap_cascadeMatrices[0] * weights.x +\nshadowMap_cascadeMatrices[1] * weights.y +\nshadowMap_cascadeMatrices[2] * weights.z +\nshadowMap_cascadeMatrices[3] * weights.w;\n}\n"});t("Shaders/Builtin/Functions/cascadeWeights",[],function(){"use strict";return"uniform vec4 shadowMap_cascadeSplits[2];\nvec4 czm_cascadeWeights(float depthEye)\n{\nvec4 near = step(shadowMap_cascadeSplits[0], vec4(depthEye));\nvec4 far = step(depthEye, shadowMap_cascadeSplits[1]);\nreturn near * far;\n}\n"});t("Shaders/Builtin/Functions/columbusViewMorph",[],function(){"use strict";return"vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)\n{\nvec3 p = mix(position2D.xyz, position3D.xyz, time);\nreturn vec4(p, 1.0);\n}\n"});t("Shaders/Builtin/Functions/computePosition",[],function(){"use strict";return"vec4 czm_computePosition();\n"});t("Shaders/Builtin/Functions/cosineAndSine",[],function(){"use strict";return"vec2 cordic(float angle)\n{\nvec2 vector = vec2(6.0725293500888267e-1, 0.0);\nfloat sense = (angle < 0.0) ? -1.0 : 1.0;\nmat2 rotation = mat2(1.0, sense, -sense, 1.0);\nvector = rotation * vector;\nangle -= sense * 7.8539816339744828e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfloat factor = sense * 5.0e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.6364760900080609e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.5e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4497866312686414e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.25e-1;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2435499454676144e-1;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.25e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.2418809995957350e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.125e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.1239833430268277e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.5625e-2;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5623728620476831e-2;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.8125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.8123410601011111e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.90625e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.9062301319669718e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.953125e-3;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9531225164788188e-3;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.765625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.7656218955931946e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.8828125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.8828121119489829e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.44140625e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.4414062014936177e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.220703125e-4;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.2207031189367021e-4;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 6.103515625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 6.1035156174208773e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.0517578125e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.0517578115526096e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.52587890625e-5;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.5258789061315762e-5;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 7.62939453125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 7.6293945311019700e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 3.814697265625e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 3.8146972656064961e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.9073486328125e-6;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 1.9073486328101870e-6;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 9.5367431640625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 9.5367431640596084e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 4.76837158203125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 4.7683715820308884e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 2.384185791015625e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nangle -= sense * 2.3841857910155797e-7;\nsense = (angle < 0.0) ? -1.0 : 1.0;\nfactor = sense * 1.1920928955078125e-7;\nrotation[0][1] = factor;\nrotation[1][0] = -factor;\nvector = rotation * vector;\nreturn vector;\n}\nvec2 czm_cosineAndSine(float angle)\n{\nif (angle < -czm_piOverTwo || angle > czm_piOverTwo)\n{\nif (angle < 0.0)\n{\nreturn -cordic(angle + czm_pi);\n}\nelse\n{\nreturn -cordic(angle - czm_pi);\n}\n}\nelse\n{\nreturn cordic(angle);\n}\n}\n"});t("Shaders/Builtin/Functions/decompressTextureCoordinates",[],function(){"use strict";return"vec2 czm_decompressTextureCoordinates(float encoded)\n{\nfloat temp = encoded / 4096.0;\nfloat xZeroTo4095 = floor(temp);\nfloat stx = xZeroTo4095 / 4095.0;\nfloat sty = (encoded - xZeroTo4095 * 4096.0) / 4095.0;\nreturn vec2(stx, sty);\n}\n"});t("Shaders/Builtin/Functions/depthClampFarPlane",[],function(){"use strict";return"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvec4 czm_depthClampFarPlane(vec4 coords)\n{\n#ifndef LOG_DEPTH\nv_WindowZ = (0.5 * (coords.z / coords.w) + 0.5) * coords.w;\ncoords.z = min(coords.z, coords.w);\n#endif\nreturn coords;\n}\n"});t("Shaders/Builtin/Functions/eastNorthUpToEyeCoordinates",[],function(){"use strict";return"mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\nvec3 tangentMC = normalize(vec3(-positionMC.y, positionMC.x, 0.0));\nvec3 tangentEC = normalize(czm_normal3D * tangentMC);\nvec3 bitangentEC = normalize(cross(normalEC, tangentEC));\nreturn mat3(\ntangentEC.x,   tangentEC.y,   tangentEC.z,\nbitangentEC.x, bitangentEC.y, bitangentEC.z,\nnormalEC.x,    normalEC.y,    normalEC.z);\n}\n"});t("Shaders/Builtin/Functions/ellipsoidContainsPoint",[],function(){"use strict";return"bool czm_ellipsoidContainsPoint(czm_ellipsoid ellipsoid, vec3 point)\n{\nvec3 scaled = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\nreturn (dot(scaled, scaled) <= 1.0);\n}\n"});t("Shaders/Builtin/Functions/ellipsoidNew",[],function(){"use strict";return"czm_ellipsoid czm_ellipsoidNew(vec3 center, vec3 radii)\n{\nvec3 inverseRadii = vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\nvec3 inverseRadiiSquared = inverseRadii * inverseRadii;\nczm_ellipsoid temp = czm_ellipsoid(center, radii, inverseRadii, inverseRadiiSquared);\nreturn temp;\n}\n"});t("Shaders/Builtin/Functions/ellipsoidWgs84TextureCoordinates",[],function(){"use strict";return"vec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\nreturn vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n"});t("Shaders/Builtin/Functions/equalsEpsilon",[],function(){"use strict";return"bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\nreturn (abs(left - right) <= epsilon);\n}\n"});t("Shaders/Builtin/Functions/eyeOffset",[],function(){"use strict";return"vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec4 p = positionEC;\nvec4 zEyeOffset = normalize(p) * eyeOffset.z;\np.xy += eyeOffset.xy + zEyeOffset.xy;\np.z += zEyeOffset.z;\nreturn p;\n}\n"});t("Shaders/Builtin/Functions/eyeToWindowCoordinates",[],function(){"use strict";return"vec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\nvec4 q = czm_projection * positionEC;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n"});t("Shaders/Builtin/Functions/fastApproximateAtan",[],function(){"use strict";return"float czm_fastApproximateAtan(float x) {\nreturn x * (-0.1784 * x - 0.0663 * x * x + 1.0301);\n}\nfloat czm_fastApproximateAtan(float x, float y) {\nfloat t = abs(x);\nfloat opposite = abs(y);\nfloat adjacent = max(t, opposite);\nopposite = min(t, opposite);\nt = czm_fastApproximateAtan(opposite / adjacent);\nt = czm_branchFreeTernary(abs(y) > abs(x), czm_piOverTwo - t, t);\nt = czm_branchFreeTernary(x < 0.0, czm_pi - t, t);\nt = czm_branchFreeTernary(y < 0.0, -t, t);\nreturn t;\n}\n"});t("Shaders/Builtin/Functions/fog",[],function(){"use strict";return"vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)\n{\nfloat scalar = distanceToCamera * czm_fogDensity;\nfloat fog = 1.0 - exp(-(scalar * scalar));\nreturn mix(color, fogColor, fog);\n}\n"});t("Shaders/Builtin/Functions/geodeticSurfaceNormal",[],function(){"use strict";return"vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\nreturn normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n"});t("Shaders/Builtin/Functions/getDefaultMaterial",[],function(){"use strict";return"czm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\nczm_material material;\nmaterial.diffuse = vec3(0.0);\nmaterial.specular = 0.0;\nmaterial.shininess = 1.0;\nmaterial.normal = materialInput.normalEC;\nmaterial.emission = vec3(0.0);\nmaterial.alpha = 1.0;\nreturn material;\n}\n"});t("Shaders/Builtin/Functions/getLambertDiffuse",[],function(){"use strict";return"float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\nreturn max(dot(lightDirectionEC, normalEC), 0.0);\n}\n"});t("Shaders/Builtin/Functions/getSpecular",[],function(){"use strict";return"float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\nvec3 toReflectedLight = reflect(-lightDirectionEC, normalEC);\nfloat specular = max(dot(toReflectedLight, toEyeEC), 0.0);\nreturn pow(specular, max(shininess, czm_epsilon2));\n}\n"});t("Shaders/Builtin/Functions/getWaterNoise",[],function(){"use strict";return"vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\nfloat cosAngle = cos(angleInRadians);\nfloat sinAngle = sin(angleInRadians);\nvec2 s0 = vec2(1.0/17.0, 0.0);\nvec2 s1 = vec2(-1.0/29.0, 0.0);\nvec2 s2 = vec2(1.0/101.0, 1.0/59.0);\nvec2 s3 = vec2(-1.0/109.0, -1.0/57.0);\ns0 = vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\ns1 = vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\ns2 = vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\ns3 = vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\nvec2 uv0 = (uv/103.0) + (time * s0);\nvec2 uv1 = uv/107.0 + (time * s1) + vec2(0.23);\nvec2 uv2 = uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\nvec2 uv3 = uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\nuv0 = fract(uv0);\nuv1 = fract(uv1);\nuv2 = fract(uv2);\nuv3 = fract(uv3);\nvec4 noise = (texture2D(normalMap, uv0)) +\n(texture2D(normalMap, uv1)) +\n(texture2D(normalMap, uv2)) +\n(texture2D(normalMap, uv3));\nreturn ((noise / 4.0) - 0.5) * 2.0;\n}\n"});t("Shaders/Builtin/Functions/getWgs84EllipsoidEC",[],function(){"use strict";return"czm_ellipsoid czm_getWgs84EllipsoidEC()\n{\nvec3 radii = vec3(6378137.0, 6378137.0, 6356752.314245);\nvec3 inverseRadii = vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\nvec3 inverseRadiiSquared = inverseRadii * inverseRadii;\nczm_ellipsoid temp = czm_ellipsoid(czm_view[3].xyz, radii, inverseRadii, inverseRadiiSquared);\nreturn temp;\n}\n"});t("Shaders/Builtin/Functions/HSBToRGB",[],function(){"use strict";return"const vec4 K_HSB2RGB = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 czm_HSBToRGB(vec3 hsb)\n{\nvec3 p = abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);\nreturn hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);\n}\n"});t("Shaders/Builtin/Functions/HSLToRGB",[],function(){"use strict";return"vec3 hueToRGB(float hue)\n{\nfloat r = abs(hue * 6.0 - 3.0) - 1.0;\nfloat g = 2.0 - abs(hue * 6.0 - 2.0);\nfloat b = 2.0 - abs(hue * 6.0 - 4.0);\nreturn clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 czm_HSLToRGB(vec3 hsl)\n{\nvec3 rgb = hueToRGB(hsl.x);\nfloat c = (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;\nreturn (rgb - 0.5) * c + hsl.z;\n}\n"});t("Shaders/Builtin/Functions/hue",[],function(){"use strict";return"vec3 czm_hue(vec3 rgb, float adjustment)\n{\nconst mat3 toYIQ = mat3(0.299,     0.587,     0.114,\n0.595716, -0.274453, -0.321263,\n0.211456, -0.522591,  0.311135);\nconst mat3 toRGB = mat3(1.0,  0.9563,  0.6210,\n1.0, -0.2721, -0.6474,\n1.0, -1.107,   1.7046);\nvec3 yiq = toYIQ * rgb;\nfloat hue = atan(yiq.z, yiq.y) + adjustment;\nfloat chroma = sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\nvec3 color = vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\nreturn toRGB * color;\n}\n"});t("Shaders/Builtin/Functions/isEmpty",[],function(){"use strict";return"bool czm_isEmpty(czm_raySegment interval)\n{\nreturn (interval.stop < 0.0);\n}\n"});t("Shaders/Builtin/Functions/isFull",[],function(){"use strict";return"bool czm_isFull(czm_raySegment interval)\n{\nreturn (interval.start == 0.0 && interval.stop == czm_infinity);\n}\n"});t("Shaders/Builtin/Functions/latitudeToWebMercatorFraction",[],function(){"use strict";return"float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)\n{\nfloat sinLatitude = sin(latitude);\nfloat mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\nreturn (mercatorY - southMercatorY) * oneOverMercatorHeight;\n}\n"});t("Shaders/Builtin/Functions/lineDistance",[],function(){"use strict";return"float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {\nreturn abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);\n}\n"});t("Shaders/Builtin/Functions/luminance",[],function(){"use strict";return"float czm_luminance(vec3 rgb)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nreturn dot(rgb, W);\n}\n"});t("Shaders/Builtin/Functions/metersPerPixel",[],function(){"use strict";return"float czm_metersPerPixel(vec4 positionEC)\n{\nfloat width = czm_viewport.z;\nfloat height = czm_viewport.w;\nfloat pixelWidth;\nfloat pixelHeight;\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nif (czm_sceneMode == czm_sceneMode2D || czm_orthographicIn3D == 1.0)\n{\nfloat frustumWidth = right - left;\nfloat frustumHeight = top - bottom;\npixelWidth = frustumWidth / width;\npixelHeight = frustumHeight / height;\n}\nelse\n{\nfloat distanceToPixel = -positionEC.z;\nfloat inverseNear = 1.0 / czm_currentFrustum.x;\nfloat tanTheta = top * inverseNear;\npixelHeight = 2.0 * distanceToPixel * tanTheta / height;\ntanTheta = right * inverseNear;\npixelWidth = 2.0 * distanceToPixel * tanTheta / width;\n}\nreturn max(pixelWidth, pixelHeight);\n}\n"});t("Shaders/Builtin/Functions/modelToWindowCoordinates",[],function(){"use strict";return"vec4 czm_modelToWindowCoordinates(vec4 position)\n{\nvec4 q = czm_modelViewProjection * position;\nq.xyz /= q.w;\nq.xyz = (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n"});t("Shaders/Builtin/Functions/multiplyWithColorBalance",[],function(){"use strict";return"vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 target = left * right;\nfloat leftLuminance = dot(left, W);\nfloat rightLuminance = dot(right, W);\nfloat targetLuminance = dot(target, W);\nreturn ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n"});t("Shaders/Builtin/Functions/nearFarScalar",[],function(){"use strict";return"float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)\n{\nfloat valueAtMin = nearFarScalar.y;\nfloat valueAtMax = nearFarScalar.w;\nfloat nearDistanceSq = nearFarScalar.x * nearFarScalar.x;\nfloat farDistanceSq = nearFarScalar.z * nearFarScalar.z;\nfloat t = (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);\nt = pow(clamp(t, 0.0, 1.0), 0.2);\nreturn mix(valueAtMin, valueAtMax, t);\n}\n"});t("Shaders/Builtin/Functions/octDecode",[],function(){"use strict";return"vec3 czm_octDecode(vec2 encoded, float range)\n{\nif (encoded.x == 0.0 && encoded.y == 0.0) {\nreturn vec3(0.0, 0.0, 0.0);\n}\nencoded = encoded / range * 2.0 - 1.0;\nvec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\nif (v.z < 0.0)\n{\nv.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n}\nreturn normalize(v);\n}\nvec3 czm_octDecode(vec2 encoded)\n{\nreturn czm_octDecode(encoded, 255.0);\n}\nvec3 czm_octDecode(float encoded)\n{\nfloat temp = encoded / 256.0;\nfloat x = floor(temp);\nfloat y = (temp - x) * 256.0;\nreturn czm_octDecode(vec2(x, y));\n}\nvoid czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)\n{\nfloat temp = encoded.x / 65536.0;\nfloat x = floor(temp);\nfloat encodedFloat1 = (temp - x) * 65536.0;\ntemp = encoded.y / 65536.0;\nfloat y = floor(temp);\nfloat encodedFloat2 = (temp - y) * 65536.0;\nvector1 = czm_octDecode(encodedFloat1);\nvector2 = czm_octDecode(encodedFloat2);\nvector3 = czm_octDecode(vec2(x, y));\n}\n"});t("Shaders/Builtin/Functions/packDepth",[],function(){"use strict";return"vec4 czm_packDepth(float depth)\n{\nvec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn enc;\n}\n"});t("Shaders/Builtin/Functions/phong",[],function(){"use strict";return"float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\nreturn czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\nreturn czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n}\nfloat specular = czm_private_getSpecularOfMaterial(czm_sunDirectionEC, toEye, material) + czm_private_getSpecularOfMaterial(czm_moonDirectionEC, toEye, material);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse;\ncolor += material.specular * specular;\nreturn vec4(color, material.alpha);\n}\nvec4 czm_private_phong(vec3 toEye, czm_material material)\n{\nfloat diffuse = czm_private_getLambertDiffuseOfMaterial(czm_sunDirectionEC, material);\nfloat specular = czm_private_getSpecularOfMaterial(czm_sunDirectionEC, toEye, material);\nvec3 ambient = vec3(0.0);\nvec3 color = ambient + material.emission;\ncolor += material.diffuse * diffuse;\ncolor += material.specular * specular;\nreturn vec4(color, material.alpha);\n}\n"});t("Shaders/Builtin/Functions/planeDistance",[],function(){"use strict";return"float czm_planeDistance(vec4 plane, vec3 point) {\nreturn (dot(plane.xyz, point) + plane.w);\n}\nfloat czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {\nreturn (dot(planeNormal, point) + planeDistance);\n}\n"});t("Shaders/Builtin/Functions/pointAlongRay",[],function(){"use strict";return"vec3 czm_pointAlongRay(czm_ray ray, float time)\n{\nreturn ray.origin + (time * ray.direction);\n}\n"});t("Shaders/Builtin/Functions/rayEllipsoidIntersectionInterval",[],function(){"use strict";return"czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, czm_ellipsoid ellipsoid)\n{\nvec3 q = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\nvec3 w = ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\nq = q - ellipsoid.inverseRadii * (czm_inverseModelView * vec4(ellipsoid.center, 1.0)).xyz;\nfloat q2 = dot(q, q);\nfloat qw = dot(q, w);\nif (q2 > 1.0)\n{\nif (qw >= 0.0)\n{\nreturn czm_emptyRaySegment;\n}\nelse\n{\nfloat qw2 = qw * qw;\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nif (qw2 < product)\n{\nreturn czm_emptyRaySegment;\n}\nelse if (qw2 > product)\n{\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nfloat root0 = temp / w2;\nfloat root1 = difference / temp;\nif (root0 < root1)\n{\nczm_raySegment i = czm_raySegment(root0, root1);\nreturn i;\n}\nelse\n{\nczm_raySegment i = czm_raySegment(root1, root0);\nreturn i;\n}\n}\nelse\n{\nfloat root = sqrt(difference / w2);\nczm_raySegment i = czm_raySegment(root, root);\nreturn i;\n}\n}\n}\nelse if (q2 < 1.0)\n{\nfloat difference = q2 - 1.0;\nfloat w2 = dot(w, w);\nfloat product = w2 * difference;\nfloat discriminant = qw * qw - product;\nfloat temp = -qw + sqrt(discriminant);\nczm_raySegment i = czm_raySegment(0.0, temp / w2);\nreturn i;\n}\nelse\n{\nif (qw < 0.0)\n{\nfloat w2 = dot(w, w);\nczm_raySegment i = czm_raySegment(0.0, -qw / w2);\nreturn i;\n}\nelse\n{\nreturn czm_emptyRaySegment;\n}\n}\n}\n"});t("Shaders/Builtin/Functions/readDepth",[],function(){"use strict";return"float czm_readDepth(sampler2D depthTexture, vec2 texCoords)\n{\nreturn czm_reverseLogDepth(texture2D(depthTexture, texCoords).r);\n}\n"});t("Shaders/Builtin/Functions/reverseLogDepth",[],function(){"use strict";return"float czm_reverseLogDepth(float logZ)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nlogZ = pow(2.0, logZ * czm_log2FarPlusOne) - 1.0;\nlogZ = far * (1.0 - near / logZ) / (far - near);\n#endif\nreturn logZ;\n}\n"});t("Shaders/Builtin/Functions/RGBToHSB",[],function(){"use strict";return"const vec4 K_RGB2HSB = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec3 czm_RGBToHSB(vec3 rgb)\n{\nvec4 p = mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));\nvec4 q = mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\nfloat d = q.x - min(q.w, q.y);\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);\n}\n"});t("Shaders/Builtin/Functions/RGBToHSL",[],function(){"use strict";return"vec3 RGBtoHCV(vec3 rgb)\n{\nvec4 p = (rgb.g < rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);\nvec4 q = (rgb.r < p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);\nfloat c = q.x - min(q.w, q.y);\nfloat h = abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);\nreturn vec3(h, c, q.x);\n}\nvec3 czm_RGBToHSL(vec3 rgb)\n{\nvec3 hcv = RGBtoHCV(rgb);\nfloat l = hcv.z - hcv.y * 0.5;\nfloat s = hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);\nreturn vec3(hcv.x, s, l);\n}\n"});t("Shaders/Builtin/Functions/RGBToXYZ",[],function(){"use strict";return"vec3 czm_RGBToXYZ(vec3 rgb)\n{\nconst mat3 RGB2XYZ = mat3(0.4124, 0.2126, 0.0193,\n0.3576, 0.7152, 0.1192,\n0.1805, 0.0722, 0.9505);\nvec3 xyz = RGB2XYZ * rgb;\nvec3 Yxy;\nYxy.r = xyz.g;\nfloat temp = dot(vec3(1.0), xyz);\nYxy.gb = xyz.rg / temp;\nreturn Yxy;\n}\n"});t("Shaders/Builtin/Functions/saturation",[],function(){"use strict";return"vec3 czm_saturation(vec3 rgb, float adjustment)\n{\nconst vec3 W = vec3(0.2125, 0.7154, 0.0721);\nvec3 intensity = vec3(dot(rgb, W));\nreturn mix(intensity, rgb, adjustment);\n}\n"});t("Shaders/Builtin/Functions/shadowDepthCompare",[],function(){"use strict";return"float czm_sampleShadowMap(samplerCube shadowMap, vec3 d)\n{\nreturn czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat czm_sampleShadowMap(sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\nreturn texture2D(shadowMap, uv).r;\n#else\nreturn czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\nfloat czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n"});t("Shaders/Builtin/Functions/shadowVisibility",[],function(){"use strict";return"float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)\n{\n#ifdef USE_NORMAL_SHADING\n#ifdef USE_NORMAL_SHADING_SMOOTH\nfloat strength = clamp(nDotL / normalShadingSmooth, 0.0, 1.0);\n#else\nfloat strength = step(0.0, nDotL);\n#endif\nvisibility *= strength;\n#endif\nvisibility = max(visibility, darkness);\nreturn visibility;\n}\n#ifdef USE_CUBE_MAP_SHADOW\nfloat czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec3 uvw = shadowParameters.texCoords;\ndepth -= depthBias;\nfloat visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#else\nfloat czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias = shadowParameters.depthBias;\nfloat depth = shadowParameters.depth;\nfloat nDotL = shadowParameters.nDotL;\nfloat normalShadingSmooth = shadowParameters.normalShadingSmooth;\nfloat darkness = shadowParameters.darkness;\nvec2 uv = shadowParameters.texCoords;\ndepth -= depthBias;\n#ifdef USE_SOFT_SHADOWS\nvec2 texelStepSize = shadowParameters.texelStepSize;\nfloat radius = 1.0;\nfloat dx0 = -texelStepSize.x * radius;\nfloat dy0 = -texelStepSize.y * radius;\nfloat dx1 = texelStepSize.x * radius;\nfloat dy1 = texelStepSize.y * radius;\nfloat visibility = (\nczm_shadowDepthCompare(shadowMap, uv, depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n) * (1.0 / 9.0);\n#else\nfloat visibility = czm_shadowDepthCompare(shadowMap, uv, depth);\n#endif\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#endif\n"});t("Shaders/Builtin/Functions/signNotZero",[],function(){"use strict";return"float czm_signNotZero(float value)\n{\nreturn value >= 0.0 ? 1.0 : -1.0;\n}\nvec2 czm_signNotZero(vec2 value)\n{\nreturn vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n}\nvec3 czm_signNotZero(vec3 value)\n{\nreturn vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));\n}\nvec4 czm_signNotZero(vec4 value)\n{\nreturn vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));\n}\n"});t("Shaders/Builtin/Functions/tangentToEyeSpaceMatrix",[],function(){"use strict";return"mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)\n{\nvec3 normal = normalize(normalEC);\nvec3 tangent = normalize(tangentEC);\nvec3 bitangent = normalize(bitangentEC);\nreturn mat3(tangent.x  , tangent.y  , tangent.z,\nbitangent.x, bitangent.y, bitangent.z,\nnormal.x   , normal.y   , normal.z);\n}\n"});t("Shaders/Builtin/Functions/transformPlane",[],function(){"use strict";return"vec4 czm_transformPlane(vec4 clippingPlane, mat4 transform) {\nvec3 transformedDirection = normalize((transform * vec4(clippingPlane.xyz, 0.0)).xyz);\nvec3 transformedPosition = (transform * vec4(clippingPlane.xyz * -clippingPlane.w, 1.0)).xyz;\nvec4 transformedPlane;\ntransformedPlane.xyz = transformedDirection;\ntransformedPlane.w = -dot(transformedDirection, transformedPosition);\nreturn transformedPlane;\n}\n"});t("Shaders/Builtin/Functions/translateRelativeToEye",[],function(){"use strict";return"vec4 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\nvec3 highDifference = high - czm_encodedCameraPositionMCHigh;\nvec3 lowDifference = low - czm_encodedCameraPositionMCLow;\nreturn vec4(highDifference + lowDifference, 1.0);\n}\n"});t("Shaders/Builtin/Functions/translucentPhong",[],function(){"use strict";return"vec4 czm_translucentPhong(vec3 toEye, czm_material material)\n{\nfloat diffuse = czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\nif (czm_sceneMode == czm_sceneMode3D) {\ndiffuse += czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n}\ndiffuse = clamp(diffuse, 0.0, 1.0);\nfloat specular = czm_getSpecular(czm_sunDirectionEC, toEye, material.normal, material.shininess);\nspecular += czm_getSpecular(czm_moonDirectionEC, toEye, material.normal, material.shininess);\nvec3 materialDiffuse = material.diffuse * 0.5;\nvec3 ambient = materialDiffuse;\nvec3 color = ambient + material.emission;\ncolor += materialDiffuse * diffuse;\ncolor += material.specular * specular;\nreturn vec4(color, material.alpha);\n}\n"});t("Shaders/Builtin/Functions/transpose",[],function(){"use strict";return"mat2 czm_transpose(mat2 matrix)\n{\nreturn mat2(\nmatrix[0][0], matrix[1][0],\nmatrix[0][1], matrix[1][1]);\n}\nmat3 czm_transpose(mat3 matrix)\n{\nreturn mat3(\nmatrix[0][0], matrix[1][0], matrix[2][0],\nmatrix[0][1], matrix[1][1], matrix[2][1],\nmatrix[0][2], matrix[1][2], matrix[2][2]);\n}\nmat4 czm_transpose(mat4 matrix)\n{\nreturn mat4(\nmatrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\nmatrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\nmatrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\nmatrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n"});t("Shaders/Builtin/Functions/unpackDepth",[],function(){"use strict";return"float czm_unpackDepth(vec4 packedDepth)\n{\nreturn dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\n"});t("Shaders/Builtin/Functions/unpackFloat",[],function(){"use strict";return"#define SHIFT_RIGHT_8 0.00390625 //1.0 / 256.0\n#define SHIFT_RIGHT_16 0.00001525878 //1.0 / 65536.0\n#define SHIFT_RIGHT_24 5.960464477539063e-8//1.0 / 16777216.0\n#define BIAS 38.0\nfloat czm_unpackFloat(vec4 packedFloat)\n{\npackedFloat *= 255.0;\nfloat temp = packedFloat.w / 2.0;\nfloat exponent = floor(temp);\nfloat sign = (temp - exponent) * 2.0;\nexponent = exponent - float(BIAS);\nsign = sign * 2.0 - 1.0;\nsign = -sign;\nfloat unpacked = sign * packedFloat.x * float(SHIFT_RIGHT_8);\nunpacked += sign * packedFloat.y * float(SHIFT_RIGHT_16);\nunpacked += sign * packedFloat.z * float(SHIFT_RIGHT_24);\nreturn unpacked * pow(10.0, exponent);\n}\n"});t("Shaders/Builtin/Functions/vertexLogDepth",[],function(){"use strict";return"#ifdef LOG_DEPTH\nvarying float v_logZ;\n#ifdef SHADOW_MAP\nvarying vec3 v_logPositionEC;\n#endif\n#endif\nvoid czm_updatePositionDepth() {\n#if defined(LOG_DEPTH) && !defined(DISABLE_GL_POSITION_LOG_DEPTH)\nvec3 logPositionEC = (czm_inverseProjection * gl_Position).xyz;\n#ifdef SHADOW_MAP\nv_logPositionEC = logPositionEC;\n#endif\n#ifdef ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT\nif (length(logPositionEC) < 2.0e6)\n{\nreturn;\n}\n#endif\ngl_Position.z = log2(max(1e-6, 1.0 + gl_Position.w)) * czm_log2FarDistance - 1.0;\ngl_Position.z *= gl_Position.w;\n#endif\n}\nvoid czm_vertexLogDepth()\n{\n#ifdef LOG_DEPTH\nv_logZ = 1.0 + gl_Position.w;\nczm_updatePositionDepth();\n#endif\n}\nvoid czm_vertexLogDepth(vec4 clipCoords)\n{\n#ifdef LOG_DEPTH\nv_logZ = 1.0 + clipCoords.w;\nczm_updatePositionDepth();\n#endif\n}\n"});t("Shaders/Builtin/Functions/windowToEyeCoordinates",[],function(){"use strict";return"vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\nfloat x = 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\nfloat y = 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\nfloat z = (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nvec4 q = vec4(x, y, z, 1.0);\nq /= fragmentCoordinate.w;\nif (!(czm_inverseProjection == mat4(0.0)))\n{\nq = czm_inverseProjection * q;\n}\nelse\n{\nfloat top = czm_frustumPlanes.x;\nfloat bottom = czm_frustumPlanes.y;\nfloat left = czm_frustumPlanes.z;\nfloat right = czm_frustumPlanes.w;\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nq.x = (q.x * (right - left) + left + right) * 0.5;\nq.y = (q.y * (top - bottom) + bottom + top) * 0.5;\nq.z = (q.z * (near - far) - near - far) * 0.5;\nq.w = 1.0;\n}\nreturn q;\n}\nvec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)\n{\n#ifdef LOG_DEPTH\nfloat near = czm_currentFrustum.x;\nfloat far = czm_currentFrustum.y;\nfloat unscaledDepth = pow(2.0, depthOrLogDepth * czm_log2FarPlusOne) - 1.0;\nvec4 windowCoord = vec4(fragmentCoordinateXY, far * (1.0 - near / unscaledDepth) / (far - near), 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\neyeCoordinate.w = 1.0 / unscaledDepth;\n#else\nvec4 windowCoord = vec4(fragmentCoordinateXY, depthOrLogDepth, 1.0);\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;\n}\n"});t("Shaders/Builtin/Functions/writeDepthClampedToFarPlane",[],function(){"use strict";return"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvoid czm_writeDepthClampedToFarPlane()\n{\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\ngl_FragDepthEXT = min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n"});t("Shaders/Builtin/Functions/writeLogDepth",[],function(){"use strict";return"#ifdef LOG_DEPTH\nvarying float v_logZ;\n#endif\nvoid czm_writeLogDepth(float logZ)\n{\n#if defined(GL_EXT_frag_depth) && defined(LOG_DEPTH) && !defined(DISABLE_LOG_DEPTH_FRAGMENT_WRITE)\nfloat halfLogFarDistance = czm_log2FarDistance * 0.5;\nfloat depth = log2(logZ);\nif (depth < czm_log2NearDistance) {\ndiscard;\n}\ngl_FragDepthEXT = depth * halfLogFarDistance;\n#endif\n}\nvoid czm_writeLogDepth() {\n#ifdef LOG_DEPTH\nczm_writeLogDepth(v_logZ);\n#endif\n}\n"});t("Shaders/Builtin/Functions/XYZToRGB",[],function(){"use strict";return"vec3 czm_XYZToRGB(vec3 Yxy)\n{\nconst mat3 XYZ2RGB = mat3( 3.2405, -0.9693,  0.0556,\n-1.5371,  1.8760, -0.2040,\n-0.4985,  0.0416,  1.0572);\nvec3 xyz;\nxyz.r = Yxy.r * Yxy.g / Yxy.b;\nxyz.g = Yxy.r;\nxyz.b = Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;\nreturn XYZ2RGB * xyz;\n}\n"});t("Shaders/Builtin/CzmBuiltins",["./Constants/degreesPerRadian","./Constants/depthRange","./Constants/epsilon1","./Constants/epsilon2","./Constants/epsilon3","./Constants/epsilon4","./Constants/epsilon5","./Constants/epsilon6","./Constants/epsilon7","./Constants/infinity","./Constants/oneOverPi","./Constants/oneOverTwoPi","./Constants/passCesium3DTile","./Constants/passCesium3DTileClassification","./Constants/passCesium3DTileClassificationIgnoreShow","./Constants/passClassification","./Constants/passCompute","./Constants/passEnvironment","./Constants/passGlobe","./Constants/passOpaque","./Constants/passOverlay","./Constants/passTerrainClassification","./Constants/passTranslucent","./Constants/pi","./Constants/piOverFour","./Constants/piOverSix","./Constants/piOverThree","./Constants/piOverTwo","./Constants/radiansPerDegree","./Constants/sceneMode2D","./Constants/sceneMode3D","./Constants/sceneModeColumbusView","./Constants/sceneModeMorphing","./Constants/solarRadius","./Constants/threePiOver2","./Constants/twoPi","./Constants/webMercatorMaxLatitude","./Structs/depthRangeStruct","./Structs/ellipsoid","./Structs/material","./Structs/materialInput","./Structs/ray","./Structs/raySegment","./Structs/shadowParameters","./Functions/alphaWeight","./Functions/antialias","./Functions/approximateSphericalCoordinates","./Functions/branchFreeTernary","./Functions/cascadeColor","./Functions/cascadeDistance","./Functions/cascadeMatrix","./Functions/cascadeWeights","./Functions/columbusViewMorph","./Functions/computePosition","./Functions/cosineAndSine","./Functions/decompressTextureCoordinates","./Functions/depthClampFarPlane","./Functions/eastNorthUpToEyeCoordinates","./Functions/ellipsoidContainsPoint","./Functions/ellipsoidNew","./Functions/ellipsoidWgs84TextureCoordinates","./Functions/equalsEpsilon","./Functions/eyeOffset","./Functions/eyeToWindowCoordinates","./Functions/fastApproximateAtan","./Functions/fog","./Functions/geodeticSurfaceNormal","./Functions/getDefaultMaterial","./Functions/getLambertDiffuse","./Functions/getSpecular","./Functions/getWaterNoise","./Functions/getWgs84EllipsoidEC","./Functions/HSBToRGB","./Functions/HSLToRGB","./Functions/hue","./Functions/isEmpty","./Functions/isFull","./Functions/latitudeToWebMercatorFraction","./Functions/lineDistance","./Functions/luminance","./Functions/metersPerPixel","./Functions/modelToWindowCoordinates","./Functions/multiplyWithColorBalance","./Functions/nearFarScalar","./Functions/octDecode","./Functions/packDepth","./Functions/phong","./Functions/planeDistance","./Functions/pointAlongRay","./Functions/rayEllipsoidIntersectionInterval","./Functions/readDepth","./Functions/reverseLogDepth","./Functions/RGBToHSB","./Functions/RGBToHSL","./Functions/RGBToXYZ","./Functions/saturation","./Functions/shadowDepthCompare","./Functions/shadowVisibility","./Functions/signNotZero","./Functions/tangentToEyeSpaceMatrix","./Functions/transformPlane","./Functions/translateRelativeToEye","./Functions/translucentPhong","./Functions/transpose","./Functions/unpackDepth","./Functions/unpackFloat","./Functions/vertexLogDepth","./Functions/windowToEyeCoordinates","./Functions/writeDepthClampedToFarPlane","./Functions/writeLogDepth","./Functions/XYZToRGB"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr,tr,ir,rr,ur,fr,er,or,sr,hr,cr,lr,ar,vr,yr,pr,wr,br,kr,dr,gr,nu,tu,iu,ru,uu,fu,eu,ou,su,hu,cu,lu,au,vu,yu,pu,wu,bu,ku,du,gu,nf,tf,rf,uf,ff,ef){"use strict";return{czm_degreesPerRadian:n,czm_depthRange:t,czm_epsilon1:i,czm_epsilon2:r,czm_epsilon3:u,czm_epsilon4:f,czm_epsilon5:e,czm_epsilon6:o,czm_epsilon7:s,czm_infinity:h,czm_oneOverPi:c,czm_oneOverTwoPi:l,czm_passCesium3DTile:a,czm_passCesium3DTileClassification:v,czm_passCesium3DTileClassificationIgnoreShow:y,czm_passClassification:p,czm_passCompute:w,czm_passEnvironment:b,czm_passGlobe:k,czm_passOpaque:d,czm_passOverlay:g,czm_passTerrainClassification:nt,czm_passTranslucent:tt,czm_pi:it,czm_piOverFour:rt,czm_piOverSix:ut,czm_piOverThree:ft,czm_piOverTwo:et,czm_radiansPerDegree:ot,czm_sceneMode2D:st,czm_sceneMode3D:ht,czm_sceneModeColumbusView:ct,czm_sceneModeMorphing:lt,czm_solarRadius:at,czm_threePiOver2:vt,czm_twoPi:yt,czm_webMercatorMaxLatitude:pt,czm_depthRangeStruct:wt,czm_ellipsoid:bt,czm_material:kt,czm_materialInput:dt,czm_ray:gt,czm_raySegment:ni,czm_shadowParameters:ti,czm_alphaWeight:ii,czm_antialias:ri,czm_approximateSphericalCoordinates:ui,czm_branchFreeTernary:fi,czm_cascadeColor:ei,czm_cascadeDistance:oi,czm_cascadeMatrix:si,czm_cascadeWeights:hi,czm_columbusViewMorph:ci,czm_computePosition:li,czm_cosineAndSine:ai,czm_decompressTextureCoordinates:vi,czm_depthClampFarPlane:yi,czm_eastNorthUpToEyeCoordinates:pi,czm_ellipsoidContainsPoint:wi,czm_ellipsoidNew:bi,czm_ellipsoidWgs84TextureCoordinates:ki,czm_equalsEpsilon:di,czm_eyeOffset:gi,czm_eyeToWindowCoordinates:nr,czm_fastApproximateAtan:tr,czm_fog:ir,czm_geodeticSurfaceNormal:rr,czm_getDefaultMaterial:ur,czm_getLambertDiffuse:fr,czm_getSpecular:er,czm_getWaterNoise:or,czm_getWgs84EllipsoidEC:sr,czm_HSBToRGB:hr,czm_HSLToRGB:cr,czm_hue:lr,czm_isEmpty:ar,czm_isFull:vr,czm_latitudeToWebMercatorFraction:yr,czm_lineDistance:pr,czm_luminance:wr,czm_metersPerPixel:br,czm_modelToWindowCoordinates:kr,czm_multiplyWithColorBalance:dr,czm_nearFarScalar:gr,czm_octDecode:nu,czm_packDepth:tu,czm_phong:iu,czm_planeDistance:ru,czm_pointAlongRay:uu,czm_rayEllipsoidIntersectionInterval:fu,czm_readDepth:eu,czm_reverseLogDepth:ou,czm_RGBToHSB:su,czm_RGBToHSL:hu,czm_RGBToXYZ:cu,czm_saturation:lu,czm_shadowDepthCompare:au,czm_shadowVisibility:vu,czm_signNotZero:yu,czm_tangentToEyeSpaceMatrix:pu,czm_transformPlane:wu,czm_translateRelativeToEye:bu,czm_translucentPhong:ku,czm_transpose:du,czm_unpackDepth:gu,czm_unpackFloat:nf,czm_vertexLogDepth:tf,czm_windowToEyeCoordinates:rf,czm_writeDepthClampedToFarPlane:uf,czm_writeLogDepth:ff,czm_XYZToRGB:ef}});t("Renderer/ShaderSource",["../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Renderer/modernizeShader","../Shaders/Builtin/CzmBuiltins","./AutomaticUniforms"],function(n,t,i,r,u,f){"use strict";function c(n){return n=n.replace(/\/\/.*/g,""),n.replace(/\/\*\*[\s\S]*?\*\//gm,function(n){for(var r=n.match(/\n/gm).length,t="",i=0;i<r;++i)t+="\n";return t})}function l(n,i,r){for(var u,f=0;f<r.length;++f)r[f].name===n&&(u=r[f]);return t(u)||(i=c(i),u={name:n,glslSource:i,dependsOn:[],requiredBy:[],evaluated:!1},r.push(u)),u}function a(n,i){if(!n.evaluated){n.evaluated=!0;var r=n.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);t(r)&&r!==null&&(r=r.filter(function(n,t){return r.indexOf(n)===t}),r.forEach(function(t){if(t!==n.name&&e._czmBuiltinsAndUniforms.hasOwnProperty(t)){var r=l(t,e._czmBuiltinsAndUniforms[t],i);n.dependsOn.push(r);r.requiredBy.push(n);a(r,i)}}))}}function w(n){for(var e=[],o=[],s,t,h,r,a,u,f,c,l;n.length>0;)s=n.pop(),o.push(s),s.requiredBy.length===0&&e.push(s);while(e.length>0)for(t=e.shift(),n.push(t),h=0;h<t.dependsOn.length;++h)r=t.dependsOn[h],a=r.requiredBy.indexOf(t),r.requiredBy.splice(a,1),r.requiredBy.length===0&&e.push(r);for(u=[],f=0;f<o.length;++f)o[f].requiredBy.length!==0&&u.push(o[f]);if(u.length!==0){for(c="A circular dependency was found in the following built-in functions/structs/constants: \n",l=0;l<u.length;++l)c=c+u[l].name+"\n";throw new i(c);}}function b(n){var t=[],u=l("main",n,t),i,r;for(a(u,t),w(t),i="",r=t.length-1;r>=0;--r)i=i+t[r].glslSource+"\n";return i.replace(u.glslSource,"")}function v(n,u,f){var s,a,o="",p=n.sources,l,v,w,h,d,y,k;if(t(p))for(s=0,a=p.length;s<a;++s)o+="\n#line 0\n"+p[s];for(o=c(o),o=o.replace(/#version\s+(.*?)\n/gm,function(n,r){if(t(l)&&l!==r)throw new i("inconsistent versions found: "+l+" and "+r);return l=r,"\n"}),v=[],o=o.replace(/#extension.*\n/gm,function(n){return v.push(n),"\n"}),o=o.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,""),w=n.pickColorQualifier,t(w)&&(o=e.createPickFragmentShaderSource(o,w)),h="",t(l)&&(h="#version "+l+"\n"),d=v.length,s=0;s<d;s++)h+=v[s];if(u&&(h+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n#endif\n\n"),y=n.defines,t(y))for(s=0,a=y.length;s<a;++s)k=y[s],k.length!==0&&(h+="#define "+k+"\n");return f.webgl2&&(h+="#define OUTPUT_DECLARATION\n\n"),n.includeBuiltIns&&(h+=b(o)),h+="\n#line 0\n",h+=o,f.webgl2&&(h=r(h,u,!0)),h}function e(r){r=n(r,n.EMPTY_OBJECT);var u=r.pickColorQualifier;if(t(u)&&u!=="uniform"&&u!=="varying")throw new i("options.pickColorQualifier must be 'uniform' or 'varying'.");this.defines=t(r.defines)?r.defines.slice(0):[];this.sources=t(r.sources)?r.sources.slice(0):[];this.pickColorQualifier=u;this.includeBuiltIns=n(r.includeBuiltIns,!0)}var s,o,h,y,p;e.prototype.clone=function(){return new e({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})};e.replaceMain=function(n,t){return t="void "+t+"()",n.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,t)};e.prototype.createCombinedVertexShader=function(n){return v(this,!1,n)};e.prototype.createCombinedFragmentShader=function(n){return v(this,!0,n)};e._czmBuiltinsAndUniforms={};for(s in u)u.hasOwnProperty(s)&&(e._czmBuiltinsAndUniforms[s]=u[s]);for(o in f)f.hasOwnProperty(o)&&(h=f[o],typeof h.getDeclaration=="function"&&(e._czmBuiltinsAndUniforms[o]=h.getDeclaration(o)));return e.createPickVertexShaderSource=function(n){var t=e.replaceMain(n,"czm_old_main");return t+"\nattribute vec4 pickColor; \nvarying vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    czm_pickColor = pickColor; \n}"},e.createPickFragmentShaderSource=function(n,t){var i=e.replaceMain(n,"czm_old_main"),r=t+" vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a == 0.0) { \n       discard; \n    } \n    gl_FragColor = czm_pickColor; \n}";return i+"\n"+r},e.findVarying=function(n,t){for(var u,e,i,f=n.sources,o=t.length,r=0;r<o;++r)for(u=t[r],e=f.length,i=0;i<e;++i)if(f[i].indexOf(u)!==-1)return u;return undefined},y=["v_normalEC","v_normal"],e.findNormalVarying=function(n){return e.findVarying(n,y)},p=["v_positionEC"],e.findPositionVarying=function(n){return e.findVarying(n,p)},e});t("Shaders/ShadowVolumeFS",[],function(){"use strict";return"#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvoid main(void)\n{\n#ifdef VECTOR_TILE\ngl_FragColor = u_highlightColor;\n#else\ngl_FragColor = vec4(1.0);\n#endif\nczm_writeDepthClampedToFarPlane();\n}\n"});t("Shaders/ShadowVolumeAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute float batchId;\n#ifdef EXTRUDED_GEOMETRY\nattribute vec3 extrudeDirection;\nuniform float u_globeMinimumAltitude;\n#endif // EXTRUDED_GEOMETRY\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif // PER_INSTANCE_COLOR\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else // SPHERICAL\nvarying vec2 v_inversePlaneExtents;\nvarying vec4 v_westPlane;\nvarying vec4 v_southPlane;\n#endif // SPHERICAL\nvarying vec3 v_uvMinAndSphericalLongitudeRotation;\nvarying vec3 v_uMaxAndInverseDistance;\nvarying vec3 v_vMaxAndInverseDistance;\n#endif // TEXTURE_COORDINATES\nvoid main()\n{\nvec4 position = czm_computePosition();\n#ifdef EXTRUDED_GEOMETRY\nfloat delta = min(u_globeMinimumAltitude, czm_geometricToleranceOverMeter * length(position.xyz));\ndelta *= czm_sceneMode == czm_sceneMode3D ? 1.0 : 0.0;\nposition = position + vec4(extrudeDirection * delta, 0.0);\n#endif\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nv_sphericalExtents = czm_batchTable_sphericalExtents(batchId);\nv_uvMinAndSphericalLongitudeRotation.z = czm_batchTable_longitudeRotation(batchId);\n#else // SPHERICAL\n#ifdef COLUMBUS_VIEW_2D\nvec4 planes2D_high = czm_batchTable_planes2D_HIGH(batchId);\nvec4 planes2D_low = czm_batchTable_planes2D_LOW(batchId);\nvec2 idlSplitNewPlaneHiLow = vec2(EAST_MOST_X_HIGH - (WEST_MOST_X_HIGH - planes2D_high.w), EAST_MOST_X_LOW - (WEST_MOST_X_LOW - planes2D_low.w));\nbool idlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y > 0.0;\nplanes2D_high.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.w);\nplanes2D_low.w = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.w);\nidlSplit = planes2D_high.x > planes2D_high.w && position3DLow.y < 0.0;\nidlSplitNewPlaneHiLow = vec2(WEST_MOST_X_HIGH - (EAST_MOST_X_HIGH - planes2D_high.x), WEST_MOST_X_LOW - (EAST_MOST_X_LOW - planes2D_low.x));\nplanes2D_high.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.x);\nplanes2D_low.x = czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.x);\nvec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.xy), vec3(0.0, planes2D_low.xy))).xyz;\nvec3 northWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.x, planes2D_high.z), vec3(0.0, planes2D_low.x, planes2D_low.z))).xyz;\nvec3 southEastCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.w, planes2D_high.y), vec3(0.0, planes2D_low.w, planes2D_low.y))).xyz;\n#else // COLUMBUS_VIEW_2D\nvec3 southWestCorner = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(czm_batchTable_southWest_HIGH(batchId), czm_batchTable_southWest_LOW(batchId))).xyz;\nvec3 northWestCorner = czm_normal * czm_batchTable_northward(batchId) + southWestCorner;\nvec3 southEastCorner = czm_normal * czm_batchTable_eastward(batchId) + southWestCorner;\n#endif // COLUMBUS_VIEW_2D\nvec3 eastWard = southEastCorner - southWestCorner;\nfloat eastExtent = length(eastWard);\neastWard /= eastExtent;\nvec3 northWard = northWestCorner - southWestCorner;\nfloat northExtent = length(northWard);\nnorthWard /= northExtent;\nv_westPlane = vec4(eastWard, -dot(eastWard, southWestCorner));\nv_southPlane = vec4(northWard, -dot(northWard, southWestCorner));\nv_inversePlaneExtents = vec2(1.0 / eastExtent, 1.0 / northExtent);\n#endif // SPHERICAL\nvec4 uvMinAndExtents = czm_batchTable_uvMinAndExtents(batchId);\nvec4 uMaxVmax = czm_batchTable_uMaxVmax(batchId);\nv_uMaxAndInverseDistance = vec3(uMaxVmax.xy, uvMinAndExtents.z);\nv_vMaxAndInverseDistance = vec3(uMaxVmax.zw, uvMinAndExtents.w);\nv_uvMinAndSphericalLongitudeRotation.xy = uvMinAndExtents.xy;\n#endif // TEXTURE_COORDINATES\n#ifdef PER_INSTANCE_COLOR\nv_color = czm_batchTable_color(batchId);\n#endif\ngl_Position = czm_depthClampFarPlane(czm_modelViewProjectionRelativeToEye * position);\n}\n"});t("Scene/DepthFunction",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={NEVER:t.NEVER,LESS:t.LESS,EQUAL:t.EQUAL,LESS_OR_EQUAL:t.LEQUAL,GREATER:t.GREATER,NOT_EQUAL:t.NOTEQUAL,GREATER_OR_EQUAL:t.GEQUAL,ALWAYS:t.ALWAYS};return n(i)});t("Renderer/BufferUsage",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={STREAM_DRAW:t.STREAM_DRAW,STATIC_DRAW:t.STATIC_DRAW,DYNAMIC_DRAW:t.DYNAMIC_DRAW,validate:function(n){return n===i.STREAM_DRAW||n===i.STATIC_DRAW||n===i.DYNAMIC_DRAW}};return n(i)});t("Renderer/Buffer",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/IndexDatatype","../Core/WebGLConstants","./BufferUsage"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(r){var c;if(r=t(r,t.EMPTY_OBJECT),n.defined("options.context",r.context),!i(r.typedArray)&&!i(r.sizeInBytes))throw new f("Either options.sizeInBytes or options.typedArray is required.");if(i(r.typedArray)&&i(r.sizeInBytes))throw new f("Cannot pass in both options.sizeInBytes and options.typedArray.");if(i(r.typedArray)&&(n.typeOf.object("options.typedArray",r.typedArray),n.typeOf.number("options.typedArray.byteLength",r.typedArray.byteLength)),!s.validate(r.usage))throw new f("usage is invalid.");var u=r.context._gl,e=r.bufferTarget,h=r.typedArray,o=r.sizeInBytes,l=r.usage,a=i(h);a&&(o=h.byteLength);n.typeOf.number.greaterThan("sizeInBytes",o,0);c=u.createBuffer();u.bindBuffer(e,c);u.bufferData(e,a?h:o,l);u.bindBuffer(e,null);this._gl=u;this._webgl2=r.context._webgl2;this._bufferTarget=e;this._sizeInBytes=o;this._usage=l;this._buffer=c;this.vertexArrayDestroyable=!0}return h.createVertexBuffer=function(t){return n.defined("options.context",t.context),new h({context:t.context,bufferTarget:o.ARRAY_BUFFER,typedArray:t.typedArray,sizeInBytes:t.sizeInBytes,usage:t.usage})},h.createIndexBuffer=function(t){if(n.defined("options.context",t.context),!e.validate(t.indexDatatype))throw new f("Invalid indexDatatype.");if(t.indexDatatype===e.UNSIGNED_INT&&!t.context.elementIndexUint)throw new f("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var c=t.context,u=t.indexDatatype,s=e.getSizeInBytes(u),i=new h({context:c,bufferTarget:o.ELEMENT_ARRAY_BUFFER,typedArray:t.typedArray,sizeInBytes:t.sizeInBytes,usage:t.usage}),l=i.sizeInBytes/s;return r(i,{indexDatatype:{get:function(){return u}},bytesPerIndex:{get:function(){return s}},numberOfIndices:{get:function(){return l}}}),i},r(h.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),h.prototype._getBuffer=function(){return this._buffer},h.prototype.copyFromArrayView=function(i,r){r=t(r,0);n.defined("arrayView",i);n.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",r+i.byteLength,this._sizeInBytes);var u=this._gl,f=this._bufferTarget;u.bindBuffer(f,this._buffer);u.bufferSubData(f,r,i);u.bindBuffer(f,null)},h.prototype.copyFromBuffer=function(n,t,r,u){if(!this._webgl2)throw new f("A WebGL 2 context is required.");if(!i(n))throw new f("readBuffer must be defined.");if(!i(u)||u<=0)throw new f("sizeInBytes must be defined and be greater than zero.");if(!i(t)||t<0||t+u>n._sizeInBytes)throw new f("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!i(r)||r<0||r+u>this._sizeInBytes)throw new f("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===n._buffer&&(r>=t&&r<t+u||t>r&&t<r+u))throw new f("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===o.ELEMENT_ARRAY_BUFFER&&n._bufferTarget!==o.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==o.ELEMENT_ARRAY_BUFFER&&n._bufferTarget===o.ELEMENT_ARRAY_BUFFER)throw new f("Can not copy an index buffer into another buffer type.");var s=o.COPY_READ_BUFFER,h=o.COPY_WRITE_BUFFER,e=this._gl;e.bindBuffer(h,this._buffer);e.bindBuffer(s,n._buffer);e.copyBufferSubData(s,h,t,r,u);e.bindBuffer(h,null);e.bindBuffer(s,null)},h.prototype.getBufferData=function(n,r,u,e){var h,c,s,l,a;if(r=t(r,0),u=t(u,0),!this._webgl2)throw new f("A WebGL 2 context is required.");if(!i(n))throw new f("arrayView is required.");if(s=n.byteLength,i(e)?(h=e,i(s)?c=1:(s=n.length,c=n.BYTES_PER_ELEMENT)):i(s)?(h=s-u,c=1):(s=n.length,h=s-u,c=n.BYTES_PER_ELEMENT),u<0||u>s)throw new f("destinationOffset must be greater than zero and less than the arrayView length.");if(u+h>s)throw new f("destinationOffset + length must be less than or equal to the arrayViewLength.");if(r<0||r>this._sizeInBytes)throw new f("sourceOffset must be greater than zero and less than the buffers size.");if(r+h*c>this._sizeInBytes)throw new f("sourceOffset + length must be less than the buffers size.");l=this._gl;a=o.COPY_READ_BUFFER;l.bindBuffer(a,this._buffer);l.getBufferSubData(a,r,n,u,e);l.bindBuffer(a,null)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),u(this)},h});t("Renderer/VertexArray",["../Core/Check","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Geometry","../Core/IndexDatatype","../Core/Math","../Core/RuntimeError","./Buffer","./BufferUsage","./ContextLimits"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function b(n,u,f,o){var l=r(u.vertexBuffer),h=r(u.value),c=u.value?u.value.length:u.componentsPerAttribute,s;if(!l&&!h)throw new e("attribute must have a vertexBuffer or a value.");if(l&&h)throw new e("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");if(c!==1&&c!==2&&c!==3&&c!==4){if(h)throw new e("attribute.value.length must be in the range [1, 4].");throw new e("attribute.componentsPerAttribute must be in the range [1, 4].");}if(r(u.componentDatatype)&&!t.validate(u.componentDatatype))throw new e("attribute must have a valid componentDatatype or not specify it.");if(r(u.strideInBytes)&&u.strideInBytes>255)throw new e("attribute must have a strideInBytes less than or equal to 255 or not specify it.");if(r(u.instanceDivisor)&&u.instanceDivisor>0&&!o.instancedArrays)throw new e("instanced arrays is not supported");if(r(u.instanceDivisor)&&u.instanceDivisor<0)throw new e("attribute must have an instanceDivisor greater than or equal to zero");if(r(u.instanceDivisor)&&h)throw new e("attribute cannot have have an instanceDivisor if it is not backed by a buffer");if(r(u.instanceDivisor)&&u.instanceDivisor>0&&u.index===0)throw new e("attribute zero cannot have an instanceDivisor greater than 0");if(s={index:i(u.index,f),enabled:i(u.enabled,!0),vertexBuffer:u.vertexBuffer,value:h?u.value.slice(0):undefined,componentsPerAttribute:c,componentDatatype:i(u.componentDatatype,t.FLOAT),normalize:i(u.normalize,!1),offsetInBytes:i(u.offsetInBytes,0),strideInBytes:i(u.strideInBytes,0),instanceDivisor:i(u.instanceDivisor,0)},l)s.vertexAttrib=function(n){var t=this.index;n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer._getBuffer());n.vertexAttribPointer(t,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes);n.enableVertexAttribArray(t);this.instanceDivisor>0&&(o.glVertexAttribDivisor(t,this.instanceDivisor),o._vertexAttribDivisors[t]=this.instanceDivisor,o._previousDrawInstanced=!0)},s.disableVertexAttribArray=function(n){n.disableVertexAttribArray(this.index);this.instanceDivisor>0&&o.glVertexAttribDivisor(f,0)};else{switch(s.componentsPerAttribute){case 1:s.vertexAttrib=function(n){n.vertexAttrib1fv(this.index,this.value)};break;case 2:s.vertexAttrib=function(n){n.vertexAttrib2fv(this.index,this.value)};break;case 3:s.vertexAttrib=function(n){n.vertexAttrib3fv(this.index,this.value)};break;case 4:s.vertexAttrib=function(n){n.vertexAttrib4fv(this.index,this.value)}}s.disableVertexAttribArray=function(){}}n.push(s)}function p(n,t,i){for(var f,u=0;u<t.length;++u)f=t[u],f.enabled&&f.vertexAttrib(n);r(i)&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i._getBuffer())}function y(u){var h,tt,a,l,v;u=i(u,i.EMPTY_OBJECT);n.defined("options.context",u.context);n.defined("options.attributes",u.attributes);for(var s=u.context,y=s._gl,w=u.attributes,k=u.indexBuffer,o=[],d=1,g=!1,nt=!1,c=w.length,f=0;f<c;++f)b(o,w[f],f,s);for(c=o.length,f=0;f<c;++f)if(h=o[f],r(h.vertexBuffer)&&h.instanceDivisor===0){tt=h.strideInBytes||h.componentsPerAttribute*t.getSizeInBytes(h.componentDatatype);d=h.vertexBuffer.sizeInBytes/tt;break}for(f=0;f<c;++f)o[f].instanceDivisor>0&&(g=!0),r(o[f].value)&&(nt=!0);for(a={},f=0;f<c;++f){if(l=o[f].index,a[l])throw new e("Index "+l+" is used by more than one attribute.");a[l]=!0}s.vertexArrayObject&&(v=s.glCreateVertexArray(),s.glBindVertexArray(v),p(y,o,k),s.glBindVertexArray(null));this._numberOfVertices=d;this._hasInstancedAttributes=g;this._hasConstantAttributes=nt;this._context=s;this._gl=y;this._vao=v;this._attributes=o;this._indexBuffer=k}function w(n){return n.values.length/n.componentsPerAttribute}function k(n){return t.getSizeInBytes(n.componentDatatype)*n.componentsPerAttribute}function d(n){var u,i,s,f=[],h,o,p,e,a,b,d,g,v,l;for(i in n)n.hasOwnProperty(i)&&r(n[i])&&r(n[i].values)&&(f.push(i),n[i].componentDatatype===t.DOUBLE&&(n[i].componentDatatype=t.FLOAT,n[i].values=t.createTypedArray(t.FLOAT,n[i].values)));if(o=f.length,o>0)for(h=w(n[f[0]]),u=1;u<o;++u)if(p=w(n[f[u]]),p!==h)throw new c("Each attribute list must have the same number of vertices.  Attribute "+f[u]+" has a different number of vertices ("+p.toString()+") than attribute "+f[0]+" ("+h.toString()+").");for(f.sort(function(i,r){return t.getSizeInBytes(n[r].componentDatatype)-t.getSizeInBytes(n[i].componentDatatype)}),e=0,a={},u=0;u<o;++u)i=f[u],s=n[i],a[i]=e,e+=k(s);if(e>0){b=t.getSizeInBytes(n[f[0]].componentDatatype);d=e%b;d!==0&&(e+=b-d);var rt=h*e,nt=new ArrayBuffer(rt),tt={};for(u=0;u<o;++u)i=f[u],g=t.getSizeInBytes(n[i].componentDatatype),tt[i]={pointer:t.createTypedArray(n[i].componentDatatype,nt),index:a[i]/g,strideInComponentType:e/g};for(u=0;u<h;++u)for(v=0;v<o;++v){i=f[v];s=n[i];var ut=s.values,y=tt[i],ft=y.pointer,it=s.componentsPerAttribute;for(l=0;l<it;++l)ft[y.index+l]=ut[u*it+l];y.index+=y.strideInComponentType}return{buffer:nt,offsetsInBytes:a,vertexSizeInBytes:e}}return undefined}function g(n){var i=n._context,o=n._hasInstancedAttributes,h,u,f,e;if(o||i._previousDrawInstanced){i._previousDrawInstanced=o;var r=i._vertexAttribDivisors,s=n._attributes,c=v.maximumVertexAttributes,t;if(o)for(h=s.length,t=0;t<h;++t)u=s[t],u.enabled&&(f=u.instanceDivisor,e=u.index,f!==r[e]&&(i.glVertexAttribDivisor(e,f),r[e]=f));else for(t=0;t<c;++t)r[t]>0&&(i.glVertexAttribDivisor(t,0),r[t]=0)}}function nt(n,t){for(var i,f=n._attributes,e=f.length,u=0;u<e;++u)i=f[u],i.enabled&&r(i.value)&&i.vertexAttrib(t)}return y.fromGeometry=function(u){var w,ut,ft,b,et,nt;u=i(u,i.EMPTY_OBJECT);n.defined("options.context",u.context);var v=u.context,tt=i(u.geometry,i.EMPTY_OBJECT),k=i(u.bufferUsage,a.DYNAMIC_DRAW),it=i(u.attributeLocations,i.EMPTY_OBJECT),ot=i(u.interleave,!1),rt=u.vertexArrayAttributes,e,f,p,g=r(rt)?rt:[],c=tt.attributes;if(ot){if(w=d(c),r(w)){p=l.createVertexBuffer({context:v,typedArray:w.buffer,usage:k});ut=w.offsetsInBytes;ft=w.vertexSizeInBytes;for(e in c)c.hasOwnProperty(e)&&r(c[e])&&(f=c[e],r(f.values)?g.push({index:it[e],vertexBuffer:p,componentDatatype:f.componentDatatype,componentsPerAttribute:f.componentsPerAttribute,normalize:f.normalize,offsetInBytes:ut[e],strideInBytes:ft}):g.push({index:it[e],value:f.value,componentDatatype:f.componentDatatype,normalize:f.normalize}))}}else for(e in c)c.hasOwnProperty(e)&&r(c[e])&&(f=c[e],b=f.componentDatatype,b===t.DOUBLE&&(b=t.FLOAT),p=undefined,r(f.values)&&(p=l.createVertexBuffer({context:v,typedArray:t.createTypedArray(b,f.values),usage:k})),g.push({index:it[e],vertexBuffer:p,value:f.value,componentDatatype:b,componentsPerAttribute:f.componentsPerAttribute,normalize:f.normalize}));return nt=tt.indices,r(nt)&&(et=o.computeNumberOfVertices(tt)>=h.SIXTY_FOUR_KILOBYTES&&v.elementIndexUint?l.createIndexBuffer({context:v,typedArray:new Uint32Array(nt),usage:k,indexDatatype:s.UNSIGNED_INT}):l.createIndexBuffer({context:v,typedArray:new Uint16Array(nt),usage:k,indexDatatype:s.UNSIGNED_SHORT})),new y({context:v,attributes:g,indexBuffer:et})},u(y.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}}),y.prototype.getAttribute=function(t){return n.defined("index",t),this._attributes[t]},y.prototype._bind=function(){r(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&g(this),this._hasConstantAttributes&&nt(this,this._gl)):p(this._gl,this._attributes,this._indexBuffer)},y.prototype._unBind=function(){var i,n,t,u;if(r(this._vao))this._context.glBindVertexArray(null);else{for(i=this._attributes,n=this._gl,t=0;t<i.length;++t)u=i[t],u.enabled&&u.disableVertexAttribArray(n);this._indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){for(var n,t,u=this._attributes,i=0;i<u.length;++i)n=u[i].vertexBuffer,r(n)&&!n.isDestroyed()&&n.vertexArrayDestroyable&&n.destroy();return t=this._indexBuffer,r(t)&&!t.isDestroyed()&&t.vertexArrayDestroyable&&t.destroy(),r(this._vao)&&this._context.glDeleteVertexArray(this._vao),f(this)},y});t("Scene/BatchTable",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/combine","../Core/ComponentDatatype","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/FeatureDetection","../Core/Math","../Core/PixelFormat","../Renderer/ContextLimits","../Renderer/PixelDatatype","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function k(t,r,u){var y;if(!f(t))throw new s("context is required");if(!f(r))throw new s("attributes is required");if(!f(u))throw new s("numberOfInstances is required");if(this._attributes=r,this._numberOfInstances=u,r.length!==0){var o=rt(r),d=t.floatingPointTexture,e=o===v.FLOAT&&!d,p=ut(r,e),h=ft(p,r,e),g=Math.floor(a.maximumTextureSize/h),w=Math.min(u,g),c=h*w,l=Math.ceil(u/w),b=1/c,nt=b*.5,k=1/l,tt=k*.5;this._textureDimensions=new n(c,l);this._textureStep=new i(b,nt,k,tt);this._pixelDatatype=e?v.UNSIGNED_BYTE:o;this._packFloats=e;this._offsets=p;this._stride=h;this._texture=undefined;y=4*c*l;this._batchValues=o===v.FLOAT&&!e?new Float32Array(y):new Uint8Array(y);this._batchValuesDirty=!1}}function rt(n){for(var i=!1,r=n.length,t=0;t<r;++t)if(n[t].componentDatatype!==u.UNSIGNED_BYTE){i=!0;break}return i?v.FLOAT:v.UNSIGNED_BYTE}function nt(r,u){var f=r[u].componentsPerAttribute;return f===2?n:f===3?t:f===4?i:Number}function ut(n,t){for(var e,o,f=new Array(n.length),r=0,s=n.length,i=0;i<s;++i)e=n[i],o=e.componentDatatype,f[i]=r,o!==u.UNSIGNED_BYTE&&t?r+=4:++r;return f}function ft(n,t,i){var r=n.length,f=n[r-1],e=t[r-1],o=e.componentDatatype;return o!==u.UNSIGNED_BYTE&&i?f+4:f+1}function et(n,t,r){var u=i.unpack(n,t,d),s=i.unpackFloat(u),f,e,o;return u=i.unpack(n,t+4,d),f=i.unpackFloat(u),u=i.unpack(n,t+8,d),e=i.unpackFloat(u),u=i.unpack(n,t+12,d),o=i.unpackFloat(u),i.fromElements(s,f,e,o,r)}function ot(n,t,r){var u=i.packFloat(n.x,d);i.pack(u,t,r);u=i.packFloat(n.y,u);i.pack(u,t,r+4);u=i.packFloat(n.z,u);i.pack(u,t,r+8);u=i.packFloat(n.w,u);i.pack(u,t,r+12)}function st(n,t){var i=n._textureDimensions;n._texture=new p({context:t,pixelFormat:l.RGBA,pixelDatatype:n._pixelDatatype,width:i.x,height:i.y,sampler:new y({minificationFilter:b.NEAREST,magnificationFilter:w.NEAREST}),flipY:!1})}function ht(n){var t=n._textureDimensions;n._texture.copyFrom({width:t.x,height:t.y,arrayBufferView:n._batchValues})}function ct(n){var t=n._stride;return n._textureDimensions.y===1?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float numberOfAttributes = float("+t+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = batchTextureStep.x; \n    float centerX = batchTextureStep.y; \n    float stepY = batchTextureStep.z; \n    float centerY = batchTextureStep.w; \n    float numberOfAttributes = float("+t+"); \n    float xId = mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId = floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"}function lt(n){return n===1?"float":"vec"+n}function at(n){return n===1?".x":n===2?".xy":n===3?".xyz":""}function vt(n,t){var o=n._attributes,i=o[t],f=i.componentsPerAttribute,s=i.functionName,e=lt(f),h=at(f),c=n._offsets[t],r=e+" "+s+"(float batchId) \n{ \n    vec2 st = computeSt(batchId); \n    st.x += batchTextureStep.x * float("+c+"); \n";return r+=n._packFloats&&i.componentDatatype!==v.UNSIGNED_BYTE?"vec4 textureValue; \ntextureValue.x = czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w = czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":"    vec4 textureValue = texture2D(batchTexture, st); \n",r+="    "+e+" value = textureValue"+h+"; \n",n._pixelDatatype!==v.UNSIGNED_BYTE||i.componentDatatype!==u.UNSIGNED_BYTE||i.normalize?n._pixelDatatype===v.FLOAT&&i.componentDatatype===u.UNSIGNED_BYTE&&i.normalize&&(r+="value /= 255.0; \n"):r+="value *= 255.0; \n",r+"    return value; \n} \n"}var d,g,tt,it;if(e(k.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}}),d=new i,h.supportsTypedArrays())return g=new i,k.prototype.getBatchedAttribute=function(n,t,r){var u;if(n<0||n>=this._numberOfInstances)throw new s("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new s("attributeIndex is out of range");var o=this._attributes,c=this._offsets[t],l=this._stride,h=4*l*n+4*c,e;return(e=this._packFloats&&o[t].componentDatatype!==v.UNSIGNED_BYTE?et(this._batchValues,h,g):i.unpack(this._batchValues,h,g),u=nt(o,t),f(u.fromCartesian4))?u.fromCartesian4(e,r):f(u.clone)?u.clone(e,r):e.x},tt=[undefined,undefined,new n,new t,new i],it=new i,k.prototype.setBatchedAttribute=function(n,t,r){var u;if(n<0||n>=this._numberOfInstances)throw new s("instanceIndex is out of range.");if(t<0||t>=this._attributes.length)throw new s("attributeIndex is out of range");if(!f(r))throw new s("value is required.");var e=this._attributes,l=tt[e[t].componentsPerAttribute],o=this.getBatchedAttribute(n,t,l),h=nt(this._attributes,t),a=f(h.equals)?h.equals(o,r):o===r;if(!a){u=it;u.x=f(r.x)?r.x:r;u.y=f(r.y)?r.y:0;u.z=f(r.z)?r.z:0;u.w=f(r.w)?r.w:0;var y=this._offsets[t],p=this._stride,c=4*p*n+4*y;this._packFloats&&e[t].componentDatatype!==v.UNSIGNED_BYTE?ot(u,this._batchValues,c):i.pack(u,this._batchValues,c);this._batchValuesDirty=!0}},k.prototype.update=function(n){(!f(this._texture)||this._batchValuesDirty)&&this._attributes.length!==0&&(this._batchValuesDirty=!1,f(this._texture)||st(this,n.context),ht(this))},k.prototype.getUniformMapCallback=function(){var n=this;return function(t){if(n._attributes.length===0)return t;var i={batchTexture:function(){return n._texture},batchTextureDimensions:function(){return n._textureDimensions},batchTextureStep:function(){return n._textureStep}};return r(t,i)}},k.prototype.getVertexShaderCallback=function(){var i=this._attributes,n,r,t;if(i.length===0)return function(n){return n};for(n="uniform sampler2D batchTexture; \n",n+=ct(this)+"\n",r=i.length,t=0;t<r;++t)n+=vt(this,t);return function(t){var i=t.indexOf("void main"),r=t.substring(0,i),u=t.substring(i);return r+"\n"+n+"\n"+u}},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),o(this)},k});t("Scene/PrimitivePipeline",["../Core/BoundingSphere","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/Ellipsoid","../Core/FeatureDetection","../Core/GeographicProjection","../Core/Geometry","../Core/GeometryAttribute","../Core/GeometryAttributes","../Core/GeometryPipeline","../Core/IndexDatatype","../Core/Matrix4","../Core/OffsetGeometryInstanceAttribute","../Core/WebMercatorProjection"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function nt(n,t,i){var f=!i,e=n.length,u,o;if(!f&&e>1)for(o=n[0].modelMatrix,u=1;u<e;++u)if(!v.equals(o,n[u].modelMatrix)){f=!0;break}if(f)for(u=0;u<e;++u)r(n[u].geometry)&&l.transformToWorldCoordinates(n[u]);else v.multiplyTransformation(t,n[0].modelMatrix,t)}function b(n,i){var u=n.attributes,f=u.position,e=f.values.length/f.componentsPerAttribute,o,r;for(u.batchId=new h({componentDatatype:t.FLOAT,componentsPerAttribute:1,values:new Float32Array(e)}),o=u.batchId.values,r=0;r<e;++r)o[r]=i}function tt(n){for(var t,u=n.length,i=0;i<u;++i)t=n[i],r(t.geometry)?b(t.geometry,i):r(t.westHemisphereGeometry)&&r(t.eastHemisphereGeometry)&&(b(t.westHemisphereGeometry,i),b(t.eastHemisphereGeometry,i))}function it(i){for(var s=i.instances,d=i.projection,g=i.elementIndexUintSupported,b=i.scene3DOnly,it=i.vertexCacheOptimize,rt=i.compressVertices,ut=i.modelMatrix,o,k,c=s.length,h,a,v,e,y,p,w,f=0;f<c;++f)if(r(s[f].geometry)){k=s[f].geometry.primitiveType;break}for(f=1;f<c;++f)if(r(s[f].geometry)&&s[f].geometry.primitiveType!==k)throw new u("All instance geometries must have the same primitiveType.");if(nt(s,ut,b),!b)for(f=0;f<c;++f)r(s[f].geometry)&&l.splitLongitude(s[f]);if(tt(s),it)for(f=0;f<c;++f)h=s[f],r(h.geometry)?(l.reorderForPostVertexCache(h.geometry),l.reorderForPreVertexCache(h.geometry)):r(h.westHemisphereGeometry)&&r(h.eastHemisphereGeometry)&&(l.reorderForPostVertexCache(h.westHemisphereGeometry),l.reorderForPreVertexCache(h.westHemisphereGeometry),l.reorderForPostVertexCache(h.eastHemisphereGeometry),l.reorderForPreVertexCache(h.eastHemisphereGeometry));for(a=l.combineInstances(s),c=a.length,f=0;f<c;++f){if(o=a[f],v=o.attributes,b)for(e in v)v.hasOwnProperty(e)&&v[e].componentDatatype===t.DOUBLE&&l.encodeAttribute(o,e,e+"3DHigh",e+"3DLow");else for(e in v)v.hasOwnProperty(e)&&v[e].componentDatatype===t.DOUBLE&&(y=e+"3D",p=e+"2D",l.projectTo2D(o,e,y,p,d),r(o.boundingSphere)&&e==="position"&&(o.boundingSphereCV=n.fromVertices(o.attributes.position2D.values)),l.encodeAttribute(o,y,y+"High",y+"Low"),l.encodeAttribute(o,p,p+"High",p+"Low"));rt&&l.compressVertices(o)}if(!g){for(w=[],c=a.length,f=0;f<c;++f)o=a[f],w=w.concat(l.fitToUnsignedShortIndices(o));a=w}return a}function k(n,t,i,u){var f,o,e,a=u.length-1,s,v,h,y,l,c;for(a>=0?(s=u[a],f=s.offset+s.count,e=s.index,o=i[e].indices.length):(f=0,e=0,o=i[e].indices.length),v=n.length,h=0;h<v;++h)(y=n[h],l=y[t],r(l))&&(c=l.indices.length,f+c>o&&(f=0,o=i[++e].indices.length),u.push({index:e,offset:f,count:c}),f+=c)}function rt(n,t){var i=[];return k(n,"geometry",t,i),k(n,"westHemisphereGeometry",t,i),k(n,"eastHemisphereGeometry",t,i),i}function ut(n,t){var u=n.attributes,f,i;for(f in u)u.hasOwnProperty(f)&&(i=u[f],r(i)&&r(i.values)&&t.push(i.values.buffer));r(n.indices)&&t.push(n.indices.buffer)}function ft(n,t){for(var r=n.length,i=0;i<r;++i)ut(n[i],t)}function et(t){for(var i,u,e,s,f=1,h=t.length,o=0;o<h;o++)if(i=t[o],++f,r(i)){u=i.attributes;f+=7+2*n.packedLength+(r(i.indices)?i.indices.length:0);for(e in u)u.hasOwnProperty(e)&&r(u[e])&&(s=u[e],f+=5+s.values.length)}return f}function ot(n,t){var s=n.length,i=new Float64Array(1+s*19),u=0,e,f,o;for(i[u++]=s,e=0;e<s;e++)f=n[e],v.pack(f.modelMatrix,i,u),u+=v.packedLength,r(f.attributes)&&r(f.attributes.offset)&&(o=f.attributes.offset.value,i[u]=o[0],i[u+1]=o[1],i[u+2]=o[2]),u+=3;return t.push(i.buffer),i}function st(n){for(var i=n,u=new Array(i[0]),o=0,t=1,f,e;t<i.length;)f=v.unpack(i,t),t+=v.packedLength,r(i[t])&&(e={offset:new y(i[t],i[t+1],i[t+2])}),t+=3,u[o++]={modelMatrix:f,attributes:e};return u}function d(t){var e=t.length,s=1+(n.packedLength+1)*e,i=new Float32Array(s),u=0,f,o;for(i[u++]=e,f=0;f<e;++f)o=t[f],r(o)?(i[u++]=1,n.pack(t[f],i,u)):i[u++]=0,u+=n.packedLength;return i}function g(t){for(var r=new Array(t[0]),u=0,i=1;i<t.length;)t[i++]===1&&(r[u]=n.unpack(t,i)),++u,i+=n.packedLength;return r}if(!e.supportsTypedArrays())return{};var w={};return w.combineGeometry=function(t){var e,p,o=t.instances,s=o.length,w,y,b=!1,c,a,i,h,v,u,f;for(s>0&&(e=it(t),e.length>0&&(p=l.createAttributeLocations(e[0]),t.createPickOffsets&&(w=rt(o,e))),r(o[0].attributes)&&r(o[0].attributes.offset)&&(y=new Array(s),b=!0)),c=new Array(s),a=new Array(s),i=0;i<s;++i)h=o[i],v=h.geometry,r(v)&&(c[i]=v.boundingSphere,a[i]=v.boundingSphereCV,b&&(y[i]=h.geometry.offsetAttribute)),u=h.eastHemisphereGeometry,f=h.westHemisphereGeometry,r(u)&&r(f)&&(r(u.boundingSphere)&&r(f.boundingSphere)&&(c[i]=n.union(u.boundingSphere,f.boundingSphere)),r(u.boundingSphereCV)&&r(f.boundingSphereCV)&&(a[i]=n.union(u.boundingSphereCV,f.boundingSphereCV)));return{geometries:e,modelMatrix:t.modelMatrix,attributeLocations:p,pickOffsets:w,offsetInstanceExtend:y,boundingSpheres:c,boundingSpheresCV:a}},w.packCreateGeometryResults=function(t,u){var e=new Float64Array(et(t)),p=[],w={},nt=t.length,f=0,a,o,b,k,d,c,l,s,v,g,h,y;for(e[f++]=nt,a=0;a<nt;a++)if(o=t[a],b=r(o),e[f++]=b?1:0,b){e[f++]=o.primitiveType;e[f++]=o.geometryType;e[f++]=i(o.offsetAttribute,-1);k=r(o.boundingSphere)?1:0;e[f++]=k;k&&n.pack(o.boundingSphere,e,f);f+=n.packedLength;d=r(o.boundingSphereCV)?1:0;e[f++]=d;d&&n.pack(o.boundingSphereCV,e,f);f+=n.packedLength;c=o.attributes;l=[];for(s in c)c.hasOwnProperty(s)&&r(c[s])&&(l.push(s),r(w[s])||(w[s]=p.length,p.push(s)));for(e[f++]=l.length,v=0;v<l.length;v++)g=l[v],h=c[g],e[f++]=w[g],e[f++]=h.componentDatatype,e[f++]=h.componentsPerAttribute,e[f++]=h.normalize?1:0,e[f++]=h.values.length,e.set(h.values,f),f+=h.values.length;y=r(o.indices)?o.indices.length:0;e[f++]=y;y>0&&(e.set(o.indices,f),f+=y)}return u.push(e.buffer),{stringTable:p,packedData:e}},w.unpackCreateGeometryResults=function(i){for(var st=i.stringTable,u=i.packedData,f,v=new Array(u[0]),d=0,r=1,g,nt,tt,it,rt,e,o,p,w,ut,ft,b,et,l,k,ot;r<u.length;){if(g=u[r++]===1,!g){v[d++]=undefined;continue}var ht=u[r++],ct=u[r++],y=u[r++];for(y===-1&&(y=undefined),it=u[r++]===1,it&&(nt=n.unpack(u,r)),r+=n.packedLength,rt=u[r++]===1,rt&&(tt=n.unpack(u,r)),r+=n.packedLength,w=new c,ut=u[r++],f=0;f<ut;f++){for(ft=st[u[r++]],b=u[r++],p=u[r++],et=u[r++]!==0,e=u[r++],o=t.createTypedArray(b,e),l=0;l<e;l++)o[l]=u[r++];w[ft]=new h({componentDatatype:b,componentsPerAttribute:p,normalize:et,values:o})}if(e=u[r++],e>0)for(ot=o.length/p,k=a.createTypedArray(ot,e),f=0;f<e;f++)k[f]=u[r++];v[d++]=new s({primitiveType:ht,geometryType:ct,boundingSphere:nt,boundingSphereCV:tt,indices:k,attributes:w,offsetAttribute:y})}return v},w.packCombineGeometryParameters=function(n,t){for(var r=n.createGeometryResults,u=r.length,i=0;i<u;i++)t.push(r[i].packedData.buffer);return{createGeometryResults:n.createGeometryResults,packedInstances:ot(n.instances,t),ellipsoid:n.ellipsoid,isGeographic:n.projection instanceof o,elementIndexUintSupported:n.elementIndexUintSupported,scene3DOnly:n.scene3DOnly,vertexCacheOptimize:n.vertexCacheOptimize,compressVertices:n.compressVertices,modelMatrix:n.modelMatrix,createPickOffsets:n.createPickOffsets}},w.unpackCombineGeometryParameters=function(n){for(var u,c,t,l,a,i,y,e=st(n.packedInstances),s=n.createGeometryResults,b=s.length,h=0,r=0;r<b;r++)for(u=w.unpackCreateGeometryResults(s[r]),c=u.length,t=0;t<c;t++)l=u[t],a=e[h],a.geometry=l,++h;return i=f.clone(n.ellipsoid),y=n.isGeographic?new o(i):new p(i),{instances:e,ellipsoid:i,projection:y,elementIndexUintSupported:n.elementIndexUintSupported,scene3DOnly:n.scene3DOnly,vertexCacheOptimize:n.vertexCacheOptimize,compressVertices:n.compressVertices,modelMatrix:v.clone(n.modelMatrix),createPickOffsets:n.createPickOffsets}},w.packCombineGeometryResults=function(n,t){r(n.geometries)&&ft(n.geometries,t);var i=d(n.boundingSpheres),u=d(n.boundingSpheresCV);return t.push(i.buffer,u.buffer),{geometries:n.geometries,attributeLocations:n.attributeLocations,modelMatrix:n.modelMatrix,pickOffsets:n.pickOffsets,offsetInstanceExtend:n.offsetInstanceExtend,boundingSpheres:i,boundingSpheresCV:u}},w.unpackCombineGeometryResults=function(n){return{geometries:n.geometries,attributeLocations:n.attributeLocations,modelMatrix:n.modelMatrix,pickOffsets:n.pickOffsets,offsetInstanceExtend:n.offsetInstanceExtend,boundingSpheres:g(n.boundingSpheres),boundingSpheresCV:g(n.boundingSpheresCV)}},w});t("Scene/PrimitiveState",["../Core/freezeObject"],function(n){"use strict";return n({READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6})});t("Scene/SceneMode",["../Core/freezeObject"],function(n){"use strict";var t={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3};return t.getMorphTime=function(n){return n===t.SCENE3D?1:n===t.MORPHING?undefined:0},n(t)});t("Scene/Primitive",["../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/clone","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/EncodedCartesian3","../Core/FeatureDetection","../Core/Geometry","../Core/GeometryAttribute","../Core/GeometryAttributes","../Core/GeometryOffsetAttribute","../Core/Intersect","../Core/isArray","../Core/Matrix4","../Core/Plane","../Core/RuntimeError","../Core/subdivideArray","../Core/TaskProcessor","../Renderer/BufferUsage","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../ThirdParty/when","./BatchTable","./CullFace","./DepthFunction","./PrimitivePipeline","./PrimitiveState","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni){"use strict";function ti(n){if(n=h(n,h.EMPTY_OBJECT),this.geometryInstances=n.geometryInstances,this.appearance=n.appearance,this._appearance=undefined,this._material=undefined,this.depthFailAppearance=n.depthFailAppearance,this._depthFailAppearance=undefined,this._depthFailMaterial=undefined,this.modelMatrix=tt.clone(h(n.modelMatrix,tt.IDENTITY)),this._modelMatrix=new tt,this.show=h(n.show,!0),this._vertexCacheOptimize=h(n.vertexCacheOptimize,!1),this._interleave=h(n.interleave,!1),this._releaseGeometryInstances=h(n.releaseGeometryInstances,!0),this._allowPicking=h(n.allowPicking,!0),this._asynchronous=h(n.asynchronous,!0),this._compressVertices=h(n.compressVertices,!0),this.cull=h(n.cull,!0),this.debugShowBoundingVolume=h(n.debugShowBoundingVolume,!1),this.rtcCenter=n.rtcCenter,c(this.rtcCenter)&&(!c(this.geometryInstances)||nt(this.geometryInstances)&&this.geometryInstances!==1))throw new v("Relative-to-center rendering only supports one geometry instance.");this.shadows=h(n.shadows,ni.DISABLED);this._translucent=undefined;this._state=dt.READY;this._geometries=[];this._error=undefined;this._numberOfInstances=0;this._boundingSpheres=[];this._boundingSphereWC=[];this._boundingSphereCV=[];this._boundingSphere2D=[];this._boundingSphereMorph=[];this._perInstanceAttributeCache=[];this._instanceIds=[];this._lastPerInstanceAttributeIndex=0;this._va=[];this._attributeLocations=undefined;this._primitiveType=undefined;this._frontFaceRS=undefined;this._backFaceRS=undefined;this._sp=undefined;this._depthFailAppearance=undefined;this._spDepthFail=undefined;this._frontFaceDepthFailRS=undefined;this._backFaceDepthFailRS=undefined;this._pickIds=[];this._colorCommands=[];this._pickCommands=[];this._readOnlyInstanceAttributes=n._readOnlyInstanceAttributes;this._createBoundingVolumeFunction=n._createBoundingVolumeFunction;this._createRenderStatesFunction=n._createRenderStatesFunction;this._createShaderProgramFunction=n._createShaderProgramFunction;this._createCommandsFunction=n._createCommandsFunction;this._updateAndQueueCommandsFunction=n._updateAndQueueCommandsFunction;this._createPickOffsets=n._createPickOffsets;this._pickOffsets=undefined;this._createGeometryResults=undefined;this._ready=!1;this._readyPromise=yt.defer();this._batchTable=undefined;this._batchTableAttributeIndices=undefined;this._offsetInstanceExtend=undefined;this._batchTableOffsetAttribute2DIndex=undefined;this._batchTableOffsetsUpdated=!1;this._instanceBoundingSpheres=undefined;this._instanceBoundingSpheresCV=undefined;this._tempBoundingSpheres=undefined;this._recomputeBoundingSpheres=!1;this._batchTableBoundingSpheresUpdated=!1;this._batchTableBoundingSphereAttributeIndices=undefined}function er(n){var s=n.length,o=[],r=n[0].attributes,t,u,e,f,i;for(t in r)if(r.hasOwnProperty(t)&&c(r[t])){for(u=r[t],e=!0,f=1;f<s;++f)if(i=n[f].attributes[t],!c(i)||u.componentDatatype!==i.componentDatatype||u.componentsPerAttribute!==i.componentsPerAttribute||u.normalize!==i.normalize){e=!1;break}e&&o.push(t)}return o}function hi(n){var u=n.length;return u===1?n[0]:u===2?t.unpack(n,0,or):u===3?i.unpack(n,0,sr):u===4?r.unpack(n,0,si):void 0}function hr(n,t){var k=n.geometryInstances,p=nt(k)?k:[k],d=p.length,et,w,v,b,ot,st,it,rt,y,l;if(d!==0){for(var a=er(p),ut=a.length,i=[],g={},f={},ft,ht=p[0],tt=ht.attributes,u,o,r=0;r<ut;++r)u=a[r],o=tt[u],g[u]=r,i.push({functionName:"czm_batchTable_"+u,componentDatatype:o.componentDatatype,componentsPerAttribute:o.componentsPerAttribute,normalize:o.normalize});for(a.indexOf("distanceDisplayCondition")!==-1&&(i.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:s.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:s.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:s.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:s.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:s.FLOAT,componentsPerAttribute:1}),f.center3DHigh=i.length-5,f.center3DLow=i.length-4,f.center2DHigh=i.length-3,f.center2DLow=i.length-2,f.radius=i.length-1),a.indexOf("offset")!==-1&&(i.push({functionName:"czm_batchTable_offset2D",componentDatatype:s.FLOAT,componentsPerAttribute:3}),ft=i.length-1),i.push({functionName:"czm_batchTable_pickColor",componentDatatype:s.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0}),et=i.length,w=new pt(t,i,d),r=0;r<d;++r){for(v=p[r],tt=v.attributes,b=0;b<ut;++b)u=a[b],o=tt[u],ot=hi(o.value),st=g[u],w.setBatchedAttribute(r,st,ot);it={primitive:h(v.pickPrimitive,n)};c(v.id)&&(it.id=v.id);rt=t.createPickId(it);n._pickIds.push(rt);y=rt.color;l=si;l.x=e.floatToByte(y.red);l.y=e.floatToByte(y.green);l.z=e.floatToByte(y.blue);l.w=e.floatToByte(y.alpha);w.setBatchedAttribute(r,et-1,l)}n._batchTable=w;n._batchTableAttributeIndices=g;n._batchTableBoundingSphereAttributeIndices=f;n._batchTableOffsetAttribute2DIndex=ft}}function cr(n){var t;return t=nt(n.values)?n.values.slice(0):new n.values.constructor(n.values),new b({componentDatatype:n.componentDatatype,componentsPerAttribute:n.componentsPerAttribute,normalize:n.normalize,values:t})}function lr(t){var u=t.attributes,f=new k,i,e,r;for(i in u)u.hasOwnProperty(i)&&c(u[i])&&(f[i]=cr(u[i]));return c(t.indices)&&(r=t.indices,e=nt(r)?r.slice(0):new r.constructor(r)),new w({attributes:f,indices:e,primitiveType:t.primitiveType,boundingSphere:n.clone(t.boundingSphere)})}function ar(n,t){return{geometry:t,attributes:n.attributes,modelMatrix:tt.clone(n.modelMatrix),pickPrimitive:n.pickPrimitive,id:n.id}}function li(n){var t=at.replaceMain(n,"czm_non_pick_main");return t+"\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor = czm_batchTable_pickColor(batchId); \n}"}function ai(n){return"varying vec4 v_pickColor;\n"+n}function vi(n,t){var u,r,l,i,a;if(!n.compressVertices||(u=t.search(/attribute\s+vec3\s+normal;/g)!==-1,r=t.search(/attribute\s+vec2\s+st;/g)!==-1,!u&&!r))return t;var h=t.search(/attribute\s+vec3\s+tangent;/g)!==-1,c=t.search(/attribute\s+vec3\s+bitangent;/g)!==-1,s=(r&&u?2:1)+(h||c?1:0);var v=s>1?"vec"+s:"float",f="compressedAttributes",y="attribute "+v+" "+f+";",e="",o="";return r&&(e+="vec2 st;\n",l=s>1?f+".x":f,o+="    st = czm_decompressTextureCoordinates("+l+");\n"),u&&h&&c?(e+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",o+="    czm_octDecode("+f+"."+(r?"yz":"xy")+", normal, tangent, bitangent);\n"):(u&&(e+="vec3 normal;\n",o+="    normal = czm_octDecode("+f+(s>1?"."+(r?"y":"x"):"")+");\n"),h&&(e+="vec3 tangent;\n",o+="    tangent = czm_octDecode("+f+"."+(r&&u?"z":"y")+");\n"),c&&(e+="vec3 bitangent;\n",o+="    bitangent = czm_octDecode("+f+"."+(r&&u?"z":"y")+");\n")),i=t,i=i.replace(/attribute\s+vec3\s+normal;/g,""),i=i.replace(/attribute\s+vec2\s+st;/g,""),i=i.replace(/attribute\s+vec3\s+tangent;/g,""),i=i.replace(/attribute\s+vec3\s+bitangent;/g,""),i=at.replaceMain(i,"czm_non_compressed_main"),a="void main() \n{ \n"+o+"    czm_non_compressed_main(); \n}",[y,e,i,a].join("\n")}function vr(n){var t=at.replaceMain(n,"czm_non_depth_clamp_main");return t+"varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n    vec4 position = gl_Position;\n    v_WindowZ = (0.5 * (position.z / position.w) + 0.5) * position.w;\n    position.z = min(position.z, position.w);\n    gl_Position = position;\n}\n"}function yr(n){var t=at.replaceMain(n,"czm_non_depth_clamp_main");return t+="varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth) && !defined(LOG_DEPTH)\n    gl_FragDepthEXT = min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n","#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+t}function yi(n,t){var r=n.vertexAttributes;for(var i in r)if(r.hasOwnProperty(i)&&!c(t[i]))throw new v("Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '"+i+"', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.");}function pr(n,t){return function(){return n[t]}}function wr(n,t){var e,r,i,u,d=n._instanceIds,f,b,l,y;if(n._state===dt.READY){e=nt(n.geometryInstances)?n.geometryInstances:[n.geometryInstances];var g=n._numberOfInstances=e.length,p=[],o=[];for(i=0;i<g;++i){if(r=e[i].geometry,d.push(e[i].id),!c(r._workerName))throw new v("_workerName must be defined for asynchronous geometry.");o.push({moduleName:r._workerName,geometry:r})}if(!c(fi))for(fi=new Array(ui),i=0;i<ui;i++)fi[i]=new ft("createGeometry",Number.POSITIVE_INFINITY);for(o=ut(o,ui),i=0;i<o.length;i++){var s=0,a=o[i],w=a.length;for(u=0;u<w;++u)f=a[u],r=f.geometry,c(r.constructor.pack)&&(f.offset=s,s+=h(r.constructor.packedLength,r.packedLength));if(s>0)for(l=new Float64Array(s),b=[l.buffer],u=0;u<w;++u)f=a[u],r=f.geometry,c(r.constructor.pack)&&(r.constructor.pack(r,l,f.offset),f.geometry=l);p.push(fi[i].scheduleTask({subTasks:o[i]},b))}n._state=dt.CREATING;yt.all(p,function(t){n._createGeometryResults=t;n._state=dt.CREATED}).otherwise(function(i){ri(n,t,dt.FAILED,i)})}else if(n._state===dt.CREATED){y=[];e=nt(n.geometryInstances)?n.geometryInstances:[n.geometryInstances];var it=t.scene3DOnly,k=t.mapProjection,rt=pi.scheduleTask(kt.packCombineGeometryParameters({createGeometryResults:n._createGeometryResults,instances:e,ellipsoid:k.ellipsoid,projection:k,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:it,vertexCacheOptimize:n.vertexCacheOptimize,compressVertices:n.compressVertices,modelMatrix:n.modelMatrix,createPickOffsets:n._createPickOffsets},y),y);n._createGeometryResults=undefined;n._state=dt.COMBINING;yt(rt,function(i){var r=kt.unpackCombineGeometryResults(i);n._geometries=r.geometries;n._attributeLocations=r.attributeLocations;n.modelMatrix=tt.clone(r.modelMatrix,n.modelMatrix);n._pickOffsets=r.pickOffsets;n._offsetInstanceExtend=r.offsetInstanceExtend;n._instanceBoundingSpheres=r.boundingSpheres;n._instanceBoundingSpheresCV=r.boundingSpheresCV;c(n._geometries)&&n._geometries.length>0?(n._recomputeBoundingSpheres=!0,n._state=dt.COMBINED):ri(n,t,dt.FAILED,undefined)}).otherwise(function(i){ri(n,t,dt.FAILED,i)})}}function br(n,t){for(var o=nt(n.geometryInstances)?n.geometryInstances:[n.geometryInstances],s=n._numberOfInstances=o.length,e=new Array(s),v=n._instanceIds,u,h=0,r,l,f=0;f<s;f++)u=o[f],r=u.geometry,l=c(r.attributes)&&c(r.primitiveType)?lr(r):r.constructor.createGeometry(r),e[h++]=ar(u,l),v.push(u.id);e.length=h;var y=t.scene3DOnly,a=t.mapProjection,i=kt.combineGeometry({instances:e,ellipsoid:a.ellipsoid,projection:a,elementIndexUintSupported:t.context.elementIndexUint,scene3DOnly:y,vertexCacheOptimize:n.vertexCacheOptimize,compressVertices:n.compressVertices,modelMatrix:n.modelMatrix,createPickOffsets:n._createPickOffsets});n._geometries=i.geometries;n._attributeLocations=i.attributeLocations;n.modelMatrix=tt.clone(i.modelMatrix,n.modelMatrix);n._pickOffsets=i.pickOffsets;n._offsetInstanceExtend=i.offsetInstanceExtend;n._instanceBoundingSpheres=i.boundingSpheres;n._instanceBoundingSpheresCV=i.boundingSpheresCV;c(n._geometries)&&n._geometries.length>0?(n._recomputeBoundingSpheres=!0,n._state=dt.COMBINED):ri(n,t,dt.FAILED,undefined)}function kr(t,r){var k=t._batchTableAttributeIndices.offset,h,nt,f,tt,o,b;if(!t._recomputeBoundingSpheres||!c(k)){t._recomputeBoundingSpheres=!1;return}var u,rt=t._offsetInstanceExtend,d=t._instanceBoundingSpheres,s=d.length,e=t._tempBoundingSpheres;if(!c(e)){for(e=new Array(s),u=0;u<s;u++)e[u]=new n;t._tempBoundingSpheres=e}for(u=0;u<s;++u)h=e[u],nt=t._batchTable.getBatchedAttribute(u,k,new i),h=d[u].clone(h),ur(h,nt,rt[u]);var l=[],a=[],v=[];for(u=0;u<s;++u)f=e[u],tt=f.center.x-f.radius,tt>0||n.intersectPlane(f,it.ORIGIN_ZX_PLANE)!==g.INTERSECTING?l.push(f):(a.push(f),v.push(f));var y=l[0],p=v[0],w=a[0];for(u=1;u<l.length;u++)y=n.union(y,l[u]);for(u=1;u<v.length;u++)p=n.union(p,v[u]);for(u=1;u<a.length;u++)w=n.union(w,a[u]);for(o=[],c(y)&&o.push(y),c(p)&&o.push(p),c(w)&&o.push(w),u=0;u<o.length;u++)b=o[u].clone(t._boundingSpheres[u]),t._boundingSpheres[u]=b,t._boundingSphereCV[u]=n.projectTo2D(b,r.mapProjection,t._boundingSphereCV[u]);ti._updateBoundingVolumes(t,r,t.modelMatrix,!0);t._recomputeBoundingSpheres=!1}function dr(t,i){var w=c(t._batchTableAttributeIndices.distanceDisplayCondition),r,u,s,v,p;if(w&&!t._batchTableBoundingSpheresUpdated){var f=t._batchTableBoundingSphereAttributeIndices,b=f.center3DHigh,k=f.center3DLow,d=f.center2DHigh,g=f.center2DLow,nt=f.radius,h=i.mapProjection,tt=h.ellipsoid,e=t._batchTable,l=t._instanceBoundingSpheres,it=l.length;for(r=0;r<it;++r)if(u=l[r],c(u)){s=t.modelMatrix;c(s)&&(u=n.transform(u,s,di));var a=u.center,rt=u.radius,o=y.fromCartesian(a,wi);e.setBatchedAttribute(r,b,o.high);e.setBatchedAttribute(r,k,o.low);i.scene3DOnly||(v=tt.cartesianToCartographic(a,bi),p=h.project(v,ki),o=y.fromCartesian(p,wi),e.setBatchedAttribute(r,d,o.high),e.setBatchedAttribute(r,g,o.low));e.setBatchedAttribute(r,nt,rt)}t._batchTableBoundingSpheresUpdated=!0}}function nr(t,r){var b=c(t._batchTableAttributeIndices.offset),u,e,v,y,o;if(b&&!t._batchTableOffsetsUpdated&&!r.scene3DOnly){var p=t._batchTableOffsetAttribute2DIndex,h=r.mapProjection,l=h.ellipsoid,a=t._batchTable,w=t._instanceBoundingSpheres,k=w.length;for(u=0;u<k;++u)if(e=w[u],c(e)){if(v=a.getBatchedAttribute(u,t._batchTableAttributeIndices.offset),i.equals(v,i.ZERO)){a.setBatchedAttribute(u,p,i.ZERO);continue}y=t.modelMatrix;c(y)&&(e=n.transform(e,y,di));o=e.center;o=l.scaleToGeodeticSurface(o,gi);var s=l.cartesianToCartographic(o,bi),d=h.project(s,ki),g=i.add(v,o,ei);s=l.cartesianToCartographic(g,s);var nt=h.project(s,ei),f=i.subtract(nt,d,ei),tt=f.x;f.x=f.z;f.z=f.y;f.y=tt;a.setBatchedAttribute(u,p,f)}t._batchTableOffsetsUpdated=!0}}function gr(t,i){for(var r,s=t._attributeLocations,f=t._geometries,h=i.scene3DOnly,l=i.context,o=[],a=f.length,e=0;e<a;++e)if(r=f[e],o.push(vt.fromGeometry({context:l,geometry:r,attributeLocations:s,bufferUsage:et.STATIC_DRAW,interleave:t._interleave})),c(t._createBoundingVolumeFunction))t._createBoundingVolumeFunction(i,r);else if(t._boundingSpheres.push(n.clone(r.boundingSphere)),t._boundingSphereWC.push(new n),!h){var u=r.boundingSphereCV.center,v=u.x,y=u.y,p=u.z;u.x=p;u.y=v;u.z=y;t._boundingSphereCV.push(n.clone(r.boundingSphereCV));t._boundingSphere2D.push(new n);t._boundingSphereMorph.push(new n)}t._va=o;t._primitiveType=f[0].primitiveType;t.releaseGeometryInstances&&(t.geometryInstances=undefined);t._geometries=undefined;ri(t,i,dt.COMPLETE,undefined)}function nu(n,t,i,r){var e=i.getRenderState(),u;r?(u=f(e,!1),u.cull={enabled:!0,face:wt.BACK},n._frontFaceRS=ct.fromCache(u),u.cull.face=wt.FRONT,n._backFaceRS=ct.fromCache(u)):(n._frontFaceRS=ct.fromCache(e),n._backFaceRS=n._frontFaceRS);u=f(e,!1);c(n._depthFailAppearance)&&(u.depthTest.enabled=!1);c(n._depthFailAppearance)&&(e=n._depthFailAppearance.getRenderState(),u=f(e,!1),u.depthTest.func=bt.GREATER,r?(u.cull={enabled:!0,face:wt.BACK},n._frontFaceDepthFailRS=ct.fromCache(u),u.cull.face=wt.FRONT,n._backFaceDepthFailRS=ct.fromCache(u)):(n._frontFaceDepthFailRS=ct.fromCache(u),n._backFaceDepthFailRS=n._frontFaceRS))}function tu(n,t,i){var e=t.context,f=n._attributeLocations,r=n._batchTable.getVertexShaderCallback()(i.vertexShaderSource),u;r=ti._appendOffsetToShader(n,r);r=ti._appendShowToShader(n,r);r=ti._appendDistanceDisplayConditionToShader(n,r,t.scene3DOnly);r=li(r);r=ti._updateColorAttribute(n,r,!1);r=vi(n,r);r=ti._modifyShaderPosition(n,r,t.scene3DOnly);u=i.getFragmentShaderSource();u=ai(u);n._sp=lt.replaceCache({context:e,shaderProgram:n._sp,vertexShaderSource:r,fragmentShaderSource:u,attributeLocations:f});yi(n._sp,f);c(n._depthFailAppearance)&&(r=n._batchTable.getVertexShaderCallback()(n._depthFailAppearance.vertexShaderSource),r=ti._appendShowToShader(n,r),r=ti._appendDistanceDisplayConditionToShader(n,r,t.scene3DOnly),r=li(r),r=ti._updateColorAttribute(n,r,!0),r=vi(n,r),r=ti._modifyShaderPosition(n,r,t.scene3DOnly),r=vr(r),u=n._depthFailAppearance.getFragmentShaderSource(),u=ai(u),u=yr(u),n._spDepthFail=lt.replaceCache({context:e,shaderProgram:n._spDepthFail,vertexShaderSource:r,fragmentShaderSource:u,attributeLocations:f}),yi(n._spDepthFail,f))}function tr(n,t,i,r){var s=c(i)?i._uniforms:undefined,h={},e=t.uniforms,u,f;if(c(e))for(u in e)if(e.hasOwnProperty(u)){if(c(s)&&c(s[u]))throw new v("Appearance and material have a uniform with the same name: "+u);h[u]=pr(e,u)}return f=o(h,s),f=n._batchTable.getUniformMapCallback()(f),c(n.rtcCenter)&&(f.u_modifiedModelView=function(){var t=r.context.uniformState.view;return tt.multiply(t,n._modelMatrix,ii),tt.multiplyByPoint(ii,n.rtcCenter,oi),tt.setTranslation(ii,oi,ii),ii}),f}function iu(n,t,i,r,u,f,e,o){var p=tr(n,t,i,o),v,a,y,w,l,h,s;for(c(n._depthFailAppearance)&&(v=tr(n,n._depthFailAppearance,n._depthFailAppearance.material,o)),a=r?ht.TRANSLUCENT:ht.OPAQUE,y=u?2:1,y*=c(n._depthFailAppearance)?2:1,f.length=n._va.length*y,w=f.length,l=0,h=0;h<w;++h)u&&(s=f[h],c(s)||(s=f[h]=new st({owner:n,primitiveType:n._primitiveType})),s.vertexArray=n._va[l],s.renderState=n._backFaceRS,s.shaderProgram=n._sp,s.uniformMap=p,s.pass=a,++h),s=f[h],c(s)||(s=f[h]=new st({owner:n,primitiveType:n._primitiveType})),s.vertexArray=n._va[l],s.renderState=n._frontFaceRS,s.shaderProgram=n._sp,s.uniformMap=p,s.pass=a,c(n._depthFailAppearance)&&(u&&(++h,s=f[h],c(s)||(s=f[h]=new st({owner:n,primitiveType:n._primitiveType})),s.vertexArray=n._va[l],s.renderState=n._backFaceDepthFailRS,s.shaderProgram=n._spDepthFail,s.uniformMap=v,s.pass=a),++h,s=f[h],c(s)||(s=f[h]=new st({owner:n,primitiveType:n._primitiveType})),s.vertexArray=n._va[l],s.renderState=n._frontFaceDepthFailRS,s.shaderProgram=n._spDepthFail,s.uniformMap=v,s.pass=a),++l}function ru(n,t,i,r,u,f,e,o){var h,y,a,l,w,s;if(t.mode!==gt.SCENE3D&&!tt.equals(u,tt.IDENTITY))throw new v("Primitive.modelMatrix is only supported in 3D mode.");if(ti._updateBoundingVolumes(n,t,u),t.mode===gt.SCENE3D?h=n._boundingSphereWC:t.mode===gt.COLUMBUS_VIEW?h=n._boundingSphereCV:t.mode===gt.SCENE2D&&c(n._boundingSphere2D)?h=n._boundingSphere2D:c(n._boundingSphereMorph)&&(h=n._boundingSphereMorph),y=t.commandList,a=t.passes,a.render||a.pick){var b=n.allowPicking,k=ni.castShadows(n.shadows),d=ni.receiveShadows(n.shadows),g=i.length,p=o?2:1;for(p*=c(n._depthFailAppearance)?2:1,l=0;l<g;++l)w=Math.floor(l/p),s=i[l],s.modelMatrix=u,s.boundingVolume=h[w],s.cull=f,s.debugShowBoundingVolume=e,s.castShadows=k,s.receiveShadows=d,s.pickId=b?"v_pickColor":undefined,y.push(s)}}function ur(t,r,u){if(u===d.TOP){var e=n.clone(t,ir),f=n.clone(t,rr);f.center=i.add(f.center,r,f.center);t=n.union(e,f,t)}else u===d.ALL&&(t.center=i.add(t.center,r,t.center));return t}function uu(n,t,i){return function(){var r=n.getBatchedAttribute(t,i),f=n.attributes[i],e=f.componentsPerAttribute,u=s.createTypedArray(f.componentDatatype,e);return c(r.constructor.pack)?r.constructor.pack(r,u,0):u[0]=r,u}}function fu(n,t,i,r,u){return function(f){if(!c(f)||!c(f.length)||f.length<1||f.length>4)throw new v("value must be and array with length between 1 and 4.");var e=hi(f);n.setBatchedAttribute(t,i,e);u==="offset"&&(r._recomputeBoundingSpheres=!0,r._batchTableOffsetsUpdated=!1)}}function eu(t,r,u){r.boundingSphere={get:function(){var f=t._instanceBoundingSpheres[u],e,o;return c(f)&&(f=f.clone(),e=t.modelMatrix,o=r.offset,c(o)&&ur(f,i.fromArray(o.get(),0,fr),t._offsetInstanceExtend[u]),c(e)&&(f=n.transform(f,e))),f}};r.boundingSphereCV={get:function(){return t._instanceBoundingSpheresCV[u]}}}function ou(n,t,i){t.pickId={get:function(){return n._pickIds[i]}}}function ri(n,t,i,r){n._error=r;n._state=i;t.afterRender.push(function(){n._ready=n._state===dt.COMPLETE||n._state===dt.FAILED;c(r)?n._readyPromise.reject(r):n._readyPromise.resolve(n)})}var ci,ui,fi,pi,ei,gi,ii,oi,ir,rr,fr;l(ti.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});var or=new t,sr=new i,si=new r;ci=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;ti._modifyShaderPosition=function(n,t,i){for(var s,e="",o="",f="",r,u;(s=ci.exec(t))!==null;)r=s[1],u="vec4 czm_compute"+r[0].toUpperCase()+r.substr(1)+"()",u!=="vec4 czm_computePosition()"&&(e+=u+";\n"),c(n.rtcCenter)?(t=t.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,""),t=t.replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,""),e+="uniform mat4 u_modifiedModelView;\n",o+="attribute vec4 position;\n",f+=u+"\n{\n    return u_modifiedModelView * position;\n}\n\n",t=t.replace(/czm_modelViewRelativeToEye\s+\*\s+/g,""),t=t.replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):i?f+=u+"\n{\n    return czm_translateRelativeToEye("+r+"3DHigh, "+r+"3DLow);\n}\n\n":(o+="attribute vec3 "+r+"2DHigh;\nattribute vec3 "+r+"2DLow;\n",f+=u+"\n{\n    vec4 p;\n    if (czm_morphTime == 1.0)\n    {\n        p = czm_translateRelativeToEye("+r+"3DHigh, "+r+"3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        p = czm_translateRelativeToEye("+r+"2DHigh.zxy, "+r+"2DLow.zxy);\n    }\n    else\n    {\n        p = czm_columbusViewMorph(\n                czm_translateRelativeToEye("+r+"2DHigh.zxy, "+r+"2DLow.zxy),\n                czm_translateRelativeToEye("+r+"3DHigh, "+r+"3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n");return[e,o,t,f].join("\n")};ti._appendShowToShader=function(n,t){if(!c(n._batchTableAttributeIndices.show))return t;var i=at.replaceMain(t,"czm_non_show_main");return i+"\nvoid main() \n{ \n    czm_non_show_main(); \n    gl_Position *= czm_batchTable_show(batchId); \n}"};ti._updateColorAttribute=function(n,t,i){if(!c(n._batchTableAttributeIndices.color)&&!c(n._batchTableAttributeIndices.depthFailColor)||t.search(/attribute\s+vec4\s+color;/g)===-1)return t;if(i&&!c(n._batchTableAttributeIndices.depthFailColor))throw new v("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");var r=t;return r=r.replace(/attribute\s+vec4\s+color;/g,""),i?r.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):r.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2")};ti._updatePickColorAttribute=function(n){var t=n.replace(/attribute\s+vec4\s+pickColor;/g,"");return t.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2")};ti._appendOffsetToShader=function(n,t){var r,u,i;return c(n._batchTableAttributeIndices.offset)?(r="attribute float batchId;\n",r+="attribute float applyOffset;",u=t.replace(/attribute\s+float\s+batchId;/g,r),i="vec4 $1 = czm_computePosition();\n",i+="    if (czm_sceneMode == czm_sceneMode3D)\n",i+="    {\n",i+="        $1 = $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);",i+="    }\n",i+="    else\n",i+="    {\n",i+="        $1 = $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);",i+="    }\n",u.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,i)):t};ti._appendDistanceDisplayConditionToShader=function(n,t,i){if(!c(n._batchTableAttributeIndices.distanceDisplayCondition))return t;var u=at.replaceMain(t,"czm_non_distanceDisplayCondition_main"),r="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition = czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh = czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow = czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius = czm_batchTable_boundingSphereRadius(batchId);\n";return r+=i?"    vec4 centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":"    vec3 boundingSphereCenter2DHigh = czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow = czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime == 1.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime == 0.0)\n    {\n        centerRTE = czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE = czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n",r+="    float radiusSq = boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode == czm_sceneMode2D) \n    { \n        distanceSq = czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq = dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq = max(distanceSq, 0.0); \n    float nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq = distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show = (distanceSq >= nearSq && distanceSq <= farSq) ? 1.0 : 0.0; \n    gl_Position *= show; \n}",u+"\n"+r};ui=Math.max(p.hardwareConcurrency-1,1);pi=new ft("combineGeometry",Number.POSITIVE_INFINITY);var wi=new y,bi=new u,ki=new i,di=new n;return ei=new i,gi=new i,ii=new tt,oi=new i,ti._updateBoundingVolumes=function(t,i,r,u){var f,o,e,s;if(u||!tt.equals(r,t._modelMatrix))for(tt.clone(r,t._modelMatrix),o=t._boundingSpheres.length,f=0;f<o;++f)e=t._boundingSpheres[f],c(e)&&(t._boundingSphereWC[f]=n.transform(e,r,t._boundingSphereWC[f]),i.scene3DOnly||(t._boundingSphere2D[f]=n.clone(t._boundingSphereCV[f],t._boundingSphere2D[f]),t._boundingSphere2D[f].center.x=0,t._boundingSphereMorph[f]=n.union(t._boundingSphereWC[f],t._boundingSphereCV[f])));if(s=t.appearance.pixelSize,c(s))for(o=t._boundingSpheres.length,f=0;f<o;++f){e=t._boundingSpheres[f];var h=t._boundingSphereWC[f],l=i.camera.getPixelSize(e,i.context.drawingBufferWidth,i.context.drawingBufferHeight),a=l*s;h.radius=e.radius+a}},ti.prototype.update=function(n){var e,u,s,f,l,a,y,p,w;if((c(this.geometryInstances)||this._va.length!==0)&&(!c(this.geometryInstances)||!nt(this.geometryInstances)||this.geometryInstances.length!==0)&&c(this.appearance)&&(n.mode===gt.SCENE3D||!n.scene3DOnly)&&(n.passes.render||n.passes.pick)){if(c(this._error))throw this._error;if(c(this.rtcCenter)&&!n.scene3DOnly)throw new v("RTC rendering is only available for 3D only scenes.");if(this._state!==dt.FAILED){if(e=n.context,c(this._batchTable)||hr(this,e),this._batchTable.attributes.length>0){if(ot.maximumVertexTextureImageUnits===0)throw new rt("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(n)}if(this._state!==dt.COMPLETE&&this._state!==dt.COMBINED&&(this.asynchronous?wr(this,n):br(this,n)),this._state===dt.COMBINED&&(dr(this,n),nr(this,n),gr(this,n)),this.show&&this._state===dt.COMPLETE){this._batchTableOffsetsUpdated||nr(this,n);this._recomputeBoundingSpheres&&kr(this,n);var t=this.appearance,o=t.material,r=!1,i=!1;this._appearance!==t?(this._appearance=t,this._material=o,r=!0,i=!0):this._material!==o&&(this._material=o,i=!0);u=this.depthFailAppearance;s=c(u)?u.material:undefined;this._depthFailAppearance!==u?(this._depthFailAppearance=u,this._depthFailMaterial=s,r=!0,i=!0):this._depthFailMaterial!==s&&(this._depthFailMaterial=s,i=!0);f=this._appearance.isTranslucent();this._translucent!==f&&(this._translucent=f,r=!0);c(this._material)&&this._material.update(e);l=t.closed&&f;r&&(a=h(this._createRenderStatesFunction,nu),a(this,e,t,l));i&&(y=h(this._createShaderProgramFunction,tu),y(this,n,t));(r||i)&&(p=h(this._createCommandsFunction,iu),p(this,t,o,f,l,this._colorCommands,this._pickCommands,n));w=h(this._updateAndQueueCommandsFunction,ru);w(this,n,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,l)}}}},ir=new n,rr=new n,fr=new i,ti.prototype.getGeometryInstanceAttributes=function(n){var e,y,i,p,o,u,r,w,s,h,a;if(!c(n))throw new v("id is required");if(!c(this._batchTable))throw new v("must call update before calling getGeometryInstanceAttributes");var t=-1,k=this._lastPerInstanceAttributeIndex,b=this._instanceIds,f=b.length;for(e=0;e<f;++e)if(y=(k+e)%f,n===b[y]){t=y;break}if(t===-1)return undefined;if(i=this._perInstanceAttributeCache[t],c(i))return i;p=this._batchTable;o=this._batchTableAttributeIndices;i={};u={};for(r in o)if(o.hasOwnProperty(r)){if(w=o[r],u[r]={get:uu(p,t,w)},s=!0,h=this._readOnlyInstanceAttributes,s&&c(h))for(f=h.length,a=0;a<f;++a)if(r===h[a]){s=!1;break}s&&(u[r].set=fu(p,t,w,this,r))}return eu(this,u,t),ou(this,u,t),l(i,u),this._lastPerInstanceAttributeIndex=t,this._perInstanceAttributeCache[t]=i,i},ti.prototype.isDestroyed=function(){return!1},ti.prototype.destroy=function(){var t,n,i,r;for(this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),i=this._va,t=i.length,n=0;n<t;++n)i[n].destroy();for(this._va=undefined,r=this._pickIds,t=r.length,n=0;n<t;++n)r[n].destroy();return this._pickIds=undefined,this._batchTable=this._batchTable&&this._batchTable.destroy(),this._instanceIds=undefined,this._perInstanceAttributeCache=undefined,this._attributeLocations=undefined,a(this)},ti});t("Shaders/ShadowVolumeAppearanceFS",[],function(){"use strict";return"#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else // SPHERICAL\nvarying vec2 v_inversePlaneExtents;\nvarying vec4 v_westPlane;\nvarying vec4 v_southPlane;\n#endif // SPHERICAL\nvarying vec3 v_uvMinAndSphericalLongitudeRotation;\nvarying vec3 v_uMaxAndInverseDistance;\nvarying vec3 v_vMaxAndInverseDistance;\n#endif // TEXTURE_COORDINATES\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\n#ifdef NORMAL_EC\nvec3 getEyeCoordinate3FromWindowCoordinate(vec2 fragCoord, float logDepthOrDepth) {\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(fragCoord, logDepthOrDepth);\nreturn eyeCoordinate.xyz / eyeCoordinate.w;\n}\nvec3 vectorFromOffset(vec4 eyeCoordinate, vec2 positiveOffset) {\nvec2 glFragCoordXY = gl_FragCoord.xy;\nfloat upOrRightLogDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, (glFragCoordXY + positiveOffset) / czm_viewport.zw));\nfloat downOrLeftLogDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, (glFragCoordXY - positiveOffset) / czm_viewport.zw));\nbvec2 upOrRightInBounds = lessThan(glFragCoordXY + positiveOffset, czm_viewport.zw);\nfloat useUpOrRight = float(upOrRightLogDepth > 0.0 && upOrRightInBounds.x && upOrRightInBounds.y);\nfloat useDownOrLeft = float(useUpOrRight == 0.0);\nvec3 upOrRightEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY + positiveOffset, upOrRightLogDepth);\nvec3 downOrLeftEC = getEyeCoordinate3FromWindowCoordinate(glFragCoordXY - positiveOffset, downOrLeftLogDepth);\nreturn (upOrRightEC - (eyeCoordinate.xyz / eyeCoordinate.w)) * useUpOrRight + ((eyeCoordinate.xyz / eyeCoordinate.w) - downOrLeftEC) * useDownOrLeft;\n}\n#endif // NORMAL_EC\nvoid main(void)\n{\n#ifdef REQUIRES_EC\nfloat logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw));\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\n#endif\n#ifdef REQUIRES_WC\nvec4 worldCoordinate4 = czm_inverseView * eyeCoordinate;\nvec3 worldCoordinate = worldCoordinate4.xyz / worldCoordinate4.w;\n#endif\n#ifdef TEXTURE_COORDINATES\nvec2 uv;\n#ifdef SPHERICAL\nvec2 sphericalLatLong = czm_approximateSphericalCoordinates(worldCoordinate);\nsphericalLatLong.y += v_uvMinAndSphericalLongitudeRotation.z;\nsphericalLatLong.y = czm_branchFreeTernary(sphericalLatLong.y < czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);\nuv.x = (sphericalLatLong.y - v_sphericalExtents.y) * v_sphericalExtents.w;\nuv.y = (sphericalLatLong.x - v_sphericalExtents.x) * v_sphericalExtents.z;\n#else // SPHERICAL\nuv.x = czm_planeDistance(v_westPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.x;\nuv.y = czm_planeDistance(v_southPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.y;\n#endif // SPHERICAL\n#endif // TEXTURE_COORDINATES\n#ifdef PICK\n#ifdef CULL_FRAGMENTS\nif (0.0 <= uv.x && uv.x <= 1.0 && 0.0 <= uv.y && uv.y <= 1.0) {\ngl_FragColor.a = 1.0;\nczm_writeDepthClampedToFarPlane();\n}\n#else // CULL_FRAGMENTS\ngl_FragColor.a = 1.0;\n#endif // CULL_FRAGMENTS\n#else // PICK\n#ifdef CULL_FRAGMENTS\nif (uv.x <= 0.0 || 1.0 <= uv.x || uv.y <= 0.0 || 1.0 <= uv.y) {\ndiscard;\n}\n#endif\n#ifdef NORMAL_EC\nvec3 downUp = vectorFromOffset(eyeCoordinate, vec2(0.0, 1.0));\nvec3 leftRight = vectorFromOffset(eyeCoordinate, vec2(1.0, 0.0));\nvec3 normalEC = normalize(cross(leftRight, downUp));\n#endif\n#ifdef PER_INSTANCE_COLOR\n#ifdef FLAT\ngl_FragColor = v_color;\n#else // FLAT\nczm_materialInput materialInput;\nmaterialInput.normalEC = normalEC;\nmaterialInput.positionToEyeEC = -eyeCoordinate.xyz;\nczm_material material = czm_getDefaultMaterial(materialInput);\nmaterial.diffuse = v_color.rgb;\nmaterial.alpha = v_color.a;\ngl_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material);\n#endif // FLAT\n#else // PER_INSTANCE_COLOR\nczm_materialInput materialInput;\n#ifdef USES_NORMAL_EC\nmaterialInput.normalEC = normalEC;\n#endif\n#ifdef USES_POSITION_TO_EYE_EC\nmaterialInput.positionToEyeEC = -eyeCoordinate.xyz;\n#endif\n#ifdef USES_TANGENT_TO_EYE\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(worldCoordinate, normalEC);\n#endif\n#ifdef USES_ST\nmaterialInput.st.x = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_uMaxAndInverseDistance.xy, uv) * v_uMaxAndInverseDistance.z;\nmaterialInput.st.y = czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_vMaxAndInverseDistance.xy, uv) * v_vMaxAndInverseDistance.z;\n#endif\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else // FLAT\ngl_FragColor = czm_phong(normalize(-eyeCoordinate.xyz), material);\n#endif // FLAT\n#endif // PER_INSTANCE_COLOR\nczm_writeDepthClampedToFarPlane();\n#endif // PICK\n}\n"});t("Scene/ShadowVolumeAppearance",["../Core/Cartographic","../Core/Cartesian2","../Core/Cartesian3","../Core/Math","../Core/Check","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/EncodedCartesian3","../Core/GeometryInstanceAttribute","../Core/Matrix4","../Core/Rectangle","../Core/Transforms","../Renderer/ShaderSource","../Scene/PerInstanceColorAppearance","../Shaders/ShadowVolumeAppearanceFS"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(n,t,i){var r,e,f;u.typeOf.bool("extentsCulling",n);u.typeOf.bool("planarExtents",t);u.typeOf.object("appearance",i);r=new g;r.requiresTextureCoordinates=n;r.requiresEC=!i.flat;e=new g;e.requiresTextureCoordinates=n;i instanceof p?r.requiresNormalEC=!i.flat:(f=i.material.shaderSource+"\n"+i.fragmentShaderSource,r.normalEC=f.indexOf("materialInput.normalEC")!==-1||f.indexOf("czm_getDefaultMaterial")!==-1,r.positionToEyeEC=f.indexOf("materialInput.positionToEyeEC")!==-1,r.tangentToEyeMatrix=f.indexOf("materialInput.tangentToEyeMatrix")!==-1,r.st=f.indexOf("materialInput.st")!==-1);this._colorShaderDependencies=r;this._pickShaderDependencies=e;this._appearance=i;this._extentsCulling=n;this._planarExtents=t}function ut(n,t,i,u,f,e,s){var l=u.slice(),a,w,c,v,b;return k.eastMostYhighDefine===""&&(a=it,a.longitude=r.PI,a.latitude=0,a.height=0,w=s.project(a,tt),c=h.encode(w.x,rt),k.eastMostYhighDefine="EAST_MOST_X_HIGH "+c.high.toFixed((c.high+"").length+1),k.eastMostYlowDefine="EAST_MOST_X_LOW "+c.low.toFixed((c.low+"").length+1),v=it,v.longitude=-r.PI,v.latitude=0,v.height=0,b=s.project(v,tt),c=h.encode(b.x,rt),k.westMostYhighDefine="WEST_MOST_X_HIGH "+c.high.toFixed((c.high+"").length+1),k.westMostYlowDefine="WEST_MOST_X_LOW "+c.low.toFixed((c.low+"").length+1)),i&&(l.push(k.eastMostYhighDefine),l.push(k.eastMostYlowDefine),l.push(k.westMostYhighDefine),l.push(k.westMostYlowDefine)),o(e)&&e instanceof p&&l.push("PER_INSTANCE_COLOR"),n.requiresTextureCoordinates&&(l.push("TEXTURE_COORDINATES"),t||i||l.push("SPHERICAL"),i&&l.push("COLUMBUS_VIEW_2D")),new y({defines:l,sources:[f]})}function g(){this._requiresEC=!1;this._requiresWC=!1;this._requiresNormalEC=!1;this._requiresTextureCoordinates=!1;this._usesNormalEC=!1;this._usesPositionToEyeEC=!1;this._usesTangentToEyeMat=!1;this._usesSt=!1}function ft(n,i,r){return Math.abs((i.y-n.y)*r.x-(i.x-n.x)*r.y+i.x*n.y-i.y*n.x)/t.distance(i,n)}function ot(n,i){var o=et,r=t.unpack(i,0,o[0]),u=t.unpack(i,2,o[1]),e=t.unpack(i,4,o[2]),s,h;n.uMaxVmax=new c({componentDatatype:f.FLOAT,componentsPerAttribute:4,normalize:!1,value:[u.x,u.y,e.x,e.y]});s=1/ft(r,u,e);h=1/ft(r,e,u);n.uvMinAndExtents=new c({componentDatatype:f.FLOAT,componentsPerAttribute:4,normalize:!1,value:[r.x,r.y,s,h]})}function ct(n,t,i){var u=st,s,l;u.height=0;u.longitude=n.west;u.latitude=n.south;s=t.project(u,ht);u.latitude=n.north;l=t.project(u,yt);u.longitude=n.east;u.latitude=n.south;var a=t.project(u,pt),e=[0,0,0,0],o=[0,0,0,0],r=h.encode(s.x,d);e[0]=r.high;o[0]=r.low;r=h.encode(s.y,d);e[1]=r.high;o[1]=r.low;r=h.encode(l.y,d);e[2]=r.high;o[2]=r.low;r=h.encode(a.x,d);e[3]=r.high;o[3]=r.low;i.planes2D_HIGH=new c({componentDatatype:f.FLOAT,componentsPerAttribute:4,normalize:!1,value:e});i.planes2D_LOW=new c({componentDatatype:f.FLOAT,componentsPerAttribute:4,normalize:!1,value:o})}function gt(t,r,u,f,e,o){var ot=a.center(t,kt),rt,ut,w,h,c,y,p;ot.height=u;var st=n.toCartesian(ot,r,lt),b=v.eastNorthUpToFixedFrame(st,r,wt),ht=l.inverse(b,bt),k=t.west,d=t.east,g=t.north,nt=t.south,s=dt;s[0].latitude=nt;s[0].longitude=k;s[1].latitude=g;s[1].longitude=k;s[2].latitude=g;s[2].longitude=d;s[3].latitude=nt;s[3].longitude=d;rt=(k+d)*.5;ut=(g+nt)*.5;s[4].latitude=nt;s[4].longitude=rt;s[5].latitude=g;s[5].longitude=rt;s[6].latitude=ut;s[6].longitude=k;s[7].latitude=ut;s[7].longitude=d;var tt=Number.POSITIVE_INFINITY,ft=Number.NEGATIVE_INFINITY,it=Number.POSITIVE_INFINITY,et=Number.NEGATIVE_INFINITY;for(w=0;w<8;w++)s[w].height=u,h=n.toCartesian(s[w],r,lt),l.multiplyByPoint(ht,h,h),h.z=0,tt=Math.min(tt,h.x),ft=Math.max(ft,h.x),it=Math.min(it,h.y),et=Math.max(et,h.y);c=f;c.x=tt;c.y=it;c.z=0;l.multiplyByPoint(b,c,c);y=e;y.x=ft;y.y=it;y.z=0;l.multiplyByPoint(b,y,y);i.subtract(y,c,e);p=o;p.x=tt;p.y=et;p.z=0;l.multiplyByPoint(b,p,p);i.subtract(p,c,o)}function vt(t,i,u,f){var o=st;o.latitude=t;o.longitude=i;o.height=0;var e=n.toCartesian(o,u,at),s=Math.sqrt(e.x*e.x+e.y*e.y),h=r.fastApproximateAtan2(s,e.z),c=r.fastApproximateAtan2(e.x,e.y);return f.x=h,f.y=c,f}function ri(n){return Math.max(n.width,n.height)>b.MAX_WIDTH_FOR_PLANAR_EXTENTS}var k={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""},et,at,nt;b.prototype.createFragmentShader=function(n){var f;u.typeOf.bool("columbusView2D",n);var r=this._appearance,i=this._colorShaderDependencies,t=[];return n||this._planarExtents||t.push("SPHERICAL"),i.requiresEC&&t.push("REQUIRES_EC"),i.requiresWC&&t.push("REQUIRES_WC"),i.requiresTextureCoordinates&&t.push("TEXTURE_COORDINATES"),this._extentsCulling&&t.push("CULL_FRAGMENTS"),i.requiresNormalEC&&t.push("NORMAL_EC"),r instanceof p&&t.push("PER_INSTANCE_COLOR"),i.normalEC&&t.push("USES_NORMAL_EC"),i.positionToEyeEC&&t.push("USES_POSITION_TO_EYE_EC"),i.tangentToEyeMatrix&&t.push("USES_TANGENT_TO_EYE"),i.st&&t.push("USES_ST"),r.flat&&t.push("FLAT"),f="",r instanceof p||(f=r.material.shaderSource),new y({defines:t,sources:[f,w]})};b.prototype.createPickFragmentShader=function(n){u.typeOf.bool("columbusView2D",n);var i=this._pickShaderDependencies,t=["PICK"];return n||this._planarExtents||t.push("SPHERICAL"),i.requiresEC&&t.push("REQUIRES_EC"),i.requiresWC&&t.push("REQUIRES_WC"),i.requiresTextureCoordinates&&t.push("TEXTURE_COORDINATES"),this._extentsCulling&&t.push("CULL_FRAGMENTS"),new y({defines:t,sources:[w],pickColorQualifier:"varying"})};b.prototype.createVertexShader=function(n,t,i,r){return u.defined("defines",n),u.typeOf.string("vertexShaderSource",t),u.typeOf.bool("columbusView2D",i),u.defined("mapProjection",r),ut(this._colorShaderDependencies,this._planarExtents,i,n,t,this._appearance,r)};b.prototype.createPickVertexShader=function(n,t,i,r){return u.defined("defines",n),u.typeOf.string("vertexShaderSource",t),u.typeOf.bool("columbusView2D",i),u.defined("mapProjection",r),ut(this._pickShaderDependencies,this._planarExtents,i,n,t,undefined,r)};var tt=new i,it=new n,rt={high:0,low:0};s(g.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(n){this._requiresEC=n||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(n){this._requiresWC=n||this._requiresWC;this.requiresEC=this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(n){this._requiresNormalEC=n||this._requiresNormalEC;this.requiresEC=this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(n){this._requiresTextureCoordinates=n||this._requiresTextureCoordinates;this.requiresWC=this._requiresTextureCoordinates}},normalEC:{set:function(n){this.requiresNormalEC=n;this._usesNormalEC=n},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(n){this.requiresWC=n;this.requiresNormalEC=n;this._usesTangentToEyeMat=n},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(n){this.requiresEC=n;this._usesPositionToEyeEC=n},get:function(){return this._usesPositionToEyeEC}},st:{set:function(n){this.requiresTextureCoordinates=n;this._usesSt=n},get:function(){return this._usesSt}}});et=[new t,new t,new t,new t];var st=new n,ht=new i,yt=new i,pt=new i,d={high:0,low:0};var wt=new l,bt=new l,lt=new i,kt=new n,dt=[new n,new n,new n,new n,new n,new n,new n,new n];var ni=new i,ti=new i,ii=new h;return b.getPlanarTextureCoordinateAttributes=function(n,t,r,o,s){var l,a;u.typeOf.object("boundingRectangle",n);u.defined("textureCoordinateRotationPoints",t);u.typeOf.object("ellipsoid",r);u.typeOf.object("projection",o);var v=ht,y=ni,p=ti;return gt(n,r,e(s,0),v,y,p),l={},ot(l,t),a=h.fromCartesian(v,ii),l.southWest_HIGH=new c({componentDatatype:f.FLOAT,componentsPerAttribute:3,normalize:!1,value:i.pack(a.high,[0,0,0])}),l.southWest_LOW=new c({componentDatatype:f.FLOAT,componentsPerAttribute:3,normalize:!1,value:i.pack(a.low,[0,0,0])}),l.eastward=new c({componentDatatype:f.FLOAT,componentsPerAttribute:3,normalize:!1,value:i.pack(y,[0,0,0])}),l.northward=new c({componentDatatype:f.FLOAT,componentsPerAttribute:3,normalize:!1,value:i.pack(p,[0,0,0])}),ct(n,o,l),l},at=new i,nt=new t,b.getSphericalExtentGeometryInstanceAttributes=function(n,t,i,e){u.typeOf.object("boundingRectangle",n);u.defined("textureCoordinateRotationPoints",t);u.typeOf.object("ellipsoid",i);u.typeOf.object("projection",e);var v=vt(n.south,n.west,i,nt),h=v.x,o=v.y,y=vt(n.north,n.east,i,nt),p=y.x,s=y.y,l=0;o>s&&(l=r.PI-o,o=-r.PI,s+=l);h-=r.EPSILON5;o-=r.EPSILON5;p+=r.EPSILON5;s+=r.EPSILON5;var w=1/(s-o),b=1/(p-h),a={sphericalExtents:new c({componentDatatype:f.FLOAT,componentsPerAttribute:4,normalize:!1,value:[h,o,b,w]}),longitudeRotation:new c({componentDatatype:f.FLOAT,componentsPerAttribute:1,normalize:!1,value:[l]})};return ot(a,t),ct(n,e,a),a},b.hasAttributesForTextureCoordinatePlanes=function(n){return o(n.southWest_HIGH)&&o(n.southWest_LOW)&&o(n.northward)&&o(n.eastward)&&o(n.planes2D_HIGH)&&o(n.planes2D_LOW)&&o(n.uMaxVmax)&&o(n.uvMinAndExtents)},b.hasAttributesForSphericalExtents=function(n){return o(n.sphericalExtents)&&o(n.longitudeRotation)&&o(n.planes2D_HIGH)&&o(n.planes2D_LOW)&&o(n.uMaxVmax)&&o(n.uvMinAndExtents)},b.shouldUseSphericalCoordinates=function(n){return u.typeOf.object("rectangle",n),ri(n)},b.MAX_WIDTH_FOR_PLANAR_EXTENTS=r.toRadians(1),b});t("Scene/StencilFunction",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={NEVER:t.NEVER,LESS:t.LESS,EQUAL:t.EQUAL,LESS_OR_EQUAL:t.LEQUAL,GREATER:t.GREATER,NOT_EQUAL:t.NOTEQUAL,GREATER_OR_EQUAL:t.GEQUAL,ALWAYS:t.ALWAYS};return n(i)});t("Scene/StencilOperation",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={ZERO:t.ZERO,KEEP:t.KEEP,REPLACE:t.REPLACE,INCREMENT:t.INCR,DECREMENT:t.DECR,INVERT:t.INVERT,INCREMENT_WRAP:t.INCR_WRAP,DECREMENT_WRAP:t.DECR_WRAP};return n(i)});t("Scene/ClassificationPrimitive",["../Core/ColorGeometryInstanceAttribute","../Core/combine","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/GeometryInstance","../Core/isArray","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Shaders/ShadowVolumeFS","../Shaders/ShadowVolumeAppearanceVS","../ThirdParty/when","./BlendingState","./ClassificationType","./DepthFunction","./PerInstanceColorAppearance","./Primitive","./SceneMode","./ShadowVolumeAppearance","./StencilFunction","./StencilOperation"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){"use strict";function ft(n){var t,u;n=i(n,i.EMPTY_OBJECT);t=n.geometryInstances;this.geometryInstances=t;this.show=i(n.show,!0);this.classificationType=i(n.classificationType,k.BOTH);this.debugShowBoundingVolume=i(n.debugShowBoundingVolume,!1);this.debugShowShadowVolume=i(n.debugShowShadowVolume,!1);this._debugShowShadowVolume=!1;this._extruded=i(n._extruded,!1);this._uniformMap=n._uniformMap;this._sp=undefined;this._spStencil=undefined;this._spPick=undefined;this._spColor=undefined;this._spPick2D=undefined;this._spColor2D=undefined;this._rsStencilPreloadPass=undefined;this._rsStencilDepthPass=undefined;this._rsColorPass=undefined;this._rsPickPass=undefined;this._commandsIgnoreShow=[];this._ready=!1;this._readyPromise=w.defer();this._primitive=undefined;this._pickPrimitive=n._pickPrimitive;this._hasSphericalExtentsAttribute=!1;this._hasPlanarExtentsAttributes=!1;this._hasPerColorAttribute=!1;this.appearance=n.appearance;r(t)&&s(t)&&t.length>1&&(u=vt);this._createBoundingVolumeFunction=n._createBoundingVolumeFunction;this._updateAndQueueCommandsFunction=n._updateAndQueueCommandsFunction;this._usePickOffsets=!1;this._primitiveOptions={geometryInstances:undefined,appearance:undefined,vertexCacheOptimize:i(n.vertexCacheOptimize,!1),interleave:i(n.interleave,!1),releaseGeometryInstances:i(n.releaseGeometryInstances,!0),allowPicking:i(n.allowPicking,!0),asynchronous:i(n.asynchronous,!0),compressVertices:i(n.compressVertices,!0),_readOnlyInstanceAttributes:u,_createBoundingVolumeFunction:undefined,_createRenderStatesFunction:undefined,_createShaderProgramFunction:undefined,_createCommandsFunction:undefined,_updateAndQueueCommandsFunction:undefined,_createPickOffsets:!0}}function st(n){return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:n,frontFunction:rt.ALWAYS,frontOperation:{fail:ut.KEEP,zFail:ut.DECREMENT_WRAP,zPass:ut.DECREMENT_WRAP},backFunction:rt.ALWAYS,backOperation:{fail:ut.KEEP,zFail:ut.INCREMENT_WRAP,zPass:ut.INCREMENT_WRAP},reference:ot,mask:et},depthTest:{enabled:!1},depthMask:!1}}function ht(n){return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:n,frontFunction:rt.ALWAYS,frontOperation:{fail:ut.KEEP,zFail:ut.KEEP,zPass:ut.INCREMENT_WRAP},backFunction:rt.ALWAYS,backOperation:{fail:ut.KEEP,zFail:ut.KEEP,zPass:ut.DECREMENT_WRAP},reference:ot,mask:et},depthTest:{enabled:!0,func:d.LESS_OR_EQUAL},depthMask:!1}}function ct(n){return{stencilTest:{enabled:n,frontFunction:rt.NOT_EQUAL,frontOperation:{fail:ut.KEEP,zFail:ut.KEEP,zPass:ut.DECREMENT_WRAP},backFunction:rt.NOT_EQUAL,backOperation:{fail:ut.KEEP,zFail:ut.KEEP,zPass:ut.DECREMENT_WRAP},reference:ot,mask:et},depthTest:{enabled:!1},depthMask:!1,blending:b.ALPHA_BLEND}}function yt(n){if(!r(n._rsStencilPreloadPass)){var t=!n.debugShowShadowVolume;n._rsStencilPreloadPass=l.fromCache(st(t));n._rsStencilDepthPass=l.fromCache(ht(t));n._rsColorPass=l.fromCache(ct(t));n._rsPickPass=l.fromCache(lt)}}function pt(n,t){var u;if(!n.compressVertices)return t;if(t.search(/attribute\s+vec3\s+extrudeDirection;/g)!==-1){var r="compressedAttributes",f="attribute vec2 "+r+";",e="    extrudeDirection = czm_octDecode("+r+", 65535.0);\n",i=t;return i=i.replace(/attribute\s+vec3\s+extrudeDirection;/g,""),i=v.replaceMain(i,"czm_non_compressed_main"),u="void main() \n{ \n"+e+"    czm_non_compressed_main(); \n}",[f,"vec3 extrudeDirection;\n",i,u].join("\n")}}function wt(n,t){var u=t.context,c=n._primitive,i=p,d,l,o,tt,rt,b,ut,ft,et,ot,k,st,ht;i=n._primitive._batchTable.getVertexShaderCallback()(i);i=nt._appendDistanceDisplayConditionToShader(c,i);i=nt._modifyShaderPosition(n,i,t.scene3DOnly);i=nt._updateColorAttribute(c,i);d=n._hasPlanarExtentsAttributes;l=d||n._hasSphericalExtentsAttribute;n._extruded&&(i=pt(c,i));var s=n._extruded?"EXTRUDED_GEOMETRY":"",h="ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT",w=new v({defines:[s,h],sources:[i]}),g=new v({sources:[y]}),e=n._primitive._attributeLocations,f=new it(l,d,n.appearance);n._spStencil=a.replaceCache({context:u,shaderProgram:n._spStencil,vertexShaderSource:w,fragmentShaderSource:g,attributeLocations:e});n._primitive.allowPicking?(o=v.createPickVertexShaderSource(i),o=nt._appendShowToShader(c,o),o=nt._updatePickColorAttribute(o),tt=f.createPickFragmentShader(!1),rt=f.createPickVertexShader([s,h],o,!1,t.mapProjection),n._spPick=a.replaceCache({context:u,shaderProgram:n._spPick,vertexShaderSource:rt,fragmentShaderSource:tt,attributeLocations:e}),l&&(b=u.shaderCache.getDerivedShaderProgram(n._spPick,"2dPick"),r(b)||(ut=f.createPickFragmentShader(!0),ft=f.createPickVertexShader([s,h],o,!0,t.mapProjection),b=u.shaderCache.createDerivedShaderProgram(n._spPick,"2dPick",{vertexShaderSource:ft,fragmentShaderSource:ut,attributeLocations:e})),n._spPick2D=b)):n._spPick=a.fromCache({context:u,vertexShaderSource:w,fragmentShaderSource:g,attributeLocations:e});i=nt._appendShowToShader(c,i);w=new v({defines:[s,h],sources:[i]});n._sp=a.replaceCache({context:u,shaderProgram:n._sp,vertexShaderSource:w,fragmentShaderSource:g,attributeLocations:e});et=f.createFragmentShader(!1);ot=f.createVertexShader([s,h],i,!1,t.mapProjection);n._spColor=a.replaceCache({context:u,shaderProgram:n._spColor,vertexShaderSource:ot,fragmentShaderSource:et,attributeLocations:e});l&&(k=u.shaderCache.getDerivedShaderProgram(n._spColor,"2dColor"),r(k)||(st=f.createFragmentShader(!0),ht=f.createVertexShader([s,h],i,!0,t.mapProjection),k=u.shaderCache.createDerivedShaderProgram(n._spColor,"2dColor",{vertexShaderSource:ht,fragmentShaderSource:st,attributeLocations:e})),n._spColor2D=k)}function bt(n,i){var s=n._primitive,v=s._va.length*3,y,k,w,e,o,a;i.length=v;for(var u,g=0,l=s._batchTable.getUniformMapCallback()(n._uniformMap),nt=n._needs2DShader,f=0;f<v;f+=3)y=s._va[g++],u=i[f],r(u)||(u=i[f]=new h({owner:n,primitiveType:s._primitiveType})),u.vertexArray=y,u.renderState=n._rsStencilPreloadPass,u.shaderProgram=n._sp,u.uniformMap=l,u=i[f+1],r(u)||(u=i[f+1]=new h({owner:n,primitiveType:s._primitiveType})),u.vertexArray=y,u.renderState=n._rsStencilDepthPass,u.shaderProgram=n._sp,u.uniformMap=l,u=i[f+2],r(u)||(u=i[f+2]=new h({owner:n,primitiveType:s._primitiveType})),u.vertexArray=y,u.renderState=n._rsColorPass,u.shaderProgram=n._spColor,k=n.appearance,w=k.material,r(w)&&(l=t(l,w._uniforms)),u.uniformMap=l,nt&&(e=u.derivedCommands.appearance2D,r(e)||(e=h.shallowClone(u),u.derivedCommands.appearance2D=e),e.vertexArray=y,e.renderState=n._rsColorPass,e.shaderProgram=n._spColor2D,e.uniformMap=l);var p=n._commandsIgnoreShow,d=n._spStencil,b=0;for(v=p.length=v/3*2,o=0;o<v;o+=2)a=p[o]=h.shallowClone(i[b],p[o]),a.shaderProgram=d,a.pass=c.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,a=p[o+1]=h.shallowClone(i[b+1],p[o+1]),a.shaderProgram=d,a.pass=c.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,b+=3}function kt(n,t){var c=n._usePickOffsets,f=n._primitive,a=f._va.length*3,v,y=0,e,s,o;c&&(v=f._pickOffsets,a=v.length*3);t.length=a;for(var i,p=0,l=f._batchTable.getUniformMapCallback()(n._uniformMap),w=n._needs2DShader,u=0;u<a;u+=3)s=f._va[p++],c&&(e=v[y++],s=f._va[e.index]),i=t[u],r(i)||(i=t[u]=new h({owner:n,primitiveType:f._primitiveType,pickOnly:!0})),i.vertexArray=s,i.renderState=n._rsStencilPreloadPass,i.shaderProgram=n._sp,i.uniformMap=l,c&&(i.offset=e.offset,i.count=e.count),i=t[u+1],r(i)||(i=t[u+1]=new h({owner:n,primitiveType:f._primitiveType,pickOnly:!0})),i.vertexArray=s,i.renderState=n._rsStencilDepthPass,i.shaderProgram=n._sp,i.uniformMap=l,c&&(i.offset=e.offset,i.count=e.count),i=t[u+2],r(i)||(i=t[u+2]=new h({owner:n,primitiveType:f._primitiveType,pickOnly:!0})),i.vertexArray=s,i.renderState=n._rsPickPass,i.shaderProgram=n._spPick,i.uniformMap=l,c&&(i.offset=e.offset,i.count=e.count),w&&(o=i.derivedCommands.pick2D,r(o)||(o=h.shallowClone(i),i.derivedCommands.pick2D=o),o.vertexArray=s,o.renderState=n._rsPickPass,o.shaderProgram=n._spPick2D,o.uniformMap=l)}function dt(n,t,i,r,u,f,e){bt(n,f);kt(n,e)}function at(n,t){return Math.floor(n%t/3)}function gt(n,t,i,u,f,e,o){var l=n._primitive,a,p,w,s,y,h,b,d,it,rt,g,ut,ft,v;nt._updateBoundingVolumes(l,t,f);t.mode===tt.SCENE3D?a=l._boundingSphereWC:t.mode===tt.COLUMBUS_VIEW?a=l._boundingSphereCV:t.mode===tt.SCENE2D&&r(l._boundingSphere2D)?a=l._boundingSphere2D:r(l._boundingSphereMorph)&&(a=l._boundingSphereMorph);p=t.commandList;w=t.passes;switch(n.classificationType){case k.TERRAIN:y=c.TERRAIN_CLASSIFICATION;break;case k.CESIUM_3D_TILE:y=c.CESIUM_3D_TILE_CLASSIFICATION;break;default:y=c.CLASSIFICATION}if(w.render){for(b=i.length,s=0;s<b;++s)h=i[s],h.modelMatrix=f,h.boundingVolume=a[at(s,b)],h.cull=e,h.debugShowBoundingVolume=o,h.pass=y,p.push(h);if(t.invertClassification)for(d=n._commandsIgnoreShow,it=d.length,s=0;s<it;++s)rt=Math.floor(s/2),h=d[s],h.modelMatrix=f,h.boundingVolume=a[rt],h.cull=e,h.debugShowBoundingVolume=o,p.push(h)}if(w.pick)for(g=u.length,ut=l._pickOffsets,s=0;s<g;++s)ft=ut[at(s,g)],v=u[s],v.modelMatrix=f,v.boundingVolume=a[ft.index],v.cull=e,v.pass=y,p.push(v)}var vt=["color"],et,ot,lt;return u(ft.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}}),ft.isSupported=function(n){return n.context.stencilBuffer},et=15,ot=0,lt={stencilTest:{enabled:!0,frontFunction:rt.NOT_EQUAL,frontOperation:{fail:ut.KEEP,zFail:ut.KEEP,zPass:ut.DECREMENT_WRAP},backFunction:rt.NOT_EQUAL,backOperation:{fail:ut.KEEP,zFail:ut.KEEP,zPass:ut.DECREMENT_WRAP},reference:ot,mask:et},depthTest:{enabled:!1},depthMask:!1},ft.prototype.update=function(t){var u,f,h,d,rt;if(r(this._primitive)||r(this.geometryInstances)){if(u=this.appearance,r(u)&&r(u.material)&&u.material.update(t.context),f=this,h=this._primitiveOptions,!r(this._primitive)){var w=s(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],b=w.length,c,a,k,v=!1,tt=!0,ut,y=!1,p=!1;for(b>0&&(k=w[0].attributes,y=it.hasAttributesForSphericalExtents(k),p=it.hasAttributesForTextureCoordinatePlanes(k),ut=k.color),c=0;c<b;c++){if(a=w[c],d=a.attributes.color,r(d))v=!0;else if(v)throw new e("All GeometryInstances must have color attributes to use per-instance color.");tt=tt&&r(d)&&n.equals(ut,d)}if(!tt&&!y&&!p)throw new e("All GeometryInstances must have the same color attribute except via GroundPrimitives");if(v&&!r(u)&&(u=new g({flat:!0}),this.appearance=u),!v&&u instanceof g)throw new e("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if(r(u.material)&&!y&&!p)throw new e("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");for(this._usePickOffsets=!y&&!p,this._hasSphericalExtentsAttribute=y,this._hasPlanarExtentsAttributes=p,this._hasPerColorAttribute=v,rt=new Array(b),c=0;c<b;++c)a=w[c],rt[c]=new o({geometry:a.geometry,attributes:a.attributes,modelMatrix:a.modelMatrix,id:a.id,pickPrimitive:i(this._pickPrimitive,f)});h.appearance=u;h.geometryInstances=rt;r(this._createBoundingVolumeFunction)&&(h._createBoundingVolumeFunction=function(n,t){f._createBoundingVolumeFunction(n,t)});h._createRenderStatesFunction=function(n,t){yt(f,t)};h._createShaderProgramFunction=function(n,t){wt(f,t)};h._createCommandsFunction=function(n,t,i,r,u,e,o){dt(f,undefined,undefined,!0,!1,e,o)};h._updateAndQueueCommandsFunction=r(this._updateAndQueueCommandsFunction)?function(n,t,i,r,u,e,o,s){f._updateAndQueueCommandsFunction(n,t,i,r,u,e,o,s)}:function(n,t,i,r,u,e,o,s){gt(f,t,i,r,u,e,o,s)};this._primitive=new nt(h);this._primitive.readyPromise.then(function(n){f._ready=!0;f.releaseGeometryInstances&&(f.geometryInstances=undefined);var t=n._error;r(t)?f._readyPromise.reject(t):f._readyPromise.resolve(f)})}if(this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilPreloadPass=l.fromCache(st(!1)),this._rsStencilDepthPass=l.fromCache(ht(!1)),this._rsColorPass=l.fromCache(ct(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilPreloadPass=l.fromCache(st(!0)),this._rsStencilDepthPass=l.fromCache(ht(!0)),this._rsColorPass=l.fromCache(ct(!0))),this._primitive.appearance!==u){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&r(u.material))throw new e("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&u instanceof g)throw new e("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=u}this._primitive.show=this.show;this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(t)}},ft.prototype.getGeometryInstanceAttributes=function(n){if(!r(this._primitive))throw new e("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(n)},ft.prototype.isDestroyed=function(){return!1},ft.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._spColor=this._spColor&&this._spColor.destroy(),this._spPick2D=undefined,this._spColor2D=undefined,f(this)},ft});t("Scene/GroundPrimitive",["../Core/ApproximateTerrainHeights","../Core/BoundingSphere","../Core/buildModuleUrl","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/GeographicTilingScheme","../Core/GeometryInstance","../Core/isArray","../Core/Math","../Core/OrientedBoundingBox","../Core/Rectangle","../Core/RectangleGeometry","../Core/Resource","../Renderer/DrawCommand","../Renderer/Pass","../ThirdParty/when","./ClassificationPrimitive","./ClassificationType","./PerInstanceColorAppearance","./SceneMode","./ShadowVolumeAppearance"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot){"use strict";function st(t){var r,i,f,o,u,e,c;if(t=s(t,s.EMPTY_OBJECT),r=t.appearance,i=t.geometryInstances,!h(r)&&h(i))for(f=p(i)?i:[i],o=f.length,u=0;u<o;u++)if(e=f[u].attributes,h(e)&&h(e.color)){r=new ft({flat:!0});break}this.appearance=r;this.geometryInstances=t.geometryInstances;this.show=s(t.show,!0);this.classificationType=s(t.classificationType,ut.TERRAIN);this.debugShowBoundingVolume=s(t.debugShowBoundingVolume,!1);this.debugShowShadowVolume=s(t.debugShowShadowVolume,!1);this._boundingVolumes=[];this._boundingVolumes2D=[];this._ready=!1;this._readyPromise=it.defer();this._primitive=undefined;this._maxHeight=undefined;this._minHeight=undefined;this._maxTerrainHeight=n._defaultMaxTerrainHeight;this._minTerrainHeight=n._defaultMinTerrainHeight;this._boundingSpheresKeys=[];this._boundingSpheres=[];this._useFragmentCulling=!1;this._zIndex=undefined;c=this;this._classificationPrimitiveOptions={geometryInstances:undefined,appearance:undefined,vertexCacheOptimize:s(t.vertexCacheOptimize,!1),interleave:s(t.interleave,!1),releaseGeometryInstances:s(t.releaseGeometryInstances,!0),allowPicking:s(t.allowPicking,!0),asynchronous:s(t.asynchronous,!0),compressVertices:s(t.compressVertices,!0),_createBoundingVolumeFunction:undefined,_updateAndQueueCommandsFunction:undefined,_pickPrimitive:c,_extruded:!0,_uniformMap:vt}}function lt(n){return function(t,i){var r=i.maximumRadius,u=r/Math.cos(t*.5)-r;return n._maxHeight+u}}function at(n){return function(){return n._minHeight}}function ht(n,t){var y=n.mapProjection.ellipsoid,r,i;if(!h(t.attributes)||!h(t.attributes.position3DHigh))return h(t.rectangle)?t.rectangle:undefined;var c=t.attributes.position3DHigh.values,p=t.attributes.position3DLow.values,w=c.length,f=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(r=0;r<w;r+=3){var b=u.unpack(c,r,yt),k=u.unpack(p,r,pt),d=u.add(b,k,wt),l=y.cartesianToCartographic(d,bt),a=l.latitude,v=l.longitude;f=Math.min(f,a);e=Math.min(e,v);o=Math.max(o,a);s=Math.max(s,v)}return i=kt,i.north=o,i.south=f,i.east=s,i.west=e,i}function dt(t,i,r){var u=n.getApproximateTerrainHeights(i,r);t._minTerrainHeight=u.minimumTerrainHeight;t._maxTerrainHeight=u.maximumTerrainHeight}function gt(n,i,r){var l=i.mapProjection.ellipsoid,e=ht(i,r),o,s,h,c,f;e.width<w.PI?(o=b.fromRectangle(e,n._maxHeight,n._minHeight,l),n._boundingVolumes.push(o)):(s=r.attributes.position3DHigh.values,h=r.attributes.position3DLow.values,n._boundingVolumes.push(t.fromEncodedCartesianVertices(s,h)));i.scene3DOnly||(c=i.mapProjection,f=t.fromRectangleWithHeights2D(e,c,n._maxHeight,n._minHeight),u.fromElements(f.center.z,f.center.x,f.center.y,f.center),n._boundingVolumes2D.push(f))}function ct(n,t){return Math.floor(n%t/3)}function ni(n,t,i,r,u,f,e){var a,v,w,s,o,b,g,nt,y,it,l,h,k,rt;a=t.mode===et.SCENE3D?n._boundingVolumes:n._boundingVolumes2D;switch(n.classificationType){case ut.TERRAIN:v=tt.TERRAIN_CLASSIFICATION;break;case ut.CESIUM_3D_TILE:v=tt.CESIUM_3D_TILE_CLASSIFICATION;break;default:v=tt.CLASSIFICATION}var p=t.commandList,d=t.passes,c=n._primitive;if(d.render){for(w=i.length,s=0;s<w;++s)o=i[s],t.mode!==et.SCENE3D&&o.shaderProgram===c._spColor&&c._needs2DShader&&(o=o.derivedCommands.appearance2D),o.owner=n,o.modelMatrix=u,o.boundingVolume=a[ct(s,w)],o.cull=f,o.debugShowBoundingVolume=e,o.pass=v,p.push(o);if(t.invertClassification)for(b=c._commandsIgnoreShow,g=b.length,s=0;s<g;++s)nt=Math.floor(s/2),o=b[s],o.modelMatrix=u,o.boundingVolume=a[nt],o.cull=f,o.debugShowBoundingVolume=e,p.push(o)}if(d.pick)for(y=r.length,n._useFragmentCulling||(c=n._primitive,it=c._primitive._pickOffsets),l=0;l<y;++l)h=r[l],t.mode!==et.SCENE3D&&h.shaderProgram===c._spPick&&c._needs2DShader&&(h=h.derivedCommands.pick2D),k=a[ct(l,y)],n._useFragmentCulling||(rt=it[ct(l,y)],k=a[rt.index]),h.owner=n,h.modelMatrix=u,h.boundingVolume=k,h.cull=f,h.pass=v,p.push(h)}var vt={u_globeMinimumAltitude:function(){return 55e3}};c(st.prototype,{vertexCacheOptimize:{get:function(){return this._classificationPrimitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._classificationPrimitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._classificationPrimitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._classificationPrimitiveOptions.allowPicking}},asynchronous:{get:function(){return this._classificationPrimitiveOptions.asynchronous}},compressVertices:{get:function(){return this._classificationPrimitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});st.isSupported=rt.isSupported;var yt=new u,pt=new u,wt=new u,bt=new f,kt=new k;return st.initializeTerrainHeights=function(){return n.initialize()},st.prototype.update=function(t){var f,s,c,nt,pt,tt,it,et,ct,vt,yt,b,d;if(h(this._primitive)||h(this.geometryInstances)){if(!n.initialized){if(!this.asynchronous)throw new a("For synchronous GroundPrimitives, you must call GroundPrimitive.initializeTerrainHeights() and wait for the returned promise to resolve.");st.initializeTerrainHeights();return}if(this.classificationType!==ut.TERRAIN&&!(this.appearance instanceof ft))throw new a("GroundPrimitives with Materials can only classify ClassificationType.TERRAIN at this time.");if(f=this,s=this._classificationPrimitiveOptions,!h(this._primitive)){for(var w=t.mapProjection.ellipsoid,r,u,e,l=p(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],v=l.length,g=new Array(v),o,i=0;i<v;++i)if(r=l[i],u=r.geometry,c=ht(t,u),h(o)?h(c)&&k.union(o,c,o):o=k.clone(c),nt=r.id,h(nt)&&h(c)&&(pt=n.getInstanceBoundingSphere(c,w),this._boundingSpheresKeys.push(nt),this._boundingSpheres.push(pt)),e=u.constructor,!h(e)||!h(e.createShadowVolume))throw new a("Not all of the geometry instances have GroundPrimitive support.");if(dt(this,o,w),tt=t.terrainExaggeration,this._minHeight=this._minTerrainHeight*tt,this._maxHeight=this._maxTerrainHeight*tt,it=st._supportsMaterials(t.context)&&this.classificationType===ut.TERRAIN,this._useFragmentCulling=it,it){for(ct=!0,i=0;i<v;++i)if(r=l[i],u=r.geometry,o=ht(t,u),ot.shouldUseSphericalCoordinates(o)){ct=!1;break}for(i=0;i<v;++i){r=l[i];u=r.geometry;e=u.constructor;vt=ht(t,u);yt=u.textureCoordinateRotationPoints;et=ct?ot.getPlanarTextureCoordinateAttributes(vt,yt,w,t.mapProjection,this._maxHeight):ot.getSphericalExtentGeometryInstanceAttributes(vt,yt,w,t.mapProjection);b=r.attributes;for(d in b)b.hasOwnProperty(d)&&(et[d]=b[d]);g[i]=new y({geometry:e.createShadowVolume(u,at(this),lt(this)),attributes:et,id:r.id})}}else for(i=0;i<v;++i)r=l[i],u=r.geometry,e=u.constructor,g[i]=new y({geometry:e.createShadowVolume(u,at(this),lt(this)),attributes:r.attributes,id:r.id});s.geometryInstances=g;s.appearance=this.appearance;s._createBoundingVolumeFunction=function(n,t){gt(f,n,t)};s._updateAndQueueCommandsFunction=function(n,t,i,r,u,e,o,s){ni(f,t,i,r,u,e,o,s)};this._primitive=new rt(s);this._primitive.readyPromise.then(function(n){f._ready=!0;f.releaseGeometryInstances&&(f.geometryInstances=undefined);var t=n._error;h(t)?f._readyPromise.reject(t):f._readyPromise.resolve(f)})}this._primitive.appearance=this.appearance;this._primitive.show=this.show;this._primitive.debugShowShadowVolume=this.debugShowShadowVolume;this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(t)}},st.prototype.getBoundingSphere=function(n){var t=this._boundingSpheresKeys.indexOf(n);return t!==-1?this._boundingSpheres[t]:undefined},st.prototype.getGeometryInstanceAttributes=function(n){if(!h(this._primitive))throw new a("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(n)},st.prototype.isDestroyed=function(){return!1},st.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),l(this)},st._supportsMaterials=function(n){return n.depthTexture},st.supportsMaterials=function(n){return e.typeOf.object("scene",n),st._supportsMaterials(n.frameState.context)},st});t("Shaders/PolylineShadowVolumeVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\n#ifndef COLUMBUS_VIEW_2D\nattribute vec4 startHiAndForwardOffsetX;\nattribute vec4 startLoAndForwardOffsetY;\nattribute vec4 startNormalAndForwardOffsetZ;\nattribute vec4 endNormalAndTextureCoordinateNormalizationX;\nattribute vec4 rightNormalAndTextureCoordinateNormalizationY;\n#else\nattribute vec4 startHiLo2D;\nattribute vec4 offsetAndRight2D;\nattribute vec4 startEndNormals2D;\nattribute vec2 texcoordNormalization2D;\n#endif\nattribute float batchId;\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;\nvarying vec4 v_endPlaneNormalEcAndBatchId;\nvarying vec4 v_rightPlaneEC;\nvarying vec4 v_endEcAndStartEcX;\nvarying vec4 v_texcoordNormalizationAndStartEcYZ;\n#ifdef WIDTH_VARYING\nvarying float v_width;\n#endif\n#ifdef ANGLE_VARYING\nvarying float v_polylineAngle;\n#endif\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\nvoid main()\n{\n#ifdef COLUMBUS_VIEW_2D\nvec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw))).xyz;\nvec3 forwardDirectionEC = czm_normal * vec3(0.0, offsetAndRight2D.xy);\nvec3 ecEnd = forwardDirectionEC + ecStart;\nforwardDirectionEC = normalize(forwardDirectionEC);\nv_rightPlaneEC.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);\nv_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);\nvec4 startPlaneEC;\nstartPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.xy);\nstartPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);\nvec4 endPlaneEC;\nendPlaneEC.xyz =  czm_normal * vec3(0.0, startEndNormals2D.zw);\nendPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);\nv_texcoordNormalizationAndStartEcYZ.x = abs(texcoordNormalization2D.x);\nv_texcoordNormalizationAndStartEcYZ.y = texcoordNormalization2D.y;\n#else // COLUMBUS_VIEW_2D\nvec3 ecStart = (czm_modelViewRelativeToEye * czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz)).xyz;\nvec3 offset = czm_normal * vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w);\nvec3 ecEnd = ecStart + offset;\nvec3 forwardDirectionEC = normalize(offset);\nvec4 startPlaneEC;\nstartPlaneEC.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;\nstartPlaneEC.w = -dot(startPlaneEC.xyz, ecStart);\nvec4 endPlaneEC;\nendPlaneEC.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;\nendPlaneEC.w = -dot(endPlaneEC.xyz, ecEnd);\nv_rightPlaneEC.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;\nv_rightPlaneEC.w = -dot(v_rightPlaneEC.xyz, ecStart);\nv_texcoordNormalizationAndStartEcYZ.x = abs(endNormalAndTextureCoordinateNormalizationX.w);\nv_texcoordNormalizationAndStartEcYZ.y = rightNormalAndTextureCoordinateNormalizationY.w;\n#endif // COLUMBUS_VIEW_2D\nv_endEcAndStartEcX.xyz = ecEnd;\nv_endEcAndStartEcX.w = ecStart.x;\nv_texcoordNormalizationAndStartEcYZ.zw = ecStart.yz;\n#ifdef PER_INSTANCE_COLOR\nv_color = czm_batchTable_color(batchId);\n#endif // PER_INSTANCE_COLOR\nvec4 positionRelativeToEye = czm_computePosition();\nvec4 positionEC = czm_modelViewRelativeToEye * positionRelativeToEye;\nfloat absStartPlaneDistance = abs(czm_planeDistance(startPlaneEC, positionEC.xyz));\nfloat absEndPlaneDistance = abs(czm_planeDistance(endPlaneEC, positionEC.xyz));\nvec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlaneEC.xyz, endPlaneEC.xyz);\nvec3 upOrDown = normalize(cross(v_rightPlaneEC.xyz, planeDirection));\nvec3 normalEC = normalize(cross(planeDirection, upOrDown));\nupOrDown = cross(forwardDirectionEC, normalEC);\nupOrDown = float(czm_sceneMode == czm_sceneMode3D) * upOrDown;\nupOrDown = float(v_texcoordNormalizationAndStartEcYZ.y > 1.0 || v_texcoordNormalizationAndStartEcYZ.y < 0.0) * upOrDown;\nupOrDown = min(GLOBE_MINIMUM_ALTITUDE, czm_geometricToleranceOverMeter * length(positionRelativeToEye.xyz)) * upOrDown;\npositionEC.xyz += upOrDown;\nv_texcoordNormalizationAndStartEcYZ.y = czm_branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y > 1.0, 0.0, abs(v_texcoordNormalizationAndStartEcYZ.y));\nfloat width = czm_batchTable_width(batchId);\n#ifdef WIDTH_VARYING\nv_width = width;\n#endif\nv_startPlaneNormalEcAndHalfWidth.xyz = startPlaneEC.xyz;\nv_startPlaneNormalEcAndHalfWidth.w = width * 0.5;\nv_endPlaneNormalEcAndBatchId.xyz = endPlaneEC.xyz;\nv_endPlaneNormalEcAndBatchId.w = batchId;\nwidth = width * max(0.0, czm_metersPerPixel(positionEC));\nwidth = width / dot(normalEC, v_rightPlaneEC.xyz);\n#ifdef COLUMBUS_VIEW_2D\nnormalEC *= sign(texcoordNormalization2D.x);\n#else\nnormalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);\n#endif\npositionEC.xyz += width * normalEC;\ngl_Position = czm_depthClampFarPlane(czm_projection * positionEC);\n#ifdef ANGLE_VARYING\nvec2 approxLineDirection = normalize(vec2(forwardDirectionEC.x, -forwardDirectionEC.y));\napproxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);\nv_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);\n#endif\n}\n"});t("Shaders/PolylineShadowVolumeFS",[],function(){"use strict";return"#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;\nvarying vec4 v_endPlaneNormalEcAndBatchId;\nvarying vec4 v_rightPlaneEC;\nvarying vec4 v_endEcAndStartEcX;\nvarying vec4 v_texcoordNormalizationAndStartEcYZ;\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\nvoid main(void)\n{\nfloat logDepthOrDepth = czm_branchFreeTernary(czm_sceneMode == czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));\nvec3 ecStart = vec3(v_endEcAndStartEcX.w, v_texcoordNormalizationAndStartEcYZ.zw);\nif (logDepthOrDepth == 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\ngl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);\nreturn;\n#else // DEBUG_SHOW_VOLUME\ndiscard;\n#endif // DEBUG_SHOW_VOLUME\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\neyeCoordinate /= eyeCoordinate.w;\nfloat halfMaxWidth = v_startPlaneNormalEcAndHalfWidth.w * czm_metersPerPixel(eyeCoordinate);\nfloat widthwiseDistance = czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);\nfloat distanceFromStart = czm_planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz, -dot(ecStart, v_startPlaneNormalEcAndHalfWidth.xyz), eyeCoordinate.xyz);\nfloat distanceFromEnd = czm_planeDistance(v_endPlaneNormalEcAndBatchId.xyz, -dot(v_endEcAndStartEcX.xyz, v_endPlaneNormalEcAndBatchId.xyz), eyeCoordinate.xyz);\nif (abs(widthwiseDistance) > halfMaxWidth || distanceFromStart < 0.0 || distanceFromEnd < 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\ngl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);\nreturn;\n#else // DEBUG_SHOW_VOLUME\ndiscard;\n#endif // DEBUG_SHOW_VOLUME\n}\nvec3 alignedPlaneNormal;\nalignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_startPlaneNormalEcAndHalfWidth.xyz);\nalignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));\ndistanceFromStart = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, ecStart), eyeCoordinate.xyz);\nalignedPlaneNormal = cross(v_rightPlaneEC.xyz, v_endPlaneNormalEcAndBatchId.xyz);\nalignedPlaneNormal = normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));\ndistanceFromEnd = czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, v_endEcAndStartEcX.xyz), eyeCoordinate.xyz);\n#ifdef PER_INSTANCE_COLOR\ngl_FragColor = v_color;\n#else // PER_INSTANCE_COLOR\nfloat s = clamp(distanceFromStart / (distanceFromStart + distanceFromEnd), 0.0, 1.0);\ns = (s * v_texcoordNormalizationAndStartEcYZ.x) + v_texcoordNormalizationAndStartEcYZ.y;\nfloat t = (widthwiseDistance + halfMaxWidth) / (2.0 * halfMaxWidth);\nczm_materialInput materialInput;\nmaterialInput.s = s;\nmaterialInput.st = vec2(s, t);\nmaterialInput.str = vec3(s, t, 0.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#endif // PER_INSTANCE_COLOR\nczm_writeDepthClampedToFarPlane();\n}\n"});t("Shaders/PolylineShadowVolumeMorphVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 startHiAndForwardOffsetX;\nattribute vec4 startLoAndForwardOffsetY;\nattribute vec4 startNormalAndForwardOffsetZ;\nattribute vec4 endNormalAndTextureCoordinateNormalizationX;\nattribute vec4 rightNormalAndTextureCoordinateNormalizationY;\nattribute vec4 startHiLo2D;\nattribute vec4 offsetAndRight2D;\nattribute vec4 startEndNormals2D;\nattribute vec2 texcoordNormalization2D;\nattribute float batchId;\nvarying vec3 v_forwardDirectionEC;\nvarying vec3 v_texcoordNormalizationAndHalfWidth;\nvarying float v_batchId;\n#ifdef WIDTH_VARYING\nvarying float v_width;\n#endif\n#ifdef ANGLE_VARYING\nvarying float v_polylineAngle;\n#endif\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#else\nvarying vec2 v_alignedPlaneDistances;\nvarying float v_texcoordT;\n#endif\nvoid main()\n{\nv_batchId = batchId;\nvec4 posRelativeToEye2D = czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw));\nvec4 posRelativeToEye3D = czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz);\nvec4 posRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);\nvec3 posEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;\nvec3 posEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;\nvec3 startEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;\nvec4 startPlane2D;\nvec4 startPlane3D;\nstartPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.xy);\nstartPlane3D.xyz = czm_normal * startNormalAndForwardOffsetZ.xyz;\nstartPlane2D.w = -dot(startPlane2D.xyz, posEc2D);\nstartPlane3D.w = -dot(startPlane3D.xyz, posEc3D);\nvec4 rightPlane2D;\nvec4 rightPlane3D;\nrightPlane2D.xyz = czm_normal * vec3(0.0, offsetAndRight2D.zw);\nrightPlane3D.xyz = czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;\nrightPlane2D.w = -dot(rightPlane2D.xyz, posEc2D);\nrightPlane3D.w = -dot(rightPlane3D.xyz, posEc3D);\nposRelativeToEye2D = posRelativeToEye2D + vec4(0.0, offsetAndRight2D.xy, 0.0);\nposRelativeToEye3D = posRelativeToEye3D + vec4(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w, 0.0);\nposRelativeToEye = czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);\nposEc2D = (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;\nposEc3D = (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;\nvec3 endEC = (czm_modelViewRelativeToEye * posRelativeToEye).xyz;\nvec3 forwardEc3D = czm_normal * normalize(vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w));\nvec3 forwardEc2D = czm_normal * normalize(vec3(0.0, offsetAndRight2D.xy));\nvec4 endPlane2D;\nvec4 endPlane3D;\nendPlane2D.xyz = czm_normal * vec3(0.0, startEndNormals2D.zw);\nendPlane3D.xyz = czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;\nendPlane2D.w = -dot(endPlane2D.xyz, posEc2D);\nendPlane3D.w = -dot(endPlane3D.xyz, posEc3D);\nv_forwardDirectionEC = normalize(endEC - startEC);\nvec2 cleanTexcoordNormalization2D;\ncleanTexcoordNormalization2D.x = abs(texcoordNormalization2D.x);\ncleanTexcoordNormalization2D.y = czm_branchFreeTernary(texcoordNormalization2D.y > 1.0, 0.0, abs(texcoordNormalization2D.y));\nvec2 cleanTexcoordNormalization3D;\ncleanTexcoordNormalization3D.x = abs(endNormalAndTextureCoordinateNormalizationX.w);\ncleanTexcoordNormalization3D.y = rightNormalAndTextureCoordinateNormalizationY.w;\ncleanTexcoordNormalization3D.y = czm_branchFreeTernary(cleanTexcoordNormalization3D.y > 1.0, 0.0, abs(cleanTexcoordNormalization3D.y));\nv_texcoordNormalizationAndHalfWidth.xy = mix(cleanTexcoordNormalization2D, cleanTexcoordNormalization3D, czm_morphTime);\n#ifdef PER_INSTANCE_COLOR\nv_color = czm_batchTable_color(batchId);\n#else // PER_INSTANCE_COLOR\nv_alignedPlaneDistances.x = -dot(v_forwardDirectionEC, startEC);\nv_alignedPlaneDistances.y = -dot(-v_forwardDirectionEC, endEC);\n#endif // PER_INSTANCE_COLOR\n#ifdef WIDTH_VARYING\nfloat width = czm_batchTable_width(batchId);\nfloat halfWidth = width * 0.5;\nv_width = width;\nv_texcoordNormalizationAndHalfWidth.z = halfWidth;\n#else\nfloat halfWidth = 0.5 * czm_batchTable_width(batchId);\nv_texcoordNormalizationAndHalfWidth.z = halfWidth;\n#endif\nvec4 positionEc3D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position3DHigh, position3DLow);\nfloat absStartPlaneDistance = abs(czm_planeDistance(startPlane3D, positionEc3D.xyz));\nfloat absEndPlaneDistance = abs(czm_planeDistance(endPlane3D, positionEc3D.xyz));\nvec3 planeDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane3D.xyz, endPlane3D.xyz);\nvec3 upOrDown = normalize(cross(rightPlane3D.xyz, planeDirection));\nvec3 normalEC = normalize(cross(planeDirection, upOrDown));\nvec3 geodeticSurfaceNormal = normalize(cross(normalEC, forwardEc3D));\ngeodeticSurfaceNormal *= float(0.0 <= rightNormalAndTextureCoordinateNormalizationY.w && rightNormalAndTextureCoordinateNormalizationY.w <= 1.0);\ngeodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;\npositionEc3D.xyz += geodeticSurfaceNormal;\nnormalEC *= sign(endNormalAndTextureCoordinateNormalizationX.w);\npositionEc3D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc3D)) * normalEC;\nvec4 positionEc2D = czm_modelViewRelativeToEye * czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\nabsStartPlaneDistance = abs(czm_planeDistance(startPlane2D, positionEc2D.xyz));\nabsEndPlaneDistance = abs(czm_planeDistance(endPlane2D, positionEc2D.xyz));\nplaneDirection = czm_branchFreeTernary(absStartPlaneDistance < absEndPlaneDistance, startPlane2D.xyz, endPlane2D.xyz);\nupOrDown = normalize(cross(rightPlane2D.xyz, planeDirection));\nnormalEC = normalize(cross(planeDirection, upOrDown));\ngeodeticSurfaceNormal = normalize(cross(normalEC, forwardEc2D));\ngeodeticSurfaceNormal *= float(0.0 <= texcoordNormalization2D.y && texcoordNormalization2D.y <= 1.0);\ngeodeticSurfaceNormal *= MAX_TERRAIN_HEIGHT;\npositionEc2D.xyz += geodeticSurfaceNormal;\nnormalEC *= sign(texcoordNormalization2D.x);\n#ifndef PER_INSTANCE_COLOR\nv_texcoordT = clamp(sign(texcoordNormalization2D.x), 0.0, 1.0);\n#endif\npositionEc2D.xyz += halfWidth * max(0.0, czm_metersPerPixel(positionEc2D)) * normalEC;\ngl_Position = czm_projection * mix(positionEc2D, positionEc3D, czm_morphTime);\n#ifdef ANGLE_VARYING\nvec2 approxLineDirection = normalize(vec2(v_forwardDirectionEC.x, -v_forwardDirectionEC.y));\napproxLineDirection.y = czm_branchFreeTernary(approxLineDirection.x == 0.0 && approxLineDirection.y == 0.0, -1.0, approxLineDirection.y);\nv_polylineAngle = czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);\n#endif\n}\n"});t("Shaders/PolylineShadowVolumeMorphFS",[],function(){"use strict";return"varying vec3 v_forwardDirectionEC;\nvarying vec3 v_texcoordNormalizationAndHalfWidth;\nvarying float v_batchId;\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#else\nvarying vec2 v_alignedPlaneDistances;\nvarying float v_texcoordT;\n#endif\nfloat rayPlaneDistanceUnsafe(vec3 origin, vec3 direction, vec3 planeNormal, float planeDistance) {\nreturn (-planeDistance - dot(planeNormal, origin)) / dot(planeNormal, direction);\n}\nvoid main(void)\n{\nvec4 eyeCoordinate = gl_FragCoord;\neyeCoordinate /= eyeCoordinate.w;\n#ifdef PER_INSTANCE_COLOR\ngl_FragColor = v_color;\n#else // PER_INSTANCE_COLOR\nfloat distanceFromStart = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, -v_forwardDirectionEC, v_forwardDirectionEC.xyz, v_alignedPlaneDistances.x);\nfloat distanceFromEnd = rayPlaneDistanceUnsafe(eyeCoordinate.xyz, v_forwardDirectionEC, -v_forwardDirectionEC.xyz, v_alignedPlaneDistances.y);\ndistanceFromStart = max(0.0, distanceFromStart);\ndistanceFromEnd = max(0.0, distanceFromEnd);\nfloat s = distanceFromStart / (distanceFromStart + distanceFromEnd);\ns = (s * v_texcoordNormalizationAndHalfWidth.x) + v_texcoordNormalizationAndHalfWidth.y;\nczm_materialInput materialInput;\nmaterialInput.s = s;\nmaterialInput.st = vec2(s, v_texcoordT);\nmaterialInput.str = vec3(s, v_texcoordT, 0.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#endif // PER_INSTANCE_COLOR\n}\n"});t("Shaders/Appearances/PolylineColorAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nfloat expandDir = expandAndWidth.x;\nfloat width = abs(expandAndWidth.y) + 0.5;\nbool usePrev = expandAndWidth.y < 0.0;\nvec4 p = czm_computePosition();\nvec4 prev = czm_computePrevPosition();\nvec4 next = czm_computeNextPosition();\nv_color = color;\nfloat angle;\nvec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);\ngl_Position = czm_viewportOrthographic * positionWC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"});t("Shaders/PolylineCommon",[],function(){"use strict";return"void clipLineSegmentToNearPlane(\nvec3 p0,\nvec3 p1,\nout vec4 positionWC,\nout bool clipped,\nout bool culledByNearPlane)\n{\nculledByNearPlane = false;\nclipped = false;\nvec3 p1ToP0 = p1 - p0;\nfloat magnitude = length(p1ToP0);\nvec3 direction = normalize(p1ToP0);\nfloat endPoint0Distance =  -(czm_currentFrustum.x + p0.z);\nfloat denominator = -direction.z;\nif (endPoint0Distance < 0.0 && abs(denominator) < czm_epsilon7)\n{\nculledByNearPlane = true;\n}\nelse if (endPoint0Distance < 0.0 && abs(denominator) > czm_epsilon7)\n{\nfloat t = (czm_currentFrustum.x + p0.z) / denominator;\nif (t < 0.0 || t > magnitude)\n{\nculledByNearPlane = true;\n}\nelse\n{\np0 = p0 + t * direction;\nclipped = true;\n}\n}\npositionWC = czm_eyeToWindowCoordinates(vec4(p0, 1.0));\n}\nvec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)\n{\nvec4 endPointWC, p0, p1;\nbool culledByNearPlane, clipped;\n#ifdef POLYLINE_DASH\nvec4 positionWindow = czm_eyeToWindowCoordinates(positionEC);\nvec4 previousWindow = czm_eyeToWindowCoordinates(prevEC);\nvec4 nextWindow = czm_eyeToWindowCoordinates(nextEC);\nvec2 lineDir;\nif (usePrevious) {\nlineDir = normalize(positionWindow.xy - previousWindow.xy);\n}\nelse {\nlineDir = normalize(nextWindow.xy - positionWindow.xy);\n}\nangle = atan(lineDir.x, lineDir.y) - 1.570796327;\nangle = floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;\n#endif\nclipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, p0, clipped, culledByNearPlane);\nclipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, p1, clipped, culledByNearPlane);\nclipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, endPointWC, clipped, culledByNearPlane);\nif (culledByNearPlane)\n{\nreturn vec4(0.0, 0.0, 0.0, 1.0);\n}\nvec2 prevWC = normalize(p0.xy - endPointWC.xy);\nvec2 nextWC = normalize(p1.xy - endPointWC.xy);\nfloat expandWidth = width * 0.5;\nvec2 direction;\nif (czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) || czm_equalsEpsilon(prevWC, -nextWC, czm_epsilon1))\n{\ndirection = vec2(-nextWC.y, nextWC.x);\n}\nelse if (czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) || clipped)\n{\ndirection = vec2(prevWC.y, -prevWC.x);\n}\nelse\n{\nvec2 normal = vec2(-nextWC.y, nextWC.x);\ndirection = normalize((nextWC + prevWC) * 0.5);\nif (dot(direction, normal) < 0.0)\n{\ndirection = -direction;\n}\nfloat sinAngle = abs(direction.x * nextWC.y - direction.y * nextWC.x);\nexpandWidth = clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n}\nvec2 offset = direction * expandDirection * expandWidth * czm_resolutionScale;\nreturn vec4(endPointWC.xy + offset, -endPointWC.z, 1.0);\n}\nvec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)\n{\nvec4 positionEC = czm_modelViewRelativeToEye * position;\nvec4 prevEC = czm_modelViewRelativeToEye * previous;\nvec4 nextEC = czm_modelViewRelativeToEye * next;\nreturn getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);\n}\n"});t("Scene/PolylineColorAppearance",["../Core/defaultValue","../Core/defineProperties","../Core/VertexFormat","../Shaders/Appearances/PerInstanceFlatColorAppearanceFS","../Shaders/Appearances/PolylineColorAppearanceVS","../Shaders/PolylineCommon","./Appearance"],function(n,t,i,r,u,f,e){"use strict";function o(t){t=n(t,n.EMPTY_OBJECT);var i=n(t.translucent,!0),r=!1,u=o.VERTEX_FORMAT;this.material=undefined;this.translucent=i;this._vertexShaderSource=n(t.vertexShaderSource,s);this._fragmentShaderSource=n(t.fragmentShaderSource,h);this._renderState=e.getDefaultRenderState(i,r,t.renderState);this._closed=r;this._vertexFormat=u}var s=f+"\n"+u,h=r;return t(o.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),o.VERTEX_FORMAT=i.POSITION_ONLY,o.prototype.getFragmentShaderSource=e.prototype.getFragmentShaderSource,o.prototype.isTranslucent=e.prototype.isTranslucent,o.prototype.getRenderState=e.prototype.getRenderState,o});t("Shaders/Appearances/PolylineMaterialAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec2 st;\nattribute float batchId;\nvarying float v_width;\nvarying vec2 v_st;\nvarying float v_polylineAngle;\nvoid main()\n{\nfloat expandDir = expandAndWidth.x;\nfloat width = abs(expandAndWidth.y) + 0.5;\nbool usePrev = expandAndWidth.y < 0.0;\nvec4 p = czm_computePosition();\nvec4 prev = czm_computePrevPosition();\nvec4 next = czm_computeNextPosition();\nv_width = width;\nv_st = st;\nvec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, v_polylineAngle);\ngl_Position = czm_viewportOrthographic * positionWC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"});t("Shaders/PolylineFS",[],function(){"use strict";return"#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.s = v_st.s;\nmaterialInput.st = v_st;\nmaterialInput.str = vec3(v_st, 0.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#ifdef VECTOR_TILE\ngl_FragColor *= u_highlightColor;\n#endif\nczm_writeLogDepth();\n}\n"});t("Scene/PolylineMaterialAppearance",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/VertexFormat","../Shaders/Appearances/PolylineMaterialAppearanceVS","../Shaders/PolylineCommon","../Shaders/PolylineFS","./Appearance","./Material"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(i){i=n(i,n.EMPTY_OBJECT);var r=n(i.translucent,!0),u=!1,f=h.VERTEX_FORMAT;this.material=t(i.material)?i.material:s.fromType(s.ColorType);this.translucent=r;this._vertexShaderSource=n(i.vertexShaderSource,c);this._fragmentShaderSource=n(i.fragmentShaderSource,l);this._renderState=o.getDefaultRenderState(r,u,i.renderState);this._closed=u;this._vertexFormat=f}var c=f+"\n"+u,l=e;return i(h.prototype,{vertexShaderSource:{get:function(){var n=this._vertexShaderSource;return this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)!==-1&&(n="#define POLYLINE_DASH\n"+n),n}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}}),h.VERTEX_FORMAT=r.POSITION_AND_ST,h.prototype.getFragmentShaderSource=o.prototype.getFragmentShaderSource,h.prototype.isTranslucent=o.prototype.isTranslucent,h.prototype.getRenderState=o.prototype.getRenderState,h});t("Scene/GroundPolylinePrimitive",["../Core/ApproximateTerrainHeights","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/GeometryInstance","../Core/GeometryInstanceAttribute","../Core/GroundPolylineGeometry","../Core/isArray","../Shaders/PolylineShadowVolumeVS","../Shaders/PolylineShadowVolumeFS","../Shaders/PolylineShadowVolumeMorphVS","../Shaders/PolylineShadowVolumeMorphFS","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../ThirdParty/when","./BlendingState","./CullFace","./PolylineColorAppearance","./PolylineMaterialAppearance","./Primitive","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function et(n){n=i(n,i.EMPTY_OBJECT);this.geometryInstances=n.geometryInstances;this._hasPerInstanceColors=!0;var t=n.appearance;r(t)||(t=new rt);this.appearance=t;this.show=i(n.show,!0);this.debugShowBoundingVolume=i(n.debugShowBoundingVolume,!1);this._debugShowShadowVolume=i(n.debugShowShadowVolume,!1);this._primitiveOptions={geometryInstances:undefined,appearance:undefined,vertexCacheOptimize:!1,interleave:i(n.interleave,!1),releaseGeometryInstances:i(n.releaseGeometryInstances,!0),allowPicking:i(n.allowPicking,!0),asynchronous:i(n.asynchronous,!0),compressVertices:!1,_createShaderProgramFunction:undefined,_createCommandsFunction:undefined,_updateAndQueueCommandsFunction:undefined};this._zIndex=undefined;this._ready=!1;this._readyPromise=g.defer();this._primitive=undefined;this._sp=undefined;this._sp2D=undefined;this._spMorph=undefined;this._renderState=b.fromCache({cull:{enabled:!0},blending:nt.ALPHA_BLEND,depthMask:!1});this._renderStateMorph=b.fromCache({cull:{enabled:!0,face:tt.FRONT},depthTest:{enabled:!0},blending:nt.ALPHA_BLEND,depthMask:!1})}function ot(t,i,u){var s=i.context,f=t._primitive,g=f._attributeLocations,e=f._batchTable.getVertexShaderCallback()(l),o,w,rt,b,ft,et;e=ut._appendShowToShader(f,e);e=ut._appendDistanceDisplayConditionToShader(f,e);e=ut._modifyShaderPosition(t,e,i.scene3DOnly);o=f._batchTable.getVertexShaderCallback()(v);o=ut._appendShowToShader(f,o);o=ut._appendDistanceDisplayConditionToShader(f,o);o=ut._modifyShaderPosition(t,o,i.scene3DOnly);var nt=f._batchTable.getVertexShaderCallback()(a),h=["ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT","GLOBE_MINIMUM_ALTITUDE "+i.mapProjection.ellipsoid.minimumRadius.toFixed(1)],p="",c="";r(u.material)?(c=r(u.material)?u.material.shaderSource:"",c.search(/varying\s+float\s+v_polylineAngle;/g)!==-1&&h.push("ANGLE_VARYING"),c.search(/varying\s+float\s+v_width;/g)!==-1&&h.push("WIDTH_VARYING")):p="PER_INSTANCE_COLOR";h.push(p);var tt=t.debugShowShadowVolume?["DEBUG_SHOW_VOLUME",p]:[p],ot=new d({defines:h,sources:[e]}),it=new d({defines:tt,sources:[c,nt]});t._sp=k.replaceCache({context:s,shaderProgram:f._sp,vertexShaderSource:ot,fragmentShaderSource:it,attributeLocations:g});w=s.shaderCache.getDerivedShaderProgram(t._sp,"2dColor");r(w)||(rt=new d({defines:h.concat(["COLUMBUS_VIEW_2D"]),sources:[e]}),w=s.shaderCache.createDerivedShaderProgram(t._sp,"2dColor",{context:s,shaderProgram:t._sp2D,vertexShaderSource:rt,fragmentShaderSource:it,attributeLocations:g}));t._sp2D=w;b=s.shaderCache.getDerivedShaderProgram(t._sp,"MorphColor");r(b)||(ft=new d({defines:h.concat(["MAX_TERRAIN_HEIGHT "+n._defaultMaxTerrainHeight.toFixed(1)]),sources:[o]}),nt=f._batchTable.getVertexShaderCallback()(y),et=new d({defines:tt,sources:[c,nt]}),b=s.shaderCache.createDerivedShaderProgram(t._sp,"MorphColor",{context:s,shaderProgram:t._spMorph,vertexShaderSource:ft,fragmentShaderSource:et,attributeLocations:g}));t._spMorph=b}function st(n,t,i,u,f,e){var c=n._primitive,a=c._va.length,l,o;f.length=a;e.length=a;for(var b=t instanceof it,s,k=b?{}:i._uniforms,v=c._batchTable.getUniformMapCallback()(k),y=w.TERRAIN_CLASSIFICATION,h=0;h<a;h++)l=c._va[h],s=f[h],r(s)||(s=f[h]=new p({owner:n,primitiveType:c._primitiveType})),s.vertexArray=l,s.renderState=n._renderState,s.shaderProgram=n._sp,s.uniformMap=v,s.pass=y,s.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)",o=s.derivedCommands.color2D,r(o)||(o=p.shallowClone(s),s.derivedCommands.color2D=o),o.vertexArray=l,o.renderState=n._renderState,o.shaderProgram=n._sp2D,o.uniformMap=v,o.pass=y,o.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)",o=s.derivedCommands.colorMorph,r(o)||(o=p.shallowClone(s),s.derivedCommands.colorMorph=o),o.vertexArray=l,o.renderState=n._renderStateMorph,o.shaderProgram=n._spMorph,o.uniformMap=v,o.pass=y,o.pickId="czm_batchTable_pickColor(v_batchId)"}function ht(n,t,i,u,f,e,o){var h=n._primitive,c,v,a,y,l,s;if(ut._updateBoundingVolumes(h,t,f),t.mode===ft.SCENE3D?c=h._boundingSphereWC:t.mode===ft.COLUMBUS_VIEW?c=h._boundingSphereCV:t.mode===ft.SCENE2D&&r(h._boundingSphere2D)?c=h._boundingSphere2D:r(h._boundingSphereMorph)&&(c=h._boundingSphereMorph),v=t.commandList,a=t.passes,a.render||a.pick&&h.allowPicking)for(y=i.length,l=0;l<y;++l)s=i[l],t.mode===ft.MORPHING&&s.shaderProgram!==n._spMorph?s=s.derivedCommands.colorMorph:t.mode!==ft.SCENE3D&&s.shaderProgram!==n._sp2D&&(s=s.derivedCommands.color2D),s.modelMatrix=f,s.boundingVolume=c[l],s.cull=e,s.debugShowBoundingVolume=o,v.push(s)}return u(et.prototype,{interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},debugShowShadowVolume:{get:function(){return this._debugShowShadowVolume}}}),et.initializeTerrainHeights=function(){return n.initialize()},et.prototype.update=function(i){var f,u,a,v,y,p;if(r(this._primitive)||r(this.geometryInstances)){if(!n.initialized){if(!this.asynchronous)throw new e("For synchronous GroundPolylinePrimitives, you must call GroundPolylinePrimitives.initializeTerrainHeights() and wait for the returned promise to resolve.");et.initializeTerrainHeights();return}if(u=this,a=this._primitiveOptions,!r(this._primitive)){var w=c(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],b=w.length,k=new Array(b),l;for(f=0;f<b;++f)if(l=w[f].attributes,!r(l)||!r(l.color)){this._hasPerInstanceColors=!1;break}for(f=0;f<b;++f){v=w[f];l={};y=v.attributes;for(p in y)y.hasOwnProperty(p)&&(l[p]=y[p]);r(l.width)||(l.width=new s({componentDatatype:t.UNSIGNED_BYTE,componentsPerAttribute:1,value:[v.geometry.width]}));v.geometry._scene3DOnly=i.scene3DOnly;h.setProjectionAndEllipsoid(v.geometry,i.mapProjection);k[f]=new o({geometry:v.geometry,attributes:l,id:v.id,pickPrimitive:u})}a.geometryInstances=k;a.appearance=this.appearance;a._createShaderProgramFunction=function(n,t,i){ot(u,t,i)};a._createCommandsFunction=function(n,t,i,r,f,e,o){st(u,t,i,r,e,o)};a._updateAndQueueCommandsFunction=function(n,t,i,r,f,e,o){ht(u,t,i,r,f,e,o)};this._primitive=new ut(a);this._primitive.readyPromise.then(function(n){u._ready=!0;u.releaseGeometryInstances&&(u.geometryInstances=undefined);var t=n._error;r(t)?u._readyPromise.reject(t):u._readyPromise.resolve(u)})}if(this.appearance instanceof it&&!this._hasPerInstanceColors)throw new e("All GeometryInstances must have color attributes to use PolylineColorAppearance with GroundPolylinePrimitive.");this._primitive.appearance=this.appearance;this._primitive.show=this.show;this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(i)}},et.prototype.getGeometryInstanceAttributes=function(n){if(!r(this._primitive))throw new e("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(n)},et.isSupported=function(n){return n.frameState.context.depthTexture},et.prototype.isDestroyed=function(){return!1},et.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),this._sp=this._sp&&this._sp.destroy(),this._sp2D=undefined,this._spMorph=undefined,f(this)},et});t("DataSources/ImageMaterialProperty",["../Core/Cartesian2","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){n=i(n,i.EMPTY_OBJECT);this._definitionChanged=new f;this._image=undefined;this._imageSubscription=undefined;this._repeat=undefined;this._repeatSubscription=undefined;this._color=undefined;this._colorSubscription=undefined;this._transparent=undefined;this._transparentSubscription=undefined;this.image=n.image;this.repeat=n.repeat;this.color=n.color;this.transparent=n.transparent}var h=new n(1,1),c=!1,l=t.WHITE;return u(s.prototype,{isConstant:{get:function(){return o.isConstant(this._image)&&o.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},image:e("image"),repeat:e("repeat"),color:e("color"),transparent:e("transparent")}),s.prototype.getType=function(){return"Image"},s.prototype.getValue=function(n,t){return r(t)||(t={}),t.image=o.getValueOrUndefined(this._image,n),t.repeat=o.getValueOrClonedDefault(this._repeat,n,h,t.repeat),t.color=o.getValueOrClonedDefault(this._color,n,l,t.color),o.getValueOrDefault(this._transparent,n,c)&&(t.color.alpha=Math.min(.99,t.color.alpha)),t},s.prototype.equals=function(n){return this===n||n instanceof s&&o.equals(this._image,n._image)&&o.equals(this._color,n._color)&&o.equals(this._transparent,n._transparent)&&o.equals(this._repeat,n._repeat)},s});t("DataSources/createMaterialPropertyDescriptor",["../Core/Color","../Core/DeveloperError","../Core/Resource","./ColorMaterialProperty","./createPropertyDescriptor","./ImageMaterialProperty"],function(n,t,i,r,u,f){"use strict";function e(u){if(u instanceof n)return new r(u);if(typeof u=="string"||u instanceof i||u instanceof HTMLCanvasElement||u instanceof HTMLVideoElement){var e=new f;return e.image=u,e}throw new t("Unable to infer material type: "+u);}function o(n,t){return u(n,t,e)}return o});t("DataSources/BoxGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._heightReference=undefined;this._dimensions=undefined;this._dimensionsSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},heightReference:e("heightReference"),show:e("show"),dimensions:e("dimensions"),material:f("material"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.heightReference=this.heightReference,n.dimensions=this.dimensions,n.show=this.show,n.material=this.material,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.heightReference=n(this.heightReference,i.heightReference);this.dimensions=n(this.dimensions,i.dimensions);this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/PositionProperty",["../Core/Cartesian3","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Matrix3","../Core/ReferenceFrame","../Core/Transforms"],function(n,t,i,r,u,f,e){"use strict";function o(){r.throwInstantiationError()}i(o.prototype,{isConstant:{get:r.throwInstantiationError},definitionChanged:{get:r.throwInstantiationError},referenceFrame:{get:r.throwInstantiationError}});o.prototype.getValue=r.throwInstantiationError;o.prototype.getValueInReferenceFrame=r.throwInstantiationError;o.prototype.equals=r.throwInstantiationError;var s=new u;return o.convertToReferenceFrame=function(i,r,o,h,c){if(!t(r))return r;if(t(c)||(c=new n),o===h)return n.clone(r,c);var l=e.computeIcrfToFixedMatrix(i,s);return(t(l)||(l=e.computeTemeToPseudoFixedMatrix(i,s)),o===f.INERTIAL)?u.multiplyByVector(l,r,c):o===f.FIXED?u.multiplyByVector(u.transpose(l,s),r,c):void 0},o});t("DataSources/ConstantPositionProperty",["../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/ReferenceFrame","./PositionProperty"],function(n,t,i,r,u,f,e,o){"use strict";function s(i,r){this._definitionChanged=new f;this._value=n.clone(i);this._referenceFrame=t(r,e.FIXED)}return r(s.prototype,{isConstant:{get:function(){return!i(this._value)||this._referenceFrame===e.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}}),s.prototype.getValue=function(n,t){return this.getValueInReferenceFrame(n,e.FIXED,t)},s.prototype.setValue=function(t,r){var u=!1;n.equals(this._value,t)||(u=!0,this._value=n.clone(t));i(r)&&this._referenceFrame!==r&&(u=!0,this._referenceFrame=r);u&&this._definitionChanged.raiseEvent(this)},s.prototype.getValueInReferenceFrame=function(n,t,r){if(!i(n))throw new u("time is required.");if(!i(t))throw new u("referenceFrame is required.");return o.convertToReferenceFrame(n,this._value,this._referenceFrame,t,r)},s.prototype.equals=function(t){return this===t||t instanceof s&&n.equals(this._value,t._value)&&this._referenceFrame===t._referenceFrame},s});t("DataSources/CorridorGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._positions=undefined;this._positionsSubscription=undefined;this._height=undefined;this._heightSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._extrudedHeight=undefined;this._extrudedHeightSubscription=undefined;this._extrudedHeightReference=undefined;this._extrudedHeightReferenceSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._width=undefined;this._widthSubscription=undefined;this._cornerType=undefined;this._cornerTypeSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._classificationType=undefined;this._classificationTypeSubscription=undefined;this._zIndex=undefined;this._zIndexSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),material:f("material"),positions:e("positions"),height:e("height"),heightReference:e("heightReference"),extrudedHeight:e("extrudedHeight"),extrudedHeightReference:e("extrudedHeightReference"),granularity:e("granularity"),width:e("width"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),cornerType:e("cornerType"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition"),classificationType:e("classificationType"),zIndex:e("zIndex")}),o.prototype.clone=function(n){return t(n)?(n.show=this.show,n.material=this.material,n.positions=this.positions,n.height=this.height,n.heightReference=this.heightReference,n.extrudedHeight=this.extrudedHeight,n.extrudedHeightReference=this.extrudedHeightReference,n.granularity=this.granularity,n.width=this.width,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.cornerType=this.cornerType,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n.classificationType=this.classificationType,n.zIndex=this.zIndex,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.positions=n(this.positions,i.positions);this.height=n(this.height,i.height);this.heightReference=n(this.heightReference,i.heightReference);this.extrudedHeight=n(this.extrudedHeight,i.extrudedHeight);this.extrudedHeightReference=n(this.extrudedHeightReference,i.extrudedHeightReference);this.granularity=n(this.granularity,i.granularity);this.width=n(this.width,i.width);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.cornerType=n(this.cornerType,i.cornerType);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.classificationType=n(this.classificationType,i.classificationType);this.zIndex=n(this.zIndex,i.zIndex)},o});t("DataSources/createRawPropertyDescriptor",["./createPropertyDescriptor"],function(n){"use strict";function t(n){return n}function i(i,r){return n(i,r,t)}return i});t("DataSources/CylinderGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._heightReference=undefined;this._length=undefined;this._lengthSubscription=undefined;this._topRadius=undefined;this._topRadiusSubscription=undefined;this._bottomRadius=undefined;this._bottomRadiusSubscription=undefined;this._numberOfVerticalLines=undefined;this._numberOfVerticalLinesSubscription=undefined;this._slices=undefined;this._slicesSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},heightReference:e("heightReference"),length:e("length"),topRadius:e("topRadius"),bottomRadius:e("bottomRadius"),numberOfVerticalLines:e("numberOfVerticalLines"),slices:e("slices"),show:e("show"),material:f("material"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.heightReference=this.heightReference,n.bottomRadius=this.bottomRadius,n.length=this.length,n.topRadius=this.topRadius,n.show=this.show,n.material=this.material,n.numberOfVerticalLines=this.numberOfVerticalLines,n.slices=this.slices,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.heightReference=n(this.heightReference,i.heightReference);this.bottomRadius=n(this.bottomRadius,i.bottomRadius);this.length=n(this.length,i.length);this.topRadius=n(this.topRadius,i.topRadius);this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.numberOfVerticalLines=n(this.numberOfVerticalLines,i.numberOfVerticalLines);this.slices=n(this.slices,i.slices);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/EllipseGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._semiMajorAxis=undefined;this._semiMajorAxisSubscription=undefined;this._semiMinorAxis=undefined;this._semiMinorAxisSubscription=undefined;this._rotation=undefined;this._rotationSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._height=undefined;this._heightSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._extrudedHeight=undefined;this._extrudedHeightSubscription=undefined;this._extrudedHeightReference=undefined;this._extrudedHeightReferenceSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._stRotation=undefined;this._stRotationSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._numberOfVerticalLines=undefined;this._numberOfVerticalLinesSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._classificationType=undefined;this._classificationTypeSubscription=undefined;this._zIndex=undefined;this._zIndexSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},semiMajorAxis:e("semiMajorAxis"),semiMinorAxis:e("semiMinorAxis"),rotation:e("rotation"),show:e("show"),material:f("material"),height:e("height"),heightReference:e("heightReference"),extrudedHeight:e("extrudedHeight"),extrudedHeightReference:e("extrudedHeightReference"),granularity:e("granularity"),stRotation:e("stRotation"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),numberOfVerticalLines:e("numberOfVerticalLines"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition"),classificationType:e("classificationType"),zIndex:e("zIndex")}),o.prototype.clone=function(n){return t(n)?(n.rotation=this.rotation,n.semiMajorAxis=this.semiMajorAxis,n.semiMinorAxis=this.semiMinorAxis,n.show=this.show,n.material=this.material,n.height=this.height,n.heightReference=this.heightReference,n.extrudedHeight=this.extrudedHeight,n.extrudedHeightReference=this.extrudedHeightReference,n.granularity=this.granularity,n.stRotation=this.stRotation,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.numberOfVerticalLines=this.numberOfVerticalLines,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n.classificationType=this.classificationType,n.zIndex=this.zIndex,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.rotation=n(this.rotation,i.rotation);this.semiMajorAxis=n(this.semiMajorAxis,i.semiMajorAxis);this.semiMinorAxis=n(this.semiMinorAxis,i.semiMinorAxis);this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.height=n(this.height,i.height);this.heightReference=n(this.heightReference,i.heightReference);this.extrudedHeight=n(this.extrudedHeight,i.extrudedHeight);this.extrudedHeightReference=n(this.extrudedHeightReference,i.extrudedHeightReference);this.granularity=n(this.granularity,i.granularity);this.stRotation=n(this.stRotation,i.stRotation);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.numberOfVerticalLines=n(this.numberOfVerticalLines,i.numberOfVerticalLines);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.classificationType=n(this.classificationType,i.classificationType);this.zIndex=n(this.zIndex,i.zIndex)},o});t("DataSources/EllipsoidGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._heightReference=undefined;this._show=undefined;this._showSubscription=undefined;this._radii=undefined;this._radiiSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._stackPartitions=undefined;this._stackPartitionsSubscription=undefined;this._slicePartitions=undefined;this._slicePartitionsSubscription=undefined;this._subdivisions=undefined;this._subdivisionsSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},heightReference:e("heightReference"),show:e("show"),radii:e("radii"),material:f("material"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),stackPartitions:e("stackPartitions"),slicePartitions:e("slicePartitions"),subdivisions:e("subdivisions"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.heightReference=this.heightReference,n.show=this.show,n.radii=this.radii,n.material=this.material,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.stackPartitions=this.stackPartitions,n.slicePartitions=this.slicePartitions,n.subdivisions=this.subdivisions,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.heightReference=n(this.heightReference,i.heightReference);this.show=n(this.show,i.show);this.radii=n(this.radii,i.radii);this.material=n(this.material,i.material);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.stackPartitions=n(this.stackPartitions,i.stackPartitions);this.slicePartitions=n(this.slicePartitions,i.slicePartitions);this.subdivisions=n(this.subdivisions,i.subdivisions);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/LabelGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createPropertyDescriptor"],function(n,t,i,r,u,f){"use strict";function e(t){this._text=undefined;this._textSubscription=undefined;this._font=undefined;this._fontSubscription=undefined;this._style=undefined;this._styleSubscription=undefined;this._fillColor=undefined;this._fillColorSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._horizontalOrigin=undefined;this._horizontalOriginSubscription=undefined;this._verticalOrigin=undefined;this._verticalOriginSubscription=undefined;this._eyeOffset=undefined;this._eyeOffsetSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._pixelOffset=undefined;this._pixelOffsetSubscription=undefined;this._scale=undefined;this._scaleSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._showBackground=undefined;this._showBackgroundSubscription=undefined;this._backgroundColor=undefined;this._backgroundColorSubscription=undefined;this._backgroundPadding=undefined;this._backgroundPaddingSubscription=undefined;this._translucencyByDistance=undefined;this._translucencyByDistanceSubscription=undefined;this._pixelOffsetScaleByDistance=undefined;this._pixelOffsetScaleByDistanceSubscription=undefined;this._scaleByDistance=undefined;this._scaleByDistanceSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._disableDepthTestDistance=undefined;this._disableDepthTestDistanceSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},text:f("text"),font:f("font"),style:f("style"),fillColor:f("fillColor"),outlineColor:f("outlineColor"),outlineWidth:f("outlineWidth"),horizontalOrigin:f("horizontalOrigin"),verticalOrigin:f("verticalOrigin"),eyeOffset:f("eyeOffset"),heightReference:f("heightReference"),pixelOffset:f("pixelOffset"),scale:f("scale"),show:f("show"),showBackground:f("showBackground"),backgroundColor:f("backgroundColor"),backgroundPadding:f("backgroundPadding"),translucencyByDistance:f("translucencyByDistance"),pixelOffsetScaleByDistance:f("pixelOffsetScaleByDistance"),scaleByDistance:f("scaleByDistance"),distanceDisplayCondition:f("distanceDisplayCondition"),disableDepthTestDistance:f("disableDepthTestDistance")}),e.prototype.clone=function(n){return t(n)?(n.text=this.text,n.font=this.font,n.show=this.show,n.style=this.style,n.fillColor=this.fillColor,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.showBackground=this.showBackground,n.backgroundColor=this.backgroundColor,n.backgroundPadding=this.backgroundPadding,n.scale=this.scale,n.horizontalOrigin=this.horizontalOrigin,n.verticalOrigin=this.verticalOrigin,n.eyeOffset=this.eyeOffset,n.heightReference=this.heightReference,n.pixelOffset=this.pixelOffset,n.translucencyByDistance=this.translucencyByDistance,n.pixelOffsetScaleByDistance=this.pixelOffsetScaleByDistance,n.scaleByDistance=this.scaleByDistance,n.distanceDisplayCondition=this.distanceDisplayCondition,n.disableDepthTestDistance=this.disableDepthTestDistance,n):new e(this)},e.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.text=n(this.text,i.text);this.font=n(this.font,i.font);this.show=n(this.show,i.show);this.style=n(this.style,i.style);this.fillColor=n(this.fillColor,i.fillColor);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.showBackground=n(this.showBackground,i.showBackground);this.backgroundColor=n(this.backgroundColor,i.backgroundColor);this.backgroundPadding=n(this.backgroundPadding,i.backgroundPadding);this.scale=n(this.scale,i.scale);this.horizontalOrigin=n(this.horizontalOrigin,i.horizontalOrigin);this.verticalOrigin=n(this.verticalOrigin,i.verticalOrigin);this.eyeOffset=n(this.eyeOffset,i.eyeOffset);this.heightReference=n(this.heightReference,i.heightReference);this.pixelOffset=n(this.pixelOffset,i.pixelOffset);this.translucencyByDistance=n(this.translucencyByDistance,i.translucencyByDistance);this.pixelOffsetScaleByDistance=n(this.pixelOffsetScaleByDistance,i.pixelOffsetScaleByDistance);this.scaleByDistance=n(this.scaleByDistance,i.scaleByDistance);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.disableDepthTestDistance=n(this.disableDepthTestDistance,i.disableDepthTestDistance)},e});t("DataSources/NodeTransformationProperty",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","../Core/TranslationRotationScale","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e){"use strict";var s=new u,o=function(t){t=n(t,n.EMPTY_OBJECT);this._definitionChanged=new r;this._translation=undefined;this._translationSubscription=undefined;this._rotation=undefined;this._rotationSubscription=undefined;this._scale=undefined;this._scaleSubscription=undefined;this.translation=t.translation;this.rotation=t.rotation;this.scale=t.scale};return i(o.prototype,{isConstant:{get:function(){return e.isConstant(this._translation)&&e.isConstant(this._rotation)&&e.isConstant(this._scale)}},definitionChanged:{get:function(){return this._definitionChanged}},translation:f("translation"),rotation:f("rotation"),scale:f("scale")}),o.prototype.getValue=function(n,i){return t(i)||(i=new u),i.translation=e.getValueOrClonedDefault(this._translation,n,s.translation,i.translation),i.rotation=e.getValueOrClonedDefault(this._rotation,n,s.rotation,i.rotation),i.scale=e.getValueOrClonedDefault(this._scale,n,s.scale,i.scale),i},o.prototype.equals=function(n){return this===n||n instanceof o&&e.equals(this._translation,n._translation)&&e.equals(this._rotation,n._rotation)&&e.equals(this._scale,n._scale)},o});t("DataSources/PropertyBag",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./ConstantProperty","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function h(n){return new f(n)}function c(n,t){var u=n._propertyNames,f=t._propertyNames,e=u.length,i,r,s;if(e!==f.length)return!1;for(i=0;i<e;++i)if((r=u[i],s=f.indexOf(r),s===-1)||!o.equals(n[r],t[r]))return!1;return!0}var s=function(n,i){this._propertyNames=[];this._definitionChanged=new u;t(n)&&this.merge(n,i)};return i(s.prototype,{propertyNames:{get:function(){return this._propertyNames}},isConstant:{get:function(){for(var t=this._propertyNames,n=0,i=t.length;n<i;n++)if(!o.isConstant(this[t[n]]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}}),s.prototype.hasProperty=function(n){return this._propertyNames.indexOf(n)!==-1},s.prototype.addProperty=function(i,u,f){var o=this._propertyNames;if(!t(i))throw new r("propertyName is required.");if(o.indexOf(i)!==-1)throw new r(i+" is already a registered property.");o.push(i);Object.defineProperty(this,i,e(i,!0,n(f,h)));t(u)&&(this[i]=u);this._definitionChanged.raiseEvent(this)},s.prototype.removeProperty=function(n){var u=this._propertyNames,i=u.indexOf(n);if(!t(n))throw new r("propertyName is required.");if(i===-1)throw new r(n+" is not a registered property.");this._propertyNames.splice(i,1);delete this[n];this._definitionChanged.raiseEvent(this)},s.prototype.getValue=function(n,i){var e,u,s,f;if(!t(n))throw new r("time is required.");for(t(i)||(i={}),e=this._propertyNames,u=0,s=e.length;u<s;u++)f=e[u],i[f]=o.getValueOrUndefined(this[f],n,i[f]);return i},s.prototype.merge=function(n,i){var h,s,o,c;if(!t(n))throw new r("source is required.");for(h=this._propertyNames,s=t(n._propertyNames)?n._propertyNames:Object.keys(n),o=0,c=s.length;o<c;o++){var f=s[o],e=this[f],u=n[f];e===undefined&&h.indexOf(f)===-1&&this.addProperty(f,undefined,i);u!==undefined&&(e!==undefined?t(e)&&t(e.merge)&&e.merge(u):this[f]=t(u)&&t(u.merge)&&t(u.clone)?u.clone():u)}},s.prototype.equals=function(n){return this===n||n instanceof s&&c(this,n)},s});t("DataSources/ModelGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createPropertyDescriptor","./NodeTransformationProperty","./PropertyBag"],function(n,t,i,r,u,f,e,o){"use strict";function h(n){return new e(n)}function c(n){return new o(n,h)}function s(t){this._show=undefined;this._showSubscription=undefined;this._scale=undefined;this._scaleSubscription=undefined;this._minimumPixelSize=undefined;this._minimumPixelSizeSubscription=undefined;this._maximumScale=undefined;this._maximumScaleSubscription=undefined;this._incrementallyLoadTextures=undefined;this._incrementallyLoadTexturesSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._uri=undefined;this._uriSubscription=undefined;this._runAnimations=undefined;this._clampAnimations=undefined;this._runAnimationsSubscription=undefined;this._nodeTransformations=undefined;this._nodeTransformationsSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._silhouetteColor=undefined;this._silhouetteColorSubscription=undefined;this._silhouetteSize=undefined;this._silhouetteSizeSubscription=undefined;this._color=undefined;this._colorSubscription=undefined;this._colorBlendMode=undefined;this._colorBlendModeSubscription=undefined;this._colorBlendAmount=undefined;this._colorBlendAmountSubscription=undefined;this._clippingPlanes=undefined;this._clippingPlanesSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(s.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:f("show"),scale:f("scale"),minimumPixelSize:f("minimumPixelSize"),maximumScale:f("maximumScale"),incrementallyLoadTextures:f("incrementallyLoadTextures"),shadows:f("shadows"),uri:f("uri"),runAnimations:f("runAnimations"),clampAnimations:f("clampAnimations"),nodeTransformations:f("nodeTransformations",undefined,c),heightReference:f("heightReference"),distanceDisplayCondition:f("distanceDisplayCondition"),silhouetteColor:f("silhouetteColor"),silhouetteSize:f("silhouetteSize"),color:f("color"),colorBlendMode:f("colorBlendMode"),colorBlendAmount:f("colorBlendAmount"),clippingPlanes:f("clippingPlanes")}),s.prototype.clone=function(n){return t(n)?(n.show=this.show,n.scale=this.scale,n.minimumPixelSize=this.minimumPixelSize,n.maximumScale=this.maximumScale,n.incrementallyLoadTextures=this.incrementallyLoadTextures,n.shadows=this.shadows,n.uri=this.uri,n.runAnimations=this.runAnimations,n.clampAnimations=this.clampAnimations,n.nodeTransformations=this.nodeTransformations,n.heightReference=this._heightReference,n.distanceDisplayCondition=this.distanceDisplayCondition,n.silhouetteColor=this.silhouetteColor,n.silhouetteSize=this.silhouetteSize,n.color=this.color,n.colorBlendMode=this.colorBlendMode,n.colorBlendAmount=this.colorBlendAmount,n.clippingPlanes=this.clippingPlanes,n):new s(this)},s.prototype.merge=function(i){var u,f;if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.scale=n(this.scale,i.scale);this.minimumPixelSize=n(this.minimumPixelSize,i.minimumPixelSize);this.maximumScale=n(this.maximumScale,i.maximumScale);this.incrementallyLoadTextures=n(this.incrementallyLoadTextures,i.incrementallyLoadTextures);this.shadows=n(this.shadows,i.shadows);this.uri=n(this.uri,i.uri);this.runAnimations=n(this.runAnimations,i.runAnimations);this.clampAnimations=n(this.clampAnimations,i.clampAnimations);this.heightReference=n(this.heightReference,i.heightReference);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.silhouetteColor=n(this.silhouetteColor,i.silhouetteColor);this.silhouetteSize=n(this.silhouetteSize,i.silhouetteSize);this.color=n(this.color,i.color);this.colorBlendMode=n(this.colorBlendMode,i.colorBlendMode);this.colorBlendAmount=n(this.colorBlendAmount,i.colorBlendAmount);this.clippingPlanes=n(this.clippingPlanes,i.clippingPlanes);u=i.nodeTransformations;t(u)&&(f=this.nodeTransformations,t(f)?f.merge(u):this.nodeTransformations=new o(u,h))},s});t("DataSources/PathGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._material=undefined;this._materialSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._width=undefined;this._widthSubscription=undefined;this._resolution=undefined;this._resolutionSubscription=undefined;this._leadTime=undefined;this._leadTimeSubscription=undefined;this._trailTime=undefined;this._trailTimeSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),material:f("material"),width:e("width"),resolution:e("resolution"),leadTime:e("leadTime"),trailTime:e("trailTime"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.material=this.material,n.width=this.width,n.resolution=this.resolution,n.show=this.show,n.leadTime=this.leadTime,n.trailTime=this.trailTime,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.material=n(this.material,i.material);this.width=n(this.width,i.width);this.resolution=n(this.resolution,i.resolution);this.show=n(this.show,i.show);this.leadTime=n(this.leadTime,i.leadTime);this.trailTime=n(this.trailTime,i.trailTime);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/PlaneGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._plane=undefined;this._planeSubscription=undefined;this._dimensions=undefined;this._dimensionsSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),plane:e("plane"),dimensions:e("dimensions"),material:f("material"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.plane=this.plane,n.dimensions=this.dimensions,n.show=this.show,n.material=this.material,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.plane=n(this.plane,i.plane);this.dimensions=n(this.dimensions,i.dimensions);this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/PointGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createPropertyDescriptor"],function(n,t,i,r,u,f){"use strict";function e(t){this._color=undefined;this._colorSubscription=undefined;this._pixelSize=undefined;this._pixelSizeSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._show=undefined;this._showSubscription=undefined;this._scaleByDistance=undefined;this._scaleByDistanceSubscription=undefined;this._translucencyByDistance=undefined;this._translucencyByDistanceSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._disableDepthTestDistance=undefined;this._disableDepthTestDistanceSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},color:f("color"),pixelSize:f("pixelSize"),outlineColor:f("outlineColor"),outlineWidth:f("outlineWidth"),show:f("show"),scaleByDistance:f("scaleByDistance"),translucencyByDistance:f("translucencyByDistance"),heightReference:f("heightReference"),distanceDisplayCondition:f("distanceDisplayCondition"),disableDepthTestDistance:f("disableDepthTestDistance")}),e.prototype.clone=function(n){return t(n)?(n.color=this.color,n.pixelSize=this.pixelSize,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.show=this.show,n.scaleByDistance=this.scaleByDistance,n.translucencyByDistance=this._translucencyByDistance,n.heightReference=this.heightReference,n.distanceDisplayCondition=this.distanceDisplayCondition,n.disableDepthTestDistance=this.disableDepthTestDistance,n):new e(this)},e.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.color=n(this.color,i.color);this.pixelSize=n(this.pixelSize,i.pixelSize);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.show=n(this.show,i.show);this.scaleByDistance=n(this.scaleByDistance,i.scaleByDistance);this.translucencyByDistance=n(this._translucencyByDistance,i.translucencyByDistance);this.heightReference=n(this.heightReference,i.heightReference);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.disableDepthTestDistance=n(this.disableDepthTestDistance,i.disableDepthTestDistance)},e});t("DataSources/PolygonGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._hierarchy=undefined;this._hierarchySubscription=undefined;this._height=undefined;this._heightSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._extrudedHeight=undefined;this._extrudedHeightSubscription=undefined;this._extrudedHeightReference=undefined;this._extrudedHeightReferenceSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._stRotation=undefined;this._stRotationSubscription=undefined;this._perPositionHeight=undefined;this._perPositionHeightSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._closeTop=undefined;this._closeTopSubscription=undefined;this._closeBottom=undefined;this._closeBottomSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._classificationType=undefined;this._classificationTypeSubscription=undefined;this._zIndex=undefined;this._zIndexSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),material:f("material"),hierarchy:e("hierarchy"),height:e("height"),heightReference:e("heightReference"),extrudedHeight:e("extrudedHeight"),extrudedHeightReference:e("extrudedHeightReference"),granularity:e("granularity"),stRotation:e("stRotation"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),perPositionHeight:e("perPositionHeight"),closeTop:e("closeTop"),closeBottom:e("closeBottom"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition"),classificationType:e("classificationType"),zIndex:e("zIndex")}),o.prototype.clone=function(n){return t(n)?(n.show=this.show,n.material=this.material,n.hierarchy=this.hierarchy,n.height=this.height,n.heightReference=this.heightReference,n.extrudedHeight=this.extrudedHeight,n.extrudedHeightReference=this.extrudedHeightReference,n.granularity=this.granularity,n.stRotation=this.stRotation,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.perPositionHeight=this.perPositionHeight,n.closeTop=this.closeTop,n.closeBottom=this.closeBottom,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n.classificationType=this.classificationType,n.zIndex=this.zIndex,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.hierarchy=n(this.hierarchy,i.hierarchy);this.height=n(this.height,i.height);this.heightReference=n(this.heightReference,i.heightReference);this.extrudedHeight=n(this.extrudedHeight,i.extrudedHeight);this.extrudedHeightReference=n(this.extrudedHeightReference,i.extrudedHeightReference);this.granularity=n(this.granularity,i.granularity);this.stRotation=n(this.stRotation,i.stRotation);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.perPositionHeight=n(this.perPositionHeight,i.perPositionHeight);this.closeTop=n(this.closeTop,i.closeTop);this.closeBottom=n(this.closeBottom,i.closeBottom);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.classificationType=n(this.classificationType,i.classificationType);this.zIndex=n(this.zIndex,i.zIndex)},o});t("DataSources/PolylineGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._depthFailMaterial=undefined;this._depthFailMaterialSubscription=undefined;this._positions=undefined;this._positionsSubscription=undefined;this._followSurface=undefined;this._followSurfaceSubscription=undefined;this._clampToGround=undefined;this._clampToGroundSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._widthSubscription=undefined;this._width=undefined;this._widthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._zIndex=undefined;this._zIndexSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),material:f("material"),depthFailMaterial:f("depthFailMaterial"),positions:e("positions"),width:e("width"),followSurface:e("followSurface"),clampToGround:e("clampToGround"),granularity:e("granularity"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition"),zIndex:e("zIndex")}),o.prototype.clone=function(n){return t(n)?(n.show=this.show,n.material=this.material,n.depthFailMaterial=this.depthFailMaterial,n.positions=this.positions,n.width=this.width,n.followSurface=this.followSurface,n.clampToGround=this.clampToGround,n.granularity=this.granularity,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n.zIndex=this.zIndex,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.depthFailMaterial=n(this.depthFailMaterial,i.depthFailMaterial);this.positions=n(this.positions,i.positions);this.width=n(this.width,i.width);this.followSurface=n(this.followSurface,i.followSurface);this.clampToGround=n(this.clampToGround,i.clampToGround);this.granularity=n(this.granularity,i.granularity);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.zIndex=n(this.zIndex,i.zIndex)},o});t("DataSources/PolylineVolumeGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._positions=undefined;this._positionsSubscription=undefined;this._shape=undefined;this._shapeSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._cornerType=undefined;this._cornerTypeSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubsription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),material:f("material"),positions:e("positions"),shape:e("shape"),granularity:e("granularity"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),cornerType:e("cornerType"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.show=this.show,n.material=this.material,n.positions=this.positions,n.shape=this.shape,n.granularity=this.granularity,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.cornerType=this.cornerType,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.positions=n(this.positions,i.positions);this.shape=n(this.shape,i.shape);this.granularity=n(this.granularity,i.granularity);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.cornerType=n(this.cornerType,i.cornerType);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/RectangleGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._coordinates=undefined;this._coordinatesSubscription=undefined;this._height=undefined;this._heightSubscription=undefined;this._heightReference=undefined;this._heightReferenceSubscription=undefined;this._extrudedHeight=undefined;this._extrudedHeightSubscription=undefined;this._extrudedHeightReference=undefined;this._extrudedHeightReferenceSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._stRotation=undefined;this._stRotationSubscription=undefined;this._rotation=undefined;this._rotationSubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distancedisplayConditionSubscription=undefined;this._classificationType=undefined;this._classificationTypeSubscription=undefined;this._zIndex=undefined;this._zIndexSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),coordinates:e("coordinates"),material:f("material"),height:e("height"),heightReference:e("heightReference"),extrudedHeight:e("extrudedHeight"),extrudedHeightReference:e("extrudedHeightReference"),granularity:e("granularity"),stRotation:e("stRotation"),rotation:e("rotation"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition"),classificationType:e("classificationType"),zIndex:e("zIndex")}),o.prototype.clone=function(n){return t(n)?(n.show=this.show,n.coordinates=this.coordinates,n.material=this.material,n.height=this.height,n.heightReference=this.heightReference,n.extrudedHeight=this.extrudedHeight,n.extrudedHeightReference=this.extrudedHeightReference,n.granularity=this.granularity,n.stRotation=this.stRotation,n.rotation=this.rotation,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n.classificationType=this.classificationType,n.zIndex=this.zIndex,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.coordinates=n(this.coordinates,i.coordinates);this.material=n(this.material,i.material);this.height=n(this.height,i.height);this.heightReference=n(this.heightReference,i.heightReference);this.extrudedHeight=n(this.extrudedHeight,i.extrudedHeight);this.extrudedHeightReference=n(this.extrudedHeightReference,i.extrudedHeightReference);this.granularity=n(this.granularity,i.granularity);this.stRotation=n(this.stRotation,i.stRotation);this.rotation=n(this.rotation,i.rotation);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition);this.classificationType=n(this.classificationType,i.classificationType);this.zIndex=n(this.zIndex,i.zIndex)},o});t("DataSources/WallGraphics",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./createMaterialPropertyDescriptor","./createPropertyDescriptor"],function(n,t,i,r,u,f,e){"use strict";function o(t){this._show=undefined;this._showSubscription=undefined;this._material=undefined;this._materialSubscription=undefined;this._positions=undefined;this._positionsSubscription=undefined;this._minimumHeights=undefined;this._minimumHeightsSubscription=undefined;this._maximumHeights=undefined;this._maximumHeightsSubscription=undefined;this._granularity=undefined;this._granularitySubscription=undefined;this._fill=undefined;this._fillSubscription=undefined;this._outline=undefined;this._outlineSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this._shadows=undefined;this._shadowsSubscription=undefined;this._distanceDisplayCondition=undefined;this._distanceDisplayConditionSubscription=undefined;this._definitionChanged=new u;this.merge(n(t,n.EMPTY_OBJECT))}return i(o.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),material:f("material"),positions:e("positions"),minimumHeights:e("minimumHeights"),maximumHeights:e("maximumHeights"),granularity:e("granularity"),fill:e("fill"),outline:e("outline"),outlineColor:e("outlineColor"),outlineWidth:e("outlineWidth"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition")}),o.prototype.clone=function(n){return t(n)?(n.show=this.show,n.material=this.material,n.positions=this.positions,n.minimumHeights=this.minimumHeights,n.maximumHeights=this.maximumHeights,n.granularity=this.granularity,n.fill=this.fill,n.outline=this.outline,n.outlineColor=this.outlineColor,n.outlineWidth=this.outlineWidth,n.shadows=this.shadows,n.distanceDisplayCondition=this.distanceDisplayCondition,n):new o(this)},o.prototype.merge=function(i){if(!t(i))throw new r("source is required.");this.show=n(this.show,i.show);this.material=n(this.material,i.material);this.positions=n(this.positions,i.positions);this.minimumHeights=n(this.minimumHeights,i.minimumHeights);this.maximumHeights=n(this.maximumHeights,i.maximumHeights);this.granularity=n(this.granularity,i.granularity);this.fill=n(this.fill,i.fill);this.outline=n(this.outline,i.outline);this.outlineColor=n(this.outlineColor,i.outlineColor);this.outlineWidth=n(this.outlineWidth,i.outlineWidth);this.shadows=n(this.shadows,i.shadows);this.distanceDisplayCondition=n(this.distanceDisplayCondition,i.distanceDisplayCondition)},o});t("DataSources/Entity",["../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Quaternion","../Core/Transforms","../Scene/HeightReference","../Scene/GroundPrimitive","../Scene/GroundPolylinePrimitive","./BillboardGraphics","./BoxGraphics","./ConstantPositionProperty","./CorridorGraphics","./createPropertyDescriptor","./createRawPropertyDescriptor","./CylinderGraphics","./EllipseGraphics","./EllipsoidGraphics","./LabelGraphics","./ModelGraphics","./PathGraphics","./PlaneGraphics","./PointGraphics","./PolygonGraphics","./PolylineGraphics","./PolylineVolumeGraphics","./Property","./PropertyBag","./RectangleGraphics","./WallGraphics"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt){"use strict";function ri(n){return new d(n)}function ui(n){return nt(n,undefined,ri)}function bt(n,t){return nt(n,undefined,function(n){return n instanceof t?n:new t(n)})}function kt(n){n=u(n,u.EMPTY_OBJECT);var t=n.id;f(t)||(t=r());this._availability=undefined;this._id=t;this._definitionChanged=new s;this._name=n.name;this._show=u(n.show,!0);this._parent=undefined;this._propertyNames=["billboard","box","corridor","cylinder","description","ellipse","ellipsoid","label","model","orientation","path","plane","point","polygon","polyline","polylineVolume","position","properties","rectangle","viewFrom","wall"];this._billboard=undefined;this._billboardSubscription=undefined;this._box=undefined;this._boxSubscription=undefined;this._corridor=undefined;this._corridorSubscription=undefined;this._cylinder=undefined;this._cylinderSubscription=undefined;this._description=undefined;this._descriptionSubscription=undefined;this._ellipse=undefined;this._ellipseSubscription=undefined;this._ellipsoid=undefined;this._ellipsoidSubscription=undefined;this._label=undefined;this._labelSubscription=undefined;this._model=undefined;this._modelSubscription=undefined;this._orientation=undefined;this._orientationSubscription=undefined;this._path=undefined;this._pathSubscription=undefined;this._plane=undefined;this._planeSubscription=undefined;this._point=undefined;this._pointSubscription=undefined;this._polygon=undefined;this._polygonSubscription=undefined;this._polyline=undefined;this._polylineSubscription=undefined;this._polylineVolume=undefined;this._polylineVolumeSubscription=undefined;this._position=undefined;this._positionSubscription=undefined;this._properties=undefined;this._propertiesSubscription=undefined;this._rectangle=undefined;this._rectangleSubscription=undefined;this._viewFrom=undefined;this._viewFromSubscription=undefined;this._wall=undefined;this._wallSubscription=undefined;this._children=[];this.entityCollection=undefined;this.parent=n.parent;this.merge(n)}function dt(n,t,i){for(var e=t.length,r=0;r<e;r++){var u=t[r],f=u._show,o=!i&&f,s=i&&f;o!==s&&dt(u,u._children,i)}n._definitionChanged.raiseEvent(n,"isShowing",i,!i)}var ii=new t;e(kt.prototype,{availability:tt("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:tt("name"),show:{get:function(){return this._show},set:function(n){var i,t;if(!f(n))throw new o("value is required.");n!==this._show&&(i=this.isShowing,this._show=n,t=this.isShowing,i!==t&&dt(this,this._children,t),this._definitionChanged.raiseEvent(this,"show",n,!n))}},isShowing:{get:function(){return this._show&&(!f(this.entityCollection)||this.entityCollection.show)&&(!f(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(n){var t=this._parent,r,u,i;t!==n&&(r=this.isShowing,f(t)&&(u=t._children.indexOf(this),t._children.splice(u,1)),this._parent=n,f(n)&&n._children.push(this),i=this.isShowing,r!==i&&dt(this,this._children,i),this._definitionChanged.raiseEvent(this,"parent",n,t))}},propertyNames:{get:function(){return this._propertyNames}},billboard:bt("billboard",b),box:bt("box",k),corridor:bt("corridor",g),cylinder:bt("cylinder",it),description:nt("description"),ellipse:bt("ellipse",rt),ellipsoid:bt("ellipsoid",ut),label:bt("label",ft),model:bt("model",et),orientation:nt("orientation"),path:bt("path",ot),plane:bt("plane",st),point:bt("point",ht),polygon:bt("polygon",ct),polyline:bt("polyline",lt),polylineVolume:bt("polylineVolume",at),properties:bt("properties",yt),position:ui("position"),rectangle:bt("rectangle",pt),viewFrom:nt("viewFrom"),wall:bt("wall",wt)});kt.prototype.isAvailable=function(n){if(!f(n))throw new o("time is required.");var t=this._availability;return!f(t)||t.contains(n)};kt.prototype.addProperty=function(n){var t=this._propertyNames;if(!f(n))throw new o("propertyName is required.");if(t.indexOf(n)!==-1)throw new o(n+" is already a registered property.");if(n in this)throw new o(n+" is a reserved property name.");t.push(n);Object.defineProperty(this,n,tt(n,!0))};kt.prototype.removeProperty=function(n){var i=this._propertyNames,t=i.indexOf(n);if(!f(n))throw new o("propertyName is required.");if(t===-1)throw new o(n+" is not a registered property.");this._propertyNames.splice(t,1);delete this[n]};kt.prototype.merge=function(n){var e,t,r,i;if(!f(n))throw new o("source is required.");this.name=u(this.name,n.name);this.availability=u(n.availability,this.availability);var h=this._propertyNames,s=f(n._propertyNames)?n._propertyNames:Object.keys(n),c=s.length;for(e=0;e<c;e++)(t=s[e],t!=="parent")&&(r=this[t],i=n[t],f(r)||h.indexOf(t)!==-1||this.addProperty(t),f(i)&&(f(r)?f(r.merge)&&r.merge(i):this[t]=f(i.merge)&&f(i.clone)?i.clone():i))};var gt=new c,ni=new n,ti=new a;return kt.prototype.computeModelMatrix=function(n,t){var r,u;return(i.typeOf.object("time",n),r=vt.getValueOrUndefined(this._position,n,ni),!f(r))?undefined:(u=vt.getValueOrUndefined(this._orientation,n,ti),f(u)?l.fromRotationTranslation(c.fromQuaternion(u,gt),r,t):v.eastNorthUpToFixedFrame(r,undefined,t))},kt.prototype.computeModelMatrixForHeightReference=function(t,r,u,e,o){var p,s,a,w;return(i.typeOf.object("time",t),p=vt.getValueOrDefault(r,t,y.NONE),s=vt.getValueOrUndefined(this._position,t,ni),p===y.NONE||!f(s)||n.equalsEpsilon(s,n.ZERO,h.EPSILON8))?this.computeModelMatrix(t,o):(a=e.cartesianToCartographic(s,ii),p===y.CLAMP_TO_GROUND?a.height=u:a.height+=u,s=e.cartographicToCartesian(a,s),w=vt.getValueOrUndefined(this._orientation,t,ti),f(w)?l.fromRotationTranslation(c.fromQuaternion(w,gt),s,o):v.eastNorthUpToFixedFrame(s,undefined,o))},kt.supportsMaterialsforEntitiesOnTerrain=function(n){return p.supportsMaterials(n)},kt.supportsPolylinesOnTerrain=function(n){return w.isSupported(n)},kt});t("DataSources/GeometryUpdater",["../Core/Check","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/Event","../Core/Iso8601","../Core/oneTimeWarning","../Scene/ClassificationType","../Scene/ShadowMode","./ColorMaterialProperty","./ConstantProperty","./Entity","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(t){n.defined("options.entity",t.entity);n.defined("options.scene",t.scene);n.defined("options.geometryOptions",t.geometryOptions);n.defined("options.geometryPropertyName",t.geometryPropertyName);n.defined("options.observedPropertyNames",t.observedPropertyNames);var i=t.entity,r=t.geometryPropertyName;this._entity=i;this._scene=t.scene;this._fillEnabled=!1;this._isClosed=!1;this._onTerrain=!1;this._dynamic=!1;this._outlineEnabled=!1;this._geometryChanged=new s;this._showProperty=undefined;this._materialProperty=undefined;this._showOutlineProperty=undefined;this._outlineColorProperty=undefined;this._outlineWidth=1;this._shadowsProperty=undefined;this._distanceDisplayConditionProperty=undefined;this._classificationTypeProperty=undefined;this._options=t.geometryOptions;this._geometryPropertyName=r;this._id=r+"-"+i.id;this._observedPropertyNames=t.observedPropertyNames;this._supportsMaterialsforEntitiesOnTerrain=p.supportsMaterialsforEntitiesOnTerrain(t.scene)}var k=new v(t.WHITE),d=new y(!0),g=new y(!0),nt=new y(!1),tt=new y(t.BLACK),it=new y(a.DISABLED),rt=new y(new o),ut=new y(l.TERRAIN);return u(b.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!r(this._entity.availability)&&w.isConstant(this._showProperty)&&w.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!r(this._entity.availability)&&w.isConstant(this._showProperty)&&w.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}}),b.prototype.isOutlineVisible=function(n){var t=this._entity;return this._outlineEnabled&&t.isAvailable(n)&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)},b.prototype.isFilled=function(n){var t=this._entity;return this._fillEnabled&&t.isAvailable(n)&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)},b.prototype.createFillGeometryInstance=e.throwInstantiationError,b.prototype.createOutlineGeometryInstance=e.throwInstantiationError,b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){f(this)},b.prototype._isHidden=function(n,t){var i=t.show;return r(i)&&i.isConstant&&!i.getValue(h.MINIMUM_VALUE)},b.prototype._isOnTerrain=function(){return!1},b.prototype._getIsClosed=function(){return!0},b.prototype._isDynamic=e.throwInstantiationError,b.prototype._setStaticOptions=e.throwInstantiationError,b.prototype._onEntityPropertyChanged=function(n,t){var u,y,s,l;if(this._observedPropertyNames.indexOf(t)!==-1){if(u=this._entity[this._geometryPropertyName],!r(u)){(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));return}var e=u.fill,a=r(e)&&e.isConstant?e.getValue(h.MINIMUM_VALUE):!0,o=u.outline,f=r(o);if(f&&o.isConstant&&(f=o.getValue(h.MINIMUM_VALUE)),!a&&!f){(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));return}if(y=u.show,this._isHidden(n,u)){(this._fillEnabled||this._outlineEnabled)&&(this._fillEnabled=!1,this._outlineEnabled=!1,this._geometryChanged.raiseEvent(this));return}this._materialProperty=i(u.material,k);this._fillProperty=i(e,g);this._showProperty=i(y,d);this._showOutlineProperty=i(u.outline,nt);this._outlineColorProperty=f?i(u.outlineColor,tt):undefined;this._shadowsProperty=i(u.shadows,it);this._distanceDisplayConditionProperty=i(u.distanceDisplayCondition,rt);this._classificationTypeProperty=i(u.classificationType,ut);this._fillEnabled=a;s=this._isOnTerrain(n,u)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof v);f&&s&&(c(c.geometryOutlines),f=!1);this._onTerrain=s;this._outlineEnabled=f;this._isDynamic(n,u)?this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this)):(this._setStaticOptions(n,u),this._isClosed=this._getIsClosed(this._options),l=u.outlineWidth,this._outlineWidth=r(l)?l.getValue(h.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this))}},b.prototype.createDynamicUpdater=function(t,i){if(n.defined("primitives",t),n.defined("groundPrimitives",i),!this._dynamic)throw new e("This instance does not represent dynamic geometry.");return new this.constructor.DynamicGeometryUpdater(this,t,i)},b});t("DataSources/TerrainOffsetProperty",["../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Event","../Core/Iso8601","../Core/Math","../Scene/HeightReference","../Scene/SceneMode","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function a(u,f,s,h){var l,c;if(i.defined("scene",u),i.defined("positionProperty",f),this._scene=u,this._heightReference=s,this._extrudedHeightReference=h,this._positionProperty=f,this._position=new n,this._cartographicPosition=new t,this._normal=new n,this._definitionChanged=new e,this._terrainHeight=0,this._removeCallbackFunc=undefined,this._removeEventListener=undefined,this._removeModeListener=undefined,l=this,r(u.globe)&&(this._removeEventListener=u.terrainProviderChanged.addEventListener(function(){l._updateClamping()}),this._removeModeListener=u.morphComplete.addEventListener(function(){l._updateClamping()})),f.isConstant){if(c=f.getValue(o.MINIMUM_VALUE,v),!r(c)||n.equals(c,n.ZERO)||!r(u.globe))return;this._position=n.clone(c,this._position);this._updateClamping();this._normal=u.globe.ellipsoid.geodeticSurfaceNormal(c,this._normal)}}var v=new n,y=new t;return u(a.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}}),a.prototype._updateClamping=function(){function l(n){if(u.mode===c.SCENE3D){var t=e.cartesianToCartographic(n,y);i._terrainHeight=t.height}else i._terrainHeight=n.x;i.definitionChanged.raiseEvent()}r(this._removeCallbackFunc)&&this._removeCallbackFunc();var u=this._scene,t=u.globe,f=this._position;if(!r(t)||n.equals(f,n.ZERO)){this._terrainHeight=0;return}var e=t.ellipsoid,h=t._surface,i=this,o=e.cartesianToCartographic(f,this._cartographicPosition),s=t.getHeight(o);this._terrainHeight=r(s)?s:0;this._removeCallbackFunc=h.updateHeight(o,l)},a.prototype.getValue=function(t,i){var o=l.getValueOrDefault(this._heightReference,t,h.NONE),c=l.getValueOrDefault(this._extrudedHeightReference,t,h.NONE),f,u,e;return o===h.NONE&&c!==h.RELATIVE_TO_GROUND?(this._position=n.clone(n.ZERO,this._position),n.clone(n.ZERO,i)):this._positionProperty.isConstant?n.multiplyByScalar(this._normal,this._terrainHeight,i):(f=this._scene,u=this._positionProperty.getValue(t,v),!r(u)||n.equals(u,n.ZERO)||!r(f.globe))?n.clone(n.ZERO,i):n.equalsEpsilon(this._position,u,s.EPSILON10)?n.multiplyByScalar(this._normal,this._terrainHeight,i):(this._position=n.clone(u,this._position),this._updateClamping(),e=f.globe.ellipsoid.geodeticSurfaceNormal(u,this._normal),n.multiplyByScalar(e,this._terrainHeight,i))},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return r(this._removeEventListener)&&this._removeEventListener(),r(this._removeModeListener)&&this._removeModeListener(),r(this._removeCallbackFunc)&&this._removeCallbackFunc(),f(this)},a});t("DataSources/heightReferenceOnEntityPropertyChanged",["../Core/defaultValue","../Core/defined","./CallbackProperty","./GeometryUpdater","./TerrainOffsetProperty"],function(n,t,i,r,u){"use strict";function f(n,f,e,o){var s,h,c;(r.prototype._onEntityPropertyChanged.call(this,n,f,e,o),this._observedPropertyNames.indexOf(f)!==-1)&&(s=this._entity[this._geometryPropertyName],t(s))&&(t(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=undefined),h=s.heightReference,t(h)&&(c=new i(this._computeCenter.bind(this),!this._dynamic),this._terrainOffsetProperty=new u(this._scene,c,h)))}return f});t("DataSources/MaterialProperty",["../Core/Color","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Scene/Material"],function(n,t,i,r,u){"use strict";function f(){r.throwInstantiationError()}return i(f.prototype,{isConstant:{get:r.throwInstantiationError},definitionChanged:{get:r.throwInstantiationError}}),f.prototype.getType=r.throwInstantiationError,f.prototype.getValue=r.throwInstantiationError,f.prototype.equals=r.throwInstantiationError,f.getValue=function(i,r,f){var e;return t(r)&&(e=r.getType(i),t(e))?(t(f)&&f.type===e||(f=u.fromType(e)),r.getValue(i,f.uniforms),f):(t(f)&&f.type===u.ColorType||(f=u.fromType(u.ColorType)),n.clone(n.WHITE,f.uniforms.color),f)},f});t("DataSources/DynamicGeometryUpdater",["../Core/BoundingSphere","../Core/Check","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Scene/GroundPrimitive","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","../Scene/Primitive","./BoundingSphereState","./ColorMaterialProperty","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(n,i,r){t.defined("geometryUpdater",n);t.defined("primitives",i);t.defined("orderedGroundPrimitives",r);this._primitives=i;this._orderedGroundPrimitives=r;this._primitive=undefined;this._outlinePrimitive=undefined;this._geometryUpdater=n;this._options=n._options;this._entity=n._entity;this._material=undefined}return v.prototype._isHidden=function(n,t,i){return!n.isShowing||!n.isAvailable(i)||!a.getValueOrDefault(t.show,i,!0)},v.prototype._setOptions=u.throwInstantiationError,v.prototype.update=function(n){var y,r,p,w,b,d,g,ut;t.defined("time",n);var h=this._geometryUpdater,k=h._onTerrain,v=this._primitives,nt=this._orderedGroundPrimitives;if(k?nt.remove(this._primitive):(v.removeAndDestroy(this._primitive),v.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=undefined),this._primitive=undefined,y=this._entity,r=y[this._geometryUpdater._geometryPropertyName],this._setOptions(y,r,n),!this._isHidden(y,r,n)){if(p=this._geometryUpdater.shadowsProperty.getValue(n),w=this._options,!i(r.fill)||r.fill.getValue(n)){var tt=h.fillMaterialProperty,it=tt instanceof c,u,rt=h._getIsClosed(w);it?u=new o({closed:rt}):(b=l.getValue(n,tt,this._material),this._material=b,u=new e({material:b,translucent:b.isTranslucent(),closed:rt}));k?(w.vertexFormat=o.VERTEX_FORMAT,this._primitive=nt.add(new f({geometryInstances:this._geometryUpdater.createFillGeometryInstance(n),appearance:u,asynchronous:!1,shadows:p,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(n)}),a.getValueOrUndefined(this._geometryUpdater.zIndex,n))):(w.vertexFormat=u.vertexFormat,d=this._geometryUpdater.createFillGeometryInstance(n),it&&(u.translucent=d.attributes.color.value[3]!==255),this._primitive=v.add(new s({geometryInstances:d,appearance:u,asynchronous:!1,shadows:p})))}!k&&i(r.outline)&&r.outline.getValue(n)&&(g=this._geometryUpdater.createOutlineGeometryInstance(n),ut=a.getValueOrDefault(r.outlineWidth,n,1),this._outlinePrimitive=v.add(new s({geometryInstances:g,appearance:new o({flat:!0,translucent:g.attributes.color.value[3]!==255,renderState:{lineWidth:h._scene.clampLineWidth(ut)}}),asynchronous:!1,shadows:p})))}},v.prototype.getBoundingSphere=function(t){if(!i(t))throw new u("result is required.");var o=this._entity,f=this._primitive,e=this._outlinePrimitive,r;return i(f)&&f.show&&f.ready&&(r=f.getGeometryInstanceAttributes(o),i(r)&&i(r.boundingSphere))?(n.clone(r.boundingSphere,t),h.DONE):i(e)&&e.show&&e.ready&&(r=e.getGeometryInstanceAttributes(o),i(r)&&i(r.boundingSphere))?(n.clone(r.boundingSphere,t),h.DONE):i(f)&&!f.ready||i(e)&&!e.ready?h.PENDING:h.FAILED},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){var n=this._primitives,t=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?t.remove(this._primitive):n.removeAndDestroy(this._primitive);n.removeAndDestroy(this._outlinePrimitive);r(this)},v});t("DataSources/BoxGeometryUpdater",["../Core/BoxGeometry","../Core/BoxOutlineGeometry","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./heightReferenceOnEntityPropertyChanged","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function st(n){this.id=n;this.vertexFormat=undefined;this.dimensions=undefined;this.offsetAttribute=undefined}function it(n,t){nt.call(this,{entity:n,scene:t,geometryOptions:new st(n),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]});this._onEntityPropertyChanged(n,"box",n.box,undefined)}function rt(n,t,i){g.call(this,n,t,i)}var ut=i.ZERO,ft=new i,ot=new i,et=new u;return e(Object.create)&&(it.prototype=Object.create(nt.prototype),it.prototype.constructor=it),o(it.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),it.prototype.createFillGeometryInstance=function(t){var o;if(r.defined("time",t),!this._fillEnabled)throw new s("This instance does not represent a filled geometry.");var i=this._entity,a=i.isAvailable(t),p=new y(a&&i.isShowing&&this._showProperty.getValue(t)&&this._fillProperty.getValue(t)),w=this._distanceDisplayConditionProperty.getValue(t),b=h.fromDistanceDisplayCondition(w),l={show:p,distanceDisplayCondition:b,color:undefined,offset:undefined};return this._materialProperty instanceof d&&(e(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(o=this._materialProperty.color.getValue(t,et)),e(o)||(o=u.WHITE),l.color=f.fromColor(o)),e(this._options.offsetAttribute)&&(l.offset=v.fromCartesian3(tt.getValueOrDefault(this._terrainOffsetProperty,t,ut,ft))),new c({id:i,geometry:n.fromDimensions(this._options),modelMatrix:i.computeModelMatrixForHeightReference(t,i.box.heightReference,this._options.dimensions.z*.5,this._scene.mapProjection.ellipsoid),attributes:l})},it.prototype.createOutlineGeometryInstance=function(n){if(r.defined("time",n),!this._outlineEnabled)throw new s("This instance does not represent an outlined geometry.");var i=this._entity,l=i.isAvailable(n),a=tt.getValueOrDefault(this._outlineColorProperty,n,u.BLACK,et),p=this._distanceDisplayConditionProperty.getValue(n),o={show:new y(l&&i.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:f.fromColor(a),distanceDisplayCondition:h.fromDistanceDisplayCondition(p),offset:undefined};return e(this._options.offsetAttribute)&&(o.offset=v.fromCartesian3(tt.getValueOrDefault(this._terrainOffsetProperty,n,ut,ft))),new c({id:i,geometry:t.fromDimensions(this._options),modelMatrix:i.computeModelMatrixForHeightReference(n,i.box.heightReference,this._options.dimensions.z*.5,this._scene.mapProjection.ellipsoid),attributes:o})},it.prototype._computeCenter=function(n,t){return tt.getValueOrUndefined(this._entity.position,n,t)},it.prototype._isHidden=function(n,t){return!e(t.dimensions)||!e(n.position)||nt.prototype._isHidden.call(this,n,t)},it.prototype._isDynamic=function(n,t){return!n.position.isConstant||!tt.isConstant(n.orientation)||!t.dimensions.isConstant||!tt.isConstant(t.outlineWidth)},it.prototype._setStaticOptions=function(n,t){var r=tt.getValueOrDefault(t.heightReference,a.MINIMUM_VALUE,p.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof d?b.VERTEX_FORMAT:w.MaterialSupport.TEXTURED.vertexFormat;i.dimensions=t.dimensions.getValue(a.MINIMUM_VALUE,i.dimensions);i.offsetAttribute=r!==p.NONE?l.ALL:undefined},it.prototype._onEntityPropertyChanged=k,it.DynamicGeometryUpdater=rt,e(Object.create)&&(rt.prototype=Object.create(g.prototype),rt.prototype.constructor=rt),rt.prototype._isHidden=function(n,t,i){var r=tt.getValueOrUndefined(n.position,i,ot),u=this._options.dimensions;return!e(r)||!e(u)||g.prototype._isHidden.call(this,n,t,i)},rt.prototype._setOptions=function(n,t,i){var u=tt.getValueOrDefault(t.heightReference,i,p.NONE),r=this._options;r.dimensions=tt.getValueOrUndefined(t.dimensions,i,r.dimensions);r.offsetAttribute=u!==p.NONE?l.ALL:undefined},it});t("DataSources/CheckerboardMaterialProperty",["../Core/Cartesian2","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){n=i(n,i.EMPTY_OBJECT);this._definitionChanged=new f;this._evenColor=undefined;this._evenColorSubscription=undefined;this._oddColor=undefined;this._oddColorSubscription=undefined;this._repeat=undefined;this._repeatSubscription=undefined;this.evenColor=n.evenColor;this.oddColor=n.oddColor;this.repeat=n.repeat}var h=t.WHITE,c=t.BLACK,l=new n(2,2);return u(s.prototype,{isConstant:{get:function(){return o.isConstant(this._evenColor)&&o.isConstant(this._oddColor)&&o.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},evenColor:e("evenColor"),oddColor:e("oddColor"),repeat:e("repeat")}),s.prototype.getType=function(){return"Checkerboard"},s.prototype.getValue=function(n,t){return r(t)||(t={}),t.lightColor=o.getValueOrClonedDefault(this._evenColor,n,h,t.lightColor),t.darkColor=o.getValueOrClonedDefault(this._oddColor,n,c,t.darkColor),t.repeat=o.getValueOrDefault(this._repeat,n,l),t},s.prototype.equals=function(n){return this===n||n instanceof s&&o.equals(this._evenColor,n._evenColor)&&o.equals(this._oddColor,n._oddColor)&&o.equals(this._repeat,n._repeat)},s});t("DataSources/EntityCollection",["../Core/AssociativeArray","../Core/createGuid","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/Iso8601","../Core/JulianDate","../Core/RuntimeError","../Core/TimeInterval","./Entity"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function a(n){if(n._firing){n._refire=!0;return}if(n._suspendCount===0){var t=n._addedEntities,i=n._removedEntities,r=n._changedEntities;if(r.length!==0||t.length!==0||i.length!==0){n._firing=!0;do{n._refire=!1;var u=t.values.slice(0),f=i.values.slice(0),e=r.values.slice(0);t.removeAll();i.removeAll();r.removeAll();n._collectionChanged.raiseEvent(n,u,f,e)}while(n._refire);n._firing=!1}}}function l(i){this._owner=i;this._entities=new n;this._addedEntities=new n;this._removedEntities=new n;this._changedEntities=new n;this._suspendCount=0;this._collectionChanged=new f;this._id=t();this._show=!0;this._firing=!1;this._refire=!1}var v={id:undefined};return l.prototype.suspendEvents=function(){this._suspendCount++},l.prototype.resumeEvents=function(){if(this._suspendCount===0)throw new u("resumeEvents can not be called before suspendEvents.");this._suspendCount--;a(this)},l.collectionChangedEventCallback=undefined,r(l.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(n){var e,r;if(!i(n))throw new u("value is required.");if(n!==this._show){this.suspendEvents();for(var o=[],f=this._entities.values,s=f.length,t=0;t<s;t++)o.push(f[t].isShowing);for(this._show=n,t=0;t<s;t++)e=o[t],r=f[t],e!==r.isShowing&&r.definitionChanged.raiseEvent(r,"isShowing",r.isShowing,e);this.resumeEvents()}}},owner:{get:function(){return this._owner}}}),l.prototype.computeAvailability=function(){for(var l,r,u,f,n=e.MAXIMUM_VALUE,t=e.MINIMUM_VALUE,c=this._entities.values,s=0,a=c.length;s<a;s++)l=c[s],r=l.availability,i(r)&&(u=r.start,f=r.stop,o.lessThan(u,n)&&!u.equals(e.MINIMUM_VALUE)&&(n=u),o.greaterThan(f,t)&&!f.equals(e.MAXIMUM_VALUE)&&(t=f));return e.MAXIMUM_VALUE.equals(n)&&(n=e.MINIMUM_VALUE),e.MINIMUM_VALUE.equals(t)&&(t=e.MAXIMUM_VALUE),new h({start:n,stop:t})},l.prototype.add=function(n){if(!i(n))throw new u("entity is required.");n instanceof c||(n=new c(n));var t=n.id,r=this._entities;if(r.contains(t))throw new s("An entity with id "+t+" already exists in this collection.");return n.entityCollection=this,r.set(t,n),this._removedEntities.remove(t)||this._addedEntities.set(t,n),n.definitionChanged.addEventListener(l.prototype._onEntityDefinitionChanged,this),a(this),n},l.prototype.remove=function(n){return i(n)?this.removeById(n.id):!1},l.prototype.contains=function(n){if(!i(n))throw new u("entity is required");return this._entities.get(n.id)===n},l.prototype.removeById=function(n){if(!i(n))return!1;var r=this._entities,t=r.get(n);return this._entities.remove(n)?(this._addedEntities.remove(n)||(this._removedEntities.set(n,t),this._changedEntities.remove(n)),this._entities.remove(n),t.definitionChanged.removeEventListener(l.prototype._onEntityDefinitionChanged,this),a(this),!0):!1},l.prototype.removeAll=function(){for(var n=this._entities,e=n.length,o=n.values,u=this._addedEntities,s=this._removedEntities,t=0;t<e;t++){var r=o[t],f=r.id,h=u.get(f);i(h)||(r.definitionChanged.removeEventListener(l.prototype._onEntityDefinitionChanged,this),s.set(f,r))}n.removeAll();u.removeAll();this._changedEntities.removeAll();a(this)},l.prototype.getById=function(n){if(!i(n))throw new u("id is required.");return this._entities.get(n)},l.prototype.getOrCreateEntity=function(n){if(!i(n))throw new u("id is required.");var t=this._entities.get(n);return i(t)||(v.id=n,t=new c(v),this.add(t)),t},l.prototype._onEntityDefinitionChanged=function(n){var t=n.id;this._addedEntities.contains(t)||this._changedEntities.set(t,n);a(this)},l});t("DataSources/CompositeEntityCollection",["../Core/createGuid","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Math","./Entity","./EntityCollection"],function(n,t,i,r,u,f,e){"use strict";function a(n){for(var i=n.propertyNames,r=i.length,t=0;t<r;t++)n[i[t]]=undefined}function v(n,t,i,r){h[0]=i;h[1]=r.id;t[JSON.stringify(h)]=r.definitionChanged.addEventListener(o.prototype._onDefinitionChanged,n)}function y(n,t,i,r){h[0]=i;h[1]=r.id;var u=JSON.stringify(h);t[u]();t[u]=undefined}function s(n){var h,d;if(n._shouldRecomposite=!0,n._suspendCount===0){for(var b=n._collections,tt=b.length,g=n._collectionsCopy,it=g.length,r,l,u,s,p=n._composite,k=new e(n),nt=n._eventHash,w,i=0;i<it;i++)for(s=g[i],s.collectionChanged.removeEventListener(o.prototype._onCollectionChanged,n),l=s.values,w=s.id,u=l.length-1;u>-1;u--)r=l[u],y(n,nt,w,r);for(i=tt-1;i>=0;i--)for(s=b[i],s.collectionChanged.addEventListener(o.prototype._onCollectionChanged,n),l=s.values,w=s.id,u=l.length-1;u>-1;u--)r=l[u],v(n,nt,w,r),h=k.getById(r.id),t(h)||(h=p.getById(r.id),t(h)?a(h):(c.id=r.id,h=new f(c)),k.add(h)),h.merge(r);for(n._collectionsCopy=b.slice(0),p.suspendEvents(),p.removeAll(),d=k.values,i=0;i<d.length;i++)p.add(d[i]);p.resumeEvents()}}function o(i,r){this._owner=r;this._composite=new e(this);this._suspendCount=0;this._collections=t(i)?i.slice():[];this._collectionsCopy=[];this._id=n();this._eventHash={};s(this);this._shouldRecomposite=!1}function l(n,i){if(!t(i))throw new r("collection is required.");var u=n.indexOf(i);if(u===-1)throw new r("collection is not in this composite.");return u}function p(n,t,i){var r=n._collections,f;(t=u.clamp(t,0,r.length-1),i=u.clamp(i,0,r.length-1),t!==i)&&(f=r[t],r[t]=r[i],r[i]=f,s(n))}var c={id:undefined},h=new Array(2);return i(o.prototype,{collectionChanged:{get:function(){return this._composite._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._composite.values}},owner:{get:function(){return this._owner}}}),o.prototype.addCollection=function(n,i){var u=t(i);if(!t(n))throw new r("collection is required.");if(u)if(i<0)throw new r("index must be greater than or equal to zero.");else if(i>this._collections.length)throw new r("index must be less than or equal to the number of collections.");u?this._collections.splice(i,0,n):(i=this._collections.length,this._collections.push(n));s(this)},o.prototype.removeCollection=function(n){var t=this._collections.indexOf(n);return t!==-1?(this._collections.splice(t,1),s(this),!0):!1},o.prototype.removeAllCollections=function(){this._collections.length=0;s(this)},o.prototype.containsCollection=function(n){return this._collections.indexOf(n)!==-1},o.prototype.contains=function(n){return this._composite.contains(n)},o.prototype.indexOfCollection=function(n){return this._collections.indexOf(n)},o.prototype.getCollection=function(n){if(!t(n))throw new r("index is required.","index");return this._collections[n]},o.prototype.getCollectionsLength=function(){return this._collections.length},o.prototype.raiseCollection=function(n){var t=l(this._collections,n);p(this,t,t+1)},o.prototype.lowerCollection=function(n){var t=l(this._collections,n);p(this,t,t-1)},o.prototype.raiseCollectionToTop=function(n){var t=l(this._collections,n);t!==this._collections.length-1&&(this._collections.splice(t,1),this._collections.push(n),s(this))},o.prototype.lowerCollectionToBottom=function(n){var t=l(this._collections,n);t!==0&&(this._collections.splice(t,1),this._collections.splice(0,0,n),s(this))},o.prototype.suspendEvents=function(){this._suspendCount++;this._composite.suspendEvents()},o.prototype.resumeEvents=function(){if(this._suspendCount===0)throw new r("resumeEvents can not be called before suspendEvents.");this._suspendCount--;this._shouldRecomposite&&this._suspendCount===0&&(s(this),this._shouldRecomposite=!1);this._composite.resumeEvents()},o.prototype.computeAvailability=function(){return this._composite.computeAvailability()},o.prototype.getById=function(n){return this._composite.getById(n)},o.prototype._onCollectionChanged=function(n,i,r){var w=this._collectionsCopy,d=w.length,s=this._composite,b,l,tt,k,p;s.suspendEvents();for(var o,h,u,it=r.length,g=this._eventHash,nt=n.id,e=0;e<it;e++){for(b=r[e],y(this,g,nt,b),l=b.id,o=d-1;o>=0;o--)h=w[o].getById(l),t(h)&&(t(u)||(u=s.getById(l),a(u)),u.merge(h));t(u)||s.removeById(l);u=undefined}for(tt=i.length,e=0;e<tt;e++){for(k=i[e],v(this,g,nt,k),p=k.id,o=d-1;o>=0;o--)h=w[o].getById(p),t(h)&&(t(u)||(u=s.getById(p),t(u)?a(u):(c.id=p,u=new f(c),s.add(u))),u.merge(h));u=undefined}s.resumeEvents()},o.prototype._onDefinitionChanged=function(n,i){for(var o,r,s=this._collections,c=this._composite,l=s.length,a=n.id,f=c.getById(a),u=f[i],v=!t(u),h=!0,e=l-1;e>=0;e--)if(o=s[e].getById(n.id),t(o)&&(r=o[i],t(r))){if(h)if(h=!1,t(r.merge)&&t(r.clone))u=r.clone(u);else{u=r;break}u.merge(r)}v&&f.propertyNames.indexOf(i)===-1&&f.addProperty(i);f[i]=u},o});t("DataSources/CompositeProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/EventHelper","../Core/TimeIntervalCollection","./Property"],function(n,t,i,r,u,f,e){"use strict";function s(t,i,r,u){function s(){r.raiseEvent(t)}var h=[],o,f,e;for(i.removeAll(),o=u.length,f=0;f<o;f++)e=u.get(f),n(e.data)&&h.indexOf(e.data)===-1&&i.add(e.data.definitionChanged,s)}function o(){this._eventHelper=new u;this._definitionChanged=new r;this._intervals=new f;this._intervals.changedEvent.addEventListener(o.prototype._intervalsChanged,this)}return t(o.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),o.prototype.getValue=function(t,r){if(!n(t))throw new i("time is required");var u=this._intervals.findDataForIntervalContainingDate(t);return n(u)?u.getValue(t,r):undefined},o.prototype.equals=function(n){return this===n||n instanceof o&&this._intervals.equals(n._intervals,e.equals)},o.prototype._intervalsChanged=function(){s(this,this._eventHelper,this._definitionChanged,this._intervals);this._definitionChanged.raiseEvent(this)},o});t("DataSources/CompositeMaterialProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./CompositeProperty","./Property"],function(n,t,i,r,u,f){"use strict";function e(){this._definitionChanged=new r;this._composite=new u;this._composite.definitionChanged.addEventListener(e.prototype._raiseDefinitionChanged,this)}return t(e.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite._intervals}}}),e.prototype.getType=function(t){if(!n(t))throw new i("time is required");var r=this._composite._intervals.findDataForIntervalContainingDate(t);return n(r)?r.getType(t):undefined},e.prototype.getValue=function(t,r){if(!n(t))throw new i("time is required");var u=this._composite._intervals.findDataForIntervalContainingDate(t);return n(u)?u.getValue(t,r):undefined},e.prototype.equals=function(n){return this===n||n instanceof e&&this._composite.equals(n._composite,f.equals)},e.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},e});t("DataSources/CompositePositionProperty",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/ReferenceFrame","./CompositeProperty","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function s(t){this._referenceFrame=n(t,f.FIXED);this._definitionChanged=new u;this._composite=new e;this._composite.definitionChanged.addEventListener(s.prototype._raiseDefinitionChanged,this)}return i(s.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(n){this._referenceFrame=n}}}),s.prototype.getValue=function(n,t){return this.getValueInReferenceFrame(n,f.FIXED,t)},s.prototype.getValueInReferenceFrame=function(n,i,u){if(!t(n))throw new r("time is required.");if(!t(i))throw new r("referenceFrame is required.");var f=this._composite._intervals.findDataForIntervalContainingDate(n);return t(f)?f.getValueInReferenceFrame(n,i,u):undefined},s.prototype.equals=function(n){return this===n||n instanceof s&&this._referenceFrame===n._referenceFrame&&this._composite.equals(n._composite,o.equals)},s.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},s});t("DataSources/GroundGeometryUpdater",["../Core/ApproximateTerrainHeights","../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/oneTimeWarning","../Scene/HeightReference","./CallbackProperty","./ConstantProperty","./GeometryUpdater","./Property","./TerrainOffsetProperty"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function w(n){v.call(this,n);this._zIndex=0;this._terrainOffsetProperty=undefined}var b=new a(0);return u(Object.create)&&(w.prototype=Object.create(v.prototype),w.prototype.constructor=w),f(w.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),w.prototype._computeCenter=e.throwInstantiationError,w.prototype._onEntityPropertyChanged=function(n,t,i,f){var e,o,s,c;(v.prototype._onEntityPropertyChanged.call(this,n,t,i,f),this._observedPropertyNames.indexOf(t)!==-1)&&(e=this._entity[this._geometryPropertyName],u(e))&&(u(e.zIndex)&&(u(e.height)||u(e.extrudedHeight))&&h(h.geometryZIndex),this._zIndex=r(e.zIndex,b),u(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=undefined),o=e.heightReference,s=e.extrudedHeightReference,(u(o)||u(s))&&(c=new l(this._computeCenter.bind(this),!this._dynamic),this._terrainOffsetProperty=new p(this._scene,c,o,s)))},w.getGeometryHeight=function(n,t,i){var r=y.getValueOrDefault(t,i,c.NONE);return r!==c.CLAMP_TO_GROUND?y.getValueOrUndefined(n,i):0},w.getGeometryExtrudedHeight=function(n,t,i){var r=y.getValueOrDefault(t,i,c.NONE);return r!==c.CLAMP_TO_GROUND?y.getValueOrUndefined(n,i):w.CLAMP_TO_GROUND},w.CLAMP_TO_GROUND="clamp",w.computeGeometryOffsetAttribute=function(n,t,i){var u=y.getValueOrDefault(n,i,c.NONE),f=y.getValueOrDefault(t,i,c.NONE),r=0;return(u!==c.NONE&&r++,f===c.RELATIVE_TO_GROUND&&r++,r===2)?o.ALL:r===1?o.TOP:undefined},w});t("DataSources/CorridorGeometryUpdater",["../Core/ApproximateTerrainHeights","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/CorridorGeometry","../Core/CorridorOutlineGeometry","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/Rectangle","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./GroundGeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){"use strict";function ct(n){this.id=n;this.vertexFormat=undefined;this.positions=undefined;this.width=undefined;this.cornerType=undefined;this.height=undefined;this.extrudedHeight=undefined;this.granularity=undefined;this.offsetAttribute=undefined}function ut(n,t){it.call(this,{entity:n,scene:t,geometryOptions:new ct(n),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]});this._onEntityPropertyChanged(n,"corridor",n.corridor,undefined)}function ft(n,t,i){nt.call(this,n,t,i)}var et=new r,ot=t.ZERO,st=new t,ht=new y;return o(Object.create)&&(ut.prototype=Object.create(it.prototype),ut.prototype.constructor=ut),ut.prototype.createFillGeometryInstance=function(n){var t;if(i.defined("time",n),!this._fillEnabled)throw new s("This instance does not represent a filled geometry.");var e=this._entity,a=e.isAvailable(n),l={show:new p(a&&e.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),distanceDisplayCondition:h.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(n)),offset:undefined,color:undefined};return this._materialProperty instanceof g&&(o(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(n,et)),o(t)||(t=r.WHITE),l.color=u.fromColor(t)),o(this._options.offsetAttribute)&&(l.offset=v.fromCartesian3(rt.getValueOrDefault(this._terrainOffsetProperty,n,ot,st))),new c({id:e,geometry:new f(this._options),attributes:l})},ut.prototype.createOutlineGeometryInstance=function(n){if(i.defined("time",n),!this._outlineEnabled)throw new s("This instance does not represent an outlined geometry.");var t=this._entity,l=t.isAvailable(n),a=rt.getValueOrDefault(this._outlineColorProperty,n,r.BLACK,et),f={show:new p(l&&t.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:u.fromColor(a),distanceDisplayCondition:h.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(n)),offset:undefined};return o(this._options.offsetAttribute)&&(f.offset=v.fromCartesian3(rt.getValueOrDefault(this._terrainOffsetProperty,n,ot,st))),new c({id:t,geometry:new e(this._options),attributes:f})},ut.prototype._computeCenter=function(n,i){var r=rt.getValueOrUndefined(this._entity.corridor.positions,n);if(o(r)&&r.length!==0)return t.clone(r[Math.floor(r.length/2)],i)},ut.prototype._isHidden=function(n,t){return!o(t.positions)||!o(t.width)||tt.prototype._isHidden.call(this,n,t)},ut.prototype._isOnTerrain=function(n,t){return this._fillEnabled&&!o(t.height)&&!o(t.extrudedHeight)&&w.isSupported(this._scene)},ut.prototype._getIsClosed=function(n){var t=n.height,i=n.extrudedHeight;return t===0||o(i)&&i!==t},ut.prototype._isDynamic=function(n,t){return!t.positions.isConstant||!rt.isConstant(t.height)||!rt.isConstant(t.extrudedHeight)||!rt.isConstant(t.granularity)||!rt.isConstant(t.width)||!rt.isConstant(t.outlineWidth)||!rt.isConstant(t.cornerType)||!rt.isConstant(t.zIndex)||this._onTerrain&&!rt.isConstant(this._materialProperty)},ut.prototype._setStaticOptions=function(t,i){var s=i.height,e=i.heightReference,h=i.extrudedHeight,o=i.extrudedHeightReference,r=this._options,u;r.vertexFormat=this._materialProperty instanceof g?d.VERTEX_FORMAT:k.MaterialSupport.TEXTURED.vertexFormat;r.positions=i.positions.getValue(a.MINIMUM_VALUE,r.positions);r.width=i.width.getValue(a.MINIMUM_VALUE);r.granularity=rt.getValueOrUndefined(i.granularity,a.MINIMUM_VALUE);r.cornerType=rt.getValueOrUndefined(i.cornerType,a.MINIMUM_VALUE);r.offsetAttribute=it.computeGeometryOffsetAttribute(e,o,a.MINIMUM_VALUE);r.height=it.getGeometryHeight(s,e,a.MINIMUM_VALUE);u=it.getGeometryExtrudedHeight(h,o,a.MINIMUM_VALUE);u===it.CLAMP_TO_GROUND&&(u=n.getApproximateTerrainHeights(f.computeRectangle(r,ht)).minimumTerrainHeight);r.extrudedHeight=u},ut.DynamicGeometryUpdater=ft,o(Object.create)&&(ft.prototype=Object.create(nt.prototype),ft.prototype.constructor=ft),ft.prototype._isHidden=function(n,t,i){var r=this._options;return!o(r.positions)||!o(r.width)||nt.prototype._isHidden.call(this,n,t,i)},ft.prototype._setOptions=function(t,i,r){var u=this._options,h=i.height,o=i.heightReference,c=i.extrudedHeight,s=i.extrudedHeightReference,e;u.positions=rt.getValueOrUndefined(i.positions,r);u.width=rt.getValueOrUndefined(i.width,r);u.granularity=rt.getValueOrUndefined(i.granularity,r);u.cornerType=rt.getValueOrUndefined(i.cornerType,r);u.offsetAttribute=it.computeGeometryOffsetAttribute(o,s,r);u.height=it.getGeometryHeight(h,o,r);e=it.getGeometryExtrudedHeight(c,s,r);e===it.CLAMP_TO_GROUND&&(e=n.getApproximateTerrainHeights(f.computeRectangle(u,ht)).minimumTerrainHeight);u.extrudedHeight=e},ut});t("DataSources/DataSource",["../Core/defineProperties","../Core/DeveloperError"],function(n,t){"use strict";function i(){t.throwInstantiationError()}return n(i.prototype,{name:{get:t.throwInstantiationError},clock:{get:t.throwInstantiationError},entities:{get:t.throwInstantiationError},isLoading:{get:t.throwInstantiationError},changedEvent:{get:t.throwInstantiationError},errorEvent:{get:t.throwInstantiationError},loadingEvent:{get:t.throwInstantiationError},show:{get:t.throwInstantiationError},clustering:{get:t.throwInstantiationError}}),i.prototype.update=t.throwInstantiationError,i.setLoading=function(n,t){n._isLoading!==t&&(t?n._entityCollection.suspendEvents():n._entityCollection.resumeEvents(),n._isLoading=t,n._loading.raiseEvent(n,t))},i});t("Scene/SceneTransforms",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/defined","../Core/DeveloperError","../Core/Math","../Core/Matrix4","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Core/Transforms","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function w(n,t,u,f){var h=u.viewMatrix,e=s.multiplyByVector(h,r.fromElements(n.x,n.y,n.z,1,d),d),o=i.multiplyComponents(t,i.normalize(e,g),g);return e.x+=t.x+o.x,e.y+=t.y+o.y,e.z+=o.z,s.multiplyByVector(u.frustum.projectionMatrix,e,f)}var v={},et=new r(0,0,0,1),y=new r,ot=new n,b=new t,k=new t,d,g,p,tt,ft,nt;v.wgs84ToWindowCoordinates=function(n,t,r){return v.wgs84WithEyeOffsetToWindowCoordinates(n,t,i.ZERO,r)};d=new r;g=new i;var st=new u(Math.PI,o.PI_OVER_TWO),ht=new i,ct=new i;v.wgs84WithEyeOffsetToWindowCoordinates=function(n,r,u,p){var ut,nt,tt,g,d,ft,at,vt;if(!f(n))throw new e("scene is required.");if(!f(r))throw new e("position is required.");if(ut=n.frameState,nt=v.computeActualWgs84Position(ut,r,et),!f(nt))return undefined;if(tt=n.canvas,g=ot,g.x=0,g.y=0,g.width=tt.clientWidth,g.height=tt.clientHeight,d=n.camera,ft=!1,ut.mode===a.SCENE2D){var yt=n.mapProjection,pt=st,lt=yt.project(pt,ht),wt=i.clone(d.position,ct),bt=d.frustum.clone(),kt=s.computeViewportTransformation(g,0,1,new s),dt=d.frustum.projectionMatrix,rt=d.positionWC.y,gt=i.fromElements(o.sign(rt)*lt.x-rt,0,-d.positionWC.x),it=l.pointToGLWindowCoordinates(dt,kt,gt);rt===0||it.x<=0||it.x>=tt.clientWidth?ft=!0:(it.x>tt.clientWidth*.5?(g.width=it.x,d.frustum.right=lt.x-rt,y=w(nt,u,d,y),v.clipToGLWindowCoordinates(g,y,b),g.x+=it.x,d.position.x=-d.position.x,at=d.frustum.right,d.frustum.right=-d.frustum.left,d.frustum.left=-at,y=w(nt,u,d,y),v.clipToGLWindowCoordinates(g,y,k)):(g.x+=it.x,g.width-=it.x,d.frustum.left=-lt.x-rt,y=w(nt,u,d,y),v.clipToGLWindowCoordinates(g,y,b),g.x=g.x-g.width,d.position.x=-d.position.x,vt=d.frustum.left,d.frustum.left=-d.frustum.right,d.frustum.right=-vt,y=w(nt,u,d,y),v.clipToGLWindowCoordinates(g,y,k)),i.clone(wt,d.position),d.frustum=bt.clone(),p=t.clone(b,p),(p.x<0||p.x>tt.clientWidth)&&(p.x=k.x))}if(ut.mode!==a.SCENE2D||ft){if(y=w(nt,u,d,y),y.z<0&&!(d.frustum instanceof h)&&!(d.frustum instanceof c))return undefined;p=v.clipToGLWindowCoordinates(g,y,p)}return p.y=tt.clientHeight-p.y,p};v.wgs84ToDrawingBufferCoordinates=function(n,t,i){return(i=v.wgs84ToWindowCoordinates(n,t,i),!f(i))?undefined:v.transformWindowToDrawingBuffer(n,i,i)};p=new i;tt=new u;v.computeActualWgs84Position=function(n,t,r){var e=n.mode,s,h,u;return e===a.SCENE3D?i.clone(t,r):(s=n.mapProjection,h=s.ellipsoid.cartesianToCartographic(t,tt),!f(h))?undefined:(s.project(h,p),e===a.COLUMBUS_VIEW)?i.fromElements(p.z,p.x,p.y,r):e===a.SCENE2D?i.fromElements(0,p.x,p.y,r):(u=n.morphTime,i.fromElements(o.lerp(p.z,t.x,u),o.lerp(p.x,t.y,u),o.lerp(p.y,t.z,u),r))};var it=new i,rt=new i,ut=new s;return v.clipToGLWindowCoordinates=function(n,r,u){return i.divideByScalar(r,r.w,it),s.computeViewportTransformation(n,0,1,ut),s.multiplyByPoint(ut,it,rt),t.fromCartesian3(rt,u)},v.transformWindowToDrawingBuffer=function(n,i,r){var u=n.canvas,f=n.drawingBufferWidth/u.clientWidth,e=n.drawingBufferHeight/u.clientHeight;return t.fromElements(i.x*f,i.y*e,r)},ft=new r,nt=new r,v.drawingBufferToWgs84Coordinates=function(n,t,u,e){var k=n.context,p=k.uniformState,w=p.currentFrustum,y=w.x,a=w.y,v,l,h,c,b;return n.frameState.useLogDepth&&(u=Math.pow(2,u*o.log2(a+1))-1,u=a*(1-y/u)/(a-y)),v=n._view.passState.viewport,l=r.clone(r.UNIT_W,ft),l.x=(t.x-v.x)/v.width*2-1,l.y=(t.y-v.y)/v.height*2-1,l.z=u*2-1,l.w=1,c=n.camera.frustum,f(c.fovy)?(h=s.multiplyByVector(p.inverseViewProjection,l,nt),b=1/h.w,i.multiplyByScalar(h,b,h)):(f(c._offCenterFrustum)&&(c=c._offCenterFrustum),h=nt,h.x=(l.x*(c.right-c.left)+c.left+c.right)*.5,h.y=(l.y*(c.top-c.bottom)+c.bottom+c.top)*.5,h.z=(l.z*(y-a)-y-a)*.5,h.w=1,h=s.multiplyByVector(p.inverseView,h,h)),i.fromCartesian4(h,e)},v});t("Scene/Billboard",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Color","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/Matrix4","../Core/NearFarScalar","../Core/Resource","./HeightReference","./HorizontalOrigin","./SceneMode","./SceneTransforms","./VerticalOrigin"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function g(n,r){var u,g;if(n=o(n,o.EMPTY_OBJECT),s(n.disableDepthTestDistance)&&n.disableDepthTestDistance<0)throw new c("disableDepthTestDistance must be greater than or equal to 0.0.");var h=n.translucencyByDistance,a=n.pixelOffsetScaleByDistance,y=n.scaleByDistance,k=n.distanceDisplayCondition;if(s(h)){if(h.far<=h.near)throw new c("translucencyByDistance.far must be greater than translucencyByDistance.near.");h=v.clone(h)}if(s(a)){if(a.far<=a.near)throw new c("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");a=v.clone(a)}if(s(y)){if(y.far<=y.near)throw new c("scaleByDistance.far must be greater than scaleByDistance.near.");y=v.clone(y)}if(s(k)){if(k.far<=k.near)throw new c("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");k=l.clone(k)}this._show=o(n.show,!0);this._position=i.clone(o(n.position,i.ZERO));this._actualPosition=i.clone(this._position);this._pixelOffset=t.clone(o(n.pixelOffset,t.ZERO));this._translate=new t(0,0);this._eyeOffset=i.clone(o(n.eyeOffset,i.ZERO));this._heightReference=o(n.heightReference,p.NONE);this._verticalOrigin=o(n.verticalOrigin,d.CENTER);this._horizontalOrigin=o(n.horizontalOrigin,w.CENTER);this._scale=o(n.scale,1);this._color=f.clone(o(n.color,f.WHITE));this._rotation=o(n.rotation,0);this._alignedAxis=i.clone(o(n.alignedAxis,i.ZERO));this._width=n.width;this._height=n.height;this._scaleByDistance=y;this._translucencyByDistance=h;this._pixelOffsetScaleByDistance=a;this._sizeInMeters=o(n.sizeInMeters,!1);this._distanceDisplayCondition=k;this._disableDepthTestDistance=n.disableDepthTestDistance;this._id=n.id;this._collection=o(n.collection,r);this._pickId=undefined;this._pickPrimitive=o(n._pickPrimitive,this);this._billboardCollection=r;this._dirty=!1;this._index=-1;this._batchIndex=undefined;this._imageIndex=-1;this._imageIndexPromise=undefined;this._imageId=undefined;this._image=undefined;this._imageSubRegion=undefined;this._imageWidth=undefined;this._imageHeight=undefined;this._labelDimensions=undefined;this._labelHorizontalOrigin=undefined;this._labelTranslate=undefined;u=n.image;g=n.imageId;s(u)&&(s(g)||(g=typeof u=="string"?u:s(u.src)?u.src:e()),this._imageId=g,this._image=u);s(n.imageSubRegion)&&(this._imageId=g,this._imageSubRegion=n.imageSubRegion);s(this._billboardCollection._textureAtlas)&&this._loadImage();this._actualClampedPosition=undefined;this._removeCallbackFunc=undefined;this._mode=b.SCENE3D;this._clusterShow=!0;this._updateClamping()}function nt(n,t){var i=n._billboardCollection;s(i)&&(i._updateBillboard(n,t),n._dirty=!0)}var st=g.SHOW_INDEX=0,rt=g.POSITION_INDEX=1,ht=g.PIXEL_OFFSET_INDEX=2,lt=g.EYE_OFFSET_INDEX=3,at=g.HORIZONTAL_ORIGIN_INDEX=4,vt=g.VERTICAL_ORIGIN_INDEX=5,yt=g.SCALE_INDEX=6,ut=g.IMAGE_INDEX_INDEX=7,ct=g.COLOR_INDEX=8,pt=g.ROTATION_INDEX=9,wt=g.ALIGNED_AXIS_INDEX=10,bt=g.SCALE_BY_DISTANCE_INDEX=11,kt=g.TRANSLUCENCY_BY_DISTANCE_INDEX=12,dt=g.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,gt=g.DISTANCE_DISPLAY_CONDITION=14,ni=g.DISABLE_DEPTH_DISTANCE=15,tt,ft,et,ot,it;return g.TEXTURE_COORDINATE_BOUNDS=16,g.NUMBER_OF_PROPERTIES=17,h(g.prototype,{show:{get:function(){return this._show},set:function(n){if(!s(n))throw new c("value is required.");this._show!==n&&(this._show=n,nt(this,st))}},position:{get:function(){return this._position},set:function(n){if(!s(n))throw new c("value is required.");var t=this._position;i.equals(t,n)||(i.clone(n,t),i.clone(n,this._actualPosition),this._updateClamping(),nt(this,rt))}},heightReference:{get:function(){return this._heightReference},set:function(n){if(!s(n))throw new c("value is required.");var t=this._heightReference;n!==t&&(this._heightReference=n,this._updateClamping(),nt(this,rt))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(n){if(!s(n))throw new c("value is required.");var i=this._pixelOffset;t.equals(i,n)||(t.clone(n,i),nt(this,ht))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(n){if(s(n)&&n.far<=n.near)throw new c("far distance must be greater than near distance.");var t=this._scaleByDistance;v.equals(t,n)||(this._scaleByDistance=v.clone(n,t),nt(this,bt))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(n){if(s(n)&&n.far<=n.near)throw new c("far distance must be greater than near distance.");var t=this._translucencyByDistance;v.equals(t,n)||(this._translucencyByDistance=v.clone(n,t),nt(this,kt))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(n){if(s(n)&&n.far<=n.near)throw new c("far distance must be greater than near distance.");var t=this._pixelOffsetScaleByDistance;v.equals(t,n)||(this._pixelOffsetScaleByDistance=v.clone(n,t),nt(this,dt))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(n){if(!s(n))throw new c("value is required.");var t=this._eyeOffset;i.equals(t,n)||(i.clone(n,t),nt(this,lt))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(n){if(!s(n))throw new c("value is required.");this._horizontalOrigin!==n&&(this._horizontalOrigin=n,nt(this,at))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(n){if(!s(n))throw new c("value is required.");this._verticalOrigin!==n&&(this._verticalOrigin=n,nt(this,vt))}},scale:{get:function(){return this._scale},set:function(n){if(!s(n))throw new c("value is required.");this._scale!==n&&(this._scale=n,nt(this,yt))}},color:{get:function(){return this._color},set:function(n){if(!s(n))throw new c("value is required.");var t=this._color;f.equals(t,n)||(f.clone(n,t),nt(this,ct))}},rotation:{get:function(){return this._rotation},set:function(n){if(!s(n))throw new c("value is required.");this._rotation!==n&&(this._rotation=n,nt(this,pt))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(n){if(!s(n))throw new c("value is required.");var t=this._alignedAxis;i.equals(t,n)||(i.clone(n,t),nt(this,wt))}},width:{get:function(){return o(this._width,this._imageWidth)},set:function(n){this._width!==n&&(this._width=n,nt(this,ut))}},height:{get:function(){return o(this._height,this._imageHeight)},set:function(n){this._height!==n&&(this._height=n,nt(this,ut))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(n){this._sizeInMeters!==n&&(this._sizeInMeters=n,nt(this,ct))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(n){if(!l.equals(n,this._distanceDisplayCondition)){if(s(n)&&n.far<=n.near)throw new c("far distance must be greater than near distance.");this._distanceDisplayCondition=l.clone(n,this._distanceDisplayCondition);nt(this,gt)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(n){if(this._disableDepthTestDistance!==n){if(s(n)&&n<0)throw new c("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=n;nt(this,ni)}}},id:{get:function(){return this._id},set:function(n){this._id=n;s(this._pickId)&&(this._pickId.object.id=n)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(n){this._pickPrimitive=n;s(this._pickId)&&(this._pickId.object.primitive=n)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(n){s(n)?typeof n=="string"?this.setImage(n,n):n instanceof y?this.setImage(n.url,n):s(n.src)?this.setImage(n.src,n):this.setImage(e(),n):(this._imageIndex=-1,this._imageSubRegion=undefined,this._imageId=undefined,this._image=undefined,this._imageIndexPromise=undefined,nt(this,ut))}},ready:{get:function(){return this._imageIndex!==-1}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(n){this._actualClampedPosition=i.clone(n,this._actualClampedPosition);nt(this,rt)}},clusterShow:{get:function(){return this._clusterShow},set:function(n){this._clusterShow!==n&&(this._clusterShow=n,nt(this,st))}}}),g.prototype.getPickId=function(n){return s(this._pickId)||(this._pickId=n.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId},g.prototype._updateClamping=function(){g._updateClamping(this._billboardCollection,this)},tt=new u,ft=new i,g._updateClamping=function(n,t){function a(n){if(t._heightReference===p.RELATIVE_TO_GROUND)if(t._mode===b.SCENE3D){var u=e.cartesianToCartographic(n,tt);u.height+=r.height;e.cartographicToCartesian(u,n)}else n.x+=r.height;t._clampedPosition=i.clone(n,t._clampedPosition)}var f=n._scene,r,h;if(!s(f)||!s(f.globe)){if(t._heightReference!==p.NONE)throw new c("Height reference is not supported without a scene and globe.");return}var o=f.globe,e=o.ellipsoid,v=o._surface,l=f.frameState.mode,y=l!==t._mode;if(t._mode=l,(t._heightReference===p.NONE||y)&&s(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=undefined,t._clampedPosition=undefined),t._heightReference!==p.NONE&&s(t._position)){if(r=e.cartesianToCartographic(t._position),!s(r)){t._actualClampedPosition=undefined;return}s(t._removeCallbackFunc)&&t._removeCallbackFunc();t._removeCallbackFunc=v.updateHeight(r,a);u.clone(r,tt);h=o.getHeight(r);s(h)&&(tt.height=h);e.cartographicToCartesian(tt,ft);a(ft)}},g.prototype._loadImage=function(){var i=this._billboardCollection._textureAtlas,u=this._imageId,f=this._image,e=this._imageSubRegion,r,t;(s(f)&&(r=i.addImage(u,f)),s(e)&&(r=i.addSubRegion(u,e)),this._imageIndexPromise=r,s(r))&&(t=this,r.then(function(r){if(t._imageId===u&&t._image===f&&n.equals(t._imageSubRegion,e)){var o=i.textureCoordinates[r];t._imageWidth=i.texture.width*o.width;t._imageHeight=i.texture.height*o.height;t._imageIndex=r;t._ready=!0;t._image=undefined;t._imageIndexPromise=undefined;nt(t,ut)}}).otherwise(function(n){console.error("Error loading image for billboard: "+n);t._imageIndexPromise=undefined}))},g.prototype.setImage=function(n,t){if(!s(n))throw new c("id is required.");if(!s(t))throw new c("image is required.");this._imageId!==n&&(this._imageIndex=-1,this._imageSubRegion=undefined,this._imageId=n,this._image=t,s(this._billboardCollection._textureAtlas)&&this._loadImage())},g.prototype.setImageSubRegion=function(t,i){if(!s(t))throw new c("id is required.");if(!s(i))throw new c("subRegion is required.");this._imageId===t&&n.equals(this._imageSubRegion,i)||(this._imageIndex=-1,this._imageId=t,this._imageSubRegion=n.clone(i),s(this._billboardCollection._textureAtlas)&&this._loadImage())},g.prototype._setTranslate=function(n){if(!s(n))throw new c("value is required.");var i=this._translate;t.equals(i,n)||(t.clone(n,i),nt(this,ht))},g.prototype._getActualPosition=function(){return s(this._clampedPosition)?this._clampedPosition:this._actualPosition},g.prototype._setActualPosition=function(n){s(this._clampedPosition)||i.clone(n,this._actualPosition);nt(this,rt)},et=new r,g._computeActualPosition=function(n,t,i,r){return s(n._clampedPosition)?(i.mode!==n._mode&&n._updateClamping(),n._clampedPosition):i.mode===b.SCENE3D?t:(a.multiplyByPoint(r,t,et),k.computeActualWgs84Position(i,et))},ot=new i,g._computeScreenSpacePosition=function(n,i,r,u,f,e){var h=a.multiplyByPoint(n,i,ot),o=k.wgs84WithEyeOffsetToWindowCoordinates(f,h,r,e);return s(o)?(t.add(o,u,o),o):undefined},it=new t(0,0),g.prototype.computeScreenSpacePosition=function(n,i){var f=this._billboardCollection,u,r;if(s(i)||(i=new t),!s(f))throw new c("Billboard must be in a collection.  Was it removed?");if(!s(n))throw new c("scene is required.");if(t.clone(this._pixelOffset,it),t.add(it,this._translate,it),u=f.modelMatrix,r=this._position,s(this._clampedPosition)&&(r=this._clampedPosition,n.mode!==b.SCENE3D)){var e=n.mapProjection,o=e.ellipsoid,h=e.unproject(r,tt);r=o.cartographicToCartesian(h,ot);u=a.IDENTITY}return g._computeScreenSpacePosition(u,r,this._eyeOffset,it,n,i)},g.getScreenSpaceBoundingBox=function(t,i,r){var u=t.width,f=t.height,h=t.scale,e,o;return u*=h,f*=h,e=i.x,t.horizontalOrigin===w.RIGHT?e-=u:t.horizontalOrigin===w.CENTER&&(e-=u*.5),o=i.y,t.verticalOrigin===d.BOTTOM||t.verticalOrigin===d.BASELINE?o-=f:t.verticalOrigin===d.CENTER&&(o-=f*.5),s(r)||(r=new n),r.x=e,r.y=o,r.width=u,r.height=f,r},g.prototype.equals=function(r){return this===r||s(r)&&this._id===r._id&&i.equals(this._position,r._position)&&this._imageId===r._imageId&&this._show===r._show&&this._scale===r._scale&&this._verticalOrigin===r._verticalOrigin&&this._horizontalOrigin===r._horizontalOrigin&&this._heightReference===r._heightReference&&n.equals(this._imageSubRegion,r._imageSubRegion)&&f.equals(this._color,r._color)&&t.equals(this._pixelOffset,r._pixelOffset)&&t.equals(this._translate,r._translate)&&i.equals(this._eyeOffset,r._eyeOffset)&&v.equals(this._scaleByDistance,r._scaleByDistance)&&v.equals(this._translucencyByDistance,r._translucencyByDistance)&&v.equals(this._pixelOffsetScaleByDistance,r._pixelOffsetScaleByDistance)&&l.equals(this._distanceDisplayCondition,r._distanceDisplayCondition)&&this._disableDepthTestDistance===r._disableDepthTestDistance},g.prototype._destroy=function(){s(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=undefined);s(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=undefined);this.image=undefined;this._pickId=this._pickId&&this._pickId.destroy();this._billboardCollection=undefined},g});t("Renderer/VertexArrayFacade",["../Core/Check","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/Math","./Buffer","./BufferUsage","./VertexArray"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(u,e,o,s){function d(n,i){return t.getSizeInBytes(i.componentDatatype)-t.getSizeInBytes(n.componentDatatype)}var p,y,v;if(n.defined("context",u),!e||e.length===0)throw new f("At least one attribute is required.");p=c._verifyAttributes(e);o=i(o,0);var w=[],a={},h,l,k=p.length;for(y=0;y<k;++y){if(v=p[y],v.vertexBuffer){w.push(v);continue}l=v.usage;h=a[l];r(h)||(h=a[l]=[]);h.push(v)}this._allBuffers=[];for(l in a)if(a.hasOwnProperty(l)){h=a[l];h.sort(d);var b=c._vertexSizeInBytes(h),g=h[0].usage,nt={vertexSizeInBytes:b,vertexBuffer:undefined,usage:g,needsCommit:!1,arrayBuffer:undefined,arrayViews:c._createArrayViews(h,b)};this._allBuffers.push(nt)}this._size=0;this._instanced=i(s,!1);this._precreated=w;this._context=u;this.writers=undefined;this.va=undefined;this.resize(o)}function v(n,t){if(t.needsCommit&&t.vertexSizeInBytes>0){t.needsCommit=!1;var i=t.vertexBuffer,f=n._size*t.vertexSizeInBytes,u=r(i);if(!u||i.sizeInBytes<f)return u&&i.destroy(),t.vertexBuffer=o.createVertexBuffer({context:n._context,typedArray:t.arrayBuffer,usage:t.usage}),t.vertexBuffer.vertexArrayDestroyable=!1,!0;t.vertexBuffer.copyFromArrayView(t.arrayBuffer)}return!1}function y(n,t,i){if(n.needsCommit&&n.vertexSizeInBytes>0){var r=n.vertexSizeInBytes*t,u=n.vertexSizeInBytes*i;n.vertexBuffer.copyFromArrayView(new Uint8Array(n.arrayBuffer,r,u),r)}}function l(n){var i=n.va,u,t;if(r(i)){for(u=i.length,t=0;t<u;++t)i[t].va.destroy();n.va=undefined}}c._verifyAttributes=function(n){for(var r,u,a,l,h,v,c,e=[],o=0;o<n.length;++o){if(r=n[o],u={index:i(r.index,o),enabled:i(r.enabled,!0),componentsPerAttribute:r.componentsPerAttribute,componentDatatype:i(r.componentDatatype,t.FLOAT),normalize:i(r.normalize,!1),vertexBuffer:r.vertexBuffer,usage:i(r.usage,s.STATIC_DRAW)},e.push(u),u.componentsPerAttribute!==1&&u.componentsPerAttribute!==2&&u.componentsPerAttribute!==3&&u.componentsPerAttribute!==4)throw new f("attribute.componentsPerAttribute must be in the range [1, 4].");if(a=u.componentDatatype,!t.validate(a))throw new f("Attribute must have a valid componentDatatype or not specify it.");if(!s.validate(u.usage))throw new f("Attribute must have a valid usage or not specify it.");}for(l=new Array(e.length),h=0;h<e.length;++h){if(v=e[h],c=v.index,l[c])throw new f("Index "+c+" is used by more than one attribute.");l[c]=!0}return e};c._vertexSizeInBytes=function(n){for(var u,i=0,e=n.length,r=0;r<e;++r)u=n[r],i+=u.componentsPerAttribute*t.getSizeInBytes(u.componentDatatype);var f=e>0?t.getSizeInBytes(n[0].componentDatatype):0,o=f>0?i%f:0,s=o===0?0:f-o;return i+s};c._createArrayViews=function(n,i){for(var r,u,e=[],o=0,s=n.length,f=0;f<s;++f)r=n[f],u=r.componentDatatype,e.push({index:r.index,enabled:r.enabled,componentsPerAttribute:r.componentsPerAttribute,componentDatatype:u,normalize:r.normalize,offsetInBytes:o,vertexSizeInComponentType:i/t.getSizeInBytes(u),view:undefined}),o+=r.componentsPerAttribute*t.getSizeInBytes(u);return e};c.prototype.resize=function(n){var i,t,u,r;for(this._size=n,i=this._allBuffers,this.writers=[],t=0,u=i.length;t<u;++t)r=i[t],c._resize(r,this._size),c._appendWriters(this.writers,r);l(this)};c._resize=function(n,i){var f,u,s,c,e,o;if(n.vertexSizeInBytes>0){if(f=new ArrayBuffer(i*n.vertexSizeInBytes),r(n.arrayBuffer)){var l=new Uint8Array(f),h=new Uint8Array(n.arrayBuffer),a=h.length;for(u=0;u<a;++u)l[u]=h[u]}for(s=n.arrayViews,c=s.length,e=0;e<c;++e)o=s[e],o.view=t.createArrayBufferView(o.componentDatatype,f,o.offsetInBytes);n.arrayBuffer=f}};var a=[function(n,t,i){return function(r,u){t[r*i]=u;n.needsCommit=!0}},function(n,t,i){return function(r,u,f){var e=r*i;t[e]=u;t[e+1]=f;n.needsCommit=!0}},function(n,t,i){return function(r,u,f,e){var o=r*i;t[o]=u;t[o+1]=f;t[o+2]=e;n.needsCommit=!0}},function(n,t,i){return function(r,u,f,e,o){var s=r*i;t[s]=u;t[s+1]=f;t[s+2]=e;t[s+3]=o;n.needsCommit=!0}}];return c._appendWriters=function(n,t){for(var i,u=t.arrayViews,f=u.length,r=0;r<f;++r)i=u[r],n[i.index]=a[i.componentsPerAttribute-1](t,i.view,i.vertexSizeInComponentType)},c.prototype.commit=function(n){for(var a=!1,o=this._allBuffers,i,p,y,u,f,w,t=0,s=o.length;t<s;++t)i=o[t],a=v(this,i)||a;if(a||!r(this.va))for(l(this),p=this.va=[],y=r(n)?Math.ceil(this._size/(e.SIXTY_FOUR_KILOBYTES-1)):1,u=0;u<y;++u){for(f=[],t=0,s=o.length;t<s;++t)i=o[t],w=u*i.vertexSizeInBytes*(e.SIXTY_FOUR_KILOBYTES-1),c._appendAttributes(f,i,w,this._instanced);f=f.concat(this._precreated);p.push({va:new h({context:this._context,attributes:f,indexBuffer:n}),indicesCount:1.5*(u!==y-1?e.SIXTY_FOUR_KILOBYTES-1:this._size%(e.SIXTY_FOUR_KILOBYTES-1))})}},c._appendAttributes=function(n,t,i,r){for(var u,e=t.arrayViews,o=e.length,f=0;f<o;++f)u=e[f],n.push({index:u.index,enabled:u.enabled,componentsPerAttribute:u.componentsPerAttribute,componentDatatype:u.componentDatatype,normalize:u.normalize,vertexBuffer:t.vertexBuffer,offsetInBytes:i+u.offsetInBytes,strideInBytes:t.vertexSizeInBytes,instanceDivisor:r?1:0})},c.prototype.subCommit=function(n,t){var r,i,u;if(n<0||n>=this._size)throw new f("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(n+t>this._size)throw new f("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");for(r=this._allBuffers,i=0,u=r.length;i<u;++i)y(r[i],n,t)},c.prototype.endSubCommits=function(){for(var t=this._allBuffers,n=0,i=t.length;n<i;++n)t[n].needsCommit=!1},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){for(var n,i=this._allBuffers,t=0,r=i.length;t<r;++t)n=i[t],n.vertexBuffer=n.vertexBuffer&&n.vertexBuffer.destroy();return l(this),u(this)},c});t("Shaders/BillboardCollectionFS",[],function(){"use strict";return"uniform sampler2D u_atlas;\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_textureCoordinates;\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nfloat getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)\n{\nvec2 lookupVector = imageSize * (depthLookupST - adjustedST);\nlookupVector = v_rotationMatrix * lookupVector;\nvec2 labelOffset = (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y));\nvec2 translation = v_originTextureCoordinateAndTranslate.zw;\nif (applyTranslate)\n{\ntranslation += (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));\n}\nvec2 st = ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;\nfloat logDepthOrDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, st));\nif (logDepthOrDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec4 color = texture2D(u_atlas, v_textureCoordinates) * v_color;\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\nif (color.a < 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\nif (color.a < 0.995)\n{\ndiscard;\n}\n#else\nif (color.a >= 0.995)\n{\ndiscard;\n}\n#endif\n#endif\n#ifdef VECTOR_TILE\ncolor *= u_highlightColor;\n#endif\ngl_FragColor = color;\nczm_writeLogDepth();\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat temp = v_compressed.y;\ntemp = temp * SHIFT_RIGHT1;\nfloat temp2 = (temp - floor(temp)) * SHIFT_LEFT1;\nbool enableDepthTest = temp2 != 0.0;\nbool applyTranslate = floor(temp) != 0.0;\nif (enableDepthTest) {\ntemp = v_compressed.z;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\ntemp = v_compressed.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 imageSize;\nimageSize.y = (temp - floor(temp)) * SHIFT_LEFT12;\nimageSize.x = floor(temp);\nvec2 adjustedST = v_textureCoordinates - v_textureCoordinateBounds.xy;\nadjustedST = adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);\nfloat epsilonEyeDepth = v_compressed.x + czm_epsilon1;\nfloat globeDepth1 = getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);\nif (globeDepth1 != 0.0 && globeDepth1 > epsilonEyeDepth)\n{\nfloat globeDepth2 = getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth2 != 0.0 && globeDepth2 > epsilonEyeDepth)\n{\nfloat globeDepth3 = getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth3 != 0.0 && globeDepth3 > epsilonEyeDepth)\n{\ndiscard;\n}\n}\n}\n}\n#endif\n}\n"});t("Shaders/BillboardCollectionVS",[],function(){"use strict";return"#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScale;\nattribute vec4 positionLowAndRotation;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 compressedAttribute2;\nattribute vec4 eyeOffset;\nattribute vec4 scaleByDistance;\nattribute vec4 pixelOffsetScaleByDistance;\nattribute vec4 compressedAttribute3;\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nattribute vec4 textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef VECTOR_TILE\nattribute float a_batchId;\n#endif\nvarying vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\n#endif\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\nconst float UPPER_BOUND = 32768.0;\nconst float SHIFT_LEFT16 = 65536.0;\nconst float SHIFT_LEFT12 = 4096.0;\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_LEFT7 = 128.0;\nconst float SHIFT_LEFT5 = 32.0;\nconst float SHIFT_LEFT3 = 8.0;\nconst float SHIFT_LEFT2 = 4.0;\nconst float SHIFT_LEFT1 = 2.0;\nconst float SHIFT_RIGHT12 = 1.0 / 4096.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\nconst float SHIFT_RIGHT7 = 1.0 / 128.0;\nconst float SHIFT_RIGHT5 = 1.0 / 32.0;\nconst float SHIFT_RIGHT3 = 1.0 / 8.0;\nconst float SHIFT_RIGHT2 = 1.0 / 4.0;\nconst float SHIFT_RIGHT1 = 1.0 / 2.0;\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\nvec2 halfSize = imageSize * scale * czm_resolutionScale * 0.5;\nhalfSize *= ((direction * 2.0) - 1.0);\nvec2 originTranslate = origin * abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif (validAlignedAxis || rotation != 0.0)\n{\nfloat angle = rotation;\nif (validAlignedAxis)\n{\nvec4 projectedAlignedAxis = czm_modelViewProjection * vec4(alignedAxis, 0.0);\nangle += sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n}\nfloat cosTheta = cos(angle);\nfloat sinTheta = sin(angle);\nrotationMatrix = mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\nhalfSize = rotationMatrix * halfSize;\n}\nelse\n{\nrotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n}\n#endif\nif (sizeInMeters)\n{\npositionEC.xy += halfSize;\n}\nmpp = czm_metersPerPixel(positionEC);\nif (!sizeInMeters)\n{\noriginTranslate *= mpp;\n}\npositionEC.xy += originTranslate;\nif (!sizeInMeters)\n{\npositionEC.xy += halfSize * mpp;\n}\npositionEC.xy += translate * mpp;\npositionEC.xy += (pixelOffset * czm_resolutionScale) * mpp;\nreturn positionEC;\n}\n#ifdef VERTEX_DEPTH_CHECK\nfloat getGlobeDepth(vec4 positionEC)\n{\nvec4 posWC = czm_eyeToWindowCoordinates(positionEC);\nfloat globeDepth = czm_unpackDepth(texture2D(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));\nif (globeDepth == 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(posWC.xy, globeDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec3 positionHigh = positionHighAndScale.xyz;\nvec3 positionLow = positionLowAndRotation.xyz;\nfloat scale = positionHighAndScale.w;\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nfloat rotation = positionLowAndRotation.w;\n#else\nfloat rotation = 0.0;\n#endif\nfloat compressed = compressedAttribute0.x;\nvec2 pixelOffset;\npixelOffset.x = floor(compressed * SHIFT_RIGHT7);\ncompressed -= pixelOffset.x * SHIFT_LEFT7;\npixelOffset.x -= UPPER_BOUND;\nvec2 origin;\norigin.x = floor(compressed * SHIFT_RIGHT5);\ncompressed -= origin.x * SHIFT_LEFT5;\norigin.y = floor(compressed * SHIFT_RIGHT3);\ncompressed -= origin.y * SHIFT_LEFT3;\n#ifdef FRAGMENT_DEPTH_CHECK\nvec2 depthOrigin = origin.xy;\n#endif\norigin -= vec2(1.0);\nfloat show = floor(compressed * SHIFT_RIGHT2);\ncompressed -= show * SHIFT_LEFT2;\n#ifdef INSTANCED\nvec2 textureCoordinatesBottomLeft = czm_decompressTextureCoordinates(compressedAttribute0.w);\nvec2 textureCoordinatesRange = czm_decompressTextureCoordinates(eyeOffset.w);\nvec2 textureCoordinates = textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n#else\nvec2 direction;\ndirection.x = floor(compressed * SHIFT_RIGHT1);\ndirection.y = compressed - direction.x * SHIFT_LEFT1;\nvec2 textureCoordinates = czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\nfloat temp = compressedAttribute0.y  * SHIFT_RIGHT8;\npixelOffset.y = -(floor(temp) - UPPER_BOUND);\nvec2 translate;\ntranslate.y = (temp - floor(temp)) * SHIFT_LEFT16;\ntemp = compressedAttribute0.z * SHIFT_RIGHT8;\ntranslate.x = floor(temp) - UPPER_BOUND;\ntranslate.y += (temp - floor(temp)) * SHIFT_LEFT8;\ntranslate.y -= UPPER_BOUND;\ntemp = compressedAttribute1.x * SHIFT_RIGHT8;\nfloat temp2 = floor(compressedAttribute2.w * SHIFT_RIGHT2);\nvec2 imageSize = vec2(floor(temp), temp2);\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat labelHorizontalOrigin = floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));\nfloat applyTranslate = 0.0;\nif (labelHorizontalOrigin != 0.0)\n{\napplyTranslate = 1.0;\nlabelHorizontalOrigin -= 2.0;\ndepthOrigin.x = labelHorizontalOrigin + 1.0;\n}\ndepthOrigin = vec2(1.0) - (depthOrigin * 0.5);\n#endif\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x = compressedAttribute1.z;\ntranslucencyByDistance.z = compressedAttribute1.w;\ntranslucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp = compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\ntemp = compressedAttribute3.w;\ntemp = temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y = (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x = floor(temp);\n#endif\n#ifdef ALIGNED_AXIS\nvec3 alignedAxis = czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));\ntemp = compressedAttribute2.z * SHIFT_RIGHT5;\nbool validAlignedAxis = (temp - floor(temp)) * SHIFT_LEFT1 > 0.0;\n#else\nvec3 alignedAxis = vec3(0.0);\nbool validAlignedAxis = false;\n#endif\nvec4 pickColor;\nvec4 color;\ntemp = compressedAttribute2.y;\ntemp = temp * SHIFT_RIGHT8;\npickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r = floor(temp);\ntemp = compressedAttribute2.x;\ntemp = temp * SHIFT_RIGHT8;\ncolor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\ncolor.g = (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r = floor(temp);\ntemp = compressedAttribute2.z * SHIFT_RIGHT8;\nbool sizeInMeters = floor((temp - floor(temp)) * SHIFT_LEFT7) > 0.0;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor /= 255.0;\ncolor.a = floor(temp);\ncolor /= 255.0;\nvec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\nfloat eyeDepth = positionEC.z;\n#endif\npositionEC = czm_eyeOffset(positionEC, eyeOffset.xyz);\npositionEC.xyz *= show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq = dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\nfloat distanceScale = czm_nearFarScalar(scaleByDistance, lengthSq);\nscale *= distanceScale;\ntranslate *= distanceScale;\nif (scale == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nfloat translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency == 0.0)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\nfloat pixelOffsetScale = czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);\npixelOffset *= pixelOffsetScale;\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq = compressedAttribute3.x;\nfloat farSq = compressedAttribute3.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\nmat2 rotationMatrix;\nfloat mpp;\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance = compressedAttribute3.z;\n#endif\n#ifdef VERTEX_DEPTH_CHECK\nif (lengthSq < disableDepthTestDistance) {\nfloat depthsilon = 10.0;\nvec2 labelTranslate = textureCoordinateBoundsOrLabelTranslate.xy;\nvec4 pEC1 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth1 = getGlobeDepth(pEC1);\nif (globeDepth1 != 0.0 && pEC1.z + depthsilon < globeDepth1)\n{\nvec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth2 = getGlobeDepth(pEC2);\nif (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2)\n{\nvec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth3 = getGlobeDepth(pEC3);\nif (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3)\n{\npositionEC.xyz = vec3(0.0);\n}\n}\n}\n}\n#endif\npositionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\ngl_Position = czm_projection * positionEC;\nv_textureCoordinates = textureCoordinates;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n#ifdef DISABLE_DEPTH_DISTANCE\nif (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n{\ndisableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance != 0.0)\n{\nfloat zclip = gl_Position.z / gl_Position.w;\nbool clipped = (zclip < -1.0 || zclip > 1.0);\nif (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n{\ngl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(vec4(czm_currentFrustum.x));\n#endif\n}\n}\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nif (sizeInMeters) {\ntranslate /= mpp;\ndimensions /= mpp;\nimageSize /= mpp;\n}\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nv_rotationMatrix = rotationMatrix;\n#else\nv_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0);\n#endif\nfloat enableDepthCheck = 0.0;\nif (lengthSq < disableDepthTestDistance)\n{\nenableDepthCheck = 1.0;\n}\nfloat dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));\nfloat dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));\nfloat iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));\nfloat ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));\nv_compressed.x = eyeDepth;\nv_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck;\nv_compressed.z = dw * SHIFT_LEFT12 + dh;\nv_compressed.w = iw * SHIFT_LEFT12 + ih;\nv_originTextureCoordinateAndTranslate.xy = depthOrigin;\nv_originTextureCoordinateAndTranslate.zw = translate;\nv_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate;\n#endif\nv_pickColor = pickColor;\nv_color = color;\nv_color.a *= translucency;\n}\n"});t("Scene/BlendOption",["../Core/freezeObject"],function(n){"use strict";return n({OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2})});t("Renderer/Framebuffer",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/PixelFormat","./ContextLimits","./PixelDatatype"],function(n,t,i,r,u,f,e,o,s){"use strict";function l(n,t,i){var r=n._gl;r.framebufferTexture2D(r.FRAMEBUFFER,t,i._target,i._texture,0)}function c(n,t,i){var r=n._gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,i._getRenderbuffer())}function h(r){var p,w,b,k,d,u,a,h,v,y,g,nt;if(r=t(r,t.EMPTY_OBJECT),p=r.context,n.defined("options.context",p),w=p._gl,b=o.maximumColorAttachments,this._gl=w,this._framebuffer=w.createFramebuffer(),this._colorTextures=[],this._colorRenderbuffers=[],this._activeColorAttachments=[],this._depthTexture=undefined,this._depthRenderbuffer=undefined,this._stencilRenderbuffer=undefined,this._depthStencilTexture=undefined,this._depthStencilRenderbuffer=undefined,this.destroyAttachments=t(r.destroyAttachments,!0),i(r.colorTextures)&&i(r.colorRenderbuffers))throw new f("Cannot have both color texture and color renderbuffer attachments.");if(i(r.depthTexture)&&i(r.depthRenderbuffer))throw new f("Cannot have both a depth texture and depth renderbuffer attachment.");if(i(r.depthStencilTexture)&&i(r.depthStencilRenderbuffer))throw new f("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");if(k=i(r.depthTexture)||i(r.depthRenderbuffer),d=i(r.depthStencilTexture)||i(r.depthStencilRenderbuffer),k&&d)throw new f("Cannot have both a depth and depth-stencil attachment.");if(i(r.stencilRenderbuffer)&&d)throw new f("Cannot have both a stencil and depth-stencil attachment.");if(k&&i(r.stencilRenderbuffer))throw new f("Cannot have both a depth and stencil attachment.");if(this._bind(),i(r.colorTextures)){if(g=r.colorTextures,v=this._colorTextures.length=this._activeColorAttachments.length=g.length,v>b)throw new f("The number of color attachments exceeds the number supported.");for(h=0;h<v;++h){if(u=g[h],!e.isColorFormat(u.pixelFormat))throw new f("The color-texture pixel-format must be a color format.");if(u.pixelDatatype===s.FLOAT&&!p.colorBufferFloat)throw new f("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(u.pixelDatatype===s.HALF_FLOAT&&!p.colorBufferHalfFloat)throw new f("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");y=this._gl.COLOR_ATTACHMENT0+h;l(this,y,u);this._activeColorAttachments[h]=y;this._colorTextures[h]=u}}if(i(r.colorRenderbuffers)){if(nt=r.colorRenderbuffers,v=this._colorRenderbuffers.length=this._activeColorAttachments.length=nt.length,v>b)throw new f("The number of color attachments exceeds the number supported.");for(h=0;h<v;++h)a=nt[h],y=this._gl.COLOR_ATTACHMENT0+h,c(this,y,a),this._activeColorAttachments[h]=y,this._colorRenderbuffers[h]=a}if(i(r.depthTexture)){if(u=r.depthTexture,u.pixelFormat!==e.DEPTH_COMPONENT)throw new f("The depth-texture pixel-format must be DEPTH_COMPONENT.");l(this,this._gl.DEPTH_ATTACHMENT,u);this._depthTexture=u}if(i(r.depthRenderbuffer)&&(a=r.depthRenderbuffer,c(this,this._gl.DEPTH_ATTACHMENT,a),this._depthRenderbuffer=a),i(r.stencilRenderbuffer)&&(a=r.stencilRenderbuffer,c(this,this._gl.STENCIL_ATTACHMENT,a),this._stencilRenderbuffer=a),i(r.depthStencilTexture)){if(u=r.depthStencilTexture,u.pixelFormat!==e.DEPTH_STENCIL)throw new f("The depth-stencil pixel-format must be DEPTH_STENCIL.");l(this,this._gl.DEPTH_STENCIL_ATTACHMENT,u);this._depthStencilTexture=u}i(r.depthStencilRenderbuffer)&&(a=r.depthStencilRenderbuffer,c(this,this._gl.DEPTH_STENCIL_ATTACHMENT,a),this._depthStencilRenderbuffer=a);this._unBind()}return r(h.prototype,{status:{get:function(){this._bind();var n=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);return this._unBind(),n}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}}),h.prototype._bind=function(){var n=this._gl;n.bindFramebuffer(n.FRAMEBUFFER,this._framebuffer)},h.prototype._unBind=function(){var n=this._gl;n.bindFramebuffer(n.FRAMEBUFFER,null)},h.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments},h.prototype.getColorTexture=function(n){if(!i(n)||n<0||n>=this._colorTextures.length)throw new f("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[n]},h.prototype.getColorRenderbuffer=function(n){if(!i(n)||n<0||n>=this._colorRenderbuffers.length)throw new f("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[n]},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){var r,f,e;if(this.destroyAttachments){for(var n=0,o=this._colorTextures,t=o.length;n<t;++n)r=o[n],i(r)&&r.destroy();for(f=this._colorRenderbuffers,t=f.length,n=0;n<t;++n)e=f[n],i(e)&&e.destroy();this._depthTexture=this._depthTexture&&this._depthTexture.destroy();this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy();this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy();this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy();this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}return this._gl.deleteFramebuffer(this._framebuffer),u(this)},h});t("Scene/TextureAtlas",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/PixelFormat","../Core/Resource","../Core/RuntimeError","../Renderer/Framebuffer","../Renderer/Texture","../ThirdParty/when"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(n,i,u,f,e){this.bottomLeft=r(n,t.ZERO);this.topRight=r(i,t.ZERO);this.childNode1=u;this.childNode2=f;this.imageIndex=e}function p(n){n=r(n,r.EMPTY_OBJECT);var f=r(n.borderWidthInPixels,1),t=r(n.initialSize,k);if(!u(n.context))throw new o("context is required.");if(f<0)throw new o("borderWidthInPixels must be greater than or equal to zero.");if(t.x<1||t.y<1)throw new o("initialSize must be greater than zero.");this._context=n.context;this._pixelFormat=r(n.pixelFormat,s.RGBA);this._borderWidthInPixels=f;this._textureCoordinates=[];this._guid=i();this._idHash={};this._initialSize=t;this._root=undefined}function d(n,i){var nt=n._context,tt=n.numberOfImages,v=2,r=n._borderWidthInPixels,p,e,k,w,h,c;if(tt>0){var b=n._texture.width,o=n._texture.height,f=v*(b+i.width+r),s=v*(o+i.height+r),d=b/f,g=o/s,it=new y(new t(b+r,r),new t(f,o)),rt=new y(new t,new t(f,o),n._root,it),ut=new y(new t(r,o+r),new t(f,s)),ft=new y(new t,new t(f,s),rt,ut);for(p=0;p<n._textureCoordinates.length;p++)e=n._textureCoordinates[p],u(e)&&(e.x*=d,e.y*=g,e.width*=d,e.height*=g);k=new a({context:n._context,width:f,height:s,pixelFormat:n._pixelFormat});w=new l({context:nt,colorTextures:[n._texture],destroyAttachments:!1});w._bind();k.copyFromFramebuffer(0,0,0,0,f,s);w._unBind();w.destroy();n._texture=n._texture&&n._texture.destroy();n._texture=k;n._root=ft}else h=v*(i.width+2*r),c=v*(i.height+2*r),h<n._initialSize.x&&(h=n._initialSize.x),c<n._initialSize.y&&(c=n._initialSize.y),n._texture=n._texture&&n._texture.destroy(),n._texture=new a({context:n._context,width:h,height:c,pixelFormat:n._pixelFormat}),n._root=new y(new t(r,r),new t(h,c))}function w(n,i,r){var o,s;if(!u(i))return undefined;if(!u(i.childNode1)&&!u(i.childNode2)){if(u(i.imageIndex))return undefined;var h=i.topRight.x-i.bottomLeft.x,c=i.topRight.y-i.bottomLeft.y,f=h-r.width,e=c-r.height;return f<0||e<0?undefined:f===0&&e===0?i:(f>e?(i.childNode1=new y(new t(i.bottomLeft.x,i.bottomLeft.y),new t(i.bottomLeft.x+r.width,i.topRight.y)),o=i.bottomLeft.x+r.width+n._borderWidthInPixels,o<i.topRight.x&&(i.childNode2=new y(new t(o,i.bottomLeft.y),new t(i.topRight.x,i.topRight.y)))):(i.childNode1=new y(new t(i.bottomLeft.x,i.bottomLeft.y),new t(i.topRight.x,i.bottomLeft.y+r.height)),s=i.bottomLeft.y+r.height+n._borderWidthInPixels,s<i.topRight.y&&(i.childNode2=new y(new t(i.bottomLeft.x,s),new t(i.topRight.x,i.topRight.y)))),w(n,i.childNode1,r))}return w(n,i.childNode1,r)||w(n,i.childNode2,r)}function b(t,r,f){var e=w(t,t._root,r);if(u(e)){e.imageIndex=f;var o=t._texture.width,s=t._texture.height,h=e.topRight.x-e.bottomLeft.x,c=e.topRight.y-e.bottomLeft.y,l=e.bottomLeft.x/o,a=e.bottomLeft.y/s,v=h/o,y=c/s;t._textureCoordinates[f]=new n(l,a,v,y);t._texture.copyFrom(r,e.bottomLeft.x,e.bottomLeft.y)}else d(t,r),b(t,r,f);t._guid=i()}var k=new t(16,16);return f(p.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return u(this._texture)||(this._texture=new a({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}}),p.prototype.addImage=function(n,t){var i,f,r;if(!u(n))throw new o("id is required.");if(!u(t))throw new o("image is required.");if(i=this._idHash[n],u(i))return i;if(typeof t=="function"){if(t=t(n),!u(t))throw new o("image is required.");}else(typeof t=="string"||t instanceof h)&&(f=h.createIfNeeded(t),t=f.fetchImage());return r=this,i=v(t,function(n){if(r.isDestroyed())return-1;var t=r.numberOfImages;return b(r,n,t),t}),this._idHash[n]=i,i},p.prototype.addSubRegion=function(t,r){var e,f;if(!u(t))throw new o("id is required.");if(!u(r))throw new o("subRegion is required.");if(e=this._idHash[t],!u(e))throw new c('image with id "'+t+'" not found in the atlas.');return f=this,v(e,function(t){if(t===-1)return-1;var u=f._texture.width,e=f._texture.height,s=f.numberOfImages,o=f._textureCoordinates[t],h=o.x+r.x/u,c=o.y+r.y/e,l=r.width/u,a=r.height/e;return f._textureCoordinates.push(new n(h,c,l,a)),f._guid=i(),s})},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),e(this)},p});t("Scene/BillboardCollection",["../Core/AttributeCompression","../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/EncodedCartesian3","../Core/IndexDatatype","../Core/Math","../Core/Matrix4","../Core/WebGLConstants","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArrayFacade","../Shaders/BillboardCollectionFS","../Shaders/BillboardCollectionVS","./Billboard","./BlendingState","./BlendOption","./HeightReference","./HorizontalOrigin","./SceneMode","./TextureAtlas","./VerticalOrigin"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt){"use strict";function pt(n){var r,i;n=e(n,e.EMPTY_OBJECT);this._scene=n.scene;this._batchTable=n.batchTable;this._textureAtlas=undefined;this._textureAtlasGUID=undefined;this._destroyTextureAtlas=!0;this._sp=undefined;this._spTranslucent=undefined;this._rsOpaque=undefined;this._rsTranslucent=undefined;this._vaf=undefined;this._billboards=[];this._billboardsToUpdate=[];this._billboardsToUpdateIndex=0;this._billboardsRemoved=!1;this._createVertexArray=!1;this._shaderRotation=!1;this._compiledShaderRotation=!1;this._shaderAlignedAxis=!1;this._compiledShaderAlignedAxis=!1;this._shaderScaleByDistance=!1;this._compiledShaderScaleByDistance=!1;this._shaderTranslucencyByDistance=!1;this._compiledShaderTranslucencyByDistance=!1;this._shaderPixelOffsetScaleByDistance=!1;this._compiledShaderPixelOffsetScaleByDistance=!1;this._shaderDistanceDisplayCondition=!1;this._compiledShaderDistanceDisplayCondition=!1;this._shaderDisableDepthDistance=!1;this._compiledShaderDisableDepthDistance=!1;this._shaderClampToGround=!1;this._compiledShaderClampToGround=!1;this._propertiesChanged=new Uint32Array(ii);this._maxSize=0;this._maxEyeOffset=0;this._maxScale=1;this._maxPixelOffset=0;this._allHorizontalCenter=!0;this._allVerticalCenter=!0;this._allSizedInMeters=!0;this._baseVolume=new t;this._baseVolumeWC=new t;this._baseVolume2D=new t;this._boundingVolume=new t;this._boundingVolumeDirty=!1;this._colorCommands=[];this.modelMatrix=y.clone(e(n.modelMatrix,y.IDENTITY));this._modelMatrix=y.clone(y.IDENTITY);this.debugShowBoundingVolume=e(n.debugShowBoundingVolume,!1);this.blendOption=e(n.blendOption,st.OPAQUE_AND_TRANSLUCENT);this._blendOption=undefined;this._mode=lt.SCENE3D;this._buffersUsage=[b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW,b.STATIC_DRAW];this._highlightColor=u.clone(u.WHITE);r=this;this._uniforms={u_atlas:function(){return r._textureAtlas.texture},u_highlightColor:function(){return r._highlightColor}};i=this._scene;o(i)&&o(i.terrainProviderChanged)&&(this._removeCallbackFunc=i.terrainProviderChanged.addEventListener(function(){for(var t=this._billboards,i=t.length,n=0;n<i;++n)t[n]._updateClamping()},this))}function wi(n){for(var i=n.length,t=0;t<i;++t)n[t]&&n[t]._destroy()}function ri(n){var t,f,i;if(n._billboardsRemoved){n._billboardsRemoved=!1;var r=[],u=n._billboards,e=u.length;for(t=0,f=0;t<e;++t)i=u[t],i&&(i._index=f++,r.push(i));n._billboards=r}}function pr(n){var u=n.cache.billboardCollection_indexBufferBatched,f,i,t,r;if(o(u))return u;for(f=98298,i=new Uint16Array(f),t=0,r=0;t<f;t+=6,r+=4)i[t]=r,i[t+1]=r+1,i[t+2]=r+2,i[t+3]=r+0,i[t+4]=r+2,i[t+5]=r+3;return u=w.createIndexBuffer({context:n,typedArray:i,usage:b.STATIC_DRAW,indexDatatype:a.UNSIGNED_SHORT}),u.vertexArrayDestroyable=!1,n.cache.billboardCollection_indexBufferBatched=u,u}function wr(n){var t=n.cache.billboardCollection_indexBufferInstanced;return o(t)?t:(t=w.createIndexBuffer({context:n,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:b.STATIC_DRAW,indexDatatype:a.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,n.cache.billboardCollection_indexBufferInstanced=t,t)}function br(n){var t=n.cache.billboardCollection_vertexBufferInstanced;return o(t)?t:(t=w.createVertexBuffer({context:n,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:b.STATIC_DRAW}),t.vertexArrayDestroyable=!1,n.cache.billboardCollection_vertexBufferInstanced=t,t)}function kr(n,t,i,r,u){var e=[{index:yt.positionHighAndScale,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[dt]},{index:yt.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[dt]},{index:yt.compressedAttribute0,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[hi]},{index:yt.compressedAttribute1,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[vi]},{index:yt.compressedAttribute2,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[li]},{index:yt.eyeOffset,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[ci]},{index:yt.scaleByDistance,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[ai]},{index:yt.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[yi]},{index:yt.compressedAttribute3,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[pi]},{index:yt.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:i[ar]}],s;return r&&e.push({index:yt.direction,componentsPerAttribute:2,componentDatatype:f.FLOAT,vertexBuffer:br(n)}),o(u)&&e.push({index:yt.a_batchId,componentsPerAttribute:1,componentDatatyps:f.FLOAT,bufferUsage:b.STATIC_DRAW}),s=r?t:4*t,new rt(n,e,s,r)}function bi(n,i,r,u,f){var s,a=u[yt.positionHighAndScale],v=u[yt.positionLowAndRotation],y=f._getActualPosition(),h,c,e,o;n._mode===lt.SCENE3D&&(t.expand(n._baseVolume,y,n._baseVolume),n._boundingVolumeDirty=!0);l.fromCartesian(y,ni);h=f.scale;c=f.rotation;c!==0&&(n._shaderRotation=!0);n._maxScale=Math.max(n._maxScale,h);e=ni.high;o=ni.low;n._instanced?(s=f._index,a(s,e.x,e.y,e.z,h),v(s,o.x,o.y,o.z,c)):(s=f._index*4,a(s+0,e.x,e.y,e.z,h),a(s+1,e.x,e.y,e.z,h),a(s+2,e.x,e.y,e.z,h),a(s+3,e.x,e.y,e.z,h),v(s+0,o.x,o.y,o.z,c),v(s+1,o.x,o.y,o.z,c),v(s+2,o.x,o.y,o.z,c),v(s+3,o.x,o.y,o.z,c))}function di(t,i,r,u,f){var s,y=u[yt.compressedAttribute0],g=f.pixelOffset,nt=g.x,tt=g.y,it=f._translate,rt=it.x,ut=it.y,h,d,at,pt,dt;t._maxPixelOffset=Math.max(t._maxPixelOffset,Math.abs(nt+rt),Math.abs(-tt+ut));var ft=f.horizontalOrigin,p=f._verticalOrigin,et=f.show&&f.clusterShow;f.color.alpha===0&&(et=!1);p===vt.BASELINE&&(p=vt.BOTTOM);t._allHorizontalCenter=t._allHorizontalCenter&&ft===ct.CENTER;t._allVerticalCenter=t._allVerticalCenter&&p===vt.CENTER;var w=0,b=0,ot=0,st=0,k=f._imageIndex;if(k!==-1){if(h=r[k],!o(h))throw new c("Invalid billboard image index: "+k);w=h.x;b=h.y;ot=h.width;st=h.height}var gt=w+ot,ni=b+st,e=Math.floor(v.clamp(nt,-bt,bt)+bt)*dr;e+=(ft+1)*gr;e+=(p+1)*nu;e+=(et?1:0)*ki;var l=Math.floor(v.clamp(tt,-bt,bt)+bt)*kt,a=Math.floor(v.clamp(rt,-bt,bt)+bt)*kt,ht=(v.clamp(ut,-bt,bt)+bt)*tu,lt=Math.floor(ht),ti=Math.floor((ht-lt)*kt);l+=lt;a+=ti;wt.x=w;wt.y=b;d=n.compressTextureCoordinates(wt);wt.x=gt;at=n.compressTextureCoordinates(wt);wt.y=ni;pt=n.compressTextureCoordinates(wt);wt.x=w;dt=n.compressTextureCoordinates(wt);t._instanced?(s=f._index,y(s,e,l,a,d)):(s=f._index*4,y(s+0,e+iu,l,a,d),y(s+1,e+ru,l,a,at),y(s+2,e+uu,l,a,pt),y(s+3,e+fu,l,a,dt))}function gi(t,i,u,f,s){var p,k=f[yt.compressedAttribute1],nt=s.alignedAxis,tt,g,it,ut,rt,y,h;r.equals(nt,r.ZERO)||(t._shaderAlignedAxis=!0);var w=0,l=1,b=1,a=1,d=s.translucencyByDistance;if(o(d)&&(w=d.near,l=d.nearValue,b=d.far,a=d.farValue,(l!==1||a!==1)&&(t._shaderTranslucencyByDistance=!0)),tt=0,g=s._imageIndex,g!==-1){if(it=u[g],!o(it))throw new c("Invalid billboard image index: "+g);tt=it.width}ut=t._textureAtlas.texture.width;rt=Math.round(e(s.width,ut*tt));t._maxSize=Math.max(t._maxSize,rt);y=v.clamp(rt,0,ti);h=0;Math.abs(r.magnitudeSquared(nt)-1)<v.EPSILON6&&(h=n.octEncodeFloat(nt));l=v.clamp(l,0,1);l=l===1?255:l*255|0;y=y*kt+l;a=v.clamp(a,0,1);a=a===1?255:a*255|0;h=h*kt+a;t._instanced?(p=s._index,k(p,y,h,w,b)):(p=s._index*4,k(p+0,y,h,w,b),k(p+1,y,h,w,b),k(p+2,y,h,w,b),k(p+3,y,h,w,b))}function ei(n,t,i,f,s){var h,y=f[yt.compressedAttribute2],b=s.color,k=o(n._batchTable)?u.WHITE:s.getPickId(t).color,ft=s.sizeInMeters?1:0,st=Math.abs(r.magnitudeSquared(s.alignedAxis)-1)<v.EPSILON6?1:0,g,d,nt,et,tt,ot,a,l;if(n._allSizedInMeters=n._allSizedInMeters&&ft===1,g=0,d=s._imageIndex,d!==-1){if(nt=i[d],!o(nt))throw new c("Invalid billboard image index: "+d);g=nt.height}et=n._textureAtlas.texture.dimensions;tt=Math.round(e(s.height,et.y*g));n._maxSize=Math.max(n._maxSize,tt);ot=e(s._labelHorizontalOrigin,-2)+2;var p=tt*ki+ot,it=u.floatToByte(b.red),rt=u.floatToByte(b.green),ut=u.floatToByte(b.blue),w=it*ti+rt*kt+ut;it=u.floatToByte(k.red);rt=u.floatToByte(k.green);ut=u.floatToByte(k.blue);a=it*ti+rt*kt+ut;l=u.floatToByte(b.alpha)*ti+u.floatToByte(k.alpha)*kt;l+=ft*2+st;n._instanced?(h=s._index,y(h,w,a,l,p)):(h=s._index*4,y(h+0,w,a,l,p),y(h+1,w,a,l,p),y(h+2,w,a,l,p),y(h+3,w,a,l,p))}function oi(t,i,r,u,f){var s,l=u[yt.eyeOffset],e=f.eyeOffset,h=e.z,a,w;if(f._heightReference!==ht.NONE&&(h*=1.005),t._maxEyeOffset=Math.max(t._maxEyeOffset,Math.abs(e.x),Math.abs(e.y),Math.abs(h)),t._instanced){var y=0,p=0,v=f._imageIndex;if(v!==-1){if(a=r[v],!o(a))throw new c("Invalid billboard image index: "+v);y=a.width;p=a.height}wt.x=y;wt.y=p;w=n.compressTextureCoordinates(wt);s=f._index;l(s,e.x,e.y,h,w)}else s=f._index*4,l(s+0,e.x,e.y,h,0),l(s+1,e.x,e.y,h,0),l(s+2,e.x,e.y,h,0),l(s+3,e.x,e.y,h,0)}function nr(n,t,i,r,u){var f,l=r[yt.scaleByDistance],h=0,e=1,c=1,s=1,a=u.scaleByDistance;o(a)&&(h=a.near,e=a.nearValue,c=a.far,s=a.farValue,(e!==1||s!==1)&&(n._shaderScaleByDistance=!0));n._instanced?(f=u._index,l(f,h,e,c,s)):(f=u._index*4,l(f+0,h,e,c,s),l(f+1,h,e,c,s),l(f+2,h,e,c,s),l(f+3,h,e,c,s))}function tr(n,t,i,r,u){var f,l=r[yt.pixelOffsetScaleByDistance],h=0,e=1,c=1,s=1,a=u.pixelOffsetScaleByDistance;o(a)&&(h=a.near,e=a.nearValue,c=a.far,s=a.farValue,(e!==1||s!==1)&&(n._shaderPixelOffsetScaleByDistance=!0));n._instanced?(f=u._index,l(f,h,e,c,s)):(f=u._index*4,l(f+0,h,e,c,s),l(f+1,h,e,c,s),l(f+2,h,e,c,s),l(f+3,h,e,c,s))}function ir(n,t,i,r,u){var l,a=r[yt.compressedAttribute3],s=0,h=Number.MAX_VALUE,w=u.distanceDisplayCondition,f,b,k,d,p,it;if(o(w)&&(s=w.near,h=w.far,s*=s,h*=h,n._shaderDistanceDisplayCondition=!0),f=u.disableDepthTestDistance,b=u.heightReference===ht.CLAMP_TO_GROUND&&n._scene.context.depthTexture,o(f)||(f=b?5e3:0),f*=f,(b||f>0)&&(n._shaderDisableDepthDistance=!0,f===Number.POSITIVE_INFINITY&&(f=-1)),o(u._labelDimensions))d=u._labelDimensions.x,k=u._labelDimensions.y;else{var nt=0,tt=0,g=u._imageIndex;if(g!==-1){if(p=i[g],!o(p))throw new c("Invalid billboard image index: "+g);nt=p.height;tt=p.width}k=Math.round(e(u.height,n._textureAtlas.texture.dimensions.y*nt));it=n._textureAtlas.texture.width;d=Math.round(e(u.width,it*tt))}var rt=Math.floor(v.clamp(d,0,fi)),ut=Math.floor(v.clamp(k,0,fi)),y=rt*fi+ut;n._instanced?(l=u._index,a(l,s,h,f,y)):(l=u._index*4,a(l+0,s,h,f,y),a(l+1,s,h,f,y),a(l+2,s,h,f,y),a(l+3,s,h,f,y))}function rr(n,t,i,r,u){var f,e,s,h,v,y,p;if(u.heightReference===ht.CLAMP_TO_GROUND&&(n._shaderClampToGround=n._scene.context.depthTexture),e=r[yt.textureCoordinateBoundsOrLabelTranslate],k.maximumVertexTextureImageUnits>0){s=0;h=0;o(u._labelTranslate)&&(s=u._labelTranslate.x,h=u._labelTranslate.y);n._instanced?(f=u._index,e(f,s,h,0,0)):(f=u._index*4,e(f+0,s,h,0,0),e(f+1,s,h,0,0),e(f+2,s,h,0,0),e(f+3,s,h,0,0));return}var l=0,a=0,b=0,d=0,w=u._imageIndex;if(w!==-1){if(v=i[w],!o(v))throw new c("Invalid billboard image index: "+w);l=v.x;a=v.y;b=v.width;d=v.height}y=l+b;p=a+d;n._instanced?(f=u._index,e(f,l,a,y,p)):(f=u._index*4,e(f+0,l,a,y,p),e(f+1,l,a,y,p),e(f+2,l,a,y,p),e(f+3,l,a,y,p))}function eu(n,t,i,r,u){if(o(n._batchTable)){var e=r[yt.a_batchId],s=u._batchIndex,f;n._instanced?(f=u._index,e(f,s)):(f=u._index*4,e(f+0,s),e(f+1,s),e(f+2,s),e(f+3,s))}}function ou(n,t,i,r,u){bi(n,t,i,r,u);di(n,t,i,r,u);gi(n,t,i,r,u);ei(n,t,i,r,u);oi(n,t,i,r,u);nr(n,t,i,r,u);tr(n,t,i,r,u);ir(n,t,i,r,u);rr(n,t,i,r,u);eu(n,t,i,r,u)}function si(n,i,r,u,f,e){var s,l,h;for(u.mode===lt.SCENE3D?(s=n._baseVolume,n._boundingVolumeDirty=!0):s=n._baseVolume2D,l=[],h=0;h<r;++h){var a=i[h],v=a.position,c=et._computeActualPosition(a,v,u,f);o(c)&&(a._setActualPosition(c),e?l.push(c):t.expand(s,c,s))}e&&t.fromPoints(l,s)}function su(n,t){var i=t.mode,u=n._billboards,f=n._billboardsToUpdate,r=n._modelMatrix;n._createVertexArray||n._mode!==i||i!==lt.SCENE3D&&!y.equals(r,n.modelMatrix)?(n._mode=i,y.clone(n.modelMatrix,r),n._createVertexArray=!0,(i===lt.SCENE3D||i===lt.SCENE2D||i===lt.COLUMBUS_VIEW)&&si(n,u,u.length,t,r,!0)):i===lt.MORPHING?si(n,u,u.length,t,r,!0):(i===lt.SCENE2D||i===lt.COLUMBUS_VIEW)&&si(n,f,n._billboardsToUpdateIndex,t,r,!1)}function hu(n,t,i){var r=1,u,f;n._allSizedInMeters&&n._maxPixelOffset===0||(r=t.camera.getPixelSize(i,t.context.drawingBufferWidth,t.context.drawingBufferHeight));u=r*n._maxScale*n._maxSize*2;n._allHorizontalCenter&&n._allVerticalCenter&&(u*=.5);f=r*n._maxPixelOffset+n._maxEyeOffset;i.radius+=u+f}var fr=et.SHOW_INDEX,dt=et.POSITION_INDEX,hi=et.PIXEL_OFFSET_INDEX,ci=et.EYE_OFFSET_INDEX,er=et.HORIZONTAL_ORIGIN_INDEX,or=et.VERTICAL_ORIGIN_INDEX,sr=et.SCALE_INDEX,gt=et.IMAGE_INDEX_INDEX,li=et.COLOR_INDEX,hr=et.ROTATION_INDEX,cr=et.ALIGNED_AXIS_INDEX,ai=et.SCALE_BY_DISTANCE_INDEX,vi=et.TRANSLUCENCY_BY_DISTANCE_INDEX,yi=et.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,pi=et.DISTANCE_DISPLAY_CONDITION,lr=et.DISABLE_DEPTH_DISTANCE,ar=et.TEXTURE_COORDINATE_BOUNDS,ii=et.NUMBER_OF_PROPERTIES,yt,vr={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10},yr={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11},ui,ni,ur;s(pt.prototype,{length:{get:function(){return ri(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(n){this._textureAtlas!==n&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=n,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(n){this._destroyTextureAtlas=n}}});pt.prototype.add=function(n){var t=new et(n,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t};pt.prototype.remove=function(n){return this.contains(n)?(this._billboards[n._index]=null,this._billboardsRemoved=!0,this._createVertexArray=!0,n._destroy(),!0):!1};pt.prototype.removeAll=function(){wi(this._billboards);this._billboards=[];this._billboardsToUpdate=[];this._billboardsToUpdateIndex=0;this._billboardsRemoved=!1;this._createVertexArray=!0};pt.prototype._updateBillboard=function(n,t){n._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=n);++this._propertiesChanged[t]};pt.prototype.contains=function(n){return o(n)&&n._billboardCollection===this};pt.prototype.get=function(n){if(!o(n))throw new c("index is required.");return ri(this),this._billboards[n]};pt.prototype.computeNewBuffersUsage=function(){for(var i,r=this._buffersUsage,t=!1,u=this._propertiesChanged,n=0;n<ii;++n)i=u[n]===0?b.STATIC_DRAW:b.STREAM_DRAW,t=t||r[n]!==i,r[n]=i;return t};ni=new l;var wt=new i,bt=32768,ti=65536,fi=4096,kt=256,dr=128,gr=32,nu=8,ki=4,tu=1/256,iu=0,ru=2,uu=3,fu=1;return ur=[],pt.prototype.update=function(n){var v,vt,w,rt,pt,pu,wt,bt,dr,u,gr,kt,nu,ni,ti,et,fi,si,tu,iu,ru,wi,l,e,f,uu,a,ht,wu,bu,c,r,ar,vu;ri(this);var ct=this._billboards,h=ct.length,s=n.context;if(this._instanced=s.instancedArrays,yt=this._instanced?yr:vr,ui=this._instanced?wr:pr,v=this._textureAtlas,!o(v))for(v=this._textureAtlas=new at({context:s}),vt=0;vt<h;++vt)ct[vt]._loadImage();if(w=v.textureCoordinates,w.length!==0){su(this,n);ct=this._billboards;h=ct.length;var br=this._billboardsToUpdate,b=this._billboardsToUpdateIndex,i=this._propertiesChanged,yu=v.guid,ku=this._createVertexArray||this._textureAtlasGUID!==yu;if(this._textureAtlasGUID=yu,pt=n.passes,pu=pt.pick,ku||!pu&&this.computeNewBuffersUsage()){for(this._createVertexArray=!1,wt=0;wt<ii;++wt)i[wt]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),h>0){for(this._vaf=kr(s,h,this._buffersUsage,this._instanced,this._batchTable),rt=this._vaf.writers,bt=0;bt<h;++bt)dr=this._billboards[bt],dr._dirty=!1,ou(this,s,w,rt,dr);this._vaf.commit(ui(s))}this._billboardsToUpdateIndex=0}else if(b>0){if(u=ur,u.length=0,(i[dt]||i[hr]||i[sr])&&u.push(bi),(i[gt]||i[hi]||i[er]||i[or]||i[fr])&&(u.push(di),this._instanced&&u.push(oi)),(i[gt]||i[cr]||i[vi])&&(u.push(gi),u.push(ei)),(i[gt]||i[li])&&u.push(ei),i[ci]&&u.push(oi),i[ai]&&u.push(nr),i[yi]&&u.push(tr),(i[pi]||i[lr]||i[gt]||i[dt])&&u.push(ir),(i[gt]||i[dt])&&u.push(rr),gr=u.length,rt=this._vaf.writers,b/h>.1){for(kt=0;kt<b;++kt)for(nu=br[kt],nu._dirty=!1,ni=0;ni<gr;++ni)u[ni](this,s,w,rt,nu);this._vaf.commit(ui(s))}else{for(ti=0;ti<b;++ti){for(et=br[ti],et._dirty=!1,fi=0;fi<gr;++fi)u[fi](this,s,w,rt,et);this._instanced?this._vaf.subCommit(et._index,1):this._vaf.subCommit(et._index*4,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if((b>h*1.5&&(br.length=h),o(this._vaf)&&o(this._vaf.va))&&(this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,t.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC)),tu=y.IDENTITY,n.mode===lt.SCENE3D?(tu=this.modelMatrix,si=t.clone(this._baseVolumeWC,this._boundingVolume)):si=t.clone(this._baseVolume2D,this._boundingVolume),hu(this,n,si),iu=this._blendOption!==this.blendOption,this._blendOption=this.blendOption,iu&&(this._rsOpaque=this._blendOption===st.OPAQUE||this._blendOption===st.OPAQUE_AND_TRANSLUCENT?nt.fromCache({depthTest:{enabled:!0,func:p.LESS},depthMask:!0}):undefined,ru=this._blendOption===st.TRANSLUCENT,this._rsTranslucent=this._blendOption===st.TRANSLUCENT||this._blendOption===st.OPAQUE_AND_TRANSLUCENT?nt.fromCache({depthTest:{enabled:!0,func:ru?p.LEQUAL:p.LESS},depthMask:ru,blending:ot.ALPHA_BLEND}):undefined),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||n.minimumDisableDepthTestDistance!==0,a=k.maximumVertexTextureImageUnits>0,(iu||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround)&&(wi=ft,l=ut,uu=[],o(this._batchTable)&&(uu.push("VECTOR_TILE"),wi=this._batchTable.getVertexShaderCallback(!1,"a_batchId",undefined)(wi),l=this._batchTable.getFragmentShaderCallback(!1,undefined)(l)),e=new it({defines:uu,sources:[wi]}),this._instanced&&e.defines.push("INSTANCED"),this._shaderRotation&&e.defines.push("ROTATION"),this._shaderAlignedAxis&&e.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&e.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&e.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&e.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&e.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&e.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(a?e.defines.push("VERTEX_DEPTH_CHECK"):e.defines.push("FRAGMENT_DEPTH_CHECK")),ht=o(this._batchTable)?"VECTOR_TILE":"",this._blendOption===st.OPAQUE_AND_TRANSLUCENT&&(f=new it({defines:["OPAQUE",ht],sources:[l]}),this._shaderClampToGround&&(a?f.defines.push("VERTEX_DEPTH_CHECK"):f.defines.push("FRAGMENT_DEPTH_CHECK")),this._sp=tt.replaceCache({context:s,shaderProgram:this._sp,vertexShaderSource:e,fragmentShaderSource:f,attributeLocations:yt}),f=new it({defines:["TRANSLUCENT",ht],sources:[l]}),this._shaderClampToGround&&(a?f.defines.push("VERTEX_DEPTH_CHECK"):f.defines.push("FRAGMENT_DEPTH_CHECK")),this._spTranslucent=tt.replaceCache({context:s,shaderProgram:this._spTranslucent,vertexShaderSource:e,fragmentShaderSource:f,attributeLocations:yt})),this._blendOption===st.OPAQUE&&(f=new it({defines:[ht],sources:[l]}),this._shaderClampToGround&&(a?f.defines.push("VERTEX_DEPTH_CHECK"):f.defines.push("FRAGMENT_DEPTH_CHECK")),this._sp=tt.replaceCache({context:s,shaderProgram:this._sp,vertexShaderSource:e,fragmentShaderSource:f,attributeLocations:yt})),this._blendOption===st.TRANSLUCENT&&(f=new it({defines:[ht],sources:[l]}),this._shaderClampToGround&&(a?f.defines.push("VERTEX_DEPTH_CHECK"):f.defines.push("FRAGMENT_DEPTH_CHECK")),this._spTranslucent=tt.replaceCache({context:s,shaderProgram:this._spTranslucent,vertexShaderSource:e,fragmentShaderSource:f,attributeLocations:yt})),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround),wu=n.commandList,pt.render||pt.pick)){var fu=this._colorCommands,du=this._blendOption===st.OPAQUE,ki=this._blendOption===st.OPAQUE_AND_TRANSLUCENT,eu=this._vaf.va,cu=eu.length,lu=this._uniforms,au;for(o(this._batchTable)?(lu=this._batchTable.getUniformMapCallback()(lu),au=this._batchTable.getPickId()):au="v_pickColor",fu.length=cu,bu=ki?cu*2:cu,c=0;c<bu;++c)r=fu[c],o(r)||(r=fu[c]=new d),ar=du||ki&&c%2==0,r.pass=ar||!ki?g.OPAQUE:g.TRANSLUCENT,r.owner=this,vu=ki?Math.floor(c/2):c,r.boundingVolume=si,r.modelMatrix=tu,r.count=eu[vu].indicesCount,r.shaderProgram=ar?this._sp:this._spTranslucent,r.uniformMap=lu,r.vertexArray=eu[vu].va,r.renderState=ar?this._rsOpaque:this._rsTranslucent,r.debugShowBoundingVolume=this.debugShowBoundingVolume,r.pickId=au,this._instanced&&(r.count=6,r.instanceCount=h),wu.push(r)}}},pt.prototype.isDestroyed=function(){return!1},pt.prototype.destroy=function(){return o(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=undefined),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),wi(this._billboards),h(this)},pt});t("Scene/LabelStyle",["../Core/freezeObject"],function(n){"use strict";return n({FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2})});t("Scene/Label",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/freezeObject","../Core/NearFarScalar","./Billboard","./HeightReference","./HorizontalOrigin","./LabelStyle","./VerticalOrigin"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function k(n){n._rebindAllGlyphs||n._repositionAllGlyphs||n._labelCollection._labelsToUpdate.push(n);n._rebindAllGlyphs=!0}function d(n){n._rebindAllGlyphs||n._repositionAllGlyphs||n._labelCollection._labelsToUpdate.push(n);n._repositionAllGlyphs=!0}function b(n,e){if(n=u(n,u.EMPTY_OBJECT),f(n.disableDepthTestDistance)&&n.disableDepthTestDistance<0)throw new o("disableDepthTestDistance must be greater than 0.0.");var h=n.translucencyByDistance,l=n.pixelOffsetScaleByDistance,w=n.scaleByDistance,b=n.distanceDisplayCondition;if(f(h)){if(h.far<=h.near)throw new o("translucencyByDistance.far must be greater than translucencyByDistance.near.");h=c.clone(h)}if(f(l)){if(l.far<=l.near)throw new o("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");l=c.clone(l)}if(f(w)){if(w.far<=w.near)throw new o("scaleByDistance.far must be greater than scaleByDistance.near.");w=c.clone(w)}if(f(b)){if(b.far<=b.near)throw new o("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");b=s.clone(b)}this._renderedText=undefined;this._text=undefined;this._show=u(n.show,!0);this._font=u(n.font,"30px sans-serif");this._fillColor=r.clone(u(n.fillColor,r.WHITE));this._outlineColor=r.clone(u(n.outlineColor,r.BLACK));this._outlineWidth=u(n.outlineWidth,1);this._showBackground=u(n.showBackground,!1);this._backgroundColor=u(n.backgroundColor,new r(.165,.165,.165,.8));this._backgroundPadding=u(n.backgroundPadding,new t(7,5));this._style=u(n.style,y.FILL);this._verticalOrigin=u(n.verticalOrigin,p.BASELINE);this._horizontalOrigin=u(n.horizontalOrigin,v.LEFT);this._pixelOffset=t.clone(u(n.pixelOffset,t.ZERO));this._eyeOffset=i.clone(u(n.eyeOffset,i.ZERO));this._position=i.clone(u(n.position,i.ZERO));this._scale=u(n.scale,1);this._id=n.id;this._translucencyByDistance=h;this._pixelOffsetScaleByDistance=l;this._scaleByDistance=w;this._heightReference=u(n.heightReference,a.NONE);this._distanceDisplayCondition=b;this._disableDepthTestDistance=n.disableDepthTestDistance;this._labelCollection=e;this._glyphs=[];this._backgroundBillboard=undefined;this._batchIndex=undefined;this._rebindAllGlyphs=!0;this._repositionAllGlyphs=!0;this._actualClampedPosition=undefined;this._removeCallbackFunc=undefined;this._mode=undefined;this._clusterShow=!0;this.text=u(n.text,"");this._updateClamping()}function it(n,t){for(var r,o=[],u="",f=w.LTR,i="",s=n.length,e=0;e<s;++e)r=n.charAt(e),i=t.test(r)?w.RTL:/[a-zA-Z0-9]/.test(r)?w.LTR:/[()[\]{}<>]/.test(r)?w.BRACKETS:w.WEAK,e===0&&(f=i),f===i&&i!==w.BRACKETS?u+=r:(u!==""&&o.push({Type:f,Word:u}),f=i,u=r);return o.push({Type:i,Word:u}),o}function nt(n){return n.split("").reverse().join("")}function g(n,t,i){return n.slice(0,t)+i+n.slice(t)}function rt(n){switch(n){case"(":return")";case")":return"(";case"[":return"]";case"]":return"[";case"{":return"}";case"}":return"{";case"<":return">";case">":return"<"}}function ut(n){for(var u,i,e,s=n.split("\n"),h="",o=0;o<s.length;o++){var c=s[o],l=tt.test(c.charAt(0)),f=it(c,tt),r=0,t="";for(u=0;u<f.length;++u)i=f[u],e=i.Type===w.BRACKETS?rt(i.Word):i.Word,l?i.Type===w.RTL?(t=nt(i.Word)+t,r=0):i.Type===w.LTR?(t=g(t,r,i.Word),r+=i.Word.length):(i.Type===w.WEAK||i.Type===w.BRACKETS)&&(i.Type===w.WEAK&&f[u-1].Type===w.BRACKETS?t=nt(i.Word)+t:f[u-1].Type===w.RTL?(t=e+t,r=0):f.length>u+1?f[u+1].Type===w.RTL?(t=e+t,r=0):(t=g(t,r,i.Word),r+=i.Word.length):t=g(t,0,e)):i.Type===w.RTL?t=g(t,r,nt(i.Word)):i.Type===w.LTR?(t+=i.Word,r=t.length):(i.Type===w.WEAK||i.Type===w.BRACKETS)&&(u>0?f[u-1].Type===w.RTL?f.length>u+1?f[u+1].Type===w.RTL?t=g(t,r,e):(t+=i.Word,r=t.length):t+=i.Word:(t+=i.Word,r=t.length):(t+=i.Word,r=t.length));h+=t;o<s.length-1&&(h+="\n")}return h}var w=h({LTR:0,RTL:1,WEAK:2,BRACKETS:3});e(b.prototype,{show:{get:function(){return this._show},set:function(n){var i,t,e,r,u;if(!f(n))throw new o("value is required.");if(this._show!==n){for(this._show=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t].billboard,f(r)&&(r.show=n);u=this._backgroundBillboard;f(u)&&(u.show=n)}}},position:{get:function(){return this._position},set:function(n){var r,u,t,h,e,s;if(!f(n))throw new o("value is required.");if(r=this._position,!i.equals(r,n)){for(i.clone(n,r),u=this._glyphs,t=0,h=u.length;t<h;t++)e=u[t].billboard,f(e)&&(e.position=n);s=this._backgroundBillboard;f(s)&&(s.position=n);this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(n){var i,t,e,r,u;if(!f(n))throw new o("value is required.");if(n!==this._heightReference){for(this._heightReference=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t].billboard,f(r)&&(r.heightReference=n);u=this._backgroundBillboard;f(u)&&(u.heightReference=n);d(this);this._updateClamping()}}},text:{get:function(){return this._text},set:function(n){if(!f(n))throw new o("value is required.");this._text!==n&&(this._text=n,this._renderedText=b.enableRightToLeftDetection?ut(n):n,k(this))}},font:{get:function(){return this._font},set:function(n){if(!f(n))throw new o("value is required.");this._font!==n&&(this._font=n,k(this))}},fillColor:{get:function(){return this._fillColor},set:function(n){if(!f(n))throw new o("value is required.");var t=this._fillColor;r.equals(t,n)||(r.clone(n,t),k(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(n){if(!f(n))throw new o("value is required.");var t=this._outlineColor;r.equals(t,n)||(r.clone(n,t),k(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(n){if(!f(n))throw new o("value is required.");this._outlineWidth!==n&&(this._outlineWidth=n,k(this))}},showBackground:{get:function(){return this._showBackground},set:function(n){if(!f(n))throw new o("value is required.");this._showBackground!==n&&(this._showBackground=n,k(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(n){var t,i;if(!f(n))throw new o("value is required.");t=this._backgroundColor;r.equals(t,n)||(r.clone(n,t),i=this._backgroundBillboard,f(i)&&(i.color=t))}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(n){if(!f(n))throw new o("value is required.");var i=this._backgroundPadding;t.equals(i,n)||(t.clone(n,i),d(this))}},style:{get:function(){return this._style},set:function(n){if(!f(n))throw new o("value is required.");this._style!==n&&(this._style=n,k(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(n){var r,u,i,h,e,s;if(!f(n))throw new o("value is required.");if(r=this._pixelOffset,!t.equals(r,n)){for(t.clone(n,r),u=this._glyphs,i=0,h=u.length;i<h;i++)e=u[i],f(e.billboard)&&(e.billboard.pixelOffset=n);s=this._backgroundBillboard;f(s)&&(s.pixelOffset=n)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(n){var i,r,t,s,u,e;if(f(n)&&n.far<=n.near)throw new o("far distance must be greater than near distance.");if(i=this._translucencyByDistance,!c.equals(i,n)){for(this._translucencyByDistance=c.clone(n,i),r=this._glyphs,t=0,s=r.length;t<s;t++)u=r[t],f(u.billboard)&&(u.billboard.translucencyByDistance=n);e=this._backgroundBillboard;f(e)&&(e.translucencyByDistance=n)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(n){var i,r,t,s,u,e;if(f(n)&&n.far<=n.near)throw new o("far distance must be greater than near distance.");if(i=this._pixelOffsetScaleByDistance,!c.equals(i,n)){for(this._pixelOffsetScaleByDistance=c.clone(n,i),r=this._glyphs,t=0,s=r.length;t<s;t++)u=r[t],f(u.billboard)&&(u.billboard.pixelOffsetScaleByDistance=n);e=this._backgroundBillboard;f(e)&&(e.pixelOffsetScaleByDistance=n)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(n){var i,r,t,s,u,e;if(f(n)&&n.far<=n.near)throw new o("far distance must be greater than near distance.");if(i=this._scaleByDistance,!c.equals(i,n)){for(this._scaleByDistance=c.clone(n,i),r=this._glyphs,t=0,s=r.length;t<s;t++)u=r[t],f(u.billboard)&&(u.billboard.scaleByDistance=n);e=this._backgroundBillboard;f(e)&&(e.scaleByDistance=n)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(n){var r,u,t,h,e,s;if(!f(n))throw new o("value is required.");if(r=this._eyeOffset,!i.equals(r,n)){for(i.clone(n,r),u=this._glyphs,t=0,h=u.length;t<h;t++)e=u[t],f(e.billboard)&&(e.billboard.eyeOffset=n);s=this._backgroundBillboard;f(s)&&(s.eyeOffset=n)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(n){if(!f(n))throw new o("value is required.");this._horizontalOrigin!==n&&(this._horizontalOrigin=n,d(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(n){var i,t,e,r,u;if(!f(n))throw new o("value is required.");if(this._verticalOrigin!==n){for(this._verticalOrigin=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t],f(r.billboard)&&(r.billboard.verticalOrigin=n);u=this._backgroundBillboard;f(u)&&(u.verticalOrigin=n);d(this)}}},scale:{get:function(){return this._scale},set:function(n){var i,t,e,r,u;if(!f(n))throw new o("value is required.");if(this._scale!==n){for(this._scale=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t],f(r.billboard)&&(r.billboard.scale=n);u=this._backgroundBillboard;f(u)&&(u.scale=n);d(this)}}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(n){var i,t,e,r,u;if(f(n)&&n.far<=n.near)throw new o("far must be greater than near");if(!s.equals(n,this._distanceDisplayCondition)){for(this._distanceDisplayCondition=s.clone(n,this._distanceDisplayCondition),i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t],f(r.billboard)&&(r.billboard.distanceDisplayCondition=n);u=this._backgroundBillboard;f(u)&&(u.distanceDisplayCondition=n)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(n){var i,t,e,r,u;if(this._disableDepthTestDistance!==n){if(f(n)&&n<0)throw new o("disableDepthTestDistance must be greater than 0.0.");for(this._disableDepthTestDistance=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t],f(r.billboard)&&(r.billboard.disableDepthTestDistance=n);u=this._backgroundBillboard;f(u)&&(u.disableDepthTestDistance=n)}}},id:{get:function(){return this._id},set:function(n){var i,t,e,r,u;if(this._id!==n){for(this._id=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t],f(r.billboard)&&(r.billboard.id=n);u=this._backgroundBillboard;f(u)&&(u.id=n)}}},pickId:{get:function(){return this._glyphs.length===0||!f(this._glyphs[0].billboard)?undefined:this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(n){var r,t,o,u,e;for(this._actualClampedPosition=i.clone(n,this._actualClampedPosition),r=this._glyphs,t=0,o=r.length;t<o;t++)u=r[t],f(u.billboard)&&(u.billboard._clampedPosition=n);e=this._backgroundBillboard;f(e)&&(e._clampedPosition=n)}},clusterShow:{get:function(){return this._clusterShow},set:function(n){var i,t,e,r,u;if(this._clusterShow!==n){for(this._clusterShow=n,i=this._glyphs,t=0,e=i.length;t<e;t++)r=i[t],f(r.billboard)&&(r.billboard.clusterShow=n);u=this._backgroundBillboard;f(u)&&(u.clusterShow=n)}}}});b.prototype._updateClamping=function(){l._updateClamping(this._labelCollection,this)};b.prototype.computeScreenSpacePosition=function(n,i){if(!f(n))throw new o("scene is required.");f(i)||(i=new t);var r=this._labelCollection,u=r.modelMatrix,e=f(this._actualClampedPosition)?this._actualClampedPosition:this._position;return l._computeScreenSpacePosition(u,e,this._eyeOffset,this._pixelOffset,n,i)};b.getScreenSpaceBoundingBox=function(t,i,r){var e=0,u=0,y=0,s=0,c=t.scale,l=t._labelCollection._resolutionScale,h=t._backgroundBillboard,a,g,o;if(f(h))e=i.x+h._translate.x/l,u=i.y-h._translate.y/l,y=h.width*c,s=h.height*c,t.verticalOrigin===p.BOTTOM||t.verticalOrigin===p.BASELINE?u-=s:t.verticalOrigin===p.CENTER&&(u-=s*.5);else{e=Number.POSITIVE_INFINITY;u=Number.POSITIVE_INFINITY;var w=0,b=0,d=t._glyphs,tt=d.length;for(a=0;a<tt;++a)if(g=d[a],o=g.billboard,f(o)){var nt=i.x+o._translate.x/l,v=i.y-o._translate.y/l,it=o.width*c,k=o.height*c;t.verticalOrigin===p.BOTTOM||t.verticalOrigin===p.BASELINE?v-=k:t.verticalOrigin===p.CENTER&&(v-=k*.5);e=Math.min(e,nt);u=Math.min(u,v);w=Math.max(w,nt+it);b=Math.max(b,v+k)}y=w-e;s=b-u}return f(r)||(r=new n),r.x=e,r.y=u,r.width=y,r.height=s,r};b.prototype.equals=function(n){return this===n||f(n)&&this._show===n._show&&this._scale===n._scale&&this._outlineWidth===n._outlineWidth&&this._showBackground===n._showBackground&&this._style===n._style&&this._verticalOrigin===n._verticalOrigin&&this._horizontalOrigin===n._horizontalOrigin&&this._heightReference===n._heightReference&&this._renderedText===n._renderedText&&this._font===n._font&&i.equals(this._position,n._position)&&r.equals(this._fillColor,n._fillColor)&&r.equals(this._outlineColor,n._outlineColor)&&r.equals(this._backgroundColor,n._backgroundColor)&&t.equals(this._backgroundPadding,n._backgroundPadding)&&t.equals(this._pixelOffset,n._pixelOffset)&&i.equals(this._eyeOffset,n._eyeOffset)&&c.equals(this._translucencyByDistance,n._translucencyByDistance)&&c.equals(this._pixelOffsetScaleByDistance,n._pixelOffsetScaleByDistance)&&c.equals(this._scaleByDistance,n._scaleByDistance)&&s.equals(this._distanceDisplayCondition,n._distanceDisplayCondition)&&this._disableDepthTestDistance===n._disableDepthTestDistance&&this._id===n._id};b.prototype.isDestroyed=function(){return!1};b.enableRightToLeftDetection=!1;var tt=new RegExp("[----]");return b});t("Scene/LabelCollection",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Matrix4","../Core/writeTextToCanvas","./BillboardCollection","./BlendOption","./HeightReference","./HorizontalOrigin","./Label","./LabelStyle","./TextureAtlas","./VerticalOrigin"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function ft(){this.textureInfo=undefined;this.dimensions=undefined;this.billboard=undefined}function et(n,t,i){this.labelCollection=n;this.index=t;this.dimensions=i}function ht(n,t){var i=document.createElement("canvas"),r;i.width=nt.x;i.height=nt.y;r=i.getContext("2d");r.fillStyle="#fff";r.fillRect(0,0,i.width,i.height);n.addImage(it,i).then(function(n){t._whitePixelIndex=n})}function ct(n,t,i,r,u,f,e){return d.font=t,d.fillColor=i,d.strokeColor=r,d.strokeWidth=u,d.textBaseline=e===b.CENTER?"middle":e===b.TOP?"top":"bottom",d.fill=f===p.FILL||f===p.FILL_AND_OUTLINE,d.stroke=f===p.OUTLINE||f===p.FILL_AND_OUTLINE,h(n,d)}function tt(n,t){t.textureInfo=undefined;t.dimensions=undefined;var i=t.billboard;u(i)&&(i.show=!1,i.image=undefined,u(i._removeCallbackFunc)&&(i._removeCallbackFunc(),i._removeCallbackFunc=undefined),n._spareBillboards.push(i),t.billboard=undefined)}function lt(n,t,i,r){n.addImage(t,i).then(function(n){r.index=n})}function at(n,i){var p=i._renderedText,l=p.length,h=i._glyphs,k=h.length,e,a,s,w,c,r,b;if(l<k)for(a=l;a<k;++a)tt(n,h[a]);h.length=l;var vt=i._showBackground&&p.split("\n").join("").length>0,f=i._backgroundBillboard,d=n._backgroundBillboardCollection;for(vt?(u(f)||(f=d.add({collection:n,image:it,imageSubRegion:st}),i._backgroundBillboard=f),f.color=i._backgroundColor,f.show=i._show,f.position=i._position,f.eyeOffset=i._eyeOffset,f.pixelOffset=i._pixelOffset,f.horizontalOrigin=v.LEFT,f.verticalOrigin=i._verticalOrigin,f.heightReference=i._heightReference,f.scale=i._scale,f.pickPrimitive=i,f.id=i._id,f.translucencyByDistance=i._translucencyByDistance,f.pixelOffsetScaleByDistance=i._pixelOffsetScaleByDistance,f.scaleByDistance=i._scaleByDistance,f.distanceDisplayCondition=i._distanceDisplayCondition,f.disableDepthTestDistance=i._disableDepthTestDistance):u(f)&&(d.remove(f),i._backgroundBillboard=f=undefined),w=n._glyphTextureCache,s=0;s<l;++s){var g=p.charAt(s),nt=i._font,rt=i._fillColor,ut=i._outlineColor,ot=i._outlineWidth,ht=i._style,at=i._verticalOrigin,y=JSON.stringify([g,nt,rt.toRgba(),ut.toRgba(),ot,+ht,+at]),o=w[y];u(o)||(c=ct(g,nt,rt,ut,ot,ht,at),o=new et(n,-1,c.dimensions),w[y]=o,c.width>0&&c.height>0&&lt(n._textureAtlas,y,c,o));e=h[s];u(e)?o.index===-1?tt(n,e):u(e.textureInfo)&&(e.textureInfo=undefined):(e=new ft,h[s]=e);e.textureInfo=o;e.dimensions=o.dimensions;o.index!==-1&&(r=e.billboard,b=n._spareBillboards,u(r)||(b.length>0?r=b.pop():(r=n._billboardCollection.add({collection:n}),r._labelDimensions=new t,r._labelTranslate=new t),e.billboard=r),r.show=i._show,r.position=i._position,r.eyeOffset=i._eyeOffset,r.pixelOffset=i._pixelOffset,r.horizontalOrigin=v.LEFT,r.verticalOrigin=i._verticalOrigin,r.heightReference=i._heightReference,r.scale=i._scale,r.pickPrimitive=i,r.id=i._id,r.image=y,r.translucencyByDistance=i._translucencyByDistance,r.pixelOffsetScaleByDistance=i._pixelOffsetScaleByDistance,r.scaleByDistance=i._scaleByDistance,r.distanceDisplayCondition=i._distanceDisplayCondition,r.disableDepthTestDistance=i._disableDepthTestDistance,r._batchIndex=i._batchIndex)}i._repositionAllGlyphs=!0}function rt(n,t,i){return t===v.CENTER?-n/2:t===v.RIGHT?-(n+i.x):i.x}function yt(n,i){for(var l=n._glyphs,st=n._renderedText,e,f,y=0,g=0,it=[],h=Number.NEGATIVE_INFINITY,c=0,pt=1,nt=l.length,o=n._backgroundBillboard,s=t.clone(u(o)?n._backgroundPadding:t.ZERO,vt),yt,bt,et,r=0;r<nt;++r)st.charAt(r)==="\n"?(it.push(y),++pt,y=0):(e=l[r],f=e.dimensions,c=Math.max(c,f.height-f.descent),h=Math.max(h,f.descent),y+=f.width-f.bounds.minx,r<nt-1&&(y+=l[r+1].dimensions.bounds.minx),g=Math.max(g,y));it.push(y);var ut=c+h,p=n._scale,w=n._horizontalOrigin,d=n._verticalOrigin,ht=0,ct=it[ht],tt=rt(ct,w,s),wt=ot*ut,ft=wt*(pt-1),lt=g,at=ut+ft;for(u(o)&&(lt+=s.x*2,at+=s.y*2,o._labelHorizontalOrigin=w),k.x=tt*p*i,k.y=0,yt=0,r=0;r<nt;++r)st.charAt(r)==="\n"?(++ht,yt+=wt,ct=it[ht],tt=rt(ct,w,s),k.x=tt*p*i):(e=l[r],f=e.dimensions,k.y=d===b.TOP?f.height-c-s.y:d===b.CENTER?(ft+f.height-c)/2:d===b.BASELINE?ft:ft+h+s.y,k.y=(k.y-f.descent-yt)*p*i,u(e.billboard)&&(e.billboard._setTranslate(k),e.billboard._labelDimensions.x=lt,e.billboard._labelDimensions.y=at,e.billboard._labelHorizontalOrigin=w),r<nt-1&&(bt=l[r+1],k.x+=(f.width-f.bounds.minx+bt.dimensions.bounds.minx)*p*i));if(u(o)&&st.split("\n").join("").length>0&&(tt=w===v.CENTER?-g/2-s.x:w===v.RIGHT?-(g+s.x*2):0,k.x=tt*p*i,k.y=d===b.TOP?ut-c-h:d===b.CENTER?(ut-c)/2-h:d===b.BASELINE?-s.y-h:0,k.y=k.y*p*i,o.width=lt,o.height=at,o._setTranslate(k),o._labelTranslate=t.clone(k,o._labelTranslate)),n.heightReference===a.CLAMP_TO_GROUND)for(r=0;r<nt;++r)e=l[r],et=e.billboard,u(et)&&(et._labelTranslate=t.clone(k,et._labelTranslate))}function ut(n,t){for(var r=t._glyphs,i=0,f=r.length;i<f;++i)tt(n,r[i]);u(t._backgroundBillboard)&&(n._backgroundBillboardCollection.remove(t._backgroundBillboard),t._backgroundBillboard=undefined);t._labelCollection=undefined;u(t._removeCallbackFunc)&&t._removeCallbackFunc();e(t)}function g(n){n=r(n,r.EMPTY_OBJECT);this._scene=n.scene;this._batchTable=n.batchTable;this._textureAtlas=undefined;this._backgroundTextureAtlas=undefined;this._whitePixelIndex=undefined;this._backgroundBillboardCollection=new c({scene:this._scene});this._backgroundBillboardCollection.destroyTextureAtlas=!1;this._billboardCollection=new c({scene:this._scene,batchTable:this._batchTable});this._billboardCollection.destroyTextureAtlas=!1;this._spareBillboards=[];this._glyphTextureCache={};this._labels=[];this._labelsToUpdate=[];this._totalGlyphCount=0;this._resolutionScale=undefined;this._highlightColor=i.clone(i.WHITE);this.modelMatrix=s.clone(r(n.modelMatrix,s.IDENTITY));this.debugShowBoundingVolume=r(n.debugShowBoundingVolume,!1);this.blendOption=r(n.blendOption,l.OPAQUE_AND_TRANSLUCENT)}var ot=1.2,it="ID_WHITE_PIXEL",nt=new t(4,4),st=new n(1,1,1,1),d={},k=new t,vt=new t;return f(g.prototype,{length:{get:function(){return this._labels.length}}}),g.prototype.add=function(n){var t=new y(n,this);return this._labels.push(t),this._labelsToUpdate.push(t),t},g.prototype.remove=function(n){if(u(n)&&n._labelCollection===this){var t=this._labels.indexOf(n);if(t!==-1)return this._labels.splice(t,1),ut(this,n),!0}return!1},g.prototype.removeAll=function(){for(var n=this._labels,t=0,i=n.length;t<i;++t)ut(this,n[t]);n.length=0},g.prototype.contains=function(n){return u(n)&&n._labelCollection===this},g.prototype.get=function(n){if(!u(n))throw new o("index is required.");return this._labels[n]},g.prototype.update=function(n){var r=this._billboardCollection,i=this._backgroundBillboardCollection,f,s,a,e,t,v,y,h;r.modelMatrix=this.modelMatrix;r.debugShowBoundingVolume=this.debugShowBoundingVolume;i.modelMatrix=this.modelMatrix;i.debugShowBoundingVolume=this.debugShowBoundingVolume;f=n.context;u(this._textureAtlas)||(this._textureAtlas=new w({context:f}),r.textureAtlas=this._textureAtlas);u(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new w({context:f,initialSize:nt}),i.textureAtlas=this._backgroundTextureAtlas,ht(this._backgroundTextureAtlas,this));var p=f.uniformState,o=p.resolutionScale,c=this._resolutionScale!==o;for(this._resolutionScale=o,s=c?this._labels:this._labelsToUpdate,a=s.length,e=0;e<a;++e)(t=s[e],t.isDestroyed())||(v=t._glyphs.length,t._rebindAllGlyphs&&(at(this,t),t._rebindAllGlyphs=!1),(c||t._repositionAllGlyphs)&&(yt(t,o),t._repositionAllGlyphs=!1),y=t._glyphs.length-v,this._totalGlyphCount+=y);h=i.length>0?l.TRANSLUCENT:this.blendOption;r.blendOption=h;i.blendOption=h;r._highlightColor=this._highlightColor;i._highlightColor=this._highlightColor;this._labelsToUpdate.length=0;i.update(n);r.update(n)},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),e(this)},g});t("Scene/PointPrimitive",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/Matrix4","../Core/NearFarScalar","./SceneMode","./SceneTransforms"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(n,t){if(n=f(n,f.EMPTY_OBJECT),e(n.disableDepthTestDistance)&&n.disableDepthTestDistance<0)throw new s("disableDepthTestDistance must be greater than or equal to 0.0.");var r=n.translucencyByDistance,o=n.scaleByDistance,c=n.distanceDisplayCondition;if(e(r)){if(r.far<=r.near)throw new s("translucencyByDistance.far must be greater than translucencyByDistance.near.");r=l.clone(r)}if(e(o)){if(o.far<=o.near)throw new s("scaleByDistance.far must be greater than scaleByDistance.near.");o=l.clone(o)}if(e(c)){if(c.far<=c.near)throw new s("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");c=h.clone(c)}this._show=f(n.show,!0);this._position=i.clone(f(n.position,i.ZERO));this._actualPosition=i.clone(this._position);this._color=u.clone(f(n.color,u.WHITE));this._outlineColor=u.clone(f(n.outlineColor,u.TRANSPARENT));this._outlineWidth=f(n.outlineWidth,0);this._pixelSize=f(n.pixelSize,10);this._scaleByDistance=o;this._translucencyByDistance=r;this._distanceDisplayCondition=c;this._disableDepthTestDistance=f(n.disableDepthTestDistance,0);this._id=n.id;this._collection=f(n.collection,t);this._clusterShow=!0;this._pickId=undefined;this._pointPrimitiveCollection=t;this._dirty=!1;this._index=-1}function p(n,t){var i=n._pointPrimitiveCollection;e(i)&&(i._updatePointPrimitive(n,t),n._dirty=!0)}var k=y.SHOW_INDEX=0,d=y.POSITION_INDEX=1,g=y.COLOR_INDEX=2,nt=y.OUTLINE_COLOR_INDEX=3,tt=y.OUTLINE_WIDTH_INDEX=4,it=y.PIXEL_SIZE_INDEX=5,rt=y.SCALE_BY_DISTANCE_INDEX=6,ut=y.TRANSLUCENCY_BY_DISTANCE_INDEX=7,ft=y.DISTANCE_DISPLAY_CONDITION_INDEX=8,et=y.DISABLE_DEPTH_DISTANCE_INDEX=9,w,b;return y.NUMBER_OF_PROPERTIES=10,o(y.prototype,{show:{get:function(){return this._show},set:function(n){if(!e(n))throw new s("value is required.");this._show!==n&&(this._show=n,p(this,k))}},position:{get:function(){return this._position},set:function(n){if(!e(n))throw new s("value is required.");var t=this._position;i.equals(t,n)||(i.clone(n,t),i.clone(n,this._actualPosition),p(this,d))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(n){if(e(n)&&n.far<=n.near)throw new s("far distance must be greater than near distance.");var t=this._scaleByDistance;l.equals(t,n)||(this._scaleByDistance=l.clone(n,t),p(this,rt))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(n){if(e(n)&&n.far<=n.near)throw new s("far distance must be greater than near distance.");var t=this._translucencyByDistance;l.equals(t,n)||(this._translucencyByDistance=l.clone(n,t),p(this,ut))}},pixelSize:{get:function(){return this._pixelSize},set:function(n){if(!e(n))throw new s("value is required.");this._pixelSize!==n&&(this._pixelSize=n,p(this,it))}},color:{get:function(){return this._color},set:function(n){if(!e(n))throw new s("value is required.");var t=this._color;u.equals(t,n)||(u.clone(n,t),p(this,g))}},outlineColor:{get:function(){return this._outlineColor},set:function(n){if(!e(n))throw new s("value is required.");var t=this._outlineColor;u.equals(t,n)||(u.clone(n,t),p(this,nt))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(n){if(!e(n))throw new s("value is required.");this._outlineWidth!==n&&(this._outlineWidth=n,p(this,tt))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(n){if(e(n)&&n.far<=n.near)throw new s("far must be greater than near");h.equals(this._distanceDisplayCondition,n)||(this._distanceDisplayCondition=h.clone(n,this._distanceDisplayCondition),p(this,ft))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(n){if(this._disableDepthTestDistance!==n){if(!e(n)||n<0)throw new s("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=n;p(this,et)}}},id:{get:function(){return this._id},set:function(n){this._id=n;e(this._pickId)&&(this._pickId.object.id=n)}},pickId:{get:function(){return this._pickId}},clusterShow:{get:function(){return this._clusterShow},set:function(n){this._clusterShow!==n&&(this._clusterShow=n,p(this,k))}}}),y.prototype.getPickId=function(n){return e(this._pickId)||(this._pickId=n.createPickId({primitive:this,collection:this._collection,id:this._id})),this._pickId},y.prototype._getActualPosition=function(){return this._actualPosition},y.prototype._setActualPosition=function(n){i.clone(n,this._actualPosition);p(this,d)},w=new r,y._computeActualPosition=function(n,t,i){return t.mode===a.SCENE3D?n:(c.multiplyByPoint(i,n,w),v.computeActualWgs84Position(t,w))},b=new r,y._computeScreenSpacePosition=function(n,t,i,u){var f=c.multiplyByVector(n,r.fromElements(t.x,t.y,t.z,1,b),b);return v.wgs84ToWindowCoordinates(i,f,u)},y.prototype.computeScreenSpacePosition=function(n,i){var u=this._pointPrimitiveCollection,f,r;if(e(i)||(i=new t),!e(u))throw new s("PointPrimitive must be in a collection.");if(!e(n))throw new s("scene is required.");return(f=u.modelMatrix,r=y._computeScreenSpacePosition(f,this._actualPosition,n,i),!e(r))?undefined:(r.y=n.canvas.clientHeight-r.y,r)},y.getScreenSpaceBoundingBox=function(t,i,r){var u=t.pixelSize,f=u*.5,o=i.x-f,s=i.y-f,h=u,c=u;return e(r)||(r=new n),r.x=o,r.y=s,r.width=h,r.height=c,r},y.prototype.equals=function(n){return this===n||e(n)&&this._id===n._id&&i.equals(this._position,n._position)&&u.equals(this._color,n._color)&&this._pixelSize===n._pixelSize&&this._outlineWidth===n._outlineWidth&&this._show===n._show&&u.equals(this._outlineColor,n._outlineColor)&&l.equals(this._scaleByDistance,n._scaleByDistance)&&l.equals(this._translucencyByDistance,n._translucencyByDistance)&&h.equals(this._distanceDisplayCondition,n._distanceDisplayCondition)&&this._disableDepthTestDistance===n._disableDepthTestDistance},y.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy();this._pointPrimitiveCollection=undefined},y});t("Shaders/PointPrimitiveCollectionFS",[],function(){"use strict";return"varying vec4 v_color;\nvarying vec4 v_outlineColor;\nvarying float v_innerPercent;\nvarying float v_pixelDistance;\nvarying vec4 v_pickColor;\nvoid main()\n{\nfloat distanceToCenter = length(gl_PointCoord - vec2(0.5));\nfloat maxDistance = max(0.0, 0.5 - v_pixelDistance);\nfloat wholeAlpha = 1.0 - smoothstep(maxDistance, 0.5, distanceToCenter);\nfloat innerAlpha = 1.0 - smoothstep(maxDistance * v_innerPercent, 0.5 * v_innerPercent, distanceToCenter);\nvec4 color = mix(v_outlineColor, v_color, innerAlpha);\ncolor.a *= wholeAlpha;\n#if !defined(OPAQUE) && !defined(TRANSLUCENT)\nif (color.a < 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\nif (color.a < 0.995)\n{\ndiscard;\n}\n#else\nif (color.a >= 0.995)\n{\ndiscard;\n}\n#endif\n#endif\ngl_FragColor = color;\nczm_writeLogDepth();\n}\n"});t("Shaders/PointPrimitiveCollectionVS",[],function(){"use strict";return"uniform float u_maxTotalPointSize;\nattribute vec4 positionHighAndSize;\nattribute vec4 positionLowAndOutline;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 scaleByDistance;\nattribute vec3 distanceDisplayConditionAndDisableDepth;\nvarying vec4 v_color;\nvarying vec4 v_outlineColor;\nvarying float v_innerPercent;\nvarying float v_pixelDistance;\nvarying vec4 v_pickColor;\nconst float SHIFT_LEFT8 = 256.0;\nconst float SHIFT_RIGHT8 = 1.0 / 256.0;\nvoid main()\n{\nvec3 positionHigh = positionHighAndSize.xyz;\nvec3 positionLow = positionLowAndOutline.xyz;\nfloat outlineWidthBothSides = 2.0 * positionLowAndOutline.w;\nfloat totalSize = positionHighAndSize.w + outlineWidthBothSides;\nfloat outlinePercent = outlineWidthBothSides / totalSize;\ntotalSize *= czm_resolutionScale;\ntotalSize += 3.0;\nfloat temp = compressedAttribute1.x * SHIFT_RIGHT8;\nfloat show = floor(temp);\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x = compressedAttribute1.z;\ntranslucencyByDistance.z = compressedAttribute1.w;\ntranslucencyByDistance.y = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp = compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w = ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\nvec4 color;\nvec4 outlineColor;\nvec4 pickColor;\ntemp = compressedAttribute0.z * SHIFT_RIGHT8;\npickColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\npickColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r = floor(temp);\ntemp = compressedAttribute0.x * SHIFT_RIGHT8;\ncolor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\ncolor.g = (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r = floor(temp);\ntemp = compressedAttribute0.y * SHIFT_RIGHT8;\noutlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.r = floor(temp);\ntemp = compressedAttribute0.w * SHIFT_RIGHT8;\npickColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\npickColor = pickColor / 255.0;\ntemp = floor(temp) * SHIFT_RIGHT8;\noutlineColor.a = (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor /= 255.0;\ncolor.a = floor(temp);\ncolor /= 255.0;\nvec4 p = czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC = czm_modelViewRelativeToEye * p;\npositionEC.xyz *= show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq = dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\ntotalSize *= czm_nearFarScalar(scaleByDistance, lengthSq);\n#endif\ntotalSize = min(totalSize, u_maxTotalPointSize);\nif (totalSize < 1.0)\n{\npositionEC.xyz = vec3(0.0);\ntotalSize = 1.0;\n}\nfloat translucency = 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency = czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency < 0.004)\n{\npositionEC.xyz = vec3(0.0);\n}\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq = distanceDisplayConditionAndDisableDepth.x;\nfloat farSq = distanceDisplayConditionAndDisableDepth.y;\nif (lengthSq < nearSq || lengthSq > farSq) {\npositionEC.xyz = vec3(0.0);\n}\n#endif\ngl_Position = czm_projection * positionEC;\nczm_vertexLogDepth();\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance = distanceDisplayConditionAndDisableDepth.z;\nif (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0)\n{\ndisableDepthTestDistance = czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance != 0.0)\n{\nfloat zclip = gl_Position.z / gl_Position.w;\nbool clipped = (zclip < -1.0 || zclip > 1.0);\nif (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance)))\n{\ngl_Position.z = -gl_Position.w;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(vec4(czm_currentFrustum.x));\n#endif\n}\n}\n#endif\nv_color = color;\nv_color.a *= translucency;\nv_outlineColor = outlineColor;\nv_outlineColor.a *= translucency;\nv_innerPercent = 1.0 - outlinePercent;\nv_pixelDistance = 2.0 / totalSize;\ngl_PointSize = totalSize;\nv_pickColor = pickColor;\n}\n"});t("Scene/PointPrimitiveCollection",["../Core/BoundingSphere","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/EncodedCartesian3","../Core/Math","../Core/Matrix4","../Core/PrimitiveType","../Core/WebGLConstants","../Renderer/BufferUsage","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArrayFacade","../Shaders/PointPrimitiveCollectionFS","../Shaders/PointPrimitiveCollectionVS","./BlendingState","./BlendOption","./PointPrimitive","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function ot(t){t=r(t,r.EMPTY_OBJECT);this._sp=undefined;this._spTranslucent=undefined;this._rsOpaque=undefined;this._rsTranslucent=undefined;this._vaf=undefined;this._pointPrimitives=[];this._pointPrimitivesToUpdate=[];this._pointPrimitivesToUpdateIndex=0;this._pointPrimitivesRemoved=!1;this._createVertexArray=!1;this._shaderScaleByDistance=!1;this._compiledShaderScaleByDistance=!1;this._shaderTranslucencyByDistance=!1;this._compiledShaderTranslucencyByDistance=!1;this._shaderDistanceDisplayCondition=!1;this._compiledShaderDistanceDisplayCondition=!1;this._shaderDisableDepthDistance=!1;this._compiledShaderDisableDepthDistance=!1;this._propertiesChanged=new Uint32Array(at);this._maxPixelSize=1;this._baseVolume=new n;this._baseVolumeWC=new n;this._baseVolume2D=new n;this._boundingVolume=new n;this._boundingVolumeDirty=!1;this._colorCommands=[];this.modelMatrix=c.clone(r(t.modelMatrix,c.IDENTITY));this._modelMatrix=c.clone(c.IDENTITY);this.debugShowBoundingVolume=r(t.debugShowBoundingVolume,!1);this.blendOption=r(t.blendOption,rt.OPAQUE_AND_TRANSLUCENT);this._blendOption=undefined;this._mode=ft.SCENE3D;this._maxTotalPointSize=1;this._buffersUsage=[v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW,v.STATIC_DRAW];var i=this;this._uniforms={u_maxTotalPointSize:function(){return i._maxTotalPointSize}}}function dt(n){for(var i=n.length,t=0;t<i;++t)n[t]&&n[t]._destroy()}function vt(n){var t,f,i;if(n._pointPrimitivesRemoved){n._pointPrimitivesRemoved=!1;var r=[],u=n._pointPrimitives,e=u.length;for(t=0,f=0;t<e;++t)i=u[t],i&&(i._index=f++,r.push(i));n._pointPrimitives=r}}function ci(n,t,r){return new g(n,[{index:et.positionHighAndSize,componentsPerAttribute:4,componentDatatype:i.FLOAT,usage:r[lt]},{index:et.positionLowAndShow,componentsPerAttribute:4,componentDatatype:i.FLOAT,usage:r[lt]},{index:et.compressedAttribute0,componentsPerAttribute:4,componentDatatype:i.FLOAT,usage:r[pt]},{index:et.compressedAttribute1,componentsPerAttribute:4,componentDatatype:i.FLOAT,usage:r[bt]},{index:et.scaleByDistance,componentsPerAttribute:4,componentDatatype:i.FLOAT,usage:r[wt]},{index:et.distanceDisplayConditionAndDisableDepth,componentsPerAttribute:3,componentDatatype:i.FLOAT,usage:r[kt]}],t)}function gt(t,i,r,u){var c=u._index,l=u._getActualPosition(),o,h,a,f,v,e;t._mode===ft.SCENE3D&&(n.expand(t._baseVolume,l,t._baseVolume),t._boundingVolumeDirty=!0);s.fromCartesian(l,ct);o=u.pixelSize;h=u.outlineWidth;t._maxPixelSize=Math.max(t._maxPixelSize,o+h);a=r[et.positionHighAndSize];f=ct.high;a(c,f.x,f.y,f.z,o);v=r[et.positionLowAndOutline];e=ct.low;v(c,e.x,e.y,e.z,h)}function ni(n,i,r,u){var a=u._index,s=u.color,h=u.getPickId(i).color,c=u.outlineColor,f=t.floatToByte(s.red),e=t.floatToByte(s.green),o=t.floatToByte(s.blue),v=f*ht+e*st+o,l;f=t.floatToByte(c.red);e=t.floatToByte(c.green);o=t.floatToByte(c.blue);l=f*ht+e*st+o;f=t.floatToByte(h.red);e=t.floatToByte(h.green);o=t.floatToByte(h.blue);var y=f*ht+e*st+o,p=t.floatToByte(s.alpha)*ht+t.floatToByte(c.alpha)*st+t.floatToByte(h.alpha),w=r[et.compressedAttribute0];w(a,v,l,y,p)}function ti(n,t,i,r){var p=r._index,c=0,f=1,l=1,e=1,o=r.translucencyByDistance,s,a,v,y;u(o)&&(c=o.near,f=o.nearValue,l=o.far,e=o.farValue,(f!==1||e!==1)&&(n._shaderTranslucencyByDistance=!0));s=r.show&&r.clusterShow;r.color.alpha===0&&r.outlineColor.alpha===0&&(s=!1);f=h.clamp(f,0,1);f=f===1?255:f*255|0;a=(s?1:0)*st+f;e=h.clamp(e,0,1);e=e===1?255:e*255|0;v=e;y=i[et.compressedAttribute1];y(p,a,v,c,l)}function ii(n,t,i,r){var c=r._index,l=i[et.scaleByDistance],s=0,e=1,h=1,o=1,f=r.scaleByDistance;u(f)&&(s=f.near,e=f.nearValue,h=f.far,o=f.farValue,(e!==1||o!==1)&&(n._shaderScaleByDistance=!0));l(c,s,e,h,o)}function ri(n,t,i,r){var h=r._index,c=i[et.distanceDisplayConditionAndDisableDepth],e=0,o=Number.MAX_VALUE,s=r.distanceDisplayCondition,f;u(s)&&(e=s.near,o=s.far,e*=e,o*=o,n._shaderDistanceDisplayCondition=!0);f=r.disableDepthTestDistance;f*=f;f>0&&(n._shaderDisableDepthDistance=!0,f===Number.POSITIVE_INFINITY&&(f=-1));c(h,e,o,f)}function li(n,t,i,r){gt(n,t,i,r);ni(n,t,i,r);ti(n,t,i,r);ii(n,t,i,r);ri(n,t,i,r)}function yt(t,i,r,f,e,o){var s,l,h;for(f.mode===ft.SCENE3D?(s=t._baseVolume,t._boundingVolumeDirty=!0):s=t._baseVolume2D,l=[],h=0;h<r;++h){var a=i[h],v=a.position,c=ut._computeActualPosition(v,f,e);u(c)&&(a._setActualPosition(c),o?l.push(c):n.expand(s,c,s))}o&&n.fromPoints(l,s)}function ai(n,t){var i=t.mode,u=n._pointPrimitives,f=n._pointPrimitivesToUpdate,r=n._modelMatrix;n._createVertexArray||n._mode!==i||i!==ft.SCENE3D&&!c.equals(r,n.modelMatrix)?(n._mode=i,c.clone(n.modelMatrix,r),n._createVertexArray=!0,(i===ft.SCENE3D||i===ft.SCENE2D||i===ft.COLUMBUS_VIEW)&&yt(n,u,u.length,t,r,!0)):i===ft.MORPHING?yt(n,u,u.length,t,r,!0):(i===ft.SCENE2D||i===ft.COLUMBUS_VIEW)&&yt(n,f,n._pointPrimitivesToUpdateIndex,t,r,!1)}function vi(n,t,i){var r=t.camera.getPixelSize(i,t.context.drawingBufferWidth,t.context.drawingBufferHeight),u=r*n._maxPixelSize;i.radius+=u}var fi=ut.SHOW_INDEX,lt=ut.POSITION_INDEX,pt=ut.COLOR_INDEX,ei=ut.OUTLINE_COLOR_INDEX,oi=ut.OUTLINE_WIDTH_INDEX,si=ut.PIXEL_SIZE_INDEX,wt=ut.SCALE_BY_DISTANCE_INDEX,bt=ut.TRANSLUCENCY_BY_DISTANCE_INDEX,kt=ut.DISTANCE_DISPLAY_CONDITION_INDEX,hi=ut.DISABLE_DEPTH_DISTANCE_INDEX,at=ut.NUMBER_OF_PROPERTIES,et={positionHighAndSize:0,positionLowAndOutline:1,compressedAttribute0:2,compressedAttribute1:3,scaleByDistance:4,distanceDisplayConditionAndDisableDepth:5},ct,ht,st,ui;return f(ot.prototype,{length:{get:function(){return vt(this),this._pointPrimitives.length}}}),ot.prototype.add=function(n){var t=new ut(n,this);return t._index=this._pointPrimitives.length,this._pointPrimitives.push(t),this._createVertexArray=!0,t},ot.prototype.remove=function(n){return this.contains(n)?(this._pointPrimitives[n._index]=null,this._pointPrimitivesRemoved=!0,this._createVertexArray=!0,n._destroy(),!0):!1},ot.prototype.removeAll=function(){dt(this._pointPrimitives);this._pointPrimitives=[];this._pointPrimitivesToUpdate=[];this._pointPrimitivesToUpdateIndex=0;this._pointPrimitivesRemoved=!1;this._createVertexArray=!0},ot.prototype._updatePointPrimitive=function(n,t){n._dirty||(this._pointPrimitivesToUpdate[this._pointPrimitivesToUpdateIndex++]=n);++this._propertiesChanged[t]},ot.prototype.contains=function(n){return u(n)&&n._pointPrimitiveCollection===this},ot.prototype.get=function(n){if(!u(n))throw new o("index is required.");return vt(this),this._pointPrimitives[n]},ot.prototype.computeNewBuffersUsage=function(){for(var i,r=this._buffersUsage,t=!1,u=this._propertiesChanged,n=0;n<at;++n)i=u[n]===0?v.STATIC_DRAW:v.STREAM_DRAW,t=t||r[n]!==i,r[n]=i;return t},ct=new s,ht=65536,st=256,ui=[],ot.prototype.update=function(t){var ot,st,gi,f,nr,ht,tr,ct,yt,dt,yi,pi,ir,rr,e,s,ur,wi,i,h,sr,hr,ki,cr;vt(this);this._maxTotalPointSize=y.maximumAliasedPointSize;ai(this,t);var lr=this._pointPrimitives,v=lr.length,di=this._pointPrimitivesToUpdate,g=this._pointPrimitivesToUpdateIndex,r=this._propertiesChanged,ar=this._createVertexArray,ut,o=t.context,er=t.passes,or=er.pick;if(ar||!or&&this.computeNewBuffersUsage()){for(this._createVertexArray=!1,ot=0;ot<at;++ot)r[ot]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),v>0){for(this._vaf=ci(o,v,this._buffersUsage),ut=this._vaf.writers,st=0;st<v;++st)gi=this._pointPrimitives[st],gi._dirty=!1,li(this,o,ut,gi);this._vaf.commit()}this._pointPrimitivesToUpdateIndex=0}else if(g>0){if(f=ui,f.length=0,(r[lt]||r[oi]||r[si])&&f.push(gt),(r[pt]||r[ei])&&f.push(ni),(r[fi]||r[bt])&&f.push(ti),r[wt]&&f.push(ii),(r[kt]||r[hi])&&f.push(ri),nr=f.length,ut=this._vaf.writers,g/v>.1){for(ht=0;ht<g;++ht)for(tr=di[ht],tr._dirty=!1,ct=0;ct<nr;++ct)f[ct](this,o,ut,tr);this._vaf.commit()}else{for(yt=0;yt<g;++yt){for(dt=di[yt],dt._dirty=!1,yi=0;yi<nr;++yi)f[yi](this,o,ut,dt);this._vaf.subCommit(dt._index,1)}this._vaf.endSubCommits()}this._pointPrimitivesToUpdateIndex=0}if((g>v*1.5&&(di.length=v),u(this._vaf)&&u(this._vaf.va))&&(this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,n.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC)),ir=c.IDENTITY,t.mode===ft.SCENE3D?(ir=this.modelMatrix,pi=n.clone(this._baseVolumeWC,this._boundingVolume)):pi=n.clone(this._baseVolume2D,this._boundingVolume),vi(this,t,pi),rr=this._blendOption!==this.blendOption,this._blendOption=this.blendOption,rr&&(this._rsOpaque=this._blendOption===rt.OPAQUE||this._blendOption===rt.OPAQUE_AND_TRANSLUCENT?b.fromCache({depthTest:{enabled:!0,func:a.LEQUAL},depthMask:!0}):undefined,this._rsTranslucent=this._blendOption===rt.TRANSLUCENT||this._blendOption===rt.OPAQUE_AND_TRANSLUCENT?b.fromCache({depthTest:{enabled:!0,func:a.LEQUAL},depthMask:!1,blending:it.ALPHA_BLEND}):undefined),this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||t.minimumDisableDepthTestDistance!==0,(rr||this._shaderScaleByDistance&&!this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance&&!this._compiledShaderTranslucencyByDistance||this._shaderDistanceDisplayCondition&&!this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance)&&(e=new d({sources:[tt]}),this._shaderScaleByDistance&&e.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&e.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderDistanceDisplayCondition&&e.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&e.defines.push("DISABLE_DEPTH_DISTANCE"),this._blendOption===rt.OPAQUE_AND_TRANSLUCENT&&(s=new d({defines:["OPAQUE"],sources:[nt]}),this._sp=k.replaceCache({context:o,shaderProgram:this._sp,vertexShaderSource:e,fragmentShaderSource:s,attributeLocations:et}),s=new d({defines:["TRANSLUCENT"],sources:[nt]}),this._spTranslucent=k.replaceCache({context:o,shaderProgram:this._spTranslucent,vertexShaderSource:e,fragmentShaderSource:s,attributeLocations:et})),this._blendOption===rt.OPAQUE&&(s=new d({sources:[nt]}),this._sp=k.replaceCache({context:o,shaderProgram:this._sp,vertexShaderSource:e,fragmentShaderSource:s,attributeLocations:et})),this._blendOption===rt.TRANSLUCENT&&(s=new d({sources:[nt]}),this._spTranslucent=k.replaceCache({context:o,shaderProgram:this._spTranslucent,vertexShaderSource:e,fragmentShaderSource:s,attributeLocations:et})),this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance),sr=t.commandList,er.render||or)){var fr=this._colorCommands,vr=this._blendOption===rt.OPAQUE,bi=this._blendOption===rt.OPAQUE_AND_TRANSLUCENT;for(ur=this._vaf.va,wi=ur.length,fr.length=wi,hr=bi?wi*2:wi,h=0;h<hr;++h)ki=vr||bi&&h%2==0,i=fr[h],u(i)||(i=fr[h]=new p),i.primitiveType=l.POINTS,i.pass=ki||!bi?w.OPAQUE:w.TRANSLUCENT,i.owner=this,cr=bi?Math.floor(h/2):h,i.boundingVolume=pi,i.modelMatrix=ir,i.shaderProgram=ki?this._sp:this._spTranslucent,i.uniformMap=this._uniforms,i.vertexArray=ur[cr].va,i.renderState=ki?this._rsOpaque:this._rsTranslucent,i.debugShowBoundingVolume=this.debugShowBoundingVolume,i.pickId="v_pickColor",sr.push(i)}},ot.prototype.isDestroyed=function(){return!1},ot.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),dt(this._pointPrimitives),e(this)},ot});t("ThirdParty/kdbush",[],function(){"use strict";function e(n,t,i,u,f){return new r(n,t,i,u,f)}function r(n,i,r,u,f){i=i||o;r=r||s;f=f||Array;this.nodeSize=u||64;this.points=n;this.ids=new f(n.length);this.coords=new f(n.length*2);for(var e=0;e<n.length;e++)this.ids[e]=e,this.coords[2*e]=i(n[e]),this.coords[2*e+1]=r(n[e]);t(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function o(n){return n[0]}function s(n){return n[1]}function h(n,t,i,r,u,f,e){for(var o=[0,n.length-1,0],y=[],s,h,c,l,w;o.length;){var p=o.pop(),a=o.pop(),v=o.pop();if(a-v<=e){for(c=v;c<=a;c++)s=t[2*c],h=t[2*c+1],s>=i&&s<=u&&h>=r&&h<=f&&y.push(n[c]);continue}l=Math.floor((v+a)/2);s=t[2*l];h=t[2*l+1];s>=i&&s<=u&&h>=r&&h<=f&&y.push(n[l]);w=(p+1)%2;(p===0?i<=s:r<=h)&&(o.push(v),o.push(l-1),o.push(w));(p===0?u>=s:f>=h)&&(o.push(l+1),o.push(a),o.push(w))}return y}function t(n,i,r,f,e,o){if(!(e-f<=r)){var s=Math.floor((f+e)/2);u(n,i,s,f,e,o%2);t(n,i,r,f,s-1,o+1);t(n,i,r,s+1,e,o+1)}}function u(t,i,r,f,e,o){while(e>f){if(e-f>600){var h=e-f+1,v=r-f+1,y=Math.log(h),l=.5*Math.exp(2*y/3),p=.5*Math.sqrt(y*l*(h-l)/h)*(v-h/2<0?-1:1),w=Math.max(f,Math.floor(r-v*l/h+p)),b=Math.min(e,Math.floor(r+(h-v)*l/h+p));u(t,i,r,w,b,o)}var a=i[2*r+o],c=f,s=e;for(n(t,i,f,r),i[2*e+o]>a&&n(t,i,f,e);c<s;){for(n(t,i,c,s),c++,s--;i[2*c+o]<a;)c++;while(i[2*s+o]>a)s--}i[2*f+o]===a?n(t,i,f,s):(s++,n(t,i,s,e));s<=r&&(f=s+1);r<=s&&(e=s-1)}}function n(n,t,r,u){i(n,r,u);i(t,2*r,2*u);i(t,2*r+1,2*u+1)}function i(n,t,i){var r=n[t];n[t]=n[i];n[i]=r}function c(n,t,i,r,u,e){for(var o=[0,n.length-1,0],a=[],b=u*u,s,w;o.length;){var v=o.pop(),c=o.pop(),l=o.pop();if(c-l<=e){for(s=l;s<=c;s++)f(t[2*s],t[2*s+1],i,r)<=b&&a.push(n[s]);continue}var h=Math.floor((l+c)/2),y=t[2*h],p=t[2*h+1];f(y,p,i,r)<=b&&a.push(n[h]);w=(v+1)%2;(v===0?i-u<=y:r-u<=p)&&(o.push(l),o.push(h-1),o.push(w));(v===0?i+u>=y:r+u>=p)&&(o.push(h+1),o.push(c),o.push(w))}return a}function f(n,t,i,r){var u=n-i,f=t-r;return u*u+f*f}return r.prototype={range:function(n,t,i,r){return h(this.ids,this.coords,n,t,i,r,this.nodeSize)},within:function(n,t,i){return c(this.ids,this.coords,n,t,i,this.nodeSize)}},e});t("DataSources/EntityCluster",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/EllipsoidalOccluder","../Core/Event","../Core/Matrix4","../Scene/Billboard","../Scene/BillboardCollection","../Scene/Label","../Scene/LabelCollection","../Scene/PointPrimitive","../Scene/PointPrimitiveCollection","../Scene/SceneMode","../ThirdParty/kdbush"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(n){n=r(n,r.EMPTY_OBJECT);this._enabled=r(n.enabled,!1);this._pixelRange=r(n.pixelRange,80);this._minimumClusterSize=r(n.minimumClusterSize,2);this._clusterBillboards=r(n.clusterBillboards,!0);this._clusterLabels=r(n.clusterLabels,!0);this._clusterPoints=r(n.clusterPoints,!0);this._labelCollection=undefined;this._billboardCollection=undefined;this._pointCollection=undefined;this._clusterBillboardCollection=undefined;this._clusterLabelCollection=undefined;this._clusterPointCollection=undefined;this._collectionIndicesByEntity={};this._unusedLabelIndices=[];this._unusedBillboardIndices=[];this._unusedPointIndices=[];this._previousClusters=[];this._previousHeight=undefined;this._enabledDirty=!1;this._clusterDirty=!1;this._cluster=undefined;this._removeEventListener=undefined;this._clusterEvent=new o}function ft(n){return n.coord.x}function et(n){return n.coord.y}function tt(n,t){n.x-=t;n.y-=t;n.width+=t*2;n.height+=t*2}function it(t,i,r,f,e){if(u(t._labelCollection)&&f._clusterLabels?e=l.getScreenSpaceBoundingBox(t,i,e):u(t._billboardCollection)&&f._clusterBillboards?e=h.getScreenSpaceBoundingBox(t,i,e):u(t._pointPrimitiveCollection)&&f._clusterPoints&&(e=v.getScreenSpaceBoundingBox(t,i,e)),tt(e,r),f._clusterLabels&&!u(t._labelCollection)&&u(t.id)&&ut(f,t.id)&&u(t.id._label)){var s=f._collectionIndicesByEntity[t.id],c=f._labelCollection.get(s),o=l.getScreenSpaceBoundingBox(c,i,ot);tt(o,r);e=n.union(e,o,e)}return e}function st(n,t){if(n.clusterShow=!0,!u(n._labelCollection)&&u(n.id)&&ut(t,n.id)&&u(n.id._label)){var i=t._collectionIndicesByEntity[n.id],r=t._labelCollection.get(i);r.clusterShow=!0}}function rt(n,t,i,r){var u={billboard:r._clusterBillboardCollection.add(),label:r._clusterLabelCollection.add(),point:r._clusterPointCollection.add()};u.billboard.show=!1;u.point.show=!1;u.label.show=!0;u.label.text=t.toLocaleString();u.label.id=i;u.billboard.position=u.label.position=u.point.position=n;r._clusterEvent.raiseEvent(i,u)}function ut(n,t){return u(n)&&u(n._collectionIndicesByEntity[t])&&u(n._collectionIndicesByEntity[t].labelIndex)}function k(n,t,i,r,f){var h,o,e,s;if(u(n))for(h=n.length,o=0;o<h;++o)if(e=n.get(o),e.clusterShow=!1,e.show&&(f._scene.mode!==p.SCENE3D||r.isPointVisible(e.position))){var c=f._clusterLabels&&u(e._labelCollection),l=f._clusterBillboards&&u(e.id._billboard),a=f._clusterPoints&&u(e.id._point);c&&(a||l)||(s=e.computeScreenSpacePosition(i),u(s))&&t.push({index:o,collection:n,clustered:!1,coord:s})}}function at(r){return function(f){var nt,o,ni,p,tt,ut,ti,d,ot,g,ii,ri,hi,l,at,vt,bt,kt,dt,ei,di,ci;if((!u(f)||!(f<.05))&&r.enabled){var b=r._scene,li=r._labelCollection,ai=r._billboardCollection,vi=r._pointCollection;if((u(li)||u(ai)||u(vi))&&(r._clusterBillboards||r._clusterLabels||r._clusterPoints)){var yt=r._clusterLabelCollection,pt=r._clusterBillboardCollection,wt=r._clusterPointCollection;u(yt)?yt.removeAll():yt=r._clusterLabelCollection=new a({scene:b});u(pt)?pt.removeAll():pt=r._clusterBillboardCollection=new c({scene:b});u(wt)?wt.removeAll():wt=r._clusterPointCollection=new y;var yi=r._pixelRange,pi=r._minimumClusterSize,wi=r._previousClusters,oi=[],bi=r._previousHeight,si=b.camera.positionCartographic.height,gi=b.mapProjection.ellipsoid,nr=b.camera.positionWC,gt=new e(gi,nr),v=[];if(r._clusterLabels&&k(li,v,b,gt,r),r._clusterBillboards&&k(ai,v,b,gt,r),r._clusterPoints&&k(vi,v,b,gt,r),hi=w(v,ft,et,64,Int32Array),si<bi)for(ni=wi.length,nt=0;nt<ni;++nt)if((l=wi[nt],gt.isPointVisible(l.position))&&(at=h._computeScreenSpacePosition(s.IDENTITY,l.position,i.ZERO,t.ZERO,b),u(at))){var ki=1-si/bi,ui=l.width=l.width*ki,fi=l.height=l.height*ki;ui=Math.max(ui,l.minimumWidth);fi=Math.max(fi,l.minimumHeight);var tr=at.x-ui*.5,ir=at.y-fi*.5,rr=at.x+ui,ur=at.y+fi;for(tt=hi.range(tr,ir,rr,ur),ut=tt.length,g=0,ot=[],o=0;o<ut;++o)ti=tt[o],d=v[ti],d.clustered||(++g,ii=d.collection,ri=d.index,ot.push(ii.get(ri).id));if(g>=pi)for(rt(l.position,g,ot,r),oi.push(l),o=0;o<ut;++o)v[tt[o]].clustered=!0}for(ni=v.length,nt=0;nt<ni;++nt)if(vt=v[nt],!vt.clustered){for(vt.clustered=!0,ii=vt.collection,ri=vt.index,bt=ii.get(ri),p=it(bt,vt.coord,yi,r,ht),kt=n.clone(p,ct),tt=hi.range(p.x,p.y,p.x+p.width,p.y+p.height),ut=tt.length,dt=i.clone(bt.position),g=1,ot=[bt.id],o=0;o<ut;++o)ti=tt[o],d=v[ti],d.clustered||(ei=d.collection.get(d.index),di=it(ei,d.coord,yi,r,lt),i.add(ei.position,dt,dt),n.union(kt,di,kt),++g,ot.push(ei.id));if(g>=pi)for(ci=i.multiplyByScalar(dt,1/g,dt),rt(ci,g,ot,r),oi.push({position:ci,width:kt.width,height:kt.height,minimumWidth:p.width,minimumHeight:p.height}),o=0;o<ut;++o)v[tt[o]].clustered=!0;else st(bt,r)}yt.length===0&&(yt.destroy(),r._clusterLabelCollection=undefined);pt.length===0&&(pt.destroy(),r._clusterBillboardCollection=undefined);wt.length===0&&(wt.destroy(),r._clusterPointCollection=undefined);r._previousClusters=oi;r._previousHeight=si}}}}function d(n,t,i,r){return function(f){var e=this[n],o,s,h,c;return(u(this._collectionIndicesByEntity)||(this._collectionIndicesByEntity={}),o=this._collectionIndicesByEntity[f.id],u(o)||(o=this._collectionIndicesByEntity[f.id]={billboardIndex:undefined,labelIndex:undefined,pointIndex:undefined}),u(e)&&u(o[r]))?e.get(o[r]):(u(e)||(e=this[n]=new t({scene:this._scene})),c=this[i],c.length>0?(s=c.pop(),h=e.get(s)):(h=e.add(),s=e.length-1),o[r]=s,this._clusterDirty=!0,h)}}function g(n,t){var i=n._collectionIndicesByEntity[t];u(i.billboardIndex)||u(i.labelIndex)||u(i.pointIndex)||delete n._collectionIndicesByEntity[t]}function nt(n){var i,t;if(u(n))for(i=n.length,t=0;t<i;++t)n.get(t).clusterShow=!0}function vt(n){n.enabled||(u(n._clusterLabelCollection)&&n._clusterLabelCollection.destroy(),u(n._clusterBillboardCollection)&&n._clusterBillboardCollection.destroy(),u(n._clusterPointCollection)&&n._clusterPointCollection.destroy(),n._clusterLabelCollection=undefined,n._clusterBillboardCollection=undefined,n._clusterPointCollection=undefined,nt(n._labelCollection),nt(n._billboardCollection),nt(n._pointCollection))}var ot=new n,ht=new n,ct=new n,lt=new n;return b.prototype._initialize=function(n){this._scene=n;var t=at(this);this._cluster=t;this._removeEventListener=n.camera.changed.addEventListener(t)},f(b.prototype,{enabled:{get:function(){return this._enabled},set:function(n){this._enabledDirty=n!==this._enabled;this._enabled=n}},pixelRange:{get:function(){return this._pixelRange},set:function(n){this._clusterDirty=this._clusterDirty||n!==this._pixelRange;this._pixelRange=n}},minimumClusterSize:{get:function(){return this._minimumClusterSize},set:function(n){this._clusterDirty=this._clusterDirty||n!==this._minimumClusterSize;this._minimumClusterSize=n}},clusterEvent:{get:function(){return this._clusterEvent}},clusterBillboards:{get:function(){return this._clusterBillboards},set:function(n){this._clusterDirty=this._clusterDirty||n!==this._clusterBillboards;this._clusterBillboards=n}},clusterLabels:{get:function(){return this._clusterLabels},set:function(n){this._clusterDirty=this._clusterDirty||n!==this._clusterLabels;this._clusterLabels=n}},clusterPoints:{get:function(){return this._clusterPoints},set:function(n){this._clusterDirty=this._clusterDirty||n!==this._clusterPoints;this._clusterPoints=n}}}),b.prototype.getLabel=d("_labelCollection",a,"_unusedLabelIndices","labelIndex"),b.prototype.removeLabel=function(n){var t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[n.id],r,i;u(this._labelCollection)&&u(t)&&u(t.labelIndex)&&(r=t.labelIndex,t.labelIndex=undefined,g(this,n.id),i=this._labelCollection.get(r),i.show=!1,i.text="",i.id=undefined,this._unusedLabelIndices.push(r),this._clusterDirty=!0)},b.prototype.getBillboard=d("_billboardCollection",c,"_unusedBillboardIndices","billboardIndex"),b.prototype.removeBillboard=function(n){var t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[n.id],r,i;u(this._billboardCollection)&&u(t)&&u(t.billboardIndex)&&(r=t.billboardIndex,t.billboardIndex=undefined,g(this,n.id),i=this._billboardCollection.get(r),i.id=undefined,i.show=!1,i.image=undefined,this._unusedBillboardIndices.push(r),this._clusterDirty=!0)},b.prototype.getPoint=d("_pointCollection",y,"_unusedPointIndices","pointIndex"),b.prototype.removePoint=function(n){var t=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[n.id],i,r;u(this._pointCollection)&&u(t)&&u(t.pointIndex)&&(i=t.pointIndex,t.pointIndex=undefined,g(this,n.id),r=this._pointCollection.get(i),r.show=!1,r.id=undefined,this._unusedPointIndices.push(i),this._clusterDirty=!0)},b.prototype.update=function(n){var t;u(this._labelCollection)&&this._labelCollection.length>0&&this._labelCollection.get(0)._glyphs.length===0&&(t=n.commandList,n.commandList=[],this._labelCollection.update(n),n.commandList=t);u(this._billboardCollection)&&this._billboardCollection.length>0&&!u(this._billboardCollection.get(0).width)&&(t=n.commandList,n.commandList=[],this._billboardCollection.update(n),n.commandList=t);this._enabledDirty&&(this._enabledDirty=!1,vt(this),this._clusterDirty=!0);this._clusterDirty&&(this._clusterDirty=!1,this._cluster());u(this._clusterLabelCollection)&&this._clusterLabelCollection.update(n);u(this._clusterBillboardCollection)&&this._clusterBillboardCollection.update(n);u(this._clusterPointCollection)&&this._clusterPointCollection.update(n);u(this._labelCollection)&&this._labelCollection.update(n);u(this._billboardCollection)&&this._billboardCollection.update(n);u(this._pointCollection)&&this._pointCollection.update(n)},b.prototype.destroy=function(){return this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._pointCollection=this._pointCollection&&this._pointCollection.destroy(),this._clusterLabelCollection=this._clusterLabelCollection&&this._clusterLabelCollection.destroy(),this._clusterBillboardCollection=this._clusterBillboardCollection&&this._clusterBillboardCollection.destroy(),this._clusterPointCollection=this._clusterPointCollection&&this._clusterPointCollection.destroy(),u(this._removeEventListener)&&(this._removeEventListener(),this._removeEventListener=undefined),this._labelCollection=undefined,this._billboardCollection=undefined,this._pointCollection=undefined,this._clusterBillboardCollection=undefined,this._clusterLabelCollection=undefined,this._clusterPointCollection=undefined,this._collectionIndicesByEntity=undefined,this._unusedLabelIndices=[],this._unusedBillboardIndices=[],this._unusedPointIndices=[],this._previousClusters=[],this._previousHeight=undefined,this._enabledDirty=!1,this._pixelRangeDirty=!1,this._minimumClusterSizeDirty=!1,undefined},b});t("DataSources/CustomDataSource",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","./DataSource","./EntityCluster","./EntityCollection"],function(n,t,i,r,u,f,e){"use strict";function o(n){this._name=n;this._clock=undefined;this._changed=new r;this._error=new r;this._isLoading=!1;this._loading=new r;this._entityCollection=new e(this);this._entityCluster=new f}return t(o.prototype,{name:{get:function(){return this._name},set:function(n){this._name!==n&&(this._name=n,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock},set:function(n){this._clock!==n&&(this._clock=n,this._changed.raiseEvent(this))}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading},set:function(n){u.setLoading(this,n)}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(n){this._entityCollection.show=n}},clustering:{get:function(){return this._entityCluster},set:function(t){if(!n(t))throw new i("value must be defined.");this._entityCluster=t}}}),o});t("DataSources/CylinderGeometryUpdater",["../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/CylinderGeometry","../Core/CylinderOutlineGeometry","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./heightReferenceOnEntityPropertyChanged","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function st(n){this.id=n;this.vertexFormat=undefined;this.length=undefined;this.topRadius=undefined;this.bottomRadius=undefined;this.slices=undefined;this.numberOfVerticalLines=undefined;this.offsetAttribute=undefined}function it(n,t){nt.call(this,{entity:n,scene:t,geometryOptions:new st(n),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]});this._onEntityPropertyChanged(n,"cylinder",n.cylinder,undefined)}function rt(n,t,i){g.call(this,n,t,i)}var ut=n.ZERO,ft=new n,ot=new n,et=new i;return e(Object.create)&&(it.prototype=Object.create(nt.prototype),it.prototype.constructor=it),o(it.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),it.prototype.createFillGeometryInstance=function(n){var o;if(t.defined("time",n),!this._fillEnabled)throw new s("This instance does not represent a filled geometry.");var f=this._entity,a=f.isAvailable(n),p=new y(a&&f.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),w=this._distanceDisplayConditionProperty.getValue(n),b=h.fromDistanceDisplayCondition(w),l={show:p,distanceDisplayCondition:b,color:undefined,offset:undefined};return this._materialProperty instanceof d&&(e(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(o=this._materialProperty.color.getValue(n,et)),e(o)||(o=i.WHITE),l.color=r.fromColor(o)),e(this._options.offsetAttribute)&&(l.offset=v.fromCartesian3(tt.getValueOrDefault(this._terrainOffsetProperty,n,ut,ft))),new c({id:f,geometry:new u(this._options),modelMatrix:f.computeModelMatrixForHeightReference(n,f.cylinder.heightReference,this._options.length*.5,this._scene.mapProjection.ellipsoid),attributes:l})},it.prototype.createOutlineGeometryInstance=function(n){if(t.defined("time",n),!this._outlineEnabled)throw new s("This instance does not represent an outlined geometry.");var u=this._entity,l=u.isAvailable(n),a=tt.getValueOrDefault(this._outlineColorProperty,n,i.BLACK,et),p=this._distanceDisplayConditionProperty.getValue(n),o={show:new y(l&&u.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:r.fromColor(a),distanceDisplayCondition:h.fromDistanceDisplayCondition(p),offset:undefined};return e(this._options.offsetAttribute)&&(o.offset=v.fromCartesian3(tt.getValueOrDefault(this._terrainOffsetProperty,n,ut,ft))),new c({id:u,geometry:new f(this._options),modelMatrix:u.computeModelMatrixForHeightReference(n,u.cylinder.heightReference,this._options.length*.5,this._scene.mapProjection.ellipsoid),attributes:o})},it.prototype._computeCenter=function(n,t){return tt.getValueOrUndefined(this._entity.position,n,t)},it.prototype._isHidden=function(n,t){return!e(n.position)||!e(t.length)||!e(t.topRadius)||!e(t.bottomRadius)||nt.prototype._isHidden.call(this,n,t)},it.prototype._isDynamic=function(n,t){return!n.position.isConstant||!tt.isConstant(n.orientation)||!t.length.isConstant||!t.topRadius.isConstant||!t.bottomRadius.isConstant||!tt.isConstant(t.slices)||!tt.isConstant(t.outlineWidth)||!tt.isConstant(t.numberOfVerticalLines)},it.prototype._setStaticOptions=function(n,t){var r=tt.getValueOrDefault(t.heightReference,a.MINIMUM_VALUE,p.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof d?b.VERTEX_FORMAT:w.MaterialSupport.TEXTURED.vertexFormat;i.length=t.length.getValue(a.MINIMUM_VALUE);i.topRadius=t.topRadius.getValue(a.MINIMUM_VALUE);i.bottomRadius=t.bottomRadius.getValue(a.MINIMUM_VALUE);i.slices=tt.getValueOrUndefined(t.slices,a.MINIMUM_VALUE);i.numberOfVerticalLines=tt.getValueOrUndefined(t.numberOfVerticalLines,a.MINIMUM_VALUE);i.offsetAttribute=r!==p.NONE?l.ALL:undefined},it.prototype._onEntityPropertyChanged=k,it.DynamicGeometryUpdater=rt,e(Object.create)&&(rt.prototype=Object.create(g.prototype),rt.prototype.constructor=rt),rt.prototype._isHidden=function(n,t,i){var r=this._options,u=tt.getValueOrUndefined(n.position,i,ot);return!e(u)||!e(r.length)||!e(r.topRadius)||!e(r.bottomRadius)||g.prototype._isHidden.call(this,n,t,i)},rt.prototype._setOptions=function(n,t,i){var u=tt.getValueOrDefault(t.heightReference,i,p.NONE),r=this._options;r.length=tt.getValueOrUndefined(t.length,i);r.topRadius=tt.getValueOrUndefined(t.topRadius,i);r.bottomRadius=tt.getValueOrUndefined(t.bottomRadius,i);r.slices=tt.getValueOrUndefined(t.slices,i);r.numberOfVerticalLines=tt.getValueOrUndefined(t.numberOfVerticalLines,i);r.offsetAttribute=u!==p.NONE?l.ALL:undefined},it});t("Scene/ColorBlendMode",["../Core/freezeObject","../Core/Math"],function(n,t){"use strict";var i={HIGHLIGHT:0,REPLACE:1,MIX:2};return i.getColorBlend=function(n,r){return n===i.HIGHLIGHT?0:n===i.REPLACE?1:n===i.MIX?t.clamp(r,t.EPSILON4,1):void 0},n(i)});t("DataSources/DataSourceClock",["../Core/Clock","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/JulianDate","./createRawPropertyDescriptor"],function(n,t,i,r,u,f,e,o){"use strict";function s(){this._startTime=undefined;this._stopTime=undefined;this._currentTime=undefined;this._clockRange=undefined;this._clockStep=undefined;this._multiplier=undefined;this._definitionChanged=new f}return r(s.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},startTime:o("startTime"),stopTime:o("stopTime"),currentTime:o("currentTime"),clockRange:o("clockRange"),clockStep:o("clockStep"),multiplier:o("multiplier")}),s.prototype.clone=function(n){return i(n)||(n=new s),n.startTime=this.startTime,n.stopTime=this.stopTime,n.currentTime=this.currentTime,n.clockRange=this.clockRange,n.clockStep=this.clockStep,n.multiplier=this.multiplier,n},s.prototype.equals=function(n){return this===n||i(n)&&e.equals(this.startTime,n.startTime)&&e.equals(this.stopTime,n.stopTime)&&e.equals(this.currentTime,n.currentTime)&&this.clockRange===n.clockRange&&this.clockStep===n.clockStep&&this.multiplier===n.multiplier},s.prototype.merge=function(n){if(!i(n))throw new u("source is required.");this.startTime=t(this.startTime,n.startTime);this.stopTime=t(this.stopTime,n.stopTime);this.currentTime=t(this.currentTime,n.currentTime);this.clockRange=t(this.clockRange,n.clockRange);this.clockStep=t(this.clockStep,n.clockStep);this.multiplier=t(this.multiplier,n.multiplier)},s.prototype.getValue=function(r){return i(r)||(r=new n),r.startTime=t(this.startTime,r.startTime),r.stopTime=t(this.stopTime,r.stopTime),r.currentTime=t(this.currentTime,r.currentTime),r.clockRange=t(this.clockRange,r.clockRange),r.multiplier=t(this.multiplier,r.multiplier),r.clockStep=t(this.clockStep,r.clockStep),r},s});t("DataSources/GridMaterialProperty",["../Core/Cartesian2","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){n=i(n,i.EMPTY_OBJECT);this._definitionChanged=new f;this._color=undefined;this._colorSubscription=undefined;this._cellAlpha=undefined;this._cellAlphaSubscription=undefined;this._lineCount=undefined;this._lineCountSubscription=undefined;this._lineThickness=undefined;this._lineThicknessSubscription=undefined;this._lineOffset=undefined;this._lineOffsetSubscription=undefined;this.color=n.color;this.cellAlpha=n.cellAlpha;this.lineCount=n.lineCount;this.lineThickness=n.lineThickness;this.lineOffset=n.lineOffset}var h=t.WHITE,c=.1,l=new n(8,8),a=new n(0,0),v=new n(1,1);return u(s.prototype,{isConstant:{get:function(){return o.isConstant(this._color)&&o.isConstant(this._cellAlpha)&&o.isConstant(this._lineCount)&&o.isConstant(this._lineThickness)&&o.isConstant(this._lineOffset)}},definitionChanged:{get:function(){return this._definitionChanged}},color:e("color"),cellAlpha:e("cellAlpha"),lineCount:e("lineCount"),lineThickness:e("lineThickness"),lineOffset:e("lineOffset")}),s.prototype.getType=function(){return"Grid"},s.prototype.getValue=function(n,t){return r(t)||(t={}),t.color=o.getValueOrClonedDefault(this._color,n,h,t.color),t.cellAlpha=o.getValueOrDefault(this._cellAlpha,n,c),t.lineCount=o.getValueOrClonedDefault(this._lineCount,n,l,t.lineCount),t.lineThickness=o.getValueOrClonedDefault(this._lineThickness,n,v,t.lineThickness),t.lineOffset=o.getValueOrClonedDefault(this._lineOffset,n,a,t.lineOffset),t},s.prototype.equals=function(n){return this===n||n instanceof s&&o.equals(this._color,n._color)&&o.equals(this._cellAlpha,n._cellAlpha)&&o.equals(this._lineCount,n._lineCount)&&o.equals(this._lineThickness,n._lineThickness)&&o.equals(this._lineOffset,n._lineOffset)},s});t("DataSources/PolylineArrowMaterialProperty",["../Core/Color","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f){"use strict";function e(n){this._definitionChanged=new r;this._color=undefined;this._colorSubscription=undefined;this.color=n}return i(e.prototype,{isConstant:{get:function(){return f.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:u("color")}),e.prototype.getType=function(){return"PolylineArrow"},e.prototype.getValue=function(i,r){return t(r)||(r={}),r.color=f.getValueOrClonedDefault(this._color,i,n.WHITE,r.color),r},e.prototype.equals=function(n){return this===n||n instanceof e&&f.equals(this._color,n._color)},e});t("DataSources/PolylineDashMaterialProperty",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this._definitionChanged=new u;this._color=undefined;this._colorSubscription=undefined;this._gapColor=undefined;this._gapColorSubscription=undefined;this._dashLength=undefined;this._dashLengthSubscription=undefined;this._dashPattern=undefined;this._dashPatternSubscription=undefined;this.color=n.color;this.gapColor=n.gapColor;this.dashLength=n.dashLength;this.dashPattern=n.dashPattern}var s=n.WHITE,h=n.TRANSPARENT,c=16,l=255;return r(o.prototype,{isConstant:{get:function(){return e.isConstant(this._color)&&e.isConstant(this._gapColor)&&e.isConstant(this._dashLength)&&e.isConstant(this._dashPattern)}},definitionChanged:{get:function(){return this._definitionChanged}},color:f("color"),gapColor:f("gapColor"),dashLength:f("dashLength"),dashPattern:f("dashPattern")}),o.prototype.getType=function(){return"PolylineDash"},o.prototype.getValue=function(n,t){return i(t)||(t={}),t.color=e.getValueOrClonedDefault(this._color,n,s,t.color),t.gapColor=e.getValueOrClonedDefault(this._gapColor,n,h,t.gapColor),t.dashLength=e.getValueOrDefault(this._dashLength,n,c,t.dashLength),t.dashPattern=e.getValueOrDefault(this._dashPattern,n,l,t.dashPattern),t},o.prototype.equals=function(n){return this===n||n instanceof o&&e.equals(this._color,n._color)&&e.equals(this._gapColor,n._gapColor)&&e.equals(this._dashLength,n._dashLength)&&e.equals(this._dashPattern,n._dashPattern)},o});t("DataSources/PolylineGlowMaterialProperty",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this._definitionChanged=new u;this._color=undefined;this._colorSubscription=undefined;this._glowPower=undefined;this._glowPowerSubscription=undefined;this.color=n.color;this.glowPower=n.glowPower}var s=n.WHITE,h=.25;return r(o.prototype,{isConstant:{get:function(){return e.isConstant(this._color)&&e.isConstant(this._glow)}},definitionChanged:{get:function(){return this._definitionChanged}},color:f("color"),glowPower:f("glowPower")}),o.prototype.getType=function(){return"PolylineGlow"},o.prototype.getValue=function(n,t){return i(t)||(t={}),t.color=e.getValueOrClonedDefault(this._color,n,s,t.color),t.glowPower=e.getValueOrDefault(this._glowPower,n,h,t.glowPower),t},o.prototype.equals=function(n){return this===n||n instanceof o&&e.equals(this._color,n._color)&&e.equals(this._glowPower,n._glowPower)},o});t("DataSources/PolylineOutlineMaterialProperty",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this._definitionChanged=new u;this._color=undefined;this._colorSubscription=undefined;this._outlineColor=undefined;this._outlineColorSubscription=undefined;this._outlineWidth=undefined;this._outlineWidthSubscription=undefined;this.color=n.color;this.outlineColor=n.outlineColor;this.outlineWidth=n.outlineWidth}var s=n.WHITE,h=n.BLACK,c=1;return r(o.prototype,{isConstant:{get:function(){return e.isConstant(this._color)&&e.isConstant(this._outlineColor)&&e.isConstant(this._outlineWidth)}},definitionChanged:{get:function(){return this._definitionChanged}},color:f("color"),outlineColor:f("outlineColor"),outlineWidth:f("outlineWidth")}),o.prototype.getType=function(){return"PolylineOutline"},o.prototype.getValue=function(n,t){return i(t)||(t={}),t.color=e.getValueOrClonedDefault(this._color,n,s,t.color),t.outlineColor=e.getValueOrClonedDefault(this._outlineColor,n,h,t.outlineColor),t.outlineWidth=e.getValueOrDefault(this._outlineWidth,n,c),t},o.prototype.equals=function(n){return this===n||n instanceof o&&e.equals(this._color,n._color)&&e.equals(this._outlineColor,n._outlineColor)&&e.equals(this._outlineWidth,n._outlineWidth)},o});t("DataSources/PositionPropertyArray",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/EventHelper","../Core/ReferenceFrame","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function s(t,i){this._value=undefined;this._definitionChanged=new u;this._eventHelper=new f;this._referenceFrame=n(i,e.FIXED);this.setValue(t)}return i(s.prototype,{isConstant:{get:function(){var i=this._value,r,n;if(!t(i))return!0;for(r=i.length,n=0;n<r;n++)if(!o.isConstant(i[n]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}}),s.prototype.getValue=function(n,t){return this.getValueInReferenceFrame(n,e.FIXED,t)},s.prototype.getValueInReferenceFrame=function(n,i,u){var e,s,f,o,c,h;if(!t(n))throw new r("time is required.");if(!t(i))throw new r("referenceFrame is required.");if(e=this._value,!t(e))return undefined;for(s=e.length,t(u)||(u=new Array(s)),f=0,o=0;f<s;)c=e[f],h=c.getValueInReferenceFrame(n,i,u[f]),t(h)&&(u[o]=h,o++),f++;return u.length=o,u},s.prototype.setValue=function(n){var u=this._eventHelper,f,i,r;if(u.removeAll(),t(n))for(this._value=n.slice(),f=n.length,i=0;i<f;i++)r=n[i],t(r)&&u.add(r.definitionChanged,s.prototype._raiseDefinitionChanged,this);else this._value=undefined;this._definitionChanged.raiseEvent(this)},s.prototype.equals=function(n){return this===n||n instanceof s&&this._referenceFrame===n._referenceFrame&&o.arrayEquals(this._value,n._value)},s.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},s});t("DataSources/PropertyArray",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/EventHelper","./Property"],function(n,t,i,r,u,f){"use strict";function e(n){this._value=undefined;this._definitionChanged=new r;this._eventHelper=new u;this.setValue(n)}return t(e.prototype,{isConstant:{get:function(){var i=this._value,r,t;if(!n(i))return!0;for(r=i.length,t=0;t<r;t++)if(!f.isConstant(i[t]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}}),e.prototype.getValue=function(t,r){var e,o,u,f,h,s;if(!n(t))throw new i("time is required.");if(e=this._value,!n(e))return undefined;for(o=e.length,n(r)||(r=new Array(o)),u=0,f=0;u<o;)h=this._value[u],s=h.getValue(t,r[u]),n(s)&&(r[f]=s,f++),u++;return r.length=f,r},e.prototype.setValue=function(t){var u=this._eventHelper,f,i,r;if(u.removeAll(),n(t))for(this._value=t.slice(),f=t.length,i=0;i<f;i++)r=t[i],n(r)&&u.add(r.definitionChanged,e.prototype._raiseDefinitionChanged,this);else this._value=undefined;this._definitionChanged.raiseEvent(this)},e.prototype.equals=function(n){return this===n||n instanceof e&&f.arrayEquals(this._value,n._value)},e.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},e});t("DataSources/ReferenceProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/RuntimeError","./Property"],function(n,t,i,r,u,f){"use strict";function s(t){var r=!0,i;if(t._resolveEntity&&(i=t._targetCollection.getById(t._targetId),n(i)?(i.definitionChanged.addEventListener(e.prototype._onTargetEntityDefinitionChanged,t),t._targetEntity=i,t._resolveEntity=!1):(i=t._targetEntity,r=!1),!n(i)))throw new u('target entity "'+t._targetId+'" could not be resolved.');return r}function o(t){var i=t._targetProperty,e,r,o,f;if(t._resolveProperty){for(e=s(t),r=t._targetPropertyNames,i=t._targetEntity,o=r.length,f=0;f<o&&n(i);f++)i=i[r[f]];if(n(i))t._targetProperty=i,t._resolveProperty=!e;else if(!n(t._targetProperty))throw new u('targetProperty "'+t._targetId+"."+r.join(".")+'" could not be resolved.');}return i}function e(t,u,f){var o,s;if(!n(t))throw new i("targetCollection is required.");if(!n(u)||u==="")throw new i("targetId is required.");if(!n(f)||f.length===0)throw new i("targetPropertyNames is required.");for(o=0;o<f.length;o++)if(s=f[o],!n(s)||s==="")throw new i("reference contains invalid properties.");this._targetCollection=t;this._targetId=u;this._targetPropertyNames=f;this._targetProperty=undefined;this._targetEntity=undefined;this._definitionChanged=new r;this._resolveEntity=!0;this._resolveProperty=!0;t.collectionChanged.addEventListener(e.prototype._onCollectionChanged,this)}return t(e.prototype,{isConstant:{get:function(){return f.isConstant(o(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return o(this).referenceFrame}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return o(this)}}}),e.fromString=function(t,r){var o,f;if(!n(t))throw new i("targetCollection is required.");if(!n(r))throw new i("referenceString is required.");var l,s=[],h=!0,c=!1,u="";for(o=0;o<r.length;++o)f=r.charAt(o),c?(u+=f,c=!1):f==="\\"?c=!0:h&&f==="#"?(l=u,h=!1,u=""):h||f!=="."?u+=f:(s.push(u),u="");return s.push(u),new e(t,l,s)},e.prototype.getValue=function(n,t){return o(this).getValue(n,t)},e.prototype.getValueInReferenceFrame=function(n,t,i){return o(this).getValueInReferenceFrame(n,t,i)},e.prototype.getType=function(n){return o(this).getType(n)},e.prototype.equals=function(n){var i,r,u,t;if(this===n)return!0;if(i=this._targetPropertyNames,r=n._targetPropertyNames,this._targetCollection!==n._targetCollection||this._targetId!==n._targetId||i.length!==r.length)return!1;for(u=this._targetPropertyNames.length,t=0;t<u;t++)if(i[t]!==r[t])return!1;return!0},e.prototype._onTargetEntityDefinitionChanged=function(n,t){this._targetPropertyNames[0]===t&&(this._resolveProperty=!0,this._definitionChanged.raiseEvent(this))},e.prototype._onCollectionChanged=function(t,i,r){var u=this._targetEntity;n(u)&&(r.indexOf(u)!==-1?(u.definitionChanged.removeEventListener(e.prototype._onTargetEntityDefinitionChanged,this),this._resolveEntity=!0,this._resolveProperty=!0):this._resolveEntity&&(o(this),this._resolveEntity||this._definitionChanged.raiseEvent(this)))},e});t("DataSources/Rotation",["../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/Math"],function(n,t,i,r){"use strict";return{packedLength:1,pack:function(r,u,f){if(!t(r))throw new i("value is required");if(!t(u))throw new i("array is required");return f=n(f,0),u[f]=r,u},unpack:function(r,u){if(!t(r))throw new i("array is required");return u=n(u,0),r[u]},convertPackedArrayForInterpolation:function(u,f,e,o){var c,s,l,h;if(!t(u))throw new i("packedArray is required");for(f=n(f,0),e=n(e,u.length),s=0,l=e-f+1;s<l;s++)h=u[f+s],o[s]=s===0||Math.abs(c-h)<Math.PI?h:h-r.TWO_PI,c=h},unpackInterpolationResult:function(n,u,f,e,o){if(!t(n))throw new i("array is required");if(!t(u))throw new i("sourceArray is required");return(o=n[0],o<0)?o+r.TWO_PI:o}}});t("DataSources/SampledProperty",["../Core/binarySearch","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/ExtrapolationType","../Core/JulianDate","../Core/LinearApproximation"],function(n,t,i,r,u,f,e,o,s){"use strict";function y(n,t,i){var r,u=n.length,f=i.length,e=u+f,o;if(n.length=e,u!==t)for(o=u-1,r=e-1;r>=t;r--)n[r]=n[o--];for(r=0;r<f;r++)n[t++]=i[r]}function p(n,t){return n instanceof o?n:typeof n=="string"?o.fromIso8601(n):o.addSeconds(t,n,new o)}function c(t,r,u,f,e){for(var s=0,c,w,h,g,v,k,b,d;s<f.length;)if(v=p(f[s],t),h=n(r,v,o.compare),b=0,d=0,h<0){for(h=~h,g=h*e,w=undefined,k=r[h];s<f.length;){if(v=p(f[s],t),i(w)&&o.compare(w,v)>=0||i(k)&&o.compare(v,k)>=0)break;for(l[b++]=v,s=s+1,c=0;c<e;c++)a[d++]=f[s],s=s+1;w=v}b>0&&(a.length=d,y(u,g,a),l.length=b,y(r,h,l))}else{for(c=0;c<e;c++)s++,u[h*e+c]=f[s];s++}}function h(n,r){var o,l,c,h,w;if(!i(n))throw new u("type is required.");o=n;o===Number&&(o=v);var a=o.packedLength,y=t(o.packedInterpolationLength,a),b=0,p;if(i(r)){for(l=r.length,p=new Array(l),c=0;c<l;c++)h=r[c],h===Number&&(h=v),w=h.packedLength,a+=w,y+=t(h.packedInterpolationLength,w),p[c]=h;b=l}this._type=n;this._innerType=o;this._interpolationDegree=1;this._interpolationAlgorithm=s;this._numberOfPoints=0;this._times=[];this._values=[];this._xTable=[];this._yTable=[];this._packedLength=a;this._packedInterpolationLength=y;this._updateTableLength=!0;this._interpolationResult=new Array(y);this._definitionChanged=new f;this._derivativeTypes=r;this._innerDerivativeTypes=p;this._inputOrder=b;this._forwardExtrapolationType=e.NONE;this._forwardExtrapolationDuration=0;this._backwardExtrapolationType=e.NONE;this._backwardExtrapolationDuration=0}var v={packedLength:1,pack:function(n,i,r){r=t(r,0);i[r]=n},unpack:function(n,i){return i=t(i,0),n[i]}},l=[],a=[];return r(h.prototype,{isConstant:{get:function(){return this._values.length===0}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(n){this._forwardExtrapolationType!==n&&(this._forwardExtrapolationType=n,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(n){this._forwardExtrapolationDuration!==n&&(this._forwardExtrapolationDuration=n,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(n){this._backwardExtrapolationType!==n&&(this._backwardExtrapolationType=n,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(n){this._backwardExtrapolationDuration!==n&&(this._backwardExtrapolationDuration=n,this._definitionChanged.raiseEvent(this))}}}),h.prototype.getValue=function(t,r){var l,v,ot,st,d,w,a,g,ht,nt,et,rt,at;if(!i(t))throw new u("time is required.");if(l=this._times,v=l.length,v===0)return undefined;var y,c=this._innerType,p=this._values,f=n(l,t,o.compare);if(f<0){if(f=~f,f===0){if(ot=l[f],y=this._backwardExtrapolationDuration,this._backwardExtrapolationType===e.NONE||y!==0&&o.secondsDifference(ot,t)>y)return undefined;if(this._backwardExtrapolationType===e.HOLD)return c.unpack(p,0,r)}if(f>=v){if(f=v-1,st=l[f],y=this._forwardExtrapolationDuration,this._forwardExtrapolationType===e.NONE||y!==0&&o.secondsDifference(t,st)>y)return undefined;if(this._forwardExtrapolationType===e.HOLD)return f=v-1,c.unpack(p,f*c.packedLength,r)}var tt=this._xTable,b=this._yTable,it=this._interpolationAlgorithm,ut=this._packedInterpolationLength,k=this._inputOrder;if(this._updateTableLength&&(this._updateTableLength=!1,d=Math.min(it.getRequiredDataPoints(this._interpolationDegree,k),v),d!==this._numberOfPoints&&(this._numberOfPoints=d,tt.length=d,b.length=d*ut)),w=this._numberOfPoints-1,w<1)return undefined;var s=0,h=v-1,vt=h-s+1;for(vt>=w+1&&(a=f-(w/2|0)-1,a<s&&(a=s),g=a+w,g>h&&(g=h,a=g-w,a<s&&(a=s)),s=a,h=g),ht=h-s+1,nt=0;nt<ht;++nt)tt[nt]=o.secondsDifference(l[s+nt],l[h]);if(i(c.convertPackedArrayForInterpolation))c.convertPackedArrayForInterpolation(p,s,h,b);else for(var ct=0,lt=this._packedLength,ft=s*lt,yt=(h+1)*lt;ft<yt;)b[ct]=p[ft],ft++,ct++;return(et=o.secondsDifference(t,l[h]),k!==0&&i(it.interpolate)?(at=Math.floor(ut/(k+1)),rt=it.interpolate(et,tt,b,at,k,k,this._interpolationResult)):rt=it.interpolateOrderZero(et,tt,b,ut,this._interpolationResult),!i(c.unpackInterpolationResult))?c.unpack(rt,0,r):c.unpackInterpolationResult(rt,p,s,h,r)}return c.unpack(p,f*this._packedLength,r)},h.prototype.setInterpolationOptions=function(n){if(i(n)){var t=!1,r=n.interpolationAlgorithm,u=n.interpolationDegree;i(r)&&this._interpolationAlgorithm!==r&&(this._interpolationAlgorithm=r,t=!0);i(u)&&this._interpolationDegree!==u&&(this._interpolationDegree=u,t=!0);t&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))}},h.prototype.addSample=function(n,t,r){var o=this._innerDerivativeTypes,s=i(o),h,f,l,e;if(!i(n))throw new u("time is required.");if(!i(t))throw new u("value is required.");if(s&&!i(r))throw new u("derivatives is required.");if(h=this._innerType,f=[],f.push(n),h.pack(t,f,f.length),s)for(l=o.length,e=0;e<l;e++)o[e].pack(r[e],f,f.length);c(undefined,this._times,this._values,f,this._packedLength);this._updateTableLength=!0;this._definitionChanged.raiseEvent(this)},h.prototype.addSamples=function(n,t,r){var s=this._innerDerivativeTypes,h=i(s),e,l,a,o;if(!i(n))throw new u("times is required.");if(!i(t))throw new u("values is required.");if(n.length!==t.length)throw new u("times and values must be the same length.");if(h&&(!i(r)||r.length!==n.length))throw new u("times and derivativeValues must be the same length.");var v=this._innerType,y=n.length,f=[];for(e=0;e<y;e++)if(f.push(n[e]),v.pack(t[e],f,f.length),h)for(l=r[e],a=s.length,o=0;o<a;o++)s[o].pack(l[o],f,f.length);c(undefined,this._times,this._values,f,this._packedLength);this._updateTableLength=!0;this._definitionChanged.raiseEvent(this)},h.prototype.addSamplesPackedArray=function(n,t){if(!i(n))throw new u("packedSamples is required.");c(t,this._times,this._values,n,this._packedLength);this._updateTableLength=!0;this._definitionChanged.raiseEvent(this)},h.prototype.equals=function(n){var t,r,e,s,c,l;if(this===n)return!0;if(!i(n)||this._type!==n._type||this._interpolationDegree!==n._interpolationDegree||this._interpolationAlgorithm!==n._interpolationAlgorithm)return!1;var u=this._derivativeTypes,h=i(u),f=n._derivativeTypes,a=i(f);if(h!==a)return!1;if(h){if(r=u.length,r!==f.length)return!1;for(t=0;t<r;t++)if(u[t]!==f[t])return!1}if(e=this._times,s=n._times,r=e.length,r!==s.length)return!1;for(t=0;t<r;t++)if(!o.equals(e[t],s[t]))return!1;for(c=this._values,l=n._values,t=0;t<r;t++)if(c[t]!==l[t])return!1;return!0},h._mergeNewSamples=c,h});t("DataSources/SampledPositionProperty",["../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/ReferenceFrame","./PositionProperty","./Property","./SampledProperty"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(i,r){var o,u;if(r=t(r,0),r>0)for(o=new Array(r),u=0;u<r;u++)o[u]=n;this._numberOfDerivatives=r;this._property=new h(n,o);this._definitionChanged=new f;this._referenceFrame=t(i,e.FIXED);this._property._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)}return r(c.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(n){this._property.forwardExtrapolationType=n}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(n){this._property.forwardExtrapolationDuration=n}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(n){this._property.backwardExtrapolationType=n}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(n){this._property.backwardExtrapolationDuration=n}}}),c.prototype.getValue=function(n,t){return this.getValueInReferenceFrame(n,e.FIXED,t)},c.prototype.getValueInReferenceFrame=function(n,t,r){if(!i(n))throw new u("time is required.");if(!i(t))throw new u("referenceFrame is required.");return(r=this._property.getValue(n,r),i(r))?o.convertToReferenceFrame(n,r,this._referenceFrame,t,r):undefined},c.prototype.setInterpolationOptions=function(n){this._property.setInterpolationOptions(n)},c.prototype.addSample=function(n,t,r){var f=this._numberOfDerivatives;if(f>0&&(!i(r)||r.length!==f))throw new u("derivatives length must be equal to the number of derivatives.");this._property.addSample(n,t,r)},c.prototype.addSamples=function(n,t,i){this._property.addSamples(n,t,i)},c.prototype.addSamplesPackedArray=function(n,t){this._property.addSamplesPackedArray(n,t)},c.prototype.equals=function(n){return this===n||n instanceof c&&s.equals(this._property,n._property)&&this._referenceFrame===n._referenceFrame},c});t("DataSources/StripeOrientation",["../Core/freezeObject"],function(n){"use strict";return n({HORIZONTAL:0,VERTICAL:1})});t("DataSources/StripeMaterialProperty",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","./createPropertyDescriptor","./Property","./StripeOrientation"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){n=t(n,t.EMPTY_OBJECT);this._definitionChanged=new u;this._orientation=undefined;this._orientationSubscription=undefined;this._evenColor=undefined;this._evenColorSubscription=undefined;this._oddColor=undefined;this._oddColorSubscription=undefined;this._offset=undefined;this._offsetSubscription=undefined;this._repeat=undefined;this._repeatSubscription=undefined;this.orientation=n.orientation;this.evenColor=n.evenColor;this.oddColor=n.oddColor;this.offset=n.offset;this.repeat=n.repeat}var h=o.HORIZONTAL,c=n.WHITE,l=n.BLACK,a=0,v=1;return r(s.prototype,{isConstant:{get:function(){return e.isConstant(this._orientation)&&e.isConstant(this._evenColor)&&e.isConstant(this._oddColor)&&e.isConstant(this._offset)&&e.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},orientation:f("orientation"),evenColor:f("evenColor"),oddColor:f("oddColor"),offset:f("offset"),repeat:f("repeat")}),s.prototype.getType=function(){return"Stripe"},s.prototype.getValue=function(n,t){return i(t)||(t={}),t.horizontal=e.getValueOrDefault(this._orientation,n,h)===o.HORIZONTAL,t.evenColor=e.getValueOrClonedDefault(this._evenColor,n,c,t.evenColor),t.oddColor=e.getValueOrClonedDefault(this._oddColor,n,l,t.oddColor),t.offset=e.getValueOrDefault(this._offset,n,a),t.repeat=e.getValueOrDefault(this._repeat,n,v),t},s.prototype.equals=function(n){return this===n||n instanceof s&&e.equals(this._orientation,n._orientation)&&e.equals(this._evenColor,n._evenColor)&&e.equals(this._oddColor,n._oddColor)&&e.equals(this._offset,n._offset)&&e.equals(this._repeat,n._repeat)},s});t("DataSources/TimeIntervalCollectionPositionProperty",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/ReferenceFrame","../Core/TimeIntervalCollection","./PositionProperty","./Property"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(t){this._definitionChanged=new u;this._intervals=new e;this._intervals.changedEvent.addEventListener(h.prototype._intervalsChanged,this);this._referenceFrame=n(t,f.FIXED)}return i(h.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}},referenceFrame:{get:function(){return this._referenceFrame}}}),h.prototype.getValue=function(n,t){return this.getValueInReferenceFrame(n,f.FIXED,t)},h.prototype.getValueInReferenceFrame=function(n,i,u){if(!t(n))throw new r("time is required.");if(!t(i))throw new r("referenceFrame is required.");var f=this._intervals.findDataForIntervalContainingDate(n);return t(f)?o.convertToReferenceFrame(n,f,this._referenceFrame,i,u):undefined},h.prototype.equals=function(n){return this===n||n instanceof h&&this._intervals.equals(n._intervals,s.equals)&&this._referenceFrame===n._referenceFrame},h.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)},h});t("DataSources/TimeIntervalCollectionProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/TimeIntervalCollection","./Property"],function(n,t,i,r,u,f){"use strict";function e(){this._definitionChanged=new r;this._intervals=new u;this._intervals.changedEvent.addEventListener(e.prototype._intervalsChanged,this)}return t(e.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}}),e.prototype.getValue=function(t,r){if(!n(t))throw new i("time is required");var u=this._intervals.findDataForIntervalContainingDate(t);return n(u)&&typeof u.clone=="function"?u.clone(r):u},e.prototype.equals=function(n){return this===n||n instanceof e&&this._intervals.equals(n._intervals,f.equals)},e.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)},e});t("DataSources/VelocityVectorProperty",["../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/JulianDate","./Property"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,i){this._position=undefined;this._subscription=undefined;this._definitionChanged=new f;this._normalize=t(i,!0);this.position=n}r(s.prototype,{isConstant:{get:function(){return o.isConstant(this._position)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._position},set:function(n){var t=this._position;t!==n&&(i(t)&&this._subscription(),this._position=n,i(n)&&(this._subscription=n._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)),this._definitionChanged.raiseEvent(this))}},normalize:{get:function(){return this._normalize},set:function(n){this._normalize!==n&&(this._normalize=n,this._definitionChanged.raiseEvent(this))}}});var a=new n,c=new n,l=new e,h=1/60;return s.prototype.getValue=function(n,t){return this._getValue(n,t)},s.prototype._getValue=function(t,r,f){var v,s,y,p;if(!i(t))throw new u("time is required");return(i(r)||(r=new n),v=this._position,o.isConstant(v))?this._normalize?undefined:n.clone(n.ZERO,r):(s=v.getValue(t,a),y=v.getValue(e.addSeconds(t,h,l),c),!i(s))?undefined:!i(y)&&(y=s,s=v.getValue(e.addSeconds(t,-h,l),c),!i(s))?undefined:n.equals(s,y)?this._normalize?undefined:n.clone(n.ZERO,r):(i(f)&&s.clone(f),p=n.subtract(y,s,r),this._normalize)?n.normalize(p,r):n.divideByScalar(p,h,r)},s.prototype.equals=function(n){return this===n||n instanceof s&&o.equals(this._position,n._position)},s});t("DataSources/VelocityOrientationProperty",["../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Ellipsoid","../Core/Event","../Core/Matrix3","../Core/Quaternion","../Core/Transforms","./Property","./VelocityVectorProperty"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function l(n,i){this._velocityVectorProperty=new c(n,!0);this._subscription=undefined;this._ellipsoid=undefined;this._definitionChanged=new f;this.ellipsoid=t(i,u.WGS84);var r=this;this._velocityVectorProperty.definitionChanged.addEventListener(function(){r._definitionChanged.raiseEvent(r)})}r(l.prototype,{isConstant:{get:function(){return h.isConstant(this._velocityVectorProperty)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._velocityVectorProperty.position},set:function(n){this._velocityVectorProperty.position=n}},ellipsoid:{get:function(){return this._ellipsoid},set:function(n){var t=this._ellipsoid;t!==n&&(this._ellipsoid=n,this._definitionChanged.raiseEvent(this))}}});var a=new n,y=new n,v=new e;return l.prototype.getValue=function(n,t){var r=this._velocityVectorProperty._getValue(n,y,a);return i(r)?(s.rotationMatrixFromPositionVelocity(a,r,this._ellipsoid,v),o.fromRotationMatrix(v,t)):undefined},l.prototype.equals=function(n){return this===n||n instanceof l&&h.equals(this._velocityVectorProperty,n._velocityVectorProperty)&&(this._ellipsoid===n._ellipsoid||this._ellipsoid.equals(n._ellipsoid))},l});t("DataSources/CzmlDataSource",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/ClockRange","../Core/ClockStep","../Core/Color","../Core/CornerType","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/Ellipsoid","../Core/Event","../Core/ExtrapolationType","../Core/getFilenameFromUri","../Core/HermitePolynomialApproximation","../Core/isArray","../Core/Iso8601","../Core/JulianDate","../Core/LagrangePolynomialApproximation","../Core/LinearApproximation","../Core/Math","../Core/NearFarScalar","../Core/Quaternion","../Core/Rectangle","../Core/ReferenceFrame","../Core/Resource","../Core/RuntimeError","../Core/Spherical","../Core/TimeInterval","../Core/TimeIntervalCollection","../Scene/ColorBlendMode","../Scene/HeightReference","../Scene/HorizontalOrigin","../Scene/LabelStyle","../Scene/ShadowMode","../Scene/VerticalOrigin","../ThirdParty/Uri","../ThirdParty/when","./BillboardGraphics","./BoxGraphics","./ColorMaterialProperty","./CompositeMaterialProperty","./CompositePositionProperty","./CompositeProperty","./ConstantPositionProperty","./ConstantProperty","./CorridorGraphics","./CylinderGraphics","./DataSource","./DataSourceClock","./EllipseGraphics","./EllipsoidGraphics","./EntityCluster","./EntityCollection","./GridMaterialProperty","./ImageMaterialProperty","./LabelGraphics","./ModelGraphics","./NodeTransformationProperty","./PathGraphics","./PointGraphics","./PolygonGraphics","./PolylineArrowMaterialProperty","./PolylineDashMaterialProperty","./PolylineGlowMaterialProperty","./PolylineGraphics","./PolylineOutlineMaterialProperty","./PositionPropertyArray","./PropertyArray","./PropertyBag","./RectangleGraphics","./ReferenceProperty","./Rotation","./SampledPositionProperty","./SampledProperty","./StripeMaterialProperty","./StripeOrientation","./TimeIntervalCollectionPositionProperty","./TimeIntervalCollectionProperty","./VelocityOrientationProperty","./VelocityVectorProperty","./WallGraphics"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr,tr,ir,rr,ur,fr,er,or,sr,hr,cr,lr,ar,vr,yr,pr,wr,br,kr,dr,gr,nu,tu){"use strict";function hu(){}function cu(n,t){return t[0]==="#"&&(t=wu+t),ar.fromString(n,t)}function ku(n,t,r){if(c(r.reference))return cu(t,r.reference);if(c(r.velocityReference)){var u=cu(t,r.velocityReference);switch(n){case i:case hu:return new nu(u,n===hu);case ft:return new gr(u)}}throw new ht(JSON.stringify(r)+" is not valid CZML.");}function yf(n){var r=n.rgbaf,i,u,t;if(c(r))return r;if(i=n.rgba,!c(i))return undefined;if(u=i.length,u===e.packedLength)return[e.byteToFloat(i[0]),e.byteToFloat(i[1]),e.byteToFloat(i[2]),e.byteToFloat(i[3])];for(r=new Array(u),t=0;t<u;t+=5)r[t]=i[t],r[t+1]=e.byteToFloat(i[t+1]),r[t+2]=e.byteToFloat(i[t+2]),r[t+3]=e.byteToFloat(i[t+3]),r[t+4]=e.byteToFloat(i[t+4]);return r}function du(n,t){var i=h(n.uri,n);return c(t)?t.getDerivedResource({url:i}):st.createIfNeeded(i)}function pf(n){var r=n.wsen,i,u,t;if(c(r))return r;if(i=n.wsenDegrees,!c(i))return undefined;if(u=i.length,u===et.packedLength)return[rt.toRadians(i[0]),rt.toRadians(i[1]),rt.toRadians(i[2]),rt.toRadians(i[3])];for(r=new Array(u),t=0;t<u;t+=5)r[t]=i[t],r[t+1]=rt.toRadians(i[t+1]),r[t+2]=rt.toRadians(i[t+2]),r[t+3]=rt.toRadians(i[t+3]),r[t+4]=rt.toRadians(i[t+4]);return r}function wf(n){var f=n.length,t,r,u;if(eu.magnitude=1,f===2)return eu.clock=n[0],eu.cone=n[1],i.fromSpherical(eu,uu),[uu.x,uu.y,uu.z];for(t=new Array(f/3*4),r=0,u=0;r<f;r+=3,u+=4)t[u]=n[r],eu.clock=n[r+1],eu.cone=n[r+2],i.fromSpherical(eu,uu),t[u+1]=uu.x,t[u+2]=uu.y,t[u+3]=uu.z;return t}function bf(n){var u=n.length,r,t;if(u===3)return eu.clock=n[0],eu.cone=n[1],eu.magnitude=n[2],i.fromSpherical(eu,uu),[uu.x,uu.y,uu.z];for(r=new Array(u),t=0;t<u;t+=4)r[t]=n[t],eu.clock=n[t+1],eu.cone=n[t+2],eu.magnitude=n[t+3],i.fromSpherical(eu,uu),r[t+1]=uu.x,r[t+2]=uu.y,r[t+3]=uu.z;return r}function kf(n){var r=n.length,i,t;if(r===3)return fu.longitude=n[0],fu.latitude=n[1],fu.height=n[2],y.WGS84.cartographicToCartesian(fu,uu),[uu.x,uu.y,uu.z];for(i=new Array(r),t=0;t<r;t+=4)i[t]=n[t],fu.longitude=n[t+1],fu.latitude=n[t+2],fu.height=n[t+3],y.WGS84.cartographicToCartesian(fu,uu),i[t+1]=uu.x,i[t+2]=uu.y,i[t+3]=uu.z;return i}function df(n){var r=n.length,i,t;if(r===3)return fu.longitude=rt.toRadians(n[0]),fu.latitude=rt.toRadians(n[1]),fu.height=n[2],y.WGS84.cartographicToCartesian(fu,uu),[uu.x,uu.y,uu.z];for(i=new Array(r),t=0;t<r;t+=4)i[t]=n[t],fu.longitude=rt.toRadians(n[t+1]),fu.latitude=rt.toRadians(n[t+2]),fu.height=n[t+3],y.WGS84.cartographicToCartesian(fu,uu),i[t+1]=uu.x,i[t+2]=uu.y,i[t+3]=uu.z;return i}function bu(n){var o=n.cartesian,t,i,r,u,f,e;if(c(o))return o;if(t=n.cartesianVelocity,c(t))return t;if(i=n.unitCartesian,c(i))return i;if(r=n.unitSpherical,c(r))return wf(r);if(u=n.spherical,c(u))return bf(u);if(f=n.cartographicRadians,c(f))return kf(f);if(e=n.cartographicDegrees,c(e))return df(e);throw new ht(JSON.stringify(n)+" is not a valid CZML interval.");}function gu(n,t){i.unpack(n,t,uu);i.normalize(uu,uu);i.pack(uu,n,t)}function gf(n){var t=bu(n),i;if(t.length===3)return gu(t,0),t;for(i=1;i<t.length;i+=4)gu(t,i);return t}function nf(n,t){ft.unpack(n,t,au);ft.normalize(au,au);ft.pack(au,n,t)}function ne(n){var t=n.unitQuaternion,i;if(c(t)){if(t.length===4)return nf(t,0),t;for(i=1;i<t.length;i+=5)nf(t,i)}return t}function tf(r){return typeof r=="boolean"?Boolean:typeof r=="number"?Number:typeof r=="string"?String:r.hasOwnProperty("array")?Array:r.hasOwnProperty("boolean")?Boolean:r.hasOwnProperty("boundingRectangle")?n:r.hasOwnProperty("cartesian2")?t:r.hasOwnProperty("cartesian")||r.hasOwnProperty("spherical")||r.hasOwnProperty("cartographicRadians")||r.hasOwnProperty("cartographicDegrees")?i:r.hasOwnProperty("unitCartesian")||r.hasOwnProperty("unitSpherical")?hu:r.hasOwnProperty("rgba")||r.hasOwnProperty("rgbaf")?e:r.hasOwnProperty("colorBlendMode")?vt:r.hasOwnProperty("cornerType")?o:r.hasOwnProperty("heightReference")?yt:r.hasOwnProperty("horizontalOrigin")?pt:r.hasOwnProperty("date")?nt:r.hasOwnProperty("labelStyle")?wt:r.hasOwnProperty("number")?Number:r.hasOwnProperty("nearFarScalar")?ut:r.hasOwnProperty("distanceDisplayCondition")?v:r.hasOwnProperty("object")||r.hasOwnProperty("value")?Object:r.hasOwnProperty("unitQuaternion")?ft:r.hasOwnProperty("shadowMode")?bt:r.hasOwnProperty("string")?String:r.hasOwnProperty("stripeOrientation")?br:r.hasOwnProperty("wsen")||r.hasOwnProperty("wsenDegrees")?et:r.hasOwnProperty("uri")?dt:r.hasOwnProperty("verticalOrigin")?kt:Object}function te(r,u,f){switch(r){case Array:return u.array;case Boolean:return h(u.boolean,u);case n:return u.boundingRectangle;case t:return u.cartesian2;case i:return bu(u);case hu:return gf(u);case e:return yf(u);case vt:return vt[h(u.colorBlendMode,u)];case o:return o[h(u.cornerType,u)];case yt:return yt[h(u.heightReference,u)];case pt:return pt[h(u.horizontalOrigin,u)];case Image:return du(u,f);case nt:return nt.fromIso8601(h(u.date,u));case wt:return wt[h(u.labelStyle,u)];case Number:return h(u.number,u);case ut:return u.nearFarScalar;case v:return u.distanceDisplayCondition;case Object:return h(h(u.object,u.value),u);case ft:return ne(u);case vr:return h(u.number,u);case bt:return bt[h(h(u.shadowMode,u.shadows),u)];case String:return h(u.string,u);case br:return br[h(u.stripeOrientation,u)];case et:return pf(u);case dt:return du(u,f);case kt:return kt[h(u.verticalOrigin,u)];default:throw new ht(r);}}function vu(n,t){var e=n.interpolationAlgorithm,i,r,u,f;(c(e)||c(n.interpolationDegree))&&t.setInterpolationOptions({interpolationAlgorithm:rf[e],interpolationDegree:n.interpolationDegree});i=n.forwardExtrapolationType;c(i)&&(t.forwardExtrapolationType=w[i]);r=n.forwardExtrapolationDuration;c(r)&&(t.forwardExtrapolationDuration=r);u=n.backwardExtrapolationType;c(u)&&(t.backwardExtrapolationType=w[u]);f=n.backwardExtrapolationDuration;c(f)&&(t.backwardExtrapolationDuration=f)}function yu(n,t,i,r,u,f,e){var s,tt=r.interval,it,y,a,rt,v,p,w,o,b,k,l,d;if(c(tt)?(ru.iso8601=tt,s=lt.fromIso8601(ru),c(u)&&(s=lt.intersect(s,u,lu))):c(u)&&(s=u),v=!c(r.reference)&&!c(r.velocityReference),p=c(s)&&!s.equals(g.MAXIMUM_INTERVAL),v&&(a=te(n,r,f),it=h(n.packedLength,1),rt=h(a.length,1),y=!c(r.array)&&typeof a!="string"&&rt>it&&n!==Object),w=typeof n.unpack=="function"&&n!==vr,!y&&!p){t[i]=v?new oi(w?n.unpack(a,0):a):ku(n,e,r);return}if(o=t[i],k=r.epoch,c(k)&&(b=nt.fromIso8601(k)),y&&!p){o instanceof pr||(o=new pr(n),t[i]=o);o.addSamplesPackedArray(a,b);vu(r,o);return}if(!y&&p){s=s.clone();s.data=v?w?n.unpack(a,0):a:ku(n,e,r);c(o)||(o=v?new dr:new fi,t[i]=o);v&&o instanceof dr?o.intervals.addInterval(s):o instanceof fi?(v&&(s.data=new oi(s.data)),o.intervals.addInterval(s)):(l=g.MAXIMUM_INTERVAL.clone(),l.data=o,o=new fi,t[i]=o,o.intervals.addInterval(l),v&&(s.data=new oi(s.data)),o.intervals.addInterval(s));return}c(o)||(o=new fi,t[i]=o);o instanceof fi||(l=g.MAXIMUM_INTERVAL.clone(),l.data=o,o=new fi,t[i]=o,o.intervals.addInterval(l));d=o.intervals;l=d.findInterval(s);c(l)&&l.data instanceof pr||(l=s.clone(),l.data=new pr(n),d.addInterval(l));l.data.addSamplesPackedArray(a,b);vu(r,l.data)}function iu(n,t,i,r,u,f,e){if(c(r))if(d(r))for(var o=0,s=r.length;o<s;o++)yu(n,t,i,r[o],u,f,e);else yu(n,t,i,r,u,f,e)}function uf(n,t,r,u,f,e){var s,it=r.interval,o,k,d,a,tt;c(it)?(ru.iso8601=it,s=lt.fromIso8601(ru),c(u)&&(s=lt.intersect(s,u,lu))):c(u)&&(s=u);var l,y,p=!1,rt,w=c(r.cartesianVelocity)?1:0,ut=i.packedLength*(w+1),v=!c(r.reference),b=c(s)&&!s.equals(g.MAXIMUM_INTERVAL);if(v&&(c(r.referenceFrame)&&(l=ot[r.referenceFrame]),l=h(l,ot.FIXED),y=bu(r),rt=h(y.length,1),p=rt>ut),!p&&!b){n[t]=v?new ei(i.unpack(y),l):cu(e,r.reference);return}if(o=n[t],d=r.epoch,c(d)&&(k=nt.fromIso8601(d)),p&&!b){o instanceof yr&&(!c(l)||o.referenceFrame===l)||(o=new yr(l,w),n[t]=o);o.addSamplesPackedArray(y,k);vu(r,o);return}if(!p&&b){s=s.clone();s.data=v?i.unpack(y):cu(e,r.reference);c(o)||(o=v?new kr(l):new ui(l),n[t]=o);v&&o instanceof kr&&c(l)&&o.referenceFrame===l?o.intervals.addInterval(s):o instanceof ui?(v&&(s.data=new ei(s.data,l)),o.intervals.addInterval(s)):(a=g.MAXIMUM_INTERVAL.clone(),a.data=o,o=new ui(o.referenceFrame),n[t]=o,o.intervals.addInterval(a),v&&(s.data=new ei(s.data,l)),o.intervals.addInterval(s));return}c(o)?o instanceof ui||(a=g.MAXIMUM_INTERVAL.clone(),a.data=o,o=new ui(o.referenceFrame),n[t]=o,o.intervals.addInterval(a)):(o=new ui(l),n[t]=o);tt=o.intervals;a=tt.findInterval(s);c(a)&&a.data instanceof yr&&(!c(l)||a.data.referenceFrame===l)||(a=s.clone(),a.data=new yr(l,w),tt.addInterval(a));a.data.addSamplesPackedArray(y,k);vu(r,a.data)}function ff(n,t,i,r,u,f){if(c(i))if(d(i))for(var e=0,o=i.length;e<o;e++)uf(n,t,i[e],r,u,f);else uf(n,t,i,r,u,f)}function ef(n,i,r,u,f,o){var l,p=r.interval,v,s,a,y,h;c(p)?(ru.iso8601=p,l=lt.fromIso8601(ru),c(u)&&(l=lt.intersect(l,u,lu))):c(u)&&(l=u);v=n[i];c(l)?(v instanceof ri||(v=new ri,n[i]=v),y=v.intervals,a=y.findInterval({start:l.start,stop:l.stop}),c(a)?s=a.data:(a=l.clone(),y.addInterval(a))):s=v;c(r.solidColor)?(s instanceof ii||(s=new ii),h=r.solidColor,iu(e,s,"color",h.color,undefined,undefined,o)):c(r.grid)?(s instanceof wi||(s=new wi),h=r.grid,iu(e,s,"color",h.color,undefined,f,o),iu(Number,s,"cellAlpha",h.cellAlpha,undefined,f,o),iu(t,s,"lineCount",h.lineCount,undefined,f,o),iu(t,s,"lineThickness",h.lineThickness,undefined,f,o),iu(t,s,"lineOffset",h.lineOffset,undefined,f,o)):c(r.image)?(s instanceof bi||(s=new bi),h=r.image,iu(Image,s,"image",h.image,undefined,f,o),iu(t,s,"repeat",h.repeat,undefined,f,o),iu(e,s,"color",h.color,undefined,f,o),iu(Boolean,s,"transparent",h.transparent,undefined,f,o)):c(r.stripe)?(s instanceof wr||(s=new wr),h=r.stripe,iu(br,s,"orientation",h.orientation,undefined,f,o),iu(e,s,"evenColor",h.evenColor,undefined,f,o),iu(e,s,"oddColor",h.oddColor,undefined,f,o),iu(Number,s,"offset",h.offset,undefined,f,o),iu(Number,s,"repeat",h.repeat,undefined,f,o)):c(r.polylineOutline)?(s instanceof or||(s=new or),h=r.polylineOutline,iu(e,s,"color",h.color,undefined,f,o),iu(e,s,"outlineColor",h.outlineColor,undefined,f,o),iu(Number,s,"outlineWidth",h.outlineWidth,undefined,f,o)):c(r.polylineGlow)?(s instanceof fr||(s=new fr),h=r.polylineGlow,iu(e,s,"color",h.color,undefined,f,o),iu(Number,s,"glowPower",h.glowPower,undefined,f,o)):c(r.polylineArrow)?(s instanceof rr||(s=new rr),h=r.polylineArrow,iu(e,s,"color",h.color,undefined,undefined,o)):c(r.polylineDash)&&(s instanceof ur||(s=new ur),h=r.polylineDash,iu(e,s,"color",h.color,undefined,undefined,o),iu(e,s,"gapColor",h.gapColor,undefined,undefined,o),iu(Number,s,"dashLength",h.dashLength,undefined,f,o),iu(Number,s,"dashPattern",h.dashPattern,undefined,f,o));c(a)?a.data=s:n[i]=s}function su(n,t,i,r,u,f){if(c(i))if(d(i))for(var e=0,o=i.length;e<o;e++)ef(n,t,i[e],r,u,f);else ef(n,t,i,r,u,f)}function ie(n,t){n.name=h(t.name,n.name)}function re(n,t,i,r){var u=t.description;c(u)&&iu(String,n,"description",u,undefined,r,i)}function ue(n,t,i,r){var u=t.position;c(u)&&ff(n,"position",u,undefined,r,i)}function fe(n,t,r,u){var f=t.viewFrom;c(f)&&iu(i,n,"viewFrom",f,undefined,u,r)}function ee(n,t,i,r){var u=t.orientation;c(u)&&iu(ft,n,"orientation",u,undefined,r,i)}function oe(n,t,i,r){var o=t.properties,u,f,e,s;if(c(o)){c(n.properties)||(n.properties=new cr);for(u in o)if(o.hasOwnProperty(u))if(n.properties.hasProperty(u)||n.properties.addProperty(u),f=o[u],d(f))for(e=0,s=f.length;e<s;e++)yu(tf(f[e]),n.properties,u,f[e],undefined,r,i);else yu(tf(f),n.properties,u,f,undefined,r,i)}}function of(n,t,i,r){var o=i.references,f,u,e;c(o)?(f=o.map(function(n){return cu(r,n)}),u=i.interval,c(u)?(u=lt.fromIso8601(u),n[t]instanceof ui||(u.data=new hr(f),e=new fi,e.intervals.addInterval(u),n[t]=e)):n[t]=new hr(f)):iu(Array,n,t,i,undefined,undefined,r)}function sf(n,t,i,r){if(c(i))if(d(i))for(var u=0,f=i.length;u<f;++u)of(n,t,i[u],r);else of(n,t,i,r)}function hf(n,t,r,u){var e,f,o;c(r.references)?(e=r.references.map(function(n){return cu(u,n)}),f=r.interval,c(f)?(f=lt.fromIso8601(f),n[t]instanceof ui||(f.data=new sr(e),o=new ui,o.intervals.addInterval(f),n[t]=o)):n[t]=new sr(e)):(c(r.cartesian)?r.array=i.unpackArray(r.cartesian):c(r.cartographicRadians)?r.array=i.fromRadiansArrayHeights(r.cartographicRadians):c(r.cartographicDegrees)&&(r.array=i.fromDegreesArrayHeights(r.cartographicDegrees)),c(r.array)&&iu(Array,n,t,r,undefined,undefined,u))}function pu(n,t,i,r){if(c(i))if(d(i))for(var u=0,f=i.length;u<f;u++)hf(n,t,i[u],r);else hf(n,t,i,r)}function se(n,t){var u,r=t.availability,i,e,f;if(c(r)){if(d(r))for(e=r.length,f=0;f<e;f++)c(i)||(i=new at),ru.iso8601=r[f],u=lt.fromIso8601(ru),i.addInterval(u);else ru.iso8601=r,u=lt.fromIso8601(ru),i=new at,i.addInterval(u);n.availability=i}}function he(n,t,i,r,u){c(t)&&iu(hu,n,"alignedAxis",t,i,r,u)}function ce(r,u,f,o){var h=u.billboard,l,a,s;c(h)&&(a=h.interval,c(a)&&(ru.iso8601=a,l=lt.fromIso8601(ru)),s=r.billboard,c(s)||(r.billboard=s=new ni),iu(Boolean,s,"show",h.show,l,o,f),iu(Image,s,"image",h.image,l,o,f),iu(Number,s,"scale",h.scale,l,o,f),iu(t,s,"pixelOffset",h.pixelOffset,l,o,f),iu(i,s,"eyeOffset",h.eyeOffset,l,o,f),iu(pt,s,"horizontalOrigin",h.horizontalOrigin,l,o,f),iu(kt,s,"verticalOrigin",h.verticalOrigin,l,o,f),iu(yt,s,"heightReference",h.heightReference,l,o,f),iu(e,s,"color",h.color,l,o,f),iu(vr,s,"rotation",h.rotation,l,o,f),he(s,h.alignedAxis,l,o,f),iu(Boolean,s,"sizeInMeters",h.sizeInMeters,l,o,f),iu(Number,s,"width",h.width,l,o,f),iu(Number,s,"height",h.height,l,o,f),iu(ut,s,"scaleByDistance",h.scaleByDistance,l,o,f),iu(ut,s,"translucencyByDistance",h.translucencyByDistance,l,o,f),iu(ut,s,"pixelOffsetScaleByDistance",h.pixelOffsetScaleByDistance,l,o,f),iu(n,s,"imageSubRegion",h.imageSubRegion,l,o,f),iu(v,s,"distanceDisplayCondition",h.distanceDisplayCondition,l,o,f),iu(Number,s,"disableDepthTestDistance",h.disableDepthTestDistance,l,o,f))}function le(n,t,r,u){var o=t.box,s,h,f;c(o)&&(h=o.interval,c(h)&&(ru.iso8601=h,s=lt.fromIso8601(ru)),f=n.box,c(f)||(n.box=f=new ti),iu(Boolean,f,"show",o.show,s,u,r),iu(i,f,"dimensions",o.dimensions,s,u,r),iu(Boolean,f,"fill",o.fill,s,u,r),su(f,"material",o.material,s,u,r),iu(Boolean,f,"outline",o.outline,s,u,r),iu(e,f,"outlineColor",o.outlineColor,s,u,r),iu(Number,f,"outlineWidth",o.outlineWidth,s,u,r),iu(bt,f,"shadows",o.shadows,s,u,r),iu(v,f,"distanceDisplayCondition",o.distanceDisplayCondition,s,u,r))}function ae(n,t,i,r){var f=t.corridor,s,h,u;c(f)&&(h=f.interval,c(h)&&(ru.iso8601=h,s=lt.fromIso8601(ru)),u=n.corridor,c(u)||(n.corridor=u=new si),iu(Boolean,u,"show",f.show,s,r,i),pu(u,"positions",f.positions,i),iu(Number,u,"width",f.width,s,r,i),iu(Number,u,"height",f.height,s,r,i),iu(Number,u,"extrudedHeight",f.extrudedHeight,s,r,i),iu(o,u,"cornerType",f.cornerType,s,r,i),iu(Number,u,"granularity",f.granularity,s,r,i),iu(Boolean,u,"fill",f.fill,s,r,i),su(u,"material",f.material,s,r,i),iu(Boolean,u,"outline",f.outline,s,r,i),iu(e,u,"outlineColor",f.outlineColor,s,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,s,r,i),iu(bt,u,"shadows",f.shadows,s,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,s,r,i),iu(Number,u,"zIndex",f.zIndex,s,r,i))}function ve(n,t,i,r){var f=t.cylinder,o,s,u;c(f)&&(s=f.interval,c(s)&&(ru.iso8601=s,o=lt.fromIso8601(ru)),u=n.cylinder,c(u)||(n.cylinder=u=new hi),iu(Boolean,u,"show",f.show,o,r,i),iu(Number,u,"length",f.length,o,r,i),iu(Number,u,"topRadius",f.topRadius,o,r,i),iu(Number,u,"bottomRadius",f.bottomRadius,o,r,i),iu(Boolean,u,"fill",f.fill,o,r,i),su(u,"material",f.material,o,r,i),iu(Boolean,u,"outline",f.outline,o,r,i),iu(e,u,"outlineColor",f.outlineColor,o,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,o,r,i),iu(Number,u,"numberOfVerticalLines",f.numberOfVerticalLines,o,r,i),iu(Number,u,"slices",f.slices,o,r,i),iu(bt,u,"shadows",f.shadows,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i))}function ye(n,t){var u=n.version,e,f,i,r;if(c(u)&&typeof u=="string"&&(e=u.split("."),e.length===2)){if(e[0]!=="1")throw new ht("Cesium only supports CZML version 1.");t._version=u}if(!c(t._version))throw new ht("CZML version information invalid.  It is expected to be a property on the document object in the <Major>.<Minor> version format.");f=t._documentPacket;c(n.name)&&(f.name=n.name);i=n.clock;c(i)&&(r=f.clock,c(r)?(r.interval=h(i.interval,r.interval),r.currentTime=h(i.currentTime,r.currentTime),r.range=h(i.range,r.range),r.step=h(i.step,r.step),r.multiplier=h(i.multiplier,r.multiplier)):f.clock={interval:i.interval,currentTime:i.currentTime,range:i.range,step:i.step,multiplier:i.multiplier})}function pe(n,t,i,r){var f=t.ellipse,o,s,u;c(f)&&(s=f.interval,c(s)&&(ru.iso8601=s,o=lt.fromIso8601(ru)),u=n.ellipse,c(u)||(n.ellipse=u=new ai),iu(Boolean,u,"show",f.show,o,r,i),iu(Number,u,"semiMajorAxis",f.semiMajorAxis,o,r,i),iu(Number,u,"semiMinorAxis",f.semiMinorAxis,o,r,i),iu(Number,u,"height",f.height,o,r,i),iu(Number,u,"extrudedHeight",f.extrudedHeight,o,r,i),iu(vr,u,"rotation",f.rotation,o,r,i),iu(vr,u,"stRotation",f.stRotation,o,r,i),iu(Number,u,"granularity",f.granularity,o,r,i),iu(Boolean,u,"fill",f.fill,o,r,i),su(u,"material",f.material,o,r,i),iu(Boolean,u,"outline",f.outline,o,r,i),iu(e,u,"outlineColor",f.outlineColor,o,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,o,r,i),iu(Number,u,"numberOfVerticalLines",f.numberOfVerticalLines,o,r,i),iu(bt,u,"shadows",f.shadows,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i),iu(Number,u,"zIndex",f.zIndex,o,r,i))}function we(n,t,r,u){var o=t.ellipsoid,s,h,f;c(o)&&(h=o.interval,c(h)&&(ru.iso8601=h,s=lt.fromIso8601(ru)),f=n.ellipsoid,c(f)||(n.ellipsoid=f=new vi),iu(Boolean,f,"show",o.show,s,u,r),iu(i,f,"radii",o.radii,s,u,r),iu(Boolean,f,"fill",o.fill,s,u,r),su(f,"material",o.material,s,u,r),iu(Boolean,f,"outline",o.outline,s,u,r),iu(e,f,"outlineColor",o.outlineColor,s,u,r),iu(Number,f,"outlineWidth",o.outlineWidth,s,u,r),iu(Number,f,"stackPartitions",o.stackPartitions,s,u,r),iu(Number,f,"slicePartitions",o.slicePartitions,s,u,r),iu(Number,f,"subdivisions",o.subdivisions,s,u,r),iu(bt,f,"shadows",o.shadows,s,u,r),iu(v,f,"distanceDisplayCondition",o.distanceDisplayCondition,s,u,r))}function be(n,r,u,f){var s=r.label,h,l,o;c(s)&&(l=s.interval,c(l)&&(ru.iso8601=l,h=lt.fromIso8601(ru)),o=n.label,c(o)||(n.label=o=new ki),iu(Boolean,o,"show",s.show,h,f,u),iu(String,o,"text",s.text,h,f,u),iu(String,o,"font",s.font,h,f,u),iu(wt,o,"style",s.style,h,f,u),iu(Number,o,"scale",s.scale,h,f,u),iu(Boolean,o,"showBackground",s.showBackground,h,f,u),iu(e,o,"backgroundColor",s.backgroundColor,h,f,u),iu(t,o,"backgroundPadding",s.backgroundPadding,h,f,u),iu(t,o,"pixelOffset",s.pixelOffset,h,f,u),iu(i,o,"eyeOffset",s.eyeOffset,h,f,u),iu(pt,o,"horizontalOrigin",s.horizontalOrigin,h,f,u),iu(kt,o,"verticalOrigin",s.verticalOrigin,h,f,u),iu(yt,o,"heightReference",s.heightReference,h,f,u),iu(e,o,"fillColor",s.fillColor,h,f,u),iu(e,o,"outlineColor",s.outlineColor,h,f,u),iu(Number,o,"outlineWidth",s.outlineWidth,h,f,u),iu(ut,o,"translucencyByDistance",s.translucencyByDistance,h,f,u),iu(ut,o,"pixelOffsetScaleByDistance",s.pixelOffsetScaleByDistance,h,f,u),iu(ut,o,"scaleByDistance",s.scaleByDistance,h,f,u),iu(v,o,"distanceDisplayCondition",s.distanceDisplayCondition,h,f,u),iu(Number,o,"disableDepthTestDistance",s.disableDepthTestDistance,h,f,u))}function ke(n,t,i,r){var f=t.model,o,l,u,s,h,a;if(c(f)&&(l=f.interval,c(l)&&(ru.iso8601=l,o=lt.fromIso8601(ru)),u=n.model,c(u)||(n.model=u=new di),iu(Boolean,u,"show",f.show,o,r,i),iu(dt,u,"uri",f.gltf,o,r,i),iu(Number,u,"scale",f.scale,o,r,i),iu(Number,u,"minimumPixelSize",f.minimumPixelSize,o,r,i),iu(Number,u,"maximumScale",f.maximumScale,o,r,i),iu(Boolean,u,"incrementallyLoadTextures",f.incrementallyLoadTextures,o,r,i),iu(Boolean,u,"runAnimations",f.runAnimations,o,r,i),iu(Boolean,u,"clampAnimations",f.clampAnimations,o,r,i),iu(bt,u,"shadows",f.shadows,o,r,i),iu(yt,u,"heightReference",f.heightReference,o,r,i),iu(e,u,"silhouetteColor",f.silhouetteColor,o,r,i),iu(Number,u,"silhouetteSize",f.silhouetteSize,o,r,i),iu(e,u,"color",f.color,o,r,i),iu(vt,u,"colorBlendMode",f.colorBlendMode,o,r,i),iu(Number,u,"colorBlendAmount",f.colorBlendAmount,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i),s=f.nodeTransformations,c(s)))if(d(s))for(h=0,a=s.length;h<a;h++)cf(u,s[h],o,r,i);else cf(u,s,o,r,i)}function cf(n,t,r,u,f){var e,y=t.interval,o,v,a,p,s,l,h;for(c(y)?(ru.iso8601=y,e=lt.fromIso8601(ru),c(r)&&(e=lt.intersect(e,r,lu))):c(r)&&(e=r),o=n.nodeTransformations,v=Object.keys(t),a=0,p=v.length;a<p;++a)(s=v[a],s!=="interval")&&(l=t[s],c(l))&&(c(o)||(n.nodeTransformations=o=new cr),o.hasProperty(s)||o.addProperty(s),h=o[s],c(h)||(o[s]=h=new gi),iu(i,h,"translation",l.translation,e,u,f),iu(ft,h,"rotation",l.rotation,e,u,f),iu(i,h,"scale",l.scale,e,u,f))}function de(n,t,i,r){var f=t.path,e,o,u;c(f)&&(o=f.interval,c(o)&&(ru.iso8601=o,e=lt.fromIso8601(ru)),u=n.path,c(u)||(n.path=u=new nr),iu(Boolean,u,"show",f.show,e,r,i),iu(Number,u,"width",f.width,e,r,i),iu(Number,u,"resolution",f.resolution,e,r,i),iu(Number,u,"leadTime",f.leadTime,e,r,i),iu(Number,u,"trailTime",f.trailTime,e,r,i),su(u,"material",f.material,e,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,e,r,i))}function ge(n,t,i,r){var f=t.point,o,s,u;c(f)&&(s=f.interval,c(s)&&(ru.iso8601=s,o=lt.fromIso8601(ru)),u=n.point,c(u)||(n.point=u=new tr),iu(Boolean,u,"show",f.show,o,r,i),iu(Number,u,"pixelSize",f.pixelSize,o,r,i),iu(yt,u,"heightReference",f.heightReference,o,r,i),iu(e,u,"color",f.color,o,r,i),iu(e,u,"outlineColor",f.outlineColor,o,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,o,r,i),iu(ut,u,"scaleByDistance",f.scaleByDistance,o,r,i),iu(ut,u,"translucencyByDistance",f.translucencyByDistance,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i),iu(Number,u,"disableDepthTestDistance",f.disableDepthTestDistance,o,r,i))}function no(n,t,i,r){var f=t.polygon,o,s,u;c(f)&&(s=f.interval,c(s)&&(ru.iso8601=s,o=lt.fromIso8601(ru)),u=n.polygon,c(u)||(n.polygon=u=new ir),iu(Boolean,u,"show",f.show,o,r,i),pu(u,"hierarchy",f.positions,i),iu(Number,u,"height",f.height,o,r,i),iu(Number,u,"extrudedHeight",f.extrudedHeight,o,r,i),iu(vr,u,"stRotation",f.stRotation,o,r,i),iu(Number,u,"granularity",f.granularity,o,r,i),iu(Boolean,u,"fill",f.fill,o,r,i),su(u,"material",f.material,o,r,i),iu(Boolean,u,"outline",f.outline,o,r,i),iu(e,u,"outlineColor",f.outlineColor,o,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,o,r,i),iu(Boolean,u,"perPositionHeight",f.perPositionHeight,o,r,i),iu(Boolean,u,"closeTop",f.closeTop,o,r,i),iu(Boolean,u,"closeBottom",f.closeBottom,o,r,i),iu(bt,u,"shadows",f.shadows,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i),iu(Number,u,"zIndex",f.zIndex,o,r,i))}function to(n,t,i,r){var f=t.polyline,e,o,u;c(f)&&(o=f.interval,c(o)&&(ru.iso8601=o,e=lt.fromIso8601(ru)),u=n.polyline,c(u)||(n.polyline=u=new er),iu(Boolean,u,"show",f.show,e,r,i),pu(u,"positions",f.positions,i),iu(Number,u,"width",f.width,e,r,i),iu(Number,u,"granularity",f.granularity,e,r,i),su(u,"material",f.material,e,r,i),su(u,"depthFailMaterial",f.depthFailMaterial,e,r,i),iu(Boolean,u,"followSurface",f.followSurface,e,r,i),iu(Boolean,u,"clampToGround",f.clampToGround,e,r,i),iu(bt,u,"shadows",f.shadows,e,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,e,r,i),iu(Number,u,"zIndex",f.zIndex,e,r,i))}function io(n,t,i,r){var f=t.rectangle,o,s,u;c(f)&&(s=f.interval,c(s)&&(ru.iso8601=s,o=lt.fromIso8601(ru)),u=n.rectangle,c(u)||(n.rectangle=u=new lr),iu(Boolean,u,"show",f.show,o,r,i),iu(et,u,"coordinates",f.coordinates,o,r,i),iu(Number,u,"height",f.height,o,r,i),iu(Number,u,"extrudedHeight",f.extrudedHeight,o,r,i),iu(vr,u,"rotation",f.rotation,o,r,i),iu(vr,u,"stRotation",f.stRotation,o,r,i),iu(Number,u,"granularity",f.granularity,o,r,i),iu(Boolean,u,"fill",f.fill,o,r,i),su(u,"material",f.material,o,r,i),iu(Boolean,u,"outline",f.outline,o,r,i),iu(e,u,"outlineColor",f.outlineColor,o,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,o,r,i),iu(bt,u,"shadows",f.shadows,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i),iu(Number,u,"zIndex",f.zIndex,o,r,i))}function ro(n,t,i,r){var f=t.wall,o,s,u;c(f)&&(s=f.interval,c(s)&&(ru.iso8601=s,o=lt.fromIso8601(ru)),u=n.wall,c(u)||(n.wall=u=new tu),iu(Boolean,u,"show",f.show,o,r,i),pu(u,"positions",f.positions,i),sf(u,"minimumHeights",f.minimumHeights,i),sf(u,"maximumHeights",f.maximumHeights,i),iu(Number,u,"granularity",f.granularity,o,r,i),iu(Boolean,u,"fill",f.fill,o,r,i),su(u,"material",f.material,o,r,i),iu(Boolean,u,"outline",f.outline,o,r,i),iu(e,u,"outlineColor",f.outlineColor,o,r,i),iu(Number,u,"outlineWidth",f.outlineWidth,o,r,i),iu(bt,u,"shadows",f.shadows,o,r,i),iu(v,u,"distanceDisplayCondition",f.distanceDisplayCondition,o,r,i))}function lf(n,t,i,r,u){var f=n.id,o,h,e;if(c(f)||(f=s()),wu=f,!c(u._version)&&f!=="document")throw new ht("The first CZML packet is required to be the document object.");if(n["delete"]===!0)t.removeById(f);else if(f==="document")ye(n,u);else for(o=t.getOrCreateEntity(f),h=n.parent,c(h)&&(o.parent=t.getOrCreateEntity(h)),e=i.length-1;e>-1;e--)i[e](o,n,t,r);wu=undefined}function uo(n){var t,i=n._documentPacket.clock,r,o;if(!c(i)){if(!c(n._clock)&&(r=n._entityCollection.computeAvailability(),!r.start.equals(g.MINIMUM_VALUE))){var e=r.start,s=r.stop,l=nt.secondsDifference(s,e),a=Math.round(l/120);return t=new li,t.startTime=nt.clone(e),t.stopTime=nt.clone(s),t.clockRange=u.LOOP_STOP,t.multiplier=a,t.currentTime=nt.clone(e),t.clockStep=f.SYSTEM_CLOCK_MULTIPLIER,n._clock=t,!0}return!1}return(c(n._clock)?t=n._clock.clone():(t=new li,t.startTime=g.MINIMUM_VALUE.clone(),t.stopTime=g.MAXIMUM_VALUE.clone(),t.currentTime=g.MINIMUM_VALUE.clone(),t.clockRange=u.LOOP_STOP,t.clockStep=f.SYSTEM_CLOCK_MULTIPLIER,t.multiplier=1),c(i.interval)&&(ru.iso8601=i.interval,o=lt.fromIso8601(ru),t.startTime=o.start,t.stopTime=o.stop),c(i.currentTime)&&(t.currentTime=nt.fromIso8601(i.currentTime)),c(i.range)&&(t.clockRange=h(u[i.range],u.LOOP_STOP)),c(i.step)&&(t.clockStep=h(f[i.step],f.SYSTEM_CLOCK_MULTIPLIER)),c(i.multiplier)&&(t.multiplier=i.multiplier),!t.equals(n._clock))?(n._clock=t.clone(n._clock),!0):!1}function af(n,t,i,r){if(!c(t))throw new a("czml is required.");i=h(i,h.EMPTY_OBJECT);var f=t,u=i.sourceUri;return(typeof t=="string"||t instanceof st)&&(t=st.createIfNeeded(t),f=t.fetchJson(),u=h(u,t.clone())),u=st.createIfNeeded(u),ci.setLoading(n,!0),gt(f,function(t){return fo(n,t,u,r)}).otherwise(function(t){return ci.setLoading(n,!1),n._error.raiseEvent(n,t),console.log(t),gt.reject(t)})}function fo(n,t,i,r){var e,u,f;return ci.setLoading(n,!0),e=n._entityCollection,r&&(n._version=undefined,n._documentPacket=new vf,e.removeAll()),ou._processCzml(t,e,i,undefined,n),u=uo(n),f=n._documentPacket,c(f.name)&&n._name!==f.name?(n._name=f.name,u=!0):!c(n._name)&&c(i)&&(n._name=b(i.getUrlComponent()),u=!0),ci.setLoading(n,!1),u&&n._changed.raiseEvent(n),n}function vf(){this.name=undefined;this.clock=undefined}function ou(n){this._name=n;this._changed=new p;this._error=new p;this._isLoading=!1;this._loading=new p;this._clock=undefined;this._documentPacket=new vf;this._version=undefined;this._entityCollection=new pi(this);this._entityCluster=new yi}var wu,rf,ru;hu.packedLength=i.packedLength;hu.unpack=i.unpack;hu.pack=i.pack;var uu=new i,eu=new ct,fu=new r,lu=new lt,au=new ft;return rf={HERMITE:k,LAGRANGE:tt,LINEAR:it},ru={iso8601:undefined},ou.load=function(n,t){return(new ou).load(n,t)},l(ou.prototype,{name:{get:function(){return this._name}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(n){this._entityCollection.show=n}},clustering:{get:function(){return this._entityCluster},set:function(n){if(!c(n))throw new a("value must be defined.");this._entityCluster=n}}}),ou.updaters=[ce,le,ae,ve,pe,we,be,ke,ie,re,de,ge,no,to,oe,io,ue,fe,ro,ee,se],ou.prototype.process=function(n,t){return af(this,n,t,!1)},ou.prototype.load=function(n,t){return af(this,n,t,!0)},ou.processPacketData=iu,ou.processPositionPacketData=ff,ou.processMaterialPacketData=su,ou._processCzml=function(n,t,i,r,u){if(r=c(r)?r:ou.updaters,d(n))for(var f=0,e=n.length;f<e;f++)lf(n[f],t,r,i,u);else lf(n,t,r,i,u)},ou});t("DataSources/DataSourceCollection",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Core/Math","../ThirdParty/when"],function(n,t,i,r,u,f,e,o){"use strict";function s(){this._dataSources=[];this._dataSourceAdded=new f;this._dataSourceRemoved=new f;this._dataSourceMoved=new f}function h(n,i){if(!t(i))throw new u("dataSource is required.");var r=n.indexOf(i);if(r===-1)throw new u("dataSource is not in this collection.");return r}function c(n,t,i){var r=n._dataSources,f=r.length-1,u;(t=e.clamp(t,0,f),i=e.clamp(i,0,f),t!==i)&&(u=r[t],r[t]=r[i],r[i]=u,n.dataSourceMoved.raiseEvent(u,i,t))}return i(s.prototype,{length:{get:function(){return this._dataSources.length}},dataSourceAdded:{get:function(){return this._dataSourceAdded}},dataSourceRemoved:{get:function(){return this._dataSourceRemoved}},dataSourceMoved:{get:function(){return this._dataSourceMoved}}}),s.prototype.add=function(n){if(!t(n))throw new u("dataSource is required.");var i=this,r=this._dataSources;return o(n,function(n){return r===i._dataSources&&(i._dataSources.push(n),i._dataSourceAdded.raiseEvent(i,n)),n})},s.prototype.remove=function(t,i){i=n(i,!1);var r=this._dataSources.indexOf(t);return r!==-1?(this._dataSources.splice(r,1),this._dataSourceRemoved.raiseEvent(this,t),i&&typeof t.destroy=="function"&&t.destroy(),!0):!1},s.prototype.removeAll=function(t){var u,i,f,r;for(t=n(t,!1),u=this._dataSources,i=0,f=u.length;i<f;++i)r=u[i],this._dataSourceRemoved.raiseEvent(this,r),t&&typeof r.destroy=="function"&&r.destroy();this._dataSources=[]},s.prototype.contains=function(n){return this.indexOf(n)!==-1},s.prototype.indexOf=function(n){return this._dataSources.indexOf(n)},s.prototype.get=function(n){if(!t(n))throw new u("index is required.");return this._dataSources[n]},s.prototype.raise=function(n){var t=h(this._dataSources,n);c(this,t,t+1)},s.prototype.lower=function(n){var t=h(this._dataSources,n);c(this,t,t-1)},s.prototype.raiseToTop=function(n){var t=h(this._dataSources,n);t!==this._dataSources.length-1&&(this._dataSources.splice(t,1),this._dataSources.push(n),this.dataSourceMoved.raiseEvent(n,this._dataSources.length-1,t))},s.prototype.lowerToBottom=function(n){var t=h(this._dataSources,n);t!==0&&(this._dataSources.splice(t,1),this._dataSources.splice(0,0,n),this.dataSourceMoved.raiseEvent(n,0,t))},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this.removeAll(!0),r(this)},s});t("Scene/PrimitiveCollection",["../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError"],function(n,t,i,r,u,f){"use strict";function e(i){i=t(i,t.EMPTY_OBJECT);this._primitives=[];this._guid=n();this._zIndex=undefined;this.show=t(i.show,!0);this.destroyPrimitives=t(i.destroyPrimitives,!0)}function o(n,t){if(!n.contains(t))throw new f("primitive is not in this collection.");return n._primitives.indexOf(t)}return r(e.prototype,{length:{get:function(){return this._primitives.length}}}),e.prototype.add=function(n){if(!i(n))throw new f("primitive is required.");var t=n._external=n._external||{},r=t._composites=t._composites||{};return r[this._guid]={collection:this},this._primitives.push(n),n},e.prototype.remove=function(n){if(this.contains(n)){var t=this._primitives.indexOf(n);if(t!==-1)return this._primitives.splice(t,1),delete n._external._composites[this._guid],this.destroyPrimitives&&n.destroy(),!0}return!1},e.prototype.removeAndDestroy=function(n){var t=this.remove(n);return t&&!this.destroyPrimitives&&n.destroy(),t},e.prototype.removeAll=function(){var t,i,n;if(this.destroyPrimitives)for(t=this._primitives,i=t.length,n=0;n<i;++n)t[n].destroy();this._primitives=[]},e.prototype.contains=function(n){return!!(i(n)&&n._external&&n._external._composites&&n._external._composites[this._guid])},e.prototype.raise=function(n){var t,r,u;i(n)&&(t=o(this,n),r=this._primitives,t!==r.length-1&&(u=r[t],r[t]=r[t+1],r[t+1]=u))},e.prototype.raiseToTop=function(n){if(i(n)){var r=o(this,n),t=this._primitives;r!==t.length-1&&(t.splice(r,1),t.push(n))}},e.prototype.lower=function(n){var t,r,u;i(n)&&(t=o(this,n),r=this._primitives,t!==0&&(u=r[t],r[t]=r[t-1],r[t-1]=u))},e.prototype.lowerToBottom=function(n){if(i(n)){var t=o(this,n),r=this._primitives;t!==0&&(r.splice(t,1),r.unshift(n))}},e.prototype.get=function(n){if(!i(n))throw new f("index is required.");return this._primitives[n]},e.prototype.update=function(n){var i,t;if(this.show)for(i=this._primitives,t=0;t<i.length;++t)i[t].update(n)},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this.removeAll(),u(this)},e});t("Scene/OrderedGroundPrimitiveCollection",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Check","../Core/DeveloperError","./PrimitiveCollection"],function(n,t,i,r,u,f,e){"use strict";function o(){this._length=0;this._collections={};this._collectionsArray=[];this.show=!0}return i(o.prototype,{length:{get:function(){return this._length}}}),o.prototype.add=function(i,r){var f,s,o;if(u.defined("primitive",i),t(r)&&u.typeOf.number("zIndex",r),r=n(r,0),f=this._collections[r],!t(f)){for(f=new e({destroyPrimitives:!1}),f._zIndex=r,this._collections[r]=f,s=this._collectionsArray,o=0;o<s.length&&s[o]._zIndex<r;)o++;s.splice(o,0,f)}return f.add(i),this._length++,i._zIndex=r,i},o.prototype.set=function(n,t){return(u.defined("primitive",n),u.typeOf.number("zIndex",t),t===n._zIndex)?n:(this.remove(n,!0),this.add(n,t),n)},o.prototype.remove=function(n,t){if(this.contains(n)){var u=n._zIndex,i=this._collections[u],r;return r=t?i.remove(n):i.removeAndDestroy(n),r&&this._length--,i.length===0&&(this._collectionsArray.splice(this._collectionsArray.indexOf(i),1),this._collections[u]=undefined,i.destroy()),r}return!1},o.prototype.removeAll=function(){for(var t,i=this._collectionsArray,n=0;n<i.length;n++)t=i[n],t.destroyPrimitives=!0,t.destroy();this._collections={};this._collectionsArray=[];this._length=0},o.prototype.contains=function(n){if(!t(n))return!1;var i=this._collections[n._zIndex];return t(i)&&i.contains(n)},o.prototype.update=function(n){var i,t;if(this.show)for(i=this._collectionsArray,t=0;t<i.length;t++)i[t].update(n)},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return this.removeAll(),r(this)},o});t("DataSources/DynamicGeometryBatch",["../Core/AssociativeArray","../Core/defined","./BoundingSphereState"],function(n,t,i){"use strict";function r(t,i){this._primitives=t;this._orderedGroundPrimitives=i;this._dynamicUpdaters=new n}return r.prototype.add=function(n,t){this._dynamicUpdaters.set(t.id,t.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))},r.prototype.remove=function(n){var i=n.id,r=this._dynamicUpdaters.get(i);t(r)&&(this._dynamicUpdaters.remove(i),r.destroy())},r.prototype.update=function(n){for(var i=this._dynamicUpdaters.values,t=0,r=i.length;t<r;t++)i[t].update(n);return!0},r.prototype.removeAllPrimitives=function(){for(var t=this._dynamicUpdaters.values,n=0,i=t.length;n<i;n++)t[n].destroy();this._dynamicUpdaters.removeAll()},r.prototype.getBoundingSphere=function(n,r){return(n=this._dynamicUpdaters.get(n.id),t(n)&&t(n.getBoundingSphere))?n.getBoundingSphere(r):i.FAILED},r});t("DataSources/EllipseGeometryUpdater",["../Core/ApproximateTerrainHeights","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/EllipseGeometry","../Core/EllipseOutlineGeometry","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/Rectangle","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./GroundGeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){"use strict";function ct(n){this.id=n;this.vertexFormat=undefined;this.center=undefined;this.semiMajorAxis=undefined;this.semiMinorAxis=undefined;this.rotation=undefined;this.height=undefined;this.extrudedHeight=undefined;this.granularity=undefined;this.stRotation=undefined;this.numberOfVerticalLines=undefined;this.offsetAttribute=undefined}function ut(n,t){it.call(this,{entity:n,scene:t,geometryOptions:new ct(n),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]});this._onEntityPropertyChanged(n,"ellipse",n.ellipse,undefined)}function ft(n,t,i){nt.call(this,n,t,i)}var et=new r,ot=t.ZERO,st=new t,ht=new y;return f(Object.create)&&(ut.prototype=Object.create(it.prototype),ut.prototype.constructor=ut),ut.prototype.createFillGeometryInstance=function(n){var t;if(i.defined("time",n),!this._fillEnabled)throw new e("This instance does not represent a filled geometry.");var h=this._entity,a=h.isAvailable(n),l={show:new p(a&&h.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),distanceDisplayCondition:o.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(n)),offset:undefined,color:undefined};return this._materialProperty instanceof g&&(f(this._materialProperty.color)&&(this._materialProperty.color.isConstant||a)&&(t=this._materialProperty.color.getValue(n,et)),f(t)||(t=r.WHITE),l.color=u.fromColor(t)),f(this._options.offsetAttribute)&&(l.offset=v.fromCartesian3(rt.getValueOrDefault(this._terrainOffsetProperty,n,ot,st))),new c({id:h,geometry:new s(this._options),attributes:l})},ut.prototype.createOutlineGeometryInstance=function(n){if(i.defined("time",n),!this._outlineEnabled)throw new e("This instance does not represent an outlined geometry.");var t=this._entity,l=t.isAvailable(n),a=rt.getValueOrDefault(this._outlineColorProperty,n,r.BLACK,et),y=this._distanceDisplayConditionProperty.getValue(n),s={show:new p(l&&t.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:u.fromColor(a),distanceDisplayCondition:o.fromDistanceDisplayCondition(y),offset:undefined};return f(this._options.offsetAttribute)&&(s.offset=v.fromCartesian3(rt.getValueOrDefault(this._terrainOffsetProperty,n,ot,st))),new c({id:t,geometry:new h(this._options),attributes:s})},ut.prototype._computeCenter=function(n,t){return rt.getValueOrUndefined(this._entity.position,n,t)},ut.prototype._isHidden=function(n,t){var i=n.position;return!f(i)||!f(t.semiMajorAxis)||!f(t.semiMinorAxis)||tt.prototype._isHidden.call(this,n,t)},ut.prototype._isOnTerrain=function(n,t){return this._fillEnabled&&!f(t.height)&&!f(t.extrudedHeight)&&w.isSupported(this._scene)},ut.prototype._isDynamic=function(n,t){return!n.position.isConstant||!t.semiMajorAxis.isConstant||!t.semiMinorAxis.isConstant||!rt.isConstant(t.rotation)||!rt.isConstant(t.height)||!rt.isConstant(t.extrudedHeight)||!rt.isConstant(t.granularity)||!rt.isConstant(t.stRotation)||!rt.isConstant(t.outlineWidth)||!rt.isConstant(t.numberOfVerticalLines)||!rt.isConstant(t.zIndex)||this._onTerrain&&!rt.isConstant(this._materialProperty)},ut.prototype._getIsClosed=function(n){var t=n.height,i=n.extrudedHeight;return t===0||f(i)&&i!==t},ut.prototype._setStaticOptions=function(t,i){var o=i.height,f=i.heightReference,h=i.extrudedHeight,e=i.extrudedHeightReference,r=this._options,u;r.vertexFormat=this._materialProperty instanceof g?d.VERTEX_FORMAT:k.MaterialSupport.TEXTURED.vertexFormat;r.center=t.position.getValue(a.MINIMUM_VALUE,r.center);r.semiMajorAxis=i.semiMajorAxis.getValue(a.MINIMUM_VALUE,r.semiMajorAxis);r.semiMinorAxis=i.semiMinorAxis.getValue(a.MINIMUM_VALUE,r.semiMinorAxis);r.rotation=rt.getValueOrUndefined(i.rotation,a.MINIMUM_VALUE);r.granularity=rt.getValueOrUndefined(i.granularity,a.MINIMUM_VALUE);r.stRotation=rt.getValueOrUndefined(i.stRotation,a.MINIMUM_VALUE);r.numberOfVerticalLines=rt.getValueOrUndefined(i.numberOfVerticalLines,a.MINIMUM_VALUE);r.offsetAttribute=it.computeGeometryOffsetAttribute(f,e,a.MINIMUM_VALUE);r.height=it.getGeometryHeight(o,f,a.MINIMUM_VALUE);u=it.getGeometryExtrudedHeight(h,e,a.MINIMUM_VALUE);u===it.CLAMP_TO_GROUND&&(u=n.getApproximateTerrainHeights(s.computeRectangle(r,ht)).minimumTerrainHeight);r.extrudedHeight=u},ut.DynamicGeometryUpdater=ft,f(Object.create)&&(ft.prototype=Object.create(nt.prototype),ft.prototype.constructor=ft),ft.prototype._isHidden=function(n,t,i){var r=this._options;return!f(r.center)||!f(r.semiMajorAxis)||!f(r.semiMinorAxis)||nt.prototype._isHidden.call(this,n,t,i)},ft.prototype._setOptions=function(t,i,r){var u=this._options,h=i.height,e=i.heightReference,c=i.extrudedHeight,o=i.extrudedHeightReference,f;u.center=rt.getValueOrUndefined(t.position,r,u.center);u.semiMajorAxis=rt.getValueOrUndefined(i.semiMajorAxis,r);u.semiMinorAxis=rt.getValueOrUndefined(i.semiMinorAxis,r);u.rotation=rt.getValueOrUndefined(i.rotation,r);u.granularity=rt.getValueOrUndefined(i.granularity,r);u.stRotation=rt.getValueOrUndefined(i.stRotation,r);u.numberOfVerticalLines=rt.getValueOrUndefined(i.numberOfVerticalLines,r);u.offsetAttribute=it.computeGeometryOffsetAttribute(e,o,r);u.height=it.getGeometryHeight(h,e,r);f=it.getGeometryExtrudedHeight(c,o,r);f===it.CLAMP_TO_GROUND&&(f=n.getApproximateTerrainHeights(s.computeRectangle(u,ht)).minimumTerrainHeight);u.extrudedHeight=f},ut});t("DataSources/EllipsoidGeometryUpdater",["../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/EllipsoidGeometry","../Core/EllipsoidOutlineGeometry","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/Matrix4","../Core/ShowGeometryInstanceAttribute","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","../Scene/Primitive","../Scene/SceneMode","./heightReferenceOnEntityPropertyChanged","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et){"use strict";function pt(n){this.id=n;this.vertexFormat=undefined;this.radii=undefined;this.stackPartitions=undefined;this.slicePartitions=undefined;this.subdivisions=undefined;this.offsetAttribute=undefined}function ot(n,t){ut.call(this,{entity:n,scene:t,geometryOptions:new pt(n),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]});this._onEntityPropertyChanged(n,"ellipsoid",n.ellipsoid,undefined)}function st(t,i,r){rt.call(this,t,i,r);this._scene=t._scene;this._modelMatrix=new p;this._attributes=undefined;this._outlineAttributes=undefined;this._lastSceneMode=undefined;this._lastShow=undefined;this._lastOutlineShow=undefined;this._lastOutlineWidth=undefined;this._lastOutlineColor=undefined;this._lastOffset=new n;this._material={}}var at=new it(i.WHITE),ht=n.ZERO,ct=new n,vt=new n,lt=new i,yt=new n(1,1,1);return f(Object.create)&&(ot.prototype=Object.create(ut.prototype),ot.prototype.constructor=ot),e(ot.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}}),ot.prototype.createFillGeometryInstance=function(n,u,e){var c;t.defined("time",n);var o=this._entity,v=o.isAvailable(n),p,b=new w(v&&o.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),k=this._distanceDisplayConditionProperty.getValue(n),d=s.fromDistanceDisplayCondition(k),a={show:b,distanceDisplayCondition:d,color:undefined,offset:undefined};return this._materialProperty instanceof it&&(f(this._materialProperty.color)&&(this._materialProperty.color.isConstant||v)&&(c=this._materialProperty.color.getValue(n,lt)),f(c)||(c=i.WHITE),p=r.fromColor(c),a.color=p),f(this._options.offsetAttribute)&&(a.offset=y.fromCartesian3(et.getValueOrDefault(this._terrainOffsetProperty,n,ht,ct))),new l({id:o,geometry:new h(this._options),modelMatrix:u?undefined:o.computeModelMatrixForHeightReference(n,o.ellipsoid.heightReference,this._options.radii.z*.5,this._scene.mapProjection.ellipsoid,e),attributes:a})},ot.prototype.createOutlineGeometryInstance=function(n,u,e){t.defined("time",n);var o=this._entity,a=o.isAvailable(n),v=et.getValueOrDefault(this._outlineColorProperty,n,i.BLACK,lt),p=this._distanceDisplayConditionProperty.getValue(n),h={show:new w(a&&o.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:r.fromColor(v),distanceDisplayCondition:s.fromDistanceDisplayCondition(p),offset:undefined};return f(this._options.offsetAttribute)&&(h.offset=y.fromCartesian3(et.getValueOrDefault(this._terrainOffsetProperty,n,ht,ct))),new l({id:o,geometry:new c(this._options),modelMatrix:u?undefined:o.computeModelMatrixForHeightReference(n,o.ellipsoid.heightReference,this._options.radii.z*.5,this._scene.mapProjection.ellipsoid,e),attributes:h})},ot.prototype._computeCenter=function(n,t){return et.getValueOrUndefined(this._entity.position,n,t)},ot.prototype._isHidden=function(n,t){return!f(n.position)||!f(t.radii)||ut.prototype._isHidden.call(this,n,t)},ot.prototype._isDynamic=function(n,t){return!n.position.isConstant||!et.isConstant(n.orientation)||!t.radii.isConstant||!et.isConstant(t.stackPartitions)||!et.isConstant(t.slicePartitions)||!et.isConstant(t.outlineWidth)||!et.isConstant(t.subdivisions)},ot.prototype._setStaticOptions=function(n,t){var r=et.getValueOrDefault(t.heightReference,v.MINIMUM_VALUE,b.NONE),i=this._options;i.vertexFormat=this._materialProperty instanceof it?d.VERTEX_FORMAT:k.MaterialSupport.TEXTURED.vertexFormat;i.radii=t.radii.getValue(v.MINIMUM_VALUE,i.radii);i.stackPartitions=et.getValueOrUndefined(t.stackPartitions,v.MINIMUM_VALUE);i.slicePartitions=et.getValueOrUndefined(t.slicePartitions,v.MINIMUM_VALUE);i.subdivisions=et.getValueOrUndefined(t.subdivisions,v.MINIMUM_VALUE);i.offsetAttribute=r!==b.NONE?a.ALL:undefined},ot.prototype._onEntityPropertyChanged=tt,ot.DynamicGeometryUpdater=st,f(Object.create)&&(st.prototype=Object.create(rt.prototype),st.prototype.constructor=st),st.prototype.update=function(e){var it,h,c,rt,pt,ii,li,ri,dt,ui,l,v;if(t.defined("time",e),it=this._entity,h=it.ellipsoid,!it.isShowing||!it.isAvailable(e)||!et.getValueOrDefault(h.show,e,!0)){f(this._primitive)&&(this._primitive.show=!1);f(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1);return}if(c=et.getValueOrUndefined(h.radii,e,vt),rt=f(c)?it.computeModelMatrixForHeightReference(e,h.heightReference,c.z*.5,this._scene.mapProjection.ellipsoid,this._modelMatrix):undefined,!f(rt)||!f(c)){f(this._primitive)&&(this._primitive.show=!1);f(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1);return}var wt=et.getValueOrDefault(h.fill,e,!0),bt=et.getValueOrDefault(h.outline,e,!1),kt=et.getValueOrClonedDefault(h.outlineColor,e,i.BLACK,lt),gt=ft.getValue(e,u(h.material,at),this._material),fi=et.getValueOrUndefined(h.stackPartitions,e),ei=et.getValueOrUndefined(h.slicePartitions,e),oi=et.getValueOrUndefined(h.subdivisions,e),ni=et.getValueOrDefault(h.outlineWidth,e,1),si=et.getValueOrDefault(h.heightReference,e,b.NONE),hi=si!==b.NONE?a.ALL:undefined,ti=this._scene.mode,ut=ti===nt.SCENE3D&&si===b.NONE,tt=this._options,ci=this._geometryUpdater.shadowsProperty.getValue(e),ai=this._geometryUpdater.distanceDisplayConditionProperty,ot=ai.getValue(e),st=et.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,e,ht,ct),vi=!ut||this._lastSceneMode!==ti||!f(this._primitive)||tt.stackPartitions!==fi||tt.slicePartitions!==ei||tt.subdivisions!==oi||this._lastOutlineWidth!==ni||tt.offsetAttribute!==hi;vi?(pt=this._primitives,pt.removeAndDestroy(this._primitive),pt.removeAndDestroy(this._outlinePrimitive),this._primitive=undefined,this._outlinePrimitive=undefined,this._lastSceneMode=ti,this._lastOutlineWidth=ni,tt.stackPartitions=fi,tt.slicePartitions=ei,tt.subdivisions=oi,tt.offsetAttribute=hi,tt.radii=ut?yt:c,ii=new k({material:gt,translucent:gt.isTranslucent(),closed:!0}),tt.vertexFormat=ii.vertexFormat,li=this._geometryUpdater.createFillGeometryInstance(e,ut,this._modelMatrix),this._primitive=pt.add(new g({geometryInstances:li,appearance:ii,asynchronous:!1,shadows:ci})),ri=this._geometryUpdater.createOutlineGeometryInstance(e,ut,this._modelMatrix),this._outlinePrimitive=pt.add(new g({geometryInstances:ri,appearance:new d({flat:!0,translucent:ri.attributes.color.value[3]!==255,renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(ni)}}),asynchronous:!1,shadows:ci})),this._lastShow=wt,this._lastOutlineShow=bt,this._lastOutlineColor=i.clone(kt,this._lastOutlineColor),this._lastDistanceDisplayCondition=ot,this._lastOffset=n.clone(st,this._lastOffset)):this._primitive.ready&&(dt=this._primitive,ui=this._outlinePrimitive,dt.show=!0,ui.show=!0,dt.appearance.material=gt,l=this._attributes,f(l)||(l=dt.getGeometryInstanceAttributes(it),this._attributes=l),wt!==this._lastShow&&(l.show=w.toValue(wt,l.show),this._lastShow=wt),v=this._outlineAttributes,f(v)||(v=ui.getGeometryInstanceAttributes(it),this._outlineAttributes=v),bt!==this._lastOutlineShow&&(v.show=w.toValue(bt,v.show),this._lastOutlineShow=bt),i.equals(kt,this._lastOutlineColor)||(v.color=r.toValue(kt,v.color),i.clone(kt,this._lastOutlineColor)),o.equals(ot,this._lastDistanceDisplayCondition)||(l.distanceDisplayCondition=s.toValue(ot,l.distanceDisplayCondition),v.distanceDisplayCondition=s.toValue(ot,v.distanceDisplayCondition),o.clone(ot,this._lastDistanceDisplayCondition)),n.equals(st,this._lastOffset)||(l.offset=y.toValue(st,l.offset),v.offset=y.toValue(st,l.offset),n.clone(st,this._lastOffset)));ut&&(c.x=Math.max(c.x,.001),c.y=Math.max(c.y,.001),c.z=Math.max(c.z,.001),rt=p.multiplyByScale(rt,c,rt),this._primitive.modelMatrix=rt,this._outlinePrimitive.modelMatrix=rt)},ot});t("DataSources/PlaneGeometryUpdater",["../Core/Cartesian2","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/Iso8601","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/PlaneGeometry","../Core/PlaneOutlineGeometry","../Core/Quaternion","../Core/ShowGeometryInstanceAttribute","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function ot(n){this.id=n;this.vertexFormat=undefined;this.plane=undefined;this.dimensions=undefined}function it(n,t){nt.call(this,{entity:n,scene:t,geometryOptions:new ot(n),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]});this._onEntityPropertyChanged(n,"plane",n.plane,undefined)}function rt(n,t,i){g.call(this,n,t,i)}function ut(i,r,u,f,e){var b=i.normal,d=i.distance,v=t.multiplyByScalar(b,-d,ct),h,o,y,s,k,w;return v=a.multiplyByPoint(u,v,v),h=a.multiplyByPointAsVector(u,b,lt),t.normalize(h,h),o=f.geodeticSurfaceNormal(v,ht),c.equalsEpsilon(Math.abs(t.dot(o,h)),1,c.EPSILON8)&&(o=t.clone(t.UNIT_Z,o)),y=t.cross(o,h,st),o=t.cross(h,y,o),t.normalize(y,y),t.normalize(o,o),s=yt,l.setColumn(s,0,y,s),l.setColumn(s,1,o,s),l.setColumn(s,2,h,s),k=p.fromRotationMatrix(s,vt),w=n.clone(r,at),w.z=1,a.fromTranslationQuaternionRotationScale(v,k,w,e)}var et=new t,ft=new r;f(Object.create)&&(it.prototype=Object.create(nt.prototype),it.prototype.constructor=it);it.prototype.createFillGeometryInstance=function(n){var h;if(i.defined("time",n),!this._fillEnabled)throw new e("This instance does not represent a filled geometry.");var t=this._entity,y=t.isAvailable(n),a,p,b=new w(y&&t.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),rt=this._distanceDisplayConditionProperty.getValue(n),k=o.fromDistanceDisplayCondition(rt);this._materialProperty instanceof d?(f(this._materialProperty.color)&&(this._materialProperty.color.isConstant||y)&&(h=this._materialProperty.color.getValue(n,ft)),f(h)||(h=r.WHITE),p=u.fromColor(h),a={show:b,distanceDisplayCondition:k,color:p}):a={show:b,distanceDisplayCondition:k};var g=t.plane,c=this._options,l=t.computeModelMatrix(n),nt=tt.getValueOrDefault(g.plane,n,c.plane),it=tt.getValueOrUndefined(g.dimensions,n,c.dimensions);return c.plane=nt,c.dimensions=it,l=ut(nt,it,l,this._scene.mapProjection.ellipsoid,l),new s({id:t,geometry:new v(this._options),modelMatrix:l,attributes:a})};it.prototype.createOutlineGeometryInstance=function(n){if(i.defined("time",n),!this._outlineEnabled)throw new e("This instance does not represent an outlined geometry.");var t=this._entity,v=t.isAvailable(n),p=tt.getValueOrDefault(this._outlineColorProperty,n,r.BLACK,ft),b=this._distanceDisplayConditionProperty.getValue(n),c=t.plane,f=this._options,h=t.computeModelMatrix(n),l=tt.getValueOrDefault(c.plane,n,f.plane),a=tt.getValueOrUndefined(c.dimensions,n,f.dimensions);return f.plane=l,f.dimensions=a,h=ut(l,a,h,this._scene.mapProjection.ellipsoid,h),new s({id:t,geometry:new y,modelMatrix:h,attributes:{show:new w(v&&t.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:u.fromColor(p),distanceDisplayCondition:o.fromDistanceDisplayCondition(b)}})};it.prototype._isHidden=function(n,t){return!f(t.plane)||!f(t.dimensions)||!f(n.position)||nt.prototype._isHidden.call(this,n,t)};it.prototype._getIsClosed=function(){return!1};it.prototype._isDynamic=function(n,t){return!n.position.isConstant||!tt.isConstant(n.orientation)||!t.plane.isConstant||!t.dimensions.isConstant||!tt.isConstant(t.outlineWidth)};it.prototype._setStaticOptions=function(n,t){var r=this._materialProperty instanceof d,i=this._options;i.vertexFormat=r?k.VERTEX_FORMAT:b.MaterialSupport.TEXTURED.vertexFormat;i.plane=t.plane.getValue(h.MINIMUM_VALUE,i.plane);i.dimensions=t.dimensions.getValue(h.MINIMUM_VALUE,i.dimensions)};it.DynamicGeometryUpdater=rt;f(Object.create)&&(rt.prototype=Object.create(g.prototype),rt.prototype.constructor=rt);rt.prototype._isHidden=function(n,t,i){var r=this._options,u=tt.getValueOrUndefined(n.position,i,et);return!f(u)||!f(r.plane)||!f(r.dimensions)||g.prototype._isHidden.call(this,n,t,i)};rt.prototype._setOptions=function(n,t,i){var r=this._options;r.plane=tt.getValueOrDefault(t.plane,i,r.plane);r.dimensions=tt.getValueOrUndefined(t.dimensions,i,r.dimensions)};var st=new t,ht=new t,ct=new t,lt=new t,at=new t,vt=new p,yt=new l;return it.createPrimitiveMatrix=ut,it});t("DataSources/PolygonGeometryUpdater",["../Core/ApproximateTerrainHeights","../Core/Cartesian2","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/CoplanarPolygonGeometry","../Core/CoplanarPolygonOutlineGeometry","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/EllipsoidTangentPlane","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/isArray","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/PolygonGeometry","../Core/PolygonHierarchy","../Core/PolygonOutlineGeometry","../Core/Rectangle","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./GroundGeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){"use strict";function kt(n){this.id=n;this.vertexFormat=undefined;this.polygonHierarchy=undefined;this.perPositionHeight=undefined;this.closeTop=undefined;this.closeBottom=undefined;this.height=undefined;this.extrudedHeight=undefined;this.granularity=undefined;this.stRotation=undefined;this.offsetAttribute=undefined}function ct(n,t){st.call(this,{entity:n,scene:t,geometryOptions:new kt(n),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]});this._onEntityPropertyChanged(n,"polygon",n.polygon,undefined)}function lt(n,t,i){et.call(this,n,t,i)}var at=new u,vt=i.ZERO,yt=new i,pt=new g,wt=[],bt=new t;return s(Object.create)&&(ct.prototype=Object.create(st.prototype),ct.prototype.constructor=ct),ct.prototype.createFillGeometryInstance=function(n){var i,y;if(r.defined("time",n),!this._fillEnabled)throw new h("This instance does not represent a filled geometry.");var o=this._entity,v=o.isAvailable(n),t=this._options,l={show:new nt(v&&o.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),distanceDisplayCondition:c.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(n)),offset:undefined,color:undefined};return this._materialProperty instanceof ft&&(s(this._materialProperty.color)&&(this._materialProperty.color.isConstant||v)&&(i=this._materialProperty.color.getValue(n,at)),s(i)||(i=u.WHITE),l.color=f.fromColor(i)),s(t.offsetAttribute)&&(l.offset=w.fromCartesian3(ht.getValueOrDefault(this._terrainOffsetProperty,n,vt,yt))),y=t.perPositionHeight&&!s(t.extrudedHeight)?new e(t):new b(t),new a({id:o,geometry:y,attributes:l})},ct.prototype.createOutlineGeometryInstance=function(n){var l;if(r.defined("time",n),!this._outlineEnabled)throw new h("This instance does not represent an outlined geometry.");var i=this._entity,v=i.isAvailable(n),t=this._options,y=ht.getValueOrDefault(this._outlineColorProperty,n,u.BLACK,at),p=this._distanceDisplayConditionProperty.getValue(n),e={show:new nt(v&&i.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:f.fromColor(y),distanceDisplayCondition:c.fromDistanceDisplayCondition(p),offset:undefined};return s(t.offsetAttribute)&&(e.offset=w.fromCartesian3(ht.getValueOrDefault(this._terrainOffsetProperty,n,vt,yt))),l=t.perPositionHeight&&!s(t.extrudedHeight)?new o(t):new d(t),new a({id:i,geometry:l,attributes:e})},ct.prototype._computeCenter=function(n,i){var r=ht.getValueOrUndefined(this._entity.polygon.hierarchy,n),f,k;if(s(r)&&!y(r)&&(r=r.positions),r.length!==0){var d=this._scene.mapProjection.ellipsoid,a=l.fromPoints(r,d),o=a.projectPointsOntoPlane(r,wt),v=o.length,p=0,w=v-1,u=new t;for(f=0;f<v;w=f++){var h=o[f],c=o[w],b=h.x*c.y-c.x*h.y,e=t.add(h,c,bt);e=t.multiplyByScalar(e,b,e);u=t.add(u,e,u);p+=b}return k=1/(p*3),u=t.multiplyByScalar(u,k,u),a.projectPointOntoEllipsoid(u,i)}},ct.prototype._isHidden=function(n,t){return!s(t.hierarchy)||ot.prototype._isHidden.call(this,n,t)},ct.prototype._isOnTerrain=function(n,t){var i=t.perPositionHeight,r=s(i)&&(i.isConstant?i.getValue(p.MINIMUM_VALUE):!0);return this._fillEnabled&&!s(t.height)&&!s(t.extrudedHeight)&&!r&&tt.isSupported(this._scene)},ct.prototype._isDynamic=function(n,t){return!t.hierarchy.isConstant||!ht.isConstant(t.height)||!ht.isConstant(t.extrudedHeight)||!ht.isConstant(t.granularity)||!ht.isConstant(t.stRotation)||!ht.isConstant(t.outlineWidth)||!ht.isConstant(t.perPositionHeight)||!ht.isConstant(t.closeTop)||!ht.isConstant(t.closeBottom)||!ht.isConstant(t.zIndex)||this._onTerrain&&!ht.isConstant(this._materialProperty)},ct.prototype._setStaticOptions=function(t,i){var a=this._materialProperty instanceof ft,r=this._options,u;r.vertexFormat=a?ut.VERTEX_FORMAT:rt.MaterialSupport.TEXTURED.vertexFormat;u=i.hierarchy.getValue(p.MINIMUM_VALUE);y(u)&&(u=new k(u));var v=i.height,o=i.heightReference,h=i.extrudedHeight,c=i.extrudedHeightReference,e=st.getGeometryHeight(v,o,p.MINIMUM_VALUE),f=ht.getValueOrUndefined(h,p.MINIMUM_VALUE),l=ht.getValueOrUndefined(i.perPositionHeight,p.MINIMUM_VALUE);!s(f)||s(e)||s(l)||(e=0);r.polygonHierarchy=u;r.granularity=ht.getValueOrUndefined(i.granularity,p.MINIMUM_VALUE);r.stRotation=ht.getValueOrUndefined(i.stRotation,p.MINIMUM_VALUE);r.perPositionHeight=l;r.closeTop=ht.getValueOrDefault(i.closeTop,p.MINIMUM_VALUE,!0);r.closeBottom=ht.getValueOrDefault(i.closeBottom,p.MINIMUM_VALUE,!0);r.offsetAttribute=st.computeGeometryOffsetAttribute(o,c,p.MINIMUM_VALUE);r.height=e;f=st.getGeometryExtrudedHeight(h,c,p.MINIMUM_VALUE);f===st.CLAMP_TO_GROUND&&(f=n.getApproximateTerrainHeights(b.computeRectangle(r,pt)).minimumTerrainHeight);r.extrudedHeight=f},ct.prototype._getIsClosed=function(n){var t=n.height,i=n.extrudedHeight,r=s(i)&&i!==t;return!n.perPositionHeight&&(!r&&t===0||r&&n.closeTop&&n.closeBottom)},ct.DynamicGeometryUpdater=lt,s(Object.create)&&(lt.prototype=Object.create(et.prototype),lt.prototype.constructor=lt),lt.prototype._isHidden=function(n,t,i){return!s(this._options.polygonHierarchy)||et.prototype._isHidden.call(this,n,t,i)},lt.prototype._setOptions=function(t,i,r){var u=this._options,a=i.height,h=i.heightReference,c=i.extrudedHeight,l=i.extrudedHeightReference,e=ht.getValueOrUndefined(i.hierarchy,r);u.polygonHierarchy=y(e)?new k(e):e;var o=st.getGeometryHeight(a,h,r),f=ht.getValueOrUndefined(c,r),v=ht.getValueOrUndefined(i.perPositionHeight,r);!s(f)||s(o)||s(v)||(o=0);u.granularity=ht.getValueOrUndefined(i.granularity,r);u.stRotation=ht.getValueOrUndefined(i.stRotation,r);u.perPositionHeight=ht.getValueOrUndefined(i.perPositionHeight,r);u.closeTop=ht.getValueOrDefault(i.closeTop,r,!0);u.closeBottom=ht.getValueOrDefault(i.closeBottom,r,!0);u.offsetAttribute=st.computeGeometryOffsetAttribute(h,l,r);u.height=o;f=st.getGeometryExtrudedHeight(c,l,r);f===st.CLAMP_TO_GROUND&&(f=n.getApproximateTerrainHeights(b.computeRectangle(u,pt)).minimumTerrainHeight);u.extrudedHeight=f},ct});t("DataSources/PolylineVolumeGeometryUpdater",["../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/Iso8601","../Core/PolylineVolumeGeometry","../Core/PolylineVolumeOutlineGeometry","../Core/ShowGeometryInstanceAttribute","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function g(n){this.id=n;this.vertexFormat=undefined;this.polylinePositions=undefined;this.shapePositions=undefined;this.cornerType=undefined;this.granularity=undefined}function b(n,t){p.call(this,{entity:n,scene:t,geometryOptions:new g(n),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]});this._onEntityPropertyChanged(n,"polylineVolume",n.polylineVolume,undefined)}function k(n,t,i){y.call(this,n,t,i)}var d=new t;return r(Object.create)&&(b.prototype=Object.create(p.prototype),b.prototype.constructor=b),b.prototype.createFillGeometryInstance=function(o){var h;if(n.defined("time",o),!this._fillEnabled)throw new u("This instance does not represent a filled geometry.");var l=this._entity,y=l.isAvailable(o),a,p,w=new c(y&&l.isShowing&&this._showProperty.getValue(o)&&this._fillProperty.getValue(o)),k=this._distanceDisplayConditionProperty.getValue(o),b=f.fromDistanceDisplayCondition(k);return this._materialProperty instanceof v?(r(this._materialProperty.color)&&(this._materialProperty.color.isConstant||y)&&(h=this._materialProperty.color.getValue(o,d)),r(h)||(h=t.WHITE),p=i.fromColor(h),a={show:w,distanceDisplayCondition:b,color:p}):a={show:w,distanceDisplayCondition:b},new e({id:l,geometry:new s(this._options),attributes:a})},b.prototype.createOutlineGeometryInstance=function(r){if(n.defined("time",r),!this._outlineEnabled)throw new u("This instance does not represent an outlined geometry.");var o=this._entity,s=o.isAvailable(r),l=w.getValueOrDefault(this._outlineColorProperty,r,t.BLACK,d),a=this._distanceDisplayConditionProperty.getValue(r);return new e({id:o,geometry:new h(this._options),attributes:{show:new c(s&&o.isShowing&&this._showProperty.getValue(r)&&this._showOutlineProperty.getValue(r)),color:i.fromColor(l),distanceDisplayCondition:f.fromDistanceDisplayCondition(a)}})},b.prototype._isHidden=function(n,t){return!r(t.positions)||!r(t.shape)||p.prototype._isHidden.call(this,n,t)},b.prototype._isDynamic=function(n,t){return!t.positions.isConstant||!t.shape.isConstant||!w.isConstant(t.granularity)||!w.isConstant(t.outlineWidth)||!w.isConstant(t.cornerType)},b.prototype._setStaticOptions=function(n,t){var u=t.granularity,f=t.cornerType,i=this._options,e=this._materialProperty instanceof v;i.vertexFormat=e?a.VERTEX_FORMAT:l.MaterialSupport.TEXTURED.vertexFormat;i.polylinePositions=t.positions.getValue(o.MINIMUM_VALUE,i.polylinePositions);i.shapePositions=t.shape.getValue(o.MINIMUM_VALUE,i.shape);i.granularity=r(u)?u.getValue(o.MINIMUM_VALUE):undefined;i.cornerType=r(f)?f.getValue(o.MINIMUM_VALUE):undefined},b.DynamicGeometryUpdater=k,r(Object.create)&&(k.prototype=Object.create(y.prototype),k.prototype.constructor=k),k.prototype._isHidden=function(n,t,i){var u=this._options;return!r(u.polylinePositions)||!r(u.shapePositions)||y.prototype._isHidden.call(this,n,t,i)},k.prototype._setOptions=function(n,t,i){var r=this._options;r.polylinePositions=w.getValueOrUndefined(t.positions,i,r.polylinePositions);r.shapePositions=w.getValueOrUndefined(t.shape,i);r.granularity=w.getValueOrUndefined(t.granularity,i);r.cornerType=w.getValueOrUndefined(t.cornerType,i)},b});t("DataSources/RectangleGeometryUpdater",["../Core/ApproximateTerrainHeights","../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/Ellipsoid","../Core/GeometryInstance","../Core/GeometryOffsetAttribute","../Core/Iso8601","../Core/OffsetGeometryInstanceAttribute","../Core/Rectangle","../Core/RectangleGeometry","../Core/RectangleOutlineGeometry","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","../Scene/HeightReference","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./GroundGeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function yt(n){this.id=n;this.vertexFormat=undefined;this.rectangle=undefined;this.height=undefined;this.extrudedHeight=undefined;this.granularity=undefined;this.stRotation=undefined;this.rotation=undefined;this.offsetAttribute=undefined}function et(n,t){ut.call(this,{entity:n,scene:t,geometryOptions:new yt(n),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]});this._onEntityPropertyChanged(n,"rectangle",n.rectangle,undefined)}function ot(n,t,i){it.call(this,n,t,i)}var st=new u,ht=t.ZERO,ct=new t,lt=new y,at=new y,vt=new i;return e(Object.create)&&(et.prototype=Object.create(ut.prototype),et.prototype.constructor=et),et.prototype.createFillGeometryInstance=function(n){var t;if(r.defined("time",n),!this._fillEnabled)throw new o("This instance does not represent a filled geometry.");var i=this._entity,l=i.isAvailable(n),h={show:new b(l&&i.isShowing&&this._showProperty.getValue(n)&&this._fillProperty.getValue(n)),distanceDisplayCondition:s.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(n)),offset:undefined,color:undefined};return this._materialProperty instanceof tt&&(e(this._materialProperty.color)&&(this._materialProperty.color.isConstant||l)&&(t=this._materialProperty.color.getValue(n,st)),e(t)||(t=u.WHITE),h.color=f.fromColor(t)),e(this._options.offsetAttribute)&&(h.offset=v.fromCartesian3(ft.getValueOrDefault(this._terrainOffsetProperty,n,ht,ct))),new c({id:i,geometry:new p(this._options),attributes:h})},et.prototype.createOutlineGeometryInstance=function(n){if(r.defined("time",n),!this._outlineEnabled)throw new o("This instance does not represent an outlined geometry.");var t=this._entity,h=t.isAvailable(n),l=ft.getValueOrDefault(this._outlineColorProperty,n,u.BLACK,st),a=this._distanceDisplayConditionProperty.getValue(n),i={show:new b(h&&t.isShowing&&this._showProperty.getValue(n)&&this._showOutlineProperty.getValue(n)),color:f.fromColor(l),distanceDisplayCondition:s.fromDistanceDisplayCondition(a),offset:undefined};return e(this._options.offsetAttribute)&&(i.offset=v.fromCartesian3(ft.getValueOrDefault(this._terrainOffsetProperty,n,ht,ct))),new c({id:t,geometry:new w(this._options),attributes:i})},et.prototype._computeCenter=function(n,t){var r=ft.getValueOrUndefined(this._entity.rectangle.coordinates,n,at),u;if(e(r))return u=y.center(r,vt),i.toCartesian(u,h.WGS84,t)},et.prototype._isHidden=function(n,t){return!e(t.coordinates)||rt.prototype._isHidden.call(this,n,t)},et.prototype._isOnTerrain=function(n,t){return this._fillEnabled&&!e(t.height)&&!e(t.extrudedHeight)&&k.isSupported(this._scene)},et.prototype._isDynamic=function(n,t){return!t.coordinates.isConstant||!ft.isConstant(t.height)||!ft.isConstant(t.extrudedHeight)||!ft.isConstant(t.granularity)||!ft.isConstant(t.stRotation)||!ft.isConstant(t.rotation)||!ft.isConstant(t.outlineWidth)||!ft.isConstant(t.zIndex)||this._onTerrain&&!ft.isConstant(this._materialProperty)},et.prototype._setStaticOptions=function(t,i){var o=this._materialProperty instanceof tt,s=i.height,f=i.heightReference,h=i.extrudedHeight,e=i.extrudedHeightReference,r=this._options,u;r.vertexFormat=o?nt.VERTEX_FORMAT:g.MaterialSupport.TEXTURED.vertexFormat;r.rectangle=i.coordinates.getValue(a.MINIMUM_VALUE,r.rectangle);r.granularity=ft.getValueOrUndefined(i.granularity,a.MINIMUM_VALUE);r.stRotation=ft.getValueOrUndefined(i.stRotation,a.MINIMUM_VALUE);r.rotation=ft.getValueOrUndefined(i.rotation,a.MINIMUM_VALUE);r.offsetAttribute=ut.computeGeometryOffsetAttribute(f,e,a.MINIMUM_VALUE);r.height=ut.getGeometryHeight(s,f,a.MINIMUM_VALUE);u=ut.getGeometryExtrudedHeight(h,e,a.MINIMUM_VALUE);u===ut.CLAMP_TO_GROUND&&(u=n.getApproximateTerrainHeights(p.computeRectangle(r,lt)).minimumTerrainHeight);r.extrudedHeight=u},et.prototype._getIsClosed=function(n){var t=n.height,i=n.extrudedHeight;return t===0||e(i)&&i!==t},et.DynamicGeometryUpdater=ot,e(Object.create)&&(ot.prototype=Object.create(it.prototype),ot.prototype.constructor=ot),ot.prototype._isHidden=function(n,t,i){return!e(this._options.rectangle)||it.prototype._isHidden.call(this,n,t,i)},ot.prototype._setOptions=function(t,i,r){var u=this._options,s=i.height,e=i.heightReference,h=i.extrudedHeight,o=i.extrudedHeightReference,f;u.rectangle=ft.getValueOrUndefined(i.coordinates,r,u.rectangle);u.granularity=ft.getValueOrUndefined(i.granularity,r);u.stRotation=ft.getValueOrUndefined(i.stRotation,r);u.rotation=ft.getValueOrUndefined(i.rotation,r);u.offsetAttribute=ut.computeGeometryOffsetAttribute(e,o,r);u.height=ut.getGeometryHeight(s,e,r);f=ut.getGeometryExtrudedHeight(h,o,r);f===ut.CLAMP_TO_GROUND&&(f=n.getApproximateTerrainHeights(p.computeRectangle(u,lt)).minimumTerrainHeight);u.extrudedHeight=f},et});t("DataSources/StaticGeometryColorBatch",["../Core/AssociativeArray","../Core/Cartesian3","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/OffsetGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/Primitive","./BoundingSphereState","./ColorMaterialProperty","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(t,i,r,f,e,o,s){this.translucent=i;this.appearanceType=r;this.depthFailAppearanceType=f;this.depthFailMaterialProperty=e;this.depthFailMaterial=undefined;this.closed=o;this.shadows=s;this.primitives=t;this.createPrimitive=!1;this.waitingOnCreate=!1;this.primitive=undefined;this.oldPrimitive=undefined;this.geometry=new n;this.updaters=new n;this.updatersWithAttributes=new n;this.attributes=new n;this.subscriptions=new n;this.showsUpdated=new n;this.itemsToRemove=[];this.invalidated=!1;var h;u(e)&&(h=e.definitionChanged.addEventListener(y.prototype.onMaterialChanged,this));this.removeMaterialSubscription=h}function p(n,t,i,r,u){this._solidItems=[];this._translucentItems=[];this._primitives=n;this._appearanceType=t;this._depthFailAppearanceType=i;this._closed=r;this._shadows=u}function k(n,t){for(var r,u=n.length,i=u-1;i>=0;i--)if(r=n[i],r.remove(t)&&r.updaters.length===0)return n.splice(i,1),r.destroy(),!0;return!1}function d(n,t,i){for(var u,f=!1,h=t.length,r=0;r<h;++r){var e=t[r],o=e.itemsToRemove,s=o.length;if(s>0)for(r=0;r<s;r++)u=o[r],e.remove(u),n.add(i,u),f=!0}return f}function w(n,t,i,r){for(var o=t.length,f,s,h,e,u=o-1;u>=0;u--)if(f=t[u],f.invalidated){for(t.splice(u,1),s=f.updaters.values,h=s.length,e=0;e<h;e++)n.add(i,s[e]);f.destroy()}for(o=t.length,u=0;u<o;++u)r=t[u].update(i)&&r;return r}function g(n,t,i){for(var u,f=n.length,r=0;r<f;r++)if(u=n[r],u.contains(t))return u.getBoundingSphere(t,i);return c.FAILED}function nt(n){for(var i=n.length,t=0;t<i;t++)n[t].destroy();n.length=0}var b=new i,tt=new f,it=new f,rt=t.ZERO,ut=new t;return y.prototype.onMaterialChanged=function(){this.invalidated=!0},y.prototype.isMaterial=function(n){var t=this.depthFailMaterialProperty,i=n.depthFailMaterialProperty;return i===t?!0:u(t)?t.equals(i):!1},y.prototype.add=function(n,t){var i=n.id,r;this.createPrimitive=!0;this.geometry.set(i,t);this.updaters.set(i,n);n.hasConstantFill&&n.fillMaterialProperty.isConstant&&v.isConstant(n.distanceDisplayConditionProperty)&&v.isConstant(n.terrainOffsetProperty)?(r=this,this.subscriptions.set(i,n.entity.definitionChanged.addEventListener(function(t,i){i==="isShowing"&&r.showsUpdated.set(n.id,n)}))):this.updatersWithAttributes.set(i,n)},y.prototype.remove=function(n){var t=n.id,i;this.createPrimitive=this.geometry.remove(t)||this.createPrimitive;this.updaters.remove(t)&&(this.updatersWithAttributes.remove(t),i=this.subscriptions.get(t),u(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)))},y.prototype.update=function(n){var et=!0,vt=0,y=this.primitive,w=this.primitives,k,ot,yt,pt,st,kt,d,dt,g,ct,gt,lt,nt,at,ft;if(this.createPrimitive)ot=this.geometry.values,yt=ot.length,yt>0?(u(y)&&(u(this.oldPrimitive)?w.remove(y):this.oldPrimitive=y),u(this.depthFailAppearanceType)&&(u(this.depthFailMaterialProperty)&&(this.depthFailMaterial=a.getValue(n,this.depthFailMaterialProperty,this.depthFailMaterial)),pt=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),y=new h({show:!1,asynchronous:!0,geometryInstances:ot,appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:pt,shadows:this.shadows}),w.add(y),et=!1):(u(y)&&(w.remove(y),y=undefined),st=this.oldPrimitive,u(st)&&(w.remove(st),this.oldPrimitive=undefined)),this.attributes.removeAll(),this.primitive=y,this.createPrimitive=!1,this.waitingOnCreate=!0;else if(u(y)&&y.ready){y.show=!0;u(this.oldPrimitive)&&(w.remove(this.oldPrimitive),this.oldPrimitive=undefined);!u(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof l||(this.depthFailMaterial=a.getValue(n,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var wt=this.updatersWithAttributes.values,ni=wt.length,bt=this.waitingOnCreate;for(k=0;k<ni;k++){var p=wt[k],ht=this.geometry.get(p.id),c=this.attributes.get(ht.id.id);u(c)||(c=y.getGeometryInstanceAttributes(ht.id),this.attributes.set(ht.id.id,c));(!p.fillMaterialProperty.isConstant||bt)&&(kt=p.fillMaterialProperty.color,d=v.getValueOrDefault(kt,n,i.WHITE,b),i.equals(c._lastColor,d)||(c._lastColor=i.clone(d,c._lastColor),c.color=r.toValue(d,c.color),(this.translucent&&c.color[3]===255||!this.translucent&&c.color[3]!==255)&&(this.itemsToRemove[vt++]=p)));u(this.depthFailAppearanceType)&&p.depthFailMaterialProperty instanceof l&&(!p.depthFailMaterialProperty.isConstant||bt)&&(dt=p.depthFailMaterialProperty.color,g=v.getValueOrDefault(dt,n,i.WHITE,b),i.equals(c._lastDepthFailColor,g)||(c._lastDepthFailColor=i.clone(g,c._lastDepthFailColor),c.depthFailColor=r.toValue(g,c.depthFailColor)));ct=p.entity.isShowing&&(p.hasConstantFill||p.isFilled(n));gt=c.show[0]===1;ct!==gt&&(c.show=s.toValue(ct,c.show));lt=p.distanceDisplayConditionProperty;v.isConstant(lt)||(nt=v.getValueOrDefault(lt,n,it,tt),f.equals(nt,c._lastDistanceDisplayCondition)||(c._lastDistanceDisplayCondition=f.clone(nt,c._lastDistanceDisplayCondition),c.distanceDisplayCondition=e.toValue(nt,c.distanceDisplayCondition)));at=p.terrainOffsetProperty;v.isConstant(at)||(ft=v.getValueOrDefault(at,n,rt,ut),t.equals(ft,c._lastOffset)||(c._lastOffset=t.clone(ft,c._lastOffset),c.offset=o.toValue(ft,c.offset)))}this.updateShows(y);this.waitingOnCreate=!1}else u(y)&&!y.ready&&(et=!1);return this.itemsToRemove.length=vt,et},y.prototype.updateShows=function(n){for(var f,h,e=this.showsUpdated.values,c=e.length,i=0;i<c;i++){var o=e[i],r=this.geometry.get(o.id),t=this.attributes.get(r.id.id);u(t)||(t=n.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,t));f=o.entity.isShowing;h=t.show[0]===1;f!==h&&(t.show=s.toValue(f,t.show))}this.showsUpdated.removeAll()},y.prototype.contains=function(n){return this.updaters.contains(n.id)},y.prototype.getBoundingSphere=function(n,t){var r=this.primitive,i;return r.ready?(i=r.getGeometryInstanceAttributes(n.entity),!u(i)||!u(i.boundingSphere)||u(i.show)&&i.show[0]===0)?c.FAILED:(i.boundingSphere.clone(t),c.DONE):c.PENDING},y.prototype.destroy=function(){var t=this.primitive,i=this.primitives,n;u(t)&&i.remove(t);n=this.oldPrimitive;u(n)&&i.remove(n);u(this.removeMaterialSubscription)&&this.removeMaterialSubscription()},p.prototype.add=function(n,t){var i,u,f=t.createFillGeometryInstance(n),s,r,e,o;for(f.attributes.color.value[3]===255?(i=this._solidItems,u=!1):(i=this._translucentItems,u=!0),s=i.length,r=0;r<s;r++)if(e=i[r],e.isMaterial(t)){e.add(t,f);return}o=new y(this._primitives,u,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(t,f);i.push(o)},p.prototype.remove=function(n){k(this._solidItems,n)||k(this._translucentItems,n)},p.prototype.update=function(n){var t=w(this,this._solidItems,n,!0),i,r;return t=w(this,this._translucentItems,n,t)&&t,i=d(this,this._solidItems,n),r=d(this,this._translucentItems,n),(i||r)&&(t=w(this,this._solidItems,n,t)&&t,t=w(this,this._translucentItems,n,t)&&t),t},p.prototype.getBoundingSphere=function(n,t){var i=g(this._solidItems,n,t);return i===c.FAILED?g(this._translucentItems,n,t):i},p.prototype.removeAllPrimitives=function(){nt(this._solidItems);nt(this._translucentItems)},p});t("DataSources/StaticGeometryPerMaterialBatch",["../Core/AssociativeArray","../Core/Cartesian3","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/OffsetGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/Primitive","./BoundingSphereState","./ColorMaterialProperty","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(t,i,r,u,f,e,o){this.primitives=t;this.appearanceType=i;this.materialProperty=r;this.depthFailAppearanceType=u;this.depthFailMaterialProperty=f;this.closed=e;this.shadows=o;this.updaters=new n;this.createPrimitive=!0;this.primitive=undefined;this.oldPrimitive=undefined;this.geometry=new n;this.material=undefined;this.depthFailMaterial=undefined;this.updatersWithAttributes=new n;this.attributes=new n;this.invalidated=!1;this.removeMaterialSubscription=r.definitionChanged.addEventListener(y.prototype.onMaterialChanged,this);this.subscriptions=new n;this.showsUpdated=new n}function p(n,t,i,r,u){this._items=[];this._primitives=n;this._appearanceType=t;this._depthFailAppearanceType=i;this._closed=r;this._shadows=u}var b=new f,k=new f,d=t.ZERO,g=new t,w;return y.prototype.onMaterialChanged=function(){this.invalidated=!0},y.prototype.isMaterial=function(n){var i=this.materialProperty,f=n.fillMaterialProperty,t=this.depthFailMaterialProperty,r=n.depthFailMaterialProperty,e;return f===i&&r===t?!0:(e=u(i)&&i.equals(f),(!u(t)&&!u(r)||u(t)&&t.equals(r))&&e)},y.prototype.add=function(n,t){var i=t.id,r;this.updaters.set(i,t);this.geometry.set(i,t.createFillGeometryInstance(n));t.hasConstantFill&&t.fillMaterialProperty.isConstant&&v.isConstant(t.distanceDisplayConditionProperty)&&v.isConstant(t.terrainOffsetProperty)?(r=this,this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(n,i){i==="isShowing"&&r.showsUpdated.set(t.id,t)}))):this.updatersWithAttributes.set(i,t);this.createPrimitive=!0},y.prototype.remove=function(n){var t=n.id,i;return this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)&&(this.updatersWithAttributes.remove(t),i=this.subscriptions.get(t),u(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t))),this.createPrimitive},w=new i,y.prototype.update=function(n){var ft=!0,y=this.primitive,nt=this.primitives,at=this.geometry.values,tt,vt,yt,et,ot,pt,wt,it,ht,bt,ct,rt,lt,ut;if(this.createPrimitive)vt=at.length,vt>0?(u(y)&&(u(this.oldPrimitive)?nt.remove(y):this.oldPrimitive=y),this.material=a.getValue(n,this.materialProperty,this.material),u(this.depthFailMaterialProperty)&&(this.depthFailMaterial=a.getValue(n,this.depthFailMaterialProperty,this.depthFailMaterial),yt=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),y=new h({show:!1,asynchronous:!0,geometryInstances:at,appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:yt,shadows:this.shadows}),nt.add(y),ft=!1):(u(y)&&(nt.remove(y),y=undefined),et=this.oldPrimitive,u(et)&&(nt.remove(et),this.oldPrimitive=undefined)),this.attributes.removeAll(),this.primitive=y,this.createPrimitive=!1;else if(u(y)&&y.ready){for(y.show=!0,u(this.oldPrimitive)&&(nt.remove(this.oldPrimitive),this.oldPrimitive=undefined),this.material=a.getValue(n,this.materialProperty,this.material),this.primitive.appearance.material=this.material,!u(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof l||(this.depthFailMaterial=a.getValue(n,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial),ot=this.updatersWithAttributes.values,pt=ot.length,tt=0;tt<pt;tt++){var p=ot[tt],kt=p.entity,st=this.geometry.get(p.id),c=this.attributes.get(st.id.id);u(c)||(c=y.getGeometryInstanceAttributes(st.id),this.attributes.set(st.id.id,c));u(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof l&&!p.depthFailMaterialProperty.isConstant&&(wt=p.depthFailMaterialProperty.color,it=v.getValueOrDefault(wt,n,i.WHITE,w),i.equals(c._lastDepthFailColor,it)||(c._lastDepthFailColor=i.clone(it,c._lastDepthFailColor),c.depthFailColor=r.toValue(it,c.depthFailColor)));ht=kt.isShowing&&(p.hasConstantFill||p.isFilled(n));bt=c.show[0]===1;ht!==bt&&(c.show=s.toValue(ht,c.show));ct=p.distanceDisplayConditionProperty;v.isConstant(ct)||(rt=v.getValueOrDefault(ct,n,k,b),f.equals(rt,c._lastDistanceDisplayCondition)||(c._lastDistanceDisplayCondition=f.clone(rt,c._lastDistanceDisplayCondition),c.distanceDisplayCondition=e.toValue(rt,c.distanceDisplayCondition)));lt=p.terrainOffsetProperty;v.isConstant(lt)||(ut=v.getValueOrDefault(lt,n,d,g),t.equals(ut,c._lastOffset)||(c._lastOffset=t.clone(ut,c._lastOffset),c.offset=o.toValue(ut,c.offset)))}this.updateShows(y)}else u(y)&&!y.ready&&(ft=!1);return ft},y.prototype.updateShows=function(n){for(var f,h,e=this.showsUpdated.values,c=e.length,i=0;i<c;i++){var o=e[i],l=o.entity,r=this.geometry.get(o.id),t=this.attributes.get(r.id.id);u(t)||(t=n.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,t));f=l.isShowing;h=t.show[0]===1;f!==h&&(t.show=s.toValue(f,t.show))}this.showsUpdated.removeAll()},y.prototype.contains=function(n){return this.updaters.contains(n.id)},y.prototype.getBoundingSphere=function(n,t){var r=this.primitive,i;return r.ready?(i=r.getGeometryInstanceAttributes(n.entity),!u(i)||!u(i.boundingSphere)||u(i.show)&&i.show[0]===0)?c.FAILED:(i.boundingSphere.clone(t),c.DONE):c.PENDING},y.prototype.destroy=function(){var t=this.primitive,i=this.primitives,n;u(t)&&i.remove(t);n=this.oldPrimitive;u(n)&&i.remove(n);this.removeMaterialSubscription()},p.prototype.add=function(n,t){for(var u,f,i=this._items,e=i.length,r=0;r<e;r++)if(u=i[r],u.isMaterial(t)){u.add(n,t);return}f=new y(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);f.add(n,t);i.push(f)},p.prototype.remove=function(n){for(var i,r=this._items,u=r.length,t=u-1;t>=0;t--)if(i=r[t],i.remove(n)){i.updaters.length===0&&(r.splice(t,1),i.destroy());break}},p.prototype.update=function(n){for(var i=this._items,s=i.length,r,e,o,u,f,t=s-1;t>=0;t--)if(r=i[t],r.invalidated){for(i.splice(t,1),e=r.updaters.values,o=e.length,u=0;u<o;u++)this.add(n,e[u]);r.destroy()}for(f=!0,t=0;t<i.length;t++)f=i[t].update(n)&&f;return f},p.prototype.getBoundingSphere=function(n,t){for(var r,u=this._items,f=u.length,i=0;i<f;i++)if(r=u[i],r.contains(n))return r.getBoundingSphere(n,t);return c.FAILED},p.prototype.removeAllPrimitives=function(){for(var t=this._items,i=t.length,n=0;n<i;n++)t[n].destroy();this._items.length=0},p});t("DataSources/StaticGroundGeometryColorBatch",["../Core/AssociativeArray","../Core/Color","../Core/defined","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPrimitive","./BoundingSphereState","./Property"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(t,i,r,u,f){this.primitives=t;this.zIndex=f;this.classificationType=i;this.color=r;this.key=u;this.createPrimitive=!1;this.waitingOnCreate=!1;this.primitive=undefined;this.oldPrimitive=undefined;this.geometry=new n;this.updaters=new n;this.updatersWithAttributes=new n;this.attributes=new n;this.subscriptions=new n;this.showsUpdated=new n;this.itemsToRemove=[];this.isDirty=!1}function c(t,i){this._batches=new n;this._primitives=t;this._classificationType=i}var a=new t,v=new r,y=new r,l;return h.prototype.add=function(n,t){var i=n.id,r;this.createPrimitive=!0;this.geometry.set(i,t);this.updaters.set(i,n);n.hasConstantFill&&n.fillMaterialProperty.isConstant&&s.isConstant(n.distanceDisplayConditionProperty)?(r=this,this.subscriptions.set(i,n.entity.definitionChanged.addEventListener(function(t,i){i==="isShowing"&&r.showsUpdated.set(n.id,n)}))):this.updatersWithAttributes.set(i,n)},h.prototype.remove=function(n){var t=n.id,r;return(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t))?(this.updatersWithAttributes.remove(t),r=this.subscriptions.get(t),i(r)&&(r(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0):!1},l=new Array(4),h.prototype.update=function(n){var nt=!0,et=0,o=this.primitive,p=this.primitives,k,tt,ot,it,ht,d,w,b,ut,ct,ft,g;if(this.createPrimitive)tt=this.geometry.values,ot=tt.length,ot>0?(i(o)&&(i(this.oldPrimitive)?p.remove(o):this.oldPrimitive=o),o=new e({show:!1,asynchronous:!0,geometryInstances:tt,classificationType:this.classificationType}),p.add(o,this.zIndex),nt=!1):(i(o)&&(p.remove(o),o=undefined),it=this.oldPrimitive,i(it)&&(p.remove(it),this.oldPrimitive=undefined)),this.attributes.removeAll(),this.primitive=o,this.createPrimitive=!1,this.waitingOnCreate=!0;else if(i(o)&&o.ready){o.show=!0;i(this.oldPrimitive)&&(p.remove(this.oldPrimitive),this.oldPrimitive=undefined);var st=this.updatersWithAttributes.values,lt=st.length,at=this.waitingOnCreate;for(k=0;k<lt;k++){var c=st[k],rt=this.geometry.get(c.id),h=this.attributes.get(rt.id.id);i(h)||(h=o.getGeometryInstanceAttributes(rt.id),this.attributes.set(rt.id.id,h));(!c.fillMaterialProperty.isConstant||at)&&(ht=c.fillMaterialProperty.color,d=s.getValueOrDefault(ht,n,t.WHITE,a),t.equals(h._lastColor,d)||(h._lastColor=t.clone(d,h._lastColor),w=this.color,b=d.toBytes(l),(w[0]!==b[0]||w[1]!==b[1]||w[2]!==b[2]||w[3]!==b[3])&&(this.itemsToRemove[et++]=c)));ut=c.entity.isShowing&&(c.hasConstantFill||c.isFilled(n));ct=h.show[0]===1;ut!==ct&&(h.show=f.toValue(ut,h.show));ft=c.distanceDisplayConditionProperty;s.isConstant(ft)||(g=s.getValueOrDefault(ft,n,y,v),r.equals(g,h._lastDistanceDisplayCondition)||(h._lastDistanceDisplayCondition=r.clone(g,h._lastDistanceDisplayCondition),h.distanceDisplayCondition=u.toValue(g,h.distanceDisplayCondition)))}this.updateShows(o);this.waitingOnCreate=!1}else i(o)&&!o.ready&&(nt=!1);return this.itemsToRemove.length=et,nt},h.prototype.updateShows=function(n){for(var e,h,o=this.showsUpdated.values,c=o.length,r=0;r<c;r++){var s=o[r],u=this.geometry.get(s.id),t=this.attributes.get(u.id.id);i(t)||(t=n.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,t));e=s.entity.isShowing;h=t.show[0]===1;e!==h&&(t.show=f.toValue(e,t.show))}this.showsUpdated.removeAll()},h.prototype.contains=function(n){return this.updaters.contains(n.id)},h.prototype.getBoundingSphere=function(n,t){var u=this.primitive,r;return u.ready?(r=u.getBoundingSphere(n.entity),!i(r))?o.FAILED:(r.clone(t),o.DONE):o.PENDING},h.prototype.removeAllPrimitives=function(){var t=this.primitives,r=this.primitive,n;i(r)&&(t.remove(r),this.primitive=undefined,this.geometry.removeAll(),this.updaters.removeAll());n=this.oldPrimitive;i(n)&&(t.remove(n),this.oldPrimitive=undefined)},c.prototype.add=function(n,t){var u=t.createFillGeometryInstance(n),f=this._batches,e=s.getValueOrDefault(t.zIndex,0),r=new Uint32Array(u.attributes.color.value.buffer)[0]+":"+e,i;return f.contains(r)?i=f.get(r):(i=new h(this._primitives,this._classificationType,u.attributes.color.value,r,e),f.set(r,i)),i.add(t,u),i},c.prototype.remove=function(n){for(var i=this._batches.values,r=i.length,t=0;t<r;++t)if(i[t].remove(n))return},c.prototype.update=function(n){for(var o,i=!0,h=this._batches,u=h.values,c=u.length,f,a,e,v,r,t=0;t<c;++t)i=u[t].update(n)&&i;for(t=0;t<c;++t){var s=u[t],l=s.itemsToRemove,y=l.length;for(f=0;f<y;f++)o=l[f],s.remove(o),a=this.add(n,o),s.isDirty=!0,a.isDirty=!0}for(e=u.slice(),v=e.length,t=0;t<v;++t)r=e[t],r.isDirty&&(i=e[t].update(n)&&i,r.isDirty=!1),r.geometry.length===0&&h.remove(r.key);return i},c.prototype.getBoundingSphere=function(n,t){for(var r,u=this._batches.values,f=u.length,i=0;i<f;++i)if(r=u[i],r.contains(n))return r.getBoundingSphere(n,t);return o.FAILED},c.prototype.removeAllPrimitives=function(){for(var t=this._batches.values,i=t.length,n=0;n<i;++n)t[n].removeAllPrimitives()},c});t("DataSources/StaticGroundGeometryPerMaterialBatch",["../Core/AssociativeArray","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Core/RectangleCollisionChecker","../Scene/ClassificationType","../Scene/GroundPrimitive","../Scene/ShadowVolumeAppearance","./BoundingSphereState","./ColorMaterialProperty","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(t,i,r,u,f){this.primitives=t;this.appearanceType=i;this.materialProperty=r;this.updaters=new n;this.createPrimitive=!0;this.primitive=undefined;this.oldPrimitive=undefined;this.geometry=new n;this.material=undefined;this.updatersWithAttributes=new n;this.attributes=new n;this.invalidated=!1;this.removeMaterialSubscription=r.definitionChanged.addEventListener(y.prototype.onMaterialChanged,this);this.subscriptions=new n;this.showsUpdated=new n;this.usingSphericalTextureCoordinates=u;this.zIndex=f;this.rectangleCollisionCheck=new e}function p(n,t){this._items=[];this._primitives=n;this._appearanceType=t}var w=new r,b=new r;return y.prototype.onMaterialChanged=function(){this.invalidated=!0},y.prototype.overlapping=function(n){return this.rectangleCollisionCheck.collides(n)},y.prototype.isMaterial=function(n){var t=this.materialProperty,r=n.fillMaterialProperty;return r===t||r instanceof l&&t instanceof l?!0:i(t)&&t.equals(r)},y.prototype.add=function(n,t,i){var r=t.id,u;this.updaters.set(r,t);this.geometry.set(r,i);this.rectangleCollisionCheck.insert(r,i.geometry.rectangle);t.hasConstantFill&&t.fillMaterialProperty.isConstant&&v.isConstant(t.distanceDisplayConditionProperty)?(u=this,this.subscriptions.set(r,t.entity.definitionChanged.addEventListener(function(n,i){i==="isShowing"&&u.showsUpdated.set(t.id,t)}))):this.updatersWithAttributes.set(r,t);this.createPrimitive=!0},y.prototype.remove=function(n){var t=n.id,u=this.geometry.get(t),r;return(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t))?(this.rectangleCollisionCheck.remove(t,u.geometry.rectangle),this.updatersWithAttributes.remove(t),r=this.subscriptions.get(t),i(r)&&(r(),this.subscriptions.remove(t)),!0):!1},y.prototype.update=function(n){var p=!0,t=this.primitive,h=this.primitives,it=this.geometry.values,l,rt,k,d,ut,nt,ft,tt,y;if(this.createPrimitive)rt=it.length,rt>0?(i(t)&&(i(this.oldPrimitive)?h.remove(t):this.oldPrimitive=t),this.material=a.getValue(n,this.materialProperty,this.material),t=new s({show:!1,asynchronous:!0,geometryInstances:it,appearance:new this.appearanceType({material:this.material}),classificationType:o.TERRAIN}),h.add(t,this.zIndex),p=!1):(i(t)&&(h.remove(t),t=undefined),k=this.oldPrimitive,i(k)&&(h.remove(k),this.oldPrimitive=undefined)),this.attributes.removeAll(),this.primitive=t,this.createPrimitive=!1;else if(i(t)&&t.ready){for(t.show=!0,i(this.oldPrimitive)&&(h.remove(this.oldPrimitive),this.oldPrimitive=undefined),this.material=a.getValue(n,this.materialProperty,this.material),this.primitive.appearance.material=this.material,d=this.updatersWithAttributes.values,ut=d.length,l=0;l<ut;l++){var c=d[l],et=c.entity,g=this.geometry.get(c.id),e=this.attributes.get(g.id.id);i(e)||(e=t.getGeometryInstanceAttributes(g.id),this.attributes.set(g.id.id,e));nt=et.isShowing&&(c.hasConstantFill||c.isFilled(n));ft=e.show[0]===1;nt!==ft&&(e.show=f.toValue(nt,e.show));tt=c.distanceDisplayConditionProperty;v.isConstant(tt)||(y=v.getValueOrDefault(tt,n,b,w),r.equals(y,e._lastDistanceDisplayCondition)||(e._lastDistanceDisplayCondition=r.clone(y,e._lastDistanceDisplayCondition),e.distanceDisplayCondition=u.toValue(y,e.distanceDisplayCondition)))}this.updateShows(t)}else i(t)&&!t.ready&&(p=!1);return p},y.prototype.updateShows=function(n){for(var e,h,o=this.showsUpdated.values,c=o.length,r=0;r<c;r++){var s=o[r],l=s.entity,u=this.geometry.get(s.id),t=this.attributes.get(u.id.id);i(t)||(t=n.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,t));e=l.isShowing;h=t.show[0]===1;e!==h&&(t.show=f.toValue(e,t.show))}this.showsUpdated.removeAll()},y.prototype.contains=function(n){return this.updaters.contains(n.id)},y.prototype.getBoundingSphere=function(n,t){var u=this.primitive,r;return u.ready?(r=u.getGeometryInstanceAttributes(n.entity),!i(r)||!i(r.boundingSphere)||i(r.show)&&r.show[0]===0)?c.FAILED:(r.boundingSphere.clone(t),c.DONE):c.PENDING},y.prototype.destroy=function(){var t=this.primitive,r=this.primitives,n;i(t)&&r.remove(t);n=this.oldPrimitive;i(n)&&r.remove(n);this.removeMaterialSubscription()},p.prototype.add=function(n,t){for(var i,e,u=this._items,c=u.length,r=t.createFillGeometryInstance(n),o=h.shouldUseSphericalCoordinates(r.geometry.rectangle),s=v.getValueOrDefault(t.zIndex,0),f=0;f<c;++f)if(i=u[f],i.isMaterial(t)&&i.usingSphericalTextureCoordinates===o&&i.zIndex===s&&!i.overlapping(r.geometry.rectangle)){i.add(n,t,r);return}e=new y(this._primitives,this._appearanceType,t.fillMaterialProperty,o,s);e.add(n,t,r);u.push(e)},p.prototype.remove=function(n){for(var i,r=this._items,u=r.length,t=u-1;t>=0;t--)if(i=r[t],i.remove(n)){i.updaters.length===0&&(r.splice(t,1),i.destroy());break}},p.prototype.update=function(n){for(var i=this._items,s=i.length,r,e,o,u,f,t=s-1;t>=0;t--)if(r=i[t],r.invalidated){for(i.splice(t,1),e=r.updaters.values,o=e.length,u=0;u<o;u++)this.add(n,e[u]);r.destroy()}for(f=!0,t=0;t<i.length;t++)f=i[t].update(n)&&f;return f},p.prototype.getBoundingSphere=function(n,t){for(var r,u=this._items,f=u.length,i=0;i<f;i++)if(r=u[i],r.contains(n))return r.getBoundingSphere(n,t);return c.FAILED},p.prototype.removeAllPrimitives=function(){for(var t=this._items,i=t.length,n=0;n<i;n++)t[n].destroy();this._items.length=0},p});t("DataSources/StaticOutlineGeometryBatch",["../Core/AssociativeArray","../Core/Cartesian3","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/OffsetGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/PerInstanceColorAppearance","../Scene/Primitive","./BoundingSphereState","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(t,i,r,u){this.translucent=i;this.width=r;this.shadows=u;this.primitives=t;this.createPrimitive=!1;this.waitingOnCreate=!1;this.primitive=undefined;this.oldPrimitive=undefined;this.geometry=new n;this.updaters=new n;this.updatersWithAttributes=new n;this.attributes=new n;this.itemsToRemove=[];this.subscriptions=new n;this.showsUpdated=new n}function y(t,i,r){this._primitives=t;this._scene=i;this._shadows=r;this._solidBatches=new n;this._translucentBatches=new n}var p=new i,w=new f,b=new f,k=t.ZERO,d=new t;return v.prototype.add=function(n,t){var i=n.id,r;this.createPrimitive=!0;this.geometry.set(i,t);this.updaters.set(i,n);n.hasConstantOutline&&n.outlineColorProperty.isConstant&&a.isConstant(n.distanceDisplayConditionProperty)&&a.isConstant(n.terrainOffsetProperty)?(r=this,this.subscriptions.set(i,n.entity.definitionChanged.addEventListener(function(t,i){i==="isShowing"&&r.showsUpdated.set(n.id,n)}))):this.updatersWithAttributes.set(i,n)},v.prototype.remove=function(n){var t=n.id,i;this.createPrimitive=this.geometry.remove(t)||this.createPrimitive;this.updaters.remove(t)&&(this.updatersWithAttributes.remove(t),i=this.subscriptions.get(t),u(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)))},v.prototype.update=function(n){var ut=!0,lt=0,v=this.primitive,g=this.primitives,nt,ft,at,et,yt,tt,st,pt,ht,it,ct,rt;if(this.createPrimitive)ft=this.geometry.values,at=ft.length,at>0?(u(v)&&(u(this.oldPrimitive)?g.remove(v):this.oldPrimitive=v),v=new c({show:!1,asynchronous:!0,geometryInstances:ft,appearance:new h({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),g.add(v),ut=!1):(u(v)&&(g.remove(v),v=undefined),et=this.oldPrimitive,u(et)&&(g.remove(et),this.oldPrimitive=undefined)),this.attributes.removeAll(),this.primitive=v,this.createPrimitive=!1,this.waitingOnCreate=!0;else if(u(v)&&v.ready){v.show=!0;u(this.oldPrimitive)&&(g.remove(this.oldPrimitive),this.oldPrimitive=undefined);var vt=this.updatersWithAttributes.values,wt=vt.length,bt=this.waitingOnCreate;for(nt=0;nt<wt;nt++){var y=vt[nt],ot=this.geometry.get(y.id),l=this.attributes.get(ot.id.id);u(l)||(l=v.getGeometryInstanceAttributes(ot.id),this.attributes.set(ot.id.id,l));(!y.outlineColorProperty.isConstant||bt)&&(yt=y.outlineColorProperty,tt=a.getValueOrDefault(yt,n,i.WHITE,p),i.equals(l._lastColor,tt)||(l._lastColor=i.clone(tt,l._lastColor),l.color=r.toValue(tt,l.color),(this.translucent&&l.color[3]===255||!this.translucent&&l.color[3]!==255)&&(this.itemsToRemove[lt++]=y)));st=y.entity.isShowing&&(y.hasConstantOutline||y.isOutlineVisible(n));pt=l.show[0]===1;st!==pt&&(l.show=s.toValue(st,l.show));ht=y.distanceDisplayConditionProperty;a.isConstant(ht)||(it=a.getValueOrDefault(ht,n,b,w),f.equals(it,l._lastDistanceDisplayCondition)||(l._lastDistanceDisplayCondition=f.clone(it,l._lastDistanceDisplayCondition),l.distanceDisplayCondition=e.toValue(it,l.distanceDisplayCondition)));ct=y.terrainOffsetProperty;a.isConstant(ct)||(rt=a.getValueOrDefault(ct,n,k,d),t.equals(rt,l._lastOffset)||(l._lastOffset=t.clone(rt,l._lastOffset),l.offset=o.toValue(rt,l.offset)))}this.updateShows(v);this.waitingOnCreate=!1}else u(v)&&!v.ready&&(ut=!1);return this.itemsToRemove.length=lt,ut},v.prototype.updateShows=function(n){for(var f,h,e=this.showsUpdated.values,c=e.length,i=0;i<c;i++){var o=e[i],r=this.geometry.get(o.id),t=this.attributes.get(r.id.id);u(t)||(t=n.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,t));f=o.entity.isShowing;h=t.show[0]===1;f!==h&&(t.show=s.toValue(f,t.show))}this.showsUpdated.removeAll()},v.prototype.contains=function(n){return this.updaters.contains(n.id)},v.prototype.getBoundingSphere=function(n,t){var r=this.primitive,i;return r.ready?(i=r.getGeometryInstanceAttributes(n.entity),!u(i)||!u(i.boundingSphere)||u(i.show)&&i.show[0]===0)?l.FAILED:(i.boundingSphere.clone(t),l.DONE):l.PENDING},v.prototype.removeAllPrimitives=function(){var t=this.primitives,i=this.primitive,n;u(i)&&(t.remove(i),this.primitive=undefined,this.geometry.removeAll(),this.updaters.removeAll());n=this.oldPrimitive;u(n)&&(t.remove(n),this.oldPrimitive=undefined)},y.prototype.add=function(n,t){var e=t.createOutlineGeometryInstance(n),r=this._scene.clampLineWidth(t.outlineWidth),f,i;e.attributes.color.value[3]===255?(f=this._solidBatches,i=f.get(r),u(i)||(i=new v(this._primitives,!1,r,this._shadows),f.set(r,i)),i.add(t,e)):(f=this._translucentBatches,i=f.get(r),u(i)||(i=new v(this._primitives,!0,r,this._shadows),f.set(r,i)),i.add(t,e))},y.prototype.remove=function(n){for(var r=this._solidBatches.values,f=r.length,i,u,t=0;t<f;t++)if(r[t].remove(n))return;for(i=this._translucentBatches.values,u=i.length,t=0;t<u;t++)if(i[t].remove(n))return},y.prototype.update=function(n){var t,i,u,r,c=this._solidBatches.values,a=c.length,l=this._translucentBatches.values,v=l.length,f,o=!0,e=!1,s,h;do{for(e=!1,i=0;i<a;i++)if(r=c[i],o=r.update(n),f=r.itemsToRemove,s=f.length,s>0)for(e=!0,t=0;t<s;t++)u=f[t],r.remove(u),this.add(n,u);for(i=0;i<v;i++)if(r=l[i],o=r.update(n),f=r.itemsToRemove,h=f.length,h>0)for(e=!0,t=0;t<h;t++)u=f[t],r.remove(u),this.add(n,u)}while(e);return o},y.prototype.getBoundingSphere=function(n,t){for(var e=this._solidBatches.values,s=e.length,r,u,o,f,i=0;i<s;i++)if(r=e[i],r.contains(n))return r.getBoundingSphere(n,t);for(u=this._translucentBatches.values,o=u.length,i=0;i<o;i++)if(f=u[i],f.contains(n))return f.getBoundingSphere(n,t);return l.FAILED},y.prototype.removeAllPrimitives=function(){for(var i=this._solidBatches.values,u=i.length,t,r,n=0;n<u;n++)i[n].removeAllPrimitives();for(t=this._translucentBatches.values,r=t.length,n=0;n<r;n++)t[n].removeAllPrimitives()},y});t("DataSources/WallGeometryUpdater",["../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DeveloperError","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/GeometryInstance","../Core/Iso8601","../Core/ShowGeometryInstanceAttribute","../Core/WallGeometry","../Core/WallOutlineGeometry","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","./ColorMaterialProperty","./DynamicGeometryUpdater","./GeometryUpdater","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function g(n){this.id=n;this.vertexFormat=undefined;this.positions=undefined;this.minimumHeights=undefined;this.maximumHeights=undefined;this.granularity=undefined}function b(n,t){p.call(this,{entity:n,scene:t,geometryOptions:new g(n),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]});this._onEntityPropertyChanged(n,"wall",n.wall,undefined)}function k(n,t,i){y.call(this,n,t,i)}var d=new t;return r(Object.create)&&(b.prototype=Object.create(p.prototype),b.prototype.constructor=b),b.prototype.createFillGeometryInstance=function(o){var c;if(n.defined("time",o),!this._fillEnabled)throw new u("This instance does not represent a filled geometry.");var l=this._entity,y=l.isAvailable(o),a,p,w=new s(y&&l.isShowing&&this._showProperty.getValue(o)&&this._fillProperty.getValue(o)),k=this._distanceDisplayConditionProperty.getValue(o),b=f.fromDistanceDisplayCondition(k);return this._materialProperty instanceof v?(r(this._materialProperty.color)&&(this._materialProperty.color.isConstant||y)&&(c=this._materialProperty.color.getValue(o,d)),r(c)||(c=t.WHITE),p=i.fromColor(c),a={show:w,distanceDisplayCondition:b,color:p}):a={show:w,distanceDisplayCondition:b},new e({id:l,geometry:new h(this._options),attributes:a})},b.prototype.createOutlineGeometryInstance=function(r){if(n.defined("time",r),!this._outlineEnabled)throw new u("This instance does not represent an outlined geometry.");var o=this._entity,h=o.isAvailable(r),l=w.getValueOrDefault(this._outlineColorProperty,r,t.BLACK,d),a=this._distanceDisplayConditionProperty.getValue(r);return new e({id:o,geometry:new c(this._options),attributes:{show:new s(h&&o.isShowing&&this._showProperty.getValue(r)&&this._showOutlineProperty.getValue(r)),color:i.fromColor(l),distanceDisplayCondition:f.fromDistanceDisplayCondition(a)}})},b.prototype._isHidden=function(n,t){return!r(t.positions)||p.prototype._isHidden.call(this,n,t)},b.prototype._getIsClosed=function(){return!1},b.prototype._isDynamic=function(n,t){return!t.positions.isConstant||!w.isConstant(t.minimumHeights)||!w.isConstant(t.maximumHeights)||!w.isConstant(t.outlineWidth)||!w.isConstant(t.granularity)},b.prototype._setStaticOptions=function(n,t){var u=t.minimumHeights,f=t.maximumHeights,e=t.granularity,s=this._materialProperty instanceof v,i=this._options;i.vertexFormat=s?a.VERTEX_FORMAT:l.MaterialSupport.TEXTURED.vertexFormat;i.positions=t.positions.getValue(o.MINIMUM_VALUE,i.positions);i.minimumHeights=r(u)?u.getValue(o.MINIMUM_VALUE,i.minimumHeights):undefined;i.maximumHeights=r(f)?f.getValue(o.MINIMUM_VALUE,i.maximumHeights):undefined;i.granularity=r(e)?e.getValue(o.MINIMUM_VALUE):undefined},b.DynamicGeometryUpdater=k,r(Object.create)&&(k.prototype=Object.create(y.prototype),k.prototype.constructor=k),k.prototype._isHidden=function(n,t,i){return!r(this._options.positions)||y.prototype._isHidden.call(this,n,t,i)},k.prototype._setOptions=function(n,t,i){var r=this._options;r.positions=w.getValueOrUndefined(t.positions,i,r.positions);r.minimumHeights=w.getValueOrUndefined(t.minimumHeights,i,r.minimumHeights);r.maximumHeights=w.getValueOrUndefined(t.maximumHeights,i,r.maximumHeights);r.granularity=w.getValueOrUndefined(t.granularity,i)},b});t("DataSources/GeometryVisualizer",["../Core/AssociativeArray","../Core/BoundingSphere","../Core/Check","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/Event","../Core/EventHelper","../Scene/ClassificationType","../Scene/MaterialAppearance","../Scene/PerInstanceColorAppearance","../Scene/ShadowMode","./BoundingSphereState","./BoxGeometryUpdater","./ColorMaterialProperty","./CorridorGeometryUpdater","./CylinderGeometryUpdater","./DynamicGeometryBatch","./EllipseGeometryUpdater","./EllipsoidGeometryUpdater","./Entity","./PlaneGeometryUpdater","./PolygonGeometryUpdater","./PolylineVolumeGeometryUpdater","./RectangleGeometryUpdater","./StaticGeometryColorBatch","./StaticGeometryPerMaterialBatch","./StaticGroundGeometryColorBatch","./StaticGroundGeometryPerMaterialBatch","./StaticOutlineGeometryBatch","./WallGeometryUpdater"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){"use strict";function lt(n,t){function h(n){u.raiseEvent(n)}var r,u,f,i,s;for(this.entity=n,this.scene=t,r=new Array(at.length),u=new e,f=new o,i=0;i<r.length;i++)s=new at[i](n,t),f.add(s.geometryChanged,h),r[i]=s;this.updaters=r;this.geometryChanged=u;this.eventHelper=f;this._removeEntitySubscription=n.definitionChanged.addEventListener(lt.prototype._onEntityPropertyChanged,this)}function ct(t,u,f,e){var a,y,o;for(i.defined("scene",t),i.defined("entityCollection",u),f=r(f,t.primitives),e=r(e,t.groundPrimitives),this._scene=t,this._primitives=f,this._groundPrimitives=e,this._entityCollection=undefined,this._addedObjects=new n,this._removedObjects=new n,this._changedObjects=new n,a=l.NUMBER_OF_SHADOW_MODES,this._outlineBatches=new Array(a*2),this._closedColorBatches=new Array(a*2),this._closedMaterialBatches=new Array(a*2),this._openColorBatches=new Array(a*2),this._openMaterialBatches=new Array(a*2),y=g.supportsMaterialsforEntitiesOnTerrain(t),this._supportsMaterialsforEntitiesOnTerrain=y,o=0;o<a;++o)this._outlineBatches[o]=new st(f,t,o,!1),this._outlineBatches[a+o]=new st(f,t,o,!0),this._closedColorBatches[o]=new ut(f,c,undefined,!0,o,!0),this._closedColorBatches[a+o]=new ut(f,c,undefined,!0,o,!1),this._closedMaterialBatches[o]=new ft(f,h,undefined,!0,o,!0),this._closedMaterialBatches[a+o]=new ft(f,h,undefined,!0,o,!1),this._openColorBatches[o]=new ut(f,c,undefined,!1,o,!0),this._openColorBatches[a+o]=new ut(f,c,undefined,!1,o,!1),this._openMaterialBatches[o]=new ft(f,h,undefined,!1,o,!0),this._openMaterialBatches[a+o]=new ft(f,h,undefined,!1,o,!1);var p=s.NUMBER_OF_CLASSIFICATION_TYPES,v=new Array(p),w=[];if(y){for(v[s.TERRAIN]=new ot(e,c),o=0;o<p;++o)o!==s.TERRAIN&&(v[o]=new et(e,o));w[0]=new ot(e,h);this._groundTerrainMaterialBatch=w[0]}else for(o=0;o<p;++o)v[o]=new et(e,o);this._groundColorBatches=v;this._dynamicBatch=new b(f,e);this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,w,this._dynamicBatch);this._subscriptions=new n;this._updaterSets=new n;this._entityCollection=u;u.collectionChanged.addEventListener(ct.prototype._onCollectionChanged,this);this._onCollectionChanged(u,u.values,pt)}var pt=[],at=[v,w,p,k,d,nt,tt,it,rt,ht],vt,yt;return lt.prototype._onEntityPropertyChanged=function(n,t,i,r){for(var f=this.updaters,u=0;u<f.length;u++)f[u]._onEntityPropertyChanged(n,t,i,r)},lt.prototype.forEach=function(n){for(var i=this.updaters,t=0;t<i.length;t++)n(i[t])},lt.prototype.destroy=function(){var t,n;for(this.eventHelper.removeAll(),t=this.updaters,n=0;n<t.length;n++)t[n].destroy();this._removeEntitySubscription();f(this)},ct.prototype.update=function(n){i.defined("time",n);for(var c=this._addedObjects,e=c.values,l=this._removedObjects,o=l.values,a=this._changedObjects,v=a.values,r,u,f,s=this,t=v.length-1;t>-1;t--)r=v[t],u=r.id,f=this._updaterSets.get(u),f.entity===r?f.forEach(function(t){s._removeUpdater(t);s._insertUpdaterIntoBatch(n,t)}):(o.push(r),e.push(r));for(t=o.length-1;t>-1;t--)r=o[t],u=r.id,f=this._updaterSets.get(u),f.forEach(this._removeUpdater.bind(this)),f.destroy(),this._updaterSets.remove(u),this._subscriptions.get(u)(),this._subscriptions.remove(u);for(t=e.length-1;t>-1;t--)r=e[t],u=r.id,f=new lt(r,this._scene),this._updaterSets.set(u,f),f.forEach(function(t){s._insertUpdaterIntoBatch(n,t)}),this._subscriptions.set(u,f.geometryChanged.addEventListener(ct._onGeometryChanged,this));c.removeAll();l.removeAll();a.removeAll();var h=!0,y=this._batches,p=y.length;for(t=0;t<p;t++)h=y[t].update(n)&&h;return h},vt=[],yt=new t,ct.prototype.getBoundingSphere=function(n,r){var e,v,o;i.defined("entity",n);i.defined("result",r);var f=vt,h=yt,u=0,s=a.DONE,c=this._batches,y=c.length,p=n.id,l=this._updaterSets.get(p).updaters;for(e=0;e<l.length;e++)for(v=l[e],o=0;o<y;o++){if(s=c[o].getBoundingSphere(v,h),s===a.PENDING)return a.PENDING;s===a.DONE&&(f[u]=t.clone(h,f[u]),u++)}return u===0?a.FAILED:(f.length=u,t.fromBoundingSpheres(f,r),a.DONE)},ct.prototype.isDestroyed=function(){return!1},ct.prototype.destroy=function(){var n,i,t,r;for(this._entityCollection.collectionChanged.removeEventListener(ct.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll(),i=this._batches,t=i.length,n=0;n<t;n++)i[n].removeAllPrimitives();for(r=this._subscriptions.values,t=r.length,n=0;n<t;n++)r[n]();return this._subscriptions.removeAll(),f(this)},ct.prototype._removeUpdater=function(n){for(var i=this._batches,r=i.length,t=0;t<r;t++)i[t].remove(n)},ct.prototype._insertUpdaterIntoBatch=function(n,t){var i,r,f;if(t.isDynamic){this._dynamicBatch.add(n,t);return}(t.outlineEnabled||t.fillEnabled)&&(i=t.shadowsProperty.getValue(n));r=l.NUMBER_OF_SHADOW_MODES;t.outlineEnabled&&(u(t.terrainOffsetProperty)?this._outlineBatches[r+i].add(n,t):this._outlineBatches[i].add(n,t));t.fillEnabled&&(t.onTerrain?(f=t.classificationTypeProperty.getValue(n),t.fillMaterialProperty instanceof y?this._groundColorBatches[f].add(n,t):this._groundTerrainMaterialBatch.add(n,t)):t.isClosed?t.fillMaterialProperty instanceof y?u(t.terrainOffsetProperty)?this._closedColorBatches[r+i].add(n,t):this._closedColorBatches[i].add(n,t):u(t.terrainOffsetProperty)?this._closedMaterialBatches[r+i].add(n,t):this._closedMaterialBatches[i].add(n,t):t.fillMaterialProperty instanceof y?u(t.terrainOffsetProperty)?this._openColorBatches[r+i].add(n,t):this._openColorBatches[i].add(n,t):u(t.terrainOffsetProperty)?this._openMaterialBatches[r+i].add(n,t):this._openMaterialBatches[i].add(n,t))},ct._onGeometryChanged=function(n){var f=this._removedObjects,i=this._changedObjects,r=n.entity,t=r.id;u(f.get(t))||u(i.get(t))||i.set(t,r)},ct.prototype._onCollectionChanged=function(n,t,i){for(var e=this._addedObjects,o=this._removedObjects,s=this._changedObjects,u,f,r=i.length-1;r>-1;r--)f=i[r],u=f.id,e.remove(u)||(o.set(u,f),s.remove(u));for(r=t.length-1;r>-1;r--)f=t[r],u=f.id,o.remove(u)?s.set(u,f):e.set(u,f)},ct});t("DataSources/LabelVisualizer",["../Core/AssociativeArray","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/NearFarScalar","../Scene/HeightReference","../Scene/HorizontalOrigin","../Scene/LabelStyle","../Scene/VerticalOrigin","./BoundingSphereState","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function k(n){this.entity=n;this.label=undefined;this.index=undefined}function w(t,i){if(!f(t))throw new o("entityCluster is required.");if(!f(i))throw new o("entityCollection is required.");i.collectionChanged.addEventListener(w.prototype._onCollectionChanged,this);this._cluster=t;this._entityCollection=i;this._items=new n;this._onCollectionChanged(i,i.values,[],[])}function b(n,t,i){f(n)&&(n.label=undefined,i.removeLabel(t))}var d=1,g="30px sans-serif",nt=a.FILL,tt=r.WHITE,it=r.BLACK,rt=1,ut=!1,ft=new r(.165,.165,.165,.8),et=new t(7,5),ot=t.ZERO,st=i.ZERO,ht=c.NONE,ct=l.CENTER,lt=v.CENTER,at=new i,vt=new r,yt=new r,pt=new r,wt=new t,bt=new i,kt=new t,dt=new h,gt=new h,ni=new h,ti=new s;return w.prototype.update=function(n){var h,u,e,v;if(!f(n))throw new o("time is required.");for(h=this._items.values,u=this._cluster,e=0,v=h.length;e<v;e++){var s=h[e],r=s.entity,i=r._label,c,t=s.label,l=r.isShowing&&r.isAvailable(n)&&p.getValueOrDefault(i._show,n,!0),a;if(l&&(a=p.getValueOrUndefined(r._position,n,at),c=p.getValueOrUndefined(i._text,n),l=f(a)&&f(c)),!l){b(s,r,u);continue}p.isConstant(r._position)||(u._clusterDirty=!0);f(t)||(t=u.getLabel(r),t.id=r,s.label=t);t.show=!0;t.position=a;t.text=c;t.scale=p.getValueOrDefault(i._scale,n,d);t.font=p.getValueOrDefault(i._font,n,g);t.style=p.getValueOrDefault(i._style,n,nt);t.fillColor=p.getValueOrDefault(i._fillColor,n,tt,vt);t.outlineColor=p.getValueOrDefault(i._outlineColor,n,it,yt);t.outlineWidth=p.getValueOrDefault(i._outlineWidth,n,rt);t.showBackground=p.getValueOrDefault(i._showBackground,n,ut);t.backgroundColor=p.getValueOrDefault(i._backgroundColor,n,ft,pt);t.backgroundPadding=p.getValueOrDefault(i._backgroundPadding,n,et,wt);t.pixelOffset=p.getValueOrDefault(i._pixelOffset,n,ot,kt);t.eyeOffset=p.getValueOrDefault(i._eyeOffset,n,st,bt);t.heightReference=p.getValueOrDefault(i._heightReference,n,ht);t.horizontalOrigin=p.getValueOrDefault(i._horizontalOrigin,n,ct);t.verticalOrigin=p.getValueOrDefault(i._verticalOrigin,n,lt);t.translucencyByDistance=p.getValueOrUndefined(i._translucencyByDistance,n,dt);t.pixelOffsetScaleByDistance=p.getValueOrUndefined(i._pixelOffsetScaleByDistance,n,gt);t.scaleByDistance=p.getValueOrUndefined(i._scaleByDistance,n,ni);t.distanceDisplayCondition=p.getValueOrUndefined(i._distanceDisplayCondition,n,ti);t.disableDepthTestDistance=p.getValueOrUndefined(i._disableDepthTestDistance,n)}return!0},w.prototype.getBoundingSphere=function(n,t){var r,e;if(!f(n))throw new o("entity is required.");if(!f(t))throw new o("result is required.");return(r=this._items.get(n.id),!f(r)||!f(r.label))?y.FAILED:(e=r.label,t.center=i.clone(u(e._clampedPosition,e.position),t.center),t.radius=0,y.DONE)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){var t,n;for(this._entityCollection.collectionChanged.removeEventListener(w.prototype._onCollectionChanged,this),t=this._entityCollection.values,n=0;n<t.length;n++)this._cluster.removeLabel(t[n]);return e(this)},w.prototype._onCollectionChanged=function(n,t,i,r){for(var u,o=this._items,s=this._cluster,e=t.length-1;e>-1;e--)u=t[e],f(u._label)&&f(u._position)&&o.set(u.id,new k(u));for(e=r.length-1;e>-1;e--)u=r[e],f(u._label)&&f(u._position)?o.contains(u.id)||o.set(u.id,new k(u)):(b(o.get(u.id),u,s),o.remove(u.id));for(e=i.length-1;e>-1;e--)u=i[e],b(o.get(u.id),u,s),o.remove(u.id)},w});t("ThirdParty/GltfPipeline/addToArray",["../../Core/defaultValue"],function(n){"use strict";function t(t,i,r){if(r=n(r,!1),r){var u=t.indexOf(i);if(u>-1)return u}return t.push(i),t.length-1}return t});t("ThirdParty/GltfPipeline/hasExtension",["../../Core/defined"],function(n){"use strict";function t(t,i){return n(t.extensionsUsed)&&t.extensionsUsed.indexOf(i)>=0}return t});t("ThirdParty/GltfPipeline/ForEach",["./hasExtension","../../Core/defined","../../Core/isArray"],function(n,t,i){"use strict";function r(){}return r.objectLegacy=function(n,i){var r,f,u;if(t(n))for(r in n)if(n.hasOwnProperty(r)&&(f=n[r],u=i(f,r),t(u)))return u},r.object=function(n,i){var f,r,e,u;if(t(n))for(f=n.length,r=0;r<f;r++)if(e=n[r],u=i(e,r),t(u))return u},r.topLevel=function(n,u,f){var e=n[u];return t(e)&&!i(e)?r.objectLegacy(e,f):r.object(e,f)},r.accessor=function(n,t){return r.topLevel(n,"accessors",t)},r.accessorWithSemantic=function(n,i,u){var f={};return r.mesh(n,function(n){return r.meshPrimitive(n,function(n){var e=r.meshPrimitiveAttribute(n,function(n,r){if(r.indexOf(i)===0&&!t(f[n])&&(f[n]=!0,e=u(n),t(e)))return e});return t(e)?e:r.meshPrimitiveTarget(n,function(n){return r.meshPrimitiveTargetAttribute(n,function(n,r){if(r.indexOf(i)===0&&!t(f[n])&&(f[n]=!0,e=u(n),t(e)))return e})})})})},r.accessorContainingVertexAttributeData=function(n,i){var u={};return r.mesh(n,function(n){return r.meshPrimitive(n,function(n){var f=r.meshPrimitiveAttribute(n,function(n){if(!t(u[n])&&(u[n]=!0,f=i(n),t(f)))return f});return t(f)?f:r.meshPrimitiveTarget(n,function(n){return r.meshPrimitiveTargetAttribute(n,function(n){if(!t(u[n])&&(u[n]=!0,f=i(n),t(f)))return f})})})})},r.accessorContainingIndexData=function(n,i){var u={};return r.mesh(n,function(n){return r.meshPrimitive(n,function(n){var r=n.indices,f;if(t(r)&&!t(u[r])&&(u[r]=!0,f=i(r),t(f)))return f})})},r.animation=function(n,t){return r.topLevel(n,"animations",t)},r.animationChannel=function(n,t){var i=n.channels;return r.object(i,t)},r.animationSampler=function(n,t){var i=n.samplers;return r.object(i,t)},r.buffer=function(n,t){return r.topLevel(n,"buffers",t)},r.bufferView=function(n,t){return r.topLevel(n,"bufferViews",t)},r.camera=function(n,t){return r.topLevel(n,"cameras",t)},r.image=function(n,t){return r.topLevel(n,"images",t)},r.compressedImage=function(n,i){var r,u,e,f;if(t(n.extras)){r=n.extras.compressedImage3DTiles;for(u in r)if(r.hasOwnProperty(u)&&(e=r[u],f=i(e,u),t(f)))return f}},r.material=function(n,t){return r.topLevel(n,"materials",t)},r.materialValue=function(n,i){var r=n.values,u,f;t(n.extensions)&&t(n.extensions.KHR_techniques_webgl)&&(r=n.extensions.KHR_techniques_webgl.values);for(u in r)if(r.hasOwnProperty(u)&&(f=i(r[u],u),t(f)))return f},r.mesh=function(n,t){return r.topLevel(n,"meshes",t)},r.meshPrimitive=function(n,i){var u=n.primitives,e,r,o,f;if(t(u))for(e=u.length,r=0;r<e;r++)if(o=u[r],f=i(o,r),t(f))return f},r.meshPrimitiveAttribute=function(n,i){var u=n.attributes,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),t(f)))return f},r.meshPrimitiveTarget=function(n,i){var u=n.targets,e,r,f;if(t(u))for(e=u.length,r=0;r<e;++r)if(f=i(u[r],r),t(f))return f},r.meshPrimitiveTargetAttribute=function(n,i){var r,f,u;for(r in n)if(n.hasOwnProperty(r)&&(f=n[r],u=i(f,r),t(u)))return u},r.node=function(n,t){return r.topLevel(n,"nodes",t)},r.nodeInTree=function(n,i,u){var c=n.nodes,l,e,s,o,f,h;if(t(c))for(l=i.length,e=0;e<l;e++)if(s=i[e],o=c[s],t(o)&&((f=u(o,s),t(f))||(h=o.children,t(h)&&(f=r.nodeInTree(n,h,u),t(f)))))return f},r.nodeInScene=function(n,i,u){var f=i.nodes;if(t(f))return r.nodeInTree(n,f,u)},r.program=function(t,i){return n(t,"KHR_techniques_webgl")?r.object(t.extensions.KHR_techniques_webgl.programs,i):r.topLevel(t,"programs",i)},r.sampler=function(n,t){return r.topLevel(n,"samplers",t)},r.scene=function(n,t){return r.topLevel(n,"scenes",t)},r.shader=function(t,i){return n(t,"KHR_techniques_webgl")?r.object(t.extensions.KHR_techniques_webgl.shaders,i):r.topLevel(t,"shaders",i)},r.skin=function(n,t){return r.topLevel(n,"skins",t)},r.techniqueAttribute=function(n,i){var u=n.attributes,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),t(f)))return f},r.techniqueUniform=function(n,i){var u=n.uniforms,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),t(f)))return f},r.techniqueParameter=function(n,i){var u=n.parameters,r,f;for(r in u)if(u.hasOwnProperty(r)&&(f=i(u[r],r),t(f)))return f},r.technique=function(t,i){return n(t,"KHR_techniques_webgl")?r.object(t.extensions.KHR_techniques_webgl.techniques,i):r.topLevel(t,"techniques",i)},r.texture=function(n,t){return r.topLevel(n,"textures",t)},r});t("ThirdParty/GltfPipeline/numberOfComponentsForType",[],function(){"use strict";function n(n){switch(n){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}}return n});t("ThirdParty/GltfPipeline/getAccessorByteStride",["./numberOfComponentsForType","../../Core/ComponentDatatype","../../Core/defined"],function(n,t,i){"use strict";function r(r,u){var e=u.bufferView,f;return i(e)&&(f=r.bufferViews[e],i(f.byteStride)&&f.byteStride>0)?f.byteStride:t.getSizeInBytes(u.componentType)*n(u.type)}return r});t("ThirdParty/GltfPipeline/addDefaults",["./addToArray","./ForEach","./getAccessorByteStride","../../Core/defaultValue","../../Core/defined","../../Core/WebGLConstants"],function(n,t,i,r,u,f){"use strict";function o(o){t.accessor(o,function(n){u(n.bufferView)&&(n.byteOffset=r(n.byteOffset,0))});t.bufferView(o,function(n){u(n.buffer)&&(n.byteOffset=r(n.byteOffset,0))});t.mesh(o,function(i){t.meshPrimitive(i,function(t){if(t.mode=r(t.mode,f.TRIANGLES),!u(t.material)){u(o.materials)||(o.materials=[]);t.material=n(o.materials,{name:"default"})}})});t.accessorContainingVertexAttributeData(o,function(n){var t=o.accessors[n],s=t.bufferView,e;t.normalized=r(t.normalized,!1);u(s)&&(e=o.bufferViews[s],e.byteStride=i(o,t),e.target=f.ARRAY_BUFFER)});t.accessorContainingIndexData(o,function(n){var r=o.accessors[n],t=r.bufferView,i;u(t)&&(i=o.bufferViews[t],i.target=f.ELEMENT_ARRAY_BUFFER)});t.material(o,function(n){var h=r(n.extensions,r.EMPTY_OBJECT),s=h.KHR_materials_common,c,i,l,f,o;if(u(s)){c=s.technique;i=u(s.values)?s.values:{};s.values=i;i.ambient=u(i.ambient)?i.ambient:[0,0,0,1];i.emission=u(i.emission)?i.emission:[0,0,0,1];i.transparency=r(i.transparency,1);i.transparent=r(i.transparent,!1);i.doubleSided=r(i.doubleSided,!1);c!=="CONSTANT"&&(i.diffuse=u(i.diffuse)?i.diffuse:[0,0,0,1],c!=="LAMBERT"&&(i.specular=u(i.specular)?i.specular:[0,0,0,1],i.shininess=r(i.shininess,0)));return}n.emissiveFactor=r(n.emissiveFactor,[0,0,0]);n.alphaMode=r(n.alphaMode,"OPAQUE");n.doubleSided=r(n.doubleSided,!1);n.alphaMode==="MASK"&&(n.alphaCutoff=r(n.alphaCutoff,.5));l=h.KHR_techniques_webgl;u(l)&&t.materialValue(n,function(n){u(n.index)&&e(n)});e(n.emissiveTexture);e(n.normalTexture);e(n.occlusionTexture);f=n.pbrMetallicRoughness;u(f)&&(f.baseColorFactor=r(f.baseColorFactor,[1,1,1,1]),f.metallicFactor=r(f.metallicFactor,1),f.roughnessFactor=r(f.roughnessFactor,1),e(f.baseColorTexture),e(f.metallicRoughnessTexture));o=h.pbrSpecularGlossiness;u(o)&&(o.diffuseFactor=r(o.diffuseFactor,[1,1,1,1]),o.specularFactor=r(o.specularFactor,[1,1,1]),o.glossinessFactor=r(o.glossinessFactor,1),e(o.specularGlossinessTexture))});t.animation(o,function(n){t.animationSampler(n,function(n){n.interpolation=r(n.interpolation,"LINEAR")})});var h=s(o);return t.node(o,function(n,t){var i=u(h[t]);i||u(n.translation)||u(n.rotation)||u(n.scale)?(n.translation=r(n.translation,[0,0,0]),n.rotation=r(n.rotation,[0,0,0,1]),n.scale=r(n.scale,[1,1,1])):n.matrix=r(n.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}),t.sampler(o,function(n){n.wrapS=r(n.wrapS,f.REPEAT);n.wrapT=r(n.wrapT,f.REPEAT)}),u(o.scenes)&&!u(o.scene)&&(o.scene=0),o}function s(n){var i={};return t.animation(n,function(n){t.animationChannel(n,function(n){var r=n.target,u=r.node,t=r.path;(t==="translation"||t==="rotation"||t==="scale")&&(i[u]=!0)})}),i}function e(n){u(n)&&(n.texCoord=r(n.texCoord,0))}return o});t("ThirdParty/GltfPipeline/addPipelineExtras",["./ForEach","../../Core/defined"],function(n,t){"use strict";function r(t){return n.shader(t,function(n){i(n)}),n.buffer(t,function(n){i(n)}),n.image(t,function(t){i(t);n.compressedImage(t,function(n){i(n)})}),i(t),t}function i(n){n.extras=t(n.extras)?n.extras:{};n.extras._pipeline=t(n.extras._pipeline)?n.extras._pipeline:{}}return r});t("ThirdParty/GltfPipeline/removeExtensionsRequired",["../../Core/defined"],function(n){"use strict";function t(t,i){var r=t.extensionsRequired,u;n(r)&&(u=r.indexOf(i),u>=0&&r.splice(u,1),r.length===0&&delete t.extensionsRequired)}return t});t("ThirdParty/GltfPipeline/removeExtensionsUsed",["./removeExtensionsRequired","../../Core/defined"],function(n,t){"use strict";function i(i,r){var u=i.extensionsUsed,f;t(u)&&(f=u.indexOf(r),f>=0&&u.splice(f,1),n(i,r),u.length===0&&delete i.extensionsUsed)}return i});t("ThirdParty/GltfPipeline/parseGlb",["./addPipelineExtras","./removeExtensionsUsed","../../Core/defaultValue","../../Core/defined","../../Core/getMagic","../../Core/getStringFromTypedArray","../../Core/RuntimeError"],function(n,t,i,r,u,f,e){"use strict";function h(n){var r=u(n),t,i;if(r!=="glTF")throw new e("File is not valid binary glTF");if(t=o(n,0,5),i=t[1],i!==1&&i!==2)throw new e("Binary glTF version is not 1 or 2");return i===1?c(n,t):l(n,t)}function o(n,t,i){for(var f=new DataView(n.buffer),u=new Array(i),r=0;r<i;++r)u[r]=f.getUint32(n.byteOffset+t+r*s,!0);return u}function c(u,o){var y=o[2],l=o[3],p=o[4],v,s,c;if(p!==0)throw new e("Binary glTF scene format is not JSON");var a=20,w=a+l,b=f(u,a,l),h=JSON.parse(b);return n(h),v=u.subarray(w,y),s=h.buffers,r(s)&&Object.keys(s).length>0&&(c=i(s.binary_glTF,s.KHR_binary_glTF),r(c)&&(c.extras._pipeline.source=v)),t(h,"KHR_binary_glTF"),h}function l(t,i){for(var w=i[2],u=12,e,h,c,y,s,p;u<w;){var l=o(t,u,2),a=l[0],v=l[1];u+=8;c=t.subarray(u,u+a);u+=a;v===1313821514?(y=f(c),e=JSON.parse(y),n(e)):v===5130562&&(h=c)}return r(e)&&r(h)&&(s=e.buffers,r(s)&&s.length>0&&(p=s[0],p.extras._pipeline.source=h)),e}var s=4;return h});t("ThirdParty/GltfPipeline/removePipelineExtras",["./ForEach","../../Core/defined"],function(n,t){"use strict";function r(t){return n.shader(t,function(n){i(n)}),n.buffer(t,function(n){i(n)}),n.image(t,function(t){i(t);n.compressedImage(t,function(n){i(n)})}),i(t),t}function i(n){t(n.extras)&&(t(n.extras._pipeline)&&delete n.extras._pipeline,Object.keys(n.extras).length===0&&delete n.extras)}return r});t("ThirdParty/GltfPipeline/addExtensionsUsed",["./addToArray","../../Core/defined"],function(n,t){"use strict";function i(i,r){var u=i.extensionsUsed;t(u)||(u=[],i.extensionsUsed=u);n(u,r,!0)}return i});t("ThirdParty/GltfPipeline/getComponentReader",["../../Core/ComponentDatatype"],function(n){"use strict";function t(t){switch(t){case n.BYTE:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getInt8(t+f*r)};case n.UNSIGNED_BYTE:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getUint8(t+f*r)};case n.SHORT:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getInt16(t+f*r,!0)};case n.UNSIGNED_SHORT:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getUint16(t+f*r,!0)};case n.INT:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getInt32(t+f*r,!0)};case n.UNSIGNED_INT:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getUint32(t+f*r,!0)};case n.FLOAT:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getFloat32(t+f*r,!0)};case n.DOUBLE:return function(n,t,i,r,u){for(var f=0;f<i;++f)u[f]=n.getFloat64(t+f*r,!0)}}}return t});t("ThirdParty/GltfPipeline/findAccessorMinMax",["./getAccessorByteStride","./getComponentReader","./numberOfComponentsForType","../../Core/arrayFill","../../Core/ComponentDatatype","../../Core/defined"],function(n,t,i,r,u,f){"use strict";function e(e,o){var d=e.bufferViews,g=e.buffers,nt=o.bufferView,h=i(o.type),a,s,v;if(!f(o.bufferView))return{min:r(new Array(h),0),max:r(new Array(h),0)};var c=r(new Array(h),Number.POSITIVE_INFINITY),l=r(new Array(h),Number.NEGATIVE_INFINITY),y=d[nt],tt=y.buffer,it=g[tt],p=it.extras._pipeline.source,rt=o.count,ut=n(e,o),w=o.byteOffset+y.byteOffset+p.byteOffset,b=o.componentType,ft=u.getSizeInBytes(b),et=new DataView(p.buffer),k=new Array(h),ot=t(b);for(a=0;a<rt;a++){for(ot(et,w,h,ft,k),s=0;s<h;s++)v=k[s],c[s]=Math.min(c[s],v),l[s]=Math.max(l[s],v);w+=ut}return{min:c,max:l}}return e});t("ThirdParty/GltfPipeline/moveTechniqueRenderStates",["./addExtensionsUsed","./ForEach","../../Core/defaultValue","../../Core/defined","../../Core/WebGLConstants"],function(n,t,i,r,u){"use strict";function f(n,t){var i=n.enable;return r(i)?i.indexOf(t)>-1:!1}function h(n,t){if(!r(n))return t;for(var i=0;i<4;i++)if(s.indexOf(n[i])===-1)return t;return n}function c(s){var c={},l={},a=s.techniques;return r(a)?(t.technique(s,function(n,t){var a=n.states,v,s;r(a)&&(v=l[t]={},f(a,u.BLEND)&&(v.alphaMode="BLEND",s=a.functions,r(s)&&(r(s.blendEquationSeparate)||r(s.blendFuncSeparate))&&(c[t]={blendEquation:i(s.blendEquationSeparate,e),blendFactors:h(s.blendFuncSeparate,o)})),f(a,u.CULL_FACE)||(v.doubleSided=!0),delete n.states)}),Object.keys(c).length>0&&(r(s.extensions)||(s.extensions={}),n(s,"KHR_blend")),t.material(s,function(n){var u,i;r(n.technique)&&(u=l[n.technique],t.objectLegacy(u,function(t,i){n[i]=t}),i=c[n.technique],r(i)&&(r(n.extensions)||(n.extensions={}),n.extensions.KHR_blend=i))}),s):s}var e=[u.FUNC_ADD,u.FUNC_ADD],o=[u.ONE,u.ZERO,u.ONE,u.ZERO],s=[u.ZERO,u.ONE,u.SRC_COLOR,u.ONE_MINUS_SRC_COLOR,u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.DST_ALPHA,u.ONE_MINUS_DST_ALPHA,u.DST_COLOR,u.ONE_MINUS_DST_COLOR];return c});t("ThirdParty/GltfPipeline/addExtensionsRequired",["./addExtensionsUsed","./addToArray","../../Core/defined"],function(n,t,i){"use strict";function r(r,u){var f=r.extensionsRequired;i(f)||(f=[],r.extensionsRequired=f);t(f,u,!0);n(r,u)}return r});t("ThirdParty/GltfPipeline/moveTechniquesToExtension",["./addExtensionsUsed","./addExtensionsRequired","./addToArray","./ForEach","../../Core/defined"],function(n,t,i,r,u){"use strict";function f(f){var c=f.techniques,o={},s={},e,h;return u(c)&&(e={programs:[],shaders:[],techniques:[]},h=f.glExtensionsUsed,delete f.glExtensionsUsed,r.technique(f,function(n,t){var c={name:n.name,program:undefined,attributes:{},uniforms:{}},u,v;r.techniqueAttribute(n,function(t,i){u=n.parameters[t];c.attributes[i]={semantic:u.semantic}});r.techniqueUniform(n,function(t,i){u=n.parameters[t];c.uniforms[i]={count:u.count,node:u.node,type:u.type,semantic:u.semantic,value:u.value};o[t]=i});var l=f.programs[n.program],a={name:l.name,fragmentShader:undefined,vertexShader:undefined,glExtensions:h},y=f.shaders[l.fragmentShader];a.fragmentShader=i(e.shaders,y,!0);v=f.shaders[l.vertexShader];a.vertexShader=i(e.shaders,v,!0);c.program=i(e.programs,a);s[t]=i(e.techniques,c)}),e.techniques.length>0&&(u(f.extensions)||(f.extensions={}),f.extensions.KHR_techniques_webgl=e,n(f,"KHR_techniques_webgl"),t(f,"KHR_techniques_webgl"))),r.material(f,function(n){if(u(n.technique)){var t={technique:s[n.technique]};r.objectLegacy(n.values,function(n,i){u(t.values)||(t.values={});var r=o[i];t.values[r]=n});u(n.extensions)||(n.extensions={});n.extensions.KHR_techniques_webgl=t}delete n.technique;delete n.values}),delete f.techniques,delete f.programs,delete f.shaders,f}return f});t("ThirdParty/GltfPipeline/removeUnusedElements",["./ForEach","./hasExtension","../../Core/defined"],function(n,t,i){"use strict";function e(n){return f(n,"accessor"),f(n,"bufferView"),f(n,"buffer"),n}function f(n,t){var h=o[t],e=n[h],f;if(i(e)){var s=0,c=u[t](n),l=e.length;for(f=0;f<l;++f)c[f]||(r[t](n,f-s),s++)}}function r(){}function u(){}var o={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews"};return r.accessor=function(t,r){var u=t.accessors;u.splice(r,1);n.mesh(t,function(t){n.meshPrimitive(t,function(t){n.meshPrimitiveAttribute(t,function(n,i){n>r&&t.attributes[i]--});n.meshPrimitiveTarget(t,function(t){n.meshPrimitiveTargetAttribute(t,function(n,i){n>r&&t[i]--})});var u=t.indices;i(u)&&u>r&&t.indices--})});n.skin(t,function(n){i(n.inverseBindMatrices)&&n.inverseBindMatrices>r&&n.inverseBindMatrices--});n.animation(t,function(t){n.animationSampler(t,function(n){i(n.input)&&n.input>r&&n.input--;i(n.output)&&n.output>r&&n.output--})})},r.buffer=function(t,r){var u=t.buffers;u.splice(r,1);n.bufferView(t,function(n){i(n.buffer)&&n.buffer>r&&n.buffer--})},r.bufferView=function(r,u){var f=r.bufferViews;f.splice(u,1);n.accessor(r,function(n){i(n.bufferView)&&n.bufferView>u&&n.bufferView--});n.shader(r,function(n){i(n.bufferView)&&n.bufferView>u&&n.bufferView--});n.image(r,function(t){i(t.bufferView)&&t.bufferView>u&&t.bufferView--;n.compressedImage(t,function(n){var t=n.bufferView;i(t)&&t>u&&n.bufferView--})});t(r,"KHR_draco_mesh_compression")&&n.mesh(r,function(t){n.meshPrimitive(t,function(n){i(n.extensions)&&i(n.extensions.KHR_draco_mesh_compression)&&n.extensions.KHR_draco_mesh_compression.bufferView>u&&n.extensions.KHR_draco_mesh_compression.bufferView--})})},u.accessor=function(t){var r={};return n.mesh(t,function(t){n.meshPrimitive(t,function(t){n.meshPrimitiveAttribute(t,function(n){r[n]=!0});n.meshPrimitiveTarget(t,function(t){n.meshPrimitiveTargetAttribute(t,function(n){r[n]=!0})});var u=t.indices;i(u)&&(r[u]=!0)})}),n.skin(t,function(n){i(n.inverseBindMatrices)&&(r[n.inverseBindMatrices]=!0)}),n.animation(t,function(t){n.animationSampler(t,function(n){i(n.input)&&(r[n.input]=!0);i(n.output)&&(r[n.output]=!0)})}),r},u.buffer=function(t){var r={};return n.bufferView(t,function(n){i(n.buffer)&&(r[n.buffer]=!0)}),r},u.bufferView=function(r){var u={};return n.accessor(r,function(n){i(n.bufferView)&&(u[n.bufferView]=!0)}),n.shader(r,function(n){i(n.bufferView)&&(u[n.bufferView]=!0)}),n.image(r,function(t){i(t.bufferView)&&(u[t.bufferView]=!0);n.compressedImage(t,function(n){i(n.bufferView)&&(u[n.bufferView]=!0)})}),t(r,"KHR_draco_mesh_compression")&&n.mesh(r,function(t){n.meshPrimitive(t,function(n){i(n.extensions)&&i(n.extensions.KHR_draco_mesh_compression)&&(u[n.extensions.KHR_draco_mesh_compression.bufferView]=!0)})}),u},e});t("ThirdParty/GltfPipeline/addBuffer",["./addToArray"],function(n){"use strict";function t(t,i){var r={byteLength:i.length,extras:{_pipeline:{source:i}}},u=n(t.buffers,r),f={buffer:u,byteOffset:0,byteLength:i.length};return n(t.bufferViews,f)}return t});t("ThirdParty/GltfPipeline/readAccessorPacked",["./getAccessorByteStride","./getComponentReader","./numberOfComponentsForType","../../Core/arrayFill","../../Core/ComponentDatatype","../../Core/defined"],function(n,t,i,r,u,f){"use strict";function e(e,o){var b=n(e,o),k=u.getSizeInBytes(o.componentType),s=i(o.type),a=o.count,c=new Array(s*a),l,h;if(!f(o.bufferView))return r(c,0),c;var v=e.bufferViews[o.bufferView],y=e.buffers[v.buffer].extras._pipeline.source,p=o.byteOffset+v.byteOffset+y.byteOffset,d=new DataView(y.buffer),w=new Array(s),g=t(o.componentType);for(l=0;l<a;++l){for(g(d,p,s,k,w),h=0;h<s;++h)c[l*s+h]=w[h];p+=b}return c}return e});t("ThirdParty/GltfPipeline/updateAccessorComponentTypes",["./addBuffer","./ForEach","./readAccessorPacked","../../Core/ComponentDatatype","../../Core/WebGLConstants"],function(n,t,i,r,u){"use strict";function e(n){var i;return t.accessorWithSemantic(n,"JOINTS_0",function(t){var e=n.accessors[t];i=e.componentType;i===u.BYTE?f(n,e,r.UNSIGNED_BYTE):i!==u.UNSIGNED_BYTE&&i!==u.UNSIGNED_SHORT&&f(n,e,r.UNSIGNED_SHORT)}),t.accessorWithSemantic(n,"WEIGHTS_0",function(t){var e=n.accessors[t];i=e.componentType;i===u.BYTE?f(n,e,r.UNSIGNED_BYTE):i===u.SHORT&&f(n,e,r.UNSIGNED_SHORT)}),n}function f(t,u,f){var e=r.createTypedArray(f,i(t,u)),o=new Uint8Array(e.buffer);u.bufferView=n(t,o);u.componentType=f;u.byteOffset=0}return e});t("ThirdParty/GltfPipeline/updateVersion",["./addExtensionsUsed","./addToArray","./findAccessorMinMax","./ForEach","./getAccessorByteStride","./numberOfComponentsForType","./moveTechniqueRenderStates","./moveTechniquesToExtension","./removeUnusedElements","./updateAccessorComponentTypes","../../Core/Cartesian3","../../Core/Cartesian4","../../Core/clone","../../Core/ComponentDatatype","../../Core/defaultValue","../../Core/defined","../../Core/isArray","../../Core/Matrix4","../../Core/Quaternion","../../Core/WebGLConstants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function ft(n,t){var u,i,r;for(t=y(t,y.EMPTY_OBJECT),u=t.targetVersion,i=n.version,n.asset=y(n.asset,{version:"1.0"}),n.asset.version=y(n.asset.version,"1.0"),i=y(i,n.asset.version).toString(),g.hasOwnProperty(i)||(p(i)&&(i=i.substring(0,3)),g.hasOwnProperty(i)||(i="1.0")),r=g[i];p(r);){if(i===u)break;r(n,t);i=n.asset.version;r=g[i]}return n}function tt(n){var r=n.materials,u,t,i;for(u in r)r.hasOwnProperty(u)&&(t=r[u],i=t.instanceTechnique,p(i)&&(t.technique=i.technique,t.values=i.values,delete t.instanceTechnique))}function et(n){var u=n.meshes,f,e,i,o,r,t,s;for(f in u)if(u.hasOwnProperty(f)&&(e=u[f],i=e.primitives,p(i)))for(o=i.length,r=0;r<o;++r)t=i[r],s=y(t.primitive,d.TRIANGLES),t.mode=y(t.mode,s),delete t.primitive}function ot(n){var u=n.nodes,o=new c,i=new k,f,t,e,r;for(f in u)u.hasOwnProperty(f)&&(t=u[f],p(t.rotation)&&(e=t.rotation,c.fromArray(e,0,o),k.fromAxisAngle(o,e[3],i),t.rotation=[i.x,i.y,i.z,i.w]),r=t.instanceSkin,p(r)&&(t.skeletons=r.skeletons,t.skin=r.skin,t.meshes=r.meshes,delete t.instanceSkin))}function st(n){var o=n.animations,ut=n.accessors,ft=n.bufferViews,et=n.buffers,w={},b=new c,d=new k,s,g,i,a,r,u,e,rt;for(s in o)if(o.hasOwnProperty(s)){var h=o[s],l=h.channels,ot=h.parameters,st=h.samplers;if(p(l))for(g=l.length,i=0;i<g;++i)if(a=l[i],a.target.path==="rotation"){if(r=ot[st[a.sampler].output],p(w[r]))continue;w[r]=!0;var t=ut[r],nt=ft[t.bufferView],ht=et[nt.buffer],tt=ht.extras._pipeline.source,ct=tt.byteOffset+nt.byteOffset+t.byteOffset,lt=t.componentType,at=t.count,it=f(t.type),vt=t.count*it,y=v.createArrayBufferView(lt,tt.buffer,ct,vt);for(u=0;u<at;u++)e=u*it,c.unpack(y,e,b),rt=y[e+3],k.fromAxisAngle(b,rt,d),k.pack(d,y,e)}}}function ht(n){var u=n.techniques,f,t,i,e,o,r;for(f in u)u.hasOwnProperty(f)&&(t=u[f],i=t.passes,p(i)&&(e=y(t.pass,"defaultPass"),i.hasOwnProperty(e)&&(o=i[e],r=o.instanceProgram,t.attributes=y(t.attributes,r.attributes),t.program=y(t.program,r.program),t.uniforms=y(t.uniforms,r.uniforms),t.states=y(t.states,o.states)),delete t.passes,delete t.pass))}function ct(t){var i,u,r,f;p(t.asset)||(t.asset={});i=t.asset;i.version="1.0";typeof i.profile=="string"?(u=i.profile.split(" "),i.profile={api:u[0],version:u[1]}):i.profile={};p(t.version)&&delete t.version;tt(t);et(t);ot(t);st(t);ht(t);p(t.allExtensions)&&(t.extensionsUsed=t.allExtensions,delete t.allExtensions);p(t.lights)&&(r=y(t.extensions,{}),t.extensions=r,f=y(r.KHR_materials_common,{}),r.KHR_materials_common=f,f.lights=t.lights,delete t.lights,n(t,"KHR_materials_common"))}function lt(n){var f=n.animations,e,i,r,u,o,t;for(e in f)if(f.hasOwnProperty(e)&&(i=f[e],r=i.parameters,p(r))){u=i.samplers;for(o in u)u.hasOwnProperty(o)&&(t=u[o],t.input=r[t.input],t.output=r[t.output]);delete i.parameters}}function it(n,t){var u=[],i,r;for(i in n)n.hasOwnProperty(i)&&(r=n[i],t[i]=u.length,u.push(r),p(r.name)||(r.name=i));return u}function at(n){var u,i={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},f,e={},h=n.nodes,s,o,c,l;for(s in h)h.hasOwnProperty(s)&&(f=h[s].jointName,p(f)&&(e[f]=s));for(o in n)n.hasOwnProperty(o)&&p(i[o])&&(c={},l=n[o],n[o]=it(l,c),i[o]=c);for(f in e)e.hasOwnProperty(f)&&(e[f]=i.nodes[e[f]]);p(n.scene)&&(n.scene=i.scenes[n.scene]);r.bufferView(n,function(n){p(n.buffer)&&(n.buffer=i.buffers[n.buffer])});r.accessor(n,function(n){p(n.bufferView)&&(n.bufferView=i.bufferViews[n.bufferView])});r.shader(n,function(n){var t=n.extensions,r;p(t)&&(r=t.KHR_binary_glTF,p(r)&&(n.bufferView=i.bufferViews[r.bufferView],delete t.KHR_binary_glTF),Object.keys(t).length===0&&delete n.extensions)});r.program(n,function(n){p(n.vertexShader)&&(n.vertexShader=i.shaders[n.vertexShader]);p(n.fragmentShader)&&(n.fragmentShader=i.shaders[n.fragmentShader])});r.technique(n,function(n){p(n.program)&&(n.program=i.programs[n.program]);r.techniqueParameter(n,function(n){p(n.node)&&(n.node=i.nodes[n.node]);var t=n.value;typeof t=="string"&&(n.value={index:i.textures[t]})})});r.mesh(n,function(n){r.meshPrimitive(n,function(n){p(n.indices)&&(n.indices=i.accessors[n.indices]);r.meshPrimitiveAttribute(n,function(t,r){n.attributes[r]=i.accessors[t]});p(n.material)&&(n.material=i.materials[n.material])})});r.node(n,function(r){var f=r.children,h,e,o,c,l,s,a,v;if(p(f))for(h=f.length,u=0;u<h;++u)f[u]=i.nodes[f[u]];if(p(r.meshes)){if(e=r.meshes,o=e.length,o>0)for(r.mesh=i.meshes[e[0]],u=1;u<o;++u)c={mesh:i.meshes[e[u]]},l=t(n.nodes,c),p(f)||(f=[],r.children=f),f.push(l);delete r.meshes}p(r.camera)&&(r.camera=i.cameras[r.camera]);p(r.skin)&&(r.skin=i.skins[r.skin]);p(r.skeletons)&&(s=r.skeletons,a=s.length,a>0&&p(r.skin)&&(v=n.skins[r.skin],v.skeleton=i.nodes[s[0]]),delete r.skeletons);p(r.jointName)&&delete r.jointName});r.skin(n,function(n){var t,r,f;if(p(n.inverseBindMatrices)&&(n.inverseBindMatrices=i.accessors[n.inverseBindMatrices]),t=n.jointNames,p(t)){for(r=[],f=t.length,u=0;u<f;++u)r[u]=e[t[u]];n.joints=r;delete n.jointNames}});r.scene(n,function(n){var t=n.nodes,r;if(p(t))for(r=t.length,u=0;u<r;++u)t[u]=i.nodes[t[u]]});r.animation(n,function(n){var t={};n.samplers=it(n.samplers,t);r.animationSampler(n,function(n){n.input=i.accessors[n.input];n.output=i.accessors[n.output]});r.animationChannel(n,function(n){n.sampler=t[n.sampler];var r=n.target;p(r)&&(r.node=i.nodes[r.id],delete r.id)})});r.material(n,function(n){var u,t;p(n.technique)&&(n.technique=i.techniques[n.technique]);r.materialValue(n,function(t,r){typeof t=="string"&&(n.values[r]={index:i.textures[t]})});u=n.extensions;p(u)&&(t=u.KHR_materials_common,p(t)&&r.materialValue(t,function(n,r){typeof n=="string"&&(t.values[r]={index:i.textures[n]})}))});r.image(n,function(n){var t=n.extensions,u;p(t)&&(u=t.KHR_binary_glTF,p(u)&&(n.bufferView=i.bufferViews[u.bufferView],n.mimeType=u.mimeType,delete t.KHR_binary_glTF),Object.keys(t).length===0&&delete n.extensions);r.compressedImage(n,function(n){var u=n.extensions,r;p(u)&&(r=u.KHR_binary_glTF,p(r)&&(n.bufferView=i.bufferViews[r.bufferView],n.mimeType=r.mimeType,delete u.KHR_binary_glTF),Object.keys(t).length===0&&delete n.extensions)})});r.texture(n,function(n){p(n.sampler)&&(n.sampler=i.samplers[n.sampler]);p(n.source)&&(n.source=i.images[n.source])})}function vt(n){r.animation(n,function(n){r.animationSampler(n,function(n){delete n.name})})}function yt(n){var t,i;for(t in n)n.hasOwnProperty(t)&&(i=n[t],w(i)&&i.length===0&&delete n[t]);r.node(n,function(n){p(n.children)&&n.children.length===0&&delete n.children})}function pt(n){var t=n.asset;delete t.profile;delete t.premultipliedAlpha}function bt(n){var i=n.extensionsUsed,u,t,r;if(n.extensionsRequired=y(n.extensionsRequired,[]),p(i))for(u=i.length,t=0;t<u;++t)r=i[t],p(wt[r])&&n.extensionsRequired.push(r)}function kt(n){r.buffer(n,function(n){delete n.type})}function dt(n){r.texture(n,function(n){delete n.format;delete n.internalFormat;delete n.target;delete n.type})}function gt(n){r.mesh(n,function(n){r.meshPrimitive(n,function(n){r.meshPrimitiveAttribute(n,function(t,i){i==="TEXCOORD"?n.attributes.TEXCOORD_0=t:i==="COLOR"&&(n.attributes.COLOR_0=t)});delete n.attributes.TEXCOORD;delete n.attributes.COLOR})});r.technique(n,function(n){r.techniqueParameter(n,function(n){var t=n.semantic;p(t)&&(t==="TEXCOORD"?n.semantic="TEXCOORD_0":t==="COLOR"&&(n.semantic="COLOR_0"))})})}function ii(n){var t={};r.mesh(n,function(n){r.meshPrimitive(n,function(n){var i,f,u;r.meshPrimitiveAttribute(n,function(n,i){var r,e;if(i.charAt(0)!=="_"){var u=i.search(/_[0-9]+/g),f=i,o="_0";u>=0&&(f=i.substring(0,u),o=i.substring(u));e=ti[f];p(e)?(r=e+o,t[i]=r):p(ni[f])||(r="_"+i,t[i]=r)}});for(i in t)t.hasOwnProperty(i)&&(f=t[i],u=n.attributes[i],p(u)&&(delete n.attributes[i],n.attributes[f]=u))})});r.technique(n,function(n){r.techniqueParameter(n,function(n){var i=t[n.semantic];p(i)&&(n.semantic=i)})})}function ri(n){r.camera(n,function(n){var t=n.perspective,i,r;p(t)&&(i=t.aspectRatio,p(i)&&i===0&&delete t.aspectRatio,r=t.yfov,p(r)&&r===0&&(t.yfov=1))})}function nt(n,t){return p(t.byteStride)&&t.byteStride!==0?t.byteStride:u(n,t)}function ui(n){r.buffer(n,function(n){p(n.byteLength)||(n.byteLength=n.extras._pipeline.source.length)});r.accessor(n,function(t){var i=t.bufferView;if(p(i)){var r=n.bufferViews[i],u=nt(n,t),f=t.byteOffset+t.count*u;r.byteLength=Math.max(y(r.byteLength,0),f)}})}function fi(n){var i,c,b,k=n.bufferViews,d={},f,o,e,w,it,h,rt;r.accessorContainingVertexAttributeData(n,function(t){var i=n.accessors[t];p(i.bufferView)&&(d[i.bufferView]=!0)});f={};r.accessor(n,function(n){p(n.bufferView)&&(f[n.bufferView]=y(f[n.bufferView],[]),f[n.bufferView].push(n))});for(o in f)if(f.hasOwnProperty(o)){b=k[o];e=f[o];e.sort(function(n,t){return n.byteOffset-t.byteOffset});var l=0,g=0,tt=e.length;for(i=0;i<tt;++i){var u=e[i],v=nt(n,u),ut=u.byteOffset,ft=u.count*v;if(delete u.byteStride,w=i<tt-1,it=w?nt(n,e[i+1]):undefined,v!==it){for(h=a(b,!0),d[o]&&(h.byteStride=v),h.byteOffset+=l,h.byteLength=ut+ft-l,rt=t(k,h),c=g;c<=i;++c)u=e[c],u.bufferView=rt,u.byteOffset=u.byteOffset-l;l=w?e[i+1].byteOffset:undefined;g=i+1}}}s(n)}function ei(n){r.accessorWithSemantic(n,"POSITION",function(t){var r=n.accessors[t],u;p(r.min)&&p(r.max)||(u=i(n,r),r.min=u.min,r.max=u.max)})}function rt(n){return(!p(n.children)||n.children.length===0)&&(!p(n.meshes)||n.meshes.length===0)&&!p(n.camera)&&!p(n.skin)&&!p(n.skeletons)&&!p(n.jointName)&&(!p(n.translation)||c.fromArray(n.translation).equals(c.ZERO))&&(!p(n.scale)||c.fromArray(n.scale).equals(new c(1,1,1)))&&(!p(n.rotation)||l.fromArray(n.rotation).equals(new l(0,0,0,1)))&&(!p(n.matrix)||b.fromColumnMajorArray(n.matrix).equals(b.IDENTITY))}function ut(n,t){r.scene(n,function(n){var r=n.nodes,u,i;if(p(r))for(u=r.length,i=u;i>=0;--i)if(r[i]===t){r.splice(i,1);return}});r.node(n,function(i,r){if(p(i.children)){var u=i.children.indexOf(t);u>-1&&(i.children.splice(u,1),rt(i)&&ut(n,r))}});delete n.nodes[t]}function oi(n){return r.node(n,function(t,i){rt(t)&&ut(n,i)}),n}function si(n){r.animation(n,function(t){r.animationSampler(t,function(t){var r=n.accessors[t.input],u;p(r.min)&&p(r.max)||(u=i(n,r),r.min=u.min,r.max=u.max)})})}function hi(n){n.asset=y(n.asset,{});n.asset.version="2.0";tt(n);lt(n);oi(n);at(n);vt(n);pt(n);bt(n);ui(n);fi(n);ei(n);si(n);kt(n);dt(n);gt(n);ii(n);h(n);ri(n);e(n);o(n);yt(n)}var g={"0.8":ct,"1.0":hi,"2.0":undefined},wt={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0},ni={POSITION:!0,NORMAL:!0,TANGENT:!0},ti={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};return ft});t("Scene/Axis",["../Core/Check","../Core/freezeObject","../Core/Math","../Core/Matrix3","../Core/Matrix4"],function(n,t,i,r,u){"use strict";var f={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:u.fromRotationTranslation(r.fromRotationX(i.PI_OVER_TWO)),Z_UP_TO_Y_UP:u.fromRotationTranslation(r.fromRotationX(-i.PI_OVER_TWO)),X_UP_TO_Z_UP:u.fromRotationTranslation(r.fromRotationY(-i.PI_OVER_TWO)),Z_UP_TO_X_UP:u.fromRotationTranslation(r.fromRotationY(i.PI_OVER_TWO)),X_UP_TO_Y_UP:u.fromRotationTranslation(r.fromRotationZ(i.PI_OVER_TWO)),Y_UP_TO_X_UP:u.fromRotationTranslation(r.fromRotationZ(-i.PI_OVER_TWO)),fromName:function(t){return n.typeOf.string("name",t),f[t]}};return t(f)});t("Scene/ClippingPlane",["../Core/Cartesian3","../Core/Check","../Core/defined","../Core/defineProperties"],function(n,t,i,r){"use strict";function u(n,i){t.typeOf.object("normal",n);t.typeOf.number("distance",i);this._distance=i;this._normal=new f(n,this);this.onChangeCallback=undefined;this.index=-1}function f(t,i){this._clippingPlane=i;this._cartesian3=n.clone(t)}return r(u.prototype,{distance:{get:function(){return this._distance},set:function(n){if(t.typeOf.number("value",n),i(this.onChangeCallback)&&n!==this._distance)this.onChangeCallback(this.index);this._distance=n}},normal:{get:function(){return this._normal},set:function(r){if(t.typeOf.object("value",r),i(this.onChangeCallback)&&!n.equals(this._normal._cartesian3,r))this.onChangeCallback(this.index);n.clone(r,this._normal._cartesian3)}}}),u.fromPlane=function(n,r){return t.typeOf.object("plane",n),i(r)?(r.normal=n.normal,r.distance=n.distance):r=new u(n.normal,n.distance),r},u.clone=function(n,t){return i(t)?(t.normal=n.normal,t.distance=n.distance,t):new u(n.normal,n.distance)},r(f.prototype,{x:{get:function(){return this._cartesian3.x},set:function(n){if(t.typeOf.number("value",n),i(this._clippingPlane.onChangeCallback)&&n!==this._cartesian3.x)this._clippingPlane.onChangeCallback(this._clippingPlane.index);this._cartesian3.x=n}},y:{get:function(){return this._cartesian3.y},set:function(n){if(t.typeOf.number("value",n),i(this._clippingPlane.onChangeCallback)&&n!==this._cartesian3.y)this._clippingPlane.onChangeCallback(this._clippingPlane.index);this._cartesian3.y=n}},z:{get:function(){return this._cartesian3.z},set:function(n){if(t.typeOf.number("value",n),i(this._clippingPlane.onChangeCallback)&&n!==this._cartesian3.z)this._clippingPlane.onChangeCallback(this._clippingPlane.index);this._cartesian3.z=n}}}),u});t("Scene/ClippingPlaneCollection",["../Core/AttributeCompression","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Check","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Core/Intersect","../Core/Matrix4","../Core/PixelFormat","../Core/Plane","../Renderer/ContextLimits","../Renderer/PixelDatatype","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","./ClippingPlane"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){"use strict";function ut(n){var r,t,u,i;if(n=e(n,e.EMPTY_OBJECT),this._planes=[],this._dirtyIndex=-1,this._multipleDirtyPlanes=!1,this._enabled=e(n.enabled,!0),this.modelMatrix=y.clone(e(n.modelMatrix,y.IDENTITY)),this.edgeColor=f.clone(e(n.edgeColor,f.WHITE)),this.edgeWidth=e(n.edgeWidth,0),this.planeAdded=new a,this.planeRemoved=new a,this._owner=undefined,r=e(n.unionClippingRegions,!1),this._unionClippingRegions=r,this._testIntersection=r?et:ot,this._uint8View=undefined,this._float32View=undefined,this._clippingPlanesTexture=undefined,t=n.planes,o(t))for(u=t.length,i=0;i<u;++i)this.add(t[i])}function et(n){return n===v.OUTSIDE}function ot(n){return n===v.INSIDE}function st(n,t){n._multipleDirtyPlanes=n._multipleDirtyPlanes||n._dirtyIndex!==-1&&n._dirtyIndex!==t;n._dirtyIndex=t}function ht(n,t){for(var r=n.length,i=0;i<r;++i)if(w.equals(n[i],t))return i;return-1}function at(t,i,u){for(var c,o,s,e=t._uint8View,l=t._planes,f=0,h=i;h<u;++h)c=l[h],o=n.octEncodeToCartesian4(c.normal,lt),e[f]=o.x,e[f+1]=o.y,e[f+2]=o.z,e[f+3]=o.w,s=r.packFloat(c.distance,ct),e[f+4]=s.x,e[f+5]=s.y,e[f+6]=s.z,e[f+7]=s.w,f+=8}function vt(n,t,i){for(var o,f,u=n._float32View,s=n._planes,r=0,e=t;e<i;++e)o=s[e],f=o.normal,u[r]=f.x,u[r+1]=f.y,u[r+2]=f.z,u[r+3]=o.distance,r+=4}function yt(n,t){var r=b.maximumTextureSize,i=Math.min(n,r),u=Math.ceil(n/i);return t.x=Math.max(i,1),t.y=Math.max(u,1),t}var ct,lt,pt,wt,ft;return s(ut.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(n){this._unionClippingRegions!==n&&(this._unionClippingRegions=n,this._testIntersection=n?et:ot)}},enabled:{get:function(){return this._enabled},set:function(n){this._enabled!==n&&(this._enabled=n)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}}),ut.prototype.add=function(n){var t=this._planes.length,i=this;n.onChangeCallback=function(n){st(i,n)};n.index=t;st(this,t);this._planes.push(n);this.planeAdded.raiseEvent(n,t)},ut.prototype.get=function(n){return u.typeOf.number("index",n),this._planes[n]},ut.prototype.contains=function(n){return ht(this._planes,n)!==-1},ut.prototype.remove=function(n){var i=this._planes,u=ht(i,n),f,t,r;if(u===-1)return!1;for(n instanceof rt&&(n.onChangeCallback=undefined,n.index=-1),f=i.length-1,t=u;t<f;++t)r=i[t+1],i[t]=r,r instanceof rt&&(r.index=t);return this._multipleDirtyPlanes=!0,i.length=f,this.planeRemoved.raiseEvent(n,u),!0},ut.prototype.removeAll=function(){for(var n,i=this._planes,r=i.length,t=0;t<r;++t)n=i[t],n instanceof rt&&(n.onChangeCallback=undefined,n.index=-1),this.planeRemoved.raiseEvent(n,t);this._multipleDirtyPlanes=!0;this._planes=[]},ct=new r,lt=new r,pt=new t,ut.prototype.update=function(n){var t=this._clippingPlanesTexture,s=n.context,e=ut.useFloatTexture(s),h=e?this.length:this.length*2,r=yt(h,pt),c,l,i,f,u;(o(t)&&(c=t.width*t.height,(c<h||h<.25*c)&&(t.destroy(),t=undefined)),o(t)||(r.y*=2,l=new d({wrapS:it.CLAMP_TO_EDGE,wrapT:it.CLAMP_TO_EDGE,minificationFilter:tt.NEAREST,magnificationFilter:nt.NEAREST}),e?(t=new g({context:s,width:r.x,height:r.y,pixelFormat:p.RGBA,pixelDatatype:k.FLOAT,sampler:l,flipY:!1}),this._float32View=new Float32Array(r.x*r.y*4)):(t=new g({context:s,width:r.x,height:r.y,pixelFormat:p.RGBA,pixelDatatype:k.UNSIGNED_BYTE,sampler:l,flipY:!1}),this._uint8View=new Uint8Array(r.x*r.y*4)),this._clippingPlanesTexture=t,this._multipleDirtyPlanes=!0),i=this._dirtyIndex,this._multipleDirtyPlanes||i!==-1)&&(this._multipleDirtyPlanes?e?(vt(this,0,this._planes.length),t.copyFrom({width:t.width,height:t.height,arrayBufferView:this._float32View})):(at(this,0,this._planes.length),t.copyFrom({width:t.width,height:t.height,arrayBufferView:this._uint8View})):(f=0,u=0,e?(u=Math.floor(i/t.width),f=Math.floor(i-u*t.width),vt(this,i,i+1),t.copyFrom({width:1,height:1,arrayBufferView:this._float32View},f,u)):(u=Math.floor(i*2/t.width),f=Math.floor(i*2-u*t.width),at(this,i,i+1),t.copyFrom({width:2,height:1,arrayBufferView:this._uint8View},f,u))),this._multipleDirtyPlanes=!1,this._dirtyIndex=-1)},wt=new y,ft=new w(i.UNIT_X,0),ut.prototype.computeIntersectionWithBoundingVolume=function(n,t){var e=this._planes,s=e.length,f=this.modelMatrix,r,u,h,i;for(o(t)&&(f=y.multiply(t,f,wt)),r=v.INSIDE,!this.unionClippingRegions&&s>0&&(r=v.OUTSIDE),u=0;u<s;++u)if(h=e[u],w.transform(h,f,ft),i=n.intersectPlane(ft),i===v.INTERSECTING)r=i;else if(this._testIntersection(i))return i;return r},ut.setOwner=function(n,t,i){if(n!==t[i]&&(t[i]=t[i]&&t[i].destroy(),o(n))){if(o(n._owner))throw new l("ClippingPlaneCollection should only be assigned to one object");n._owner=t;t[i]=n}},ut.useFloatTexture=function(n){return n.floatingPointTexture},ut.getTextureResolution=function(n,t,i){var r=n.texture,f,u;return o(r)?(i.x=r.width,i.y=r.height,i):(f=ut.useFloatTexture(t)?n.length:n.length*2,u=yt(f,i),u.y*=2,u)},ut.prototype.isDestroyed=function(){return!1},ut.prototype.destroy=function(){return this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy(),c(this)},ut});t("Scene/DracoLoader",["../Core/arraySlice","../Core/ComponentDatatype","../Core/defined","../Core/FeatureDetection","../Core/TaskProcessor","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/when"],function(n,t,i,r,u,f,e){"use strict";function o(){}function s(n,t){var i="runtime."+Object.keys(n.createdBufferViews).length,r=n.buffers,u=Object.keys(r).length;return r[u]=t,n.createdBufferViews[i]={buffer:u,byteOffset:0,byteLength:t.byteLength},i}function c(n,t){var i=t._loadResources,r=s(i,n);return i.vertexBuffersToCreate.enqueue(r),r}function l(n,i){var r=n.typedArray,u=i._loadResources,f=s(u,r);return u.indexBuffersToCreate.enqueue({id:f,componentType:t.fromTypedArray(r)}),{bufferViewId:f,numberOfIndices:n.numberOfIndices}}function h(n,t,r,u){var f,e;if(o._taskProcessorReady)return(f=r.primitivesToDecode.peek(),!i(f))?void 0:(e=n.scheduleTask(f,[f.array.buffer]),!i(e))?void 0:(r.activeDecodingTasks++,r.primitivesToDecode.dequeue(),e.then(function(n){var i;r.activeDecodingTasks--;var o=l(n.indexArray,t,u),s={},e=n.attributeData;for(i in e)if(e.hasOwnProperty(i)){var h=e[i],v=h.array,y=c(v,t,u),a=h.data;a.bufferView=y;s[i]=a}t._decodedData[f.mesh+".primitive."+f.primitive]={bufferView:o.bufferViewId,numberOfIndices:o.numberOfIndices,attributes:s}}))}return o._maxDecodingConcurrency=Math.max(r.hardwareConcurrency-1,1),o._decoderTaskProcessor=undefined,o._taskProcessorReady=!1,o._getDecoderTaskProcessor=function(){if(!i(o._decoderTaskProcessor)){var n=new u("decodeDraco",o._maxDecodingConcurrency);n.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then(function(){o._taskProcessorReady=!0});o._decoderTaskProcessor=n}return o._decoderTaskProcessor},o.hasExtension=function(n){return i(n.extensionsRequired.KHR_draco_mesh_compression)||i(n.extensionsUsed.KHR_draco_mesh_compression)},o._decodedModelResourceCache=undefined,o.parse=function(t,r){var e,s,h,c,u;if(o.hasExtension(t)){if(e=t._loadResources,s=t.cacheKey,i(s)&&(i(o._decodedModelResourceCache)||(i(r.cache.modelDecodingCache)||(r.cache.modelDecodingCache={}),o._decodedModelResourceCache=r.cache.modelDecodingCache),h=o._decodedModelResourceCache[s],i(h))){h.count++;e.pendingDecodingCache=!0;return}c=t._dequantizeInShader;u=t.gltf;f.mesh(u,function(t,r){f.meshPrimitive(t,function(t,f){var s,o,h;i(t.extensions)&&(s=t.extensions.KHR_draco_mesh_compression,i(s))&&(o=u.bufferViews[s.bufferView],h=n(u.buffers[o.buffer].extras._pipeline.source,o.byteOffset,o.byteOffset+o.byteLength),e.primitivesToDecode.enqueue({mesh:r,primitive:f,array:h,bufferView:o,compressedAttributes:s.attributes,dequantizeInShader:c}))})})}},o.decodeModel=function(n,t){var r,u,f;if(!o.hasExtension(n))return e.resolve();if(r=n._loadResources,u=n.cacheKey,i(u)&&i(o._decodedModelResourceCache)){if(f=o._decodedModelResourceCache[u],i(f)&&r.pendingDecodingCache)return e(f.ready,function(){n._decodedData=f.data;r.pendingDecodingCache=!1});o._decodedModelResourceCache[u]={ready:!1,count:1,data:undefined}}if(r.primitivesToDecode.length===0)return e.resolve();for(var c=o._getDecoderTaskProcessor(),l=[],s=h(c,n,r,t);i(s);)l.push(s),s=h(c,n,r,t);return e.all(l)},o.decodePointCloud=function(n){var t=o._getDecoderTaskProcessor();if(o._taskProcessorReady)return t.scheduleTask(n,[n.buffer.buffer])},o.cacheDataForModel=function(n){var r=n.cacheKey,t;i(r)&&i(o._decodedModelResourceCache)&&(t=o._decodedModelResourceCache[r],i(t)&&(t.ready=!0,t.data=n._decodedData))},o.destroyCachedDataForModel=function(n){var t=n.cacheKey,r;i(t)&&i(o._decodedModelResourceCache)&&(r=o._decodedModelResourceCache[t],i(r)&&--r.count==0&&delete o._decodedModelResourceCache[t])},o});t("Scene/getClipAndStyleCode",["../Core/Check"],function(n){"use strict";function t(t,i,r){n.typeOf.string("samplerUniformName",t);n.typeOf.string("matrixUniformName",i);n.typeOf.string("styleUniformName",r);return"    float clipDistance = clip(gl_FragCoord, "+t+", "+i+"); \n    vec4 clippingPlanesEdgeColor = vec4(1.0); \n    clippingPlanesEdgeColor.rgb = "+r+".rgb; \n    float clippingPlanesEdgeWidth = "+r+".a; \n    if (clipDistance > 0.0 && clipDistance < clippingPlanesEdgeWidth) \n    { \n        gl_FragColor = clippingPlanesEdgeColor;\n    } \n"}return t});t("Scene/getClippingFunction",["../Core/Cartesian2","../Core/Check","../Renderer/PixelDatatype","./ClippingPlaneCollection"],function(n,t,i,r){"use strict";function f(n,i){t.typeOf.object("clippingPlaneCollection",n);t.typeOf.object("context",i);var y=n.unionClippingRegions,f=n.length,p=r.useFloatTexture(i),c=r.getTextureResolution(n,i,u),l=c.x,a=c.y,v=p?s(l,a):h(l,a);return v+="\n",v+(y?e(f):o(f))}function e(n){return"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount;\n    float pixelWidth = czm_metersPerPixel(position);\n    bool breakAndDiscard = false;\n    for (int i = 0; i < "+n+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = czm_branchFreeTernary(i == 0, amount, min(amount, clipAmount));\n        if (amount <= 0.0)\n        {\n           breakAndDiscard = true;\n           break;\n        }\n    }\n    if (breakAndDiscard) {\n        discard;\n    }\n    return clipAmount;\n}\n"}function o(n){return"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    bool clipped = true;\n    vec4 position = czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal = vec3(0.0);\n    vec3 clipPosition = vec3(0.0);\n    float clipAmount = 0.0;\n    float pixelWidth = czm_metersPerPixel(position);\n    for (int i = 0; i < "+n+"; ++i)\n    {\n        vec4 clippingPlane = getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal = clippingPlane.xyz;\n        clipPosition = -clippingPlane.w * clipNormal;\n        float amount = dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount = max(amount, clipAmount);\n        clipped = clipped && (amount <= 0.0);\n    }\n    if (clipped)\n    {\n        discard;\n    }\n    return clipAmount;\n}\n"}function s(n,t){var u=1/n,f=1/t,r=u+"",i;return r.indexOf(".")===-1&&(r+=".0"),i=f+"",i.indexOf(".")===-1&&(i+=".0"),"vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int pixY = clippingPlaneNumber / "+n+";\n    int pixX = clippingPlaneNumber - (pixY * "+n+");\n    float u = (float(pixX) + 0.5) * "+r+";\n    float v = (float(pixY) + 0.5) * "+i+";\n    vec4 plane = texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n"}function h(n,t){var u=1/n,f=1/t,i=u+"",r;return i.indexOf(".")===-1&&(i+=".0"),r=f+"",r.indexOf(".")===-1&&(r+=".0"),"vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int clippingPlaneStartIndex = clippingPlaneNumber * 2;\n    int pixY = clippingPlaneStartIndex / "+n+";\n    int pixX = clippingPlaneStartIndex - (pixY * "+n+");\n    float u = (float(pixX) + 0.5) * "+i+";\n    float v = (float(pixY) + 0.5) * "+r+";\n    vec4 oct32 = texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct = vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz = czm_octDecode(oct, 65535.0);\n    plane.w = czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + "+i+", v)));\n    return czm_transformPlane(plane, transform);\n}\n"}var u=new n;return f});t("Scene/JobType",["../Core/freezeObject"],function(n){"use strict";return n({TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3})});t("Scene/AttributeType",["../Core/freezeObject"],function(n){"use strict";return n({SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"})});t("Scene/ModelAnimationCache",["../Core/Cartesian3","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/LinearSpline","../Core/Matrix4","../Core/Quaternion","../Core/QuaternionSpline","../Core/WebGLConstants","../Core/WeightSpline","../ThirdParty/GltfPipeline/getAccessorByteStride","../ThirdParty/GltfPipeline/numberOfComponentsForType","./AttributeType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function v(){}function b(n,t){var i=n.gltf,f=i.buffers,e=i.bufferViews,r=e[t.bufferView],u=f[r.buffer],o=r.byteOffset+t.byteOffset,s=t.count*l(t.type),h=d.test(u.uri)?"":u.uri;return n.cacheKey+"//"+h+"/"+o+"/"+s}function g(n,t,i){return n.cacheKey+"//"+t+"/"+i}function y(n){this._value=n}var d=/^data\:/i,k={},p,w;return v.getAnimationParameterValues=function(u,f){var p=b(u,f),o=k[p],nt,y,s,a;if(!r(o)){var v=u.gltf,tt=v.buffers,it=v.bufferViews,w=it[f.bufferView],rt=w.buffer,ut=tt[rt],d=ut.extras._pipeline.source,ft=f.componentType,h=f.type,et=l(h),g=f.count,ot=c(v,f);for(o=new Array(g),nt=i(f.byteOffset,0),y=w.byteOffset+nt,s=0;s<g;s++)a=t.createArrayBufferView(ft,d.buffer,d.byteOffset+y,et),h==="SCALAR"?o[s]=a[0]:h==="VEC3"?o[s]=n.fromArray(a):h==="VEC4"&&(o[s]=e.unpack(a)),y+=ot;r(u.cacheKey)&&(k[p]=o)}return o},p={},y.prototype.evaluate=function(){return this._value},y.prototype.wrapTime=function(){return 0},y.prototype.clampTime=function(){return 0},v.getAnimationSpline=function(n,t,i,f,e,s,c,l){var b=g(n,t,f),a=p[b],w,v;return r(a)||(w=s,v=l,w.length===1&&v.length===1?a=new y(v[0]):e.interpolation==="LINEAR"&&(c==="translation"||c==="scale"?a=new u({times:w,points:v}):c==="rotation"?a=new o({times:w,points:v}):c==="weights"&&(a=new h({times:w,weights:v}))),r(n.cacheKey)&&(p[b]=a)),a},w={},v.getSkinInverseBindMatrices=function(n,i){var h=b(n,i),u=w[h],e,nt;if(!r(u)){var o=n.gltf,tt=o.buffers,it=o.bufferViews,rt=i.bufferView,v=it[rt],ut=v.buffer,ft=tt[ut],y=ft.extras._pipeline.source,p=i.componentType,k=i.type,d=i.count,et=c(o,i),g=v.byteOffset+i.byteOffset,ot=l(k);if(u=new Array(d),p===s.FLOAT&&k===a.MAT4)for(e=0;e<d;++e)nt=t.createArrayBufferView(p,y.buffer,y.byteOffset+g,ot),u[e]=f.fromArray(nt),g+=et;w[h]=u}return u},v});t("Scene/ModelAnimationLoop",["../Core/freezeObject"],function(n){"use strict";return n({NONE:0,REPEAT:1,MIRRORED_REPEAT:2})});t("Scene/ModelAnimationState",["../Core/freezeObject"],function(n){"use strict";return n({STOPPED:0,ANIMATING:1})});t("Scene/ModelAnimation",["../Core/defaultValue","../Core/defineProperties","../Core/Event","../Core/JulianDate","./ModelAnimationLoop","./ModelAnimationState"],function(n,t,i,r,u,f){"use strict";function e(t,e,o){this._name=o.name;this._startTime=r.clone(t.startTime);this._delay=n(t.delay,0);this._stopTime=t.stopTime;this.removeOnStop=n(t.removeOnStop,!1);this._speedup=n(t.speedup,1);this._reverse=n(t.reverse,!1);this._loop=n(t.loop,u.NONE);this.start=new i;this.update=new i;this.stop=new i;this._state=f.STOPPED;this._runtimeAnimation=o;this._computedStartTime=undefined;this._duration=undefined;var s=this;this._raiseStartEvent=function(){s.start.raiseEvent(e,s)};this._updateEventTime=0;this._raiseUpdateEvent=function(){s.update.raiseEvent(e,s,s._updateEventTime)};this._raiseStopEvent=function(){s.stop.raiseEvent(e,s)}}return t(e.prototype,{name:{get:function(){return this._name}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},speedup:{get:function(){return this._speedup}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}}}),e});t("Scene/ModelAnimationCollection",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/JulianDate","../Core/Math","./ModelAnimation","./ModelAnimationLoop","./ModelAnimationState"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n){this.animationAdded=new u;this.animationRemoved=new u;this._model=n;this._scheduledAnimations=[];this._previousTime=undefined}function a(n,t,i){var r=n._model,f=r._runtime.animations,e=f[t],u=new o(i,r,e);return n._scheduledAnimations.push(u),n.animationAdded.raiseEvent(r,u),u}function v(n,t){for(var r=n.channelEvaluators,u=r.length,i=0;i<u;++i)r[i](t)}function y(n,t,i){return function(){n.animationRemoved.raiseEvent(t,i)}}i(c.prototype,{length:{get:function(){return this._scheduledAnimations.length}}});c.prototype.add=function(i){var o,u,e,s,f;if(i=n(i,n.EMPTY_OBJECT),o=this._model,u=o._runtime.animations,!t(u))throw new r("Animations are not loaded.  Wait for Model.readyPromise to resolve.");if(!t(i.name)&&!t(i.index))throw new r("Either options.name or options.index must be defined.");if(t(i.speedup)&&i.speedup<=0)throw new r("options.speedup must be greater than zero.");if(t(i.index)&&(i.index>=u.length||i.index<0))throw new r("options.index must be a valid animation index.");if(t(i.index))return a(this,i.index,i);for(s=u.length,f=0;f<s;++f)if(u[f].name===i.name){e=f;break}if(!t(e))throw new r("options.name must be a valid animation name.");return a(this,e,i)};c.prototype.addAll=function(i){var u;if(i=n(i,n.EMPTY_OBJECT),!t(this._model._runtime.animations))throw new r("Animations are not loaded.  Wait for Model.readyPromise to resolve.");if(t(i.speedup)&&i.speedup<=0)throw new r("options.speedup must be greater than zero.");var f=[],e=this._model,o=e._runtime.animations,s=o.length;for(u=0;u<s;++u)f.push(a(this,u,i));return f};c.prototype.remove=function(n){if(t(n)){var i=this._scheduledAnimations,r=i.indexOf(n);if(r!==-1)return i.splice(r,1),this.animationRemoved.raiseEvent(this._model,n),!0}return!1};c.prototype.removeAll=function(){var i=this._model,t=this._scheduledAnimations,r=t.length,n;for(this._scheduledAnimations=[],n=0;n<r;++n)this.animationRemoved.raiseEvent(i,t[n])};c.prototype.contains=function(n){return t(n)?this._scheduledAnimations.indexOf(n)!==-1:!1};c.prototype.get=function(n){if(!t(n))throw new r("index is required.");return this._scheduledAnimations[n]};var l=[];return c.prototype.update=function(i){var a=this._scheduledAnimations,p=a.length,w,r,o,g,nt,c,b,tt;if(p===0)return this._previousTime=undefined,!1;if(f.equals(i.time,this._previousTime))return!1;this._previousTime=f.clone(i.time,this._previousTime);var it=!1,k=i.time,et=this._model;for(w=0;w<p;++w){r=a[w];o=r._runtimeAnimation;t(r._computedStartTime)||(r._computedStartTime=f.addSeconds(n(r.startTime,k),r.delay,new f));t(r._duration)||(r._duration=o.stopTime*(1/r.speedup));var ot=r._computedStartTime,d=r._duration,rt=r.stopTime,u=d!==0?f.secondsDifference(k,ot)/d:0,ut=u>=0,ft=r.loop===s.REPEAT||r.loop===s.MIRRORED_REPEAT,st=(ut||ft&&!t(r.startTime))&&(u<=1||ft)&&(!t(rt)||f.lessThanOrEquals(k,rt));st?(r._state===h.STOPPED&&(r._state=h.ANIMATING,r.start.numberOfListeners>0&&i.afterRender.push(r._raiseStartEvent)),r.loop===s.REPEAT?u=u-Math.floor(u):r.loop===s.MIRRORED_REPEAT&&(g=Math.floor(u),nt=u-g,u=g%2==1?1-nt:nt),r.reverse&&(u=1-u),c=u*d*r.speedup,c=e.clamp(c,o.startTime,o.stopTime),v(o,c),r.update.numberOfListeners>0&&(r._updateEventTime=c,i.afterRender.push(r._raiseUpdateEvent)),it=!0):ut&&r._state===h.ANIMATING&&(r._state=h.STOPPED,r.stop.numberOfListeners>0&&i.afterRender.push(r._raiseStopEvent),r.removeOnStop&&l.push(r))}for(p=l.length,b=0;b<p;++b)tt=l[b],a.splice(a.indexOf(tt),1),i.afterRender.push(y(this,et,tt));return l.length=0,it},c});t("Scene/ModelLoadResources",["../Core/Queue"],function(n){"use strict";function t(){this.initialized=!1;this.resourcesParsed=!1;this.vertexBuffersToCreate=new n;this.indexBuffersToCreate=new n;this.buffers={};this.pendingBufferLoads=0;this.programsToCreate=new n;this.shaders={};this.pendingShaderLoads=0;this.texturesToCreate=new n;this.pendingTextureLoads=0;this.texturesToCreateFromBufferView=new n;this.pendingBufferViewToImage=0;this.createSamplers=!0;this.createSkins=!0;this.createRuntimeAnimations=!0;this.createVertexArrays=!0;this.createRenderStates=!0;this.createUniformMaps=!0;this.createRuntimeNodes=!0;this.createdBufferViews={};this.primitivesToDecode=new n;this.activeDecodingTasks=0;this.pendingDecodingCache=!1;this.skinnedNodesIds=[]}function i(n,t,i){return n.subarray(t,t+i)}return t.prototype.getBuffer=function(n){return i(this.buffers[n.buffer],n.byteOffset,n.byteLength)},t.prototype.finishedPendingBufferLoads=function(){return this.pendingBufferLoads===0},t.prototype.finishedBuffersCreation=function(){return this.pendingBufferLoads===0&&this.vertexBuffersToCreate.length===0&&this.indexBuffersToCreate.length===0},t.prototype.finishedProgramCreation=function(){return this.pendingShaderLoads===0&&this.programsToCreate.length===0},t.prototype.finishedTextureCreation=function(){var n=this.pendingTextureLoads===0,t=this.texturesToCreate.length===0&&this.texturesToCreateFromBufferView.length===0;return n&&t},t.prototype.finishedEverythingButTextureCreation=function(){var n=this.pendingBufferLoads===0&&this.pendingShaderLoads===0,t=this.vertexBuffersToCreate.length===0&&this.indexBuffersToCreate.length===0&&this.programsToCreate.length===0&&this.pendingBufferViewToImage===0;return this.finishedDecoding()&&n&&t},t.prototype.finishedDecoding=function(){return this.primitivesToDecode.length===0&&this.activeDecodingTasks===0&&!this.pendingDecodingCache},t.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()},t});t("Scene/ModelMaterial",["../Core/defined","../Core/defineProperties","../Core/DeveloperError"],function(n,t,i){"use strict";function r(n,t,i){this._name=t.name;this._id=i;this._uniformMap=n._uniformMaps[i];this._technique=undefined;this._program=undefined;this._values=undefined}return t(r.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}}),r.prototype.setValue=function(t,r){if(!n(t))throw new i("name is required.");var f="u_"+t,u=this._uniformMap.values[f];if(!n(u))throw new i("name must match a parameter name in the material's technique that is targetable and not optimized out.");u.value=u.clone(r,u.value)},r.prototype.getValue=function(t){if(!n(t))throw new i("name is required.");var u="u_"+t,r=this._uniformMap.values[u];return n(r)?r.value:undefined},r});t("Scene/ModelMesh",["../Core/defineProperties"],function(n){"use strict";function t(n,t,i){for(var e,u=[],f=n.primitives,o=f.length,r=0;r<o;++r)e=f[r],u[r]=t[e.material];this._name=n.name;this._materials=u;this._id=i}return n(t.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}}),t});t("Scene/ModelNode",["../Core/defineProperties","../Core/Matrix4"],function(n,t){"use strict";function i(n,i,r,u,f){this._model=n;this._runtimeNode=r;this._name=i.name;this._id=u;this.useMatrix=!1;this._show=!0;this._matrix=t.clone(f)}return n(i.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},show:{get:function(){return this._show},set:function(n){this._show!==n&&(this._show=n,this._model._perNodeShowDirty=!0)}},matrix:{get:function(){return this._matrix},set:function(n){this._matrix=t.clone(n,this._matrix);this.useMatrix=!0;var i=this._model;i._cesiumAnimationsDirty=!0;this._runtimeNode.dirtyNumber=i._maxDirtyNumber}}}),i.prototype.setMatrix=function(n){t.clone(n,this._matrix)},i});t("Scene/ModelUtility",["../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/clone","../Core/defined","../Core/defineProperties","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4","../Core/Quaternion","../Core/RuntimeError","../Core/WebGLConstants","../Renderer/ShaderSource","../ThirdParty/GltfPipeline/addToArray","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/GltfPipeline/hasExtension","./AttributeType","./Axis"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function pt(n,t){return p.techniqueAttribute(n,function(n,i){if(n.semantic===t)return i})}function wt(n,t){var w=n.accessors,b=n.materials,h=n.extensions.KHR_techniques_webgl,k=h.techniques,g=h.programs,nt=h.shaders,c=t.targets,r=t.attributes,u,l,e,i,v,y,s;for(u in c)if(c.hasOwnProperty(u)){l=c[u];for(e in l)e!=="extras"&&(r[e+"_"+u]=l[e])}var tt=b[t.material],a=k[tt.extensions.KHR_techniques_webgl.technique],it=g[a.program],rt=nt[it.vertexShader];for(i in r)if(r.hasOwnProperty(i)&&!f(pt(a,i))){var ut=r[i],p=w[ut],o=i.toLowerCase();o.charAt(0)==="_"&&(o=o.slice(1));v="a_"+o;a.attributes[v]={semantic:i,type:p.componentType};y=rt.extras._pipeline;s=y.source;s="attribute "+d.getShaderVariable(p.type)+" "+v+";\n"+s;y.source=s}}function lt(n,t,i,r){return w(n,"KHR_techniques_webgl")?function(n,t){if(n.semantic===i&&(!r||!f(n.node)))return t}:function(n,u){var e=t.parameters[n];if(e.semantic===i&&(!r||!f(e.node)))return u}}function at(n,t,i){t+="(?!\\w)";t=new RegExp(t,"g");var r=n.search(t);return n.replace(t,function(n,t){return r===t?n:i})}function gt(n,t){var r=n.accessors[t],i=r.extensions;return f(i)?i.WEB3D_quantized_attributes:undefined}function vt(n,t,i){var u=t.material,r=n.materials[u];if(w(n,"KHR_techniques_webgl")&&f(r.extensions)&&f(r.extensions.KHR_techniques_webgl)){var e=r.extensions.KHR_techniques_webgl.technique,o=n.extensions.KHR_techniques_webgl,s=o.techniques[e];return p.techniqueAttribute(s,function(n,t){var r=n.semantic;if(r===i)return t})}}function tt(n){var t={value:n,clone:function(n){return n},func:function(){return t.value}};return t}function rt(n){var i={value:t.fromArray(n),clone:t.clone,func:function(){return i.value}};return i}function ut(n){var t={value:i.fromArray(n),clone:i.clone,func:function(){return t.value}};return t}function it(n){var t={value:r.fromArray(n),clone:r.clone,func:function(){return t.value}};return t}function ot(n){var t={value:o.fromColumnMajorArray(n),clone:o.clone,func:function(){return t.value}};return t}function st(n){var t={value:s.fromColumnMajorArray(n),clone:s.clone,func:function(){return t.value}};return t}function ft(n){var t={value:h.fromColumnMajorArray(n),clone:h.clone,func:function(){return t.value}};return t}function et(n,t,i){this._value=undefined;this._textureId=n.index;this._textures=t;this._defaultTexture=i}function ni(n,t,i){var r=new et(n,t,i);return r.func=function(){return r.value},r}function ti(n){return[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]]}function ii(n){return[n[20],n[21],n[22],n[23]]}var d={},ht,ct,g,nt,yt;d.updateForwardAxis=function(n){var t=n.gltf.extras.sourceVersion;(f(t)&&t!=="2.0"||d.getAssetVersion(n.gltf)!=="2.0")&&(n._gltfForwardAxis=k.X)};d.getAssetVersion=function(n){return!f(n.asset)||!f(n.asset.version)?"1.0":n.asset.version};d.splitIncompatibleMaterials=function(n){var r=n.accessors,i=n.materials,t={};return p.mesh(n,function(n){p.meshPrimitive(n,function(n){var o=n.material,g=i[o],h=n.attributes.JOINTS_0,c,s,l,d;f(h)&&(l=r[h],c=l.componentType,s=l.type);var a=f(h),v=f(n.attributes.COLOR_0),p=f(n.targets),w=f(n.attributes.NORMAL),b=f(n.attributes.TANGENT),k=f(n.attributes.TEXCOORD_0),e=t[o];f(e)?(e.skinning.skinned!==a||e.skinning.type!==s||e.hasVertexColors!==v||e.hasMorphTargets!==p||e.hasNormals!==w||e.hasTangents!==b||e.hasTexCoords!==k)&&(d=u(g,!0),o=y(i,d),n.material=o,t[o]={skinning:{skinned:a,componentType:c,type:s},hasVertexColors:v,hasMorphTargets:p,hasNormals:w,hasTangents:b,hasTexCoords:k}):t[o]={skinning:{skinned:a,componentType:c,type:s},hasVertexColors:v,hasMorphTargets:p,hasNormals:w,hasTangents:b,hasTexCoords:k}})}),t};d.getShaderVariable=function(n){return n==="SCALAR"?"float":n.toLowerCase()};d.ModelState={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};d.getFailedLoadFunction=function(n,t,i){return function(r){n._state=d.ModelState.FAILED;var u="Failed to load "+t+": "+i;f(r)&&(u+="\n"+r.message);n._readyPromise.reject(new l(u))}};d.parseBuffers=function(n,t){var i=n._loadResources;p.buffer(n.gltf,function(r,u){if(f(r.extras._pipeline.source))i.buffers[u]=r.extras._pipeline.source;else if(f(t)){var e=n._resource.getDerivedResource({url:r.uri});++i.pendingBufferLoads;e.fetchArrayBuffer().then(t(n,u)).otherwise(d.getFailedLoadFunction(n,"buffer",e.url))}})};ht=new i;ct=new i;d.computeBoundingSphere=function(t){for(var r,a,b,v,g,y,et,p,e,u,o=t.gltf,it=o.nodes,ot=o.meshes,rt=o.scenes[o.scene].nodes,st=rt.length,s=[],c=new i(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new i(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),w=0;w<st;++w)for(r=it[rt[w]],r._transformToRoot=d.getTransform(r),s.push(r);s.length>0;){if(r=s.pop(),a=r._transformToRoot,b=r.mesh,f(b)){var lt=ot[b],ut=lt.primitives,at=ut.length;for(v=0;v<at;++v)if(g=ut[v].attributes.POSITION,f(g)){var ft=d.getAccessorMinMax(o,g),nt=i.fromArray(ft.min,0,ht),tt=i.fromArray(ft.max,0,ct);f(c)&&f(l)&&(h.multiplyByPoint(a,nt,nt),h.multiplyByPoint(a,tt,tt),i.minimumByComponent(c,nt,c),i.maximumByComponent(l,tt,l))}}if(y=r.children,f(y))for(et=y.length,p=0;p<et;++p)e=it[y[p]],e._transformToRoot=d.getTransform(e),h.multiplyTransformation(a,e._transformToRoot,e._transformToRoot),s.push(e);delete r._transformToRoot}return u=n.fromCornerPoints(c,l),t._forwardAxis===k.Z&&n.transformWithoutScale(u,k.Z_UP_TO_X_UP,u),t._upAxis===k.Y?n.transformWithoutScale(u,k.Y_UP_TO_Z_UP,u):t._upAxis===k.X&&n.transformWithoutScale(u,k.X_UP_TO_Z_UP,u),u};d.ensureSemanticExistence=function(n){return p.mesh(n,function(t){p.meshPrimitive(t,function(t){wt(n,t)})}),n};d.createAttributeLocations=function(n,t){var i={},u=!1,e=1,r;if(p.techniqueAttribute(n,function(n,t){/pos/i.test(t)&&!u?(i[t]=0,u=!0):i[t]=e++}),f(t))for(r in t)t.hasOwnProperty(r)&&(i[r]=e++);return i};d.getAccessorMinMax=function(n,t){var r=n.accessors[t],u=r.extensions,e=r.min,o=r.max,i;return f(u)&&(i=u.WEB3D_quantized_attributes,f(i)&&(e=i.decodedMin,o=i.decodedMax)),{min:e,max:o}};d.getAttributeOrUniformBySemantic=function(n,t,i,r){return p.technique(n,function(u){if(!f(i)||u.program===i){var e=p.techniqueAttribute(u,lt(n,u,t,r));return f(e)?e:p.techniqueUniform(u,lt(n,u,t,r))}})};d.getDiffuseAttributeOrUniform=function(n,t){var i=d.getAttributeOrUniformBySemantic(n,"COLOR_0",t);return f(i)||(i=d.getAttributeOrUniformBySemantic(n,"_3DTILESDIFFUSE",t)),i};var bt=new i,kt=new c,dt=new i;return d.getTransform=function(n,t){return f(n.matrix)?h.fromColumnMajorArray(n.matrix,t):h.fromTranslationQuaternionRotationScale(i.fromArray(n.translation,0,bt),c.unpack(n.rotation,0,kt),i.fromArray(n.scale,0,dt),t)},d.getUsedExtensions=function(n){var i=n.extensionsUsed,r={},u,t,e;if(f(i))for(u=i.length,t=0;t<u;t++)e=i[t],r[e]=!0;return r},d.getRequiredExtensions=function(n){var i=n.extensionsRequired,r={},u,t,e;if(f(i))for(u=i.length,t=0;t<u;t++)e=i[t],r[e]=!0;return r},d.supportedExtensions={CESIUM_RTC:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,WEB3D_quantized_attributes:!0},d.checkSupportedExtensions=function(n){for(var t in n)if(n.hasOwnProperty(t)&&!d.supportedExtensions[t])throw new l("Unsupported glTF Extension: "+t);},d.checkSupportedGlExtensions=function(n,t){var u,i,r;if(f(n))for(u=n.length,i=0;i<u;i++)if(r=n[i],r!=="OES_element_index_uint")throw new l("Unsupported WebGL Extension: "+r);else if(!t.elementIndexUint)throw new l("OES_element_index_uint WebGL extension is not enabled.");},d.modifyShaderForDracoQuantizedAttributes=function(n,t,i,r){var d={},u,l,s,e,o,y,c,p,w,b;for(u in r)if(r.hasOwnProperty(u)){if(l=r[u],s=l.quantization,!f(s))continue;if(e=vt(n,t,u),u.charAt(0)==="_"&&(u=u.substring(1)),o="gltf_u_dec_"+u.toLowerCase(),!f(d[o])){var a="gltf_decoded_"+u,h=e.replace("a_","gltf_a_dec_"),k=l.componentsPerAttribute;i=at(i,e,h);y=s.octEncoded?"vec3":k>1?"vec"+k:"float";i=y+" "+h+";\n"+i;c="";s.octEncoded?(p=o+"_rangeConstant",i="uniform float "+p+";\n"+i,c="\nvoid main() {\n    "+h+" = czm_octDecode("+e+".xy, "+p+").zxy;\n    "+a+"();\n}\n"):(w=o+"_normConstant",b=o+"_min",i="uniform float "+w+";\nuniform "+y+" "+b+";\n"+i,c="\nvoid main() {\n    "+h+" = "+b+" + "+e+" * "+w+";\n    "+a+"();\n}\n");i=v.replaceMain(i,a)+c}}return{shader:i}},d.modifyShaderForQuantizedAttributes=function(n,t,i){var u={},b=t.attributes,r,s,k,y,w,l;for(r in b)if(b.hasOwnProperty(r)){s=vt(n,t,r);k=t.attributes[r];r.charAt(0)==="_"&&(r=r.substring(1));var e="gltf_u_dec_"+r.toLowerCase(),h=e+"_scale",a=e+"_translate";if(!f(u[e])&&!f(u[h])&&(y=gt(n,k),f(y))){var d=y.decodeMatrix,p="gltf_decoded_"+r,c=s.replace("a_","gltf_a_dec_"),o=Math.floor(Math.sqrt(d.length));i=at(i,s,c);w=o>2?"vec"+(o-1):"float";i=w+" "+c+";\n"+i;l="";o===5?(i="uniform mat4 "+h+";\n"+i,i="uniform vec4 "+a+";\n"+i,l="\nvoid main() {\n    "+c+" = "+h+" * "+s+" + "+a+";\n    "+p+"();\n}\n",u[h]={mat:4},u[a]={vec:4}):(i="uniform mat"+o+" "+e+";\n"+i,l="\nvoid main() {\n    "+c+" = "+w+"("+e+" * vec"+o+"("+s+",1.0));\n    "+p+"();\n}\n",u[e]={mat:o});i=v.replaceMain(i,p)+l}}return{shader:i,uniforms:u}},d.toClipCoordinatesGLSL=function(n,t){var u=d.getAttributeOrUniformBySemantic(n,"POSITION"),e=u.replace("a_","gltf_a_dec_"),i,o,r;return t.indexOf(e)!==-1&&(u=e),i=d.getAttributeOrUniformBySemantic(n,"MODELVIEWPROJECTION",undefined,!0),f(i)&&t.indexOf(i)!==-1||(o=d.getAttributeOrUniformBySemantic(n,"PROJECTION",undefined,!0),r=d.getAttributeOrUniformBySemantic(n,"MODELVIEW",undefined,!0),t.indexOf("czm_instanced_modelView ")!==-1?r="czm_instanced_modelView":f(r)||(r=d.getAttributeOrUniformBySemantic(n,"CESIUM_RTC_MODELVIEW",undefined,!0)),i=o+" * "+r),i+" * vec4("+u+".xyz, 1.0)"},d.modifyFragmentShaderForLogDepth=function(n){return n=v.replaceMain(n,"czm_depth_main"),n+"\nvoid main() \n{ \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"},d.modifyVertexShaderForLogDepth=function(n,t){return n=v.replaceMain(n,"czm_depth_main"),n+("\nvoid main() \n{ \n    czm_depth_main(); \n    czm_vertexLogDepth("+t+"); \n} \n")},e(et.prototype,{value:{get:function(){if(!f(this._value)){var n=this._textures[this._textureId];if(f(n))this._value=n;else return this._defaultTexture}return this._value},set:function(n){this._value=n}}}),et.prototype.clone=function(n){return n},et.prototype.func=undefined,g={},g[a.FLOAT]=tt,g[a.FLOAT_VEC2]=rt,g[a.FLOAT_VEC3]=ut,g[a.FLOAT_VEC4]=it,g[a.INT]=tt,g[a.INT_VEC2]=rt,g[a.INT_VEC3]=ut,g[a.INT_VEC4]=it,g[a.BOOL]=tt,g[a.BOOL_VEC2]=rt,g[a.BOOL_VEC3]=ut,g[a.BOOL_VEC4]=it,g[a.FLOAT_MAT2]=ot,g[a.FLOAT_MAT3]=st,g[a.FLOAT_MAT4]=ft,g[a.SAMPLER_2D]=ni,d.createUniformFunction=function(n,t,i,r){return g[n](t,i,r)},d.createUniformsForDracoQuantizedAttributes=function(n){var i={},r,o,t,e,s,h,c,l,u;for(r in n)if(n.hasOwnProperty(r)){if(o=n[r],t=o.quantization,!f(t))continue;if(r.charAt(0)==="_"&&(r=r.substring(1)),e="gltf_u_dec_"+r.toLowerCase(),t.octEncoded){s=e+"_rangeConstant";h=(1<<t.quantizationBits)-1;i[s]=tt(h).func;continue}c=e+"_normConstant";l=t.range/(1<<t.quantizationBits);i[c]=tt(l).func;u=e+"_min";switch(o.componentsPerAttribute){case 1:i[u]=tt(t.minValues).func;break;case 2:i[u]=rt(t.minValues).func;break;case 3:i[u]=ut(t.minValues).func;break;case 4:i[u]=it(t.minValues).func}}return i},d.createUniformsForQuantizedAttributes=function(n,t,i){var nt=n.accessors,a={},r={},y=t.attributes,c,p,v,u,w,k,e,l;for(c in y)if(y.hasOwnProperty(c)){var tt=y[c],d=nt[tt],g=d.extensions;if(c.charAt(0)==="_"&&(c=c.substring(1)),f(g)&&(p=g.WEB3D_quantized_attributes,f(p))){v=p.decodeMatrix;u="gltf_u_dec_"+c.toLowerCase();switch(d.type){case b.SCALAR:r[u]=ot(v).func;a[u]=!0;break;case b.VEC2:r[u]=st(v).func;a[u]=!0;break;case b.VEC3:r[u]=ft(v).func;a[u]=!0;break;case b.VEC4:w=u+"_scale";k=u+"_translate";r[w]=ft(ti(v)).func;r[k]=it(ii(v)).func;a[w]=!0;a[k]=!0}}}for(e in i)i.hasOwnProperty(e)&&(a[e]||(l=i[e],f(l.mat)&&(l.mat===2?r[e]=ot(o.IDENTITY).func:l.mat===3?r[e]=st(s.IDENTITY).func:l.mat===4&&(r[e]=ft(h.IDENTITY).func)),f(l.vec)&&l.vec===4&&(r[e]=it([0,0,0,0]).func)));return r},nt=new i,yt={MODEL:function(n){return function(){return n.model}},VIEW:function(n){return function(){return n.view}},PROJECTION:function(n){return function(){return n.projection}},MODELVIEW:function(n){return function(){return n.modelView}},CESIUM_RTC_MODELVIEW:function(n,t){var r=new h;return function(){return f(t._rtcCenter)?(h.getTranslation(n.model,nt),i.add(nt,t._rtcCenter,nt),h.multiplyByPoint(n.view,nt,nt),h.setTranslation(n.modelView,nt,r)):n.modelView}},MODELVIEWPROJECTION:function(n){return function(){return n.modelViewProjection}},MODELINVERSE:function(n){return function(){return n.inverseModel}},VIEWINVERSE:function(n){return function(){return n.inverseView}},PROJECTIONINVERSE:function(n){return function(){return n.inverseProjection}},MODELVIEWINVERSE:function(n){return function(){return n.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(n){return function(){return n.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(n){return function(){return n.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(n){return function(){return n.normal}},VIEWPORT:function(n){return function(){return n.viewportCartesian4}}},d.getGltfSemanticUniforms=function(){return yt},d});t("Scene/processModelMaterialsCommon",["./ModelUtility","../Core/defined","../Core/defaultValue","../Core/WebGLConstants","../Core/webGLConstantToGlslType","../ThirdParty/GltfPipeline/addToArray","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/GltfPipeline/hasExtension","../ThirdParty/GltfPipeline/numberOfComponentsForType"],function(n,t,i,r,u,f,e,o,s){"use strict";function c(r,u){var f;if((u=i(u,{}),t(r))&&o(r,"KHR_materials_common")){o(r,"KHR_techniques_webgl")||(t(r.extensions)||(r.extensions={}),r.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},r.extensionsUsed.push("KHR_techniques_webgl"),r.extensionsRequired.push("KHR_techniques_webgl"));f=r.extensions.KHR_techniques_webgl;y(r);var c=l(r),p=n.splitIncompatibleMaterials(r),s={},h=!1;return(e.material(r,function(n,i){var w,y,d,e;if(t(n.extensions)&&t(n.extensions.KHR_materials_common)){var o=n.extensions.KHR_materials_common,b=p[i],k=v(o,b),l=s[k];t(l)||(l=a(r,f,b,o,c,u.addBatchIdToGeneratedShaders),s[k]=l,h=!0);w={};y=o.values;for(e in y)y.hasOwnProperty(e)&&e!=="transparent"&&e!=="doubleSided"&&(d="u_"+e.toLowerCase(),w[d]=y[e]);n.extensions.KHR_techniques_webgl={technique:l,values:w};n.alphaMode="OPAQUE";o.transparent&&(n.alphaMode="BLEND");o.doubleSided&&(n.doubleSided=!0)}}),!h)?r:(n.ensureSemanticExistence(r),r)}}function l(n){var f={},e,c,l,s,a,y,v,i,p,u,w,b,h,o;if(t(n.extensions)&&t(n.extensions.KHR_materials_common)&&(e=n.extensions.KHR_materials_common.lights),t(e)){c=n.nodes;for(l in c)c.hasOwnProperty(l)&&(s=c[l],t(s.extensions)&&t(s.extensions.KHR_materials_common)&&(a=s.extensions.KHR_materials_common.light,t(a)&&t(e[a])&&(e[a].node=l),delete s.extensions.KHR_materials_common));y=0;for(v in e)if(e.hasOwnProperty(v)){if(i=e[v],p=i.type,p!=="ambient"&&!t(i.node)){delete e[v];continue}u="light"+y.toString();i.baseName=u;switch(p){case"ambient":w=i.ambient;f[u+"Color"]={type:r.FLOAT_VEC3,value:w.color};break;case"directional":b=i.directional;f[u+"Color"]={type:r.FLOAT_VEC3,value:b.color};t(i.node)&&(f[u+"Transform"]={node:i.node,semantic:"MODELVIEW",type:r.FLOAT_MAT4});break;case"point":h=i.point;f[u+"Color"]={type:r.FLOAT_VEC3,value:h.color};t(i.node)&&(f[u+"Transform"]={node:i.node,semantic:"MODELVIEW",type:r.FLOAT_MAT4});f[u+"Attenuation"]={type:r.FLOAT_VEC3,value:[h.constantAttenuation,h.linearAttenuation,h.quadraticAttenuation]};break;case"spot":o=i.spot;f[u+"Color"]={type:r.FLOAT_VEC3,value:o.color};t(i.node)&&(f[u+"Transform"]={node:i.node,semantic:"MODELVIEW",type:r.FLOAT_MAT4},f[u+"InverseTransform"]={node:i.node,semantic:"MODELVIEWINVERSE",type:r.FLOAT_MAT4,useInFragment:!0});f[u+"Attenuation"]={type:r.FLOAT_VEC3,value:[o.constantAttenuation,o.linearAttenuation,o.quadraticAttenuation]};f[u+"FallOff"]={type:r.FLOAT_VEC2,value:[o.fallOffAngle,o.fallOffExponent]}}++y}}return f}function a(e,c,l,a,v,y){var tt,bt,et,ti,kt,it,ii,d,g,ht,ct,ri,ut,ft,ui,ei,dt,lt,pt,ai,ot,oi;t(a)||(a={});y=i(y,!1);var vi=c.techniques,si=c.shaders,yi=c.programs,rt=a.technique.toUpperCase(),wt;t(e.extensions)&&t(e.extensions.KHR_materials_common)&&(wt=e.extensions.KHR_materials_common.lights);var gt=a.values,pi=i(a.jointCount,0),at,st=!1,ni=!1;t(l)&&(at=l.skinning,st=at.skinned,ni=l.hasVertexColors);var k="precision highp float;\n",w="precision highp float;\n",vt=rt!=="CONSTANT",b={u_modelViewMatrix:{semantic:o(e,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:r.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:r.FLOAT_MAT4}};vt&&(b.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:r.FLOAT_MAT3});st&&(b.u_jointMatrix={count:pi,semantic:"JOINTMATRIX",type:r.FLOAT_MAT4});bt=!1;for(et in gt)gt.hasOwnProperty(et)&&et!=="transparent"&&et!=="doubleSided"&&(ti=h(et,gt[et]),tt="u_"+et.toLowerCase(),bt||ti!==r.SAMPLER_2D||(bt=!0),b[tt]={type:ti});if(t(b.u_diffuse)&&(b.u_diffuse.semantic="_3DTILESDIFFUSE"),t(v))for(kt in v)v.hasOwnProperty(kt)&&(tt="u_"+kt,b[tt]=v[kt]);for(tt in b)b.hasOwnProperty(tt)&&(it=b[tt],ii=t(it.count)?"["+it.count+"]":"",it.type!==r.FLOAT_MAT3&&it.type!==r.FLOAT_MAT4||it.useInFragment?(w+="uniform "+u(it.type)+" "+tt+ii+";\n",delete it.useInFragment):k+="uniform "+u(it.type)+" "+tt+ii+";\n");if(d="",st)if(ct=s(at.type),ri=!1,at.type.indexOf("MAT")===0&&(ri=!0,ct=Math.sqrt(ct)),ri)for(g=0;g<ct;g++)for(ht=0;ht<ct;ht++)d+=g===0&&ht===0?"  mat4 skinMat = ":"  skinMat += ",d+="a_weight["+g+"]["+ht+"] * u_jointMatrix[int(a_joint["+g+"]["+ht+"])];\n";else for(g=0;g<ct;g++)d+=g===0?"  mat4 skinMat = ":"  skinMat += ",d+="a_weight["+g+"] * u_jointMatrix[int(a_joint["+g+"])];\n";ut={a_position:{semantic:"POSITION"}};k+="attribute vec3 a_position;\n";k+="varying vec3 v_positionEC;\n";d+=st?"  vec4 pos = u_modelViewMatrix * skinMat * vec4(a_position,1.0);\n":"  vec4 pos = u_modelViewMatrix * vec4(a_position,1.0);\n";d+="  v_positionEC = pos.xyz;\n";d+="  gl_Position = u_projectionMatrix * pos;\n";w+="varying vec3 v_positionEC;\n";vt&&(ut.a_normal={semantic:"NORMAL"},k+="attribute vec3 a_normal;\n",k+="varying vec3 v_normal;\n",d+=st?"  v_normal = u_normalMatrix * mat3(skinMat) * a_normal;\n":"  v_normal = u_normalMatrix * a_normal;\n",w+="varying vec3 v_normal;\n");bt&&(ut.a_texcoord_0={semantic:"TEXCOORD_0"},ft="v_texcoord_0",k+="attribute vec2 a_texcoord_0;\n",k+="varying vec2 "+ft+";\n",d+="  "+ft+" = a_texcoord_0;\n",w+="varying vec2 "+ft+";\n");st&&(ui=n.getShaderVariable(at.type),ut.a_joint={semantic:"JOINT"},ut.a_weight={semantic:"WEIGHT"},k+="attribute "+ui+" a_joint;\n",k+="attribute "+ui+" a_weight;\n");ni&&(ut.a_vertexColor={semantic:"COLOR_0"},k+="attribute vec4 a_vertexColor;\n",k+="varying vec4 v_vertexColor;\n",d+="  v_vertexColor = a_vertexColor;\n",w+="varying vec4 v_vertexColor;\n");y&&(ut.a_batchId={semantic:"_BATCHID"},k+="attribute float a_batchId;\n");var fi=vt&&(rt==="BLINN"||rt==="PHONG")&&t(b.u_specular)&&t(b.u_shininess)&&b.u_shininess>0,hi=!1,ci=!1,p="";for(ei in wt)if(wt.hasOwnProperty(ei)){var li=wt[ei],yt=li.type.toLowerCase(),nt=li.baseName;p+="  {\n";dt="u_"+nt+"Color";yt==="ambient"?(ci=!0,p+="    ambientLight += "+dt+";\n"):vt&&(hi=!0,lt="v_"+nt+"Direction",pt="v_"+nt+"Position",yt!=="point"&&(k+="varying vec3 "+lt+";\n",w+="varying vec3 "+lt+";\n",d+="  "+lt+" = mat3(u_"+nt+"Transform) * vec3(0.,0.,1.);\n",yt==="directional"&&(p+="    vec3 l = normalize("+lt+");\n")),yt!=="directional"?(k+="varying vec3 "+pt+";\n",w+="varying vec3 "+pt+";\n",d+="  "+pt+" = u_"+nt+"Transform[3].xyz;\n",p+="    vec3 VP = "+pt+" - v_positionEC;\n",p+="    vec3 l = normalize(VP);\n",p+="    float range = length(VP);\n",p+="    float attenuation = 1.0 / (u_"+nt+"Attenuation.x + ",p+="(u_"+nt+"Attenuation.y * range) + ",p+="(u_"+nt+"Attenuation.z * range * range));\n"):p+="    float attenuation = 1.0;\n",yt==="spot"&&(p+="    float spotDot = dot(l, normalize("+lt+"));\n",p+="    if (spotDot < cos(u_"+nt+"FallOff.x * 0.5))\n",p+="    {\n",p+="      attenuation = 0.0;\n",p+="    }\n",p+="    else\n",p+="    {\n",p+="        attenuation *= max(0.0, pow(spotDot, u_"+nt+"FallOff.y));\n",p+="    }\n"),p+="    diffuseLight += "+dt+"* max(dot(normal,l), 0.) * attenuation;\n",fi&&(rt==="BLINN"?(p+="    vec3 h = normalize(l + viewDir);\n",p+="    float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;\n"):(p+="    vec3 reflectDir = reflect(-l, normal);\n",p+="    float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;\n"),p+="    specularLight += "+dt+" * specularIntensity;\n"));p+="  }\n"}ci||(p+="  ambientLight += vec3(0.2, 0.2, 0.2);\n");hi||rt==="CONSTANT"||(p+="  vec3 l = normalize(czm_sunDirectionEC);\n",ai="0.2",p+="  diffuseLight += vec3(1.0, 1.0, 1.0) * max(dot(normal,l), "+ai+");\n",fi&&(rt==="BLINN"?(p+="  vec3 h = normalize(l + viewDir);\n",p+="  float specularIntensity = max(0., pow(max(dot(normal, h), 0.), u_shininess));\n"):(p+="  vec3 reflectDir = reflect(-l, normal);\n",p+="  float specularIntensity = max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));\n"),p+="  specularLight += vec3(1.0, 1.0, 1.0) * specularIntensity;\n"));k+="void main(void) {\n";k+=d;k+="}\n";w+="void main(void) {\n";ot="  vec3 color = vec3(0.0, 0.0, 0.0);\n";vt&&(w+="  vec3 normal = normalize(v_normal);\n",a.doubleSided&&(w+="  if (gl_FrontFacing == false)\n",w+="  {\n",w+="    normal = -normal;\n",w+="  }\n"));rt!=="CONSTANT"?(t(b.u_diffuse)&&(w+=b.u_diffuse.type===r.SAMPLER_2D?"  vec4 diffuse = texture2D(u_diffuse, "+ft+");\n":"  vec4 diffuse = u_diffuse;\n",w+="  vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n",ot+="  color += diffuse.rgb * diffuseLight;\n"),fi&&(w+=b.u_specular.type===r.SAMPLER_2D?"  vec3 specular = texture2D(u_specular, "+ft+").rgb;\n":"  vec3 specular = u_specular.rgb;\n",w+="  vec3 specularLight = vec3(0.0, 0.0, 0.0);\n",ot+="  color += specular * specularLight;\n"),oi=t(b.u_transparency)?"  gl_FragColor = vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);\n":"  gl_FragColor = vec4(color * diffuse.a, diffuse.a);\n"):oi=t(b.u_transparency)?"  gl_FragColor = vec4(color * u_transparency, u_transparency);\n":"  gl_FragColor = vec4(color, 1.0);\n";ni&&(ot+="  color *= v_vertexColor.rgb;\n");t(b.u_emission)&&(w+=b.u_emission.type===r.SAMPLER_2D?"  vec3 emission = texture2D(u_emission, "+ft+").rgb;\n":"  vec3 emission = u_emission.rgb;\n",ot+="  color += emission;\n");(t(b.u_ambient)||rt!=="CONSTANT")&&(w+=t(b.u_ambient)?b.u_ambient.type===r.SAMPLER_2D?"  vec3 ambient = texture2D(u_ambient, "+ft+").rgb;\n":"  vec3 ambient = u_ambient.rgb;\n":"  vec3 ambient = diffuse.rgb;\n",ot+="  color += ambient * ambientLight;\n");w+="  vec3 viewDir = -normalize(v_positionEC);\n";w+="  vec3 ambientLight = vec3(0.0, 0.0, 0.0);\n";w+=p;w+=ot;w+=oi;w+="}\n";var wi=f(si,{type:r.VERTEX_SHADER,extras:{_pipeline:{source:k,extension:".glsl"}}}),bi=f(si,{type:r.FRAGMENT_SHADER,extras:{_pipeline:{source:w,extension:".glsl"}}}),ki=f(yi,{fragmentShader:bi,vertexShader:wi});return f(vi,{attributes:ut,program:ki,uniforms:b})}function h(n,i){var u=t(i.value)?i.value:t(i.index)?[i.index]:i;switch(n){case"ambient":return u.length===1?r.SAMPLER_2D:r.FLOAT_VEC4;case"diffuse":return u.length===1?r.SAMPLER_2D:r.FLOAT_VEC4;case"emission":return u.length===1?r.SAMPLER_2D:r.FLOAT_VEC4;case"specular":return u.length===1?r.SAMPLER_2D:r.FLOAT_VEC4;case"shininess":return r.FLOAT;case"transparency":return r.FLOAT;case"transparent":return r.BOOL;case"doubleSided":return r.BOOL}}function v(n,r){var u="",e,f,s,l;u+="technique:"+n.technique+";";var o=n.values,c=Object.keys(o).sort(),a=c.length;for(e=0;e<a;++e)f=c[e],o.hasOwnProperty(f)&&(u+=f+":"+h(f,o[f]),u+=";");return s=i(n.jointCount,0),u+=s.toString()+";",t(r)&&(l=r.skinning,s>0&&(u+=l.type+";"),u+=r.hasVertexColors),u}function y(n){var o=n.extensions.KHR_materials_common,s,l,e,r,h,c,f,u;if(t(o)&&t(o.lights))for(s=o.lights,l=s.length,e=0;e<l;e++)r=s[e],r.type==="ambient"?(t(r.ambient)||(r.ambient={}),h=r.ambient,t(h.color)||(h.color=[1,1,1])):r.type==="directional"?(t(r.directional)||(r.directional={}),c=r.directional,t(c.color)||(c.color=[1,1,1])):r.type==="point"?(t(r.point)||(r.point={}),f=r.point,t(f.color)||(f.color=[1,1,1]),f.constantAttenuation=i(f.constantAttenuation,1),f.linearAttenuation=i(f.linearAttenuation,0),f.quadraticAttenuation=i(f.quadraticAttenuation,0)):r.type==="spot"&&(t(r.spot)||(r.spot={}),u=r.spot,t(u.color)||(u.color=[1,1,1]),u.constantAttenuation=i(u.constantAttenuation,1),u.fallOffAngle=i(u.fallOffAngle,3.14159265),u.fallOffExponent=i(u.fallOffExponent,0),u.linearAttenuation=i(u.linearAttenuation,0),u.quadraticAttenuation=i(u.quadraticAttenuation,0))}return c});t("Scene/processPbrMaterials",["./ModelUtility","../Core/defined","../Core/defaultValue","../Core/WebGLConstants","../Core/webGLConstantToGlslType","../ThirdParty/GltfPipeline/addToArray","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/GltfPipeline/hasExtension","../ThirdParty/GltfPipeline/numberOfComponentsForType"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(r,u){if((u=i(u,{}),o(r,"KHR_techniques_webgl"))||!t(r.materials)||r.materials.length===0)return r;t(r.extensions)||(r.extensions={});t(r.extensionsUsed)||(r.extensionsUsed=[]);t(r.extensionsRequired)||(r.extensionsRequired=[]);r.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]};r.extensionsUsed.push("KHR_techniques_webgl");r.extensionsRequired.push("KHR_techniques_webgl");var f=n.splitIncompatibleMaterials(r);return e.material(r,function(n,i){var e={},o=l(r,n,i,e,f,u);t(n.extensions)||(n.extensions={});n.extensions.KHR_techniques_webgl={values:e,technique:o}}),n.ensureSemanticExistence(r),r}function c(n){return t(n.extensions)&&t(n.extensions.KHR_materials_pbrSpecularGlossiness)}function l(h,l,v,y,p,w){var yi=i(w.addBatchIdToGeneratedShaders,!1),ii=h.extensions.KHR_techniques_webgl,pi=ii.techniques,ci=ii.shaders,wi=ii.programs,kt=c(l),g,ot,dt=l.pbrMetallicRoughness,gt,ct,d,b,ri,ti,tt,vt,fi,ft,ei,k,it,yt,pt,oi,ut,et,si,st,wt,nt,hi;if(t(dt)&&!kt)for(ot in dt)dt.hasOwnProperty(ot)&&(g="u_"+ot,y[g]=dt[ot]);if(kt){gt=l.extensions.KHR_materials_pbrSpecularGlossiness;for(ot in gt)gt.hasOwnProperty(ot)&&(g="u_"+ot,y[g]=gt[ot])}for(ct in l)l.hasOwnProperty(ct)&&(ct.indexOf("Texture")>=0||ct.indexOf("Factor")>=0)&&(g="u_"+ct,y[g]=l[ct]);d="precision highp float;\n";b="precision highp float;\n";t(h.skins)&&(ri=h.skins[0]);var li=t(ri)?ri.joints:[],bi=li.length,ht=p[v],bt,lt=!1,ui=!1,ni=!1,rt=!1,at=!1,ai=!1,vi=!1;t(ht)&&(bt=ht.skinning,lt=bt.skinned&&li.length>0,ui=ht.hasVertexColors,ni=ht.hasMorphTargets,rt=ht.hasNormals,at=ht.hasTangents,ai=ht.hasTexCoords);ni&&e.mesh(h,function(n){e.meshPrimitive(n,function(n){if(n.material===v){var i=n.targets;t(i)&&(ti=i)}})});tt={u_modelViewMatrix:{semantic:o(h,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:r.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:r.FLOAT_MAT4}};t(l.extensions)&&t(l.extensions.KHR_materials_unlit)&&(vi=!0,rt=!1,at=!1);rt&&(tt.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:r.FLOAT_MAT3});lt&&(tt.u_jointMatrix={count:bi,semantic:"JOINTMATRIX",type:r.FLOAT_MAT4});ni&&(tt.u_morphWeights={count:ti.length,semantic:"MORPHWEIGHTS",type:r.FLOAT});vt=l.alphaMode;t(vt)&&vt==="MASK"&&(tt.u_alphaCutoff={semantic:"ALPHACUTOFF",type:r.FLOAT});for(g in y)y.hasOwnProperty(g)&&(tt[g]={type:a(g)});fi=i(tt.u_baseColorTexture,tt.u_baseColorFactor);t(fi)&&(fi.semantic="_3DTILESDIFFUSE");for(g in tt)tt.hasOwnProperty(g)&&(ft=tt[g],ei=t(ft.count)?"["+ft.count+"]":"",ft.type!==r.FLOAT_MAT3&&ft.type!==r.FLOAT_MAT4&&g!=="u_morphWeights"||ft.useInFragment?(b+="uniform "+u(ft.type)+" "+g+ei+";\n",delete ft.useInFragment):d+="uniform "+u(ft.type)+" "+g+ei+";\n");if(k="",lt)if(pt=s(bt.type),oi=!1,bt.type.indexOf("MAT")===0&&(oi=!0,pt=Math.sqrt(pt)),oi)for(it=0;it<pt;it++)for(yt=0;yt<pt;yt++)k+=it===0&&yt===0?"    mat4 skinMatrix = ":"    skinMatrix += ",k+="a_weight["+it+"]["+yt+"] * u_jointMatrix[int(a_joint["+it+"]["+yt+"])];\n";else for(it=0;it<pt;it++)k+=it===0?"    mat4 skinMatrix = ":"    skinMatrix += ",k+="a_weight["+it+"] * u_jointMatrix[int(a_joint["+it+"])];\n";if(ut={a_position:{semantic:"POSITION"}},d+="attribute vec3 a_position;\n",rt&&(d+="varying vec3 v_positionEC;\n",d+="varying vec3 v_positionWC;\n"),k+="    vec3 weightedPosition = a_position;\n",rt&&(k+="    vec3 weightedNormal = a_normal;\n"),at&&(k+="    vec4 weightedTangent = a_tangent;\n"),ni)for(et=0;et<ti.length;et++){si=ti[et];for(st in si)si.hasOwnProperty(st)&&st!=="extras"&&(wt="a_"+st+"_"+et,ut[wt]={semantic:st+"_"+et},d+="attribute vec3 "+wt+";\n",st==="POSITION"?k+="    weightedPosition += u_morphWeights["+et+"] * "+wt+";\n":st==="NORMAL"?k+="    weightedNormal += u_morphWeights["+et+"] * "+wt+";\n":at&&st==="TANGENT"&&(k+="    weightedTangent.xyz += u_morphWeights["+et+"] * "+wt+";\n"))}k+=lt?"    vec4 position = skinMatrix * vec4(weightedPosition, 1.0);\n":"    vec4 position = vec4(weightedPosition, 1.0);\n";rt&&(k+="    v_positionWC = (czm_model * position).xyz;\n");k+="    position = u_modelViewMatrix * position;\n";rt&&(k+="    v_positionEC = position.xyz;\n");k+="    gl_Position = u_projectionMatrix * position;\n";rt&&(ut.a_normal={semantic:"NORMAL"},d+="attribute vec3 a_normal;\n",d+="varying vec3 v_normal;\n",k+=lt?"    v_normal = u_normalMatrix * mat3(skinMatrix) * weightedNormal;\n":"    v_normal = u_normalMatrix * weightedNormal;\n",b+="varying vec3 v_normal;\n",b+="varying vec3 v_positionEC;\n",b+="varying vec3 v_positionWC;\n");at&&(ut.a_tangent={semantic:"TANGENT"},d+="attribute vec4 a_tangent;\n",d+="varying vec4 v_tangent;\n",k+="    v_tangent.xyz = u_normalMatrix * weightedTangent.xyz;\n",k+="    v_tangent.w = weightedTangent.w;\n",b+="varying vec4 v_tangent;\n");ai&&(ut.a_texcoord_0={semantic:"TEXCOORD_0"},nt="v_texcoord_0",d+="attribute vec2 a_texcoord_0;\n",d+="varying vec2 "+nt+";\n",k+="    "+nt+" = a_texcoord_0;\n",b+="varying vec2 "+nt+";\n");lt&&(hi=n.getShaderVariable(bt.type),ut.a_joint={semantic:"JOINTS_0"},ut.a_weight={semantic:"WEIGHTS_0"},d+="attribute "+hi+" a_joint;\n",d+="attribute "+hi+" a_weight;\n");ui&&(ut.a_vertexColor={semantic:"COLOR_0"},d+="attribute vec4 a_vertexColor;\n",d+="varying vec4 v_vertexColor;\n",k+="  v_vertexColor = a_vertexColor;\n",b+="varying vec4 v_vertexColor;\n");yi&&(ut.a_batchId={semantic:"_BATCHID"},d+="attribute float a_batchId;\n");d+="void main(void) \n{\n";d+=k;d+="}\n";rt&&(b+="const float M_PI = 3.141592653589793;\n",b+="vec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\n\n",b+="vec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\n",b+="vec3 fresnelSchlick(float metalness, float VdotH) \n{\n    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n",b+="float smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\n",b+="float smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\n\n",b+="float GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\n\n");b+="vec3 SRGBtoLINEAR3(vec3 srgbIn) \n{\n    return pow(srgbIn, vec3(2.2));\n}\n\n";b+="vec4 SRGBtoLINEAR4(vec4 srgbIn) \n{\n    vec3 linearOut = pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n\n";b+="vec3 LINEARtoSRGB(vec3 linearIn) \n{\n    return pow(linearIn, vec3(1.0/2.2));\n}\n\n";b+="void main(void) \n{\n";rt&&(b+="    vec3 ng = normalize(v_normal);\n",t(y.u_normalTexture)?at?(b+="    vec3 t = normalize(v_tangent.xyz);\n",b+="    vec3 b = normalize(cross(ng, t) * v_tangent.w);\n",b+="    mat3 tbn = mat3(t, b, ng);\n",b+="    vec3 n = texture2D(u_normalTexture, "+nt+").rgb;\n",b+="    n = normalize(tbn * (2.0 * n - 1.0));\n"):(b="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"+b,b+="#ifdef GL_OES_standard_derivatives\n",b+="    vec3 pos_dx = dFdx(v_positionEC);\n",b+="    vec3 pos_dy = dFdy(v_positionEC);\n",b+="    vec3 tex_dx = dFdx(vec3("+nt+",0.0));\n",b+="    vec3 tex_dy = dFdy(vec3("+nt+",0.0));\n",b+="    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n",b+="    t = normalize(t - ng * dot(ng, t));\n",b+="    vec3 b = normalize(cross(ng, t));\n",b+="    mat3 tbn = mat3(t, b, ng);\n",b+="    vec3 n = texture2D(u_normalTexture, "+nt+").rgb;\n",b+="    n = normalize(tbn * (2.0 * n - 1.0));\n",b+="#else\n",b+="    vec3 n = ng;\n",b+="#endif\n"):b+="    vec3 n = ng;\n",l.doubleSided&&(b+="    if (!gl_FrontFacing)\n",b+="    {\n",b+="        n = -n;\n",b+="    }\n"));t(y.u_baseColorTexture)?(b+="    vec4 baseColorWithAlpha = SRGBtoLINEAR4(texture2D(u_baseColorTexture, "+nt+"));\n",t(y.u_baseColorFactor)&&(b+="    baseColorWithAlpha *= u_baseColorFactor;\n")):b+=t(y.u_baseColorFactor)?"    vec4 baseColorWithAlpha = u_baseColorFactor;\n":"    vec4 baseColorWithAlpha = vec4(1.0);\n";ui&&(b+="    baseColorWithAlpha *= v_vertexColor;\n");b+="    vec3 baseColor = baseColorWithAlpha.rgb;\n";rt?(kt?(t(y.u_specularGlossinessTexture)?(b+="    vec4 specularGlossiness = SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, "+nt+"));\n",b+="    vec3 specular = specularGlossiness.rgb;\n",b+="    float glossiness = specularGlossiness.a;\n",t(y.u_specularFactor)&&(b+="    specular *= u_specularFactor;\n"),t(y.u_glossinessFactor)&&(b+="    glossiness *= u_glossinessFactor;\n")):(b+=t(y.u_specularFactor)?"    vec3 specular = clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n":"    vec3 specular = vec3(1.0);\n",b+=t(y.u_glossinessFactor)?"    float glossiness = clamp(u_glossinessFactor, 0.0, 1.0);\n":"    float glossiness = 1.0;\n"),t(y.u_diffuseTexture)?(b+="    vec4 diffuse = SRGBtoLINEAR4(texture2D(u_diffuseTexture, "+nt+"));\n",t(y.u_diffuseFactor)&&(b+="    diffuse *= u_diffuseFactor;\n")):b+=t(y.u_diffuseFactor)?"    vec4 diffuse = clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n":"    vec4 diffuse = vec4(1.0);\n"):t(y.u_metallicRoughnessTexture)?(b+="    vec3 metallicRoughness = texture2D(u_metallicRoughnessTexture, "+nt+").rgb;\n",b+="    float metalness = clamp(metallicRoughness.b, 0.0, 1.0);\n",b+="    float roughness = clamp(metallicRoughness.g, 0.04, 1.0);\n",t(y.u_metallicFactor)&&(b+="    metalness *= u_metallicFactor;\n"),t(y.u_roughnessFactor)&&(b+="    roughness *= u_roughnessFactor;\n")):(b+=t(y.u_metallicFactor)?"    float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n":"    float metalness = 1.0;\n",b+=t(y.u_roughnessFactor)?"    float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n":"    float roughness = 1.0;\n"),b+="    vec3 v = -normalize(v_positionEC);\n",b+="    vec3 lightColor = vec3(1.5, 1.4, 1.2);\n",b+="    vec3 l = normalize(czm_sunDirectionEC);\n",b+="    vec3 h = normalize(v + l);\n",b+="    vec3 r = normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n",b+="    czm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\n",b+="    float vertexRadius = length(v_positionWC);\n",b+="    float horizonDotNadir = 1.0 - min(1.0, ellipsoid.radii.x / vertexRadius);\n",b+="    float reflectionDotNadir = dot(r, normalize(v_positionWC));\n",b+="    r.x = -r.x;\n",b+="    r = -normalize(czm_temeToPseudoFixed * r);\n",b+="    r.x = -r.x;\n",b+="    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n",b+="    float NdotV = abs(dot(n, v)) + 0.001;\n",b+="    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n",b+="    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n",b+="    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n",b+="    vec3 f0 = vec3(0.04);\n",kt?(b+="    float roughness = 1.0 - glossiness;\n",b+="    vec3 diffuseColor = diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n",b+="    vec3 specularColor = specular;\n"):(b+="    vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n",b+="    vec3 specularColor = mix(f0, baseColor, metalness);\n"),b+="    float alpha = roughness * roughness;\n",b+="    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n",b+="    vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n",b+="    vec3 r0 = specularColor.rgb;\n",b+="    vec3 F = fresnelSchlick2(r0, r90, VdotH);\n",b+="    float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n",b+="    float D = GGX(alpha, NdotH);\n",b+="    vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n",b+="    vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n",b+="    vec3 color = NdotL * lightColor * (diffuseContribution + specularContribution);\n",b+="    float inverseRoughness = 1.04 - roughness;\n",b+="    inverseRoughness *= inverseRoughness;\n",b+="    vec3 sceneSkyBox = textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n",b+="    float atmosphereHeight = 0.05;\n",b+="    float blendRegionSize = 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n",b+="    float blendRegionOffset = roughness * -1.0;\n",b+="    float farAboveHorizon = clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n",b+="    float aroundHorizon = clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n",b+="    float farBelowHorizon = clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n",b+="    float smoothstepHeight = smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n",b+="    vec3 belowHorizonColor = mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n",b+="    vec3 nadirColor = belowHorizonColor * 0.5;\n",b+="    vec3 aboveHorizonColor = mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n",b+="    vec3 blueSkyColor = mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n",b+="    vec3 zenithColor = mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n",b+="    vec3 blueSkyDiffuseColor = vec3(0.7, 0.85, 0.9);\n",b+="    float diffuseIrradianceFromEarth = (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;\n",b+="    float diffuseIrradianceFromSky = (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n",b+="    vec3 diffuseIrradiance = blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n",b+="    float notDistantRough = (1.0 - horizonDotNadir * roughness * 0.8);\n",b+="    vec3 specularIrradiance = mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n",b+="    specularIrradiance = mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n",b+="    specularIrradiance = mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n",b+="    vec2 brdfLut = texture2D(czm_brdfLut, vec2(NdotV, 1.0 - roughness)).rg;\n",b+="    vec3 IBLColor = (diffuseIrradiance * diffuseColor) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y));\n",b+="    color += IBLColor;\n"):b+="    vec3 color = baseColor;\n";vi||(t(y.u_occlusionTexture)&&(b+="    color *= texture2D(u_occlusionTexture, "+nt+").r;\n"),t(y.u_emissiveTexture)?(b+="    vec3 emissive = SRGBtoLINEAR3(texture2D(u_emissiveTexture, "+nt+").rgb);\n",t(y.u_emissiveFactor)&&(b+="    emissive *= u_emissiveFactor;\n"),b+="    color += emissive;\n"):t(y.u_emissiveFactor)&&(b+="    color += u_emissiveFactor;\n"));b+="    color = LINEARtoSRGB(color);\n";t(vt)?vt==="MASK"?(b+="    if (baseColorWithAlpha.a < u_alphaCutoff) {\n",b+="        discard;\n",b+="    }\n",b+="    gl_FragColor = vec4(color, 1.0);\n"):b+=vt==="BLEND"?"    gl_FragColor = vec4(color, baseColorWithAlpha.a);\n":"    gl_FragColor = vec4(color, 1.0);\n":b+="    gl_FragColor = vec4(color, 1.0);\n";b+="}\n";var ki=f(ci,{type:r.VERTEX_SHADER,extras:{_pipeline:{source:d,extension:".glsl"}}}),di=f(ci,{type:r.FRAGMENT_SHADER,extras:{_pipeline:{source:b,extension:".glsl"}}}),gi=f(wi,{fragmentShader:di,vertexShader:ki});return f(pi,{attributes:ut,program:gi,uniforms:tt})}function a(n){switch(n){case"u_baseColorFactor":return r.FLOAT_VEC4;case"u_metallicFactor":return r.FLOAT;case"u_roughnessFactor":return r.FLOAT;case"u_baseColorTexture":return r.SAMPLER_2D;case"u_metallicRoughnessTexture":return r.SAMPLER_2D;case"u_normalTexture":return r.SAMPLER_2D;case"u_occlusionTexture":return r.SAMPLER_2D;case"u_emissiveTexture":return r.SAMPLER_2D;case"u_emissiveFactor":return r.FLOAT_VEC3;case"u_diffuseFactor":return r.FLOAT_VEC4;case"u_specularFactor":return r.FLOAT_VEC3;case"u_glossinessFactor":return r.FLOAT;case"u_diffuseTexture":return r.SAMPLER_2D;case"u_specularGlossinessTexture":return r.SAMPLER_2D}}return h});t("Scene/Model",["../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/clone","../Core/Color","../Core/combine","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/FeatureDetection","../Core/getAbsoluteUri","../Core/getMagic","../Core/getStringFromTypedArray","../Core/IndexDatatype","../Core/loadCRN","../Core/loadImageFromTypedArray","../Core/loadKTX","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/PixelFormat","../Core/PrimitiveType","../Core/Quaternion","../Core/Resource","../Core/Transforms","../Core/WebGLConstants","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/Sampler","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Renderer/VertexArray","../ThirdParty/GltfPipeline/addDefaults","../ThirdParty/GltfPipeline/addPipelineExtras","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/GltfPipeline/getAccessorByteStride","../ThirdParty/GltfPipeline/hasExtension","../ThirdParty/GltfPipeline/numberOfComponentsForType","../ThirdParty/GltfPipeline/parseGlb","../ThirdParty/GltfPipeline/removePipelineExtras","../ThirdParty/GltfPipeline/updateVersion","../ThirdParty/when","./Axis","./BlendingState","./ClippingPlaneCollection","./ColorBlendMode","./DracoLoader","./getClipAndStyleCode","./getClippingFunction","./HeightReference","./JobType","./ModelAnimationCache","./ModelAnimationCollection","./ModelLoadResources","./ModelMaterial","./ModelMesh","./ModelNode","./ModelUtility","./processModelMaterialsCommon","./processPbrMaterials","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr,tr,ir,rr,ur,fr,er,or,sr,hr){"use strict";function ru(n,t){n._cachedGltf=t}function wr(n){this._gltf=n.gltf;this.ready=n.ready;this.modelsToLoad=[];this.count=0}function lr(t){var i,r,u,o,c,e;t=s(t,s.EMPTY_OBJECT);i=t.cacheKey;this._cacheKey=i;this._cachedGltf=undefined;this._releaseGltfJson=s(t.releaseGltfJson,!1);h(i)&&h(vr[i])&&vr[i].ready?(r=vr[i],++r.count):(u=t.gltf,h(u)&&(u instanceof ArrayBuffer&&(u=new Uint8Array(u)),u instanceof Uint8Array?(o=oi(u),r=new wr({gltf:o,ready:!0})):r=new wr({gltf:t.gltf,ready:!0}),r.count=1,h(i)&&(vr[i]=r)));ru(this,r);c=s(t.basePath,"");this._resource=ot.createIfNeeded(c);this.show=s(t.show,!0);this.silhouetteColor=s(t.silhouetteColor,f.RED);this._silhouetteColor=new f;this._silhouetteColorPreviousAlpha=1;this._normalAttributeName=undefined;this.silhouetteSize=s(t.silhouetteSize,0);this.modelMatrix=rt.clone(s(t.modelMatrix,rt.IDENTITY));this._modelMatrix=rt.clone(this.modelMatrix);this._clampedModelMatrix=undefined;this.scale=s(t.scale,1);this._scale=this.scale;this.minimumPixelSize=s(t.minimumPixelSize,0);this._minimumPixelSize=this.minimumPixelSize;this.maximumScale=t.maximumScale;this._maximumScale=this.maximumScale;this.id=t.id;this._id=t.id;this.heightReference=s(t.heightReference,ki.NONE);this._heightReference=this.heightReference;this._heightChanged=!1;this._removeUpdateHeightCallback=undefined;e=t.scene;this._scene=e;h(e)&&h(e.terrainProviderChanged)&&(this._terrainProviderChangedCallback=e.terrainProviderChanged.addEventListener(function(){this._heightChanged=!0},this));this._pickObject=t.pickObject;this._allowPicking=s(t.allowPicking,!0);this._ready=!1;this._readyPromise=ci.defer();this.activeAnimations=new nr(this);this.clampAnimations=s(t.clampAnimations,!0);this._defaultTexture=undefined;this._incrementallyLoadTextures=s(t.incrementallyLoadTextures,!0);this._asynchronous=s(t.asynchronous,!0);this.shadows=s(t.shadows,hr.ENABLED);this._shadows=this.shadows;this.color=s(t.color,f.WHITE);this._color=new f;this._colorPreviousAlpha=1;this.colorBlendMode=s(t.colorBlendMode,yi.HIGHLIGHT);this.colorBlendAmount=s(t.colorBlendAmount,.5);this._colorShadingEnabled=!1;this._clippingPlanes=undefined;this.clippingPlanes=t.clippingPlanes;this._clippingPlanesState=0;this.clippingPlaneOffsetMatrix=undefined;this.debugShowBoundingVolume=s(t.debugShowBoundingVolume,!1);this._debugShowBoundingVolume=!1;this.debugWireframe=s(t.debugWireframe,!1);this._debugWireframe=!1;this._distanceDisplayCondition=t.distanceDisplayCondition;this._addBatchIdToGeneratedShaders=t.addBatchIdToGeneratedShaders;this._precreatedAttributes=t.precreatedAttributes;this._vertexShaderLoaded=t.vertexShaderLoaded;this._fragmentShaderLoaded=t.fragmentShaderLoaded;this._uniformMapLoaded=t.uniformMapLoaded;this._pickIdLoaded=t.pickIdLoaded;this._ignoreCommands=s(t.ignoreCommands,!1);this._requestType=t.requestType;this._upAxis=s(t.upAxis,li.Y);this._gltfForwardAxis=li.Z;this._forwardAxis=t.forwardAxis;this.cull=s(t.cull,!0);this.opaquePass=s(t.opaquePass,vt.OPAQUE);this._computedModelMatrix=new rt;this._clippingPlaneModelViewMatrix=rt.clone(rt.IDENTITY);this._initialRadius=undefined;this._boundingSphere=undefined;this._scaledBoundingSphere=new n;this._state=ar.NEEDS_LOAD;this._loadResources=undefined;this._mode=undefined;this._perNodeShowDirty=!1;this._cesiumAnimationsDirty=!1;this._dirty=!1;this._maxDirtyNumber=0;this._runtime={animations:undefined,rootNodes:undefined,nodes:undefined,nodesByName:undefined,skinnedNodes:undefined,meshesByName:undefined,materialsByName:undefined,materialsById:undefined};this._uniformMaps={};this._extensionsUsed=undefined;this._extensionsRequired=undefined;this._quantizedUniforms={};this._programPrimitives={};this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}};this._cachedRendererResources=undefined;this._loadRendererResourcesFromCache=!1;this._dequantizeInShader=s(t.dequantizeInShader,!0);this._decodedData={};this._cachedGeometryByteLength=0;this._cachedTexturesByteLength=0;this._geometryByteLength=0;this._texturesByteLength=0;this._trianglesLength=0;this._sourceTechniques={};this._sourcePrograms={};this._quantizedVertexShaders={};this._nodeCommands=[];this._pickIds=[];this._rtcCenter=undefined;this._rtcCenterEye=undefined;this._rtcCenter3D=undefined;this._rtcCenter2D=undefined}function wu(n){return n.stencilBuffer}function fu(n){return!f.equals(n.color,f.WHITE)||n.colorBlendMode!==yi.HIGHLIGHT}function bu(n){var t=n._clippingPlanes;return h(t)&&t.enabled}function fe(n){var t=w(n);return t==="glTF"}function eu(n,t,i){if(n._state!==ar.LOADED)throw new a("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");if(!h(i))throw new a("name is required.");return n._runtime[t][i]}function ee(n){var t=n.gltf,i=n._loadResources;ri.buffer(t,function(n,t){i.buffers[t]=n.extras._pipeline.source})}function oe(n,t){return function(i){var r=n._loadResources,u=new Uint8Array(i);--r.pendingBufferLoads;n.gltf.buffers[t].extras._pipeline.source=u}}function se(n){var r=n.gltf.bufferViews,u=n._loadResources.vertexBuffersToCreate,i,t;ri.bufferView(n.gltf,function(n,t){n.target===ht.ARRAY_BUFFER&&u.enqueue(t)});i=n._loadResources.indexBuffersToCreate;t={};ri.accessor(n.gltf,function(n){var u=n.bufferView,f;h(u)&&(f=r[u],f.target!==ht.ELEMENT_ARRAY_BUFFER||h(t[u])||(t[u]=!0,i.enqueue({id:u,componentType:n.componentType})))})}function he(n){var t=n.gltf;if(fi(t,"KHR_techniques_webgl")){var i=n._sourcePrograms,r=n._sourceTechniques,f=t.extensions.KHR_techniques_webgl.programs;ri.technique(t,function(n,t){r[t]=u(n);var e=n.program;h(i[e])||(i[e]=u(f[e]))})}}function ce(n,t,i){return function(r){var u=n._loadResources;u.shaders[i]={source:r,type:t,bufferView:undefined};--u.pendingShaderLoads;n._rendererResources.sourceShaders[i]=r}}function le(n){var t=n.gltf,r=t.buffers,u=t.bufferViews,i=n._rendererResources.sourceShaders;ri.shader(t,function(t,f){var o;if(h(t.bufferView)){var s=t.bufferView,e=u[s],c=e.buffer,l=r[c],a=b(l.extras._pipeline.source,e.byteOffset,e.byteLength);i[f]=a}else h(t.extras._pipeline.source)?i[f]=t.extras._pipeline.source:(++n._loadResources.pendingShaderLoads,o=n._resource.getDerivedResource({url:t.uri}),o.fetchText().then(ce(n,t.type,f)).otherwise(fr.getFailedLoadFunction(n,"shader",o.url)))})}function ae(n){var i=n._sourceTechniques,t,r;for(t in i)i.hasOwnProperty(t)&&(r=i[t],n._loadResources.programsToCreate.enqueue({programId:r.program,techniqueId:t}))}function ou(n,t){return function(i){var r=n._loadResources;--r.pendingTextureLoads;r.texturesToCreate.enqueue({id:t,image:i,bufferView:i.bufferView,width:i.width,height:i.height,internalFormat:i.internalFormat})}}function ve(n,t){var r=n.gltf,u=r.images,i;ri.texture(r,function(r,f){var w=r.source,p=u[w],e=p.extras,o=p.bufferView,s=p.mimeType,y,b;if(i=p.uri,h(e)&&h(e.compressedImage3DTiles)){var c=e.compressedImage3DTiles.crunch,l=e.compressedImage3DTiles.s3tc,a=e.compressedImage3DTiles.pvrtc1,v=e.compressedImage3DTiles.etc1;t.s3tc&&h(c)?(s=c.mimeType,h(c.bufferView)?o=c.bufferView:i=c.uri):t.s3tc&&h(l)?(s=l.mimeType,h(l.bufferView)?o=l.bufferView:i=l.uri):t.pvrtc&&h(a)?(s=a.mimeType,h(a.bufferView)?o=a.bufferView:i=a.uri):t.etc1&&h(v)&&(s=v.mimeType,h(v.bufferView)?o=v.bufferView:i=v.uri)}h(o)?n._loadResources.texturesToCreateFromBufferView.enqueue({id:f,image:undefined,bufferView:o,mimeType:s}):(++n._loadResources.pendingTextureLoads,y=n._resource.getDerivedResource({url:i}),b=ku.test(i)?nt(y):du.test(i)?d(y):y.fetchImage(),b.then(ou(n,f,w)).otherwise(fr.getFailedLoadFunction(n,"image",y.url)))})}function ye(n){var t={},i={},r=[],u=n._loadResources.skinnedNodesIds;ri.node(n.gltf,function(f,e){var o={matrix:undefined,translation:undefined,rotation:undefined,scale:undefined,computedShow:!0,transformToRoot:new rt,computedMatrix:new rt,dirtyNumber:0,commands:[],inverseBindMatrices:undefined,bindShapeMatrix:undefined,joints:[],computedJointMatrices:[],jointName:f.jointName,weights:[],children:[],parents:[],publicNode:undefined};o.publicNode=new ur(n,f,o,e,fr.getTransform(f));t[e]=o;i[f.name]=o;h(f.skin)&&(u.push(e),r.push(o))});n._runtime.nodes=t;n._runtime.nodesByName=i;n._runtime.skinnedNodes=r}function pe(n){var r=n.gltf,f=n._sourceTechniques,t={},i={},e=n._uniformMaps;ri.material(r,function(r,o){var s,c;e[o]={uniformMap:undefined,values:undefined,jointMatrixUniformName:undefined,morphWeightsUniformName:undefined};s=new ir(n,r,o);h(r.extensions)&&h(r.extensions.KHR_techniques_webgl)&&(c=r.extensions.KHR_techniques_webgl.technique,s._technique=c,s._program=f[c].program,ri.materialValue(r,function(n,t){h(s._values)||(s._values={});s._values[t]=u(n)}));t[r.name]=s;i[o]=s});n._runtime.materialsByName=t;n._runtime.materialsById=i}function we(n){var t={},i=n._runtime.materialsById;ri.mesh(n.gltf,function(r,u){t[r.name]=new rr(r,i,u);(h(n.extensionsUsed.WEB3D_quantized_attributes)||n._dequantizeInShader)&&ri.meshPrimitive(r,function(t,i){var f=cu(n,t),r=n._programPrimitives[f];h(r)||(r={},n._programPrimitives[f]=r);r[u+".primitive."+i]=t})});n._runtime.meshesByName=t}function gu(n,t,i){var f=t._loadResources,e=t.gltf.bufferViews,u=e[n],r;h(u)||(u=f.createdBufferViews[n]);r=ct.createVertexBuffer({context:i,typedArray:f.getBuffer(u),usage:lt.STATIC_DRAW});r.vertexArrayDestroyable=!1;t._rendererResources.buffers[n]=r;t._geometryByteLength+=r.sizeInBytes}function nf(n,t,i,r){var e=i._loadResources,o=i.gltf.bufferViews,f=o[n],u;h(f)||(f=e.createdBufferViews[n]);u=ct.createIndexBuffer({context:r,typedArray:e.getBuffer(f),usage:lt.STATIC_DRAW,indexDatatype:t});u.vertexArrayDestroyable=!1;i._rendererResources.buffers[n]=u;i._geometryByteLength+=u.sizeInBytes}function be(n,t){var e=n._loadResources;if(e.pendingBufferLoads===0){var f=t.context,r=e.vertexBuffersToCreate,u=e.indexBuffersToCreate,i;if(n.asynchronous){while(r.length>0){if(su.set(r.peek(),n,f),!t.jobScheduler.execute(su,di.BUFFER))break;r.dequeue()}while(u.length>0){if(i=u.peek(),hu.set(i.id,i.componentType,n,f),!t.jobScheduler.execute(hu,di.BUFFER))break;u.dequeue()}}else{while(r.length>0)gu(r.dequeue(),n,f);while(u.length>0)i=u.dequeue(),nf(i.id,i.componentType,n,f)}}}function cu(n,t){var i=n._runtime.materialsById[t.material];if(h(i))return i._program}function tf(n,t,i){var u,f=i._programPrimitives[t],e,r,o;if(!h(f))return n;for(e in f)if(f.hasOwnProperty(e)&&(u=f[e],cu(i,u)===t))break;return r=n,i.extensionsUsed.WEB3D_quantized_attributes?(r=fr.modifyShaderForQuantizedAttributes(i.gltf,u,n),i._quantizedUniforms[t]=r.uniforms):(o=i._decodedData[e],h(o)&&(r=fr.modifyShaderForDracoQuantizedAttributes(i.gltf,u,n,o.attributes))),i._programPrimitives[t]=undefined,r.shader}function ke(n){return n=bt.replaceMain(n,"gltf_blend_main"),n+"uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n"}function br(n,t,i){return h(i)&&(n=i(n,t)),n}function rf(n,t,i){var r=n.programId,a=n.techniqueId,s=t._sourcePrograms[r],c=t._rendererResources.sourceShaders,o=c[s.vertexShader],v=c[s.fragmentShader],l=t._quantizedVertexShaders,p=t._toClipCoordinatesGLSL[r],f,e,u;(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(f=l[r],h(f)||(f=tf(o,r,t),l[r]=f),o=f);e=br(o,r,t._vertexShaderLoaded);u=br(v,r,t._fragmentShaderLoaded);y.isInternetExplorer()||(e=fr.modifyVertexShaderForLogDepth(e,p),u=fr.modifyFragmentShaderForLogDepth(u));h(t._uniformMapLoaded)||(u="uniform vec4 czm_pickColor;\n"+u);uf(r,a,u,e,t,i)}function de(n,t,i){var r=n.programId,l=n.techniqueId,o=t._sourcePrograms[r],s=t._rendererResources.sourceShaders,a=t._quantizedVertexShaders,v=t._toClipCoordinatesGLSL[r],p=t.clippingPlanes,w=bu(t),c=s[o.vertexShader],b=s[o.fragmentShader],u,e,f;(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(c=a[r]);u=b;fu(t)&&(u=lr._modifyShaderForColor(u));w&&(u=uh(u,p,i));e=br(c,r,t._vertexShaderLoaded);f=br(u,r,t._fragmentShaderLoaded);y.isInternetExplorer()||(e=fr.modifyVertexShaderForLogDepth(e,v),f=fr.modifyFragmentShaderForLogDepth(f));h(t._uniformMapLoaded)||(f="uniform vec4 czm_pickColor;\n"+f);uf(r,l,f,e,t,i)}function uf(n,t,i,r,u,f){var e=u._sourceTechniques[t],o=fr.createAttributeLocations(e,u._precreatedAttributes);u._rendererResources.programs[n]=wt.fromCache({context:f,vertexShaderSource:r,fragmentShaderSource:i,attributeLocations:o})}function ge(n,t){var r=n._loadResources,i=r.programsToCreate,u;if(r.pendingShaderLoads===0&&r.pendingBufferLoads===0)if(u=t.context,n.asynchronous)while(i.length>0){if(lu.set(i.peek(),n,u),!t.jobScheduler.execute(lu,di.PROGRAM))break;i.dequeue()}else while(i.length>0)rf(i.dequeue(),n,u)}function no(n,t){return function(i){n.texturesToCreate.enqueue({id:t.id,image:i,bufferView:undefined});--n.pendingBufferViewToImage}}function to(n){var i=n._loadResources,o;if(i.pendingBufferLoads===0)while(i.texturesToCreateFromBufferView.length>0){var t=i.texturesToCreateFromBufferView.dequeue(),f=n.gltf,r=f.bufferViews[t.bufferView],e=f.textures[t.id].source,u=fr.getFailedLoadFunction(n,"image","id: "+t.id+", bufferView: "+t.bufferView);t.mimeType==="image/ktx"?(nt(i.getBuffer(r)).then(ou(n,t.id,e)).otherwise(u),++n._loadResources.pendingTextureLoads):t.mimeType==="image/crn"?(d(i.getBuffer(r)).then(ou(n,t.id,e)).otherwise(u),++n._loadResources.pendingTextureLoads):(o=no(i,t),g(i.getBuffer(r),t.mimeType).then(o).otherwise(u),++i.pendingBufferViewToImage)}}function io(n){var t=n._loadResources,i;t.createSamplers&&(t.createSamplers=!1,i=n._rendererResources.samplers,ri.sampler(n.gltf,function(n,t){i[t]=new pt({wrapS:n.wrapS,wrapT:n.wrapT,minificationFilter:n.minFilter,magnificationFilter:n.magFilter})}))}function ff(n,t,i){var y=t.gltf.textures,c=y[n.id],p=t._rendererResources.samplers,r=p[c.sampler],a,f,v;r=s(r,new pt({wrapS:gt.REPEAT,wrapT:gt.REPEAT}));var o=n.internalFormat,l=!(h(o)&&ut.isCompressedFormat(o))&&(r.minificationFilter===dt.NEAREST_MIPMAP_NEAREST||r.minificationFilter===dt.NEAREST_MIPMAP_LINEAR||r.minificationFilter===dt.LINEAR_MIPMAP_NEAREST||r.minificationFilter===dt.LINEAR_MIPMAP_LINEAR),w=l||r.wrapS===gt.REPEAT||r.wrapS===gt.MIRRORED_REPEAT||r.wrapT===gt.REPEAT||r.wrapT===gt.MIRRORED_REPEAT,e,u=n.image;h(o)?e=new kt({context:i,source:{arrayBufferView:n.bufferView},width:n.width,height:n.height,pixelFormat:o,sampler:r}):h(u)&&(a=!tt.isPowerOfTwo(u.width)||!tt.isPowerOfTwo(u.height),w&&a&&(f=document.createElement("canvas"),f.width=tt.nextPowerOfTwo(u.width),f.height=tt.nextPowerOfTwo(u.height),v=f.getContext("2d"),v.drawImage(u,0,0,u.width,u.height,0,0,f.width,f.height),u=f),e=new kt({context:i,source:u,pixelFormat:c.internalFormat,pixelDatatype:c.type,sampler:r,flipY:!1}),l&&e.generateMipmap());h(e)&&(t._rendererResources.textures[n.id]=e,t._texturesByteLength+=e.sizeInBytes)}function ro(n,t){var r=t.context,i=n._loadResources.texturesToCreate;if(n.asynchronous)while(i.length>0){if(au.set(i.peek(),n,r),!t.jobScheduler.execute(au,di.TEXTURE))break;i.dequeue()}else while(i.length>0)ff(i.dequeue(),n,r)}function uo(n,t){var v=n._sourceTechniques,r={},i,u,s=n._runtime.materialsById[t.material],f,o,e;if(!h(s)||(f=v[s._technique],!h(f)))return r;var y=f.attributes,c=n._rendererResources.programs[f.program],l=c.vertexAttributes,a=c._attributeLocations;for(i in l)l.hasOwnProperty(i)&&(o=y[i],h(o)&&(u=a[i],r[o.semantic]=u));if(e=n._precreatedAttributes,h(e))for(i in e)e.hasOwnProperty(i)&&(u=a[i],r[i]=u);return r}function fo(n,t){for(var i,r,o,u,c,f,l=n.length,s={},e=0;e<l;++e)for(i=[n[e]];i.length>0;)if(r=i.pop(),o=t[r],h(o)&&(s[r]=r),u=o.children,h(u))for(c=u.length,f=0;f<c;++f)i.push(u[f]);return s}function eo(n,t){for(var e,o,i,s=n.gltf,c=s.skins,l=s.nodes,a=n._runtime.nodes,v=n._loadResources.skinnedNodesIds,b=v.length,r=0;r<b;++r){var y=v[r],u=a[y],f=l[y],p=t[f.skin];u.inverseBindMatrices=p.inverseBindMatrices;u.bindShapeMatrix=p.bindShapeMatrix;e=[];o=c[f.skin];h(o.skeleton)&&e.push(o.skeleton);var k=fo(e,l),w=c[f.skin].joints,d=w.length;for(i=0;i<d;++i){var g=w[i],nt=k[g],tt=a[nt];u.joints.push(tt)}}}function oo(n){var t=n._loadResources;if(t.pendingBufferLoads===0&&t.createSkins){t.createSkins=!1;var i=n.gltf,u=i.accessors,r={};ri.skin(i,function(t,i){var e=u[t.inverseBindMatrices],f;rt.equals(t.bindShapeMatrix,rt.IDENTITY)||(f=rt.clone(t.bindShapeMatrix));r[i]={inverseBindMatrices:gi.getSkinInverseBindMatrices(n,e),bindShapeMatrix:f}});eo(n,r)}}function so(n,t,i,r){return function(u){h(r)&&(u=n.clampAnimations?r.clampTime(u):r.wrapTime(u),t[i]=r.evaluate(u,t[i]),t.dirtyNumber=n._maxDirtyNumber)}}function ho(n){var t=n._loadResources,r,i;t.finishedPendingBufferLoads()&&t.createRuntimeAnimations&&(t.createRuntimeAnimations=!1,n._runtime.animations=[],r=n._runtime.nodes,i=n.gltf.accessors,ri.animation(n.gltf,function(t,u){for(var p,a=t.channels,w=t.samplers,o=Number.MAX_VALUE,s=-Number.MAX_VALUE,v=a.length,y=new Array(v),f=0;f<v;++f){var h=a[f],c=h.target,b=c.path,l=w[h.sampler],e=gi.getAnimationParameterValues(n,i[l.input]),k=gi.getAnimationParameterValues(n,i[l.output]);o=Math.min(o,e[0]);s=Math.max(s,e[e.length-1]);p=gi.getAnimationSpline(n,u,t,h.sampler,l,e,b,k);y[f]=so(n,r[c.node],c.path,p)}n._runtime.animations[u]={name:t.name,startTime:o,stopTime:s,channelEvaluators:y}}))}function ef(n,t){var i=n._loadResources;if(i.finishedBuffersCreation()&&i.finishedProgramCreation()&&i.createVertexArrays){i.createVertexArrays=!1;var r=n._rendererResources.buffers,e=n._rendererResources.vertexArrays,u=n.gltf,f=u.accessors;ri.mesh(u,function(i,o){ri.meshPrimitive(i,function(i,s){var a=[],c,b=uo(n,i),v=n._decodedData[o+".primitive."+s],p,y,l,k,d,w;if(ri.meshPrimitiveAttribute(i,function(n,t){var o,e,i,s;if(c=b[t],h(c)){if(h(v)&&(o=v.attributes,o.hasOwnProperty(t))){e=o[t];a.push({index:c,vertexBuffer:r[e.bufferView],componentsPerAttribute:e.componentsPerAttribute,componentDatatype:e.componentDatatype,normalize:e.normalized,offsetInBytes:e.byteOffset,strideInBytes:e.byteStride});return}i=f[n];s=h(i.normalized)&&i.normalized;a.push({index:c,vertexBuffer:r[i.bufferView],componentsPerAttribute:ei(i.type),componentDatatype:i.componentType,normalize:s,offsetInBytes:i.byteOffset,strideInBytes:ui(u,i)})}}),l=n._precreatedAttributes,h(l))for(y in l)l.hasOwnProperty(y)&&(c=b[y],h(c)&&(p=l[y],p.index=c,a.push(p)));h(i.indices)&&(d=f[i.indices],w=d.bufferView,h(v)&&(w=v.bufferView),k=r[w]);e[o+".primitive."+s]=new ni({context:t,attributes:a,indexBuffer:k})})})}}function co(n){var t=n._loadResources;t.createRenderStates&&(t.createRenderStates=!1,ri.material(n.gltf,function(t,i){lo(n,t,i)}))}function lo(n,t,i){var o=n._rendererResources.renderStates,u=[ht.FUNC_ADD,ht.FUNC_ADD],r=[ht.ONE,ht.ONE_MINUS_SRC_ALPHA,ht.ONE,ht.ONE_MINUS_SRC_ALPHA],e,f;h(t.extensions)&&h(t.extensions.KHR_blend)&&(u=t.extensions.KHR_blend.blendEquation,r=t.extensions.KHR_blend.blendFactors);e=!t.doubleSided;f=t.alphaMode==="BLEND";o[i]=yt.fromCache({cull:{enabled:e},depthTest:{enabled:!0},depthMask:!f,blending:{enabled:f,equationRgb:u[0],equationAlpha:u[1],functionSourceRgb:r[0],functionDestinationRgb:r[1],functionSourceAlpha:r[2],functionDestinationAlpha:r[3]}})}function ao(n,t,i,r){var u=t._runtime.nodes[n];return of[i](r,t,u)}function vo(n,t,i,r,u,f,e){var o={},c={},l,a;return ri.techniqueUniform(i,function(i,v){var y,p,b,w;h(r)&&h(r[v])?(y=fr.createUniformFunction(i.type,r[v],f,e),o[v]=y.func,c[v]=y):h(i.node)?o[v]=ao(i.node,n,i.semantic,u.uniformState):h(i.semantic)?i.semantic==="JOINTMATRIX"?l=v:i.semantic==="MORPHWEIGHTS"?a=v:i.semantic==="ALPHACUTOFF"?(p=t.alphaMode,h(p)&&p==="MASK"&&(b=s(t.alphaCutoff,.5),y=fr.createUniformFunction(i.type,b,f,e),o[v]=y.func,c[v]=y)):o[v]=fr.getGltfSemanticUniforms()[i.semantic](u.uniformState,n):h(i.value)&&(w=fr.createUniformFunction(i.type,i.value,f,e),o[v]=w.func,c[v]=w)}),{map:o,values:c,jointMatrixUniformName:l,morphWeightsUniformName:a}}function yo(n,t){var i=n._loadResources;if(i.finishedProgramCreation()&&i.createUniformMaps){i.createUniformMaps=!1;var r=n.gltf,u=n._sourceTechniques,f=n._uniformMaps,e=n._rendererResources.textures,o=n._defaultTexture;ri.material(r,function(i,r){var c=n._runtime.materialsById[r],l=u[c._technique],a=c._values,s=vo(n,i,l,a,t,e,o),h=f[r];h.uniformMap=s.map;h.values=s.values;h.jointMatrixUniformName=s.jointMatrixUniformName;h.morphWeightsUniformName=s.morphWeightsUniformName})}}function po(n){return fr.createUniformsForDracoQuantizedAttributes(n.attributes)}function wo(n,t){var i=cu(n,t),r=n._quantizedUniforms[i];return fr.createUniformsForQuantizedAttributes(n.gltf,t,r)}function bo(n){return function(){return n}}function ko(n){return function(){return n.computedJointMatrices}}function go(n){return function(){return n.weights}}function ns(n){return function(){return n.silhouetteColor}}function ts(n){return function(){return n.silhouetteSize}}function is(n){return function(){return n.color}}function rs(n){return function(){var t=n.clippingPlanes;return h(t)?rt.multiply(n._clippingPlaneModelViewMatrix,t.modelMatrix,sf):rt.IDENTITY}}function us(n){return function(){var t=n.clippingPlanes;return!h(t)||!t.enabled?n._defaultTexture:t.texture}}function fs(n){return function(){var t=n.clippingPlanes,i;return h(t)?(i=f.clone(t.edgeColor),i.alpha=t.edgeWidth,i):f.WHITE.withAlpha(0)}}function es(n){return function(){return yi.getColorBlend(n.colorBlendMode,n.colorBlendAmount)}}function os(n,t){switch(n.mode){case ft.TRIANGLES:return t/3;case ft.TRIANGLE_STRIP:case ft.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function ss(i,r,u,f,o){for(var et,dt,b,v,gt,l,s,ot,st,d,ti,ii,y,ri,ht,nt,ct,ui=i._nodeCommands,fi=i._pickIds,lt=i.allowPicking,ei=i._runtime.meshesByName,tt=i._rendererResources,oi=tt.vertexArrays,si=tt.programs,hi=tt.renderStates,ci=i._uniformMaps,it=i.gltf,yt=it.accessors,li=it.meshes,ut=r.mesh,pt=li[ut],wt=pt.primitives,ai=wt.length,a=0;a<ai;++a){var c=wt[a],p=yt[c.indices],vi=i._runtime.materialsById[c.material],ft=vi._program,w=i._decodedData[ut+".primitive."+a],bt,kt=c.attributes.POSITION;h(kt)&&(et=fr.getAccessorMinMax(it,kt),bt=n.fromCornerPoints(t.fromArray(et.min),t.fromArray(et.max)));dt=oi[ut+".primitive."+a];h(w)?(v=w.numberOfIndices,b=0):h(p)?(v=p.count,b=p.byteOffset/k.getSizeInBytes(p.componentType)):(gt=yt[c.attributes.POSITION],v=gt.count,b=0);i._trianglesLength+=os(c,v);l=ci[c.material];s=l.uniformMap;h(l.jointMatrixUniformName)&&(ot={},ot[l.jointMatrixUniformName]=ko(u),s=e(s,ot));h(l.morphWeightsUniformName)&&(st={},st[l.morphWeightsUniformName]=go(u),s=e(s,st));s=e(s,{gltf_color:is(i),gltf_colorBlend:es(i),gltf_clippingPlanes:us(i),gltf_clippingPlanesEdgeStyle:fs(i),gltf_clippingPlanesMatrix:rs(i)});h(i._uniformMapLoaded)&&(s=i._uniformMapLoaded(s,ft,u));d={};i.extensionsUsed.WEB3D_quantized_attributes?d=wo(i,c):i._dequantizeInShader&&h(w)&&(d=po(w));s=e(s,d);var ni=hi[c.material],yi=ni.blending.enabled,g=i._pickObject;h(g)||(g={primitive:i,id:i.id,node:u.publicNode,mesh:ei[pt.name]});ti=hr.castShadows(i._shadows);ii=hr.receiveShadows(i._shadows);lt&&!h(i._uniformMapLoaded)&&(y=f.createPickId(g),fi.push(y),ri={czm_pickColor:bo(y.color)},s=e(s,ri));lt&&(y=h(i._pickIdLoaded)&&h(i._uniformMapLoaded)?i._pickIdLoaded():"czm_pickColor");ht=new at({boundingVolume:new n,cull:i.cull,modelMatrix:new rt,primitiveType:c.mode,vertexArray:dt,count:v,offset:b,shaderProgram:si[ft],castShadows:ti,receiveShadows:ii,uniformMap:s,renderState:ni,owner:g,pass:yi?vt.TRANSLUCENT:i.opaquePass,pickId:y});o||(nt=at.shallowClone(ht),nt.boundingVolume=new n,nt.modelMatrix=new rt);ct={show:!0,boundingSphere:bt,command:ht,command2D:nt,silhouetteModelCommand:undefined,silhouetteModelCommand2D:undefined,silhouetteColorCommand:undefined,silhouetteColorCommand2D:undefined,translucentCommand:undefined,translucentCommand2D:undefined,programId:ft};u.commands.push(ct);ui.push(ct)}}function hs(n,i,r){var w=n._loadResources,o,v,s,ft,c,ot,l,nt,tt,y,p;if(w.finishedEverythingButTextureCreation()&&w.createRuntimeNodes){w.createRuntimeNodes=!1;var it=[],ut=n._runtime.nodes,a=n.gltf,b=a.nodes,st=a.skins,ht=a.scenes[a.scene],k=ht.nodes,ct=k.length,e=[],d={};for(o=0;o<ct;++o)for(e.push({parentRuntimeNode:undefined,gltfNode:b[k[o]],id:k[o]}),v=[];e.length>0;){s=e.pop();d[s.id]=!0;var g=s.parentRuntimeNode,f=s.gltfNode,u=ut[s.id];if(u.parents.length===0&&(h(f.matrix)?u.matrix=rt.fromColumnMajorArray(f.matrix):(ft=f.rotation,u.translation=t.fromArray(f.translation),u.rotation=et.unpack(ft),u.scale=t.fromArray(f.scale))),h(g)?(g.children.push(u),u.parents.push(g)):it.push(u),h(f.mesh)&&ss(n,f,u,i,r),c=f.children,h(c))for(ot=c.length,l=0;l<ot;l++)nt=c[l],d[nt]||e.push({parentRuntimeNode:u,gltfNode:b[nt],id:c[l]});if(tt=f.skin,h(tt)&&v.push(st[tt].skeleton),e.length===0)for(y=0;y<v.length;y++)p=v[y],d[p]||e.push({parentRuntimeNode:undefined,gltfNode:b[p],id:p})}n._runtime.rootNodes=it;n._runtime.nodes=ut}}function cs(n){var t=0;for(var i in n)n.hasOwnProperty(i)&&(t+=n[i].sizeInBytes);return t}function ls(n){var t=0;for(var i in n)n.hasOwnProperty(i)&&(t+=n[i].sizeInBytes);return t}function hf(n,t){var u=t.context,y=t.scene3DOnly,l=n._quantizedVertexShaders,p=n._toClipCoordinatesGLSL={},s=n._sourceTechniques,w=n._sourcePrograms,r=n._rendererResources,a=r.sourceShaders,c,o,i;n._loadRendererResourcesFromCache&&(a=r.sourceShaders=n._cachedRendererResources.sourceShaders);for(c in s)if(s.hasOwnProperty(c)){var f=s[c].program,v=w[f],e=a[v.vertexShader];fr.checkSupportedGlExtensions(v.glExtensions,u);(n.extensionsUsed.WEB3D_quantized_attributes||n._dequantizeInShader)&&(o=l[f],h(o)||(o=tf(e,f,n),l[f]=o),e=o);e=br(e,f,n._vertexShaderLoaded);p[f]=fr.toClipCoordinatesGLSL(n.gltf,e)}n._loadRendererResourcesFromCache?(i=n._cachedRendererResources,r.buffers=i.buffers,r.vertexArrays=i.vertexArrays,r.programs=i.programs,r.silhouettePrograms=i.silhouettePrograms,r.textures=i.textures,r.samplers=i.samplers,r.renderStates=i.renderStates,h(n._precreatedAttributes)&&ef(n,u),n._cachedGeometryByteLength+=cs(i.buffers),n._cachedTexturesByteLength+=ls(i.textures)):(be(n,t),ge(n,t),io(n,u),to(n),ro(n,t));oo(n);ho(n);n._loadRendererResourcesFromCache||(ef(n,u),co(n));yo(n,u);hs(n,u,y)}function cf(n,t){var i=n.publicNode,r=i.matrix;i.useMatrix&&h(r)?rt.clone(r,t):h(n.matrix)?rt.clone(n.matrix,t):(rt.fromTranslationQuaternionRotationScale(n.translation,n.rotation,n.scale,t),i.setMatrix(t))}function vs(r,u,f,e){var it=r._maxDirtyNumber,ut=r._runtime.rootNodes,ct=ut.length,v=lf,l=r._computedModelMatrix,ft,et,ot,y,s,k,d,g,nt,p,a,o,w,ht,b,c;for(r._mode===sr.SCENE3D||r._ignoreCommands||(ft=rt.getColumn(l,3,as),i.equals(ft,i.UNIT_W)?(et=r.boundingSphere.center,ot=st.wgs84To2DModelMatrix(e,et,vu),l=rt.multiply(ot,l,vu),h(r._rtcCenter)&&(rt.setTranslation(l,i.UNIT_W,l),r._rtcCenter=r._rtcCenter2D)):(l=st.basisTo2D(e,l,vu),r._rtcCenter=r._rtcCenter3D)),y=0;y<ct;++y)for(s=ut[y],cf(s,s.transformToRoot),v.push(s);v.length>0;){if(s=v.pop(),k=s.transformToRoot,d=s.commands,(s.dirtyNumber===it||u||f)&&(g=rt.multiplyTransformation(l,k,s.computedMatrix),nt=d.length,nt>0))for(p=0;p<nt;++p)a=d[p],o=a.command,rt.clone(g,o.modelMatrix),n.transform(a.boundingSphere,o.modelMatrix,o.boundingVolume),h(r._rtcCenter)&&t.add(r._rtcCenter,o.boundingVolume.center,o.boundingVolume.center),o=a.command2D,h(o)&&r._mode===sr.SCENE2D&&(rt.clone(g,o.modelMatrix),o.modelMatrix[13]-=tt.sign(o.modelMatrix[13])*2*tt.PI*e.ellipsoid.maximumRadius,n.transform(a.boundingSphere,o.modelMatrix,o.boundingVolume));if(w=s.children,h(w))for(ht=w.length,b=0;b<ht;++b)c=w[b],c.dirtyNumber=Math.max(c.dirtyNumber,s.dirtyNumber),(c.dirtyNumber===it||f)&&(cf(c,c.transformToRoot),rt.multiplyTransformation(k,c.transformToRoot,c.transformToRoot)),v.push(c)}++r._maxDirtyNumber}function ys(n){for(var r,t,f=n._runtime.skinnedNodes,s=f.length,u=0;u<s;++u){r=f[u];tu=rt.inverseTransformation(r.transformToRoot,tu);var i=r.computedJointMatrices,c=r.joints,e=r.bindShapeMatrix,o=r.inverseBindMatrices,l=o.length;for(t=0;t<l;++t)h(i[t])||(i[t]=new rt),i[t]=rt.multiplyTransformation(tu,c[t].transformToRoot,i[t]),i[t]=rt.multiplyTransformation(i[t],o[t],i[t]),h(e)&&(i[t]=rt.multiplyTransformation(i[t],e,i[t]))}}function ps(n){for(var t,r,u,a,f,e,s=n._runtime.rootNodes,v=s.length,i=lf,o=0;o<v;++o)for(t=s[o],t.computedShow=t.publicNode.show,i.push(t);i.length>0;){t=i.pop();var c=t.computedShow,l=t.commands,y=l.length;for(r=0;r<y;++r)l[r].show=c;if(u=t.children,h(u))for(a=u.length,f=0;f<a;++f)e=u[f],e.computedShow=c&&e.publicNode.show,i.push(e)}}function ws(n){var i=n.id,r,u,t;if(n._id!==i)for(n._id=i,r=n._pickIds,u=r.length,t=0;t<u;++t)r[t].object.id=i}function bs(n){var t;if(n._debugWireframe!==n.debugWireframe){n._debugWireframe=n.debugWireframe;var r=n.debugWireframe?ft.LINES:ft.TRIANGLES,i=n._nodeCommands,u=i.length;for(t=0;t<u;++t)i[t].command.primitiveType=r}}function ks(n){var t;if(n.debugShowBoundingVolume!==n._debugShowBoundingVolume){n._debugShowBoundingVolume=n.debugShowBoundingVolume;var r=n.debugShowBoundingVolume,i=n._nodeCommands,u=i.length;for(t=0;t<u;++t)i[t].command.debugShowBoundingVolume=r}}function ds(n){var t,i;if(n.shadows!==n._shadows){n._shadows=n.shadows;var u=hr.castShadows(n.shadows),f=hr.receiveShadows(n.shadows),r=n._nodeCommands,e=r.length;for(t=0;t<e;t++)i=r[t],i.command.castShadows=u,i.command.receiveShadows=f}}function gs(n){var t=u(n,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=ai.ALPHA_BLEND,yt.fromCache(t)}function af(n){var t=at.shallowClone(n);return t.pass=vt.TRANSLUCENT,t.renderState=gs(n.renderState),t}function vf(n,t,i){var l=t.scene3DOnly,e=n.color.alpha,u,o,f,r,s,c;if(e>0&&e<1&&(u=n._nodeCommands,o=u.length,!h(u[0].translucentCommand)||i))for(f=0;f<o;++f)r=u[f],s=r.command,r.translucentCommand=af(s),l||(c=r.command2D,r.translucentCommand2D=af(c))}function nh(n,t){var i=n._rendererResources.programs;for(var r in i)if(i.hasOwnProperty(r)&&i[r]===t)return r}function th(n,t,i){var r=t.vertexShaderSource.sources[0],f=t._attributeLocations,e=n._normalAttributeName,u;return r=bt.replaceMain(r,"gltf_silhouette_main"),r+="uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * "+e+"); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize / czm_viewport.z; \n    gl_Position = clip; \n}",u="uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = gltf_silhouetteColor; \n}",wt.fromCache({context:i.context,vertexShaderSource:r,fragmentShaderSource:u,attributeLocations:f})}function yf(n,t){return wu(t.context)&&n.silhouetteSize>0&&n.silhouetteColor.alpha>0&&h(n._normalAttributeName)}function ih(n){for(var r,u,i=n._nodeCommands,f=i.length,t=0;t<f;++t)if(r=i[t],u=r.command,u.pass===vt.TRANSLUCENT)return!0;return!1}function yu(n){return n.color.alpha>0&&n.color.alpha<1}function pf(n){return n.color.alpha===0}function wf(n,t){return Math.floor(n)!==Math.floor(t)||Math.ceil(n)!==Math.ceil(t)}function rh(n,t){for(var r,g,c,o,nt,y=++bf%255,tt=ih(n)||yu(n)||n.silhouetteColor.alpha<1,p=n._rendererResources.silhouettePrograms,it=t.scene3DOnly,w=n._nodeCommands,rt=w.length,a=0;a<rt;++a){var f=w[a],s=f.command,b=yu(n)?f.translucentCommand:s,v=at.shallowClone(b),i=u(b.renderState);i.stencilTest={enabled:!0,frontFunction:ht.ALWAYS,backFunction:ht.ALWAYS,reference:y,mask:-1,frontOperation:{fail:ht.KEEP,zFail:ht.KEEP,zPass:ht.REPLACE},backOperation:{fail:ht.KEEP,zFail:ht.KEEP,zPass:ht.REPLACE}};pf(n)&&(i.colorMask={red:!1,green:!1,blue:!1,alpha:!1},i.depthMask=!1);i=yt.fromCache(i);v.renderState=i;f.silhouetteModelCommand=v;r=at.shallowClone(s);i=u(s.renderState,!0);i.depthTest.enabled=!0;i.cull.enabled=!1;tt&&(r.pass=vt.TRANSLUCENT,i.depthMask=!1,i.blending=ai.ALPHA_BLEND);i.stencilTest={enabled:!0,frontFunction:ht.NOTEQUAL,backFunction:ht.NOTEQUAL,reference:y,mask:-1,frontOperation:{fail:ht.KEEP,zFail:ht.KEEP,zPass:ht.KEEP},backOperation:{fail:ht.KEEP,zFail:ht.KEEP,zPass:ht.KEEP}};i=yt.fromCache(i);var k=s.shaderProgram,d=nh(n,k),l=p[d];h(l)||(l=th(n,k,t),p[d]=l);g=e(s.uniformMap,{gltf_silhouetteColor:ns(n),gltf_silhouetteSize:ts(n)});r.renderState=i;r.shaderProgram=l;r.uniformMap=g;r.castShadows=!1;r.receiveShadows=!1;f.silhouetteColorCommand=r;it||(c=f.command2D,o=at.shallowClone(v),o.boundingVolume=c.boundingVolume,o.modelMatrix=c.modelMatrix,f.silhouetteModelCommand2D=o,nt=at.shallowClone(r),o.boundingVolume=c.boundingVolume,o.modelMatrix=c.modelMatrix,f.silhouetteColorCommand2D=nt)}}function uh(n,t,i){return n=bt.replaceMain(n,"gltf_clip_main"),n+=lr._getClippingFunction(t,i)+"\n",n+("uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+wi("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n")}function kf(n,t,i){if(yf(n,t)){var r=n._nodeCommands,u=wf(n.color.alpha,n._colorPreviousAlpha)||wf(n.silhouetteColor.alpha,n._silhouetteColorPreviousAlpha)||!h(r[0].silhouetteModelCommand);n._colorPreviousAlpha=n.color.alpha;n._silhouetteColorPreviousAlpha=n.silhouetteColor.alpha;(u||i)&&rh(n,t)}}function fh(n,t){var i=n._clippingPlanes;h(i)&&i.owner===n&&i.enabled&&i.update(t)}function eh(n,t,i){return iu.center=n,iu.radius=t,i.camera.getPixelSize(iu,i.context.drawingBufferWidth,i.context.drawingBufferHeight)}function oh(n,i){var r=n.scale,f,o;if(n.minimumPixelSize!==0){var e=i.context,l=Math.max(e.drawingBufferWidth,e.drawingBufferHeight),u=h(n._clampedModelMatrix)?n._clampedModelMatrix:n.modelMatrix;cr.x=u[12];cr.y=u[13];cr.z=u[14];h(n._rtcCenter)&&t.add(n._rtcCenter,cr,cr);n._mode!==sr.SCENE3D&&(f=i.mapProjection,o=f.ellipsoid.cartesianToCartographic(cr,pr),f.project(o,cr),t.fromElements(cr.z,cr.x,cr.y,cr));var s=n.boundingSphere.radius,c=eh(cr,s,i),a=1/c,v=Math.min(a*2*s,l);v<n.minimumPixelSize&&(r=n.minimumPixelSize*c/(2*n._initialRadius))}return h(n.maximumScale)?Math.min(n.maximumScale,r):r}function df(n){h(n._cacheKey)&&h(n._cachedGltf)&&--n._cachedGltf.count==0&&delete vr[n._cacheKey];n._cachedGltf=undefined}function pu(n,t){this.buffers=undefined;this.vertexArrays=undefined;this.programs=undefined;this.sourceShaders=undefined;this.silhouettePrograms=undefined;this.textures=undefined;this.samplers=undefined;this.renderStates=undefined;this.ready=!1;this.context=n;this.cacheKey=t;this.count=0}function yr(n){for(var t in n)n.hasOwnProperty(t)&&n[t].destroy()}function sh(n){yr(n.buffers);yr(n.vertexArrays);yr(n.programs);yr(n.silhouettePrograms);yr(n.textures)}function gf(n,t,i){return function(r){var f,u;n.heightReference===ki.RELATIVE_TO_GROUND&&(f=t.cartesianToCartographic(r,pr),f.height+=i.height,t.cartographicToCartesian(f,r));u=n._clampedModelMatrix;rt.clone(n.modelMatrix,u);u[12]=r.x;u[13]=r.y;u[14]=r.z;n._heightChanged=!0}}function hh(n){var i,t,s,o,c;if(h(n._removeUpdateHeightCallback)&&(n._removeUpdateHeightCallback(),n._removeUpdateHeightCallback=undefined),i=n._scene,!h(i)||!h(i.globe)||n.heightReference===ki.NONE){if(n.heightReference!==ki.NONE)throw new a("Height reference is not supported without a scene and globe.");n._clampedModelMatrix=undefined;return}var e=i.globe,u=e.ellipsoid,f=n.modelMatrix;cr.x=f[12];cr.y=f[13];cr.z=f[14];t=u.cartesianToCartographic(cr);h(n._clampedModelMatrix)||(n._clampedModelMatrix=rt.clone(f,new rt));s=e._surface;n._removeUpdateHeightCallback=s.updateHeight(t,gf(n,u,t));o=e.getHeight(t);h(o)&&(c=gf(n,u,t),r.clone(t,pr),pr.height=o,u.cartographicToCartesian(pr,cr),c(cr))}function ch(n,i){var u,f=n.distanceDisplayCondition,s=f.near*f.near,h=f.far*f.far,e,r;if(i.mode===sr.SCENE2D)e=i.camera.frustum.right-i.camera.frustum.left,u=e*.5,u=u*u;else{if(r=rt.getTranslation(n.modelMatrix,ne),i.mode===sr.COLUMBUS_VIEW){var o=i.mapProjection,c=o.ellipsoid,l=c.cartesianToCartographic(r,te);r=o.project(l,r);t.fromElements(r.z,r.x,r.y,r)}u=t.distanceSquared(r,i.camera.positionWC)}return u>=s&&u<=h}function ie(n,t){n.programs!==t.programs&&yr(n.programs);n.silhouettePrograms!==t.silhouettePrograms&&yr(n.silhouettePrograms)}function lh(n,t){var i=n._rendererResources,s=n._cachedRendererResources,r,c,f,a,e,o,u,l;if(ie(i,s),bu(n)||fu(n)){i.programs={};i.silhouettePrograms={};c={};f=n._sourceTechniques;for(e in f)f.hasOwnProperty(e)&&(a=f[e],r=a.program,c[r]||(c[r]=!0,de({programId:r,techniqueId:e},n,t.context)))}else i.programs=s.programs,i.silhouettePrograms=s.silhouettePrograms;var y=i.programs,v=n._nodeCommands,p=v.length;for(o=0;o<p;++o)u=v[o],r=u.programId,l=y[r],u.command.shaderProgram=l,h(u.command2D)&&(u.command2D.shaderProgram=l);vf(n,t,!0);kf(n,t,!0)}var vr,uu,ku,du,kr,dr,su,hu,gr,lu,nu,au,of,sf,tu,bf,iu,cr,pr,ne,te;if(!y.supportsTypedArrays())return{};var re=new t,ar=fr.ModelState,ue="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01";c(wr.prototype,{gltf:{set:function(n){this._gltf=n},get:function(){return this._gltf}}});wr.prototype.makeReady=function(n){var i,u,t,r;for(this.gltf=n,i=this.modelsToLoad,u=i.length,t=0;t<u;++t)r=i[t],r.isDestroyed()||ru(r,this);this.modelsToLoad=undefined;this.ready=!0};vr={};uu={};c(lr.prototype,{gltf:{get:function(){return h(this._cachedGltf)?this._cachedGltf.gltf:undefined}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var r,i,u,n;if(this._state!==ar.LOADED)throw new a("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");return r=this.modelMatrix,this.heightReference!==ki.NONE&&this._clampedModelMatrix&&(r=this._clampedModelMatrix),i=rt.getScale(r,re),u=h(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale,t.multiplyByScalar(i,u,i),n=this._scaledBoundingSphere,n.center=t.multiplyComponents(this._boundingSphere.center,i,n.center),n.radius=t.maximumComponent(i)*this._initialRadius,h(this._rtcCenter)&&t.add(this._rtcCenter,n.center,n.center),n}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return h(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(n){if(h(n)&&n.far<=n.near)throw new a("far must be greater than near");this._distanceDisplayCondition=v.clone(n,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return h(this._extensionsUsed)||(this._extensionsUsed=fr.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return h(this._extensionsRequired)||(this._extensionsRequired=fr.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return h(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(n){n!==this._clippingPlanes&&vi.setOwner(n,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}}});lr.silhouetteSupported=function(n){return wu(n.context)};lr.fromGltf=function(n){var e,f,t;if(!h(n)||!h(n.url))throw new a("options.url is required");e=n.url;n=u(n);var r=ot.createIfNeeded(e),l=s(n.basePath,r.clone()),c=ot.createIfNeeded(l),i=s(n.cacheKey,uu[p(r.url)]);return h(i)||(i=o(),uu[p(r.url)]=i),h(n.basePath)&&!h(n.cacheKey)&&(i+=c.url),n.cacheKey=i,n.basePath=c,f=new lr(n),t=vr[i],h(t)?t.ready||(++t.count,t.modelsToLoad.push(f)):(t=new wr({ready:!1}),t.count=1,t.modelsToLoad.push(f),ru(f,t),vr[i]=t,h(r.headers.Accept)||(r.headers.Accept=ue),r.fetchArrayBuffer().then(function(n){var i=new Uint8Array(n),r,u;fe(i)?(r=oi(i),t.makeReady(r)):(u=b(i),t.makeReady(JSON.parse(u)))}).otherwise(fr.getFailedLoadFunction(f,"model",e))),f};lr._gltfCache=vr;lr.prototype.getNode=function(n){var t=eu(this,"nodesByName",n);return h(t)?t.publicNode:undefined};lr.prototype.getMesh=function(n){return eu(this,"meshesByName",n)};lr.prototype.getMaterial=function(n){return eu(this,"materialsByName",n)};ku=/(^data:image\/ktx)|(\.ktx$)/i;du=/(^data:image\/crn)|(\.crn$)/i;kr=function(){this.id=undefined;this.model=undefined;this.context=undefined};kr.prototype.set=function(n,t,i){this.id=n;this.model=t;this.context=i};kr.prototype.execute=function(){gu(this.id,this.model,this.context)};dr=function(){this.id=undefined;this.componentType=undefined;this.model=undefined;this.context=undefined};dr.prototype.set=function(n,t,i,r){this.id=n;this.componentType=t;this.model=i;this.context=r};dr.prototype.execute=function(){nf(this.id,this.componentType,this.model,this.context)};su=new kr;hu=new dr;gr=function(){this.programToCreate=undefined;this.model=undefined;this.context=undefined};gr.prototype.set=function(n,t,i){this.programToCreate=n;this.model=t;this.context=i};gr.prototype.execute=function(){rf(this.programToCreate,this.model,this.context)};lu=new gr;nu=function(){this.gltfTexture=undefined;this.model=undefined;this.context=undefined};nu.prototype.set=function(n,t,i){this.gltfTexture=n;this.model=t;this.context=i};nu.prototype.execute=function(){ff(this.gltfTexture,this.model,this.context)};au=new nu;of={MODEL:function(n,t,i){return function(){return i.computedMatrix}},VIEW:function(n){return function(){return n.view}},PROJECTION:function(n){return function(){return n.projection}},MODELVIEW:function(n,t,i){var r=new rt;return function(){return rt.multiplyTransformation(n.view,i.computedMatrix,r)}},CESIUM_RTC_MODELVIEW:function(n,t,i){var r=new rt;return function(){return rt.multiplyTransformation(n.view,i.computedMatrix,r),rt.setTranslation(r,t._rtcCenterEye,r)}},MODELVIEWPROJECTION:function(n,t,i){var r=new rt;return function(){return rt.multiplyTransformation(n.view,i.computedMatrix,r),rt.multiply(n._projection,r,r)}},MODELINVERSE:function(n,t,i){var r=new rt;return function(){return rt.inverse(i.computedMatrix,r)}},VIEWINVERSE:function(n){return function(){return n.inverseView}},PROJECTIONINVERSE:function(n){return function(){return n.inverseProjection}},MODELVIEWINVERSE:function(n,t,i){var r=new rt,u=new rt;return function(){return rt.multiplyTransformation(n.view,i.computedMatrix,r),rt.inverse(r,u)}},MODELVIEWPROJECTIONINVERSE:function(n,t,i){var r=new rt,u=new rt;return function(){return rt.multiplyTransformation(n.view,i.computedMatrix,r),rt.multiply(n._projection,r,r),rt.inverse(r,u)}},MODELINVERSETRANSPOSE:function(n,t,i){var u=new rt,r=new it;return function(){return rt.inverse(i.computedMatrix,u),rt.getRotation(u,r),it.transpose(r,r)}},MODELVIEWINVERSETRANSPOSE:function(n,t,i){var u=new rt,f=new rt,r=new it;return function(){return rt.multiplyTransformation(n.view,i.computedMatrix,u),rt.inverse(u,f),rt.getRotation(f,r),it.transpose(r,r)}},VIEWPORT:function(n){return function(){return n.viewportCartesian4}}};sf=new rt;var lf=[],as=new i,vu=new rt;return tu=new rt,bf=0,iu=new n,cr=new t,pr=new r,pu.prototype.release=function(){return--this.count==0?(h(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],sh(this),l(this)):undefined},ne=new t,te=new r,lr.prototype.update=function(n){var u,f,st,ht,b,ct,y,lt,c,e,at,p,ni,d,ri,a,g,nt,ui,vt,yt,it,et,ot;if(n.mode!==sr.MORPHING){if(u=n.context,this._defaultTexture=u.defaultTexture,this._state===ar.NEEDS_LOAD&&h(this.gltf)){if(st=this.cacheKey,h(st)){if(u.cache.modelRendererResourceCache=s(u.cache.modelRendererResourceCache,{}),ht=u.cache.modelRendererResourceCache,f=ht[this.cacheKey],h(f)){if(!f.ready)return;++f.count;this._loadRendererResourcesFromCache=!0}else f=new pu(u,st),f.count=1,ht[this.cacheKey]=f;this._cachedRendererResources=f}else f=new pu(u),f.count=1,this._cachedRendererResources=f;if(this._state=ar.LOADING,this._state!==ar.FAILED){if(b=this.gltf.extensions,h(b)&&h(b.CESIUM_RTC)&&(ct=t.fromArray(b.CESIUM_RTC.center),!t.equals(ct,t.ZERO))){this._rtcCenter3D=ct;var bt=n.mapProjection,ei=bt.ellipsoid,oi=ei.cartesianToCartographic(this._rtcCenter3D),w=bt.project(oi);t.fromElements(w.z,w.x,w.y,w);this._rtcCenter2D=w;this._rtcCenterEye=new t;this._rtcCenter=this._rtcCenter3D}ii(this.gltf);this._loadResources=new tr;this._loadRendererResourcesFromCache||fr.parseBuffers(this,oe)}}var r=this._loadResources,kt=this._incrementallyLoadTextures,l=!1;this._state===ar.LOADING&&(r.pendingBufferLoads===0&&(r.initialized||(n.brdfLutGenerator.update(n),fr.checkSupportedExtensions(this.extensionsRequired),fr.updateForwardAxis(this),this._loadRendererResourcesFromCache||(y=this.gltf,y.extras.sourceVersion=fr.getAssetVersion(y),hi(y),ti(y),lt={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders},er(y,lt),or(y,lt)),this._dequantizeInShader=this._dequantizeInShader&&pi.hasExtension(this),ee(this),he(this),this._loadRendererResourcesFromCache||(se(this),le(this),ae(this),ve(this,u)),pe(this),we(this),ye(this),pi.parse(this,u),r.initialized=!0),r.finishedDecoding()||pi.decodeModel(this,u).otherwise(fr.getFailedLoadFunction(this,"model",this.basePath)),r.finishedDecoding()&&!r.resourcesParsed&&(this._boundingSphere=fr.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,pi.cacheDataForModel(this),r.resourcesParsed=!0),r.resourcesParsed&&r.pendingShaderLoads===0&&hf(this,n)),(r.finished()||kt&&r.finishedEverythingButTextureCreation())&&(this._state=ar.LOADED,l=!0));h(r)&&this._state===ar.LOADED&&(kt&&!l&&hf(this,n),r.finished()&&(si(this.gltf),this._loadResources=undefined,c=this._rendererResources,e=this._cachedRendererResources,e.buffers=c.buffers,e.vertexArrays=c.vertexArrays,e.programs=c.programs,e.sourceShaders=c.sourceShaders,e.silhouettePrograms=c.silhouettePrograms,e.textures=c.textures,e.samplers=c.samplers,e.renderStates=c.renderStates,e.ready=!0,this._normalAttributeName=fr.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),h(this._precreatedAttributes)&&(e.vertexArrays={}),this.releaseGltfJson&&df(this)));var k=yf(this,n),dt=yu(this),ci=pf(this),ai=h(this.distanceDisplayCondition)?ch(this,n):!0,gt=this.show&&ai&&this.scale!==0&&(!ci||k);if((gt&&this._state===ar.LOADED||l)&&(at=this.activeAnimations.update(n)||this._cesiumAnimationsDirty,this._cesiumAnimationsDirty=!1,this._dirty=!1,p=this.modelMatrix,ni=n.mode!==this._mode,this._mode=n.mode,d=!rt.equals(this._modelMatrix,p)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||this.minimumPixelSize!==0||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||ni,(d||l)&&(rt.clone(p,this._modelMatrix),hh(this),h(this._clampedModelMatrix)&&(p=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1,ri=oh(this,n),a=this._computedModelMatrix,rt.multiplyByUniformScale(p,ri,a),this._upAxis===li.Y?rt.multiplyTransformation(a,li.Y_UP_TO_Z_UP,a):this._upAxis===li.X&&rt.multiplyTransformation(a,li.X_UP_TO_Z_UP,a),this.forwardAxis===li.Z&&rt.multiplyTransformation(a,li.Z_UP_TO_X_UP,a)),(at||d||l)&&(vs(this,d,l,n.mapProjection),this._dirty=!0,(at||l)&&ys(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,ps(this)),ws(this,u),bs(this),ks(this),ds(this),fh(this,n),g=this._clippingPlanes,nt=0,h(g)&&g.enabled&&(ui=s(this.clippingPlaneOffsetMatrix,p),rt.multiply(u.uniformState.view3D,ui,this._clippingPlaneModelViewMatrix),nt=g.clippingPlanesState),vt=this._clippingPlanesState!==nt,this._clippingPlanesState=nt,yt=fu(this),yt!==this._colorShadingEnabled&&(this._colorShadingEnabled=yt,vt=!0),vt?lh(this,n):(vf(this,n,!1),kf(this,n,!1))),l){it=this;n.afterRender.push(function(){it._ready=!0;it._readyPromise.resolve(it)});return}if(gt&&!this._ignoreCommands){var ut=n.commandList,pt=n.passes,wt=this._nodeCommands,fi=wt.length,v,i,ft=n.mapProjection.ellipsoid.maximumRadius*tt.PI,o;if(pt.render||pt.pick&&this.allowPicking){for(v=0;v<fi;++v)i=wt[v],i.show&&(et=dt?i.translucentCommand:i.command,et=k?i.silhouetteModelCommand:et,ut.push(et),o=i.command.boundingVolume,n.mode===sr.SCENE2D&&(o.center.y+o.radius>ft||o.center.y-o.radius<ft)&&(ot=dt?i.translucentCommand2D:i.command2D,ot=k?i.silhouetteModelCommand2D:ot,ut.push(ot)));if(k&&!pt.pick)for(v=0;v<fi;++v)i=wt[v],i.show&&(ut.push(i.silhouetteColorCommand),o=i.command.boundingVolume,n.mode===sr.SCENE2D&&(o.center.y+o.radius>ft||o.center.y-o.radius<ft)&&ut.push(i.silhouetteColorCommand2D))}}}},lr.prototype.isDestroyed=function(){return!1},lr.prototype.destroy=function(){var i,r,t,n;for(h(this._precreatedAttributes)&&yr(this._rendererResources.vertexArrays),h(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=undefined),h(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=undefined),h(this._cachedRendererResources)&&ie(this._rendererResources,this._cachedRendererResources),this._rendererResources=undefined,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),pi.destroyCachedDataForModel(this),i=this._pickIds,r=i.length,t=0;t<r;++t)i[t].destroy();return df(this),this._quantizedVertexShaders=undefined,n=this._clippingPlanes,h(n)&&!n.isDestroyed()&&n.owner===this&&n.destroy(),this._clippingPlanes=undefined,l(this)},lr._getClippingFunction=bi,lr._modifyShaderForColor=ke,lr});t("DataSources/ModelVisualizer",["../Core/AssociativeArray","../Core/BoundingSphere","../Core/Color","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/Matrix4","../Core/Resource","../Scene/ColorBlendMode","../Scene/HeightReference","../Scene/Model","../Scene/ModelAnimationLoop","../Scene/ShadowMode","./BoundingSphereState","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(t,i){if(!r(t))throw new f("scene is required.");if(!r(i))throw new f("entityCollection is required.");i.collectionChanged.addEventListener(p.prototype._onCollectionChanged,this);this._scene=t;this._primitives=t.primitives;this._entityCollection=i;this._modelHash={};this._entitiesToVisualize=new n;this._onCollectionChanged(i,i.values,[],[])}function w(n,t,i,u){var f=i[t.id];r(f)&&(u.removeAndDestroy(f.modelPrimitive),delete i[t.id])}function ht(n,t){var i=t[n.id];r(i)&&(i.nodeTransformationsScratch={})}function ct(n,t,i){n.readyPromise.otherwise(function(n){console.error(n);i[t.id].loadFail=!0})}var b=1,k=0,d=!0,g=!0,nt=a.ENABLED,tt=h.NONE,it=i.RED,rt=0,ut=i.WHITE,ft=s.HIGHLIGHT,et=.5,ot=new e,st=new e;return p.prototype.update=function(n){var w,ti,t,ht,lt,wt,bt,at,ii,a,kt,vt,v,dt;if(!r(n))throw new f("time is required.");var gt=this._entitiesToVisualize.values,p=this._modelHash,ni=this._primitives;for(w=0,ti=gt.length;w<ti;w++){var s=gt[w],i=s._model,h,u=p[s.id],yt=s.isShowing&&s.isAvailable(n)&&y.getValueOrDefault(i._show,n,!0),pt;if(yt&&(pt=s.computeModelMatrix(n,ot),h=o.createIfNeeded(y.getValueOrUndefined(i._uri,n)),yt=r(pt)&&r(h)),!yt){r(u)&&(u.modelPrimitive.show=!1);continue}if(t=r(u)?u.modelPrimitive:undefined,r(t)&&h.url===u.url||(r(t)&&(ni.removeAndDestroy(t),delete p[s.id]),t=c.fromGltf({url:h,incrementallyLoadTextures:y.getValueOrDefault(i._incrementallyLoadTextures,n,d),scene:this._scene}),t.id=s,ni.add(t),u={modelPrimitive:t,url:h.url,animationsRunning:!1,nodeTransformationsScratch:{},originalNodeMatrixHash:{},loadFail:!1},p[s.id]=u,ct(t,s,p)),t.show=!0,t.scale=y.getValueOrDefault(i._scale,n,b),t.minimumPixelSize=y.getValueOrDefault(i._minimumPixelSize,n,k),t.maximumScale=y.getValueOrUndefined(i._maximumScale,n),t.modelMatrix=e.clone(pt,t.modelMatrix),t.shadows=y.getValueOrDefault(i._shadows,n,nt),t.heightReference=y.getValueOrDefault(i._heightReference,n,tt),t.distanceDisplayCondition=y.getValueOrUndefined(i._distanceDisplayCondition,n),t.silhouetteColor=y.getValueOrDefault(i._silhouetteColor,n,it,t._silhouetteColor),t.silhouetteSize=y.getValueOrDefault(i._silhouetteSize,n,rt),t.color=y.getValueOrDefault(i._color,n,ut,t._color),t.colorBlendMode=y.getValueOrDefault(i._colorBlendMode,n,ft),t.colorBlendAmount=y.getValueOrDefault(i._colorBlendAmount,n,et),t.clippingPlanes=y.getValueOrUndefined(i._clippingPlanes,n),t.clampAnimations=y.getValueOrDefault(i._clampAnimations,n,g),t.ready&&(ht=y.getValueOrDefault(i._runAnimations,n,!0),u.animationsRunning!==ht&&(ht?t.activeAnimations.addAll({loop:l.REPEAT}):t.activeAnimations.removeAll(),u.animationsRunning=ht),lt=y.getValueOrUndefined(i._nodeTransformations,n,u.nodeTransformationsScratch),r(lt)))for(wt=u.originalNodeMatrixHash,bt=Object.keys(lt),at=0,ii=bt.length;at<ii;++at)(a=bt[at],kt=lt[a],r(kt))&&(vt=t.getNode(a),r(vt))&&(v=wt[a],r(v)||(v=vt.matrix.clone(),wt[a]=v),dt=e.fromTranslationRotationScale(kt,st),vt.matrix=e.multiply(v,dt,dt))}return!0},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){var n;this._entityCollection.collectionChanged.removeEventListener(p.prototype._onCollectionChanged,this);var t=this._entitiesToVisualize.values,i=this._modelHash,r=this._primitives;for(n=t.length-1;n>-1;n--)w(this,t[n],i,r);return u(this)},p.prototype.getBoundingSphere=function(n,i){var e,u;if(!r(n))throw new f("entity is required.");if(!r(i))throw new f("result is required.");if((e=this._modelHash[n.id],!r(e)||e.loadFail)||(u=e.modelPrimitive,!r(u)||!u.show))return v.FAILED;if(!u.ready)return v.PENDING;if(u.heightReference===h.NONE)t.transform(u.boundingSphere,u.modelMatrix,i);else{if(!r(u._clampedModelMatrix))return v.PENDING;t.transform(u.boundingSphere,u._clampedModelMatrix,i)}return v.DONE},p.prototype._onCollectionChanged=function(n,t,i,u){for(var f,o=this._entitiesToVisualize,s=this._modelHash,h=this._primitives,e=t.length-1;e>-1;e--)f=t[e],r(f._model)&&r(f._position)&&o.set(f.id,f);for(e=u.length-1;e>-1;e--)f=u[e],r(f._model)&&r(f._position)?(ht(f,s),o.set(f.id,f)):(w(this,f,s,h),o.remove(f.id));for(e=i.length-1;e>-1;e--)f=i[e],w(this,f,s,h),o.remove(f.id)},p});t("Shaders/PolylineVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandAndBatchIndex;\nvarying vec2  v_st;\nvarying float v_width;\nvarying vec4 v_pickColor;\nvarying float v_polylineAngle;\nvoid main()\n{\nfloat texCoord = texCoordExpandAndBatchIndex.x;\nfloat expandDir = texCoordExpandAndBatchIndex.y;\nbool usePrev = texCoordExpandAndBatchIndex.z < 0.0;\nfloat batchTableIndex = texCoordExpandAndBatchIndex.w;\nvec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex);\nfloat width = widthAndShow.x + 0.5;\nfloat show = widthAndShow.y;\nif (width < 1.0)\n{\nshow = 0.0;\n}\nvec4 pickColor = batchTable_getPickColor(batchTableIndex);\nvec4 p, prev, next;\nif (czm_morphTime == 1.0)\n{\np = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);\nprev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);\nnext = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);\n}\nelse if (czm_morphTime == 0.0)\n{\np = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\nprev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);\nnext = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);\n}\nelse\n{\np = czm_columbusViewMorph(\nczm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\nczm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\nczm_morphTime);\nprev = czm_columbusViewMorph(\nczm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\nczm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\nczm_morphTime);\nnext = czm_columbusViewMorph(\nczm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\nczm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\nczm_morphTime);\n}\n#ifdef DISTANCE_DISPLAY_CONDITION\nvec3 centerHigh = batchTable_getCenterHigh(batchTableIndex);\nvec4 centerLowAndRadius = batchTable_getCenterLowAndRadius(batchTableIndex);\nvec3 centerLow = centerLowAndRadius.xyz;\nfloat radius = centerLowAndRadius.w;\nvec2 distanceDisplayCondition = batchTable_getDistanceDisplayCondition(batchTableIndex);\nfloat lengthSq;\nif (czm_sceneMode == czm_sceneMode2D)\n{\nlengthSq = czm_eyeHeight2D.y;\n}\nelse\n{\nvec4 center = czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);\nlengthSq = max(0.0, dot(center.xyz, center.xyz) - radius * radius);\n}\nfloat nearSq = distanceDisplayCondition.x * distanceDisplayCondition.x;\nfloat farSq = distanceDisplayCondition.y * distanceDisplayCondition.y;\nif (lengthSq < nearSq || lengthSq > farSq)\n{\nshow = 0.0;\n}\n#endif\nvec4 positionWC = getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, v_polylineAngle);\ngl_Position = czm_viewportOrthographic * positionWC * show;\nv_st = vec2(texCoord, clamp(expandDir, 0.0, 1.0));\nv_width = width;\nv_pickColor = pickColor;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"});t("Scene/Polyline",["../Core/arrayRemoveDuplicates","../Core/BoundingSphere","../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/Matrix4","../Core/PolylinePipeline","./Material"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function a(e,o){var s,a;e=u(e,u.EMPTY_OBJECT);this._show=u(e.show,!0);this._width=u(e.width,1);this._loop=u(e.loop,!1);this._distanceDisplayCondition=e.distanceDisplayCondition;this._material=e.material;f(this._material)||(this._material=l.fromType(l.ColorType,{color:new r(1,1,1,1)}));s=e.positions;f(s)||(s=[]);this._positions=s;this._actualPositions=n(s,i.equalsEpsilon);this._loop&&this._actualPositions.length>2&&(this._actualPositions===this._positions&&(this._actualPositions=s.slice()),this._actualPositions.push(i.clone(this._actualPositions[0])));this._length=this._actualPositions.length;this._id=e.id;f(o)&&(a=h.clone(o.modelMatrix));this._modelMatrix=a;this._segments=c.wrapLongitude(this._actualPositions,a);this._actualLength=undefined;this._propertiesChanged=new Uint32Array(w);this._polylineCollection=o;this._dirty=!1;this._pickId=undefined;this._boundingVolume=t.fromPoints(this._actualPositions);this._boundingVolumeWC=t.transform(this._boundingVolume,this._modelMatrix);this._boundingVolume2D=new t}function v(n,t){++n._propertiesChanged[t];var i=n._polylineCollection;f(i)&&(i._updatePolyline(n,t),n._dirty=!0)}var p=a.POSITION_INDEX=0,b=a.SHOW_INDEX=1,k=a.WIDTH_INDEX=2,d=a.MATERIAL_INDEX=3,y=a.POSITION_SIZE_INDEX=4,g=a.DISTANCE_DISPLAY_CONDITION=5,w=a.NUMBER_OF_PROPERTIES=6;return e(a.prototype,{show:{get:function(){return this._show},set:function(n){if(!f(n))throw new o("value is required.");n!==this._show&&(this._show=n,v(this,b))}},positions:{get:function(){return this._positions},set:function(r){if(!f(r))throw new o("value is required.");var u=n(r,i.equalsEpsilon);this._loop&&u.length>2&&(u===r&&(u=r.slice()),u.push(i.clone(u[0])));(this._actualPositions.length!==u.length||this._actualPositions.length!==this._length)&&v(this,y);this._positions=r;this._actualPositions=u;this._length=u.length;this._boundingVolume=t.fromPoints(this._actualPositions,this._boundingVolume);this._boundingVolumeWC=t.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC);v(this,p);this.update()}},material:{get:function(){return this._material},set:function(n){if(!f(n))throw new o("material is required.");this._material!==n&&(this._material=n,v(this,d))}},width:{get:function(){return this._width},set:function(n){if(!f(n))throw new o("value is required.");var t=this._width;n!==t&&(this._width=n,v(this,k))}},loop:{get:function(){return this._loop},set:function(n){if(!f(n))throw new o("value is required.");if(n!==this._loop){var t=this._actualPositions;n?t.length>2&&!i.equals(t[0],t[t.length-1])&&(t.length===this._positions.length&&(this._actualPositions=t=this._positions.slice()),t.push(i.clone(t[0]))):t.length>2&&i.equals(t[0],t[t.length-1])&&(t.length-1===this._positions.length?this._actualPositions=this._positions:t.pop());this._loop=n;v(this,y)}}},id:{get:function(){return this._id},set:function(n){this._id=n;f(this._pickId)&&(this._pickId.object.id=n)}},pickId:{get:function(){return this._pickId}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(n){if(f(n)&&n.far<=n.near)throw new o("far distance must be greater than near distance.");s.equals(n,this._distanceDisplayCondition)||(this._distanceDisplayCondition=s.clone(n,this._distanceDisplayCondition),v(this,g))}}}),a.prototype.update=function(){var n=h.IDENTITY,u,i;f(this._polylineCollection)&&(n=this._polylineCollection.modelMatrix);var e=this._segments.positions.length,r=this._segments.lengths,o=this._propertiesChanged[p]>0||this._propertiesChanged[y]>0;if((!h.equals(n,this._modelMatrix)||o)&&(this._segments=c.wrapLongitude(this._actualPositions,n),this._boundingVolumeWC=t.transform(this._boundingVolume,n,this._boundingVolumeWC)),this._modelMatrix=h.clone(n,this._modelMatrix),this._segments.positions.length!==e)v(this,y);else for(u=r.length,i=0;i<u;++i)if(r[i]!==this._segments.lengths[i]){v(this,y);break}},a.prototype.getPickId=function(n){return f(this._pickId)||(this._pickId=n.createPickId({primitive:this,collection:this._polylineCollection,id:this._id})),this._pickId},a.prototype._clean=function(){var t,n;for(this._dirty=!1,t=this._propertiesChanged,n=0;n<w-1;++n)t[n]=0},a.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy();this._material=this._material&&this._material.destroy();this._polylineCollection=undefined},a});t("Scene/PolylineCollection",["../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/EncodedCartesian3","../Core/IndexDatatype","../Core/Intersect","../Core/Math","../Core/Matrix4","../Core/Plane","../Core/RuntimeError","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/VertexArray","../Shaders/PolylineCommon","../Shaders/PolylineFS","../Shaders/PolylineVS","./BatchTable","./BlendingState","./Material","./Polyline","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt){"use strict";function ni(n){n=s(n,s.EMPTY_OBJECT);this.modelMatrix=b.clone(s(n.modelMatrix,b.IDENTITY));this._modelMatrix=b.clone(b.IDENTITY);this.debugShowBoundingVolume=s(n.debugShowBoundingVolume,!1);this._opaqueRS=undefined;this._translucentRS=undefined;this._colorCommands=[];this._polylinesUpdated=!1;this._polylinesRemoved=!1;this._createVertexArray=!1;this._propertiesChanged=new Uint32Array(vi);this._polylines=[];this._polylineBuckets={};this._positionBufferUsage={bufferUsage:nt.STATIC_DRAW,frameCount:0};this._mode=undefined;this._polylinesToUpdate=[];this._vertexArrays=[];this._positionBuffer=undefined;this._texCoordExpandAndBatchIndexBuffer=undefined;this._batchTable=undefined;this._createBatchTable=!1;this._useHighlightColor=!1;this._highlightColor=f.clone(f.WHITE);var t=this;this._uniformMap={u_highlightColor:function(){return t._highlightColor}}}function sr(n,t){h(n._batchTable)&&n._batchTable.destroy();var i=[{functionName:"batchTable_getWidthAndShow",componentDatatype:o.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:o.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:o.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:o.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:o.FLOAT,componentsPerAttribute:2}];n._batchTable=new at(t,i,n._polylines.length)}function hr(t,i,r,u){for(var p,k,o,ut,ft,et,bt,d,ot,a,kt=i.context,st=i.commandList,ht=r.length,s=0,y=!0,ct=t._vertexArrays,lt=t.debugShowBoundingVolume,dt=t._batchTable,at=dt.getUniformMapCallback(),gt=ct.length,g=0;g<gt;++g){var nt=ct[g],vt=nt.buckets,ni=vt.length;for(p=0;p<ni;++p){var w=vt[p],tt=w.offset,yt=w.bucket.shaderProgram,pt=w.bucket.polylines,ti=pt.length,v,c,l=0,f,b;for(k=0;k<ti;++k){for(o=pt[k],ut=ar(o._material),ut!==v&&(h(v)&&l>0&&(ft=c.isTranslucent(),s>=ht?(f=new it({owner:t}),r.push(f)):f=r[s],++s,b=e(at(c._uniforms),t._uniformMap),f.boundingVolume=n.clone(ii,f.boundingVolume),f.modelMatrix=u,f.shaderProgram=yt,f.vertexArray=nt.va,f.renderState=ft?t._translucentRS:t._opaqueRS,f.pass=ft?rt.TRANSLUCENT:rt.OPAQUE,f.debugShowBoundingVolume=lt,f.pickId="v_pickColor",f.uniformMap=b,f.count=l,f.offset=tt,tt+=l,l=0,y=!0,st.push(f)),c=o._material,c.update(kt),v=ut),et=o._locatorBuckets,bt=et.length,d=0;d<bt;++d)ot=et[d],ot.locator===w&&(l+=ot.count);i.mode===wt.SCENE3D?a=o._boundingVolumeWC:i.mode===wt.COLUMBUS_VIEW?a=o._boundingVolume2D:i.mode===wt.SCENE2D?h(o._boundingVolume2D)&&(a=n.clone(o._boundingVolume2D,oi),a.center.x=0):h(o._boundingVolumeWC)&&h(o._boundingVolume2D)&&(a=n.union(o._boundingVolumeWC,o._boundingVolume2D,oi));y?(y=!1,n.clone(a,ii)):n.union(a,ii,ii)}h(v)&&l>0&&(s>=ht?(f=new it({owner:t}),r.push(f)):f=r[s],++s,b=e(at(c._uniforms),t._uniformMap),f.boundingVolume=n.clone(ii,f.boundingVolume),f.modelMatrix=u,f.shaderProgram=yt,f.vertexArray=nt.va,f.renderState=c.isTranslucent()?t._translucentRS:t._opaqueRS,f.pass=c.isTranslucent()?rt.TRANSLUCENT:rt.OPAQUE,f.debugShowBoundingVolume=lt,f.pickId="v_pickColor",f.uniformMap=b,f.count=l,f.offset=tt,y=!0,st.push(f));v=undefined}}r.length=s}function cr(n){var i=!1,r=n._propertiesChanged,t=n._positionBufferUsage;return r[ei]?t.bufferUsage!==nt.STREAM_DRAW?(i=!0,t.bufferUsage=nt.STREAM_DRAW,t.frameCount=100):t.frameCount=100:t.bufferUsage!==nt.STATIC_DRAW&&(t.frameCount===0?(i=!0,t.bufferUsage=nt.STATIC_DRAW):t.frameCount--),i}function bi(n,t,i){var it,ft,ii,ri,a,fi,ei,hi;n._createVertexArray=!1;ci(n);ki(n);vr(n);var d=[[]],rt=d[0],vt=n._batchTable,li=n._useHighlightColor,yt=[0],pt=0,bt=[[]],b=0,v=n._polylineBuckets,p,l;for(p in v)v.hasOwnProperty(p)&&(l=v[p],l.updateShader(t,vt,li),b+=l.lengthOfPositions);if(b>0){var tt=n._mode,dt=new Float32Array(18*b),gt=new Float32Array(b*4),k,ut=0,ni=0,ti=0;for(p in v)v.hasOwnProperty(p)&&(l=v[p],l.write(dt,gt,ut,ni,ti,vt,t,i),tt===wt.MORPHING&&(h(k)||(k=new Float32Array(18*b)),l.writeForMorph(k,ut)),it=l.lengthOfPositions,ut+=18*it,ni+=it*4,ti+=it*4,pt=l.updateIndices(d,yt,bt,pt));ft=n._positionBufferUsage.bufferUsage;ii=nt.STATIC_DRAW;n._positionBuffer=g.createVertexBuffer({context:t,typedArray:dt,usage:ft});h(k)&&(ri=g.createVertexBuffer({context:t,typedArray:k,usage:ft}));n._texCoordExpandAndBatchIndexBuffer=g.createVertexBuffer({context:t,typedArray:gt,usage:ii});var r=3*Float32Array.BYTES_PER_ELEMENT,ui=4*Float32Array.BYTES_PER_ELEMENT,et=0,ai=d.length;for(a=0;a<ai;++a)if(rt=d[a],rt.length>0){fi=new Uint16Array(rt);ei=g.createIndexBuffer({context:t,typedArray:fi,usage:nt.STATIC_DRAW,indexDatatype:y.UNSIGNED_SHORT});et+=yt[a];var ot=6*(a*r*w.SIXTY_FOUR_KILOBYTES-et*r),ht=r+ot,ct=r+ht,lt=r+ct,at=r+lt,oi=r+at,vi=a*ui*w.SIXTY_FOUR_KILOBYTES-et*ui,u=[{index:kt.position3DHigh,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:ot,strideInBytes:6*r},{index:kt.position3DLow,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:ht,strideInBytes:6*r},{index:kt.position2DHigh,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:ot,strideInBytes:6*r},{index:kt.position2DLow,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:ht,strideInBytes:6*r},{index:kt.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:ct,strideInBytes:6*r},{index:kt.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:lt,strideInBytes:6*r},{index:kt.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:ct,strideInBytes:6*r},{index:kt.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:lt,strideInBytes:6*r},{index:kt.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:at,strideInBytes:6*r},{index:kt.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:oi,strideInBytes:6*r},{index:kt.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:at,strideInBytes:6*r},{index:kt.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:o.FLOAT,offsetInBytes:oi,strideInBytes:6*r},{index:kt.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:o.FLOAT,vertexBuffer:n._texCoordExpandAndBatchIndexBuffer,offsetInBytes:vi}],f,e,s,c;tt===wt.SCENE3D?(f=n._positionBuffer,e="vertexBuffer",s=si,c="value"):tt===wt.SCENE2D||tt===wt.COLUMBUS_VIEW?(f=si,e="value",s=n._positionBuffer,c="vertexBuffer"):(f=ri,e="vertexBuffer",s=n._positionBuffer,c="vertexBuffer");u[0][e]=f;u[1][e]=f;u[2][c]=s;u[3][c]=s;u[4][e]=f;u[5][e]=f;u[6][c]=s;u[7][c]=s;u[8][e]=f;u[9][e]=f;u[10][c]=s;u[11][c]=s;hi=new st({context:t,attributes:u,indexBuffer:ei});n._vertexArrays.push({va:hi,buckets:bt[a]})}}}function lr(n,t){return t instanceof ot?t.id:t}function ar(n){var u=yt._uniformList[n.type],f=u.length,t,i,r;for(ui.length=2*f,t=0,i=0;i<f;++i)r=u[i],ui[t]=r,ui[t+1]=n._uniforms[r](),t+=2;return n.type+":"+JSON.stringify(ui,lr)}function vr(n){for(var t,i,r,o=n._mode,s=n._modelMatrix,f=n._polylineBuckets={},e=n._polylines,c=e.length,u=0;u<c;++u)t=e[u],t._actualPositions.length>1&&(t.update(),i=t.material,r=f[i.type],h(r)||(r=f[i.type]=new ti(i,o,s)),r.addPolyline(t))}function yr(n,t){var i=t.mode;n._mode===i&&b.equals(n._modelMatrix,n.modelMatrix)||(n._mode=i,n._modelMatrix=b.clone(n.modelMatrix),n._createVertexArray=!0)}function hi(n){var r,u,t,f,i;if(n._polylinesRemoved){for(n._polylinesRemoved=!1,r=[],u=n._polylines.length,t=0,f=0;t<u;++t)i=n._polylines[t],h(i)&&(i._index=f++,r.push(i));n._polylines=r}}function ci(n){for(var t,r=n._polylines,u=r.length,i=0;i<u;++i)h(r[i])&&(t=r[i]._bucket,h(t)&&(t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()))}function ki(n){for(var i=n._vertexArrays.length,t=0;t<i;++t)n._vertexArrays[t].va.destroy();n._vertexArrays.length=0}function di(n){for(var i=n._polylines,r=i.length,t=0;t<r;++t)h(i[t])&&i[t]._destroy()}function li(n,t,i){this.count=n;this.offset=t;this.bucket=i}function ti(n,t,i){this.polylines=[];this.lengthOfPositions=0;this.material=n;this.shaderProgram=undefined;this.mode=t;this.modelMatrix=i}function gi(n){return i.dot(i.UNIT_X,n._boundingVolume.center)<0||n._boundingVolume.intersectPlane(k.ORIGIN_ZX_PLANE)===p.INTERSECTING}var ur=pt.SHOW_INDEX,fr=pt.WIDTH_INDEX,ei=pt.POSITION_INDEX,er=pt.MATERIAL_INDEX,ai=pt.POSITION_SIZE_INDEX,or=pt.DISTANCE_DISPLAY_CONDITION,vi=pt.NUMBER_OF_PROPERTIES,kt={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12},ii,oi,si,ui,tr,rr;c(ni.prototype,{length:{get:function(){return hi(this),this._polylines.length}}});ni.prototype.add=function(n){var t=new pt(n,this);return t._index=this._polylines.length,this._polylines.push(t),this._createVertexArray=!0,this._createBatchTable=!0,t};ni.prototype.remove=function(n){var i,t;return this.contains(n)?(this._polylines[n._index]=undefined,i=this._polylinesToUpdate.indexOf(n),i!==-1&&this._polylinesToUpdate.splice(i,1),this._polylinesRemoved=!0,this._createVertexArray=!0,this._createBatchTable=!0,h(n._bucket)&&(t=n._bucket,t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()),n._destroy(),!0):!1};ni.prototype.removeAll=function(){ci(this);di(this);this._polylineBuckets={};this._polylinesRemoved=!1;this._polylines.length=0;this._polylinesToUpdate.length=0;this._createVertexArray=!0};ni.prototype.contains=function(n){return h(n)&&n._polylineCollection===this};ni.prototype.get=function(n){if(!h(n))throw new a("index is required.");return hi(this),this._polylines[n]};var yi=new v,pi=new r,wi=new t;ni.prototype.update=function(n){var e,et,c,ot,s,l,nt,it,a,o,p,w,rt,ft,f,ht;if(hi(this),this._polylines.length!==0){yr(this,n);var k=n.context,g=n.mapProjection,i,u=this._propertiesChanged;if(this._createBatchTable){if(tt.maximumVertexTextureImageUnits===0)throw new d("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");sr(this,k);this._createBatchTable=!1}if(this._createVertexArray||cr(this))bi(this,k,g);else if(this._polylinesUpdated){if(e=this._polylinesToUpdate,this._mode!==wt.SCENE3D)for(et=e.length,c=0;c<et;++c)i=e[c],i.update();if(u[ai]||u[er])bi(this,k,g);else for(ot=e.length,s=this._polylineBuckets,l=0;l<ot;++l){i=e[l];u=i._propertiesChanged;nt=i._bucket;it=0;for(a in s)if(s.hasOwnProperty(a)){if(s[a]===nt){u[ei]&&nt.writeUpdate(it,i,this._positionBuffer,g);break}it+=s[a].lengthOfPositions}if((u[ur]||u[fr])&&this._batchTable.setBatchedAttribute(i._index,0,new t(i._width,i._show)),this._batchTable.attributes.length>2){if(u[ei]||u[ai]){var st=n.mode===wt.SCENE2D?i._boundingVolume2D:i._boundingVolumeWC,y=v.fromCartesian(st.center,yi),ct=r.fromElements(y.low.x,y.low.y,y.low.z,st.radius,pi);this._batchTable.setBatchedAttribute(i._index,2,y.high);this._batchTable.setBatchedAttribute(i._index,3,ct)}u[or]&&(o=wi,o.x=0,o.y=Number.MAX_VALUE,p=i.distanceDisplayCondition,h(p)&&(o.x=p.near,o.y=p.far),this._batchTable.setBatchedAttribute(i._index,4,o))}i._clean()}e.length=0;this._polylinesUpdated=!1}for(u=this._propertiesChanged,w=0;w<vi;++w)u[w]=0;rt=b.IDENTITY;n.mode===wt.SCENE3D&&(rt=this.modelMatrix);ft=n.passes;f=n.morphTime!==0;h(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===f||(this._opaqueRS=ut.fromCache({depthMask:f,depthTest:{enabled:f}}));h(this._translucentRS)&&this._translucentRS.depthTest.enabled===f||(this._translucentRS=ut.fromCache({blending:vt.ALPHA_BLEND,depthMask:!f,depthTest:{enabled:f}}));this._batchTable.update(n);(ft.render||ft.pick)&&(ht=this._colorCommands,hr(this,n,ht,rt))}};ii=new n;oi=new n;ni.prototype.isDestroyed=function(){return!1};ni.prototype.destroy=function(){return ki(this),ci(this),di(this),this._batchTable=this._batchTable&&this._batchTable.destroy(),l(this)};si=[0,0,0];ui=[];ni.prototype._updatePolyline=function(n,t){this._polylinesUpdated=!0;this._polylinesToUpdate.push(n);++this._propertiesChanged[t]};ti.prototype.addPolyline=function(n){var t=this.polylines;t.push(n);n._actualLength=this.getPolylinePositionsLength(n);this.lengthOfPositions+=n._actualLength;n._bucket=this};ti.prototype.updateShader=function(n,t,i){var r;if(!h(this.shaderProgram)){r=["DISTANCE_DISPLAY_CONDITION"];i&&r.push("VECTOR_TILE");this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)!==-1&&r.push("POLYLINE_DASH");var u=new et({defines:r,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,ct]}),f=t.getVertexShaderCallback()(lt),e=new et({defines:r,sources:[ht,f]});this.shaderProgram=ft.fromCache({context:n,vertexShaderSource:e,fragmentShaderSource:u,attributeLocations:kt})}};ti.prototype.getPolylinePositionsLength=function(n){var t,r,u,i;if(this.mode===wt.SCENE3D||!gi(n))return t=n._actualPositions.length,t*4-4;for(r=0,u=n._segments.lengths,t=u.length,i=0;i<t;++i)r+=u[i]*4-4;return r};var bt=new i,dt=new i,gt=new i,fi=new i,pr=new r,wr=new t;ti.prototype.write=function(n,t,u,e,o,s,c,l){for(var p,ct,lt,at,ni,ti,nt,ii,g,ft,ot,it=this.mode,ui=l.ellipsoid.maximumRadius*w.PI,vt=this.polylines,ei=vt.length,st=0;st<ei;++st){var b=vt[st],yt=b.width,oi=b.show&&yt>0,d=b._index,pt=this.getSegments(b,l),y=pt.positions,kt=pt.lengths,k=y.length,rt=b.getPickId(c).color,ht=0,ut=0,a;for(p=0;p<k;++p)for(p===0?b._loop?a=y[k-2]:(a=fi,i.subtract(y[0],y[1],a),i.add(y[0],a,a)):a=y[p-1],i.clone(a,dt),i.clone(y[p],bt),p===k-1?b._loop?a=y[1]:(a=fi,i.subtract(y[k-1],y[k-2],a),i.add(y[k-1],a,a)):a=y[p+1],i.clone(a,gt),ct=kt[ht],p===ut+ct&&(ut+=ct,++ht),lt=p-ut==0,at=p===ut+kt[ht]-1,it===wt.SCENE2D&&(dt.z=0,bt.z=0,gt.z=0),(it===wt.SCENE2D||it===wt.MORPHING)&&(lt||at)&&ui-Math.abs(bt.x)<1&&((bt.x<0&&dt.x>0||bt.x>0&&dt.x<0)&&i.clone(bt,dt),(bt.x<0&&gt.x>0||bt.x>0&&gt.x<0)&&i.clone(bt,gt)),ni=lt?2:0,ti=at?2:4,nt=ni;nt<ti;++nt)v.writeElements(bt,n,u),v.writeElements(dt,n,u+6),v.writeElements(gt,n,u+12),ii=nt-2<0?-1:1,t[o]=p/(k-1),t[o+1]=2*(nt%2)-1,t[o+2]=ii,t[o+3]=d,u+=18,o+=4;g=pr;g.x=f.floatToByte(rt.red);g.y=f.floatToByte(rt.green);g.z=f.floatToByte(rt.blue);g.w=f.floatToByte(rt.alpha);ft=wr;ft.x=yt;ft.y=oi?1:0;var ri=it===wt.SCENE2D?b._boundingVolume2D:b._boundingVolumeWC,et=v.fromCartesian(ri.center,yi),si=et.high,hi=r.fromElements(et.low.x,et.low.y,et.low.z,ri.radius,pi),tt=wi;tt.x=0;tt.y=Number.MAX_VALUE;ot=b.distanceDisplayCondition;h(ot)&&(tt.x=ot.near,tt.y=ot.far);s.setBatchedAttribute(d,0,ft);s.setBatchedAttribute(d,1,g);s.attributes.length>2&&(s.setBatchedAttribute(d,2,si),s.setBatchedAttribute(d,3,hi),s.setBatchedAttribute(d,4,tt))}};var br=new i,kr=new i,dr=new i,nr=new i;ti.prototype.writeForMorph=function(n,t){for(var u,f,d,e,y,p,c=this.modelMatrix,w=this.polylines,g=w.length,l=0;l<g;++l){var s=w[l],r=s._segments.positions,k=s._segments.lengths,o=r.length,a=0,h=0;for(u=0;u<o;++u){u===0?s._loop?f=r[o-2]:(f=nr,i.subtract(r[0],r[1],f),i.add(r[0],f,f)):f=r[u-1];f=b.multiplyByPoint(c,f,kr);d=b.multiplyByPoint(c,r[u],br);u===o-1?s._loop?e=r[1]:(e=nr,i.subtract(r[o-1],r[o-2],e),i.add(r[o-1],e,e)):e=r[u+1];e=b.multiplyByPoint(c,e,dr);y=k[a];u===h+y&&(h+=y,++a);var nt=u-h==0,tt=u===h+k[a]-1,it=nt?2:0,rt=tt?2:4;for(p=it;p<rt;++p)v.writeElements(d,n,t),v.writeElements(f,n,t+6),v.writeElements(e,n,t+12),t+=18}}};tr=new Array(1);ti.prototype.updateIndices=function(n,t,i,r){var v=i.length-1,f=new li(0,r,this),y,d,l,o,h,p,b,c,a,g,k;i[v].push(f);var s=0,e=n[n.length-1],u=0;for(e.length>0&&(u=e[e.length-1]+1),y=this.polylines,d=y.length,l=0;l<d;++l){if(o=y[l],o._locatorBuckets=[],this.mode===wt.SCENE3D)if(h=tr,p=o._actualPositions.length,p>0)h[0]=p;else continue;else h=o._segments.lengths;if(b=h.length,b>0){for(c=0,a=0;a<b;++a)for(g=h[a]-1,k=0;k<g;++k)u+4>w.SIXTY_FOUR_KILOBYTES&&(o._locatorBuckets.push({locator:f,count:c}),c=0,t.push(4),e=[],n.push(e),u=0,f.count=s,s=0,r=0,f=new li(0,0,this),i[++v]=[f]),e.push(u,u+2,u+1),e.push(u+1,u+2,u+3),c+=6,s+=6,r+=6,u+=4;o._locatorBuckets.push({locator:f,count:c});u+4>w.SIXTY_FOUR_KILOBYTES&&(t.push(0),e=[],n.push(e),u=0,f.count=s,r=0,s=0,f=new li(0,0,this),i[++v]=[f])}o._clean()}return f.count=s,r};ti.prototype.getPolylineStartIndex=function(n){for(var i,r=this.polylines,u=0,f=r.length,t=0;t<f;++t){if(i=r[t],i===n)break;u+=i._actualLength}return u};var ri={positions:undefined,lengths:undefined},ir=new Array(1),gr=new i,nu=new u;return ti.prototype.getSegments=function(t,r){var u=t._actualPositions,e,o;if(this.mode===wt.SCENE3D)return ir[0]=u.length,ri.positions=u,ri.lengths=ir,ri;gi(t)&&(u=t._segments.positions);var c=r.ellipsoid,f=[],l=this.modelMatrix,a=u.length,h,s=gr;for(e=0;e<a;++e)h=u[e],s=b.multiplyByPoint(l,h,s),f.push(r.project(c.cartesianToCartographic(s,nu)));return f.length>0&&(t._boundingVolume2D=n.fromPoints(f,t._boundingVolume2D),o=t._boundingVolume2D.center,t._boundingVolume2D.center=new i(o.z,o.x,o.y)),ri.positions=f,ri.lengths=t._segments.lengths,ri},ti.prototype.writeUpdate=function(n,t,r,u){var p=this.mode,ft=u.ellipsoid.maximumRadius*w.PI,c=t._actualLength,o,l,s,k,d,g,rt,ut,nt;if(c){n+=this.getPolylineStartIndex(t);o=rr;l=18*c;!h(o)||o.length<l?o=rr=new Float32Array(l):o.length>l&&(o=new Float32Array(o.buffer,0,l));var tt=this.getSegments(t,u),e=tt.positions,it=tt.lengths,a=0,b=0,y=0,f;for(c=e.length,s=0;s<c;++s)for(s===0?t._loop?f=e[c-2]:(f=fi,i.subtract(e[0],e[1],f),i.add(e[0],f,f)):f=e[s-1],i.clone(f,dt),i.clone(e[s],bt),s===c-1?t._loop?f=e[1]:(f=fi,i.subtract(e[c-1],e[c-2],f),i.add(e[c-1],f,f)):f=e[s+1],i.clone(f,gt),k=it[b],s===y+k&&(y+=k,++b),d=s-y==0,g=s===y+it[b]-1,p===wt.SCENE2D&&(dt.z=0,bt.z=0,gt.z=0),(p===wt.SCENE2D||p===wt.MORPHING)&&(d||g)&&ft-Math.abs(bt.x)<1&&((bt.x<0&&dt.x>0||bt.x>0&&dt.x<0)&&i.clone(bt,dt),(bt.x<0&&gt.x>0||bt.x>0&&gt.x<0)&&i.clone(bt,gt)),rt=d?2:0,ut=g?2:4,nt=rt;nt<ut;++nt)v.writeElements(bt,o,a),v.writeElements(dt,o,a+6),v.writeElements(gt,o,a+12),a+=18;r.copyFromArrayView(o,18*Float32Array.BYTES_PER_ELEMENT*n)}},ni});t("DataSources/ScaledPositionProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Ellipsoid","../Core/Event","../Core/ReferenceFrame","./Property"],function(n,t,i,r,u,f,e){"use strict";function o(n){this._definitionChanged=new u;this._value=undefined;this._removeSubscription=undefined;this.setValue(n)}return t(o.prototype,{isConstant:{get:function(){return e.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return n(this._value)?this._value.referenceFrame:f.FIXED}}}),o.prototype.getValue=function(n,t){return this.getValueInReferenceFrame(n,f.FIXED,t)},o.prototype.setValue=function(t){this._value!==t&&(this._value=t,n(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=undefined),n(t)&&(this._removeSubscription=t.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))},o.prototype.getValueInReferenceFrame=function(t,u,f){if(!n(t))throw new i("time is required.");if(!n(u))throw new i("referenceFrame is required.");return n(this._value)?(f=this._value.getValueInReferenceFrame(t,u,f),n(f)?r.WGS84.scaleToGeodeticSurface(f,f):undefined):undefined},o.prototype.equals=function(n){return this===n||n instanceof o&&this._value===n._value},o.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)},o});t("DataSources/PathVisualizer",["../Core/AssociativeArray","../Core/Cartesian3","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/JulianDate","../Core/Matrix3","../Core/Matrix4","../Core/ReferenceFrame","../Core/TimeInterval","../Core/Transforms","../Scene/PolylineCollection","../Scene/SceneMode","./CompositePositionProperty","./ConstantPositionProperty","./MaterialProperty","./Property","./ReferenceProperty","./SampledPositionProperty","./ScaledPositionProperty","./TimeIntervalCollectionPositionProperty"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";function ft(n){this.entity=n;this.polyline=undefined;this.index=undefined;this.updater=undefined}function lt(n,t,r,u,e,o,s,h,c){var a=h,l,tt,b;l=n.getValueInReferenceFrame(t,o,c[a]);i(l)&&(c[a++]=l);for(var d=!i(e)||f.lessThanOrEquals(e,t)||f.greaterThanOrEquals(e,r),y=0,g=u.length,v=u[y],it=r,p=!1,w,k,nt;y<g;){if(!d&&f.greaterThanOrEquals(v,e)&&(l=n.getValueInReferenceFrame(e,o,c[a]),i(l)&&(c[a++]=l),d=!0),f.greaterThan(v,t)&&f.lessThan(v,it)&&!v.equals(e)&&(l=n.getValueInReferenceFrame(v,o,c[a]),i(l)&&(c[a++]=l)),y<g-1&&(s>0&&!p&&(tt=u[y+1],b=f.secondsDifference(tt,v),p=b>s,p&&(w=Math.ceil(b/s),k=0,nt=b/Math.max(w,2),w=Math.max(w-1,1))),p&&k<w)){v=f.addSeconds(v,nt,new f);k++;continue}p=!1;y++;v=u[y]}return l=n.getValueInReferenceFrame(r,o,c[a]),i(l)&&(c[a++]=l),a}function at(n,t,r,u,e,o,s,h){for(var l,v=0,c=s,a=t,p=Math.max(o,60),y=!i(u)||f.lessThanOrEquals(u,t)||f.greaterThanOrEquals(u,r);f.lessThan(a,r);)!y&&f.greaterThanOrEquals(a,u)&&(y=!0,l=n.getValueInReferenceFrame(u,e,h[c]),i(l)&&(h[c]=l,c++)),l=n.getValueInReferenceFrame(a,e,h[c]),i(l)&&(h[c]=l,c++),v++,a=f.addSeconds(t,p*v,new f);return l=n.getValueInReferenceFrame(r,e,h[c]),i(l)&&(h[c]=l,c++),c}function vt(n,t,r,u,e,o,s,c){var a,y,v,l,p,w;for(rt.start=t,rt.stop=r,a=s,y=n.intervals,v=0;v<y.length;v++)l=y.get(v),h.intersect(l,rt,ut).isEmpty||(p=l.start,l.isStartIncluded||(p=l.isStopIncluded?l.stop:f.addSeconds(l.start,f.secondsDifference(l.stop,l.start)/2,new f)),w=n.getValueInReferenceFrame(p,e,c[a]),i(w)&&(c[a]=w,a++));return a}function yt(n,t,r,u,f,e,o,s){var h=n.getValueInReferenceFrame(t,f,s[o]);return i(h)&&(s[o++]=h),o}function pt(n,t,i,r,u,e,o,s){var l,y,a,c,v;for(it.start=t,it.stop=i,l=o,y=n.intervals,a=0;a<y.length;a++)if(c=y.get(a),!h.intersect(c,it,ut).isEmpty){var w=c.start,b=c.stop,p=t;f.greaterThan(w,p)&&(p=w);v=i;f.lessThan(b,v)&&(v=b);l=et(c.data,p,v,r,u,e,l,s)}return l}function et(n,t,i,r,u,f,e,o){while(n instanceof b)n=n.resolvedProperty;if(n instanceof k){var s=n._property._times;e=lt(n,t,i,s,r,u,f,e,o)}else e=n instanceof v?pt(n,t,i,r,u,f,e,o):n instanceof g?vt(n,t,i,r,u,f,e,o):n instanceof y||n instanceof d&&w.isConstant(n)?yt(n,t,i,r,u,f,e,o):at(n,t,i,r,u,f,e,o);return e}function ot(n,t,r,u,f,e,o){i(o)||(o=[]);var s=et(n,t,r,u,f,e,0,o);return o.length=s,o}function tt(n,t){this._unusedIndexes=[];this._polylineCollection=new l;this._scene=n;this._referenceFrame=t;n.primitives.add(this._polylineCollection)}function nt(t,r){if(!i(t))throw new u("scene is required.");if(!i(r))throw new u("entityCollection is required.");r.collectionChanged.addEventListener(nt.prototype._onCollectionChanged,this);this._scene=t;this._updaters={};this._entityCollection=r;this._items=new n;this._onCollectionChanged(r,r.values,[],[])}var ht=60,ct=1,ut=new h,it=new h,rt=new h,st=new e;return tt.prototype.update=function(n){if(this._referenceFrame===s.INERTIAL){var r=c.computeIcrfToFixedMatrix(n,st);i(r)||(r=c.computeTemeToPseudoFixedMatrix(n,st));o.fromRotationTranslation(r,t.ZERO,this._polylineCollection.modelMatrix)}},tt.prototype.updateObject=function(n,t){var e=t.entity,u=e._path,ut=e._position,o,s,d=u._show,r=t.polyline,h=e.isShowing&&(!i(d)||d.getValue(n)),v,y,b,it,k,rt;if(h){var g=w.getValueOrUndefined(u._leadTime,n),nt=w.getValueOrUndefined(u._trailTime,n),c=e._availability,tt=i(c),l=i(g),a=i(nt);h=tt||l&&a;h&&(a&&(o=f.addSeconds(n,-nt,new f)),l&&(s=f.addSeconds(n,g,new f)),tt&&(v=c.start,y=c.stop,(!a||f.greaterThan(v,o))&&(o=v),(!l||f.lessThan(y,s))&&(s=y)),h=f.lessThan(o,s))}if(!h){i(r)&&(this._unusedIndexes.push(t.index),t.polyline=undefined,r.show=!1,t.index=undefined);return}i(r)||(b=this._unusedIndexes,it=b.length,it>0?(k=b.pop(),r=this._polylineCollection.get(k),t.index=k):(t.index=this._polylineCollection.length,r=this._polylineCollection.add()),r.id=e,t.polyline=r);rt=w.getValueOrDefault(u._resolution,n,ht);r.show=!0;r.positions=ot(ut,o,s,n,this._referenceFrame,rt,r.positions.slice());r.material=p.getValue(n,u._material,r.material);r.width=w.getValueOrDefault(u._width,n,ct);r.distanceDisplayCondition=w.getValueOrUndefined(u._distanceDisplayCondition,n,r.distanceDisplayCondition)},tt.prototype.removeObject=function(n){var t=n.polyline;i(t)&&(this._unusedIndexes.push(n.index),n.polyline=undefined,t.show=!1,t.id=undefined,n.index=undefined)},tt.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),r(this)},nt.prototype.update=function(n){var f,h,c,e,v,t;if(!i(n))throw new u("time is required.");f=this._updaters;for(h in f)f.hasOwnProperty(h)&&f[h].update(n);for(c=this._items.values,e=0,v=c.length;e<v;e++){var r=c[e],y=r.entity,p=y._position,l=r.updater,o=s.FIXED;if(this._scene.mode===a.SCENE3D&&(o=p.referenceFrame),t=this._updaters[o],l===t&&i(t)){t.updateObject(n,r);continue}i(l)&&l.removeObject(r);i(t)||(t=new tt(this._scene,o),t.update(n),this._updaters[o]=t);r.updater=t;i(t)&&t.updateObject(n,r)}return!0},nt.prototype.isDestroyed=function(){return!1},nt.prototype.destroy=function(){var n,t;this._entityCollection.collectionChanged.removeEventListener(nt.prototype._onCollectionChanged,this);n=this._updaters;for(t in n)n.hasOwnProperty(t)&&n[t].destroy();return r(this)},nt.prototype._onCollectionChanged=function(n,t,r,u){for(var f,o,s=this._items,e=t.length-1;e>-1;e--)f=t[e],i(f._path)&&i(f._position)&&s.set(f.id,new ft(f));for(e=u.length-1;e>-1;e--)f=u[e],i(f._path)&&i(f._position)?s.contains(f.id)||s.set(f.id,new ft(f)):(o=s.get(f.id),i(o)&&(o.updater.removeObject(o),s.remove(f.id)));for(e=r.length-1;e>-1;e--)f=r[e],o=s.get(f.id),i(o)&&(i(o.updater)&&o.updater.removeObject(o),s.remove(f.id))},nt._subSample=ot,nt});t("Scene/createBillboardPointCallback",[],function(){"use strict";function n(n,t,i,r,u){return function(){var o=document.createElement("canvas"),e=u+2*r,f;return o.height=o.width=e,f=o.getContext("2d"),f.clearRect(0,0,e,e),r!==0&&(f.beginPath(),f.arc(e/2,e/2,e/2,0,2*Math.PI,!0),f.closePath(),f.fillStyle=i,f.fill(),n<1&&(f.save(),f.globalCompositeOperation="destination-out",f.beginPath(),f.arc(e/2,e/2,u/2,0,2*Math.PI,!0),f.closePath(),f.fillStyle="black",f.fill(),f.restore())),f.beginPath(),f.arc(e/2,e/2,u/2,0,2*Math.PI,!0),f.closePath(),f.fillStyle=t,f.fill(),o}}return n});t("DataSources/PointVisualizer",["../Core/AssociativeArray","../Core/Cartesian3","../Core/Color","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/NearFarScalar","../Scene/createBillboardPointCallback","../Scene/HeightReference","./BoundingSphereState","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function rt(n){this.entity=n;this.pointPrimitive=undefined;this.billboard=undefined;this.color=undefined;this.outlineColor=undefined;this.pixelSize=undefined;this.outlineWidth=undefined}function a(t,i){if(!r(t))throw new f("entityCluster is required.");if(!r(i))throw new f("entityCollection is required.");i.collectionChanged.addEventListener(a.prototype._onCollectionChanged,this);this._cluster=t;this._entityCollection=i;this._items=new n;this._onCollectionChanged(i,i.values,[],[])}function v(n,t,i){var u,f;if(r(n)){if(u=n.pointPrimitive,r(u)){n.pointPrimitive=undefined;i.removePoint(t);return}f=n.billboard;r(f)&&(n.billboard=undefined,i.removeBillboard(t))}}var y=i.WHITE,p=i.BLACK,w=0,b=1,k=0,d=new i,ut=new t,g=new i,nt=new o,tt=new o,it=new e;return a.prototype.update=function(n){var lt,a,st,yt,rt;if(!r(n))throw new f("time is required.");for(lt=this._items.values,a=this._cluster,st=0,yt=lt.length;st<yt;st++){var t=lt[st],c=t.entity,u=c._point,o=t.pointPrimitive,e=t.billboard,at=l.getValueOrDefault(u._heightReference,n,h.NONE),vt=c.isShowing&&c.isAvailable(n)&&l.getValueOrDefault(u._show,n,!0),ht;if(vt&&(ht=l.getValueOrUndefined(c._position,n,ut),vt=r(ht)),!vt){v(t,c,a);continue}if(l.isConstant(c._position)||(a._clusterDirty=!0),rt=!1,at===h.NONE||r(e)?at!==h.NONE||r(o)||(r(e)&&(v(t,c,a),e=undefined),o=a.getPoint(c),o.id=c,t.pointPrimitive=o):(r(o)&&(v(t,c,a),o=undefined),e=a.getBillboard(c),e.id=c,e.image=undefined,t.billboard=e,rt=!0),r(o))o.show=!0,o.position=ht,o.scaleByDistance=l.getValueOrUndefined(u._scaleByDistance,n,nt),o.translucencyByDistance=l.getValueOrUndefined(u._translucencyByDistance,n,tt),o.color=l.getValueOrDefault(u._color,n,y,d),o.outlineColor=l.getValueOrDefault(u._outlineColor,n,p,g),o.outlineWidth=l.getValueOrDefault(u._outlineWidth,n,w),o.pixelSize=l.getValueOrDefault(u._pixelSize,n,b),o.distanceDisplayCondition=l.getValueOrUndefined(u._distanceDisplayCondition,n,it),o.disableDepthTestDistance=l.getValueOrDefault(u._disableDepthTestDistance,n,k);else if(r(e)){e.show=!0;e.position=ht;e.scaleByDistance=l.getValueOrUndefined(u._scaleByDistance,n,nt);e.translucencyByDistance=l.getValueOrUndefined(u._translucencyByDistance,n,tt);e.distanceDisplayCondition=l.getValueOrUndefined(u._distanceDisplayCondition,n,it);e.disableDepthTestDistance=l.getValueOrDefault(u._disableDepthTestDistance,n,k);e.heightReference=at;var ot=l.getValueOrDefault(u._color,n,y,d),ct=l.getValueOrDefault(u._outlineColor,n,p,g),ft=Math.round(l.getValueOrDefault(u._outlineWidth,n,w)),et=Math.max(1,Math.round(l.getValueOrDefault(u._pixelSize,n,b)));if(ft>0?(e.scale=1,rt=rt||ft!==t.outlineWidth||et!==t.pixelSize||!i.equals(ot,t.color)||!i.equals(ct,t.outlineColor)):(e.scale=et/50,et=50,rt=rt||ft!==t.outlineWidth||!i.equals(ot,t.color)||!i.equals(ct,t.outlineColor)),rt){t.color=i.clone(ot,t.color);t.outlineColor=i.clone(ct,t.outlineColor);t.pixelSize=et;t.outlineWidth=ft;var bt=ot.alpha,pt=ot.toCssColorString(),wt=ct.toCssColorString(),kt=JSON.stringify([pt,et,wt,ft]);e.setImage(kt,s(bt,pt,wt,ft,et))}}}return!0},a.prototype.getBoundingSphere=function(n,i){var u,e;if(!r(n))throw new f("entity is required.");if(!r(i))throw new f("result is required.");if(u=this._items.get(n.id),!r(u)||!(r(u.pointPrimitive)||r(u.billboard)))return c.FAILED;if(r(u.pointPrimitive))i.center=t.clone(u.pointPrimitive.position,i.center);else{if(e=u.billboard,!r(e._clampedPosition))return c.PENDING;i.center=t.clone(e._clampedPosition,i.center)}return i.radius=0,c.DONE},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){var t,n;for(this._entityCollection.collectionChanged.removeEventListener(a.prototype._onCollectionChanged,this),t=this._entityCollection.values,n=0;n<t.length;n++)this._cluster.removePoint(t[n]);return u(this)},a.prototype._onCollectionChanged=function(n,t,i,u){for(var f,o=this._items,s=this._cluster,e=t.length-1;e>-1;e--)f=t[e],r(f._point)&&r(f._position)&&o.set(f.id,new rt(f));for(e=u.length-1;e>-1;e--)f=u[e],r(f._point)&&r(f._position)?o.contains(f.id)||o.set(f.id,new rt(f)):(v(o.get(f.id),f,s),o.remove(f.id));for(e=i.length-1;e>-1;e--)f=i[e],v(o.get(f.id),f,s),o.remove(f.id)},a});t("DataSources/PolylineGeometryUpdater",["../Core/BoundingSphere","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/Event","../Core/GeometryInstance","../Core/GroundPolylineGeometry","../Core/Iso8601","../Core/PolylineGeometry","../Core/PolylinePipeline","../Core/ShowGeometryInstanceAttribute","../DataSources/Entity","../Scene/GroundPolylinePrimitive","../Scene/PolylineCollection","../Scene/PolylineColorAppearance","../Scene/PolylineMaterialAppearance","../Scene/ShadowMode","./BoundingSphereState","./ColorMaterialProperty","./ConstantProperty","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot){"use strict";function dt(){this.vertexFormat=undefined;this.positions=undefined;this.width=undefined;this.followSurface=undefined;this.granularity=undefined}function gt(){this.positions=undefined;this.width=undefined}function st(n,t){if(!f(n))throw new s("entity is required");if(!f(t))throw new s("scene is required");this._entity=n;this._scene=t;this._entitySubscription=n.definitionChanged.addEventListener(st.prototype._onEntityPropertyChanged,this);this._fillEnabled=!1;this._dynamic=!1;this._geometryChanged=new l;this._showProperty=undefined;this._materialProperty=undefined;this._shadowsProperty=undefined;this._distanceDisplayConditionProperty=undefined;this._depthFailMaterialProperty=undefined;this._geometryOptions=new dt;this._groundGeometryOptions=new gt;this._id="polyline-"+n.id;this._clampToGround=!1;this._supportsPolylinesOnTerrain=k.supportsPolylinesOnTerrain(t);this._zIndex=0;this._onEntityPropertyChanged(n,"polyline",n.polyline,undefined)}function ct(n,t,i){this._line=undefined;this._primitives=n;this._groundPrimitives=t;this._groundPolylinePrimitive=undefined;this._material=undefined;this._geometryUpdater=i;this._positions=[]}function vt(n){var i;if(f(n._line))return n._line;var u=n._geometryUpdater._scene.id,t=lt[u],r=n._primitives;return!f(t)||t.isDestroyed()?(t=new g,lt[u]=t,r.add(t)):r.contains(t)||r.add(t),i=t.add(),i.id=n._geometryUpdater._entity,n._line=i,i}var yt=new ft(0),lt={},at=new i,pt=new ut(i.WHITE),wt=new ft(!0),bt=new ft(it.DISABLED),kt=new ft(new h),ht;return e(st.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!f(this._entity.availability)&&ot.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:undefined},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}}),st.prototype.isOutlineVisible=function(){return!1},st.prototype.isFilled=function(n){var t=this._entity;return this._fillEnabled&&t.isAvailable(n)&&this._showProperty.getValue(n)},st.prototype.createFillGeometryInstance=function(n){if(!f(n))throw new s("time is required.");if(!this._fillEnabled)throw new s("This instance does not represent a filled geometry.");var u=this._entity,o=u.isAvailable(n),h=new b(o&&u.isShowing&&this._showProperty.getValue(n)),l=this._distanceDisplayConditionProperty.getValue(n),y=c.fromDistanceDisplayCondition(l),e={show:h,distanceDisplayCondition:y},t;return(this._materialProperty instanceof ut&&(f(this._materialProperty.color)&&(this._materialProperty.color.isConstant||o)&&(t=this._materialProperty.color.getValue(n,at)),f(t)||(t=i.WHITE),e.color=r.fromColor(t)),this.clampToGround)?new a({id:u,geometry:new v(this._groundGeometryOptions),attributes:e}):(f(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof ut&&(f(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||o)&&(t=this._depthFailMaterialProperty.color.getValue(n,at)),f(t)||(t=i.WHITE),e.depthFailColor=r.fromColor(t)),new a({id:u,geometry:new p(this._geometryOptions),attributes:e}))},st.prototype.createOutlineGeometryInstance=function(){throw new s("This instance does not represent an outlined geometry.");},st.prototype.isDestroyed=function(){return!1},st.prototype.destroy=function(){this._entitySubscription();o(this)},st.prototype._onEntityPropertyChanged=function(n,t){var i,s,e,r,o,b,v;if(t==="availability"||t==="polyline"){if(i=this._entity.polyline,!f(i)){this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));return}if(s=i.positions,e=i.show,f(e)&&e.isConstant&&!e.getValue(y.MINIMUM_VALUE)||!f(s)){this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));return}var p=i.zIndex,w=u(i.material,pt),k=w instanceof ut;this._materialProperty=w;this._depthFailMaterialProperty=i.depthFailMaterial;this._showProperty=u(e,wt);this._shadowsProperty=u(i.shadows,bt);this._distanceDisplayConditionProperty=u(i.distanceDisplayCondition,kt);this._fillEnabled=!0;this._zIndex=u(p,yt);var h=i.width,c=i.followSurface,l=i.clampToGround,a=i.granularity;if(s.isConstant&&ot.isConstant(h)&&ot.isConstant(c)&&ot.isConstant(a)&&ot.isConstant(l)&&ot.isConstant(p)){if(r=this._geometryOptions,o=s.getValue(y.MINIMUM_VALUE,r.positions),!f(o)||o.length<2){this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));return}b=k&&(!f(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof ut)?nt.VERTEX_FORMAT:tt.VERTEX_FORMAT;r.vertexFormat=b;r.positions=o;r.width=f(h)?h.getValue(y.MINIMUM_VALUE):undefined;r.followSurface=f(c)?c.getValue(y.MINIMUM_VALUE):undefined;r.granularity=f(a)?a.getValue(y.MINIMUM_VALUE):undefined;v=this._groundGeometryOptions;v.positions=o;v.width=r.width;this._clampToGround=f(l)?l.getValue(y.MINIMUM_VALUE):!1;this._dynamic=!1;this._geometryChanged.raiseEvent(this)}else this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}},st.prototype.createDynamicUpdater=function(n,i){if(t.defined("primitives",n),t.defined("groundPrimitives",i),!this._dynamic)throw new s("This instance does not represent dynamic geometry.");return new ct(n,i,this)},ht={positions:undefined,granularity:undefined,height:undefined,ellipsoid:undefined},ct.prototype.update=function(n){var t=this._geometryUpdater,e=t._entity,r=e.polyline,v=r.positions,u=ot.getValueOrUndefined(v,n,this._positions),h,c,l,o,i,a,s;if(t._clampToGround=ot.getValueOrDefault(r._clampToGround,n,!1),t._groundGeometryOptions.positions=u,t._groundGeometryOptions.width=ot.getValueOrDefault(r._width,n,1),h=this._groundPrimitives,f(this._groundPolylinePrimitive)&&(h.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=undefined),t.clampToGround){if(!e.isShowing||!e.isAvailable(n)||!ot.getValueOrDefault(r._show,n,!0))return;if(!f(u)||u.length<2)return;c=t.fillMaterialProperty;c instanceof ut?l=new nt:(o=et.getValue(n,c,this._material),l=new tt({material:o,translucent:o.isTranslucent()}),this._material=o);this._groundPolylinePrimitive=h.add(new d({geometryInstances:t.createFillGeometryInstance(n),appearance:l,asynchronous:!1}),ot.getValueOrUndefined(t.zIndex,n));f(this._line)&&(this._line.show=!1);return}if(i=vt(this),!e.isShowing||!e.isAvailable(n)||!ot.getValueOrDefault(r._show,n,!0)){i.show=!1;return}if(!f(u)||u.length<2){i.show=!1;return}a=ot.getValueOrDefault(r._followSurface,n,!0);s=t._scene.globe;a&&f(s)&&(ht.ellipsoid=s.ellipsoid,ht.positions=u,ht.granularity=ot.getValueOrUndefined(r._granularity,n),ht.height=w.extractHeights(u,s.ellipsoid),u=w.generateCartesianArc(ht));i.show=!0;i.positions=u.slice();i.material=et.getValue(n,t.fillMaterialProperty,i.material);i.width=ot.getValueOrDefault(r._width,n,1);i.distanceDisplayCondition=ot.getValueOrUndefined(r._distanceDisplayCondition,n,i.distanceDisplayCondition)},ct.prototype.getBoundingSphere=function(i){var u,r,e;return(t.defined("result",i),this._geometryUpdater.clampToGround)?(r=this._groundPolylinePrimitive,f(r)&&r.show&&r.ready&&(e=r.getGeometryInstanceAttributes(this._geometryUpdater._entity),f(e)&&f(e.boundingSphere)))?(n.clone(e.boundingSphere,i),rt.DONE):f(r)&&!r.ready?rt.PENDING:rt.DONE:(u=vt(this),u.show&&u.positions.length>0)?(n.fromPoints(u.positions,i),rt.DONE):rt.FAILED},ct.prototype.isDestroyed=function(){return!1},ct.prototype.destroy=function(){var i=this._geometryUpdater,t=i._scene.id,n=lt[t];f(n)&&(n.remove(this._line),n.length===0&&(this._primitives.removeAndDestroy(n),delete lt[t]));f(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive);o(this)},st});t("DataSources/StaticGroundPolylinePerMaterialBatch",["../Core/AssociativeArray","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defined","../Core/DistanceDisplayCondition","../Core/DistanceDisplayConditionGeometryInstanceAttribute","../Core/ShowGeometryInstanceAttribute","../Scene/GroundPolylinePrimitive","../Scene/PolylineColorAppearance","../Scene/PolylineMaterialAppearance","./BoundingSphereState","./ColorMaterialProperty","./MaterialProperty","./Property"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(t,i,r){var u;u=i instanceof l?s:h;this.orderedGroundPrimitives=t;this.appearanceType=u;this.materialProperty=i;this.updaters=new n;this.createPrimitive=!0;this.primitive=undefined;this.oldPrimitive=undefined;this.geometry=new n;this.material=undefined;this.updatersWithAttributes=new n;this.attributes=new n;this.invalidated=!1;this.removeMaterialSubscription=i.definitionChanged.addEventListener(y.prototype.onMaterialChanged,this);this.subscriptions=new n;this.showsUpdated=new n;this.zIndex=r}function p(n){this._items=[];this._orderedGroundPrimitives=n}var w=new t,b=new u,k=new u;return y.prototype.onMaterialChanged=function(){this.invalidated=!0},y.prototype.isMaterial=function(n){var t=this.materialProperty,i=n.fillMaterialProperty;return i===t||i instanceof l&&t instanceof l?!0:r(t)&&t.equals(i)},y.prototype.add=function(n,t,i){var r=t.id,u;this.updaters.set(r,t);this.geometry.set(r,i);t.hasConstantFill&&t.fillMaterialProperty.isConstant&&v.isConstant(t.distanceDisplayConditionProperty)?(u=this,this.subscriptions.set(r,t.entity.definitionChanged.addEventListener(function(n,i){i==="isShowing"&&u.showsUpdated.set(t.id,t)}))):this.updatersWithAttributes.set(r,t);this.createPrimitive=!0},y.prototype.remove=function(n){var t=n.id,i;return(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t))?(this.updatersWithAttributes.remove(t),i=this.subscriptions.get(t),r(i)&&(i(),this.subscriptions.remove(t)),!0):!1},y.prototype.update=function(n){var nt=!0,s=this.primitive,y=this.orderedGroundPrimitives,et=this.geometry.values,p,ot,tt,it,st,ht,d,ut,ct,ft,g;if(this.createPrimitive)ot=et.length,ot>0?(r(s)&&(r(this.oldPrimitive)?y.remove(s):this.oldPrimitive=s),s=new o({show:!1,asynchronous:!0,geometryInstances:et,appearance:new this.appearanceType}),this.appearanceType===h&&(this.material=a.getValue(n,this.materialProperty,this.material),s.appearance.material=this.material),y.add(s,this.zIndex),nt=!1):(r(s)&&(y.remove(s),s=undefined),tt=this.oldPrimitive,r(tt)&&(y.remove(tt),this.oldPrimitive=undefined)),this.attributes.removeAll(),this.primitive=s,this.createPrimitive=!1;else if(r(s)&&s.ready){for(s.show=!0,r(this.oldPrimitive)&&(y.remove(this.oldPrimitive),this.oldPrimitive=undefined),this.appearanceType===h&&(this.material=a.getValue(n,this.materialProperty,this.material),this.primitive.appearance.material=this.material),it=this.updatersWithAttributes.values,st=it.length,p=0;p<st;p++){var l=it[p],lt=l.entity,rt=this.geometry.get(l.id),c=this.attributes.get(rt.id.id);r(c)||(c=s.getGeometryInstanceAttributes(rt.id),this.attributes.set(rt.id.id,c));l.fillMaterialProperty.isConstant||(ht=l.fillMaterialProperty.color,d=v.getValueOrDefault(ht,n,t.WHITE,w),t.equals(c._lastColor,d)||(c._lastColor=t.clone(d,c._lastColor),c.color=i.toValue(d,c.color)));ut=lt.isShowing&&(l.hasConstantFill||l.isFilled(n));ct=c.show[0]===1;ut!==ct&&(c.show=e.toValue(ut,c.show));ft=l.distanceDisplayConditionProperty;v.isConstant(ft)||(g=v.getValueOrDefault(ft,n,k,b),u.equals(g,c._lastDistanceDisplayCondition)||(c._lastDistanceDisplayCondition=u.clone(g,c._lastDistanceDisplayCondition),c.distanceDisplayCondition=f.toValue(g,c.distanceDisplayCondition)))}this.updateShows(s)}else r(s)&&!s.ready&&(nt=!1);return nt},y.prototype.updateShows=function(n){for(var f,h,o=this.showsUpdated.values,c=o.length,i=0;i<c;i++){var s=o[i],l=s.entity,u=this.geometry.get(s.id),t=this.attributes.get(u.id.id);r(t)||(t=n.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,t));f=l.isShowing;h=t.show[0]===1;f!==h&&(t.show=e.toValue(f,t.show))}this.showsUpdated.removeAll()},y.prototype.contains=function(n){return this.updaters.contains(n.id)},y.prototype.getBoundingSphere=function(n,t){var u=this.primitive,i;return u.ready?(i=u.getGeometryInstanceAttributes(n.entity),!r(i)||!r(i.boundingSphere)||r(i.show)&&i.show[0]===0)?c.FAILED:(i.boundingSphere.clone(t),c.DONE):c.PENDING},y.prototype.destroy=function(){var t=this.primitive,i=this.orderedGroundPrimitives,n;r(t)&&i.remove(t);n=this.oldPrimitive;r(n)&&i.remove(n);this.removeMaterialSubscription()},p.prototype.add=function(n,t){for(var i,f,r=this._items,s=r.length,e=t.createFillGeometryInstance(n),o=v.getValueOrDefault(t.zIndex,0),u=0;u<s;++u)if(i=r[u],i.isMaterial(t)&&i.zIndex===o){i.add(n,t,e);return}f=new y(this._orderedGroundPrimitives,t.fillMaterialProperty,o);f.add(n,t,e);r.push(f)},p.prototype.remove=function(n){for(var i,r=this._items,u=r.length,t=u-1;t>=0;t--)if(i=r[t],i.remove(n)){i.updaters.length===0&&(r.splice(t,1),i.destroy());break}},p.prototype.update=function(n){for(var i=this._items,s=i.length,r,e,o,u,f,t=s-1;t>=0;t--)if(r=i[t],r.invalidated){for(i.splice(t,1),e=r.updaters.values,o=e.length,u=0;u<o;u++)this.add(n,e[u]);r.destroy()}for(f=!0,t=0;t<i.length;t++)f=i[t].update(n)&&f;return f},p.prototype.getBoundingSphere=function(n,t){for(var r,u=this._items,f=u.length,i=0;i<f;i++)if(r=u[i],r.contains(n))return r.getBoundingSphere(n,t);return c.FAILED},p.prototype.removeAllPrimitives=function(){for(var t=this._items,i=t.length,n=0;n<i;n++)t[n].destroy();this._items.length=0},p});t("DataSources/PolylineVisualizer",["../Core/AssociativeArray","../Core/BoundingSphere","../Core/Check","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Scene/PolylineColorAppearance","../Scene/PolylineMaterialAppearance","../Scene/ShadowMode","./BoundingSphereState","./ColorMaterialProperty","./DynamicGeometryBatch","./PolylineGeometryUpdater","./StaticGeometryColorBatch","./StaticGeometryPerMaterialBatch","./StaticGroundPolylinePerMaterialBatch"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function b(n,t){for(var r=n._batches,u=r.length,i=0;i<u;i++)r[i].remove(t)}function k(n,t,i){var r,f,e;if(i.isDynamic){n._dynamicBatch.add(t,i);return}if(i.clampToGround&&i.fillEnabled){n._groundBatch.add(t,i);return}i.fillEnabled&&(r=i.shadowsProperty.getValue(t));f=0;u(i.depthFailMaterialProperty)&&(f=i.depthFailMaterialProperty instanceof c?1:2);u(r)&&(e=r+f*s.NUMBER_OF_SHADOW_MODES);i.fillEnabled&&(i.fillMaterialProperty instanceof c?n._colorBatches[e].add(t,i):n._materialBatches[e].add(t,i))}function w(t,u,f,h){var a,c;for(i.defined("scene",t),i.defined("entityCollection",u),h=r(h,t.groundPrimitives),f=r(f,t.primitives),this._scene=t,this._primitives=f,this._entityCollection=undefined,this._addedObjects=new n,this._removedObjects=new n,this._changedObjects=new n,a=s.NUMBER_OF_SHADOW_MODES,this._colorBatches=new Array(a*3),this._materialBatches=new Array(a*3),c=0;c<a;++c)this._colorBatches[c]=new v(f,e,undefined,!1,c),this._materialBatches[c]=new y(f,o,undefined,!1,c),this._colorBatches[c+a]=new v(f,e,e,!1,c),this._materialBatches[c+a]=new y(f,o,e,!1,c),this._colorBatches[c+a*2]=new v(f,e,o,!1,c),this._materialBatches[c+a*2]=new y(f,o,o,!1,c);this._dynamicBatch=new l(f,h);this._groundBatch=new p(h);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatch);this._subscriptions=new n;this._updaters=new n;this._entityCollection=u;u.collectionChanged.addEventListener(w.prototype._onCollectionChanged,this);this._onCollectionChanged(u,u.values,nt)}var nt=[],d,g;return w.prototype.update=function(n){i.defined("time",n);for(var h=this._addedObjects,e=h.values,c=this._removedObjects,o=c.values,l=this._changedObjects,v=l.values,u,f,r,t=v.length-1;t>-1;t--)u=v[t],f=u.id,r=this._updaters.get(f),r.entity===u?(b(this,r),k(this,n,r)):(o.push(u),e.push(u));for(t=o.length-1;t>-1;t--)u=o[t],f=u.id,r=this._updaters.get(f),b(this,r),r.destroy(),this._updaters.remove(f),this._subscriptions.get(f)(),this._subscriptions.remove(f);for(t=e.length-1;t>-1;t--)u=e[t],f=u.id,r=new a(u,this._scene),this._updaters.set(f,r),k(this,n,r),this._subscriptions.set(f,r.geometryChanged.addEventListener(w._onGeometryChanged,this));h.removeAll();c.removeAll();l.removeAll();var s=!0,y=this._batches,p=y.length;for(t=0;t<p;t++)s=y[t].update(n)&&s;return s},d=[],g=new t,w.prototype.getBoundingSphere=function(n,r){var e;i.defined("entity",n);i.defined("result",r);var f=d,s=g,u=0,o=h.DONE,c=this._batches,l=c.length,a=this._updaters.get(n.id);for(e=0;e<l;e++){if(o=c[e].getBoundingSphere(a,s),o===h.PENDING)return h.PENDING;o===h.DONE&&(f[u]=t.clone(s,f[u]),u++)}return u===0?h.FAILED:(f.length=u,t.fromBoundingSpheres(f,r),h.DONE)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){var n,i,t,r;for(this._entityCollection.collectionChanged.removeEventListener(w.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll(),i=this._batches,t=i.length,n=0;n<t;n++)i[n].removeAllPrimitives();for(r=this._subscriptions.values,t=r.length,n=0;n<t;n++)r[n]();return this._subscriptions.removeAll(),f(this)},w._onGeometryChanged=function(n){var f=this._removedObjects,i=this._changedObjects,r=n.entity,t=r.id;u(f.get(t))||u(i.get(t))||i.set(t,r)},w.prototype._onCollectionChanged=function(n,t,i){for(var e=this._addedObjects,o=this._removedObjects,s=this._changedObjects,u,f,r=i.length-1;r>-1;r--)f=i[r],u=f.id,e.remove(u)||(o.set(u,f),s.remove(u));for(r=t.length-1;r>-1;r--)f=t[r],u=f.id,o.remove(u)?s.set(u,f):e.set(u,f)},w});t("DataSources/DataSourceDisplay",["../Core/ApproximateTerrainHeights","../Core/BoundingSphere","../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/EventHelper","../Scene/GroundPolylinePrimitive","../Scene/GroundPrimitive","../Scene/OrderedGroundPrimitiveCollection","../Scene/PrimitiveCollection","./BillboardVisualizer","./BoundingSphereState","./CustomDataSource","./GeometryVisualizer","./LabelVisualizer","./ModelVisualizer","./PathVisualizer","./PointVisualizer","./PolylineVisualizer"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";function nt(n){var u,t,f,d,e,v,p,w,b;i.typeOf.object("options",n);i.typeOf.object("options.scene",n.scene);i.typeOf.object("options.dataSourceCollection",n.dataSourceCollection);h.initializeTerrainHeights();s.initializeTerrainHeights();u=n.scene;t=n.dataSourceCollection;this._eventHelper=new o;this._eventHelper.add(t.dataSourceAdded,this._onDataSourceAdded,this);this._eventHelper.add(t.dataSourceRemoved,this._onDataSourceRemoved,this);this._eventHelper.add(t.dataSourceMoved,this._onDataSourceMoved,this);this._dataSourceCollection=t;this._scene=u;this._visualizersCallback=r(n.visualizersCallback,nt.defaultVisualizersCallback);var k=!1,c=new l,a=new l;for(t.length>0&&(u.primitives.add(c),u.groundPrimitives.add(a),k=!0),this._primitives=c,this._groundPrimitives=a,f=0,d=t.length;f<d;f++)this._onDataSourceAdded(t,t.get(f));e=new y;this._onDataSourceAdded(undefined,e);this._defaultDataSource=e;k||(w=this,b=function(){u.primitives.add(c);u.groundPrimitives.add(a);v();p();w._removeDefaultDataSoureListener=undefined;w._removeDataSourceCollectionListener=undefined},v=e.entities.collectionChanged.addEventListener(b),p=t.dataSourceAdded.addEventListener(b));this._removeDefaultDataSoureListener=v;this._removeDataSourceCollectionListener=p;this._ready=!1}nt.defaultVisualizersCallback=function(n,t,i){var r=i.entities;return[new a(t,r),new p(n,r,i._primitives,i._groundPrimitives),new w(t,r),new b(n,r),new d(t,r),new k(n,r),new g(n,r,i._primitives,i._groundPrimitives)]};f(nt.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}});nt.prototype.isDestroyed=function(){return!1};nt.prototype.destroy=function(){var t,n,i;for(this._eventHelper.removeAll(),t=this._dataSourceCollection,n=0,i=t.length;n<i;++n)this._onDataSourceRemoved(this._dataSourceCollection,t.get(n));return this._onDataSourceRemoved(undefined,this._defaultDataSource),u(this._removeDefaultDataSoureListener)?(this._removeDefaultDataSoureListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives)),e(this)};nt.prototype.update=function(t){var h;if(i.defined("time",t),!n.initialized)return this._ready=!1,!1;for(var r=!0,f,e,s,c=this._dataSourceCollection,l=c.length,o=0;o<l;o++)for(h=c.get(o),u(h.update)&&(r=h.update(t)&&r),e=h._visualizers,s=e.length,f=0;f<s;f++)r=e[f].update(t)&&r;for(e=this._defaultDataSource._visualizers,s=e.length,f=0;f<s;f++)r=e[f].update(t)&&r;return this._ready=r,r};var tt=[],it=new t;return nt.prototype.getBoundingSphere=function(n,r,f){var e,p,o,c,l,b;if(i.defined("entity",n),i.typeOf.bool("allowPartial",r),i.defined("result",f),!this._ready)return v.PENDING;if(o=this._defaultDataSource,!o.entities.contains(n))for(o=undefined,c=this._dataSourceCollection,p=c.length,e=0;e<p;e++)if(l=c.get(e),l.entities.contains(n)){o=l;break}if(!u(o))return v.FAILED;var h=tt,w=it,s=0,a=v.DONE,y=o._visualizers,k=y.length;for(e=0;e<k;e++)if(b=y[e],u(b.getBoundingSphere))if(a=y[e].getBoundingSphere(n,w),r||a!==v.PENDING)a===v.DONE&&(h[s]=t.clone(w,h[s]),s++);else return v.PENDING;return s===0?v.FAILED:(h.length=s,t.fromBoundingSpheres(h,f),v.DONE)},nt.prototype._onDataSourceAdded=function(n,t){var r=this._scene,f=this._primitives,e=this._groundPrimitives,u=f.add(new l),o=e.add(new c),i;t._primitives=u;t._groundPrimitives=o;i=t.clustering;i._initialize(r);u.add(i);t._visualizers=this._visualizersCallback(r,i,t)},nt.prototype._onDataSourceRemoved=function(n,t){var e=this._primitives,o=this._groundPrimitives,u=t._primitives,s=t._groundPrimitives,h=t.clustering,r,f,i;for(u.remove(h),r=t._visualizers,f=r.length,i=0;i<f;i++)r[i].destroy();e.remove(u);o.remove(s);t._visualizers=undefined},nt.prototype._onDataSourceMoved=function(n,t,i){var r=this._primitives,u=this._groundPrimitives,f=n._primitives,e=n._groundPrimitives;t===i+1?(r.raise(f),u.raise(e)):t===i-1?(r.lower(f),u.lower(e)):t===0?(r.lowerToBottom(f),u.lowerToBottom(e),r.raise(f),u.raise(e)):(r.raiseToTop(f),u.raiseToTop(e))},nt});t("DataSources/EntityView",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Ellipsoid","../Core/HeadingPitchRange","../Core/JulianDate","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/Transforms","../Scene/SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function ot(t,i,u,f,e,c,y){var gt=t.scene.mode,ht=e.getValue(c,t._lastCartesian),pt,bt,ot,ut,st,ct,vt,lt,at,wt,yt,ri,kt,dt,p,ui;if(r(ht)){if(pt=!1,bt=!1,gt===a.SCENE3D&&(o.addSeconds(c,.001,v),ct=e.getValue(v,w),r(ct)||(o.addSeconds(c,-.001,v),ct=e.getValue(v,w),bt=!0),r(ct))){vt=l.computeFixedToIcrfMatrix(c,d);lt=l.computeFixedToIcrfMatrix(v,g);r(vt)&&r(lt)?at=h.transpose(vt,nt):(at=l.computeTemeToPseudoFixedMatrix(c,nt),vt=h.transpose(at,d),lt=l.computeTemeToPseudoFixedMatrix(v,g),h.transpose(lt,lt));wt=h.multiplyByVector(vt,ht,it);yt=h.multiplyByVector(lt,ct,rt);n.subtract(wt,yt,k);var ni=n.magnitude(k)*1e3,ti=s.GRAVITATIONALPARAMETER,ii=-ti/(ni*ni-2*ti/n.magnitude(wt));ii<0||ii>et*y.maximumRadius?(ot=tt,n.normalize(ht,ot),n.negate(ot,ot),st=n.clone(n.UNIT_Z,b),ut=n.cross(st,ot,w),n.magnitude(ut)>s.EPSILON7&&(n.normalize(ot,ot),n.normalize(ut,ut),st=n.cross(ot,ut,b),n.normalize(st,st),pt=!0)):n.equalsEpsilon(ht,ct,s.EPSILON7)||(st=tt,n.normalize(wt,st),n.normalize(yt,yt),ut=n.cross(st,yt,b),bt&&(ut=n.multiplyByScalar(ut,-1,ut)),n.equalsEpsilon(ut,n.ZERO,s.EPSILON7)||(ot=n.cross(ut,st,w),h.multiplyByVector(at,ot,ot),h.multiplyByVector(at,ut,ut),h.multiplyByVector(at,st,st),n.normalize(ot,ot),n.normalize(ut,ut),n.normalize(st,st),pt=!0))}r(t.boundingSphere)&&(ht=t.boundingSphere.center);f&&(ri=n.clone(i.position,k),kt=n.clone(i.direction,it),dt=n.clone(i.up,rt));p=ft;pt?(p[0]=ot.x,p[1]=ot.y,p[2]=ot.z,p[3]=0,p[4]=ut.x,p[5]=ut.y,p[6]=ut.z,p[7]=0,p[8]=st.x,p[9]=st.y,p[10]=st.z,p[11]=0,p[12]=ht.x,p[13]=ht.y,p[14]=ht.z,p[15]=0):l.eastNorthUpToFixedFrame(ht,y,p);i._setTransform(p);f&&(n.clone(ri,i.position),n.clone(kt,i.direction),n.clone(dt,i.up),n.cross(kt,dt,i.right))}u&&(ui=gt===a.SCENE2D||n.equals(t._offset3D,n.ZERO)?undefined:t._offset3D,i.lookAtTransform(i.transform,ui))}function y(r,u,e){t.defined("entity",r);t.defined("scene",u);this.entity=r;this.scene=u;this.ellipsoid=i(e,f.WGS84);this.boundingSphere=undefined;this._lastEntity=undefined;this._mode=undefined;this._lastCartesian=new n;this._defaultOffset3D=undefined;this._offset3D=new n}var d=new h,g=new h,nt=new h,ft=new c,w=new n,tt=new n,b=new n,k=new n,it=new n,rt=new n,v=new o,et=1.25,p,ut;return u(y,{defaultOffset3D:{get:function(){return this._defaultOffset3D},set:function(t){this._defaultOffset3D=n.clone(t,new n)}}}),y.defaultOffset3D=new n(-14e3,3500,3500),p=new e,ut=new n,y.prototype.update=function(i,u){var f,e,c,l,v,tt;t.defined("time",i);var w=this.scene,b=this.ellipsoid,o=w.mode;if(o!==a.MORPHING&&(f=this.entity,e=f.position,r(e))){var k=f!==this._lastEntity,d=o!==this._mode,h=w.camera,g=k||d,nt=!0;k?(c=f.viewFrom,l=r(c),!l&&r(u)?(p.pitch=-s.PI_OVER_FOUR,p.range=0,v=e.getValue(i,ut),r(v)&&(tt=2-1/Math.max(1,n.magnitude(v)/b.maximumRadius),p.pitch*=tt),h.viewBoundingSphere(u,p),this.boundingSphere=u,g=!1,nt=!1):l&&r(c.getValue(i,this._offset3D))||n.clone(y._defaultOffset3D,this._offset3D)):d||this._mode===a.SCENE2D||n.clone(h.position,this._offset3D);this._lastEntity=f;this._mode=o;ot(this,h,g,nt,e,i,b)}},y});!function(){function f(n,t){function s(t){var r=n.arcs[t<0?~t:t],u=r[0],i;return n.transform?(i=[0,0],r.forEach(function(n){i[0]+=n[0];i[1]+=n[1]})):i=r[r.length-1],t<0?[i,u]:[u,i]}function o(n,t){var r,i;for(r in n)i=n[r],delete t[i.start],delete i.start,delete i.end,i.forEach(function(n){f[n<0?~n:n]=1}),u.push(i)}var f={},i={},r={},u=[],e=-1;return t.forEach(function(i,r){var u=n.arcs[i<0?~i:i],f;u.length<3&&!u[1][0]&&!u[1][1]&&(f=t[++e],t[e]=i,t[r]=f)}),t.forEach(function(n){var c=s(n),f=c[0],e=c[1],t,u,o,h;(t=r[f])?(delete r[t.end],t.push(n),t.end=e,(u=i[e])?(delete i[u.start],o=u===t?t:t.concat(u),i[o.start=t.start]=r[o.end=u.end]=o):i[t.start]=r[t.end]=t):(t=i[e])?(delete i[t.start],t.unshift(n),t.start=f,(u=r[f])?(delete r[u.end],h=u===t?t:u.concat(t),i[h.start=u.start]=r[h.end=t.end]=h):i[t.start]=r[t.end]=t):(t=[n],i[t.start=f]=r[t.end=e]=t)}),o(r,i),o(i,r),t.forEach(function(n){f[n<0?~n:n]||u.push([n])}),u}function e(n,t,i){var r=[],u,h,s,e,a;if(arguments.length>1){u=[];function v(n){var t=n<0?~n:n;(u[t]||(u[t]=[])).push({i:n,g:h})}function c(n){n.forEach(v)}function o(n){n.forEach(c)}function l(n){n.type==="GeometryCollection"?n.geometries.forEach(l):n.type in s&&(h=n,s[n.type](n.arcs))}s={LineString:c,MultiLineString:o,Polygon:o,MultiPolygon:function(n){n.forEach(o)}};l(t);u.forEach(arguments.length<3?function(n){r.push(n[0].i)}:function(n){i(n[0].g,n[n.length-1].g)&&r.push(n[0].i)})}else for(e=0,a=n.arcs.length;e<a;++e)r.push(e);return{type:"MultiLineString",arcs:f(n,r)}}function o(t,r){function s(n){n.forEach(function(t){t.forEach(function(t){(u[t=t<0?~t:t]||(u[t]=[])).push(n)})});e.push(n)}function h(n){return w(i(t,{type:"Polygon",arcs:[n]}).coordinates[0])>0}var u={},e=[],o=[];return r.forEach(function(n){n.type==="Polygon"?s(n.arcs):n.type==="MultiPolygon"&&n.arcs.forEach(s)}),e.forEach(function(n){if(!n._){var t=[],i=[n];for(n._=1,o.push(t);n=i.pop();)t.push(n),n.forEach(function(n){n.forEach(function(n){u[n<0?~n:n].forEach(function(n){n._||(n._=1,i.push(n))})})})}}),e.forEach(function(n){delete n._}),{type:"MultiPolygon",arcs:o.map(function(i){var r=[],o,e,s;if(i.forEach(function(n){n.forEach(function(n){n.forEach(function(n){u[n<0?~n:n].length<2&&r.push(n)})})}),r=f(t,r),(n=r.length)>1)for(o=h(i[0][0]),e=0;e<n;++e)if(o===h(r[e])){s=r[0];r[0]=r[e];r[e]=s;break}return r})}}function a(n,t){return t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(t){return s(n,t)})}:s(n,t)}function s(n,t){var r={type:"Feature",id:t.id,properties:t.properties||{},geometry:i(n,t)};return t.id==null&&delete r.id,r}function i(n,t){function h(n,t){t.length&&t.pop();for(var u=s[n<0?~n:n],i=0,f=u.length,e;i<f;++i)t.push(e=u[i].slice()),r(e,i);n<0&&v(t,f)}function u(n){return n=n.slice(),r(n,0),n}function i(n){for(var t=[],i=0,r=n.length;i<r;++i)h(n[i],t);return t.length<2&&t.push(t[0].slice()),t}function l(n){for(var t=i(n);t.length<4;)t.push(t[0].slice());return t}function f(n){return n.map(l)}function e(n){var t=n.type;return t==="GeometryCollection"?{type:t,geometries:n.geometries.map(e)}:t in o?{type:t,coordinates:o[t](n)}:null}var r=c(n.transform),s=n.arcs,o={Point:function(n){return u(n.coordinates)},MultiPoint:function(n){return n.coordinates.map(u)},LineString:function(n){return i(n.arcs)},MultiLineString:function(n){return n.arcs.map(i)},Polygon:function(n){return f(n.arcs)},MultiPolygon:function(n){return n.arcs.map(f)}};return e(t)}function v(n,t){for(var u,i=n.length,r=i-t;r<--i;)u=n[r],n[r++]=n[i],n[i]=u}function h(n,t){for(var i=0,u=n.length,r;i<u;)r=i+u>>>1,n[r]<t?i=r+1:u=r;return i}function y(n){function a(n,t){n.forEach(function(n){n<0&&(n=~n);var i=f[n];i?i.push(t):f[n]=[t]})}function c(n,t){n.forEach(function(n){a(n,t)})}function v(n,t){n.type==="GeometryCollection"?n.geometries.forEach(function(n){v(n,t)}):n.type in y&&y[n.type](n.arcs,t)}var f={},s=n.map(function(){return[]}),y={LineString:a,MultiLineString:c,Polygon:c,MultiPolygon:function(n,t){n.forEach(function(n){c(n,t)})}},t,o,r,u,i;n.forEach(v);for(t in f)for(var l=f[t],p=l.length,e=0;e<p;++e)for(o=e+1;o<p;++o)r=l[e],u=l[o],(i=s[r])[t=h(i,u)]!==u&&i.splice(t,0,u),(i=s[u])[t=h(i,r)]!==r&&i.splice(t,0,r);return s}function p(n,t){function r(n){i.remove(n);n[1][2]=t(n);i.push(n)}var u=c(n.transform),f=d(n.transform),i=k();return t||(t=b),n.arcs.forEach(function(n){for(var s,h,c=[],a=0,e,o=0,l=n.length,v;o<l;++o)v=n[o],u(n[o]=[v[0],v[1],Infinity],o);for(o=1,l=n.length-1;o<l;++o)e=n.slice(o-1,o+2),e[1][2]=t(e),c.push(e),i.push(e);for(o=0,l=c.length;o<l;++o)e=c[o],e.previous=c[o-1],e.next=c[o+1];while(e=i.pop())s=e.previous,h=e.next,e[1][2]<a?e[1][2]=a:a=e[1][2],s&&(s.next=h,s[2]=e[2],r(s)),h&&(h.previous=s,h[0]=e[0],r(h));n.forEach(f)}),n}function w(n){for(var r=-1,u=n.length,i,t=n[u-1],f=0;++r<u;)i=t,t=n[r],f+=i[0]*t[1]-i[1]*t[0];return f*.5}function b(n){var t=n[0],i=n[1],r=n[2];return Math.abs((t[0]-r[0])*(i[1]-t[1])-(t[0]-i[0])*(r[1]-t[1]))}function r(n,t){return n[1][2]-t[1][2]}function k(){function u(t,i){while(i>0){var f=(i+1>>1)-1,u=n[f];if(r(t,u)>=0)break;n[u._=i]=u;n[t._=i=f]=t}}function f(i,u){for(;;){var o=u+1<<1,s=o-1,e=u,f=n[e];if(s<t&&r(n[s],f)<0&&(f=n[e=s]),o<t&&r(n[o],f)<0&&(f=n[e=o]),e===u)break;n[f._=u]=f;n[i._=u=e]=i}}var i={},n=[],t=0;return i.push=function(i){return u(n[i._=t]=i,t++),t},i.pop=function(){if(!(t<=0)){var r=n[0],i;return--t>0&&(i=n[t],f(n[i._=0]=i,0)),r}},i.remove=function(i){var e=i._,o;if(n[e]===i)return e!==--t&&(o=n[t],(r(o,i)<0?u:f)(n[o._=e]=o,e)),e},i}function c(n){if(!n)return l;var t,i,r=n.scale[0],u=n.scale[1],f=n.translate[0],e=n.translate[1];return function(n,o){o||(t=i=0);n[0]=(t+=n[0])*r+f;n[1]=(i+=n[1])*u+e}}function d(n){if(!n)return l;var t,i,r=n.scale[0],u=n.scale[1],f=n.translate[0],e=n.translate[1];return function(n,o){o||(t=i=0);var s=(n[0]-f)/r|0,h=(n[1]-e)/u|0;n[0]=s-t;n[1]=h-i;t=s;i=h}}function l(){}var u={version:"1.6.18",mesh:function(n){return i(n,e.apply(this,arguments))},meshArcs:e,merge:function(n){return i(n,o.apply(this,arguments))},mergeArcs:o,feature:a,neighbors:y,presimplify:p};typeof t=="function"&&t.amd?t("ThirdParty/topojson",u):typeof module=="object"&&module.exports?module.exports=u:this.topojson=u}();t("DataSources/GeoJsonDataSource",["../Core/Cartesian3","../Core/Color","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/getFilenameFromUri","../Core/PinBuilder","../Core/PolygonHierarchy","../Core/Resource","../Core/RuntimeError","../Scene/HeightReference","../Scene/VerticalOrigin","../ThirdParty/topojson","../ThirdParty/when","./BillboardGraphics","./CallbackProperty","./ColorMaterialProperty","./ConstantPositionProperty","./ConstantProperty","./DataSource","./EntityCluster","./EntityCollection","./PolygonGraphics","./PolylineGraphics"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function ot(t){return n.fromDegrees(t[0],t[1],t[2])}function gt(n,t){var r="",i,f;for(i in n)if(n.hasOwnProperty(i)){if(i===t||pi.indexOf(i)!==-1)continue;f=n[i];u(f)&&(r+=typeof f=="object"?"<tr><th>"+i+"<\/th><td>"+gt(f)+"<\/td><\/tr>":"<tr><th>"+i+"<\/th><td>"+f+"<\/td><\/tr>")}return r.length>0&&(r='<table class="cesium-infoBox-defaultTable"><tbody>'+r+"<\/tbody><\/table>"),r}function wi(n,t,i){var r;return function(){return u(r)||(r=n(t,i)),r}}function bi(n,t){return new k(wi(gt,n,t),!0)}function st(n,t,r){var h=n.id,v,l,c,f,s,y,o,e,p,a;if(u(h)&&n.type==="Feature"){for(v=2,l=h;u(t.getById(l));)l=h+"_"+v,v++;h=l}else h=i();if(c=t.getOrCreateEntity(h),f=n.properties,u(f)){if(c.properties=f,y=f.title,u(y))c.name=y,s="title";else{o=Number.MAX_VALUE;for(e in f)if(f.hasOwnProperty(e)&&f[e])if(p=e.toLowerCase(),o>1&&p==="title"){o=1;s=e;break}else o>2&&p==="name"?(o=2,s=e):o>3&&/title/i.test(e)?(o=3,s=e):o>4&&/name/i.test(e)&&(o=4,s=e);u(s)&&(c.name=f[s])}a=f.description;a!==null&&(c.description=u(a)?new nt(a):r(f,s))}return c}function bt(n,t){for(var r=new Array(n.length),i=0;i<n.length;i++)r[i]=t(n[i]);return r}function ii(n,t,i,r,f){if(t.geometry===null){st(t,n._entityCollection,f.describe);return}if(!u(t.geometry))throw new a("feature.geometry is required.");var e=t.geometry.type,o=ti[e];if(!u(o))throw new a("Unknown geometry type: "+e);o(n,t,t.geometry,r,f)}function ki(n,t,i,r,u){for(var e=t.features,f=0,o=e.length;f<o;f++)ii(n,e[f],undefined,r,u)}function ri(n,t,i,r,f){for(var o=i.geometries,e=0,l=o.length;e<l;e++){var s=o[e],h=s.type,c=ti[h];if(!u(c))throw new a("Unknown geometry type: "+h);c(n,t,s,r,f)}}function ui(n,i,f,e,o){var c=o.markerSymbol,l=o.markerColor,s=o.markerSize,a=i.properties,p,k,tt,h,d,it;u(a)&&(p=a["marker-color"],u(p)&&(l=t.fromCssColorString(p)),s=r(yi[a["marker-size"]],s),k=a["marker-symbol"],u(k)&&(c=k));tt=u(c)?c.length===1?n._pinBuilder.fromText(c.toUpperCase(),l,s):n._pinBuilder.fromMakiIconId(c,l,s):n._pinBuilder.fromColor(l,s);h=new b;h.verticalOrigin=new nt(y.BOTTOM);e.length===2&&o.clampToGround&&(h.heightReference=v.CLAMP_TO_GROUND);d=st(i,n._entityCollection,o.describe);d.billboard=h;d.position=new g(f(e));it=w(tt).then(function(n){h.image=new nt(n)}).otherwise(function(){h.image=new nt(n._pinBuilder.fromColor(l,s))});n._promises.push(it)}function fi(n,t,i,r,u){ui(n,t,r,i.coordinates,u)}function ei(n,t,i,r,u){for(var e=i.coordinates,f=0;f<e.length;f++)ui(n,t,r,e[f],u)}function oi(n,i,r,f,e){var l=e.strokeMaterialProperty,y=e.strokeWidthProperty,h=i.properties,a,o,v,c,p,s;u(h)&&(a=h["stroke-width"],u(a)&&(y=new nt(a)),v=h.stroke,u(v)&&(o=t.fromCssColorString(v)),c=h["stroke-opacity"],u(c)&&c!==1&&(u(o)||(o=l.color.clone()),o.alpha=c),u(o)&&(l=new d(o)));p=st(i,n._entityCollection,e.describe);s=new ft;p.polyline=s;s.clampToGround=e.clampToGround;s.material=l;s.width=y;s.positions=new nt(bt(f,r))}function si(n,t,i,r,u){oi(n,t,r,i.coordinates,u)}function hi(n,t,i,r,u){for(var e=i.coordinates,f=0;f<e.length;f++)oi(n,t,r,e[f],u)}function ci(n,i,r,f,e){var p,a,w,s,h,b,o,k,y,rt,g,ft;if(f.length!==0&&f[0].length!==0){var tt=e.strokeMaterialProperty.color,v=e.fillMaterialProperty,it=e.strokeWidthProperty,l=i.properties;for(u(l)&&(p=l["stroke-width"],u(p)&&(it=new nt(p)),w=l.stroke,u(w)&&(a=t.fromCssColorString(w)),s=l["stroke-opacity"],u(s)&&s!==1&&(u(a)||(a=e.strokeMaterialProperty.color.clone()),a.alpha=s),u(a)&&(tt=new nt(a)),b=l.fill,u(b)&&(h=t.fromCssColorString(b),h.alpha=v.color.alpha),s=l["fill-opacity"],u(s)&&s!==v.color.alpha&&(u(h)||(h=v.color.clone()),h.alpha=s),u(h)&&(v=new d(h))),o=new ut,o.outline=new nt(!0),o.outlineColor=tt,o.outlineWidth=it,o.material=v,k=[],y=1,rt=f.length;y<rt;y++)k.push(new c(bt(f[y],r)));g=f[0];o.hierarchy=new nt(new c(bt(g,r),k));g[0].length>2?o.perPositionHeight=new nt(!0):e.clampToGround||(o.height=0);ft=st(i,n._entityCollection,e.describe);ft.polygon=o}}function li(n,t,i,r,u){ci(n,t,r,i.coordinates,u)}function ai(n,t,i,r,u){for(var e=i.coordinates,f=0;f<e.length;f++)ci(n,t,r,e[f],u)}function vi(n,t,i,r,u){var e,f,o;for(e in i.objects)i.objects.hasOwnProperty(e)&&(f=p.feature(i,i.objects[e]),o=ni[f.type],o(n,f,f,r,u))}function et(n){this._name=n;this._changed=new o;this._error=new o;this._isLoading=!1;this._loading=new o;this._entityCollection=new rt(this);this._promises=[];this._pinBuilder=new h;this._entityCluster=new it}function di(n,t,i,r){var c,l,f,o,e,h;if(u(r)&&(c=s(r)),u(c)&&n._name!==c&&(n._name=c,n._changed.raiseEvent(n)),l=ni[t.type],!u(l))throw new a("Unsupported GeoJSON object type: "+t.type);if(f=t.crs,o=f!==null?ot:null,u(f)){if(!u(f.properties))throw new a("crs.properties is undefined.");if(e=f.properties,f.type==="name"){if(o=ht[e.name],!u(o))throw new a("Unknown crs name: "+e.name);}else if(f.type==="link"){if(h=kt[e.href],u(h)||(h=dt[e.type]),!u(h))throw new a("Unable to resolve crs link: "+JSON.stringify(e));o=h(e)}else if(f.type==="EPSG"){if(o=ht["EPSG:"+e.code],!u(o))throw new a("Unknown crs EPSG code: "+e.code);}else throw new a("Unknown crs type: "+f.type);}return w(o,function(r){return n._entityCollection.removeAll(),r!==null&&l(n,t,t,r,i),w.all(n._promises,function(){return n._promises.length=0,tt.setLoading(n,!1),n})})}var ht={"urn:ogc:def:crs:OGC:1.3:CRS84":ot,"EPSG:4326":ot,"urn:ogc:def:crs:EPSG::4326":ot},kt={},dt={},ct=48,lt,at=t.ROYALBLUE,vt=t.YELLOW,yt=2,pt=t.fromBytes(255,255,0,100),wt=!1,yi={small:24,medium:48,large:64},pi=["title","description","marker-size","marker-symbol","marker-color","stroke","stroke-opacity","stroke-width","fill","fill-opacity"],ni={Feature:ii,FeatureCollection:ki,GeometryCollection:ri,LineString:si,MultiLineString:hi,MultiPoint:ei,MultiPolygon:ai,Point:fi,Polygon:li,Topology:vi},ti={GeometryCollection:ri,LineString:si,MultiLineString:hi,MultiPoint:ei,MultiPolygon:ai,Point:fi,Polygon:li,Topology:vi};return et.load=function(n,t){return(new et).load(n,t)},f(et,{markerSize:{get:function(){return ct},set:function(n){ct=n}},markerSymbol:{get:function(){return lt},set:function(n){lt=n}},markerColor:{get:function(){return at},set:function(n){at=n}},stroke:{get:function(){return vt},set:function(n){vt=n}},strokeWidth:{get:function(){return yt},set:function(n){yt=n}},fill:{get:function(){return pt},set:function(n){pt=n}},clampToGround:{get:function(){return wt},set:function(n){wt=n}},crsNames:{get:function(){return ht}},crsLinkHrefs:{get:function(){return kt}},crsLinkTypes:{get:function(){return dt}}}),f(et.prototype,{name:{get:function(){return this._name},set:function(n){this._name!==n&&(this._name=n,this._changed.raiseEvent(this))}},clock:{value:undefined,writable:!1},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(n){this._entityCollection.show=n}},clustering:{get:function(){return this._entityCluster},set:function(n){if(!u(n))throw new e("value must be defined.");this._entityCluster=n}}}),et.prototype.load=function(n,t){var o,f,i;if(!u(n))throw new e("data is required.");return tt.setLoading(this,!0),o=n,t=r(t,r.EMPTY_OBJECT),f=t.sourceUri,(typeof n=="string"||n instanceof l)&&(n=l.createIfNeeded(n),o=n.fetchJson(),f=r(f,n.getUrlComponent())),t={describe:r(t.describe,bi),markerSize:r(t.markerSize,ct),markerSymbol:r(t.markerSymbol,lt),markerColor:r(t.markerColor,at),strokeWidthProperty:new nt(r(t.strokeWidth,yt)),strokeMaterialProperty:new d(r(t.stroke,vt)),fillMaterialProperty:new d(r(t.fill,pt)),clampToGround:r(t.clampToGround,wt)},i=this,w(o,function(n){return di(i,n,t,f)}).otherwise(function(n){return tt.setLoading(i,!1),i._error.raiseEvent(i,n),console.log(n),w.reject(n)})},et});t("DataSources/KmlCamera",[],function(){"use strict";function n(n,t){this.position=n;this.headingPitchRoll=t}return n}),function(n,i){typeof t=="function"&&t.amd?t("ThirdParty/Autolinker",[],function(){return n.Autolinker=i()}):typeof exports=="object"?module.exports=i():n.Autolinker=i()}(this,function(){var n=function(t){n.Util.assign(this,t);var i=this.hashtag;if(i!==!1&&i!=="twitter"&&i!=="facebook")throw new Error("invalid `hashtag` cfg - see docs");};return n.prototype={constructor:n,urls:!0,email:!0,twitter:!0,phone:!0,hashtag:!1,newWindow:!0,stripPrefix:!0,truncate:undefined,className:"",htmlParser:undefined,matchParser:undefined,tagBuilder:undefined,link:function(n){for(var s,h=this.getHtmlParser(),o=h.parse(n),i=0,t=[],f=0,c=o.length;f<c;f++){var r=o[f],e=r.getType(),u=r.getText();e==="element"?(r.getTagName()==="a"&&(r.isClosing()?i=Math.max(i-1,0):i++),t.push(u)):e==="entity"||e==="comment"?t.push(u):i===0?(s=this.linkifyStr(u),t.push(s)):t.push(u)}return t.join("")},linkifyStr:function(n){return this.getMatchParser().replace(n,this.createMatchReturnVal,this)},createMatchReturnVal:function(t){var i,r,u;return this.replaceFn&&(i=this.replaceFn.call(this,this,t)),typeof i=="string"?i:i===!1?t.getMatchedText():i instanceof n.HtmlTag?i.toAnchorString():(r=this.getTagBuilder(),u=r.build(t),u.toAnchorString())},getHtmlParser:function(){var t=this.htmlParser;return t||(t=this.htmlParser=new n.htmlParser.HtmlParser),t},getMatchParser:function(){var t=this.matchParser;return t||(t=this.matchParser=new n.matchParser.MatchParser({urls:this.urls,email:this.email,twitter:this.twitter,phone:this.phone,hashtag:this.hashtag,stripPrefix:this.stripPrefix})),t},getTagBuilder:function(){var t=this.tagBuilder;return t||(t=this.tagBuilder=new n.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),t}},n.link=function(t,i){var r=new n(i);return r.link(t)},n.match={},n.htmlParser={},n.matchParser={},n.Util={abstractMethod:function(){throw"abstract";},trimRegex:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,assign:function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},extend:function(t,i){var f=t.prototype,e=function(){},r,u;return e.prototype=f,r=i.hasOwnProperty("constructor")?i.constructor:function(){f.constructor.apply(this,arguments)},u=r.prototype=new e,u.constructor=r,u.superclass=f,delete i.constructor,n.Util.assign(u,i),r},ellipsis:function(n,t,i){return n.length>t&&(i=i==null?"..":i,n=n.substring(0,t-i.length)+i),n},indexOf:function(n,t){if(Array.prototype.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},splitAndCapture:function(n,t){if(!t.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var r=[],u=0,i;i=t.exec(n);)r.push(n.substring(u,i.index)),r.push(i[0]),u=i.index+i[0].length;return r.push(n.substring(u)),r},trim:function(n){return n.replace(this.trimRegex,"")}},n.HtmlTag=n.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(t){n.Util.assign(this,t);this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(n){return this.tagName=n,this},getTagName:function(){return this.tagName||""},setAttr:function(n,t){var i=this.getAttrs();return i[n]=t,this},getAttr:function(n){return this.getAttrs()[n]},setAttrs:function(t){var i=this.getAttrs();return n.Util.assign(i,t),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(n){return this.setAttr("class",n)},addClass:function(t){for(var u=this.getClass(),f=this.whitespaceRegex,e=n.Util.indexOf,i=u?u.split(f):[],o=t.split(f),r;r=o.shift();)e(i,r)===-1&&i.push(r);return this.getAttrs()["class"]=i.join(" "),this},removeClass:function(t){for(var u=this.getClass(),f=this.whitespaceRegex,o=n.Util.indexOf,i=u?u.split(f):[],s=t.split(f),e,r;i.length&&(e=s.shift());)r=o(i,e),r!==-1&&i.splice(r,1);return this.getAttrs()["class"]=i.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(n){return(" "+this.getClass()+" ").indexOf(" "+n+" ")!==-1},setInnerHtml:function(n){return this.innerHtml=n,this},getInnerHtml:function(){return this.innerHtml||""},toAnchorString:function(){var t=this.getTagName(),n=this.buildAttrsStr();return n=n?" "+n:"",["<",t,n,">",this.getInnerHtml(),"<\/",t,">"].join("")},buildAttrsStr:function(){var n,i,t;if(!this.attrs)return"";n=this.getAttrs();i=[];for(t in n)n.hasOwnProperty(t)&&i.push(t+'="'+n[t]+'"');return i.join(" ")}}),n.AnchorTagBuilder=n.Util.extend(Object,{constructor:function(t){n.Util.assign(this,t)},build:function(t){return new n.HtmlTag({tagName:"a",attrs:this.createAttrs(t.getType(),t.getAnchorHref()),innerHtml:this.processAnchorText(t.getAnchorText())})},createAttrs:function(n,t){var i={href:t},r=this.createCssClass(n);return r&&(i["class"]=r),this.newWindow&&(i.target="_blank"),i},createCssClass:function(n){var t=this.className;return t?t+" "+t+"-"+n:""},processAnchorText:function(n){return this.doTruncate(n)},doTruncate:function(t){return n.Util.ellipsis(t,this.truncate||Number.POSITIVE_INFINITY)}}),n.htmlParser.HtmlParser=n.Util.extend(Object,{htmlRegex:function(){var n=/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/,t=/[^\s\0"'>\/=\x01-\x1F\x7F]+/.source+"(?:\\s*=\\s*"+n.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",t,"|",n.source+")",")*",">",")","|","(?:","<(/)?","(?:",/!--([\s\S]+?)--/.source,"|","(?:","("+/[0-9a-zA-Z][0-9a-zA-Z:]*/.source+")","(?:","\\s+",t,")*","\\s*/?",")",")",">",")"].join(""),"gi")}(),htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,parse:function(n){for(var h=this.htmlRegex,t,r=0,u,i=[],e;(t=h.exec(n))!==null;){var f=t[0],o=t[3],c=t[1]||t[4],l=!!t[2],s=n.substring(r,t.index);s&&(u=this.parseTextAndEntityNodes(s),i.push.apply(i,u));o?i.push(this.createCommentNode(f,o)):i.push(this.createElementNode(f,c,l));r=t.index+f.length}return r<n.length&&(e=n.substring(r),e&&(u=this.parseTextAndEntityNodes(e),i.push.apply(i,u))),i},parseTextAndEntityNodes:function(t){for(var f,e,r=[],u=n.Util.splitAndCapture(t,this.htmlCharacterEntitiesRegex),i=0,o=u.length;i<o;i+=2)f=u[i],e=u[i+1],f&&r.push(this.createTextNode(f)),e&&r.push(this.createEntityNode(e));return r},createCommentNode:function(t,i){return new n.htmlParser.CommentNode({text:t,comment:n.Util.trim(i)})},createElementNode:function(t,i,r){return new n.htmlParser.ElementNode({text:t,tagName:i.toLowerCase(),closing:r})},createEntityNode:function(t){return new n.htmlParser.EntityNode({text:t})},createTextNode:function(t){return new n.htmlParser.TextNode({text:t})}}),n.htmlParser.HtmlNode=n.Util.extend(Object,{text:"",constructor:function(t){n.Util.assign(this,t)},getType:n.Util.abstractMethod,getText:function(){return this.text}}),n.htmlParser.CommentNode=n.Util.extend(n.htmlParser.HtmlNode,{comment:"",getType:function(){return"comment"},getComment:function(){return this.comment}}),n.htmlParser.ElementNode=n.Util.extend(n.htmlParser.HtmlNode,{tagName:"",closing:!1,getType:function(){return"element"},getTagName:function(){return this.tagName},isClosing:function(){return this.closing}}),n.htmlParser.EntityNode=n.Util.extend(n.htmlParser.HtmlNode,{getType:function(){return"entity"}}),n.htmlParser.TextNode=n.Util.extend(n.htmlParser.HtmlNode,{getType:function(){return"text"}}),n.matchParser.MatchParser=n.Util.extend(Object,{urls:!0,email:!0,twitter:!0,phone:!0,hashtag:!1,stripPrefix:!0,matcherRegex:function(){var n=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,t=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/;return new RegExp(["(",/(^|[^\w])@(\w{1,15})/.source,")","|","(",/(?:[\-;:&=\+\$,\w\.]+@)/.source,n.source,t.source,")","|","(","(?:","(",/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/.source,n.source,")","|","(?:","(.?//)?",/(?:www\.)/.source,n.source,")","|","(?:","(.?//)?",n.source,t.source,")",")","(?:"+/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/.source+")?",")","|","(",/(?:\+?\d{1,3}[-\s.])?\(?\d{3}\)?[-\s.]?\d{3}[-\s.]\d{4}/.source,")","|","(",/(^|[^\w])#(\w{1,15})/.source,")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,constructor:function(t){n.Util.assign(this,t);this.matchValidator=new n.MatchValidator},replace:function(n,t,i){var r=this;return n.replace(this.matcherRegex,function(n,u,f,e,o,s,h,c,l,a,v,y,p){var w=r.processCandidateMatch(n,u,f,e,o,s,h,c,l,a,v,y,p),b;return w?(b=t.call(i,w.match),w.prefixStr+b+w.suffixStr):n})},processCandidateMatch:function(t,i,r,u,f,e,o,s,h,c,l,a,v){var p=s||h,y,w="",k="",d,b;return e&&!this.urls||f&&!this.email||c&&!this.phone||i&&!this.twitter||l&&!this.hashtag||!this.matchValidator.isValidMatch(e,o,p)?null:(this.matchHasUnbalancedClosingParen(t)&&(t=t.substr(0,t.length-1),k=")"),f?y=new n.match.Email({matchedText:t,email:f}):i?(r&&(w=r,t=t.slice(1)),y=new n.match.Twitter({matchedText:t,twitterHandle:u})):c?(d=t.replace(/\D/g,""),y=new n.match.Phone({matchedText:t,number:d})):l?(a&&(w=a,t=t.slice(1)),y=new n.match.Hashtag({matchedText:t,serviceName:this.hashtag,hashtag:v})):(p&&(b=p.match(this.charBeforeProtocolRelMatchRegex)[1]||"",b&&(w=b,t=t.slice(1))),y=new n.match.Url({matchedText:t,url:t,protocolUrlMatch:!!o,protocolRelativeMatch:!!p,stripPrefix:this.stripPrefix})),{prefixStr:w,suffixStr:k,match:y})},matchHasUnbalancedClosingParen:function(n){var r=n.charAt(n.length-1);if(r===")"){var t=n.match(/\(/g),i=n.match(/\)/g),u=t&&t.length||0,f=i&&i.length||0;if(u<f)return!0}return!1}}),n.MatchValidator=n.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(n,t,i){return t&&!this.isValidUriScheme(t)||this.urlMatchDoesNotHaveProtocolOrDot(n,t)||this.urlMatchDoesNotHaveAtLeastOneWordChar(n,t)||this.isInvalidProtocolRelativeMatch(i)?!1:!0},isValidUriScheme:function(n){var t=n.match(this.uriSchemeRegex)[0].toLowerCase();return t!=="javascript:"&&t!=="vbscript:"},urlMatchDoesNotHaveProtocolOrDot:function(n,t){return!!n&&(!t||!this.hasFullProtocolRegex.test(t))&&n.indexOf(".")===-1},urlMatchDoesNotHaveAtLeastOneWordChar:function(n,t){return n&&t?!this.hasWordCharAfterProtocolRegex.test(n):!1},isInvalidProtocolRelativeMatch:function(n){return!!n&&this.invalidProtocolRelMatchRegex.test(n)}}),n.match.Match=n.Util.extend(Object,{constructor:function(t){n.Util.assign(this,t)},getType:n.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:n.Util.abstractMethod,getAnchorText:n.Util.abstractMethod}),n.match.Email=n.Util.extend(n.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),n.match.Hashtag=n.Util.extend(n.match.Match,{getType:function(){return"hashtag"},getHashtag:function(){return this.hashtag},getAnchorHref:function(){var n=this.serviceName,t=this.hashtag;switch(n){case"twitter":return"https://twitter.com/hashtag/"+t;case"facebook":return"https://www.facebook.com/hashtag/"+t;default:throw new Error("Unknown service name to point hashtag to: ",n);}},getAnchorText:function(){return"#"+this.hashtag}}),n.match.Phone=n.Util.extend(n.match.Match,{getType:function(){return"phone"},getNumber:function(){return this.number},getAnchorHref:function(){return"tel:"+this.number},getAnchorText:function(){return this.matchedText}}),n.match.Twitter=n.Util.extend(n.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),n.match.Url=n.Util.extend(n.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var n=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(n=this.url="http://"+n,this.protocolPrepended=!0),n},getAnchorHref:function(){var n=this.getUrl();return n.replace(/&amp;/g,"&")},getAnchorText:function(){var n=this.getUrl();return this.protocolRelativeMatch&&(n=this.stripProtocolRelativePrefix(n)),this.stripPrefix&&(n=this.stripUrlPrefix(n)),this.removeTrailingSlash(n)},stripUrlPrefix:function(n){return n.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(n){return n.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(n){return n.charAt(n.length-1)==="/"&&(n=n.slice(0,-1)),n}}),n});t("ThirdParty/zip",["../Core/buildModuleUrl","../Core/defineProperties"],function(n,t){var i={};return function(i){function s(){var n=-1,t=this;t.append=function(i){for(var u=t.table,r=0;r<i.length;r++)n=n>>>8^u[(n^i[r])&255]};t.get=function(){return~n}}function wt(n,t,i){return n.slice?n.slice(t,t+i):n.webkitSlice?n.webkitSlice(t,t+i):n.mozSlice?n.mozSlice(t,t+i):n.msSlice?n.msSlice(t,t+i):void 0}function r(n,t){var i,r;return i=new ArrayBuffer(n),r=new Uint8Array(i),t&&r.set(t,0),{buffer:i,array:r,view:new DataView(i)}}function h(){}function c(n){function r(r,u){var e=new Blob([n],{type:w});i=new f(e);i.init(function(){t.size=i.size;r()},u)}function u(n,t,r,u){i.readUint8Array(n,t,r,u)}var t=this,i;t.size=0;t.init=r;t.readUint8Array=u}function l(n){function u(r){for(var u=n.length;n.charAt(u-1)=="=";)u--;i=n.indexOf(",")+1;t.size=Math.floor((u-i)*.75);r()}function f(t,u,f){for(var s=r(u),h=Math.floor(t/3)*4,c=Math.ceil((t+u)/3)*4,l=window.atob(n.substring(h+i,c+i)),o=t-Math.floor(h/4)*3,e=o;e<o+u;e++)s.array[e-o]=l.charCodeAt(e);f(s.array)}var t=this,i;t.size=0;t.init=u;t.readUint8Array=f}function f(n){function i(t){this.size=n.size;t()}function r(t,i,r,u){var f=new FileReader;f.onload=function(n){r(new Uint8Array(n.target.result))};f.onerror=u;f.readAsArrayBuffer(wt(n,t,i))}var t=this;t.size=0;t.init=i;t.readUint8Array=r}function e(){}function a(n){function r(n){t=new Blob([],{type:w});n()}function u(n,i){t=new Blob([t,b?n:n.buffer],{type:w});i()}function f(i,r){var u=new FileReader;u.onload=function(n){i(n.target.result)};u.onerror=r;u.readAsText(t,n)}var i=this,t;i.init=r;i.writeUint8Array=u;i.getData=f}function v(n){function u(t){r+="data:"+(n||"")+";base64,";t()}function f(n,i){var u,e=t.length,f=t;for(t="",u=0;u<Math.floor((e+n.length)/3)*3-e;u++)f+=String.fromCharCode(n[u]);for(;u<n.length;u++)t+=String.fromCharCode(n[u]);f.length>2?r+=window.btoa(f):t=f;i()}function e(n){n(r+window.btoa(t))}var i=this,r="",t="";i.init=u;i.writeUint8Array=f;i.getData=e}function y(n){function r(i){t=new Blob([],{type:n});i()}function u(i,r){t=new Blob([t,b?i:i.buffer],{type:n});r()}function f(n){n(t)}var t,i=this;i.init=r;i.writeUint8Array=u;i.getData=f}function nt(n,t,i,r,f,e,s,h,c,l){function p(){n.removeEventListener(o,w,!1);h(v)}function w(n){var r=n.data,t=r.data;r.onappend&&(v+=t.length,i.writeUint8Array(t,function(){e(!1,t);b()},l));r.onflush&&(t?(v+=t.length,i.writeUint8Array(t,function(){e(!1,t);p()},l)):p());r.progress&&s&&s(a+r.current,f)}function b(){a=y*u;a<f?t.readUint8Array(r+a,Math.min(u,f-a),function(t){n.postMessage({append:!0,data:t});y++;s&&s(a,f);e(!0,t)},c):n.postMessage({flush:!0})}var y=0,a,v;v=0;n.addEventListener(o,w,!1);b()}function tt(n,t,i,r,f,e,o,s,h,c){function y(){var p;l=v*u;l<f?t.readUint8Array(r+l,Math.min(u,f-l),function(t){var u=n.append(t,function(){o&&o(r+l,f)});a+=u.length;e(!0,t);i.writeUint8Array(u,function(){e(!1,u);v++;setTimeout(y,1)},c);o&&o(l,f)},h):(p=n.flush(),p?(a+=p.length,i.writeUint8Array(p,function(){e(!1,p);s(a)},c)):s(a))}var v=0,l,a=0;y()}function bt(n,t,r,u,f,e,o,h,c){function v(n,t){f&&!n&&a.append(t)}function y(n){e(n,a.get())}var l,a=new s;return i.zip.useWebWorkers?(l=new Worker(i.zip.workerScriptsPath+yt),nt(l,n,t,r,u,v,o,y,h,c)):tt(new i.zip.Inflater,n,t,r,u,v,o,y,h,c),l}function kt(n,t,r,u,f,e,h){function a(n,t){n&&l.append(t)}function v(n){u(n,l.get())}function y(){c.removeEventListener(o,y,!1);nt(c,n,t,0,n.size,a,f,v,e,h)}var c,l=new s;return i.zip.useWebWorkers?(c=new Worker(i.zip.workerScriptsPath+pt),c.addEventListener(o,y,!1),c.postMessage({init:!0,level:r})):tt(new i.zip.Deflater,n,t,0,n.size,a,f,v,e,h),c}function it(n,t,i,r,f,e,o,h,c){function v(){var s=l*u;s<r?n.readUint8Array(i+s,Math.min(u,r-s),function(n){f&&a.append(n);o&&o(s,r,n);t.writeUint8Array(n,function(){l++;v()},c)},h):e(r,a.get())}var l=0,a=new s;v()}function rt(n){for(var r="",i,u=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "],t=0;t<n.length;t++)i=n.charCodeAt(t)&255,r+=i>127?u[i-128]:String.fromCharCode(i);return r}function ut(n){return decodeURIComponent(escape(n))}function ft(n){for(var i="",t=0;t<n.length;t++)i+=String.fromCharCode(n[t]);return i}function dt(n){var t=(n&4294901760)>>16,i=n&65535;try{return new Date(1980+((t&65024)>>9),((t&480)>>5)-1,t&31,(i&63488)>>11,(i&2016)>>5,(i&31)*2,0)}catch(r){}}function et(n,t,i,r,u){if(n.version=t.view.getUint16(i,!0),n.bitFlag=t.view.getUint16(i+2,!0),n.compressionMethod=t.view.getUint16(i+4,!0),n.lastModDateRaw=t.view.getUint32(i+6,!0),n.lastModDate=dt(n.lastModDateRaw),(n.bitFlag&1)==1){u(ht);return}if((r||(n.bitFlag&8)!=8)&&(n.crc32=t.view.getUint32(i+10,!0),n.compressedSize=t.view.getUint32(i+14,!0),n.uncompressedSize=t.view.getUint32(i+18,!0)),n.compressedSize===4294967295||n.uncompressedSize===4294967295){u(ct);return}n.filenameLength=t.view.getUint16(i+22,!0);n.extraFieldLength=t.view.getUint16(i+24,!0)}function gt(n,t){function i(){}function u(i,f){n.readUint8Array(n.size-i,i,function(n){var t=r(n.length,n).view;t.getUint32(0)!=1347093766?u(i+1,f):f(t)},function(){t(d)})}return i.prototype.getData=function(i,u,f,e){function c(n,t){s&&s.terminate();s=null;n&&n(t)}function v(n){var t=r(4);return t.view.setUint32(0,n),o.crc32==t.view.getUint32(0)}function a(n,t){e&&!v(t)?h():i.getData(function(n){c(u,n)})}function h(){c(t,g)}function l(){c(t,at)}var o=this,s;n.readUint8Array(o.offset,30,function(u){var v=r(u.length,u),c;if(v.view.getUint32(0)!=1347093252){t(p);return}et(o,v,4,!1,t);c=o.offset+30+o.filenameLength+o.extraFieldLength;i.init(function(){o.compressionMethod===0?it(n,i,c,o.compressedSize,e,a,f,h,l):s=bt(n,i,c,o.compressedSize,e,a,f,h,l)},l)},h)},{getEntries:function(f){if(n.size<22){t(p);return}u(22,function(u){var e,o;e=u.getUint32(16,!0);o=u.getUint16(8,!0);n.readUint8Array(e,n.size-e,function(n){for(var e=0,a=[],u,c,l,s=r(n.length,n),h=0;h<o;h++){if(u=new i,s.view.getUint32(e)!=1347092738){t(p);return}et(u,s,e+6,!0,t);u.commentLength=s.view.getUint16(e+32,!0);u.directory=(s.view.getUint8(e+38)&16)==16;u.offset=s.view.getUint32(e+42,!0);c=ft(s.array.subarray(e+46,e+46+u.filenameLength));u.filename=(u.bitFlag&2048)==2048?ut(c):rt(c);u.directory||u.filename.charAt(u.filename.length-1)!="/"||(u.directory=!0);l=ft(s.array.subarray(e+46+u.filenameLength+u.extraFieldLength,e+46+u.filenameLength+u.extraFieldLength+u.commentLength));u.comment=(u.bitFlag&2048)==2048?ut(l):rt(l);a.push(u);e+=46+u.filenameLength+u.extraFieldLength+u.commentLength}f(a)},function(){t(d)})})},close:function(n){n&&n()}}}function ot(n){return unescape(encodeURIComponent(n))}function st(n){for(var i=[],t=0;t<n.length;t++)i.push(n.charCodeAt(t));return i}function ni(n,t,i){function h(n,t){o&&o.terminate();o=null;n&&n(t)}function f(){h(t,lt)}function c(){h(t,g)}var o,s={},u=[],e=0;return{add:function(l,a,v,y,p){function nt(t){var u;b=p.lastModDate||new Date;w=r(26);s[l]={headerArray:w.array,directory:p.directory,filename:k,offset:e,comment:st(ot(p.comment||""))};w.view.setUint32(0,335546376);p.version&&w.view.setUint8(0,p.version);i||p.level===0||p.directory||w.view.setUint16(4,2048);w.view.setUint16(6,(b.getHours()<<6|b.getMinutes())<<5|b.getSeconds()/2,!0);w.view.setUint16(8,(b.getFullYear()-1980<<4|b.getMonth()+1)<<5|b.getDate(),!0);w.view.setUint16(22,k.length,!0);u=r(30+k.length);u.view.setUint32(0,1347093252);u.array.set(w.array,4);u.array.set(k,30);e+=u.array.length;n.writeUint8Array(u.array,t,f)}function d(t,i){var u=r(16);e+=t||0;u.view.setUint32(0,1347094280);typeof i!="undefined"&&(w.view.setUint32(10,i,!0),u.view.setUint32(4,i,!0));a&&(u.view.setUint32(8,t,!0),w.view.setUint32(14,t,!0),u.view.setUint32(12,a.size,!0),w.view.setUint32(18,a.size,!0));n.writeUint8Array(u.array,function(){e+=16;h(v)},f)}function g(){if(p=p||{},l=l.trim(),p.directory&&l.charAt(l.length-1)!="/"&&(l+="/"),s.hasOwnProperty(l)){t(vt);return}k=st(ot(l));u.push(l);nt(function(){a?i||p.level===0?it(a,n,0,a.size,!0,d,y,c,f):o=kt(a,n,p.level,d,y,c,f):d()},f)}var w,k,b;a?a.init(g,c):g()},close:function(t){for(var i,a=0,o=0,c,l=0;l<u.length;l++)c=s[u[l]],a+=46+c.filename.length+c.comment.length;for(i=r(a+22),l=0;l<u.length;l++)c=s[u[l]],i.view.setUint32(o,1347092738),i.view.setUint16(o+4,5120),i.array.set(c.headerArray,o+6),i.view.setUint16(o+32,c.comment.length,!0),c.directory&&i.view.setUint8(o+38,16),i.view.setUint32(o+42,c.offset,!0),i.array.set(c.filename,o+46),i.array.set(c.comment,o+46+c.filename.length),o+=46+c.filename.length+c.comment.length;i.view.setUint32(o,1347093766);i.view.setUint16(o+8,u.length,!0);i.view.setUint16(o+10,u.length,!0);i.view.setUint32(o+12,a,!0);i.view.setUint32(o+16,e,!0);n.writeUint8Array(i.array,function(){h(function(){n.getData(t)})},f)}}}var p="File format is not recognized.",ht="File contains encrypted entry.",ct="File is using Zip64 (4gb+ file size).",d="Error while reading zip file.",lt="Error while writing zip file.",at="Error while writing file data.",g="Error while reading file data.",vt="File already exists.",u=524288,yt="inflate.js",pt="deflate.js",w="text/plain",o="message",b,k;try{b=new Blob([new DataView(new ArrayBuffer(0))]).size===0}catch(ti){}s.prototype.table=function(){for(var i,n,r=[],t=0;t<256;t++){for(n=t,i=0;i<8;i++)n=n&1?n>>>1^3988292384:n>>>1;r[t]=n}return r}();c.prototype=new h;c.prototype.constructor=c;l.prototype=new h;l.prototype.constructor=l;f.prototype=new h;f.prototype.constructor=f;e.prototype.getData=function(n){n(this.data)};a.prototype=new e;a.prototype.constructor=a;v.prototype=new e;v.prototype.constructor=v;y.prototype=new e;y.prototype.constructor=y;i.zip={Reader:h,Writer:e,BlobReader:f,Data64URIReader:l,TextReader:c,BlobWriter:y,Data64URIWriter:v,TextWriter:a,createReader:function(n,t,i){n.init(function(){t(gt(n,i))},i)},createWriter:function(n,t,i,r){n.init(function(){t(ni(n,i,r))},i)},useWebWorkers:!0};t(i.zip,{workerScriptsPath:{get:function(){return typeof k=="undefined"&&(k=n("ThirdParty/Workers/")),k}}})}(i),i.zip});t("DataSources/KmlLookAt",[],function(){"use strict";function n(n,t){this.position=n;this.headingPitchRange=t}return n});t("DataSources/KmlTour",["../Core/defined","../Core/Event"],function(n,t){"use strict";function i(n,i){this.id=i;this.name=n;this.playlistIndex=0;this.playlist=[];this.tourStart=new t;this.tourEnd=new t;this.entryStart=new t;this.entryEnd=new t;this._activeEntries=[]}function r(n){for(var t=n.pop();t!==undefined;t=n.pop())t.stop()}function u(t,i,r){var u=this.playlist[this.playlistIndex],o,e;u?(o=f.bind(this,t,i,r),this._activeEntries.push(u),this.entryStart.raiseEvent(u),u.blocking?u.play(o,t.scene.camera,i):(e=this,u.play(function(){e.entryEnd.raiseEvent(u);var n=e._activeEntries.indexOf(u);n>=0&&e._activeEntries.splice(n,1)}),o(t,i,r))):n(r)&&r(!1)}function f(n,t,i,r){var e=this.playlist[this.playlistIndex],f;this.entryEnd.raiseEvent(e,r);r?i(r):(f=this._activeEntries.indexOf(e),f>=0&&this._activeEntries.splice(f,1),this.playlistIndex++,u.call(this,n,t,i))}return i.prototype.addPlaylistEntry=function(n){this.playlist.push(n)},i.prototype.play=function(n,t){this.tourStart.raiseEvent();var i=this;u.call(this,n,t,function(n){i.playlistIndex=0;n||r(i._activeEntries);i.tourEnd.raiseEvent(n)})},i.prototype.stop=function(){r(this._activeEntries)},i});t("DataSources/KmlTourFlyTo",["../Core/BoundingSphere","../Core/combine","../Core/defined","../Core/EasingFunction"],function(n,t,i,r){"use strict";function u(n,t,i){this.type="KmlTourFlyTo";this.blocking=!0;this.activeCamera=null;this.activeCallback=null;this.duration=n;this.view=i;this.flyToMode=t}return u.prototype.play=function(t,r,u){var f,e,o;this.activeCamera=r;i(t)&&t!==null&&(f=this,this.activeCallback=function(n){delete f.activeCallback;delete f.activeCamera;t(i(n)?!1:n)});e=this.getCameraOptions(u);this.view.headingPitchRoll?r.flyTo(e):this.view.headingPitchRange&&(o=new n(this.view.position),r.flyToBoundingSphere(o,e))},u.prototype.stop=function(){i(this.activeCamera)&&this.activeCamera.cancelFlight();i(this.activeCallback)&&this.activeCallback(!0)},u.prototype.getCameraOptions=function(n){var u={duration:this.duration};return i(this.activeCallback)&&(u.complete=this.activeCallback),this.flyToMode==="smooth"&&(u.easingFunction=r.LINEAR_NONE),this.view.headingPitchRoll?(u.destination=this.view.position,u.orientation=this.view.headingPitchRoll):this.view.headingPitchRange&&(u.offset=this.view.headingPitchRange),i(n)&&(u=t(u,n)),u},u});t("DataSources/KmlTourWait",["../Core/defined"],function(n){"use strict";function t(n){this.type="KmlTourWait";this.blocking=!0;this.duration=n;this.timeout=null}return t.prototype.play=function(n){var t=this;this.activeCallback=n;this.timeout=setTimeout(function(){delete t.activeCallback;n(!1)},this.duration*1e3)},t.prototype.stop=function(){clearTimeout(this.timeout);n(this.activeCallback)&&this.activeCallback(!0)},t});t("DataSources/KmlDataSource",["../Core/AssociativeArray","../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/ClockRange","../Core/ClockStep","../Core/Color","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Ellipsoid","../Core/Event","../Core/getExtensionFromUri","../Core/getFilenameFromUri","../Core/HeadingPitchRange","../Core/HeadingPitchRoll","../Core/Iso8601","../Core/JulianDate","../Core/Math","../Core/NearFarScalar","../Core/objectToQuery","../Core/oneTimeWarning","../Core/PinBuilder","../Core/PolygonHierarchy","../Core/queryToObject","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TimeInterval","../Core/TimeIntervalCollection","../Scene/HeightReference","../Scene/HorizontalOrigin","../Scene/LabelStyle","../Scene/SceneMode","../ThirdParty/Autolinker","../ThirdParty/Uri","../ThirdParty/when","../ThirdParty/zip","./BillboardGraphics","./CompositePositionProperty","./DataSource","./DataSourceClock","./Entity","./EntityCluster","./EntityCollection","./KmlCamera","./KmlLookAt","./KmlTour","./KmlTourFlyTo","./KmlTourWait","./LabelGraphics","./PathGraphics","./PolygonGraphics","./PolylineGraphics","./PositionPropertyArray","./RectangleGraphics","./ReferenceProperty","./SampledPositionProperty","./ScaledPositionProperty","./TimeIntervalCollectionProperty","./WallGraphics"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr){"use strict";function re(n){var r=n.slice(0,Math.min(4,n.size)),i=kt.defer(),t=new FileReader;return t.addEventListener("load",function(){i.resolve(new DataView(t.result).getUint32(0,!1)===1347093252)}),t.addEventListener("error",function(){i.reject(t.error)}),t.readAsArrayBuffer(r),i.promise}function ue(n){var i=kt.defer(),t=new FileReader;return t.addEventListener("load",function(){i.resolve(t.result)}),t.addEventListener("error",function(){i.reject(t.error)}),t.readAsText(n),i.promise}function tf(n){var r={xsi:"http://www.w3.org/2001/XMLSchema-instance"},t,f,e,u;for(var i in r)r.hasOwnProperty(i)&&(e=RegExp("[< ]"+i+":"),u="xmlns:"+i+"=",e.test(n)&&n.indexOf(u)===-1&&(c(t)||(t=n.substr(0,n.indexOf("<kml")+4),f=n.substr(t.length)),t+=" "+u+'"'+r[i]+'"'));return c(t)&&(n=t+f),n}function rf(n){for(var t=n.indexOf("xmlns:"),f=n.indexOf(">",t),r,i,u;t!==-1&&t<f;)r=n.slice(t,n.indexOf('"',t)),i=t,t=n.indexOf(r,t+1),t!==-1?(u=n.indexOf('"',n.indexOf('"',t)+1),n=n.slice(0,t-1)+n.slice(u+1,n.length),t=n.indexOf("xmlns:",i-1)):t=n.indexOf("xmlns:",i+1);return n}function fe(n,t,i){n.getData(new dt.TextWriter,function(n){n=tf(n);n=rf(n);t.kml=bu.parseFromString(n,"application/xml");i.resolve()})}function ru(n,t,i){var r=h(wu.detectFromFilename(n.filename),"application/octet-stream");n.getData(new dt.Data64URIWriter(r),function(r){t[n.filename]=r;i.resolve()})}function uf(n,t,i,r){for(var e,o=r.keys,c=new bt("."),s=n.querySelectorAll(t),f=0;f<s.length;f++){var u=s[f],l=u.getAttribute(i),a=new bt(l).resolve(c).toString(),h=o.indexOf(a);h!==-1&&(e=o[h],u.setAttribute(i,r[e]),t==="a"&&u.getAttribute("download")===null&&u.setAttribute("download",e))}}function ff(n,t,i,r){for(var f=n.querySelectorAll(t),u=0;u<f.length;u++){var e=f[u],o=e.getAttribute(i),s=uu(o,r);e.setAttribute(i,s.url)}}function ef(n,t,i){var r=er(n,"id"),u;return r=c(r)&&r.length!==0?r:s(),c(i)&&(r=i+r),u=t.getById(r),c(u)&&(r=s(),c(i)&&(r=i+r)),u=t.add(new ri({id:r})),c(u.kml)||(u.addProperty("kml"),u.kml=new ao),u}function pr(n,t){return n==="absolute"||n==="relativeToGround"||t==="relativeToSeaFloor"}function br(n,t){var i;if(!c(n)||(i=n.match(/[^\s,\n]+/g),!c(i)))return r.fromDegrees(0,0,0,t);var u=parseFloat(i[0]),f=parseFloat(i[1]),e=parseFloat(i[2]);return u=isNaN(u)?0:u,f=isNaN(f)?0:f,e=isNaN(e)?0:e,r.fromDegrees(u,f,e,t)}function kr(n,t){var i,r;if(!c(n)||(i=n.textContent.match(/[^\s\n]+/g),!c(i)))return undefined;var u=i.length,f=new Array(u),e=0;for(r=0;r<u;r++)f[e++]=br(i[r],t);return f}function hf(n,t){var i,r;return c(n)?(i=n.getAttribute(t),i!==null)?(r=parseFloat(i),isNaN(r)?undefined:r):undefined:undefined}function er(n,t){if(!c(n))return undefined;var i=n.getAttribute(t);return i!==null?i:undefined}function ur(n,t,i){var f,e,r,u;if(!c(n))return undefined;for(f=n.childNodes,e=f.length,r=0;r<e;r++)if(u=f[r],u.localName===t&&i.indexOf(u.namespaceURI)!==-1)return u;return undefined}function cf(n,t,i){var r,u;if(!c(n))return undefined;var f=[],e=n.getElementsByTagNameNS("*",t),o=e.length;for(r=0;r<o;r++)u=e[r],u.localName===t&&i.indexOf(u.namespaceURI)!==-1&&f.push(u);return f}function or(n,t,i){var r,u;if(!c(n))return[];var f=[],e=n.childNodes,o=e.length;for(r=0;r<o;r++)u=e[r],u.localName===t&&i.indexOf(u.namespaceURI)!==-1&&f.push(u);return f}function rr(n,t,i){var u=ur(n,t,i),r;return c(u)?(r=parseFloat(u.textContent),isNaN(r)?undefined:r):undefined}function ir(n,t,i){var r=ur(n,t,i);return c(r)?r.textContent.trim():undefined}function sr(n,t,i){var u=ur(n,t,i),r;return c(u)?(r=u.textContent.trim(),r==="1"||/^true$/i.test(r)):undefined}function uu(n,t,i){var u,r,f,e;return c(n)?(c(i)&&(r=i[n],c(r)?u=new st({url:r}):(f=new bt(t.getUrlComponent()),e=new bt(n),r=i[e.resolve(f)],c(r)&&(u=new st({url:r})))),c(u)||(u=t.getDerivedResource({url:n})),u):undefined}function fu(n,t){if(!c(n)||/^\s*$/gm.test(n))return undefined;n[0]==="#"&&(n=n.substring(1));var f=parseInt(n.substring(0,2),16)/255,i=parseInt(n.substring(2,4),16)/255,r=parseInt(n.substring(4,6),16)/255,u=parseInt(n.substring(6,8),16)/255;return t?(u>0?(fr.maximumRed=u,fr.red=undefined):(fr.maximumRed=undefined,fr.red=0),r>0?(fr.maximumGreen=r,fr.green=undefined):(fr.maximumGreen=undefined,fr.green=0),i>0?(fr.maximumBlue=i,fr.blue=undefined):(fr.maximumBlue=undefined,fr.blue=0),fr.alpha=f,o.fromRandom(fr)):new o(u,r,i,f)}function ar(n,t,i){var r=ir(n,t,i);return c(r)?fu(r,ir(n,"colorMode",i)==="random"):undefined}function ee(n){var r=ur(n,"TimeStamp",tr.kmlgx),t=ir(r,"when",tr.kmlgx),u,i;return!c(r)||!c(t)||t.length===0?undefined:(u=g.fromIso8601(t),i=new lt,i.addInterval(new ct({start:u,stop:d.MAXIMUM_VALUE})),i)}function oe(n){var u=ur(n,"TimeSpan",tr.kmlgx),o;if(!c(u))return undefined;var t,f=ur(u,"begin",tr.kmlgx),i=c(f)?g.fromIso8601(f.textContent):undefined,e=ur(u,"end",tr.kmlgx),r=c(e)?g.fromIso8601(e.textContent):undefined;return c(i)&&c(r)?(g.lessThan(r,i)&&(o=i,i=r,r=o),t=new lt,t.addInterval(new ct({start:i,stop:r}))):c(i)?(t=new lt,t.addInterval(new ct({start:i,stop:d.MAXIMUM_VALUE}))):c(r)&&(t=new lt,t.addInterval(new ct({start:d.MINIMUM_VALUE,stop:r}))),t}function lf(){var n=new gt;return n.width=lr,n.height=lr,n.scaleByDistance=new tt(ku,du,gu,nf),n.pixelOffsetScaleByDistance=new tt(ku,du,gu,nf),n}function eu(){var n=new vi;return n.outline=!0,n.outlineColor=o.WHITE,n}function af(){var n=new li;return n.translucencyByDistance=new tt(3e6,1,5e6,0),n.pixelOffset=new i(17,0),n.horizontalOrigin=vt.LEFT,n.font="16px sans-serif",n.style=yt.FILL_AND_OUTLINE,n}function vf(n,t,i,r,u){var f=ir(n,"href",tr.kml),v,e,s,o,w;if(!c(f)||f.length===0)return undefined;if(f.indexOf("root://icons/palette-")===0){var b=f.charAt(21),l=h(rr(n,"x",tr.gx),0),a=h(rr(n,"y",tr.gx),0);l=Math.min(l/32,7);a=7-Math.min(a/32,7);v=8*a+l;f="https://maps.google.com/mapfiles/kml/pal"+b+"/icon"+v+".png"}if(e=uu(f,i,r),u){s=ir(n,"refreshMode",tr.kml);o=ir(n,"viewRefreshMode",tr.kml);s==="onInterval"||s==="onExpire"?rt("kml-refreshMode-"+s,"KML - Unsupported Icon refreshMode: "+s):(o==="onStop"||o==="onRegion")&&rt("kml-refreshMode-"+o,"KML - Unsupported Icon viewRefreshMode: "+o);var k=h(ir(n,"viewBoundScale",tr.kml),1),d=o==="onStop"?"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",y=h(ir(n,"viewFormat",tr.kml),d),p=ir(n,"httpQuery",tr.kml);return c(y)&&e.setQueryParameters(et(tu(y))),c(p)&&e.setQueryParameters(et(tu(p))),w=t._ellipsoid,au(e,t._camera,t._canvas,k,t._lastCameraView.bbox,w),e}return e}function se(n,u,f,e,o){var s=rr(u,"scale",tr.kml),k=rr(u,"heading",tr.kml),et=ar(u,"color",tr.kml),a=ur(u,"Icon",tr.kml),d=vf(a,n,e,o,!1),v,y;c(a)&&!c(d)&&(d=!1);var it=rr(a,"x",tr.gx),rt=rr(a,"y",tr.gx),ut=rr(a,"w",tr.gx),ft=rr(a,"h",tr.gx),p=ur(u,"hotSpot",tr.kml),w=hf(p,"x"),b=hf(p,"y"),g=er(p,"xunits"),tt=er(p,"yunits"),l=f.billboard;c(l)||(l=lf(),f.billboard=l);l.image=d;l.scale=s;l.color=et;(c(it)||c(rt)||c(ut)||c(ft))&&(l.imageSubRegion=new t(it,rt,ut,ft));c(k)&&k!==0&&(l.rotation=nt.toRadians(-k),l.alignedAxis=r.UNIT_Z);s=h(s,1);c(w)&&(g==="pixels"?v=-w*s:g==="insetPixels"?v=(w-lr)*s:g==="fraction"&&(v=-w*lr*s),v+=lr*.5*s);c(b)&&(tt==="pixels"?y=b*s:tt==="insetPixels"?y=(-b+lr)*s:tt==="fraction"&&(y=b*lr*s),y-=lr*.5*s);(c(v)||c(y))&&(l.pixelOffset=new i(v,y))}function dr(n,t,i,r,u){for(var f,s,l,e,a,v=0,y=t.childNodes.length;v<y;v++)if(f=t.childNodes.item(v),f.localName==="IconStyle")se(n,f,i,r,u);else if(f.localName==="LabelStyle")s=i.label,c(s)||(s=af(),i.label=s),s.scale=h(rr(f,"scale",tr.kml),s.scale),s.fillColor=h(ar(f,"color",tr.kml),s.fillColor),s.text=i.name;else if(f.localName==="LineStyle")l=i.polyline,c(l)||(l=new yi,i.polyline=l),l.width=rr(f,"width",tr.kml),l.material=ar(f,"color",tr.kml),c(ar(f,"outerColor",tr.gx))&&rt("kml-gx:outerColor","KML - gx:outerColor is not supported in a LineStyle"),c(rr(f,"outerWidth",tr.gx))&&rt("kml-gx:outerWidth","KML - gx:outerWidth is not supported in a LineStyle"),c(rr(f,"physicalWidth",tr.gx))&&rt("kml-gx:physicalWidth","KML - gx:physicalWidth is not supported in a LineStyle"),c(sr(f,"labelVisibility",tr.gx))&&rt("kml-gx:labelVisibility","KML - gx:labelVisibility is not supported in a LineStyle");else if(f.localName==="PolyStyle")e=i.polygon,c(e)||(e=eu(),i.polygon=e),e.material=h(ar(f,"color",tr.kml),e.material),e.fill=h(sr(f,"fill",tr.kml),e.fill),e.outline=h(sr(f,"outline",tr.kml),e.outline);else if(f.localName==="BalloonStyle"){var p=h(fu(ir(f,"bgColor",tr.kml)),o.WHITE),w=h(fu(ir(f,"textColor",tr.kml)),o.BLACK),b=ir(f,"text",tr.kml);i.addProperty("balloonStyle");i.balloonStyle={bgColor:p,textColor:w,text:b}}else f.localName==="ListStyle"&&(a=ir(f,"listItemType",tr.kml),(a==="radioFolder"||a==="checkOffOnly")&&rt("kml-listStyle-"+a,"KML - Unsupported ListStyle with listItemType: "+a))}function he(n,t,i,r,u){for(var k,h,d,l,a,v,y,g,e,p,o=new ri,f,w=-1,b=t.childNodes,tt=b.length,s=0;s<tt;s++)k=b[s],(k.localName==="Style"||k.localName==="StyleMap")&&(w=s);if(w!==-1)if(h=b[w],h.localName==="Style")dr(n,h,o,r,u);else for(d=or(h,"Pair",tr.kml),l=0;l<d.length;l++)a=d[l],v=ir(a,"key",tr.kml),v==="normal"?(y=ir(a,"styleUrl",tr.kml),c(y)?(f=i.getById(y),c(f)||(f=i.getById("#"+y)),c(f)&&o.merge(f)):(g=ur(a,"Style",tr.kml),dr(n,g,o,r,u))):rt("kml-styleMap-"+v,"KML - Unsupported StyleMap key: "+v);if(e=ir(t,"styleUrl",tr.kml),c(e)){if(p=e,e[0]!=="#"&&e.indexOf("#")!==-1){var nt=e.split("#"),it=nt[0],ut=r.getDerivedResource({url:it});p=ut.getUrlComponent()+"#"+nt[1]}f=i.getById(p);c(f)||(f=i.getById("#"+p));c(f)&&o.merge(f)}return o}function ce(n,t,i){return t.fetchXML().then(function(r){return yf(n,r,i,t,!0)})}function yf(n,t,i,r,u,f){var o,e,h,l,w=cf(t,"Style",tr.kml),tt,a,it,b,k,v,y,p,s,d,g,nt,et,ot;if(c(w))for(tt=w.length,o=0;o<tt;o++)l=w[o],e=er(l,"id"),c(e)&&(e="#"+e,u&&c(r)&&(e=r.getUrlComponent()+e),c(i.getById(e))||(h=new ri({id:e}),i.add(h),dr(n,l,h,r,f)));if(a=cf(t,"StyleMap",tr.kml),c(a))for(it=a.length,o=0;o<it;o++)if(b=a[o],e=er(b,"id"),c(e))for(k=or(b,"Pair",tr.kml),v=0;v<k.length;v++)y=k[v],p=ir(y,"key",tr.kml),p==="normal"?(e="#"+e,u&&c(r)&&(e=r.getUrlComponent()+e),c(i.getById(e))||(h=i.getOrCreateEntity(e),s=ir(y,"styleUrl",tr.kml),c(s)?(s[0]!=="#"&&(s="#"+s),u&&c(r)&&(s=r.getUrlComponent()+s),d=i.getById(s),c(d)&&h.merge(d)):(l=ur(y,"Style",tr.kml),dr(n,l,h,r,f)))):rt("kml-styleMap-"+p,"KML - Unsupported StyleMap key: "+p);var ut=[],ft=t.getElementsByTagName("styleUrl"),st=ft.length;for(o=0;o<st;o++)g=ft[o].textContent,g[0]!=="#"&&(nt=g.split("#"),nt.length===2&&(et=nt[0],ot=r.getDerivedResource({url:et}),ut.push(ce(n,ot,i))));return ut}function ou(n,t,i){var r=new bi(n,t.id,["position"]),u=new di(t.position);t.polyline=c(i.polyline)?i.polyline.clone():new yi;t.polyline.positions=new pi([r,u])}function pf(n,t){return!c(n)&&!c(t)||n==="clampToGround"?at.CLAMP_TO_GROUND:n==="relativeToGround"?at.RELATIVE_TO_GROUND:n==="absolute"?at.NONE:t==="clampToSeaFloor"?(rt("kml-gx:altitudeMode-clampToSeaFloor","KML - <gx:altitudeMode>:clampToSeaFloor is currently not supported, using <kml:altitudeMode>:clampToGround."),at.CLAMP_TO_GROUND):t==="relativeToSeaFloor"?(rt("kml-gx:altitudeMode-relativeToSeaFloor","KML - <gx:altitudeMode>:relativeToSeaFloor is currently not supported, using <kml:altitudeMode>:relativeToGround."),at.RELATIVE_TO_GROUND):(c(n)?rt("kml-altitudeMode-unknown","KML - Unknown <kml:altitudeMode>:"+n+", using <kml:altitudeMode>:CLAMP_TO_GROUND."):rt("kml-gx:altitudeMode-unknown","KML - Unknown <gx:altitudeMode>:"+t+", using <kml:altitudeMode>:CLAMP_TO_GROUND."),at.CLAMP_TO_GROUND)}function le(n,t,i){return i==="relativeToSeaFloor"||t==="absolute"||t==="relativeToGround"?n:((c(t)&&t!=="clampToGround"||c(i)&&i!=="clampToSeaFloor")&&rt("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+h(t,i)),new di(n))}function ae(n,t,i,r){var e,u,f;if(!c(n))return undefined;if(i==="relativeToSeaFloor"||t==="absolute"||t==="relativeToGround")return n;for((c(t)&&t!=="clampToGround"||c(i)&&i!=="clampToSeaFloor")&&rt("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+h(t,i)),e=n.length,u=0;u<e;u++)f=n[u],r.scaleToGeodeticSurface(f,f);return n}function gr(n,t,r,u){var e=t.label,f,s;c(e)||(e=c(r.label)?r.label.clone():af(),t.label=e);e.text=t.name;f=t.billboard;c(f)||(f=c(r.billboard)?r.billboard.clone():lf(),t.billboard=f);c(f.image)?f.image.getValue()||(f.image=undefined):f.image=n._pinBuilder.fromColor(o.YELLOW,64);s=1;c(f.scale)&&(s=f.scale.getValue(),s!==0?e.pixelOffset=new i(s*16+1,0):(e.pixelOffset=undefined,e.horizontalOrigin=undefined));c(u)&&n._clampToGround&&(f.heightReference=u,e.heightReference=u)}function wf(n,t){var i=n.path,r;c(i)||(i=new ai,i.leadTime=0,n.path=i);r=t.polyline;c(r)&&(i.material=r.material,i.width=r.width)}function ve(n,t,i,r,u){var o=ir(i,"coordinates",tr.kml),f=ir(i,"altitudeMode",tr.kml),e=ir(i,"altitudeMode",tr.gx),s=sr(i,"extrude",tr.kml),h=n._ellipsoid,c=br(o,h);return r.position=c,gr(n,r,u,pf(f,e)),s&&pr(f,e)&&ou(t,r,u),!0}function bf(n,t,i,r,u){var g=ur(i,"coordinates",tr.kml),y=ir(i,"altitudeMode",tr.kml),p=ir(i,"altitudeMode",tr.gx),nt=sr(i,"extrude",tr.kml),w=sr(i,"tessellate",tr.kml),a=pr(y,p),b=rr(i,"drawOrder",tr.gx),k=n._ellipsoid,v=kr(g,k),f=u.polyline,e,l,s;return a&&nt?(e=new nr,r.wall=e,e.positions=v,l=u.polygon,c(l)&&(e.fill=l.fill,e.material=l.material),e.outline=!0,c(f)?(e.outlineColor=c(f.material)?f.material.color:o.WHITE,e.outlineWidth=f.width):c(l)&&(e.outlineColor=c(l.material)?l.material.color:o.WHITE)):n._clampToGround&&!a&&w?(s=new yi,s.clampToGround=!0,r.polyline=s,s.positions=v,c(f)?(s.material=c(f.material)?f.material.color.getValue(d.MINIMUM_VALUE):o.WHITE,s.width=h(f.width,1)):(s.material=o.WHITE,s.width=1),s.zIndex=b):(c(b)&&rt("kml-gx:drawOrder","KML - gx:drawOrder is not supported in LineStrings when clampToGround is false"),f=c(f)?f.clone():new yi,r.polyline=f,f.positions=ae(v,y,p,k),(!w||a)&&(f.followSurface=!1)),!0}function ye(n,t,i,r,u){var b=ur(i,"outerBoundaryIs",tr.kml),s=ur(b,"LinearRing",tr.kml),v=ur(s,"coordinates",tr.kml),w=n._ellipsoid,e=kr(v,w),k=sr(i,"extrude",tr.kml),d=ir(i,"altitudeMode",tr.kml),g=ir(i,"altitudeMode",tr.gx),nt=pr(d,g),f=c(u.polygon)?u.polygon.clone():eu(),h=u.polyline,y,p,l,a;if(c(h)&&(f.outlineColor=c(h.material)?h.material.color:o.WHITE,f.outlineWidth=h.width),r.polygon=f,nt?(f.perPositionHeight=!0,f.extrudedHeight=k?0:undefined):n._clampToGround||(f.height=0),c(e)){for(y=new ft(e),p=or(i,"innerBoundaryIs",tr.kml),l=0;l<p.length;l++)for(s=or(p[l],"LinearRing",tr.kml),a=0;a<s.length;a++)v=ur(s[a],"coordinates",tr.kml),e=kr(v,w),c(e)&&y.holes.push(new ft(e));f.hierarchy=y}return!0}function pe(n,t,i,r,u){var h=ir(i,"altitudeMode",tr.kml),c=ir(i,"altitudeMode",tr.gx),l=or(i,"coord",tr.gx),y=or(i,"angles",tr.gx),o=or(i,"when",tr.kml),p=sr(i,"extrude",tr.kml),w=pr(h,c),b=n._ellipsoid,e,v,s;y.length>0&&rt("kml-gx:angles","KML - gx:angles are not supported in gx:Tracks");var k=Math.min(l.length,o.length),a=[],f=[];for(e=0;e<k;e++)v=br(l[e].textContent,b),a.push(v),f.push(g.fromIso8601(o[e].textContent));return s=new ki,s.addSamples(f,a),r.position=s,gr(n,r,u,pf(h,c)),wf(r,u),r.availability=new lt,o.length>0&&r.availability.addInterval(new ct({start:f[0],stop:f[f.length-1]})),w&&p&&ou(t,r,u),!0}function kf(n,t,i,r,u,f,e,o,s){var h=n[0],c=n[n.length-1],l=new ki;l.addSamples(n,t);i.intervals.addInterval(new ct({start:h,stop:c,isStartIncluded:s,isStopIncluded:s,data:le(l,e,o)}));r.addInterval(new ct({start:h,stop:c,isStartIncluded:s,isStopIncluded:s}));u.intervals.addInterval(new ct({start:h,stop:c,isStartIncluded:s,isStopIncluded:s,data:f}))}function we(n,t,i,r,u){for(var s,ft,et=sr(i,"interpolate",tr.gx),w=or(i,"Track",tr.gx),f,h,b,l=!1,a=new gi,v=new lt,y=new ni,ot=n._ellipsoid,p=0,st=w.length;p<st;p++){var e=w[p],k=or(e,"when",tr.kml),d=or(e,"coord",tr.gx),nt=ir(e,"altitudeMode",tr.kml),tt=ir(e,"altitudeMode",tr.gx),it=pr(nt,tt),rt=sr(e,"extrude",tr.kml),ut=Math.min(d.length,k.length),o=[];for(f=[],s=0;s<ut;s++)ft=br(d[s].textContent,ot),o.push(ft),f.push(g.fromIso8601(k[s].textContent));et&&(c(h)&&kf([h,f[0]],[b,o[0]],y,v,a,!1,"absolute",undefined,!1),h=f[ut-1],b=o[o.length-1]);kf(f,o,y,v,a,it&&rt,nt,tt,!0);l=l||it&&rt}return r.availability=v,r.position=y,gr(n,r,u),wf(r,u),l&&(ou(t,r,u),r.polyline.show=a),!0}function be(n,t,i,r,u,f){for(var o,h,e,l=i.childNodes,a=!1,s=0,v=l.length;s<v;s++)o=l.item(s),h=su[o.localName],c(h)&&(e=ef(o,t,f),e.parent=r,e.name=r.name,e.availability=r.availability,e.description=r.description,e.kml=r.kml,h(n,t,o,e,u)&&(a=!0));return a}function ke(n,t,i){return rt("kml-unsupportedGeometry","KML - Unsupported geometry: "+i.localName),!1}function de(n,t){var i=ur(n,"ExtendedData",tr.kml),e,r,s,u,f,o;if(!c(i))return undefined;if(c(ur(i,"SchemaData",tr.kml))&&rt("kml-schemaData","KML - SchemaData is unsupported"),c(er(i,"xmlns:prefix"))&&rt("kml-extendedData","KML - ExtendedData with xmlns:prefix is unsupported"),e={},r=or(i,"Data",tr.kml),c(r))for(s=r.length,u=0;u<s;u++)f=r[u],o=er(f,"name"),c(o)&&(e[o]={displayName:ir(f,"displayName",tr.kml),value:ir(f,"value",tr.kml)});t.kml.extendedData=e}function ge(n,t,i,r,u){var e,b,v,k=t.kml,a=k.extendedData,d=ir(n,"description",tr.kml),y=h(t.balloonStyle,i.balloonStyle),tt=o.WHITE,it=o.BLACK,f=d,s,p,nt,l;if(c(y)&&(tt=h(y.bgColor,o.WHITE),it=h(y.textColor,o.BLACK),f=h(y.text,d)),c(f)){if(f=f.replace("$[name]",h(t.name,"")),f=f.replace("$[description]",h(d,"")),f=f.replace("$[address]",h(k.address,"")),f=f.replace("$[Snippet]",h(k.snippet,"")),f=f.replace("$[id]",t.id),f=f.replace("$[geDirections]",""),c(a)&&(p=f.match(/\$\[.+?\]/g),p!==null))for(e=0;e<p.length;e++){var g=p[e],w=g.substr(2,g.length-3),rt=/\/displayName$/.test(w);w=w.replace(/\/displayName$/,"");s=a[w];c(s)&&(s=rt?s.displayName:s.value);c(s)&&(f=f.replace(g,h(s,"")))}}else if(c(a)&&(v=Object.keys(a),v.length>0)){for(f='<table class="cesium-infoBox-defaultTable cesium-infoBox-defaultTable-lighter"><tbody>',e=0;e<v.length;e++)b=v[e],s=a[b],f+="<tr><th>"+h(s.displayName,b)+"<\/th><td>"+h(s.value,"")+"<\/td><\/tr>";f+="<\/tbody><\/table>"}if(c(f)){for(f=ie.link(f),hr.innerHTML=f,nt=hr.querySelectorAll("a"),e=0;e<nt.length;e++)nt[e].setAttribute("target","_blank");c(r)&&r.keys.length>1&&(uf(hr,"a","href",r),uf(hr,"img","src",r));ff(hr,"a","href",u);ff(hr,"img","src",u);l='<div class="cesium-infoBox-description-lighter" style="';l+="overflow:auto;";l+="word-wrap:break-word;";l+="background-color:"+tt.toCssColorString()+";";l+="color:"+it.toCssColorString()+";";l+='">';l+=hr.innerHTML+"<\/div>";hr.innerHTML="";t.description=l}}function nu(n,t,i,r,u,f,e,o,s){function g(n){return n?n.show&&g(n.parent):!0}var l=ef(i,r,s),y=l.kml,d=he(n,i,u,f,e),tt=ir(i,"name",tr.kml),p,nt,w,b,a,v,k;return l.name=tt,l.parent=t,p=oe(i),c(p)||(p=ee(i)),l.availability=p,pu(l),nt=sr(i,"visibility",tr.kml),l.show=g(t)&&h(nt,!0),w=ur(i,"author",tr.atom),b=y.author,b.name=ir(w,"name",tr.atom),b.uri=ir(w,"uri",tr.atom),b.email=ir(w,"email",tr.atom),a=ur(i,"link",tr.atom),v=y.link,v.href=er(a,"href"),v.hreflang=er(a,"hreflang"),v.rel=er(a,"rel"),v.type=er(a,"type"),v.title=er(a,"title"),v.length=er(a,"length"),y.address=ir(i,"address",tr.kml),y.phoneNumber=ir(i,"phoneNumber",tr.kml),y.snippet=ir(i,"Snippet",tr.kml),de(i,l),ge(i,l,d,e,f),k=n._ellipsoid,te(i,l,k),ne(i,l,k),c(ur(i,"Region",tr.kml))&&rt("kml-region","KML - Placemark Regions are unsupported"),{entity:l,styleEntity:d}}function df(n,t,i,r,u,f,e,o,s){for(var c,h,a=Object.keys(wr),p=a.length,l=0;l<p;l++){var v=a[l],w=wr[v],y=i.childNodes,b=y.length;for(c=0;c<b;c++)h=y[c],h.localName===v&&(tr.kml.indexOf(h.namespaceURI)!==-1||tr.gx.indexOf(h.namespaceURI)!==-1)&&w(n,t,h,r,u,f,e,o,s)}}function no(n,t,i,r,u,f,e,o,s){var h=nu(n,t,i,r,u,f,e,o,s);df(n,h.entity,i,r,u,f,e,o,s)}function to(n,t,i,r,u,f,e,o,s){for(var y,p,w=nu(n,t,i,r,u,f,e,o,s),h=w.entity,l=w.styleEntity,a=!1,b=i.childNodes,v=0,k=b.length;v<k&&!a;v++)y=b.item(v),p=su[y.localName],c(p)&&(p(n,r,y,h,l,h.id),a=!0);a||(h.merge(l),gr(n,h,l))}function io(n,t,i){var l=ir(i,"name",tr.kml),a=er(i,"id"),o=new si(l,a),s=ur(i,"Playlist",tr.gx),h,f,u,r,e;if(s)for(h=n._ellipsoid,f=s.childNodes,u=0;u<f.length;u++)r=f[u],r.localName&&(e=gf[r.localName],e?e(o,r,h):console.log("Unknown KML Tour playlist entry type "+r.localName));c(n.kmlTours)||(n.kmlTours=[]);n.kmlTours.push(o)}function hu(n,t){rt("KML Tour unsupported node "+t.localName)}function ro(n,t){var i=rr(t,"duration",tr.gx);n.addPlaylistEntry(new ci(i))}function uo(n,t,i){var e=rr(t,"duration",tr.gx),o=ir(t,"flyToMode",tr.gx),r={kml:{}},u,f;te(t,r,i);ne(t,r,i);u=r.kml.lookAt||r.kml.camera;f=new hi(e,o,u);n.addPlaylistEntry(f)}function ne(n,t,i){var u=ur(n,"Camera",tr.kml);if(c(u)){var f=h(rr(u,"longitude",tr.kml),0),e=h(rr(u,"latitude",tr.kml),0),o=h(rr(u,"altitude",tr.kml),0),s=h(rr(u,"heading",tr.kml),0),l=h(rr(u,"tilt",tr.kml),0),a=h(rr(u,"roll",tr.kml),0),v=r.fromDegrees(f,e,o,i),y=k.fromDegrees(s,l-90,a);t.kml.camera=new ei(v,y)}}function te(n,t,i){var u=ur(n,"LookAt",tr.kml),o,s;if(c(u)){var l=h(rr(u,"longitude",tr.kml),0),a=h(rr(u,"latitude",tr.kml),0),v=h(rr(u,"altitude",tr.kml),0),f=rr(u,"heading",tr.kml),e=rr(u,"tilt",tr.kml),y=h(rr(u,"range",tr.kml),0);e=nt.toRadians(h(e,0));f=nt.toRadians(h(f,0));o=new b(f,e-nt.PI_OVER_TWO,y);s=r.fromDegrees(l,a,v,i);t.kml.lookAt=new oi(s,o)}}function fo(n,t,i,r,u,f,e,o,s){var st=nu(n,t,i,r,u,f,e,o,s),tt=st.entity,h,it=!1,ht=n._ellipsoid,ut=kr(ur(i,"LatLonQuad",tr.gx),ht),et=rr(i,"drawOrder",tr.kml),a,k,d,v,g,l;if(c(ut))h=eu(),h.hierarchy=new ft(ut),h.zIndex=et,tt.polygon=h,it=!0;else if(h=new wi,h.zIndex=et,tt.rectangle=h,a=ur(i,"LatLonBox",tr.kml),c(a)){var y=rr(a,"west",tr.kml),p=rr(a,"south",tr.kml),w=rr(a,"east",tr.kml),b=rr(a,"north",tr.kml);c(y)&&(y=nt.negativePiToPi(nt.toRadians(y)));c(p)&&(p=nt.clampToLatitudeRange(nt.toRadians(p)));c(w)&&(w=nt.negativePiToPi(nt.toRadians(w)));c(b)&&(b=nt.clampToLatitudeRange(nt.toRadians(b)));h.coordinates=new ot(y,p,w,b);k=rr(a,"rotation",tr.kml);c(k)&&(d=nt.toRadians(k),h.rotation=d,h.stRotation=d)}if(v=ur(i,"Icon",tr.kml),g=vf(v,n,f,e,!0),c(g)){it&&rt("kml-gx:LatLonQuad","KML - gx:LatLonQuad Icon does not support texture projection.");var ct=rr(v,"x",tr.gx),lt=rr(v,"y",tr.gx),at=rr(v,"w",tr.gx),vt=rr(v,"h",tr.gx);(c(ct)||c(lt)||c(at)||c(vt))&&rt("kml-groundOverlay-xywh","KML - gx:x, gx:y, gx:w, gx:h aren't supported for GroundOverlays");h.material=g;h.material.color=ar(i,"color",tr.kml);h.material.transparent=!0}else h.material=ar(i,"color",tr.kml);l=ir(i,"altitudeMode",tr.kml);c(l)?l==="absolute"?(h.height=rr(i,"altitude",tr.kml),h.zIndex=undefined):l!=="clampToGround"&&rt("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+l):(l=ir(i,"altitudeMode",tr.gx),l==="relativeToSeaFloor"?(rt("kml-altitudeMode-relativeToSeaFloor","KML - altitudeMode relativeToSeaFloor is currently not supported, treating as absolute."),h.height=rr(i,"altitude",tr.kml),h.zIndex=undefined):l==="clampToSeaFloor"?rt("kml-altitudeMode-clampToSeaFloor","KML - altitudeMode clampToSeaFloor is currently not supported, treating as clampToGround."):c(l)&&rt("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+l))}function cu(n,t,i,r,u,f,e){n._unsupportedNode.raiseEvent(n,t,i,r,u,f,e);rt("kml-unsupportedFeature-"+i.nodeName,"KML - Unsupported feature: "+i.nodeName)}function tu(n){if(!c(n)||n.length===0)return"";var t=n[0];return(t==="&"||t==="?")&&(n=n.substring(1)),n}function au(n,t,i,u,f,e){function g(n){return n<-nt.PI_OVER_TWO?-nt.PI_OVER_TWO:n>nt.PI_OVER_TWO?nt.PI_OVER_TWO:n}function tt(n){return n>nt.PI?n-nt.TWO_PI:n<-nt.PI?n+nt.TWO_PI:n}var o=it(n.queryParameters),l,s,y,p,w,b,a;if(o=o.replace(/%5B/g,"[").replace(/%5D/g,"]"),c(t)&&t._mode!==pt.MORPHING){f=h(f,eo);c(i)&&(lu.x=i.clientWidth*.5,lu.y=i.clientHeight*.5,l=t.pickEllipsoid(lu,e,oo));c(l)?s=e.cartesianToCartographic(l,vr):(s=ot.center(f,vr),l=e.cartographicToCartesian(s));c(u)&&!nt.equalsEpsilon(u,1,nt.EPSILON9)&&(y=f.width*u*.5,p=f.height*u*.5,f=new ot(tt(s.longitude-y),g(s.latitude-p),tt(s.longitude+y),g(s.latitude+p)));o=o.replace("[bboxWest]",nt.toDegrees(f.west).toString());o=o.replace("[bboxSouth]",nt.toDegrees(f.south).toString());o=o.replace("[bboxEast]",nt.toDegrees(f.east).toString());o=o.replace("[bboxNorth]",nt.toDegrees(f.north).toString());w=nt.toDegrees(s.longitude).toString();b=nt.toDegrees(s.latitude).toString();o=o.replace("[lookatLon]",w);o=o.replace("[lookatLat]",b);o=o.replace("[lookatTilt]",nt.toDegrees(t.pitch).toString());o=o.replace("[lookatHeading]",nt.toDegrees(t.heading).toString());o=o.replace("[lookatRange]",r.distance(t.positionWC,l));o=o.replace("[lookatTerrainLon]",w);o=o.replace("[lookatTerrainLat]",b);o=o.replace("[lookatTerrainAlt]",s.height.toString());e.cartesianToCartographic(t.positionWC,vr);o=o.replace("[cameraLon]",nt.toDegrees(vr.longitude).toString());o=o.replace("[cameraLat]",nt.toDegrees(vr.latitude).toString());o=o.replace("[cameraAlt]",nt.toDegrees(vr.height).toString());var rt=t.frustum,v=rt.aspectRatio,k="",d="";c(v)&&(a=nt.toDegrees(rt.fov),v>1?(k=a,d=a/v):(d=a,k=a*v));o=o.replace("[horizFov]",k.toString());o=o.replace("[vertFov]",d.toString())}else o=o.replace("[bboxWest]","-180"),o=o.replace("[bboxSouth]","-90"),o=o.replace("[bboxEast]","180"),o=o.replace("[bboxNorth]","90"),o=o.replace("[lookatLon]",""),o=o.replace("[lookatLat]",""),o=o.replace("[lookatRange]",""),o=o.replace("[lookatTilt]",""),o=o.replace("[lookatHeading]",""),o=o.replace("[lookatTerrainLon]",""),o=o.replace("[lookatTerrainLat]",""),o=o.replace("[lookatTerrainAlt]",""),o=o.replace("[cameraLon]",""),o=o.replace("[cameraLat]",""),o=o.replace("[cameraAlt]",""),o=o.replace("[horizFov]",""),o=o.replace("[vertFov]","");c(i)?(o=o.replace("[horizPixels]",i.clientWidth),o=o.replace("[vertPixels]",i.clientHeight)):(o=o.replace("[horizPixels]",""),o=o.replace("[vertPixels]",""));o=o.replace("[terrainEnabled]","1");o=o.replace("[clientVersion]","1");o=o.replace("[kmlVersion]","2.2");o=o.replace("[clientName]","Cesium");o=o.replace("[language]","English");n.setQueryParameters(et(o))}function so(n,t,i,r,u,f,e,o,l){var it=nu(n,t,i,r,u,f,e,o,l),w=it.entity,v=ur(i,"Link",tr.kml),a,p,b,y,nt;if(c(v)||(v=ur(i,"Url",tr.kml)),c(v)&&(a=ir(v,"href",tr.kml),c(a))){if(y=a,a=uu(a,f,e),/^data:/.test(a.getUrlComponent()))/\.kmz/i.test(f.getUrlComponent())||(y=f.getDerivedResource({url:y}));else{y=a.clone();p=ir(v,"viewRefreshMode",tr.kml);b=h(ir(v,"viewBoundScale",tr.kml),1);var ut=p==="onStop"?"BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",k=h(ir(v,"viewFormat",tr.kml),ut),d=ir(v,"httpQuery",tr.kml);c(k)&&a.setQueryParameters(et(tu(k)));c(d)&&a.setQueryParameters(et(tu(d)));nt=n._ellipsoid;au(a,n._camera,n._canvas,b,n._lastCameraView.bbox,nt)}var ft={sourceUri:y,uriResolver:e,context:w.id},tt=new fi,ot=yu(n,tt,a,ft).then(function(t){var d=n._entityCollection,ft=tt.values,e,r,u,f,it,k,ut;for(d.suspendEvents(),e=0;e<ft.length;e++)r=ft[e],c(r.parent)||(r.parent=w,pu(r)),d.add(r);if(d.resumeEvents(),u=ir(v,"refreshMode",tr.kml),f=h(rr(v,"refreshInterval",tr.kml),0),u==="onInterval"&&f>0||u==="onExpire"||p==="onStop"){var o=ur(t,"NetworkLinkControl",tr.kml),nt=c(o),l=g.now(),i={id:s(),href:a,cookie:{},lastUpdated:l,updating:!1,entity:w,viewBoundScale:b,needsUpdate:!1,cameraUpdateTime:l},y=0;if(nt&&(i.cookie=et(h(ir(o,"cookie",tr.kml),"")),y=h(rr(o,"minRefreshPeriod",tr.kml),0)),u==="onInterval")nt&&(f=Math.max(y,f)),i.refreshMode=cr.INTERVAL,i.time=f;else if(u==="onExpire")if(nt&&(it=ir(o,"expires",tr.kml)),c(it))try{k=g.fromIso8601(it);ut=g.secondsDifference(k,l);ut>0&&ut<y&&g.addSeconds(l,y,k);i.refreshMode=cr.EXPIRE;i.time=k}catch(ot){rt("kml-refreshMode-onInterval-onExpire","KML - NetworkLinkControl expires is not a valid date")}else rt("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element");else n._camera?(i.refreshMode=cr.STOP,i.time=h(rr(v,"viewRefreshTime",tr.kml),0)):rt("kml-refrehMode-onStop-noCamera","A NetworkLink with viewRefreshMode=onStop requires a camera be passed in when creating the KmlDataSource");c(i.refreshMode)&&n._networkLinks.set(i.id,i)}else p==="onRegion"&&rt("kml-refrehMode-onRegion","KML - Unsupported viewRefreshMode: onRegion")}).otherwise(function(t){rt("An error occured during loading "+a.url);n._error.raiseEvent(n,t)});o.push(ot)}}function ho(n,t,i,r,u,f,e,o,s){var h=wr[t.localName];c(h)?h(n,i,t,r,u,f,e,o,s):cu(n,i,t,r,u,f,e,o,s)}function vu(n,t,i,r,u,f){var s;t.removeAll();var h=[],e=i.documentElement,l=e.localName==="Document"?e:ur(e,"Document",tr.kml),o=ir(l,"name",tr.kml);return c(o)||(o=w(r.getUrlComponent())),c(n._name)||(n._name=o),s=new fi(n),kt.all(yf(n,i,s,r,!1,u)).then(function(){var e=i.documentElement,l,o,a;if(e.localName==="kml")for(l=e.childNodes,o=0;o<l.length;o++)if(a=l[o],c(wr[a.localName])){e=a;break}return t.suspendEvents(),ho(n,e,undefined,t,s,r,u,h,f),t.resumeEvents(),kt.all(h).then(function(){return i.documentElement})})}function co(n,t,i,r){var u=kt.defer();return dt.createReader(new dt.BlobReader(i),function(i){i.getEntries(function(f){for(var o,h,v=[],e={},s,l,a=0;a<f.length;a++)o=f[a],o.directory||(h=kt.defer(),v.push(h.promise),/\.kml$/i.test(o.filename)?c(s)&&/\//i.test(o.filename)?ru(o,e,h):(c(s)&&ru(s,e,l),s=o,l=h):ru(o,e,h));c(s)&&fe(s,e,l);kt.all(v).then(function(){if(i.close(),!c(e.kml)){u.reject(new ht("KMZ file does not contain a KML document."));return}return e.keys=Object.keys(e),vu(n,t,e.kml,r,e)}).then(u.resolve).otherwise(u.reject)})},function(n){u.reject(n)}),u.promise}function yu(n,t,i,r){r=h(r,h.EMPTY_OBJECT);var u=r.sourceUri,f=r.uriResolver,e=r.context,o=i;return typeof i=="string"||i instanceof st?(i=st.createIfNeeded(i),o=i.fetchBlob(),u=h(u,i.clone())):u=h(u,st.DEFAULT.clone()),u=st.createIfNeeded(u),kt(o).then(function(i){return i instanceof Blob?re(i).then(function(r){return r?co(n,t,i,u):ue(i).then(function(i){var r,o,s;i=tf(i);i=rf(i);try{r=bu.parseFromString(i,"application/xml")}catch(h){o=h.toString()}if(c(o)||r.body||r.documentElement.tagName==="parsererror"){s=c(o)?o:r.documentElement.firstChild.nodeValue;s||(s=r.body.innerText);throw new ht(s);}return vu(n,t,r,u,f,e)})}):vu(n,t,i,u,f,e)}).otherwise(function(t){return n._error.raiseEvent(n,t),console.log(t),kt.reject(t)})}function yr(t){t=h(t,{});var i=t.camera,u=t.canvas;if(!c(i))throw new a("options.camera is required.");if(!c(u))throw new a("options.canvas is required.");this._changed=new y;this._error=new y;this._loading=new y;this._refresh=new y;this._unsupportedNode=new y;this._clock=undefined;this._entityCollection=new fi(this);this._name=undefined;this._isLoading=!1;this._pinBuilder=new ut;this._networkLinks=new n;this._entityCluster=new ui;this._canvas=u;this._camera=i;this._lastCameraView={position:c(i)?r.clone(i.positionWC):undefined,direction:c(i)?r.clone(i.directionWC):undefined,up:c(i)?r.clone(i.upWC):undefined,bbox:c(i)?i.computeViewRectangle():ot.clone(ot.MAX_VALUE)};this._ellipsoid=h(t.ellipsoid,v.WGS84)}function pu(n){var r=n.parent,t,i;c(r)&&(t=r.availability,c(t)&&(i=n.availability,c(i)?i.intersect(t):n.availability=t))}function lo(n,t,i,r,u){return function(f){function ht(n){var i,r,t;for(e.remove(n),i=n._children,r=i.length,t=0;t<r;++t)ht(i[t])}var y,k,nt,p,tt,it,o,w,l,a;if(r.contains(t.id)){var b=!1,s=ur(f,"NetworkLinkControl",tr.kml),lt=c(s),v=0;if(lt){if(c(ur(s,"Update",tr.kml))){rt("kml-networkLinkControl-update","KML - NetworkLinkControl updates aren't supported.");t.updating=!1;r.remove(t.id);return}t.cookie=et(h(ir(s,"cookie",tr.kml),""));v=h(rr(s,"minRefreshPeriod",tr.kml),0)}if(y=g.now(),k=t.refreshMode,k===cr.INTERVAL)c(s)&&(t.time=Math.max(v,t.time));else if(k===cr.EXPIRE)if(c(s)&&(nt=ir(s,"expires",tr.kml)),c(nt))try{p=g.fromIso8601(nt);tt=g.secondsDifference(p,y);tt>0&&tt<v&&g.addSeconds(y,v,p);t.time=p}catch(yt){rt("kml-networkLinkControl-expires","KML - NetworkLinkControl expires is not a valid date");b=!0}else rt("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element"),b=!0;var ot=t.entity,e=n._entityCollection,st=i.values;for(e.suspendEvents(),it=e.values.slice(),o=0;o<it.length;++o)w=it[o],w.parent===ot&&(w.parent=undefined,ht(w));for(e.resumeEvents(),e.suspendEvents(),o=0;o<st.length;o++)l=st[o],c(l.parent)||(l.parent=ot,pu(l)),e.add(l);e.resumeEvents();b?r.remove(t.id):t.lastUpdated=y;var ct=e.computeAvailability(),ut=ct.start,ft=ct.stop,at=g.equals(ut,d.MINIMUM_VALUE),vt=g.equals(ft,d.MAXIMUM_VALUE);at&&vt||(a=n._clock,(a.startTime!==ut||a.stopTime!==ft)&&(a.startTime=ut,a.stopTime=ft,n._changed.raiseEvent(n)));t.updating=!1;t.needsUpdate=!1;n._refresh.raiseEvent(n,u.getUrlComponent(!0))}}}function ao(){this.author={name:undefined,uri:undefined,email:undefined};this.link={href:undefined,hreflang:undefined,rel:undefined,type:undefined,title:undefined,length:undefined};this.address=undefined;this.phoneNumber=undefined;this.snippet=undefined;this.extendedData=undefined}var fr,su,hr,wr,gf,cr,iu;if(typeof DOMParser=="undefined")return{};var wu={avi:"video/x-msvideo",bmp:"image/bmp",bz2:"application/x-bzip2",chm:"application/vnd.ms-htmlhelp",css:"text/css",csv:"text/csv",doc:"application/msword",dvi:"application/x-dvi",eps:"application/postscript",flv:"video/x-flv",gif:"image/gif",gz:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",m3u:"audio/x-mpegurl",m4v:"video/mp4",mathml:"application/mathml+xml",mid:"audio/midi",midi:"audio/midi",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",pdf:"application/pdf",png:"image/png",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",qt:"video/quicktime",rdf:"application/rdf+xml",rss:"application/rss+xml",rtf:"application/rtf",svg:"image/svg+xml",swf:"application/x-shockwave-flash",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",xml:"application/xml",zip:"application/zip",detectFromFilename:function(n){var t=n.toLowerCase();return t=p(t),wu[t]}},bu=new DOMParser,ie=new wt({stripPrefix:!1,twitter:!1,email:!1,replaceFn:function(n,t){if(!t.protocolUrlMatch)return!1}}),lr=32,ku=2414016,du=1,gu=16093e3,nf=.1;var of=[null,undefined,"http://www.opengis.net/kml/2.2","http://earth.google.com/kml/2.2","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.0"],sf=["http://www.google.com/kml/ext/2.2"],tr={kml:of,gx:sf,atom:["http://www.w3.org/2005/Atom"],kmlgx:of.concat(sf)};fr={maximumRed:undefined,red:undefined,maximumGreen:undefined,green:undefined,maximumBlue:undefined,blue:undefined};su={Point:ve,LineString:bf,LinearRing:bf,Polygon:ye,Track:pe,MultiTrack:we,MultiGeometry:be,Model:ke};hr=document.createElement("div");wr={Document:df,Folder:no,Placemark:to,NetworkLink:so,GroundOverlay:fo,PhotoOverlay:cu,ScreenOverlay:cu,Tour:io};gf={FlyTo:uo,Wait:ro,SoundCue:hu,AnimatedUpdate:hu,TourControl:hu};cr={INTERVAL:0,EXPIRE:1,STOP:2};var eo=new ot,vr=new u,lu=new i,oo=new r;return yr.load=function(n,t){t=h(t,h.EMPTY_OBJECT);var i=new yr(t);return i.load(n,t)},l(yr.prototype,{name:{get:function(){return this._name},set:function(n){this._name!==n&&(this._name=n,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},refreshEvent:{get:function(){return this._refresh}},unsupportedNodeEvent:{get:function(){return this._unsupportedNode}},show:{get:function(){return this._entityCollection.show},set:function(n){this._entityCollection.show=n}},clustering:{get:function(){return this._entityCluster},set:function(n){if(!c(n))throw new a("value must be defined.");this._entityCluster=n}}}),yr.prototype.load=function(n,t){var r,i;if(!c(n))throw new a("data is required.");return t=h(t,{}),ti.setLoading(this,!0),r=this._name,this._name=undefined,this._clampToGround=h(t.clampToGround,!1),i=this,yu(this,this._entityCollection,n,t).then(function(){var n,h=i._entityCollection.computeAvailability(),u=h.start,o=h.stop,c=g.equals(u,d.MINIMUM_VALUE),l=g.equals(o,d.MAXIMUM_VALUE),t,s;return c&&l||(c&&(t=new Date,t.setHours(0,0,0,0),u=g.fromDate(t)),l&&(t=new Date,t.setHours(24,0,0,0),o=g.fromDate(t)),n=new ii,n.startTime=u,n.stopTime=o,n.currentTime=g.clone(u),n.clockRange=f.LOOP_STOP,n.clockStep=e.SYSTEM_CLOCK_MULTIPLIER,n.multiplier=Math.round(Math.min(Math.max(g.secondsDifference(o,u)/60,1),31556900))),s=!1,n!==i._clock&&(i._clock=n,s=!0),r!==i._name&&(s=!0),s&&i._changed.raiseEvent(i),ti.setLoading(i,!1),i}).otherwise(function(n){return ti.setLoading(i,!1),i._error.raiseEvent(i,n),console.log(n),kt.reject(n)})},iu=new n,yr.prototype.update=function(){function l(n){for(var t,r=n._children,u=r.length,i=0;i<u;++i)t=r[i],iu.set(t.id,t),l(t)}var s=this._networkLinks,f,t,e,o;if(s.length===0)return!0;f=g.now();t=this;iu.removeAll();var a=!1,i=this._lastCameraView,u=this._camera;return!c(u)||u.positionWC.equalsEpsilon(i.position,nt.EPSILON7)&&u.directionWC.equalsEpsilon(i.direction,nt.EPSILON7)&&u.upWC.equalsEpsilon(i.up,nt.EPSILON7)||(i.position=r.clone(u.positionWC),i.direction=r.clone(u.directionWC),i.up=r.clone(u.upWC),i.bbox=u.computeViewRectangle(),a=!0),e=new n,o=!1,s.values.forEach(function(n){var s=n.entity,r,c,u,y;iu.contains(s.id)||(n.updating||(r=!1,n.refreshMode===cr.INTERVAL?g.secondsDifference(f,n.lastUpdated)>n.time&&(r=!0):n.refreshMode===cr.EXPIRE?g.greaterThan(f,n.time)&&(r=!0):n.refreshMode===cr.STOP&&(a&&(n.needsUpdate=!0,n.cameraUpdateTime=f),n.needsUpdate&&g.secondsDifference(f,n.cameraUpdateTime)>=n.time&&(r=!0)),r&&(l(s),n.updating=!0,c=new fi,u=n.href.clone(),u.setQueryParameters(n.cookie),y=h(t._ellipsoid,v.WGS84),au(u,t._camera,t._canvas,n.viewBoundScale,i.bbox,y),yu(t,c,u,{context:s.id}).then(lo(t,n,c,e,u)).otherwise(function(i){var r="NetworkLink "+n.href+" refresh failed: "+i;console.log(r);t._error.raiseEvent(t,r)}),o=!0)),e.set(n.id,n))}),o&&(this._networkLinks=e,this._changed.raiseEvent(this)),!0},yr});t("DataSources/Visualizer",["../Core/DeveloperError"],function(n){"use strict";function t(){n.throwInstantiationError()}return t.prototype.update=n.throwInstantiationError,t.prototype.getBoundingSphere=n.throwInstantiationError,t.prototype.isDestroyed=n.throwInstantiationError,t.prototype.destroy=n.throwInstantiationError,t});t("Renderer/ClearCommand",["../Core/Color","../Core/defaultValue","../Core/freezeObject"],function(n,t,i){"use strict";function r(n){n=t(n,t.EMPTY_OBJECT);this.color=n.color;this.depth=n.depth;this.stencil=n.stencil;this.renderState=n.renderState;this.framebuffer=n.framebuffer;this.owner=n.owner;this.pass=n.pass}return r.ALL=i(new r({color:new n(0,0,0,0),depth:1,stencil:0})),r.prototype.execute=function(n,t){n.clear(this,t)},r});t("Renderer/ComputeCommand",["../Core/defaultValue","./Pass"],function(n,t){"use strict";function i(i){i=n(i,n.EMPTY_OBJECT);this.vertexArray=i.vertexArray;this.fragmentShaderSource=i.fragmentShaderSource;this.shaderProgram=i.shaderProgram;this.uniformMap=i.uniformMap;this.outputTexture=i.outputTexture;this.preExecute=i.preExecute;this.postExecute=i.postExecute;this.persists=n(i.persists,!1);this.pass=t.COMPUTE;this.owner=i.owner}return i.prototype.execute=function(n){n.execute(this)},i});t("Shaders/ViewportQuadVS",[],function(){"use strict";return"attribute vec4 position;\nattribute vec2 textureCoordinates;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_Position = position;\nv_textureCoordinates = textureCoordinates;\n}\n"});t("Renderer/ComputeEngine",["../Core/BoundingRectangle","../Core/Check","../Core/Color","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/PrimitiveType","../Shaders/ViewportQuadVS","./ClearCommand","./DrawCommand","./Framebuffer","./RenderState","./ShaderProgram"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function y(n){this._context=n}function b(n,t){return new c({context:n,colorTextures:[t],destroyAttachments:!1})}function k(n,t){return a.fromCache({context:n,vertexShaderSource:o,fragmentShaderSource:t,attributeLocations:{position:0,textureCoordinates:1}})}function d(t,i){return r(v)&&v.viewport.width===t&&v.viewport.height===i||(v=l.fromCache({viewport:new n(0,0,t,i)})),v}var v,p=new h({primitiveType:e.TRIANGLES}),w=new s({color:new i(0,0,0,0)});return y.prototype.execute=function(n){var i;if(t.defined("computeCommand",n),r(n.preExecute)&&n.preExecute(n),!r(n.fragmentShaderSource)&&!r(n.shaderProgram))throw new f("computeCommand.fragmentShaderSource or computeCommand.shaderProgram is required.");t.defined("computeCommand.outputTexture",n.outputTexture);var e=n.outputTexture,a=e.width,v=e.height,u=this._context,h=r(n.vertexArray)?n.vertexArray:u.getViewportQuadVertexArray(),c=r(n.shaderProgram)?n.shaderProgram:k(u,n.fragmentShaderSource),o=b(u,e),l=d(a,v),y=n.uniformMap,s=w;s.framebuffer=o;s.renderState=l;s.execute(u);i=p;i.vertexArray=h;i.renderState=l;i.shaderProgram=c;i.uniformMap=y;i.framebuffer=o;i.execute(u);o.destroy();n.persists||(c.destroy(),r(n.vertexArray)&&h.destroy());r(n.postExecute)&&n.postExecute(e)},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return u(this)},y});t("Renderer/PassState",[],function(){"use strict";function n(n){this.context=n;this.framebuffer=undefined;this.blendingEnabled=undefined;this.scissorTest=undefined;this.viewport=undefined}return n});t("Renderer/ShaderCache",["../Core/defined","../Core/defineProperties","../Core/destroyObject","./ShaderProgram","./ShaderSource"],function(n,t,i,r,u){"use strict";function f(n){this._context=n;this._shaders={};this._numberOfShaders=0;this._shadersToRelease={}}function e(n,t){for(var u,f,r=t.derivedKeywords,o=r.length,i=0;i<o;++i)u=r[i]+t.keyword,f=n._shaders[u],e(n,f);delete n._shaders[t.keyword];t.shaderProgram.finalDestroy()}return t(f.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}}),f.prototype.replaceShaderProgram=function(t){return n(t.shaderProgram)&&t.shaderProgram.destroy(),this.getShaderProgram(t)},f.prototype.getShaderProgram=function(t){var f=t.vertexShaderSource,e=t.fragmentShaderSource,c=t.attributeLocations,s,h;typeof f=="string"&&(f=new u({sources:[f]}));typeof e=="string"&&(e=new u({sources:[e]}));var l=f.createCombinedVertexShader(this._context),a=e.createCombinedFragmentShader(this._context),o=l+a+JSON.stringify(c),i;return n(this._shaders[o])?(i=this._shaders[o],delete this._shadersToRelease[o]):(s=this._context,h=new r({gl:s._gl,logShaderCompilation:s.logShaderCompilation,debugShaders:s.debugShaders,vertexShaderSource:f,vertexShaderText:l,fragmentShaderSource:e,fragmentShaderText:a,attributeLocations:c}),i={cache:this,shaderProgram:h,keyword:o,derivedKeywords:[],count:0},h._cachedShader=i,this._shaders[o]=i,++this._numberOfShaders),++i.count,i.shaderProgram},f.prototype.getDerivedShaderProgram=function(t,i){var u=t._cachedShader,f=i+u.keyword,r=this._shaders[f];return n(r)?r.shaderProgram:undefined},f.prototype.createDerivedShaderProgram=function(n,t,i){var h=n._cachedShader,c=t+h.keyword,f=i.vertexShaderSource,e=i.fragmentShaderSource,a=i.attributeLocations;typeof f=="string"&&(f=new u({sources:[f]}));typeof e=="string"&&(e=new u({sources:[e]}));var o=this._context,v=f.createCombinedVertexShader(o),y=e.createCombinedFragmentShader(o),s=new r({gl:o._gl,logShaderCompilation:o.logShaderCompilation,debugShaders:o.debugShaders,vertexShaderSource:f,vertexShaderText:v,fragmentShaderSource:e,fragmentShaderText:y,attributeLocations:a}),l={cache:this,shaderProgram:s,keyword:c,derivedKeywords:[],count:0};return h.derivedKeywords.push(t),s._cachedShader=l,this._shaders[c]=l,s},f.prototype.destroyReleasedShaderPrograms=function(){var n=this._shadersToRelease,t,i;for(t in n)n.hasOwnProperty(t)&&(i=n[t],e(this,i),--this._numberOfShaders);this._shadersToRelease={}},f.prototype.releaseShaderProgram=function(t){if(n(t)){var i=t._cachedShader;i&&--i.count==0&&(this._shadersToRelease[i.keyword]=i)}},f.prototype.isDestroyed=function(){return!1},f.prototype.destroy=function(){var n=this._shaders;for(var t in n)n.hasOwnProperty(t)&&n[t].shaderProgram.finalDestroy();return i(this)},f});t("Renderer/UniformState",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/EncodedCartesian3","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/OrthographicFrustum","../Core/Simon1994PlanetaryPositions","../Core/Transforms","../Scene/SceneMode","./Sampler"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function k(){this.globeDepthTexture=undefined;this._viewport=new n;this._viewportCartesian4=new r;this._viewportDirty=!1;this._viewportOrthographicMatrix=a.clone(a.IDENTITY);this._viewportTransformation=a.clone(a.IDENTITY);this._model=a.clone(a.IDENTITY);this._view=a.clone(a.IDENTITY);this._inverseView=a.clone(a.IDENTITY);this._projection=a.clone(a.IDENTITY);this._infiniteProjection=a.clone(a.IDENTITY);this._entireFrustum=new t;this._currentFrustum=new t;this._frustumPlanes=new r;this._log2FarDistance=undefined;this._log2FarPlusOne=undefined;this._log2NearDistance=undefined;this._frameState=undefined;this._temeToPseudoFixed=l.clone(a.IDENTITY);this._view3DDirty=!0;this._view3D=new a;this._inverseView3DDirty=!0;this._inverseView3D=new a;this._inverseModelDirty=!0;this._inverseModel=new a;this._inverseTransposeModelDirty=!0;this._inverseTransposeModel=new l;this._viewRotation=new l;this._inverseViewRotation=new l;this._viewRotation3D=new l;this._inverseViewRotation3D=new l;this._inverseProjectionDirty=!0;this._inverseProjection=new a;this._modelViewDirty=!0;this._modelView=new a;this._modelView3DDirty=!0;this._modelView3D=new a;this._modelViewRelativeToEyeDirty=!0;this._modelViewRelativeToEye=new a;this._inverseModelViewDirty=!0;this._inverseModelView=new a;this._inverseModelView3DDirty=!0;this._inverseModelView3D=new a;this._viewProjectionDirty=!0;this._viewProjection=new a;this._inverseViewProjectionDirty=!0;this._inverseViewProjection=new a;this._modelViewProjectionDirty=!0;this._modelViewProjection=new a;this._inverseModelViewProjectionDirty=!0;this._inverseModelViewProjection=new a;this._modelViewProjectionRelativeToEyeDirty=!0;this._modelViewProjectionRelativeToEye=new a;this._modelViewInfiniteProjectionDirty=!0;this._modelViewInfiniteProjection=new a;this._normalDirty=!0;this._normal=new l;this._normal3DDirty=!0;this._normal3D=new l;this._inverseNormalDirty=!0;this._inverseNormal=new l;this._inverseNormal3DDirty=!0;this._inverseNormal3D=new l;this._encodedCameraPositionMCDirty=!0;this._encodedCameraPositionMC=new h;this._cameraPosition=new i;this._sunPositionWC=new i;this._sunPositionColumbusView=new i;this._sunDirectionWC=new i;this._sunDirectionEC=new i;this._moonDirectionEC=new i;this._pass=undefined;this._mode=undefined;this._mapProjection=undefined;this._cameraDirection=new i;this._cameraRight=new i;this._cameraUp=new i;this._frustum2DWidth=0;this._eyeHeight2D=new t;this._resolutionScale=1;this._orthographicIn3D=!1;this._backgroundColor=new f;this._brdfLut=new b;this._environmentMap=new b;this._fogDensity=undefined;this._invertClassificationColor=undefined;this._imagerySplitPosition=0;this._pixelSizePerMeter=undefined;this._geometricToleranceOverMeter=undefined;this._minimumDisableDepthTestDistance=undefined}function ft(n,t){a.clone(t,n._view);a.getRotation(t,n._viewRotation);n._view3DDirty=!0;n._inverseView3DDirty=!0;n._modelViewDirty=!0;n._modelView3DDirty=!0;n._modelViewRelativeToEyeDirty=!0;n._inverseModelViewDirty=!0;n._inverseModelView3DDirty=!0;n._viewProjectionDirty=!0;n._inverseViewProjectionDirty=!0;n._modelViewProjectionDirty=!0;n._modelViewProjectionRelativeToEyeDirty=!0;n._modelViewInfiniteProjectionDirty=!0;n._normalDirty=!0;n._inverseNormalDirty=!0;n._normal3DDirty=!0;n._inverseNormal3DDirty=!0}function et(n,t){a.clone(t,n._inverseView);a.getRotation(t,n._inverseViewRotation)}function ot(n,t){a.clone(t,n._projection);n._inverseProjectionDirty=!0;n._viewProjectionDirty=!0;n._inverseViewProjectionDirty=!0;n._modelViewProjectionDirty=!0;n._modelViewProjectionRelativeToEyeDirty=!0}function st(n,t){a.clone(t,n._infiniteProjection);n._modelViewInfiniteProjectionDirty=!0}function ht(n,t){i.clone(t.positionWC,n._cameraPosition);i.clone(t.directionWC,n._cameraDirection);i.clone(t.rightWC,n._cameraRight);i.clone(t.upWC,n._cameraUp);n._encodedCameraPositionMCDirty=!0}function ct(n,t){var r;o(p.computeIcrfToFixedMatrix(t.time,d))||(d=p.computeTemeToPseudoFixedMatrix(t.time,d));r=y.computeSunPositionInEarthInertialFrame(t.time,n._sunPositionWC);l.multiplyByVector(d,r,r);i.normalize(r,n._sunDirectionWC);r=l.multiplyByVector(n.viewRotation3D,r,n._sunDirectionEC);i.normalize(r,r);r=y.computeMoonPositionInEarthInertialFrame(t.time,n._moonDirectionEC);l.multiplyByVector(d,r,r);l.multiplyByVector(n.viewRotation3D,r,r);i.normalize(r,r);var u=t.mapProjection,f=u.ellipsoid,e=f.cartesianToCartographic(n._sunPositionWC,tt);u.project(e,n._sunPositionColumbusView)}function it(n){if(n._viewportDirty){var t=n._viewport;a.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,n._viewportOrthographicMatrix);a.computeViewportTransformation(t,0,1,n._viewportTransformation);n._viewportDirty=!1}}function lt(n){n._inverseProjectionDirty&&(n._inverseProjectionDirty=!1,n._mode===w.SCENE2D||n._mode===w.MORPHING||n._orthographicIn3D?a.clone(a.ZERO,n._inverseProjection):a.inverse(n._projection,n._inverseProjection))}function at(n){n._modelViewDirty&&(n._modelViewDirty=!1,a.multiplyTransformation(n._view,n._model,n._modelView))}function vt(n){n._modelView3DDirty&&(n._modelView3DDirty=!1,a.multiplyTransformation(n.view3D,n._model,n._modelView3D))}function yt(n){n._inverseModelViewDirty&&(n._inverseModelViewDirty=!1,a.inverse(n.modelView,n._inverseModelView))}function pt(n){n._inverseModelView3DDirty&&(n._inverseModelView3DDirty=!1,a.inverse(n.modelView3D,n._inverseModelView3D))}function wt(n){n._viewProjectionDirty&&(n._viewProjectionDirty=!1,a.multiply(n._projection,n._view,n._viewProjection))}function bt(n){n._inverseViewProjectionDirty&&(n._inverseViewProjectionDirty=!1,a.inverse(n.viewProjection,n._inverseViewProjection))}function kt(n){n._modelViewProjectionDirty&&(n._modelViewProjectionDirty=!1,a.multiply(n._projection,n.modelView,n._modelViewProjection))}function dt(n){if(n._modelViewRelativeToEyeDirty){n._modelViewRelativeToEyeDirty=!1;var i=n.modelView,t=n._modelViewRelativeToEye;t[0]=i[0];t[1]=i[1];t[2]=i[2];t[3]=i[3];t[4]=i[4];t[5]=i[5];t[6]=i[6];t[7]=i[7];t[8]=i[8];t[9]=i[9];t[10]=i[10];t[11]=i[11];t[12]=0;t[13]=0;t[14]=0;t[15]=i[15]}}function gt(n){n._inverseModelViewProjectionDirty&&(n._inverseModelViewProjectionDirty=!1,a.inverse(n.modelViewProjection,n._inverseModelViewProjection))}function ni(n){n._modelViewProjectionRelativeToEyeDirty&&(n._modelViewProjectionRelativeToEyeDirty=!1,a.multiply(n._projection,n.modelViewRelativeToEye,n._modelViewProjectionRelativeToEye))}function ti(n){n._modelViewInfiniteProjectionDirty&&(n._modelViewInfiniteProjectionDirty=!1,a.multiply(n._infiniteProjection,n.modelView,n._modelViewInfiniteProjection))}function ii(n){if(n._normalDirty){n._normalDirty=!1;var t=n._normal;a.getRotation(n.inverseModelView,t);l.transpose(t,t)}}function ri(n){if(n._normal3DDirty){n._normal3DDirty=!1;var t=n._normal3D;a.getRotation(n.inverseModelView3D,t);l.transpose(t,t)}}function ui(n){n._inverseNormalDirty&&(n._inverseNormalDirty=!1,a.getRotation(n.inverseModelView,n._inverseNormal))}function fi(n){n._inverseNormal3DDirty&&(n._inverseNormal3DDirty=!1,a.getRotation(n.inverseModelView3D,n._inverseNormal3D))}function rt(n){n._encodedCameraPositionMCDirty&&(n._encodedCameraPositionMCDirty=!1,a.multiplyByPoint(n.inverseModel,n._cameraPosition,g),h.fromCartesian(g,n._encodedCameraPositionMC))}function vi(n,t,r,u,f,e,s,h){var k=ei,l,v,y,b;k.x=n.y;k.y=n.z;k.z=n.x;l=oi;l.x=r.y;l.y=r.z;l.z=r.x;v=si;v.x=u.y;v.y=u.z;v.z=u.x;y=hi;y.x=t.y;y.y=t.z;y.z=t.x;e===w.SCENE2D&&(k.z=f*.5);b=s.unproject(k,ci);b.longitude=c.clamp(b.longitude,-Math.PI,Math.PI);b.latitude=c.clamp(b.latitude,-c.PI_OVER_TWO,c.PI_OVER_TWO);var nt=s.ellipsoid,d=nt.cartographicToCartesian(b,li),g=p.eastNorthUpToFixedFrame(d,nt,ai);return a.multiplyByPointAsVector(g,l,l),a.multiplyByPointAsVector(g,v,v),a.multiplyByPointAsVector(g,y,y),o(h)||(h=new a),h[0]=l.x,h[1]=v.x,h[2]=-y.x,h[3]=0,h[4]=l.y,h[5]=v.y,h[6]=-y.y,h[7]=0,h[8]=l.z,h[9]=v.z,h[10]=-y.z,h[11]=0,h[12]=-i.dot(l,d),h[13]=-i.dot(v,d),h[14]=i.dot(y,d),h[15]=1,h}function nt(n){n._view3DDirty&&(n._mode===w.SCENE3D?a.clone(n._view,n._view3D):vi(n._cameraPosition,n._cameraDirection,n._cameraRight,n._cameraUp,n._frustum2DWidth,n._mode,n._mapProjection,n._view3D),a.getRotation(n._view3D,n._viewRotation3D),n._view3DDirty=!1)}function ut(n){n._inverseView3DDirty&&(a.inverseTransformation(n.view3D,n._inverseView3D),a.getRotation(n._inverseView3D,n._inverseViewRotation3D),n._inverseView3DDirty=!1)}var d,tt,g;s(k.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(t){if(!n.equals(t,this._viewport)){n.clone(t,this._viewport);var i=this._viewport,r=this._viewportCartesian4;r.x=i.x;r.y=i.y;r.z=i.width;r.w=i.height;this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return it(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return it(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(n){a.clone(n,this._model);this._modelView3DDirty=!0;this._inverseModelView3DDirty=!0;this._inverseModelDirty=!0;this._inverseTransposeModelDirty=!0;this._modelViewDirty=!0;this._inverseModelViewDirty=!0;this._modelViewRelativeToEyeDirty=!0;this._inverseModelViewDirty=!0;this._modelViewProjectionDirty=!0;this._inverseModelViewProjectionDirty=!0;this._modelViewProjectionRelativeToEyeDirty=!0;this._modelViewInfiniteProjectionDirty=!0;this._normalDirty=!0;this._inverseNormalDirty=!0;this._normal3DDirty=!0;this._inverseNormal3DDirty=!0;this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,a.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){var n=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,a.getRotation(this.inverseModel,n),l.transpose(n,n)),n}},view:{get:function(){return this._view}},view3D:{get:function(){return nt(this),this._view3D}},viewRotation:{get:function(){return nt(this),this._viewRotation}},viewRotation3D:{get:function(){return nt(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return ut(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return ut(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){return lt(this),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){return at(this),this._modelView}},modelView3D:{get:function(){return vt(this),this._modelView3D}},modelViewRelativeToEye:{get:function(){return dt(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){return yt(this),this._inverseModelView}},inverseModelView3D:{get:function(){return pt(this),this._inverseModelView3D}},viewProjection:{get:function(){return wt(this),this._viewProjection}},inverseViewProjection:{get:function(){return bt(this),this._inverseViewProjection}},modelViewProjection:{get:function(){return kt(this),this._modelViewProjection}},inverseModelViewProjection:{get:function(){return gt(this),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){return ni(this),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){return ti(this),this._modelViewInfiniteProjection}},normal:{get:function(){return ii(this),this._normal}},normal3D:{get:function(){return ri(this),this._normal3D}},inverseNormal:{get:function(){return ui(this),this._inverseNormal}},inverseNormal3D:{get:function(){return fi(this),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},log2FarDistance:{get:function(){return this._log2FarDistance}},log2FarPlusOne:{get:function(){return this._log2FarPlusOne}},log2NearDistance:{get:function(){return this._log2NearDistance}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},encodedCameraPositionMCHigh:{get:function(){return rt(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return rt(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},resolutionScale:{get:function(){return this._resolutionScale}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},imagerySplitPosition:{get:function(){return this._imagerySplitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}}});d=new l;tt=new u;k.prototype.updateCamera=function(n){ft(this,n.viewMatrix);et(this,n.inverseViewMatrix);ht(this,n);this._entireFrustum.x=n.frustum.near;this._entireFrustum.y=n.frustum.far;this.updateFrustum(n.frustum);this._orthographicIn3D=this._mode!==w.SCENE2D&&n.frustum instanceof v};k.prototype.updateFrustum=function(n){ot(this,n.projectionMatrix);o(n.infiniteProjectionMatrix)&&st(this,n.infiniteProjectionMatrix);this._currentFrustum.x=n.near;this._currentFrustum.y=n.far;this._log2FarDistance=2/c.log2(n.far+1);this._log2FarPlusOne=c.log2(n.far+1);this._log2NearDistance=c.log2(n.near);o(n._offCenterFrustum)&&(n=n._offCenterFrustum);this._frustumPlanes.x=n.top;this._frustumPlanes.y=n.bottom;this._frustumPlanes.z=n.left;this._frustumPlanes.w=n.right};k.prototype.updatePass=function(n){this._pass=n};k.prototype.update=function(n){var r,t,u,h,s,i,c;this._mode=n.mode;this._mapProjection=n.mapProjection;r=n.context._canvas;this._resolutionScale=r.width/r.clientWidth;t=n.camera;this.updateCamera(t);n.mode===w.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=this._frustum2DWidth*.5,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0);ct(this,n);u=n.brdfLutGenerator;h=o(u)?u.colorTexture:undefined;this._brdfLut=h;this._environmentMap=e(n.environmentMap,n.context.defaultCubeMap);this._fogDensity=n.fog.density;this._invertClassificationColor=n.invertClassificationColor;this._frameState=n;this._temeToPseudoFixed=p.computeTemeToPseudoFixedMatrix(n.time,this._temeToPseudoFixed);this._imagerySplitPosition=n.imagerySplitPosition*n.context.drawingBufferWidth;s=t.frustum.fov;i=this._viewport;c=i.height>i.width?Math.tan(.5*s)*2/i.height:Math.tan(.5*s)*2/i.width;this._geometricToleranceOverMeter=c*n.maximumScreenSpaceError;f.clone(n.backgroundColor,this._backgroundColor);this._minimumDisableDepthTestDistance=n.minimumDisableDepthTestDistance;this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance;this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};g=new i;var ei=new i,oi=new i,si=new i,hi=new i,ci=new u,li=new i,ai=new a;return k});t("Renderer/Context",["../Core/Check","../Core/clone","../Core/Color","../Core/ComponentDatatype","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Geometry","../Core/GeometryAttribute","../Core/Matrix4","../Core/PixelFormat","../Core/PrimitiveType","../Core/RuntimeError","../Core/WebGLConstants","../Shaders/ViewportQuadVS","./BufferUsage","./ClearCommand","./ContextLimits","./CubeMap","./DrawCommand","./PassState","./PixelDatatype","./RenderState","./ShaderCache","./ShaderProgram","./Texture","./UniformState","./VertexArray"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){"use strict";function kt(n,t){var i="WebGL Error:  ";switch(t){case n.INVALID_ENUM:i+="INVALID_ENUM";break;case n.INVALID_VALUE:i+="INVALID_VALUE";break;case n.INVALID_OPERATION:i+="INVALID_OPERATION";break;case n.OUT_OF_MEMORY:i+="OUT_OF_MEMORY";break;case n.CONTEXT_LOST_WEBGL:i+="CONTEXT_LOST_WEBGL lost";break;default:i+="Unknown ("+t+")"}return i}function dt(n,t,i,r){for(var f=kt(n,r)+": "+t.name+"(",u=0;u<i.length;++u)u!==0&&(f+=", "),f+=i[u];return f+");"}function gt(n,t,i){var r=n.getError();if(r!==n.NO_ERROR)throw new p(dt(n,t,i,r));}function ni(n,t,i){return{get:function(){var r=n[t];return i(n,"get: "+t,r),n[t]},set:function(r){n[t]=r;i(n,"set: "+t,r)}}}function ti(n,t){function f(i){return function(){var r=i.apply(n,arguments);return t(n,i,arguments),r}}var r,i,u;if(!e(t))return n;r={};for(i in n)u=n[i],u instanceof Function?r[i]=f(u):Object.defineProperty(r,i,ni(n,i,t));return r}function ct(n,t){for(var r,u=t.length,i=0;i<u;++i)if(r=n.getExtension(t[i]),r)return r;return undefined}function lt(r,o){var h,s,d,nt,tt,kt,dt,v,rt,et,ot,ht,lt,at,vt,l,a,y,b,wt;if(typeof WebGLRenderingContext=="undefined")throw new p("The browser does not support WebGL.  Visit http://get.webgl.org.");n.defined("canvas",r);this._canvas=r;o=t(o,!0);o=f(o,{});o.allowTextureFilterAnisotropic=f(o.allowTextureFilterAnisotropic,!0);h=f(o.webgl,{});h.alpha=f(h.alpha,!1);h.stencil=f(h.stencil,!0);var gt=f(o.requestWebgl2,!1)&&typeof WebGL2RenderingContext!="undefined",k=!1,c,bt=o.getWebGLStub;if(e(bt))c=bt(r,h);else if(gt&&(c=r.getContext("webgl2",h)||r.getContext("experimental-webgl2",h)||undefined,e(c)&&(k=!0)),e(c)||(c=r.getContext("webgl",h)||r.getContext("experimental-webgl",h)||undefined),!e(c))throw new p("The browser supports WebGL, but initialization failed.");this._originalGLContext=c;this._gl=c;this._webgl2=k;this._id=u();this.validateFramebuffer=!1;this.validateShaderProgram=!1;this.logShaderCompilation=!1;this._throwOnWebGLError=!1;this._shaderCache=new ft(this);s=c;this._stencilBits=s.getParameter(s.STENCIL_BITS);g._maximumCombinedTextureImageUnits=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);g._maximumCubeMapSize=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE);g._maximumFragmentUniformVectors=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS);g._maximumTextureImageUnits=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS);g._maximumRenderbufferSize=s.getParameter(s.MAX_RENDERBUFFER_SIZE);g._maximumTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE);g._maximumVaryingVectors=s.getParameter(s.MAX_VARYING_VECTORS);g._maximumVertexAttributes=s.getParameter(s.MAX_VERTEX_ATTRIBS);g._maximumVertexTextureImageUnits=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS);g._maximumVertexUniformVectors=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS);d=s.getParameter(s.ALIASED_LINE_WIDTH_RANGE);g._minimumAliasedLineWidth=d[0];g._maximumAliasedLineWidth=d[1];nt=s.getParameter(s.ALIASED_POINT_SIZE_RANGE);g._minimumAliasedPointSize=nt[0];g._maximumAliasedPointSize=nt[1];tt=s.getParameter(s.MAX_VIEWPORT_DIMS);g._maximumViewportWidth=tt[0];g._maximumViewportHeight=tt[1];kt=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);g._highpFloatSupported=kt.precision!==0;dt=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_INT);g._highpIntSupported=dt.rangeMax!==0;this._antialias=s.getContextAttributes().antialias;this._standardDerivatives=!!ct(s,["OES_standard_derivatives"]);this._blendMinmax=!!ct(s,["EXT_blend_minmax"]);this._elementIndexUint=!!ct(s,["OES_element_index_uint"]);this._depthTexture=!!ct(s,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]);this._fragDepth=!!ct(s,["EXT_frag_depth"]);this._debugShaders=ct(s,["WEBGL_debug_shaders"]);this._textureFloat=!!ct(s,["OES_texture_float"]);this._textureHalfFloat=!!ct(s,["OES_texture_half_float"]);this._textureFloatLinear=!!ct(s,["OES_texture_float_linear"]);this._textureHalfFloatLinear=!!ct(s,["OES_texture_half_float_linear"]);this._colorBufferFloat=!!ct(s,["EXT_color_buffer_float","WEBGL_color_buffer_float"]);this._colorBufferHalfFloat=!!ct(s,["EXT_color_buffer_half_float"]);this._s3tc=!!ct(s,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]);this._pvrtc=!!ct(s,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]);this._etc1=!!ct(s,["WEBGL_compressed_texture_etc1"]);v=o.allowTextureFilterAnisotropic?ct(s,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):undefined;this._textureFilterAnisotropic=v;g._maximumTextureFilterAnisotropy=e(v)?s.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;k?(b=this,rt=function(){return b._gl.createVertexArray()},et=function(n){b._gl.bindVertexArray(n)},ot=function(n){b._gl.deleteVertexArray(n)},ht=function(n,t,i,r,u){s.drawElementsInstanced(n,t,i,r,u)},lt=function(n,t,i,r){s.drawArraysInstanced(n,t,i,r)},at=function(n,t){s.vertexAttribDivisor(n,t)},vt=function(n){s.drawBuffers(n)}):(l=ct(s,["OES_vertex_array_object"]),e(l)&&(rt=function(){return l.createVertexArrayOES()},et=function(n){l.bindVertexArrayOES(n)},ot=function(n){l.deleteVertexArrayOES(n)}),a=ct(s,["ANGLE_instanced_arrays"]),e(a)&&(ht=function(n,t,i,r,u){a.drawElementsInstancedANGLE(n,t,i,r,u)},lt=function(n,t,i,r){a.drawArraysInstancedANGLE(n,t,i,r)},at=function(n,t){a.vertexAttribDivisorANGLE(n,t)}),y=ct(s,["WEBGL_draw_buffers"]),e(y)&&(vt=function(n){y.drawBuffersWEBGL(n)}));this.glCreateVertexArray=rt;this.glBindVertexArray=et;this.glDeleteVertexArray=ot;this.glDrawElementsInstanced=ht;this.glDrawArraysInstanced=lt;this.glVertexAttribDivisor=at;this.glDrawBuffers=vt;this._vertexArrayObject=!!l;this._instancedArrays=!!a;this._drawBuffers=!!y;g._maximumDrawBuffers=this.drawBuffers?s.getParameter(w.MAX_DRAW_BUFFERS):1;g._maximumColorAttachments=this.drawBuffers?s.getParameter(w.MAX_COLOR_ATTACHMENTS):1;this._clearColor=new i(0,0,0,0);this._clearDepth=1;this._clearStencil=0;var ni=new st,yt=new it(this),pt=ut.fromCache();for(this._defaultPassState=yt,this._defaultRenderState=pt,this._defaultTexture=undefined,this._defaultCubeMap=undefined,this._us=ni,this._currentRenderState=pt,this._currentPassState=yt,this._currentFramebuffer=undefined,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1,wt=0;wt<g._maximumVertexAttributes;wt++)this._vertexAttribDivisors.push(0);this._pickObjects={};this._nextPickColor=new Uint32Array(1);this.options=o;this.cache={};ut.apply(s,pt,yt)}function ri(n){var t,r,i;if(n.validateFramebuffer&&(t=n._gl,r=t.checkFramebufferStatus(t.FRAMEBUFFER),r!==t.FRAMEBUFFER_COMPLETE)){switch(r){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:i="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:i="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:i="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case t.FRAMEBUFFER_UNSUPPORTED:i="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new h(i);}}function wt(n,t,i,r){var u=n._currentRenderState,f=n._currentPassState;n._currentRenderState=t;n._currentPassState=i;ut.partialApply(n._gl,u,t,f,i,r)}function vt(n,t){var i,r;t!==n._currentFramebuffer&&(n._currentFramebuffer=t,i=at,e(t)?(t._bind(),ri(n),i=t._getActiveColorAttachments()):(r=n._gl,r.bindFramebuffer(r.FRAMEBUFFER,null)),n.drawBuffers&&n.glDrawBuffers(i))}function ui(n,t,i,r,u){if(e(t)&&u.depthTest&&u.depthTest.enabled&&!t.hasDepthAttachment)throw new h("The depth test can not be enabled (drawCommand.renderState.depthTest.enabled) because the framebuffer (drawCommand.framebuffer) does not have a depth or depth-stencil renderbuffer.");vt(n,t);wt(n,u,i,!1);r._bind();n._maxFrameTextureUnitIndex=Math.max(n._maxFrameTextureUnitIndex,r.maximumTextureUnitIndex)}function fi(t,i,r,u){var v=i._primitiveType,p=i._vertexArray,s=i._offset,o=i._count,c=i.instanceCount,l;if(!y.validate(v))throw new h("drawCommand.primitiveType is required and must be valid.");if(n.defined("drawCommand.vertexArray",p),n.typeOf.number.greaterThanOrEquals("drawCommand.offset",s,0),e(o)&&n.typeOf.number.greaterThanOrEquals("drawCommand.count",o,0),n.typeOf.number.greaterThanOrEquals("drawCommand.instanceCount",c,0),c>0&&!t.instancedArrays)throw new h("Instanced arrays extension is not supported");t._us.model=f(i._modelMatrix,a.IDENTITY);r._setUniforms(u,t._us,t.validateShaderProgram);p._bind();l=p.indexBuffer;e(l)?(s=s*l.bytesPerIndex,o=f(o,l.numberOfIndices),c===0?t._gl.drawElements(v,o,l.indexDatatype,s):t.glDrawElementsInstanced(v,o,l.indexDatatype,s,c)):(o=f(o,p.numberOfVertices),c===0?t._gl.drawArrays(v,s,o):t.glDrawArraysInstanced(v,s,o,c));p._unBind()}function pt(n,t,i){this._pickObjects=n;this.key=t;this.color=i}var ii={},at,bt,yt;return o(lt.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},etc1:{get:function(){return this._etc1}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(n){this._throwOnWebGLError=n;this._gl=ti(this._originalGLContext,n?gt:undefined)}},defaultTexture:{get:function(){return this._defaultTexture===undefined&&(this._defaultTexture=new ot({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultCubeMap:{get:function(){if(this._defaultCubeMap===undefined){var n={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new nt({context:this,source:{positiveX:n,negativeX:n,positiveY:n,negativeY:n,positiveZ:n,negativeZ:n},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return ii}}}),typeof WebGLRenderingContext!="undefined"&&(at=[w.BACK]),bt=new d,lt.prototype.clear=function(n,t){var c,l;n=f(n,bt);t=f(t,this._defaultPassState);var r=this._gl,o=0,u=n.color,s=n.depth,h=n.stencil;e(u)&&(i.equals(this._clearColor,u)||(i.clone(u,this._clearColor),r.clearColor(u.red,u.green,u.blue,u.alpha)),o|=r.COLOR_BUFFER_BIT);e(s)&&(s!==this._clearDepth&&(this._clearDepth=s,r.clearDepth(s)),o|=r.DEPTH_BUFFER_BIT);e(h)&&(h!==this._clearStencil&&(this._clearStencil=h,r.clearStencil(h)),o|=r.STENCIL_BUFFER_BIT);c=f(n.renderState,this._defaultRenderState);wt(this,c,t,!0);l=f(n.framebuffer,t.framebuffer);vt(this,l);r.clear(o)},lt.prototype.draw=function(t,i,r,u){n.defined("drawCommand",t);n.defined("drawCommand.shaderProgram",t._shaderProgram);i=f(i,this._defaultPassState);var e=f(t._framebuffer,i.framebuffer),o=f(t._renderState,this._defaultRenderState);r=f(r,t._shaderProgram);u=f(u,t._uniformMap);ui(this,e,i,r,o);fi(this,t,r,u)},lt.prototype.endFrame=function(){var n=this._gl,i,r,t;for(n.useProgram(null),this._currentFramebuffer=undefined,n.bindFramebuffer(n.FRAMEBUFFER,null),i=at,this.drawBuffers&&this.glDrawBuffers(i),r=this._maxFrameTextureUnitIndex,this._maxFrameTextureUnitIndex=0,t=0;t<r;++t)n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,null),n.bindTexture(n.TEXTURE_CUBE_MAP,null)},lt.prototype.readPixels=function(t){var u=this._gl,r,h;t=f(t,f.EMPTY_OBJECT);var c=Math.max(f(t.x,0),0),l=Math.max(f(t.y,0),0),o=f(t.width,u.drawingBufferWidth),s=f(t.height,u.drawingBufferHeight),i=t.framebuffer;return n.typeOf.number.greaterThan("readState.width",o,0),n.typeOf.number.greaterThan("readState.height",s,0),r=rt.UNSIGNED_BYTE,e(i)&&i.numberOfColorAttachments>0&&(r=i.getColorTexture(0).pixelDatatype),h=v.createTypedArray(v.RGBA,r,o,s),vt(this,i),u.readPixels(c,l,o,s,v.RGBA,r,h),h},yt={position:0,textureCoordinates:1},lt.prototype.getViewportQuadVertexArray=function(){var n=this.cache.viewportQuad_vertexArray,t;return e(n)||(t=new c({attributes:{position:new l({componentDatatype:r.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new l({componentDatatype:r.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:y.TRIANGLES}),n=ht.fromGeometry({context:this,geometry:t,attributeLocations:yt,bufferUsage:k.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=n),n},lt.prototype.createViewportQuadCommand=function(n,t){return t=f(t,f.EMPTY_OBJECT),new tt({vertexArray:this.getViewportQuadVertexArray(),primitiveType:y.TRIANGLES,renderState:t.renderState,shaderProgram:et.fromCache({context:this,vertexShaderSource:b,fragmentShaderSource:n,attributeLocations:yt}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})},lt.prototype.getObjectByPickColor=function(t){return n.defined("pickColor",t),this._pickObjects[t.toRgba()]},o(pt.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(n){this._pickObjects[this.key]=n}}}),pt.prototype.destroy=function(){return delete this._pickObjects[this.key],undefined},lt.prototype.createPickId=function(t){n.defined("object",t);++this._nextPickColor[0];var r=this._nextPickColor[0];if(r===0)throw new p("Out of unique Pick IDs.");return this._pickObjects[r]=t,new pt(this._pickObjects,r,i.fromRgba(r))},lt.prototype.isDestroyed=function(){return!1},lt.prototype.destroy=function(){var n=this.cache,t,i;for(t in n)n.hasOwnProperty(t)&&(i=n[t],e(i.destroy)&&i.destroy());return this._shaderCache=this._shaderCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),s(this)},lt});t("Renderer/loadCubeMap",["../Core/Check","../Core/defined","../Core/DeveloperError","../Core/Resource","../ThirdParty/when","./CubeMap"],function(n,t,i,r,u,f){"use strict";function e(e,o){if(n.defined("context",e),!t(o)||!t(o.positiveX)||!t(o.negativeX)||!t(o.positiveY)||!t(o.negativeY)||!t(o.positiveZ)||!t(o.negativeZ))throw new i("urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");var s=[r.createIfNeeded(o.positiveX).fetchImage(),r.createIfNeeded(o.negativeX).fetchImage(),r.createIfNeeded(o.positiveY).fetchImage(),r.createIfNeeded(o.negativeY).fetchImage(),r.createIfNeeded(o.positiveZ).fetchImage(),r.createIfNeeded(o.negativeZ).fetchImage()];return u.all(s,function(n){return new f({context:e,source:{positiveX:n[0],negativeX:n[1],positiveY:n[2],negativeY:n[3],positiveZ:n[4],negativeZ:n[5]}})})}return e});t("Renderer/RenderbufferFormat",["../Core/freezeObject","../Core/WebGLConstants"],function(n,t){"use strict";var i={RGBA4:t.RGBA4,RGB5_A1:t.RGB5_A1,RGB565:t.RGB565,DEPTH_COMPONENT16:t.DEPTH_COMPONENT16,STENCIL_INDEX8:t.STENCIL_INDEX8,DEPTH_STENCIL:t.DEPTH_STENCIL,validate:function(n){return n===i.RGBA4||n===i.RGB5_A1||n===i.RGB565||n===i.DEPTH_COMPONENT16||n===i.STENCIL_INDEX8||n===i.DEPTH_STENCIL}};return n(i)});t("Renderer/Renderbuffer",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","./ContextLimits","./RenderbufferFormat"],function(n,t,i,r,u,f,e,o){"use strict";function s(r){r=t(r,t.EMPTY_OBJECT);n.defined("options.context",r.context);var a=r.context,u=a._gl,s=e.maximumRenderbufferSize,l=t(r.format,o.RGBA4),h=i(r.width)?r.width:u.drawingBufferWidth,c=i(r.height)?r.height:u.drawingBufferHeight;if(!o.validate(l))throw new f("Invalid format.");if(n.typeOf.number.greaterThan("width",h,0),h>s)throw new f("Width must be less than or equal to the maximum renderbuffer size ("+s+").  Check maximumRenderbufferSize.");if(n.typeOf.number.greaterThan("height",c,0),c>s)throw new f("Height must be less than or equal to the maximum renderbuffer size ("+s+").  Check maximumRenderbufferSize.");this._gl=u;this._format=l;this._width=h;this._height=c;this._renderbuffer=this._gl.createRenderbuffer();u.bindRenderbuffer(u.RENDERBUFFER,this._renderbuffer);u.renderbufferStorage(u.RENDERBUFFER,l,h,c);u.bindRenderbuffer(u.RENDERBUFFER,null)}return r(s.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}}),s.prototype._getRenderbuffer=function(){return this._renderbuffer},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),u(this)},s});t("Scene/DiscardMissingTileImagePolicy",["../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/getImagePixels","../Core/Resource","../ThirdParty/when"],function(n,t,i,r,u,f){"use strict";function e(e){function h(n){var i,u,h;if(t(n.blob)&&(o._missingImageByteLength=n.blob.size),i=r(n),e.disableCheckIfAllPixelsAreTransparent){var f=!0,l=n.width,s=e.pixelsToCheck;for(u=0,h=s.length;f&&u<h;++u){var c=s[u],a=c.x*4+c.y*l,v=i[a+3];v>0&&(f=!1)}f&&(i=undefined)}o._missingImagePixels=i;o._isReady=!0}function c(){o._missingImagePixels=undefined;o._isReady=!0}if(e=n(e,n.EMPTY_OBJECT),!t(e.missingImageUrl))throw new i("options.missingImageUrl is required.");if(!t(e.pixelsToCheck))throw new i("options.pixelsToCheck is required.");this._pixelsToCheck=e.pixelsToCheck;this._missingImagePixels=undefined;this._missingImageByteLength=undefined;this._isReady=!1;var s=u.createIfNeeded(e.missingImageUrl),o=this;f(s.fetchImage(!0),h,c)}return e.prototype.isReady=function(){return this._isReady},e.prototype.shouldDiscardImage=function(n){var e,o,c,l,u,a,s,v,f,h;if(!this._isReady)throw new i("shouldDiscardImage must not be called before the discard policy is ready.");if((e=this._pixelsToCheck,o=this._missingImagePixels,!t(o))||t(n.blob)&&n.blob.size!==this._missingImageByteLength)return!1;for(c=r(n),l=n.width,u=0,a=e.length;u<a;++u)for(s=e[u],v=s.x*4+s.y*l,f=0;f<4;++f)if(h=v+f,c[h]!==o[h])return!1;return!0},e});t("Scene/ImageryLayerFeatureInfo",["../Core/defined"],function(n){"use strict";function t(){this.name=undefined;this.description=undefined;this.position=undefined;this.data=undefined;this.imageryLayer=undefined}return t.prototype.configureNameFromProperties=function(t){var r=10,u,i,f;for(i in t)t.hasOwnProperty(i)&&t[i]&&(f=i.toLowerCase(),r>1&&f==="name"?(r=1,u=i):r>2&&f==="title"?(r=2,u=i):r>3&&/name/i.test(i)?(r=3,u=i):r>4&&/title/i.test(i)&&(r=4,u=i));n(u)&&(this.name=t[u])},t.prototype.configureDescriptionFromProperties=function(t){function i(t){var f='<table class="cesium-infoBox-defaultTable">',r,u;for(r in t)t.hasOwnProperty(r)&&(u=t[r],n(u)&&(f+=typeof u=="object"?"<tr><td>"+r+"<\/td><td>"+i(u)+"<\/td><\/tr>":"<tr><td>"+r+"<\/td><td>"+u+"<\/td><\/tr>"));return f+"<\/table>"}this.description=i(t)},t});t("Scene/ImageryProvider",["../Core/Check","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/loadCRN","../Core/loadKTX","../Core/Resource"],function(n,t,i,r,u,f,e){"use strict";function o(){this.defaultAlpha=undefined;this.defaultBrightness=undefined;this.defaultContrast=undefined;this.defaultHue=undefined;this.defaultSaturation=undefined;this.defaultGamma=undefined;this.defaultMinificationFilter=undefined;this.defaultMagnificationFilter=undefined;r.throwInstantiationError()}i(o.prototype,{ready:{get:r.throwInstantiationError},readyPromise:{get:r.throwInstantiationError},rectangle:{get:r.throwInstantiationError},tileWidth:{get:r.throwInstantiationError},tileHeight:{get:r.throwInstantiationError},maximumLevel:{get:r.throwInstantiationError},minimumLevel:{get:r.throwInstantiationError},tilingScheme:{get:r.throwInstantiationError},tileDiscardPolicy:{get:r.throwInstantiationError},errorEvent:{get:r.throwInstantiationError},credit:{get:r.throwInstantiationError},proxy:{get:r.throwInstantiationError},hasAlphaChannel:{get:r.throwInstantiationError}});o.prototype.getTileCredits=r.throwInstantiationError;o.prototype.requestImage=r.throwInstantiationError;o.prototype.pickFeatures=r.throwInstantiationError;var s=/\.ktx$/i,h=/\.crn$/i;return o.loadImage=function(i,r){n.defined("url",r);var o=e.createIfNeeded(r);return s.test(o)?f(o):h.test(o)?u(o):t(i.tileDiscardPolicy)?o.fetchImage(!0):o.fetchImage()},o});t("Scene/ArcGisMapServerImageryProvider",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/GeographicProjection","../Core/GeographicTilingScheme","../Core/Math","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../Core/WebMercatorProjection","../Core/WebMercatorTilingScheme","../ThirdParty/when","./DiscardMissingTileImagePolicy","./ImageryLayerFeatureInfo","./ImageryProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){"use strict";function tt(i){function nt(u){var o=u.tileInfo,l,nt;if(f(o)){if(e._tileWidth=o.rows,e._tileHeight=o.cols,o.spatialReference.wkid===102100||o.spatialReference.wkid===102113)e._tilingScheme=new b({ellipsoid:i.ellipsoid});else if(u.tileInfo.spatialReference.wkid===4326)e._tilingScheme=new c({ellipsoid:i.ellipsoid});else{l="Tile spatial reference WKID "+u.tileInfo.spatialReference.wkid+" is not supported.";h=p.handleError(h,e,e._errorEvent,l,undefined,undefined,undefined,g);return}if(e._maximumLevel=u.tileInfo.lods.length-1,f(u.fullExtent)){if(f(u.fullExtent.spatialReference)&&f(u.fullExtent.spatialReference.wkid))if(u.fullExtent.spatialReference.wkid===102100||u.fullExtent.spatialReference.wkid===102113){var v=new w,s=u.fullExtent,y=v.unproject(new t(Math.max(s.xmin,-e._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.max(s.ymin,-e._tilingScheme.ellipsoid.maximumRadius*Math.PI),0)),k=v.unproject(new t(Math.min(s.xmax,e._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.min(s.ymax,e._tilingScheme.ellipsoid.maximumRadius*Math.PI),0));e._rectangle=new a(y.longitude,y.latitude,k.longitude,k.latitude)}else if(u.fullExtent.spatialReference.wkid===4326)e._rectangle=a.fromDegrees(u.fullExtent.xmin,u.fullExtent.ymin,u.fullExtent.xmax,u.fullExtent.ymax);else{nt="fullExtent.spatialReference WKID "+u.fullExtent.spatialReference.wkid+" is not supported.";h=p.handleError(h,e,e._errorEvent,nt,undefined,undefined,undefined,g);return}}else e._rectangle=e._tilingScheme.rectangle;f(e._tileDiscardPolicy)||(e._tileDiscardPolicy=new d({missingImageUrl:it(e,0,0,e._maximumLevel).url,pixelsToCheck:[new n(0,0),new n(200,20),new n(20,200),new n(80,110),new n(160,130)],disableCheckIfAllPixelsAreTransparent:!0}));e._useTiles=!0}else e._useTiles=!1;f(u.copyrightText)&&u.copyrightText.length>0&&(e._credit=new r(u.copyrightText));e._ready=!0;e._readyPromise.resolve(!0);p.handleSuccess(h)}function tt(){var n="An error occurred while accessing "+e._resource.url+".";h=p.handleError(h,e,e._errorEvent,n,undefined,undefined,undefined,g);e._readyPromise.reject(new y(n))}function g(){var n=e._resource.getDerivedResource({queryParameters:{f:"json"}}),t=n.fetchJsonp();k(t,nt,tt)}var l,e,h;if(i=u(i,{}),!f(i.url))throw new o("options.url is required.");l=v.createIfNeeded(i.url);l.appendForwardSlash();f(i.token)&&l.setQueryParameters({token:i.token});this._resource=l;this._tileDiscardPolicy=i.tileDiscardPolicy;this._tileWidth=u(i.tileWidth,256);this._tileHeight=u(i.tileHeight,256);this._maximumLevel=i.maximumLevel;this._tilingScheme=u(i.tilingScheme,new c({ellipsoid:i.ellipsoid}));this._credit=undefined;this._useTiles=u(i.usePreCachedTilesIfAvailable,!0);this._rectangle=u(i.rectangle,this._tilingScheme.rectangle);this._layers=i.layers;this.enablePickFeatures=u(i.enablePickFeatures,!0);this._errorEvent=new s;this._ready=!1;this._readyPromise=k.defer();e=this;this._useTiles?g():(this._ready=!0,this._readyPromise.resolve(!0))}function it(n,t,i,r,u){var o;if(n._useTiles)o=n._resource.getDerivedResource({url:"tile/"+r+"/"+i+"/"+t,request:u});else{var e=n._tilingScheme.tileXYToNativeRectangle(t,i,r),s=e.west+","+e.south+","+e.east+","+e.north,f={bbox:s,size:n._tileWidth+","+n._tileHeight,format:"png",transparent:!0,f:"image"};n._tilingScheme.projection instanceof h?(f.bboxSR=4326,f.imageSR=4326):(f.bboxSR=3857,f.imageSR=3857);n.layers&&(f.layers="show:"+n.layers);o=n._resource.getDerivedResource({url:"export",request:u,queryParameters:f})}return o}return e(tt.prototype,{url:{get:function(){return this._resource._url}},token:{get:function(){return this._resource.queryParameters.token}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new o("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new o("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new o("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new o("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new o("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new o("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new o("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),tt.prototype.getTileCredits=function(){return undefined},tt.prototype.requestImage=function(n,t,i,r){if(!this._ready)throw new o("requestImage must not be called before the imagery provider is ready.");return nt.loadImage(this,it(this,n,t,i,r))},tt.prototype.pickFeatures=function(n,r,u,e,s){var c,a,v,y,p,b,k,d;if(!this._ready)throw new o("pickFeatures must not be called before the imagery provider is ready.");return this.enablePickFeatures?(c=this._tilingScheme.tileXYToNativeRectangle(n,r,u),this._tilingScheme.projection instanceof h?(a=l.toDegrees(e),v=l.toDegrees(s),y="4326"):(p=this._tilingScheme.projection.project(new i(e,s,0)),a=p.x,v=p.y,y="3857"),b="visible",f(this._layers)&&(b+=":"+this._layers),k={f:"json",tolerance:2,geometryType:"esriGeometryPoint",geometry:a+","+v,mapExtent:c.west+","+c.south+","+c.east+","+c.north,imageDisplay:this._tileWidth+","+this._tileHeight+",96",sr:y,layers:b},d=this._resource.getDerivedResource({url:"identify",queryParameters:k}),d.fetchJson().then(function(n){var s=[],h=n.results,o,r,u,e,c;if(!f(h))return s;for(o=0;o<h.length;++o)r=h[o],u=new g,u.data=r,u.name=r.value,u.properties=r.attributes,u.configureDescriptionFromProperties(r.attributes),r.geometryType==="esriGeometryPoint"&&r.geometry&&(e=r.geometry.spatialReference&&r.geometry.spatialReference.wkid?r.geometry.spatialReference.wkid:4326,e===4326||e===4283?u.position=i.fromDegrees(r.geometry.x,r.geometry.y,r.geometry.z):(e===102100||e===900913||e===3857)&&(c=new w,u.position=c.unproject(new t(r.geometry.x,r.geometry.y,r.geometry.z)))),s.push(u);return s})):undefined},tt});t("Scene/Cesium3DTileColorBlendMode",["../Core/freezeObject"],function(n){"use strict";return n({HIGHLIGHT:0,REPLACE:1,MIX:2})});t("Scene/getBinaryAccessor",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/ComponentDatatype","../Core/Matrix2","../Core/Matrix3","../Core/Matrix4"],function(n,t,i,r,u,f,e){"use strict";function h(n){var t=n.componentType,u,i,f;return u=typeof t=="string"?r.fromName(t):t,i=o[n.type],f=s[n.type],{componentsPerAttribute:i,classType:f,createArrayBufferView:function(n,t,f){return r.createArrayBufferView(u,n,t,i*f)}}}var o={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},s={SCALAR:undefined,VEC2:n,VEC3:t,VEC4:i,MAT2:u,MAT3:f,MAT4:e};return h});t("Scene/Cesium3DTileBatchTable",["../Core/arrayFill","../Core/Cartesian2","../Core/Cartesian4","../Core/Check","../Core/clone","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/PixelFormat","../Core/RuntimeError","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/Sampler","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","./AttributeType","./BlendingState","./Cesium3DTileColorBlendMode","./CullFace","./getBinaryAccessor","./StencilFunction","./StencilOperation"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at){"use strict";function vt(n,r,u,f,e){var c,o,l,a;if(this.featuresLength=r,this._translucentFeaturesLength=0,h(u)&&(c=u.extensions),this._extensions=s(c,{}),o=li(u),this._properties=o,this._batchTableHierarchy=ai(this,u,f),this._batchTableBinaryProperties=kt(r,o,f),this._showAlphaProperties=undefined,this._batchValues=undefined,this._batchValuesDirty=!1,this._batchTexture=undefined,this._defaultTexture=undefined,this._pickTexture=undefined,this._pickIds=[],this._content=n,this._colorChangedCallback=e,r>0){var v=Math.min(r,b.maximumTextureSize),y=Math.ceil(r/b.maximumTextureSize),p=1/v,k=p*.5,w=1/y,d=w*.5;l=new t(v,y);a=new i(p,k,w,d)}this._textureDimensions=l;this._textureStep=a}function li(n){var i={},t;if(!h(n))return i;for(t in n)n.hasOwnProperty(t)&&t!=="HIERARCHY"&&t!=="extensions"&&t!=="extras"&&(i[t]=u(n[t],!0));return i}function ai(n,t,i){if(h(t)){var r=n._extensions["3DTILES_batch_table_hierarchy"],u=t.HIERARCHY;if(h(u)&&(vt._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),n._extensions["3DTILES_batch_table_hierarchy"]=u,r=u),h(r))return vi(r,i)}}function vi(t,i){var r,p,a,l=t.instancesLength,v=t.classes,f=t.classIds,u=t.parentCounts,c=t.parentIds,y=l,w,b,k,d,g;if(h(f.byteOffset)&&(f.componentType=s(f.componentType,o.UNSIGNED_SHORT),f.type=et.SCALAR,a=ct(f),f=a.createArrayBufferView(i.buffer,i.byteOffset+f.byteOffset,l)),h(u))for(h(u.byteOffset)&&(u.componentType=s(u.componentType,o.UNSIGNED_SHORT),u.type=et.SCALAR,a=ct(u),u=a.createArrayBufferView(i.buffer,i.byteOffset+u.byteOffset,l)),w=new Uint16Array(l),y=0,r=0;r<l;++r)w[r]=y,y+=u[r];for(h(c)&&h(c.byteOffset)&&(c.componentType=s(c.componentType,o.UNSIGNED_SHORT),c.type=et.SCALAR,a=ct(c),c=a.createArrayBufferView(i.buffer,i.byteOffset+c.byteOffset,y)),b=v.length,r=0;r<b;++r){var tt=v[r].length,nt=v[r].instances,it=kt(tt,nt,i);v[r].instances=e(it,nt)}for(k=n(new Array(b),0),d=new Uint16Array(l),r=0;r<l;++r)p=f[r],d[r]=k[p],++k[p];return g={classes:v,classIds:f,classIndexes:d,parentCounts:u,parentIndexes:w,parentIds:c},yi(g),g}function yi(n){var i=dt,r,u,t;for(i.length=0,r=n.classIds,u=r.length,t=0;t<u;++t)gt(n,t,i)}function gt(n,t,i){var u=n.parentCounts,e=n.parentIds,l=n.parentIndexes,a=n.classIds,o=a.length,s,c,r,f;if(h(e)){if(t>=o)throw new v("Parent index "+t+" exceeds the total number of instances: "+o);if(i.indexOf(t)>-1)throw new v("Circular dependency detected in the batch table hierarchy.");for(i.push(t),s=h(u)?u[t]:1,c=h(u)?l[t]:t,r=0;r<s;++r)f=e[c+r],f!==t&&gt(n,f,i);i.pop(t)}}function kt(n,t,i){var f,r,u,e,s,c;for(r in t)if(t.hasOwnProperty(r)&&(u=t[r],e=u.byteOffset,h(e))){if(s=u.componentType,c=u.type,!h(s))throw new w("componentType is required.");if(!h(c))throw new w("type is required.");if(!h(i))throw new w("Property "+r+" requires a batch table binary.");var o=ct(u),l=o.componentsPerAttribute,a=o.classType,v=o.createArrayBufferView(i.buffer,i.byteOffset+e,n);h(f)||(f={});f[r]={typedArray:v,componentCount:l,type:a}}return f}function ni(n){var t=n._textureDimensions;return t.x*t.y*4}function ti(t){if(!h(t._batchValues)){var r=ni(t),i=new Uint8Array(r);n(i,255);t._batchValues=i}return t._batchValues}function ii(t){if(!h(t._showAlphaProperties)){var r=2*t.featuresLength,i=new Uint8Array(r);n(i,255);t._showAlphaProperties=i}return t._showAlphaProperties}function yt(n,t){if(!h(n)||n<0||n>t)throw new v("batchId is required and between zero and featuresLength - 1 ("+t-+ ').');}function fi(n,t){var i=n.typedArray,r=n.componentCount;return r===1?i[t]:n.type.unpack(i,t*r)}function ei(n,t,i){var r=n.typedArray,u=n.componentCount;u===1?r[t]=i:n.type.pack(i,r,t*u)}function ki(n,t,i){var a=n.classIds,v=n.parentCounts,y=n.parentIds,p=n.parentIndexes,w=a.length,u=pi,e,r,o,c,l,f,s;for(u.length=Math.max(u.length,w),e=++bi,r=wi,r.length=0,r.push(t);r.length>0;)if(t=r.pop(),u[t]!==e){if(u[t]=e,o=i(n,t),h(o))return o;for(c=v[t],l=p[t],f=0;f<c;++f)s=y[l+f],s!==t&&r.push(s)}}function di(n,t,i){for(var f=!0,r,u;f;){if(r=i(n,t),h(r))return r;u=n.parentIds[t];f=u!==t;t=u}}function wt(n,t,i){var r=n.parentCounts,u=n.parentIds;if(h(u)){if(h(r))return ki(n,t,i)}else return i(n,t);return di(n,t,i)}function gi(n,t,i){var r=n._batchTableHierarchy,u=wt(r,t,function(n,t){var r=n.classIds[t],u=n.classes[r].instances;if(h(u[i]))return!0});return h(u)}function nr(n,t,i){var r=n._batchTableHierarchy;wt(r,t,function(n,t){var f=n.classIds[t],u=n.classes[f].instances;for(var r in u)u.hasOwnProperty(r)&&i.indexOf(r)===-1&&i.push(r)})}function tr(n,t,i){var r=n._batchTableHierarchy;return wt(r,t,function(n,t){var e=n.classIds[t],o=n.classes[e],f=n.classIndexes[t],r=o.instances[i];if(h(r))return h(r.typedArray)?fi(r,f):u(r[f],!0)})}function ir(n,t,i,r){var f=n._batchTableHierarchy,e=wt(f,t,function(n,f){var s=n.classIds[f],c=n.classes[s],o=n.classIndexes[f],e=c.instances[i];if(h(e)){if(f!==t)throw new v('Inherited property "'+i+'" is read-only.');return h(e.typedArray)?ei(e,o,r):e[o]=u(r,!0),!0}});return h(e)}function rr(n){return n._textureDimensions.y===1?"uniform vec4 tile_textureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    return vec2(centerX + (batchId * stepX), 0.5); \n} \n":"uniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX = tile_textureStep.x; \n    float centerX = tile_textureStep.y; \n    float stepY = tile_textureStep.z; \n    float centerY = tile_textureStep.w; \n    float xId = mod(batchId, tile_textureDimensions.x); \n    float yId = floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"}function oi(n,t){return(n=it.replaceMain(n,"tile_main"),!t)?n+"void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n":n+"uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n} \n"}function ur(n,t){for(var h="texture2D("+t,f=0,i=n.indexOf(h,f),e,u,r,o,c,s;i>-1;){for(u=0,r=i;r<n.length;++r)if(o=n.charAt(r),o==="(")++u;else if(o===")"&&(--u,u===0)){e=r+1;break}c=n.slice(i,e);s="tile_diffuse_final("+c+", tile_diffuse)";n=n.slice(0,i)+s+n.slice(e);f=i+s.length;i=n.indexOf(h,f)}return n}function si(n,t,i){var u,f,e,r,s,c,o,l,a;return h(t)?(u=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+t+";"),f=n.match(u),!h(f))?oi(n,i):(e=f[0],r=f[2],n=it.replaceMain(n,"tile_main"),n=n.replace(e,""),s="bool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse = mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse = isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n",c="    gl_FragColor.a *= tile_featureColor.a; \n    float highlight = ceil(tile_colorBlend); \n    gl_FragColor.rgb *= mix(tile_featureColor.rgb, vec3(1.0), highlight); \n",r==="vec3"||r==="vec4"?(l=r==="vec3"?"vec4("+t+", 1.0)":t,a=r==="vec3"?"tile_diffuse.xyz":"tile_diffuse",u=new RegExp(t,"g"),n=n.replace(u,a),o="    vec4 source = "+l+"; \n    tile_diffuse = tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n"):r==="sampler2D"&&(n=ur(n,t),o="    tile_diffuse = tile_featureColor; \n    tile_main(); \n"),n="uniform float tile_colorBlend; \nvec4 tile_diffuse = vec4(1.0); \n"+s+e+"\n"+n+"\nvoid tile_color(vec4 tile_featureColor) \n{ \n"+o,i&&(n+=c),n+"} \n"):oi(n,i)}function fr(n){var i=n._content.tileset,t=i.colorBlendMode,r=i.colorBlendAmount;if(t===st.HIGHLIGHT)return 0;if(t===st.REPLACE)return 1;if(t===st.MIX)return y.clamp(r,y.EPSILON4,1);throw new v('Invalid color blend mode "'+t+'".');}function er(n){var t=n._translucentFeaturesLength;return t===0?pt.ALL_OPAQUE:t===n.featuresLength?pt.ALL_TRANSLUCENT:pt.OPAQUE_AND_TRANSLUCENT}function or(n){var t=k.shallowClone(n),i=t.pass===d.TRANSLUCENT;return t.uniformMap=h(t.uniformMap)?t.uniformMap:{},t.uniformMap.tile_translucentCommand=function(){return i},t}function sr(n){var t=k.shallowClone(n);return t.pass=d.TRANSLUCENT,t.renderState=vr(n.renderState),t}function hr(n,t){var r=n.shaderCache.getDerivedShaderProgram(t,"zBackfaceLogDepth"),i;return h(r)||(i=t.fragmentShaderSource.clone(),i.defines=h(i.defines)?i.defines.slice(0):[],i.defines.push("DISABLE_LOG_DEPTH_FRAGMENT_WRITE"),r=n.shaderCache.createDerivedShaderProgram(t,"zBackfaceLogDepth",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:i,attributeLocations:t._attributeLocations})),r}function cr(n,t){var i=k.shallowClone(t),r=u(i.renderState,!0);return r.cull.enabled=!0,r.cull.face=ht.FRONT,r.colorMask={red:!1,green:!1,blue:!1,alpha:!1},r.polygonOffset={enabled:!0,factor:5,units:5},i.renderState=nt.fromCache(r),i.castShadows=!1,i.receiveShadows=!1,i.shaderProgram=hr(n,t.shaderProgram),i}function lr(n,t){var r=n,i;return n.renderState.depthMask&&(r=k.shallowClone(n),i=u(r.renderState,!0),i.stencilTest.enabled=!0,i.stencilTest.mask=240,i.stencilTest.reference=t<<4,i.stencilTest.frontFunction=lt.GREATER_OR_EQUAL,i.stencilTest.frontOperation.zPass=at.REPLACE,r.renderState=nt.fromCache(i)),r}function ar(n){return n.renderState.stencilTest.reference>>>4}function vr(n){var t=u(n,!0);return t.cull.enabled=!1,t.depthTest.enabled=!0,t.depthMask=!1,t.blending=ot.ALPHA_BLEND,nt.fromCache(t)}function hi(n,t,i){var r=n._textureDimensions;return new rt({context:t,pixelFormat:p.RGBA,pixelDatatype:g.UNSIGNED_BYTE,source:{width:r.x,height:r.y,arrayBufferView:i},flipY:!1,sampler:new tt({minificationFilter:ft.NEAREST,magnificationFilter:ut.NEAREST})})}function yr(n,t){var s=n.featuresLength,r,o,u,e;if(!h(n._pickTexture)&&s>0){var l=n._pickIds,a=ni(n),i=new Uint8Array(a),c=n._content;for(r=0;r<s;++r)o=t.createPickId(c.getFeature(r)),l.push(o),u=o.color,e=r*4,i[e]=f.floatToByte(u.red),i[e+1]=f.floatToByte(u.green),i[e+2]=f.floatToByte(u.blue),i[e+3]=f.floatToByte(u.alpha);n._pickTexture=hi(n,t,i);c.tileset._statistics.batchTableByteLength+=n._pickTexture.sizeInBytes}}function pr(n){var t=n._textureDimensions;n._batchTexture.copyFrom({width:t.x,height:t.y,arrayBufferView:n._batchValues})}var bt=f.WHITE,ci=!0,dt,ri,ui,pt;vt._deprecationWarning=l;c(vt.prototype,{memorySizeInBytes:{get:function(){var n=0;return h(this._pickTexture)&&(n+=this._pickTexture.sizeInBytes),h(this._batchTexture)&&(n+=this._batchTexture.sizeInBytes),n}}});dt=[];vt.getBinaryProperties=function(n,t,i){return kt(n,t,i)};vt.prototype.setShow=function(n,t){var e,o;if(yt(n,this.featuresLength),r.typeOf.bool("show",t),!t||h(this._showAlphaProperties)){var i=ii(this),u=n*2,f=t?255:0;i[u]!==f&&(i[u]=f,e=ti(this),o=n*4+3,e[o]=t?i[u+1]:0,this._batchValuesDirty=!0)}};vt.prototype.setAllShow=function(n){var i,t;for(r.typeOf.bool("show",n),i=this.featuresLength,t=0;t<i;++t)this.setShow(t,n)};vt.prototype.getShow=function(n){if(yt(n,this.featuresLength),!h(this._showAlphaProperties))return!0;var t=n*2;return this._showAlphaProperties[t]===255};ri=new Array(4);vt.prototype.setColor=function(n,t){var l,v,a;if(yt(n,this.featuresLength),r.typeOf.object("color",t),!f.equals(t,bt)||h(this._batchValues)){var i=t.toBytes(ri),o=i[3],u=ti(this),e=n*4,s=ii(this),c=n*2;(u[e]!==i[0]||u[e+1]!==i[1]||u[e+2]!==i[2]||s[c+1]!==o)&&(u[e]=i[0],u[e+1]=i[1],u[e+2]=i[2],l=s[c+1]!==255,v=s[c]!==0,u[e+3]=v?o:0,s[c+1]=o,a=o!==255,a&&!l?++this._translucentFeaturesLength:!a&&l&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,h(this._colorChangedCallback)&&this._colorChangedCallback(n,t))}};vt.prototype.setAllColor=function(n){var i,t;for(r.typeOf.object("color",n),i=this.featuresLength,t=0;t<i;++t)this.setColor(t,n)};vt.prototype.getColor=function(n,t){if(yt(n,this.featuresLength),r.typeOf.object("result",t),!h(this._batchValues))return f.clone(bt,t);var i=this._batchValues,u=n*4,e=this._showAlphaProperties,o=n*2;return f.fromBytes(i[u],i[u+1],i[u+2],e[o+1],t)};vt.prototype.getPickColor=function(n){return yt(n,this.featuresLength),this._pickIds[n]};ui=new f;vt.prototype.applyStyle=function(n){var i,r,t;if(!h(n)){this.setAllColor(bt);this.setAllShow(!0);return}for(i=this._content,r=this.featuresLength,t=0;t<r;++t){var u=i.getFeature(t),f=h(n.color)?n.color.evaluateColor(u,ui):bt,e=h(n.show)?n.show.evaluate(u):ci;this.setColor(t,f);this.setShow(t,e)}};var pi=[],wi=[],bi=0;return vt.prototype.isClass=function(n,t){var i,u;return(yt(n,this.featuresLength),r.typeOf.string("className",t),i=this._batchTableHierarchy,!h(i))?!1:(u=wt(i,n,function(n,i){var r=n.classIds[i],u=n.classes[r];if(u.name===t)return!0}),h(u))},vt.prototype.isExactClass=function(n,t){return r.typeOf.string("className",t),this.getExactClassName(n)===t},vt.prototype.getExactClassName=function(n){var t,i,r;return(yt(n,this.featuresLength),t=this._batchTableHierarchy,!h(t))?undefined:(i=t.classIds[n],r=t.classes[i],r.name)},vt.prototype.hasProperty=function(n,t){return yt(n,this.featuresLength),r.typeOf.string("name",t),h(this._properties[t])||h(this._batchTableHierarchy)&&gi(this,n,t)},vt.prototype.getPropertyNames=function(n,t){yt(n,this.featuresLength);t=h(t)?t:[];t.length=0;var i=Object.keys(this._properties);return t.push.apply(t,i),h(this._batchTableHierarchy)&&nr(this,n,t),t},vt.prototype.getProperty=function(n,t){var i,f,e;return(yt(n,this.featuresLength),r.typeOf.string("name",t),h(this._batchTableBinaryProperties)&&(i=this._batchTableBinaryProperties[t],h(i)))?fi(i,n):(f=this._properties[t],h(f))?u(f[n],!0):h(this._batchTableHierarchy)&&(e=tr(this,n,t),h(e))?e:undefined},vt.prototype.setProperty=function(n,t,i){var o=this.featuresLength,e,f;if(yt(n,o),r.typeOf.string("name",t),h(this._batchTableBinaryProperties)&&(e=this._batchTableBinaryProperties[t],h(e))){ei(e,n,i);return}h(this._batchTableHierarchy)&&ir(this,n,t,i)||(f=this._properties[t],h(f)||(this._properties[t]=new Array(o),f=this._properties[t]),f[n]=u(i,!0))},vt.prototype.getVertexShaderCallback=function(n,t,i){if(this.featuresLength!==0){var r=this;return function(u){var e=si(u,i,!1),f;return b.maximumVertexTextureImageUnits>0?(f="",n&&(f+="uniform bool tile_translucentCommand; \n"),f+="uniform sampler2D tile_batchTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec2 st = computeSt("+t+"); \n    vec4 featureProperties = texture2D(tile_batchTexture, st); \n    tile_color(featureProperties); \n    float show = ceil(featureProperties.a); \n    gl_Position *= show; \n",n&&(f+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *= 0.0; \n        } \n    } \n"),f+="    tile_featureColor = featureProperties; \n    tile_featureSt = st; \n}"):f="varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt = computeSt("+t+"); \n}",e+"\n"+rr(r)+f}}},vt.prototype.getFragmentShaderCallback=function(n,t){if(this.featuresLength!==0)return function(i){return i=si(i,t,!0),b.maximumVertexTextureImageUnits>0?i+="uniform sampler2D tile_pickTexture; \nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n}":(n&&(i+="uniform bool tile_translucentCommand; \n"),i+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n",n&&(i+="    bool isStyleTranslucent = (featureProperties.a != 1.0); \n    if (czm_pass == czm_passTranslucent) \n    { \n        if (!isStyleTranslucent && !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),i+="    tile_color(featureProperties); \n} \n"),i}},vt.prototype.getClassificationFragmentShaderCallback=function(){if(this.featuresLength!==0)return function(n){return n=it.replaceMain(n,"tile_main"),n+(b.maximumVertexTextureImageUnits>0?"uniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_main(); \n    gl_FragColor = tile_featureColor; \n}":"uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_main(); \n    vec4 featureProperties = texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = featureProperties; \n} \n")}},vt.prototype.getUniformMapCallback=function(){if(this.featuresLength!==0){var n=this;return function(t){var i={tile_batchTexture:function(){return s(n._batchTexture,n._defaultTexture)},tile_textureDimensions:function(){return n._textureDimensions},tile_textureStep:function(){return n._textureStep},tile_colorBlend:function(){return fr(n)},tile_pickTexture:function(){return n._pickTexture}};return e(t,i)}}},vt.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"},pt={ALL_OPAQUE:0,ALL_TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2},vt.prototype.addDerivedCommands=function(n,t){for(var r,i,s,l,u=n.commandList,v=u.length,e=this._content._tile,y=e._finalResolution,c=e.tileset,a=c._skipLevelOfDetail&&c._hasMixedContent&&n.context.stencilBuffer,o=er(this),f=t;f<v;++f)r=u[f],i=r.derivedCommands.tileset,(!h(i)||r.dirty)&&(i={},r.derivedCommands.tileset=i,i.originalCommand=or(r),r.dirty=!1),o!==pt.ALL_OPAQUE&&(h(i.translucent)||(i.translucent=sr(i.originalCommand))),a&&(r.pass===d.TRANSLUCENT||y||(h(i.zback)||(i.zback=cr(n.context,i.originalCommand)),c._backfaceCommands.push(i.zback)),h(i.stencil)&&e._selectionDepth===ar(i.stencil)||(i.stencil=lr(i.originalCommand,e._selectionDepth))),s=a?i.stencil:i.originalCommand,l=i.translucent,r.pass!==d.TRANSLUCENT?(o===pt.ALL_OPAQUE&&(u[f]=s),o===pt.ALL_TRANSLUCENT&&(u[f]=l),o===pt.OPAQUE_AND_TRANSLUCENT&&(u[f]=s,u.push(l))):u[f]=s},vt.prototype.update=function(n,t){var i=t.context,r;this._defaultTexture=i.defaultTexture;r=t.passes;(r.pick||r.postProcess)&&yr(this,i);this._batchValuesDirty&&(this._batchValuesDirty=!1,h(this._batchTexture)||(this._batchTexture=hi(this,i,this._batchValues),n._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes),pr(this))},vt.prototype.isDestroyed=function(){return!1},vt.prototype.destroy=function(){var t,i,n;for(this._batchTexture=this._batchTexture&&this._batchTexture.destroy(),this._pickTexture=this._pickTexture&&this._pickTexture.destroy(),t=this._pickIds,i=t.length,n=0;n<i;++n)t[n].destroy();return a(this)},vt});t("Scene/Cesium3DTileFeature",["../Core/Color","../Core/defined","../Core/defineProperties"],function(n,t,i){"use strict";function r(n,t){this._content=n;this._batchId=t;this._color=undefined}return i(r.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(n){this._content.batchTable.setShow(this._batchId,n)}},color:{get:function(){return t(this._color)||(this._color=new n),this._content.batchTable.getColor(this._batchId,this._color)},set:function(n){this._content.batchTable.setColor(this._batchId,n)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickId:{get:function(){return this._content.batchTable.getPickColor(this._batchId)}}}),r.prototype.hasProperty=function(n){return this._content.batchTable.hasProperty(this._batchId,n)},r.prototype.getPropertyNames=function(n){return this._content.batchTable.getPropertyNames(this._batchId,n)},r.prototype.getProperty=function(n){return this._content.batchTable.getProperty(this._batchId,n)},r.prototype.setProperty=function(n,t){this._content.batchTable.setProperty(this._batchId,n,t);this._content.featurePropertiesDirty=!0},r.prototype.isExactClass=function(n){return this._content.batchTable.isExactClass(this._batchId,n)},r.prototype.isClass=function(n){return this._content.batchTable.isClass(this._batchId,n)},r.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)},r});t("Scene/Cesium3DTileFeatureTable",["../Core/ComponentDatatype","../Core/defaultValue","../Core/defined"],function(n,t,i){"use strict";function r(n,t){this.json=n;this.buffer=t;this._cachedTypedArrays={};this.featuresLength=0}function u(t,r,u,f,e,o){var h=t._cachedTypedArrays,s=h[r];return i(s)||(s=n.createArrayBufferView(u,t.buffer.buffer,t.buffer.byteOffset+o,e*f),h[r]=s),s}function f(t,r,u,f){var o=t._cachedTypedArrays,e=o[r];return i(e)||(e=n.createTypedArray(u,f),o[r]=e),e}return r.prototype.getGlobalProperty=function(r,f,e){var o=this.json[r];return i(o)?i(o.byteOffset)?(f=t(f,n.UNSIGNED_INT),e=t(e,1),u(this,r,f,e,1,o.byteOffset)):o:undefined},r.prototype.getPropertyArray=function(t,r,e){var o=this.json[t];return i(o)?i(o.byteOffset)?(i(o.componentType)&&(r=n.fromName(o.componentType)),u(this,t,r,e,this.featuresLength,o.byteOffset)):f(this,t,r,o):undefined},r.prototype.getProperty=function(n,t,r,u,f){var s=this.json[n],o,e;if(!i(s))return undefined;if(o=this.getPropertyArray(n,t,r),r===1)return o[u];for(e=0;e<r;++e)f[e]=o[r*u+e];return f},r});t("Scene/Vector3DTileBatch",[],function(){"use strict";function n(n){this.offset=n.offset;this.count=n.count;this.color=n.color;this.batchIds=n.batchIds}return n});t("Shaders/VectorTileVS",[],function(){"use strict";return"attribute vec3 position;\nattribute float a_batchId;\nuniform mat4 u_modifiedModelViewProjection;\nvoid main()\n{\ngl_Position = czm_depthClampFarPlane(u_modifiedModelViewProjection * vec4(position, 1.0));\n}\n"});t("ThirdParty/jsep",[],function(){return function(n){"use strict";var w="Compound",rt="Identifier",b="MemberExpression",v="Literal",ut="ThisExpression",ft="CallExpression",et="UnaryExpression",ot="BinaryExpression",st="LogicalExpression",ht="ConditionalExpression",ct="ArrayExpression",o=46,k=44,lt=39,at=34,l=40,d=41,y=91,g=93,vt=63,yt=59,pt=58,i=function(n,t){var i=new Error(n+" at character "+t);i.index=t;i.description=n;throw i;},s=!0,u={"-":s,"!":s,"~":s,"+":s},r={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},a=function(n){var t=0,i;for(var r in n)(i=r.length)>t&&n.hasOwnProperty(r)&&(t=i);return t},f=a(u),e=a(r),h={"true":!0,"false":!1,"null":null},wt="this",nt=function(n){return r[n]||0},tt=function(n,t,i){var r=n==="||"||n==="&&"?st:ot;return{type:r,operator:n,left:t,right:i}},c=function(n){return n>=48&&n<=57},p=function(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n>=128&&!r[String.fromCharCode(n)]},bt=function(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57||n>=128&&!r[String.fromCharCode(n)]},t=function(n){for(var t=0,ui=n.charAt,fi=n.charCodeAt,a=function(t){return ui.call(n,t)},s=function(t){return fi.call(n,t)},st=n.length,it=function(){for(var n=s(t);n===32||n===9;)n=s(++t)},ot=function(){var u=ei(),n,r;if(it(),s(t)===vt){if(t++,n=ot(),n||i("Expected expression",t),it(),s(t)===pt)return t++,r=ot(),r||i("Expected expression",t),{type:ht,test:u,consequent:n,alternate:r};i("Expected :",t)}else return u},ni=function(){it();for(var i=n.substr(t,e),u=i.length;u>0;){if(r.hasOwnProperty(i))return t+=u,i;i=i.substr(0,--u)}return!1},ei=function(){var u,r,s,n,h,e,o,f;if(e=kt(),r=ni(),!r)return e;for(h={value:r,prec:nt(r)},o=kt(),o||i("Expected expression after "+r,t),n=[e,h,o];r=ni();){if(s=nt(r),s===0)break;for(h={value:r,prec:s};n.length>2&&s<=n[n.length-2].prec;)o=n.pop(),r=n.pop().value,e=n.pop(),u=tt(r,e,o),n.push(u);u=kt();u||i("Expected expression after "+r,t);n.push(h,u)}for(f=n.length-1,u=n[f];f>1;)u=tt(n[f-1].value,n[f-2],u),f-=2;return u},kt=function(){var i,r,e;if(it(),i=s(t),c(i)||i===o)return oi();if(i===lt||i===at)return si();if(p(i)||i===l)return hi();if(i===y)return li();for(r=n.substr(t,f),e=r.length;e>0;){if(u.hasOwnProperty(r))return t+=e,{type:et,operator:r,argument:kt(),prefix:!0};r=r.substr(0,--e)}return!1},oi=function(){for(var n="",r,u;c(s(t));)n+=a(t++);if(s(t)===o)for(n+=a(t++);c(s(t));)n+=a(t++);if(r=a(t),r==="e"||r==="E"){for(n+=a(t++),r=a(t),(r==="+"||r==="-")&&(n+=a(t++));c(s(t));)n+=a(t++);c(s(t-1))||i("Expected exponent ("+n+a(t)+")",t)}return u=s(t),p(u)?i("Variable names cannot start with a number ("+n+a(t)+")",t):u===o&&i("Unexpected period",t),{type:v,value:parseFloat(n),raw:n}},si=function(){for(var n="",u=a(t++),f=!1,r;t<st;)if(r=a(t++),r===u){f=!0;break}else if(r==="\\"){r=a(t++);switch(r){case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="\t";break;case"b":n+="\b";break;case"f":n+="\f";break;case"v":n+="\x0b";break;default:n+="\\"+r}}else n+=r;return f||i('Unclosed quote after "'+n+'"',t),{type:v,value:n,raw:u+n+u}},ti=function(){var u=s(t),f=t,r;for(p(u)?t++:i("Unexpected "+a(t),t);t<st;)if(u=s(t),bt(u))t++;else break;return r=n.slice(f,t),h.hasOwnProperty(r)?{type:v,value:h[r],raw:r}:r===wt?{type:ut}:{type:rt,name:r}},ii=function(n){for(var u,f=[],r,e=!1;t<st;)if(it(),u=s(t),u===n){e=!0;t++;break}else u===k?t++:(r=ot(),r&&r.type!==w||i("Expected comma",t),f.push(r));return e||i("Expected "+String.fromCharCode(n),t),f},hi=function(){var n,r;for(n=s(t),r=n===l?ci():ti(),it(),n=s(t);n===o||n===y||n===l;)t++,n===o?(it(),r={type:b,computed:!1,object:r,property:ti()}):n===y?(r={type:b,computed:!0,object:r,property:ot()},it(),n=s(t),n!==g&&i("Unclosed [",t),t++):n===l&&(r={type:ft,arguments:ii(d),callee:r}),it(),n=s(t);return r},ci=function(){t++;var n=ot();if(it(),s(t)===d)return t++,n;i("Unclosed (",t)},li=function(){return t++,{type:ct,elements:ii(g)}},dt=[],gt,ri;t<st;)gt=s(t),gt===yt||gt===k?t++:(ri=ot())?dt.push(ri):t<st&&i('Unexpected "'+a(t)+'"',t);return dt.length===1?dt[0]:{type:w,body:dt}},it;t.version="0.3.1";t.toString=function(){return"JavaScript Expression Parser (JSEP) v"+t.version};t.addUnaryOp=function(n){return f=Math.max(n.length,f),u[n]=s,this};t.addBinaryOp=function(n,t){return e=Math.max(n.length,e),r[n]=t,this};t.addLiteral=function(n,t){return h[n]=t,this};t.removeUnaryOp=function(n){return delete u[n],n.length===f&&(f=a(u)),this};t.removeAllUnaryOps=function(){return u={},f=0,this};t.removeBinaryOp=function(n){return delete r[n],n.length===e&&(e=a(r)),this};t.removeAllBinaryOps=function(){return r={},e=0,this};t.removeLiteral=function(n){return delete h[n],this};t.removeAllLiterals=function(){return h={},this};typeof exports=="undefined"?(it=n.jsep,n.jsep=t,t.noConflict=function(){return n.jsep===t&&(n.jsep=it),t}):typeof module!="undefined"&&module.exports?exports=module.exports=t:exports.parse=t}(this),typeof jsep!="undefined"?jsep.noConflict():void 0});t("Scene/ExpressionNodeType",["../Core/freezeObject"],function(n){"use strict";return n({VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18})});t("Scene/Expression",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Check","../Core/Color","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/isArray","../Core/Math","../Core/RuntimeError","../ThirdParty/jsep","./ExpressionNodeType"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function k(n,t){r.typeOf.string("expression",n);this._expression=n;n=ui(n,t);n=ei(fi(n));l.addBinaryOp("=~",0);l.addBinaryOp("!~",0);var i;try{i=l(n)}catch(u){throw new c(u);}this._runtimeAst=p(this,i)}function bt(n){return n-Math.floor(n)}function kt(n){return Math.pow(2,n)}function dt(n){return h.log2(n)}function w(r){return function(u,f){if(typeof f=="number")return r(f);if(f instanceof n)return n.fromElements(r(f.x),r(f.y),y.getCartesian2());if(f instanceof t)return t.fromElements(r(f.x),r(f.y),r(f.z),y.getCartesian3());if(f instanceof i)return i.fromElements(r(f.x),r(f.y),r(f.z),r(f.w),y.getCartesian4());throw new c('Function "'+u+'" requires a vector or number argument. Argument is '+f+".");}}function tt(r,u){return function(f,e,o){if(u&&typeof o=="number"){if(typeof e=="number")return r(e,o);if(e instanceof n)return n.fromElements(r(e.x,o),r(e.y,o),y.getCartesian2());if(e instanceof t)return t.fromElements(r(e.x,o),r(e.y,o),r(e.z,o),y.getCartesian3());if(e instanceof i)return i.fromElements(r(e.x,o),r(e.y,o),r(e.z,o),r(e.w,o),y.getCartesian4())}if(typeof e=="number"&&typeof o=="number")return r(e,o);if(e instanceof n&&o instanceof n)return n.fromElements(r(e.x,o.x),r(e.y,o.y),y.getCartesian2());if(e instanceof t&&o instanceof t)return t.fromElements(r(e.x,o.x),r(e.y,o.y),r(e.z,o.z),y.getCartesian3());if(e instanceof i&&o instanceof i)return i.fromElements(r(e.x,o.x),r(e.y,o.y),r(e.z,o.z),r(e.w,o.w),y.getCartesian4());throw new c('Function "'+f+'" requires vector or number arguments of matching types. Arguments are '+e+" and "+o+".");}}function st(r,u){return function(f,e,o,s){if(u&&typeof s=="number"){if(typeof e=="number"&&typeof o=="number")return r(e,o,s);if(e instanceof n&&o instanceof n)return n.fromElements(r(e.x,o.x,s),r(e.y,o.y,s),y.getCartesian2());if(e instanceof t&&o instanceof t)return t.fromElements(r(e.x,o.x,s),r(e.y,o.y,s),r(e.z,o.z,s),y.getCartesian3());if(e instanceof i&&o instanceof i)return i.fromElements(r(e.x,o.x,s),r(e.y,o.y,s),r(e.z,o.z,s),r(e.w,o.w,s),y.getCartesian4())}if(typeof e=="number"&&typeof o=="number"&&typeof s=="number")return r(e,o,s);if(e instanceof n&&o instanceof n&&s instanceof n)return n.fromElements(r(e.x,o.x,s.x),r(e.y,o.y,s.y),y.getCartesian2());if(e instanceof t&&o instanceof t&&s instanceof t)return t.fromElements(r(e.x,o.x,s.x),r(e.y,o.y,s.y),r(e.z,o.z,s.z),y.getCartesian3());if(e instanceof i&&o instanceof i&&s instanceof i)return i.fromElements(r(e.x,o.x,s.x),r(e.y,o.y,s.y),r(e.z,o.z,s.z),r(e.w,o.w,s.w),y.getCartesian4());throw new c('Function "'+f+'" requires vector or number arguments of matching types. Arguments are '+e+", "+o+", and "+s+".");}}function gt(r,u){if(typeof u=="number")return Math.abs(u);if(u instanceof n)return n.magnitude(u);if(u instanceof t)return t.magnitude(u);if(u instanceof i)return i.magnitude(u);throw new c('Function "'+r+'" requires a vector or number argument. Argument is '+u+".");}function ni(r,u){if(typeof u=="number")return 1;if(u instanceof n)return n.normalize(u,y.getCartesian2());if(u instanceof t)return t.normalize(u,y.getCartesian3());if(u instanceof i)return i.normalize(u,y.getCartesian4());throw new c('Function "'+r+'" requires a vector or number argument. Argument is '+u+".");}function ti(r,u,f){if(typeof u=="number"&&typeof f=="number")return Math.abs(u-f);if(u instanceof n&&f instanceof n)return n.distance(u,f);if(u instanceof t&&f instanceof t)return t.distance(u,f);if(u instanceof i&&f instanceof i)return i.distance(u,f);throw new c('Function "'+r+'" requires vector or number arguments of matching types. Arguments are '+u+" and "+f+".");}function ii(r,u,f){if(typeof u=="number"&&typeof f=="number")return u*f;if(u instanceof n&&f instanceof n)return n.dot(u,f);if(u instanceof t&&f instanceof t)return t.dot(u,f);if(u instanceof i&&f instanceof i)return i.dot(u,f);throw new c('Function "'+r+'" requires vector or number arguments of matching types. Arguments are '+u+" and "+f+".");}function ri(n,i,r){if(i instanceof t&&r instanceof t)return t.cross(i,r,y.getCartesian3());throw new c('Function "'+n+'" requires vec3 arguments. Arguments are '+i+" and "+r+".");}function v(n,t,i,r,u){this._type=n;this._value=t;this._left=i;this._right=r;this._test=u;this.evaluate=undefined;wi(this)}function ui(n,t){var i,u,r;if(!f(t))return n;for(i in t)t.hasOwnProperty(i)&&(u=new RegExp("\\$\\{"+i+"\\}","g"),r="("+t[i]+")",f(r)&&(n=n.replace(u,r)));return n}function fi(n){return n.replace(yt,pt)}function ut(n){return n.replace(wt,"\\")}function ei(n){for(var t=n,u="",i=t.indexOf("${"),f,e,r,o;i>=0;)if(f=t.indexOf("'"),e=t.indexOf('"'),f>=0&&f<i)r=t.indexOf("'",f+1),u+=t.substr(0,r+1),t=t.substr(r+1),i=t.indexOf("${");else if(e>=0&&e<i)r=t.indexOf('"',e+1),u+=t.substr(0,r+1),t=t.substr(r+1),i=t.indexOf("${");else{if(u+=t.substr(0,i),o=t.indexOf("}"),o<0)throw new c("Unmatched {.");u+="czm_"+t.substr(i+2,o-(i+2));t=t.substr(o+1);i=t.indexOf("${")}return u+t}function oi(n){var t=typeof n.value;return n.value===null?new v(a.LITERAL_NULL,null):t==="boolean"?new v(a.LITERAL_BOOLEAN,n.value):t==="number"?new v(a.LITERAL_NUMBER,n.value):t==="string"?n.value.indexOf("${")>=0?new v(a.VARIABLE_IN_STRING,n.value):new v(a.LITERAL_STRING,ut(n.value)):void 0}function si(n,t){var r=t.arguments,e=r.length,i,u,o,s,l,y,h,w;if(t.callee.type==="MemberExpression"){if(i=t.callee.property.name,l=t.callee.object,i==="test"||i==="exec"){if(l.callee.name!=="regExp")throw new c(i+" is not a function.");return e===0?i==="test"?new v(a.LITERAL_BOOLEAN,!1):new v(a.LITERAL_NULL,null):(o=p(n,l),s=p(n,r[0]),new v(a.FUNCTION_CALL,i,o,s))}if(i==="toString")return u=p(n,l),new v(a.FUNCTION_CALL,i,u);throw new c('Unexpected function call "'+i+'".');}if(i=t.callee.name,i==="color")return e===0?new v(a.LITERAL_COLOR,i):(u=p(n,r[0]),f(r[1]))?(y=p(n,r[1]),new v(a.LITERAL_COLOR,i,[u,y])):new v(a.LITERAL_COLOR,i,[u]);if(i==="rgb"||i==="hsl"){if(e<3)throw new c(i+" requires three arguments.");return u=[p(n,r[0]),p(n,r[1]),p(n,r[2])],new v(a.LITERAL_COLOR,i,u)}if(i==="rgba"||i==="hsla"){if(e<4)throw new c(i+" requires four arguments.");return u=[p(n,r[0]),p(n,r[1]),p(n,r[2]),p(n,r[3])],new v(a.LITERAL_COLOR,i,u)}if(i==="vec2"||i==="vec3"||i==="vec4"){for(u=new Array(e),h=0;h<e;++h)u[h]=p(n,r[h]);return new v(a.LITERAL_VECTOR,i,u)}if(i==="isNaN"||i==="isFinite")return e===0?i==="isNaN"?new v(a.LITERAL_BOOLEAN,!0):new v(a.LITERAL_BOOLEAN,!1):(u=p(n,r[0]),new v(a.UNARY,i,u));if(i==="isExactClass"||i==="isClass"){if(e<1||e>1)throw new c(i+" requires exactly one argument.");return u=p(n,r[0]),new v(a.UNARY,i,u)}if(i==="getExactClassName"){if(e>0)throw new c(i+" does not take any argument.");return new v(a.UNARY,i)}if(f(d[i])){if(e!==1)throw new c(i+" requires exactly one argument.");return u=p(n,r[0]),new v(a.UNARY,i,u)}if(f(nt[i])){if(e!==2)throw new c(i+" requires exactly two arguments.");return o=p(n,r[0]),s=p(n,r[1]),new v(a.BINARY,i,o,s)}if(f(rt[i])){if(e!==3)throw new c(i+" requires exactly three arguments.");return o=p(n,r[0]),s=p(n,r[1]),w=p(n,r[2]),new v(a.TERNARY,i,o,s,w)}if(i==="Boolean")return e===0?new v(a.LITERAL_BOOLEAN,!1):(u=p(n,r[0]),new v(a.UNARY,i,u));if(i==="Number")return e===0?new v(a.LITERAL_NUMBER,0):(u=p(n,r[0]),new v(a.UNARY,i,u));if(i==="String")return e===0?new v(a.LITERAL_STRING,""):(u=p(n,r[0]),new v(a.UNARY,i,u));if(i==="regExp")return hi(n,t);throw new c('Unexpected function call "'+i+'".');}function hi(n,t){var r=t.arguments,i,u,f;if(r.length===0)return new v(a.LITERAL_REGEX,new RegExp);if(i=p(n,r[0]),r.length>1){if(f=p(n,r[1]),ft(i)&&ft(f)){try{u=new RegExp(ut(String(i._value)),f._value)}catch(e){throw new c(e);}return new v(a.LITERAL_REGEX,u)}return new v(a.REGEX,i,f)}if(ft(i)){try{u=new RegExp(ut(String(i._value)))}catch(e){throw new c(e);}return new v(a.LITERAL_REGEX,u)}return new v(a.REGEX,i)}function ci(n){if(yi(n.name)){var t=pi(n.name);return t.substr(0,8)==="tiles3d_"?new v(a.BUILTIN_VARIABLE,t):new v(a.VARIABLE,t)}if(n.name==="NaN")return new v(a.LITERAL_NUMBER,NaN);if(n.name==="Infinity")return new v(a.LITERAL_NUMBER,Infinity);if(n.name==="undefined")return new v(a.LITERAL_UNDEFINED,undefined);throw new c(n.name+" is not defined.");}function li(n){var t=n.property.name;return t==="PI"?new v(a.LITERAL_NUMBER,Math.PI):t==="E"?new v(a.LITERAL_NUMBER,Math.E):void 0}function ai(n){var t=n.property.name;if(t==="POSITIVE_INFINITY")return new v(a.LITERAL_NUMBER,Number.POSITIVE_INFINITY)}function vi(n,t){if(t.object.name==="Math")return li(t);if(t.object.name==="Number")return ai(t);var i,r=p(n,t.object);return t.computed?(i=p(n,t.property),new v(a.MEMBER,"brackets",r,i)):(i=new v(a.LITERAL_STRING,t.property.name),new v(a.MEMBER,"dot",r,i))}function ft(n){return n._type>=a.LITERAL_NULL}function yi(n){return n.substr(0,4)==="czm_"}function pi(n){return n.substr(4)}function p(n,t){var r,i,u,f,s,h,o,e;if(t.type==="Literal")r=oi(t);else if(t.type==="CallExpression")r=si(n,t);else if(t.type==="Identifier")r=ci(t);else if(t.type==="UnaryExpression")if(i=t.operator,s=p(n,t.argument),vt.indexOf(i)>-1)r=new v(a.UNARY,i,s);else throw new c('Unexpected operator "'+i+'".');else if(t.type==="BinaryExpression")if(i=t.operator,u=p(n,t.left),f=p(n,t.right),et.indexOf(i)>-1)r=new v(a.BINARY,i,u,f);else throw new c('Unexpected operator "'+i+'".');else if(t.type==="LogicalExpression")i=t.operator,u=p(n,t.left),f=p(n,t.right),et.indexOf(i)>-1&&(r=new v(a.BINARY,i,u,f));else if(t.type==="ConditionalExpression")h=p(n,t.test),u=p(n,t.consequent),f=p(n,t.alternate),r=new v(a.CONDITIONAL,"?",u,f,h);else if(t.type==="MemberExpression")r=vi(n,t);else if(t.type==="ArrayExpression"){for(o=[],e=0;e<t.elements.length;e++)o[e]=p(n,t.elements[e]);r=new v(a.ARRAY,o)}else if(t.type==="Compound")throw new c("Provide exactly one expression.");else throw new c("Cannot parse expression.");return r}function wi(n){n._type===a.CONDITIONAL?n.evaluate=n._evaluateConditional:n._type===a.FUNCTION_CALL?n._value==="test"?n.evaluate=n._evaluateRegExpTest:n._value==="exec"?n.evaluate=n._evaluateRegExpExec:n._value==="toString"&&(n.evaluate=n._evaluateToString):n._type===a.UNARY?n._value==="!"?n.evaluate=n._evaluateNot:n._value==="-"?n.evaluate=n._evaluateNegative:n._value==="+"?n.evaluate=n._evaluatePositive:n._value==="isNaN"?n.evaluate=n._evaluateNaN:n._value==="isFinite"?n.evaluate=n._evaluateIsFinite:n._value==="isExactClass"?n.evaluate=n._evaluateIsExactClass:n._value==="isClass"?n.evaluate=n._evaluateIsClass:n._value==="getExactClassName"?n.evaluate=n._evaluategetExactClassName:n._value==="Boolean"?n.evaluate=n._evaluateBooleanConversion:n._value==="Number"?n.evaluate=n._evaluateNumberConversion:n._value==="String"?n.evaluate=n._evaluateStringConversion:f(d[n._value])&&(n.evaluate=ki(n._value)):n._type===a.BINARY?n._value==="+"?n.evaluate=n._evaluatePlus:n._value==="-"?n.evaluate=n._evaluateMinus:n._value==="*"?n.evaluate=n._evaluateTimes:n._value==="/"?n.evaluate=n._evaluateDivide:n._value==="%"?n.evaluate=n._evaluateMod:n._value==="==="?n.evaluate=n._evaluateEqualsStrict:n._value==="!=="?n.evaluate=n._evaluateNotEqualsStrict:n._value==="<"?n.evaluate=n._evaluateLessThan:n._value==="<="?n.evaluate=n._evaluateLessThanOrEquals:n._value===">"?n.evaluate=n._evaluateGreaterThan:n._value===">="?n.evaluate=n._evaluateGreaterThanOrEquals:n._value==="&&"?n.evaluate=n._evaluateAnd:n._value==="||"?n.evaluate=n._evaluateOr:n._value==="=~"?n.evaluate=n._evaluateRegExpMatch:n._value==="!~"?n.evaluate=n._evaluateRegExpNotMatch:f(nt[n._value])&&(n.evaluate=di(n._value)):n._type===a.TERNARY?n.evaluate=gi(n._value):n._type===a.MEMBER?n.evaluate=n._value==="brackets"?n._evaluateMemberBrackets:n._evaluateMemberDot:n._type===a.ARRAY?n.evaluate=n._evaluateArray:n._type===a.VARIABLE?n.evaluate=n._evaluateVariable:n._type===a.VARIABLE_IN_STRING?n.evaluate=n._evaluateVariableString:n._type===a.LITERAL_COLOR?n.evaluate=n._evaluateLiteralColor:n._type===a.LITERAL_VECTOR?n.evaluate=n._evaluateLiteralVector:n._type===a.LITERAL_STRING?n.evaluate=n._evaluateLiteralString:n._type===a.REGEX?n.evaluate=n._evaluateRegExp:n._type===a.BUILTIN_VARIABLE?n._value==="tiles3d_tileset_time"&&(n.evaluate=bi):n.evaluate=n._evaluateLiteral}function bi(n){return n.content.tileset.timeSinceLoad}function ki(n){var t=d[n];return function(i){var r=this._left.evaluate(i);return t(n,r)}}function di(n){var t=nt[n];return function(i){var r=this._left.evaluate(i),u=this._right.evaluate(i);return t(n,r,u)}}function gi(n){var t=rt[n];return function(i){var r=this._left.evaluate(i),u=this._right.evaluate(i),f=this._test.evaluate(i);return t(n,r,u,f)}}function ht(n){return n._value==="feature"}function ct(n){for(var t=n._left,r=t.length,i=0;i<r;++i)if(t[i]._type!==a.LITERAL_NUMBER)return undefined;var f=t[0]._value,e=t[1]._value,o=t[2]._value,s=r===4?t[3]._value:1;return u.fromHsl(f,e,o,s,g)}function lt(n){for(var i,t=n._left,u=t.length,r=0;r<u;++r)if(t[r]._type!==a.LITERAL_NUMBER)return undefined;return i=g,i.red=t[0]._value/255,i.green=t[1]._value/255,i.blue=t[2]._value/255,i.alpha=u===4?t[3]._value:1,i}function b(n){return n%1==0?n.toFixed(1):n.toString()}function nr(n){var t=b(n.red),i=b(n.green),r=b(n.blue);return"vec3("+t+", "+i+", "+r+")"}function it(n){var t=b(n.red),i=b(n.green),r=b(n.blue),u=b(n.alpha);return"vec4("+t+", "+i+", "+r+", "+u+")"}function at(n,t,i,r){for(var f=n.length,e=new Array(f),u=0;u<f;++u)e[u]=n[u].getShaderExpression(t,i,r);return e}var y;e(k.prototype,{expression:{get:function(){return this._expression}}});y={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new n],cartesian3Array:[new t],cartesian4Array:[new i],reset:function(){this.arrayIndex=0;this.cartesian2Index=0;this.cartesian3Index=0;this.cartesian4Index=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);var n=this.arrayArray[this.arrayIndex++];return n.length=0,n},getCartesian2:function(){return this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new n),this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){return this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new t),this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){return this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new i),this.cartesian4Array[this.cartesian4Index++]}};k.prototype.evaluate=function(r,f){y.reset();var e=this._runtimeAst.evaluate(r);return f instanceof u&&e instanceof i?u.fromCartesian4(e,f):e instanceof n||e instanceof t||e instanceof i?e.clone(f):e};k.prototype.evaluateColor=function(n,t){y.reset();var i=this._runtimeAst.evaluate(n);return u.fromCartesian4(i,t)};k.prototype.getShaderFunction=function(n,t,i,r){var u=this.getShaderExpression(t,i);return r+" "+n+"() \n{ \n    return "+u+"; \n} \n"};k.prototype.getShaderExpression=function(n,t){return this._runtimeAst.getShaderExpression(n,t)};var vt=["!","-","+"],et=["+","-","*","/","%","===","!==",">",">=","<","<=","&&","||","!~","=~"],ot=/\${(.*?)}/g,yt=/\\/g,pt="@#%",wt=/@#%/g,g=new u,d={abs:w(Math.abs),sqrt:w(Math.sqrt),cos:w(Math.cos),sin:w(Math.sin),tan:w(Math.tan),acos:w(Math.acos),asin:w(Math.asin),atan:w(Math.atan),radians:w(h.toRadians),degrees:w(h.toDegrees),sign:w(h.sign),floor:w(Math.floor),ceil:w(Math.ceil),round:w(Math.round),exp:w(Math.exp),exp2:w(kt),log:w(Math.log),log2:w(dt),fract:w(bt),length:gt,normalize:ni},nt={atan2:tt(Math.atan2,!1),pow:tt(Math.pow,!1),min:tt(Math.min,!0),max:tt(Math.max,!0),distance:ti,dot:ii,cross:ri},rt={clamp:st(h.clamp,!0),mix:st(h.lerp,!0)};return v.prototype._evaluateLiteral=function(){return this._value},v.prototype._evaluateLiteralColor=function(n){var r=g,t=this._left,e;return this._value==="color"?f(t)?t.length>1?(u.fromCssColorString(t[0].evaluate(n),r),r.alpha=t[1].evaluate(n)):u.fromCssColorString(t[0].evaluate(n),r):u.fromBytes(255,255,255,255,r):this._value==="rgb"?u.fromBytes(t[0].evaluate(n),t[1].evaluate(n),t[2].evaluate(n),255,r):this._value==="rgba"?(e=t[3].evaluate(n)*255,u.fromBytes(t[0].evaluate(n),t[1].evaluate(n),t[2].evaluate(n),e,r)):this._value==="hsl"?u.fromHsl(t[0].evaluate(n),t[1].evaluate(n),t[2].evaluate(n),1,r):this._value==="hsla"&&u.fromHsl(t[0].evaluate(n),t[1].evaluate(n),t[2].evaluate(n),t[3].evaluate(n),r),i.fromColor(r,y.getCartesian4())},v.prototype._evaluateLiteralVector=function(r){for(var u,o,l,s,f=y.getArray(),e=this._value,a=this._left,v=a.length,h=0;h<v;++h)if(u=a[h].evaluate(r),typeof u=="number")f.push(u);else if(u instanceof n)f.push(u.x,u.y);else if(u instanceof t)f.push(u.x,u.y,u.z);else if(u instanceof i)f.push(u.x,u.y,u.z,u.w);else throw new c(e+" argument must be a vector or number. Argument is "+u+".");if(o=f.length,l=parseInt(e.charAt(3)),o===0)throw new c("Invalid "+e+" constructor. No valid arguments.");else if(o<l&&o>1)throw new c("Invalid "+e+" constructor. Not enough arguments.");else if(o>l&&v>1)throw new c("Invalid "+e+" constructor. Too many arguments.");return(o===1&&(s=f[0],f.push(s,s,s)),e==="vec2")?n.fromArray(f,0,y.getCartesian2()):e==="vec3"?t.fromArray(f,0,y.getCartesian3()):e==="vec4"?i.fromArray(f,0,y.getCartesian4()):void 0},v.prototype._evaluateLiteralString=function(){return this._value},v.prototype._evaluateVariableString=function(n){for(var t=this._value,i=ot.exec(t);i!==null;){var u=i[0],e=i[1],r=n.getProperty(e);f(r)||(r="");t=t.replace(u,r);i=ot.exec(t)}return t},v.prototype._evaluateVariable=function(n){return n.getProperty(this._value)},v.prototype._evaluateMemberDot=function(r){var u,e;if(ht(this._left))return r.getProperty(this._right.evaluate(r));if(u=this._left.evaluate(r),!f(u))return undefined;if(e=this._right.evaluate(r),u instanceof n||u instanceof t||u instanceof i){if(e==="r")return u.x;if(e==="g")return u.y;if(e==="b")return u.z;if(e==="a")return u.w}return u[e]},v.prototype._evaluateMemberBrackets=function(r){var u,e;if(ht(this._left))return r.getProperty(this._right.evaluate(r));if(u=this._left.evaluate(r),!f(u))return undefined;if(e=this._right.evaluate(r),u instanceof n||u instanceof t||u instanceof i){if(e===0||e==="r")return u.x;if(e===1||e==="g")return u.y;if(e===2||e==="b")return u.z;if(e===3||e==="a")return u.w}return u[e]},v.prototype._evaluateArray=function(n){for(var i=[],t=0;t<this._value.length;t++)i[t]=this._value[t].evaluate(n);return i},v.prototype._evaluateNot=function(n){var t=this._left.evaluate(n);if(typeof t!="boolean")throw new c('Operator "!" requires a boolean argument. Argument is '+t+".");return!t},v.prototype._evaluateNegative=function(r){var u=this._left.evaluate(r);if(u instanceof n)return n.negate(u,y.getCartesian2());if(u instanceof t)return t.negate(u,y.getCartesian3());if(u instanceof i)return i.negate(u,y.getCartesian4());if(typeof u=="number")return-u;throw new c('Operator "-" requires a vector or number argument. Argument is '+u+".");},v.prototype._evaluatePositive=function(r){var u=this._left.evaluate(r);if(!(u instanceof n||u instanceof t||u instanceof i||typeof u=="number"))throw new c('Operator "+" requires a vector or number argument. Argument is '+u+".");return u},v.prototype._evaluateLessThan=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(typeof t!="number"||typeof i!="number")throw new c('Operator "<" requires number arguments. Arguments are '+t+" and "+i+".");return t<i},v.prototype._evaluateLessThanOrEquals=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(typeof t!="number"||typeof i!="number")throw new c('Operator "<=" requires number arguments. Arguments are '+t+" and "+i+".");return t<=i},v.prototype._evaluateGreaterThan=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(typeof t!="number"||typeof i!="number")throw new c('Operator ">" requires number arguments. Arguments are '+t+" and "+i+".");return t>i},v.prototype._evaluateGreaterThanOrEquals=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(typeof t!="number"||typeof i!="number")throw new c('Operator ">=" requires number arguments. Arguments are '+t+" and "+i+".");return t>=i},v.prototype._evaluateOr=function(n){var t=this._left.evaluate(n),i;if(typeof t!="boolean")throw new c('Operator "||" requires boolean arguments. First argument is '+t+".");if(t)return!0;if(i=this._right.evaluate(n),typeof i!="boolean")throw new c('Operator "||" requires boolean arguments. Second argument is '+i+".");return t||i},v.prototype._evaluateAnd=function(n){var t=this._left.evaluate(n),i;if(typeof t!="boolean")throw new c('Operator "&&" requires boolean arguments. First argument is '+t+".");if(!t)return!1;if(i=this._right.evaluate(n),typeof i!="boolean")throw new c('Operator "&&" requires boolean arguments. Second argument is '+i+".");return t&&i},v.prototype._evaluatePlus=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);if(f instanceof n&&u instanceof n)return n.add(u,f,y.getCartesian2());if(f instanceof t&&u instanceof t)return t.add(u,f,y.getCartesian3());if(f instanceof i&&u instanceof i)return i.add(u,f,y.getCartesian4());if(typeof u=="string"||typeof f=="string"||typeof u=="number"&&typeof f=="number")return u+f;throw new c('Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are '+u+" and "+f+".");},v.prototype._evaluateMinus=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);if(f instanceof n&&u instanceof n)return n.subtract(u,f,y.getCartesian2());if(f instanceof t&&u instanceof t)return t.subtract(u,f,y.getCartesian3());if(f instanceof i&&u instanceof i)return i.subtract(u,f,y.getCartesian4());if(typeof u=="number"&&typeof f=="number")return u-f;throw new c('Operator "-" requires vector or number arguments of matching types. Arguments are '+u+" and "+f+".");},v.prototype._evaluateTimes=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);if(f instanceof n&&u instanceof n)return n.multiplyComponents(u,f,y.getCartesian2());if(f instanceof n&&typeof u=="number")return n.multiplyByScalar(f,u,y.getCartesian2());if(u instanceof n&&typeof f=="number")return n.multiplyByScalar(u,f,y.getCartesian2());if(f instanceof t&&u instanceof t)return t.multiplyComponents(u,f,y.getCartesian3());if(f instanceof t&&typeof u=="number")return t.multiplyByScalar(f,u,y.getCartesian3());if(u instanceof t&&typeof f=="number")return t.multiplyByScalar(u,f,y.getCartesian3());if(f instanceof i&&u instanceof i)return i.multiplyComponents(u,f,y.getCartesian4());if(f instanceof i&&typeof u=="number")return i.multiplyByScalar(f,u,y.getCartesian4());if(u instanceof i&&typeof f=="number")return i.multiplyByScalar(u,f,y.getCartesian4());if(typeof u=="number"&&typeof f=="number")return u*f;throw new c('Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are '+u+" and "+f+".");},v.prototype._evaluateDivide=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);if(f instanceof n&&u instanceof n)return n.divideComponents(u,f,y.getCartesian2());if(u instanceof n&&typeof f=="number")return n.divideByScalar(u,f,y.getCartesian2());if(f instanceof t&&u instanceof t)return t.divideComponents(u,f,y.getCartesian3());if(u instanceof t&&typeof f=="number")return t.divideByScalar(u,f,y.getCartesian3());if(f instanceof i&&u instanceof i)return i.divideComponents(u,f,y.getCartesian4());if(u instanceof i&&typeof f=="number")return i.divideByScalar(u,f,y.getCartesian4());if(typeof u=="number"&&typeof f=="number")return u/f;throw new c('Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are '+u+" and "+f+".");},v.prototype._evaluateMod=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);if(f instanceof n&&u instanceof n)return n.fromElements(u.x%f.x,u.y%f.y,y.getCartesian2());if(f instanceof t&&u instanceof t)return t.fromElements(u.x%f.x,u.y%f.y,u.z%f.z,y.getCartesian3());if(f instanceof i&&u instanceof i)return i.fromElements(u.x%f.x,u.y%f.y,u.z%f.z,u.w%f.w,y.getCartesian4());if(typeof u=="number"&&typeof f=="number")return u%f;throw new c('Operator "%" requires vector or number arguments of matching types. Arguments are '+u+" and "+f+".");},v.prototype._evaluateEqualsStrict=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);return f instanceof n&&u instanceof n||f instanceof t&&u instanceof t||f instanceof i&&u instanceof i?u.equals(f):u===f},v.prototype._evaluateNotEqualsStrict=function(r){var u=this._left.evaluate(r),f=this._right.evaluate(r);return f instanceof n&&u instanceof n||f instanceof t&&u instanceof t||f instanceof i&&u instanceof i?!u.equals(f):u!==f},v.prototype._evaluateConditional=function(n){var t=this._test.evaluate(n);if(typeof t!="boolean")throw new c("Conditional argument of conditional expression must be a boolean. Argument is "+t+".");return t?this._left.evaluate(n):this._right.evaluate(n)},v.prototype._evaluateNaN=function(n){return isNaN(this._left.evaluate(n))},v.prototype._evaluateIsFinite=function(n){return isFinite(this._left.evaluate(n))},v.prototype._evaluateIsExactClass=function(n){return n.isExactClass(this._left.evaluate(n))},v.prototype._evaluateIsClass=function(n){return n.isClass(this._left.evaluate(n))},v.prototype._evaluategetExactClassName=function(n){return n.getExactClassName()},v.prototype._evaluateBooleanConversion=function(n){return Boolean(this._left.evaluate(n))},v.prototype._evaluateNumberConversion=function(n){return Number(this._left.evaluate(n))},v.prototype._evaluateStringConversion=function(n){return String(this._left.evaluate(n))},v.prototype._evaluateRegExp=function(n){var r=this._value.evaluate(n),t="",i;f(this._left)&&(t=this._left.evaluate(n));try{i=new RegExp(r,t)}catch(u){throw new c(u);}return i},v.prototype._evaluateRegExpTest=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(!(t instanceof RegExp&&typeof i=="string"))throw new c("RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+t+" and "+i+".");return t.test(i)},v.prototype._evaluateRegExpMatch=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(t instanceof RegExp&&typeof i=="string")return t.test(i);if(i instanceof RegExp&&typeof t=="string")return i.test(t);throw new c('Operator "=~" requires one RegExp argument and one string argument. Arguments are '+t+" and "+i+".");},v.prototype._evaluateRegExpNotMatch=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n);if(t instanceof RegExp&&typeof i=="string")return!t.test(i);if(i instanceof RegExp&&typeof t=="string")return!i.test(t);throw new c('Operator "!~" requires one RegExp argument and one string argument. Arguments are '+t+" and "+i+".");},v.prototype._evaluateRegExpExec=function(n){var t=this._left.evaluate(n),i=this._right.evaluate(n),r;if(!(t instanceof RegExp&&typeof i=="string"))throw new c("RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+t+" and "+i+".");return(r=t.exec(i),!f(r))?null:r[1]},v.prototype._evaluateToString=function(r){var u=this._left.evaluate(r);if(u instanceof RegExp||u instanceof n||u instanceof t||u instanceof i)return String(u);throw new c('Unexpected function call "'+this._value+'".');},v.prototype.getShaderExpression=function(n,t,i){var v,e,h,w,ft=this._type,r=this._value,l,ut,k,tt,p,y;f(this._left)&&(e=s(this._left)?at(this._left,n,t,this):this._left.getShaderExpression(n,t,this));f(this._right)&&(h=this._right.getShaderExpression(n,t,this));f(this._test)&&(w=this._test.getShaderExpression(n,t,this));s(this._value)&&(r=at(this._value,n,t,this));switch(ft){case a.VARIABLE:return n+r;case a.UNARY:if(r==="Boolean")return"bool("+e+")";if(r==="Number")return"float("+e+")";if(r==="round")return"floor("+e+" + 0.5)";if(f(d[r]))return r+"("+e+")";if(r==="isNaN"||r==="isFinite"||r==="String"||r==="isExactClass"||r==="isClass"||r==="getExactClassName")throw new c('Error generating style shader: "'+r+'" is not supported.');else if(f(d[r]))return r+"("+e+")";return r+e;case a.BINARY:return r==="%"?"mod("+e+", "+h+")":r==="==="?"("+e+" == "+h+")":r==="!=="?"("+e+" != "+h+")":r==="atan2"?"atan("+e+", "+h+")":f(nt[r])?r+"("+e+", "+h+")":"("+e+" "+r+" "+h+")";case a.TERNARY:if(f(rt[r]))return r+"("+e+", "+h+", "+w+")";break;case a.CONDITIONAL:return"("+w+" ? "+e+" : "+h+")";case a.MEMBER:return h==="r"||h==="x"||h==="0.0"?e+"[0]":h==="g"||h==="y"||h==="1.0"?e+"[1]":h==="b"||h==="z"||h==="2.0"?e+"[2]":h==="a"||h==="w"||h==="3.0"?e+"[3]":e+"[int("+h+")]";case a.FUNCTION_CALL:throw new c('Error generating style shader: "'+r+'" is not supported.');case a.ARRAY:if(r.length===4)return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")";if(r.length===3)return"vec3("+r[0]+", "+r[1]+", "+r[2]+")";if(r.length===2)return"vec2("+r[0]+", "+r[1]+")";throw new c("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case a.REGEX:throw new c("Error generating style shader: Regular expressions are not supported.");case a.VARIABLE_IN_STRING:throw new c("Error generating style shader: Converting a variable to a string is not supported.");case a.LITERAL_NULL:throw new c("Error generating style shader: null is not supported.");case a.LITERAL_BOOLEAN:return r?"true":"false";case a.LITERAL_NUMBER:return b(r);case a.LITERAL_STRING:if(f(i)&&i._type===a.MEMBER&&(r==="r"||r==="g"||r==="b"||r==="a"||r==="x"||r==="y"||r==="z"||r==="w"))return r;if(v=u.fromCssColorString(r,g),f(v))return nr(v);throw new c("Error generating style shader: String literals are not supported.");case a.LITERAL_COLOR:if(l=e,r==="color"){if(f(l)){if(l.length>1)return ut=l[0],k=l[1],k!=="1.0"&&(t.translucent=!0),"vec4("+ut+", "+k+")"}else return"vec4(1.0)";return"vec4("+l[0]+", 1.0)"}if(r==="rgb")return(v=lt(this),f(v))?it(v):"vec4("+l[0]+" / 255.0, "+l[1]+" / 255.0, "+l[2]+" / 255.0, 1.0)";if(r==="rgba")return(l[3]!=="1.0"&&(t.translucent=!0),v=lt(this),f(v))?it(v):"vec4("+l[0]+" / 255.0, "+l[1]+" / 255.0, "+l[2]+" / 255.0, "+l[3]+")";if(r==="hsl")return(v=ct(this),f(v))?it(v):"vec4(czm_HSLToRGB(vec3("+l[0]+", "+l[1]+", "+l[2]+")), 1.0)";if(r==="hsla")return(v=ct(this),f(v))?(v.alpha!==1&&(t.translucent=!0),it(v)):(l[3]!=="1.0"&&(t.translucent=!0),"vec4(czm_HSLToRGB(vec3("+l[0]+", "+l[1]+", "+l[2]+")), "+l[3]+")");break;case a.LITERAL_VECTOR:if(!f(e))throw new o("left should always be defined for type ExpressionNodeType.LITERAL_VECTOR");for(tt=e.length,p=r+"(",y=0;y<tt;++y)p+=e[y],y<tt-1&&(p+=", ");return p+")";case a.LITERAL_REGEX:throw new c("Error generating style shader: Regular expressions are not supported.");case a.LITERAL_UNDEFINED:throw new c("Error generating style shader: undefined is not supported.");case a.BUILTIN_VARIABLE:if(r==="tiles3d_tileset_time")return"u_time"}},k});t("Scene/Vector3DTilePrimitive",["../Core/Cartesian3","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/IndexDatatype","../Core/Matrix4","../Core/PrimitiveType","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../Shaders/ShadowVolumeFS","../Shaders/VectorTileVS","./BlendingState","./Cesium3DTileFeature","./ClassificationType","./DepthFunction","./Expression","./StencilFunction","./StencilOperation","./Vector3DTileBatch"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et){"use strict";function ot(i){var f,u,e;for(i=r(i,r.EMPTY_OBJECT),this._batchTable=i.batchTable,this._batchIds=i.batchIds,this._positions=i.positions,this._vertexBatchIds=i.vertexBatchIds,this._indices=i.indices,this._indexCounts=i.indexCounts,this._indexOffsets=i.indexOffsets,this._batchedIndices=i.batchedIndices,this._boundingVolume=i.boundingVolume,this._boundingVolumes=i.boundingVolumes,this._center=r(i.center,n.ZERO),this._va=undefined,this._sp=undefined,this._spStencil=undefined,this._spPick=undefined,this._uniformMap=undefined,this._vaSwap=undefined,this._rsStencilPreloadPass=undefined,this._rsStencilDepthPass=undefined,this._rsColorPass=undefined,this._rsPickPass=undefined,this._rsWireframe=undefined,this._commands=[],this._commandsIgnoreShow=[],this._pickCommands=[],this._constantColor=t.clone(t.WHITE),this._highlightColor=this._constantColor,this._batchDirty=!0,this._pickCommandsDirty=!0,this._framesSinceLastRebatch=0,this._updatingAllCommands=!1,this._trianglesLength=this._indices.length/3,this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength,this.debugWireframe=!1,this._debugWireframe=this.debugWireframe,this._wireframeDirty=!1,this.forceRebatch=!1,this.classificationType=r(i.classificationType,tt.BOTH),this._vertexShaderSource=i._vertexShaderSource,this._fragmentShaderSource=i._fragmentShaderSource,this._attributeLocations=i._attributeLocations,this._uniformMap=i._uniformMap,this._pickId=i._pickId,this._modelMatrix=i._modelMatrix,this._boundingSphere=i._boundingSphere,this._batchIdLookUp={},f=this._batchIds.length,u=0;u<f;++u)e=this._batchIds[u],this._batchIdLookUp[e]=u}function wt(n,t){if(!u(n._va)){var e=c.createVertexBuffer({context:t,typedArray:n._positions,usage:l.STATIC_DRAW}),s=c.createVertexBuffer({context:t,typedArray:n._vertexBatchIds,usage:l.STATIC_DRAW}),r=c.createIndexBuffer({context:t,typedArray:n._indices,usage:l.DYNAMIC_DRAW,indexDatatype:n._indices.BYTES_PER_ELEMENT===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT}),f=[{index:0,vertexBuffer:e,componentDatatype:i.fromTypedArray(n._positions),componentsPerAttribute:3},{index:1,vertexBuffer:s,componentDatatype:i.fromTypedArray(n._vertexBatchIds),componentsPerAttribute:1}];n._va=new b({context:t,attributes:f,indexBuffer:r});t.webgl2&&(n._vaSwap=new b({context:t,attributes:f,indexBuffer:c.createIndexBuffer({context:t,sizeInBytes:r.sizeInBytes,usage:l.DYNAMIC_DRAW,indexDatatype:r.indexDatatype})}));n._batchedPositions=undefined;n._transferrableBatchIds=undefined;n._vertexBatchIds=undefined;n._verticesPromise=undefined}}function bt(n,t){var a,i,o,s,v,y;if(!u(n._sp)){var h=n._batchTable,e=r(n._attributeLocations,yt),c=n._pickId,l=n._vertexShaderSource,f=n._fragmentShaderSource;if(u(l)){n._sp=p.fromCache({context:t,vertexShaderSource:l,fragmentShaderSource:f,attributeLocations:e});n._spStencil=n._sp;f=w.replaceMain(f,"czm_non_pick_main");f=f+"void main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = "+c+"; \n} \n";n._spPick=p.fromCache({context:t,vertexShaderSource:l,fragmentShaderSource:f,attributeLocations:e});return}a=h.getVertexShaderCallback(!1,"a_batchId",undefined)(d);i=h.getFragmentShaderCallback()(k,!1,undefined);c=h.getPickId();o=new w({sources:[a]});s=new w({defines:["VECTOR_TILE"],sources:[i]});n._sp=p.fromCache({context:t,vertexShaderSource:o,fragmentShaderSource:s,attributeLocations:e});o=new w({sources:[d]});s=new w({defines:["VECTOR_TILE"],sources:[k]});n._spStencil=p.fromCache({context:t,vertexShaderSource:o,fragmentShaderSource:s,attributeLocations:e});i=w.replaceMain(i,"czm_non_pick_main");i=i+"\nvoid main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor = "+c+"; \n} \n";v=new w({sources:[a]});y=new w({defines:["VECTOR_TILE"],sources:[i]});n._spPick=p.fromCache({context:t,vertexShaderSource:v,fragmentShaderSource:y,attributeLocations:e})}}function ti(n){u(n._rsStencilPreloadPass)||(n._rsStencilPreloadPass=y.fromCache(kt),n._rsStencilDepthPass=y.fromCache(dt),n._rsColorPass=y.fromCache(gt),n._rsPickPass=y.fromCache(ni))}function ii(n,t){if(!u(n._uniformMap)){var i={u_modifiedModelViewProjection:function(){var i=t.uniformState.view,r=t.uniformState.projection;return s.clone(i,st),s.multiplyByPoint(st,n._center,lt),s.setTranslation(st,lt,st),s.multiply(r,st,st),st},u_highlightColor:function(){return n._highlightColor}};n._uniformMap=n._batchTable.getUniformMapCallback()(i)}}function at(n,t,i,r,u,f,e){for(var c=n.constructor.BYTES_PER_ELEMENT,l=f.length,o=0;o<l;++o){var a=f[o],s=e[a],v=r[s],h=u[s],y=new n.constructor(n.buffer,c*v,h);t.set(y,i);r[s]=i;i+=h}return i}function ri(n,i){var e=n._indices,s=n._indexOffsets,h=n._indexCounts,c=n._batchIdLookUp,o=new e.constructor(e.length),r=i.pop(),a=[r],f=at(e,o,0,s,h,r.batchIds,c),u,l;for(r.offset=0,r.count=f;i.length>0;)u=i.pop(),t.equals(u.color,r.color)?(f=at(e,o,f,s,h,u.batchIds,c),r.batchIds=r.batchIds.concat(u.batchIds),r.count=f-r.offset):(l=f,f=at(e,o,f,s,h,u.batchIds,c),u.offset=l,u.count=f-l,a.push(u),r=u);n._va.indexBuffer.copyFromArrayView(o);n._indices=o;n._batchedIndices=a}function vt(n,t,i,r,u,f,e){for(var o=n.bytesPerIndex,l=f.length,s=0;s<l;++s){var a=f[s],h=e[a],v=r[h],c=u[h];t.copyFromBuffer(n,v*o,i*o,c*o);r[h]=i;i+=c}return i}function ui(n,i){var e=n._indexOffsets,o=n._indexCounts,s=n._batchIdLookUp,r=i.pop(),a=[r],h=n._va.indexBuffer,c=n._vaSwap.indexBuffer,f=vt(h,c,0,e,o,r.batchIds,s),u,l,v;for(r.offset=0,r.count=f;i.length>0;)u=i.pop(),t.equals(u.color,r.color)?(f=vt(h,c,f,e,o,u.batchIds,s),r.batchIds=r.batchIds.concat(u.batchIds),r.count=f-r.offset):(l=f,f=vt(h,c,f,e,o,u.batchIds,s),u.offset=l,u.count=f-l,a.push(u),r=u);v=n._va;n._va=n._vaSwap;n._vaSwap=v;n._batchedIndices=a}function fi(n,t){return t.color.toRgba()-n.color.toRgba()}function ei(n,t){var r,s,e;if(!n._batchDirty)return!1;var i=n._batchedIndices,h=i.length,f=!1,o={};for(r=0;r<h;++r)if(s=i[r].color,e=s.toRgba(),u(o[e])){f=!0;break}else o[e]=!0;if(!f)return n._batchDirty=!1,!1;if(f&&!n.forceRebatch&&n._framesSinceLastRebatch<120){++n._framesSinceLastRebatch;return}return i.sort(fi),t.webgl2?ui(n,i):ri(n,i),n._framesSinceLastRebatch=0,n._batchDirty=!1,n._pickCommandsDirty=!0,n._wireframeDirty=!0,!0}function oi(n,t){var nt=ei(n,t),h=n._commands,c=n._batchedIndices,d=c.length,g=d*3,e,i,f;if(!u(h)||nt||h.length!==g){h.length=g;var l=n._va,v=n._sp,y=r(n._modelMatrix,s.IDENTITY),p=n._uniformMap,w=n._boundingVolume;for(e=0;e<d;++e){var b=c[e].offset,k=c[e].count,o=h[e*3];u(o)||(o=h[e*3]=new a({owner:n}));o.vertexArray=l;o.modelMatrix=y;o.offset=b;o.count=k;o.renderState=n._rsStencilPreloadPass;o.shaderProgram=v;o.uniformMap=p;o.boundingVolume=w;o.cull=!1;i=h[e*3+1];u(i)||(i=h[e*3+1]=new a({owner:n}));i.vertexArray=l;i.modelMatrix=y;i.offset=b;i.count=k;i.renderState=n._rsStencilDepthPass;i.shaderProgram=v;i.uniformMap=p;i.boundingVolume=w;i.cull=!1;f=h[e*3+2];u(f)||(f=h[e*3+2]=new a({owner:n}));f.vertexArray=l;f.modelMatrix=y;f.offset=b;f.count=k;f.renderState=n._rsColorPass;f.shaderProgram=v;f.uniformMap=p;f.boundingVolume=w;f.cull=!1}n._commandsDirty=!0}}function si(n,t){var i,r;if(n.classificationType!==tt.TERRAIN&&t.invertClassification&&(!u(n._commandsIgnoreShow)||n._commandsDirty)){var e=n._commands,f=n._commandsIgnoreShow,s=n._spStencil,h=e.length,c=f.length=h/3*2,o=0;for(i=0;i<c;i+=2)r=f[i]=a.shallowClone(e[o],f[i]),r.shaderProgram=s,r.pass=v.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,r=f[i+1]=a.shallowClone(e[o+1],f[i+1]),r.shaderProgram=s,r.pass=v.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,o+=3;n._commandsDirty=!1}}function hi(n){var h,o,t,i,f;if(n._pickCommandsDirty){h=n._indexOffsets.length;o=n._pickCommands;o.length=h*3;var c=n._va,b=n._spStencil,k=n._spPick,l=r(n._modelMatrix,s.IDENTITY),v=n._uniformMap;for(t=0;t<h;++t){var y=n._indexOffsets[t],p=n._indexCounts[t],w=u(n._boundingVolumes)?n._boundingVolumes[t]:n.boundingVolume,e=o[t*3];u(e)||(e=o[t*3]=new a({owner:n,pickOnly:!0}));e.vertexArray=c;e.modelMatrix=l;e.offset=y;e.count=p;e.renderState=n._rsStencilPreloadPass;e.shaderProgram=b;e.uniformMap=v;e.boundingVolume=w;i=o[t*3+1];u(i)||(i=o[t*3+1]=new a({owner:n,pickOnly:!0}));i.vertexArray=c;i.modelMatrix=l;i.offset=y;i.count=p;i.renderState=n._rsStencilDepthPass;i.shaderProgram=b;i.uniformMap=v;i.boundingVolume=w;f=o[t*3+2];u(f)||(f=o[t*3+2]=new a({owner:n,pickOnly:!0}));f.vertexArray=c;f.modelMatrix=l;f.offset=y;f.count=p;f.renderState=n._rsPickPass;f.shaderProgram=k;f.uniformMap=v;f.boundingVolume=w}n._pickCommandsDirty=!1}}function ci(n,i){var f,u,r,s,e,o;for(n._updatingAllCommands=!0,f=n._batchIds,u=f.length,r=0;r<u;++r)s=f[r],e=i[s],e.show=!0,e.color=t.WHITE;for(o=n._batchedIndices,u=o.length,r=0;r<u;++r)o[r].color=t.clone(t.WHITE);n._updatingAllCommands=!1;n._batchDirty=!0}function pt(n,t,i,r){for(var s=n.commandList,e=i.length,o,f=0;f<e;++f)o=i[f],o.pass=t,s.push(o);if(n.invertClassification&&u(r))for(e=r.length,f=0;f<e;++f)s.push(r[f])}function pi(n,t){for(var r,u=n.commandList,f=t.length,i=0;i<f;i+=3)r=t[i+2],r.pass=v.OPAQUE,u.push(r)}function wi(n){var i=n.debugWireframe===n._debugWireframe,r,f,e,s,t,o;if(i=i&&!(n.debugWireframe&&n._wireframeDirty),!i){for(u(n._rsWireframe)||(n._rsWireframe=y.fromCache({})),n.debugWireframe?(r=n._rsWireframe,f=h.LINES):(r=n._rsColorPass,f=h.TRIANGLES),e=n._commands,s=e.length,t=0;t<s;t+=3)o=e[t+2],o.renderState=r,o.primitiveType=f;n._debugWireframe=n.debugWireframe;n._wireframeDirty=!1}}var yt,st,lt;f(ot.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});yt={position:0,a_batchId:1};var ht=0,ct=15,kt={colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:ut.ALWAYS,frontOperation:{fail:ft.KEEP,zFail:ft.DECREMENT_WRAP,zPass:ft.DECREMENT_WRAP},backFunction:ut.ALWAYS,backOperation:{fail:ft.KEEP,zFail:ft.INCREMENT_WRAP,zPass:ft.INCREMENT_WRAP},reference:ht,mask:ct},depthTest:{enabled:!1},depthMask:!1},dt={colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:ut.ALWAYS,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.INCREMENT_WRAP},backFunction:ut.ALWAYS,backOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.DECREMENT_WRAP},reference:ht,mask:ct},depthTest:{enabled:!0,func:it.LESS_OR_EQUAL},depthMask:!1},gt={stencilTest:{enabled:!0,frontFunction:ut.NOT_EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.DECREMENT_WRAP},backFunction:ut.NOT_EQUAL,backOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.DECREMENT_WRAP},reference:ht,mask:ct},depthTest:{enabled:!1},depthMask:!1,blending:g.ALPHA_BLEND},ni={stencilTest:{enabled:!0,frontFunction:ut.NOT_EQUAL,frontOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.DECREMENT_WRAP},backFunction:ut.NOT_EQUAL,backOperation:{fail:ft.KEEP,zFail:ft.KEEP,zPass:ft.DECREMENT_WRAP},reference:ht,mask:ct},depthTest:{enabled:!1},depthMask:!1};st=new s;lt=new n;ot.prototype.createFeatures=function(n,t){for(var r,u=this._batchIds,f=u.length,i=0;i<f;++i)r=u[i],t[r]=new nt(n,r)};ot.prototype.applyDebugSettings=function(n,t){this._highlightColor=n?t:this._constantColor};var li=new t,ai=t.WHITE,vi=!0,yi=/\$/;return ot.prototype.applyStyle=function(n,i){var o,s,h,e,r,l,f,c;if(!u(n)){ci(this,i);return}for(o=n.color,s=o instanceof rt&&!yi.test(o.expression),this._updatingAllCommands=s,h=this._batchIds,e=h.length,r=0;r<e;++r)l=h[r],f=i[l],f.color=u(n.color)?n.color.evaluateColor(f,li):ai,f.show=u(n.show)?n.show.evaluate(f):vi;if(s){for(c=this._batchedIndices,e=c.length,r=0;r<e;++r)c[r].color=t.clone(t.WHITE);this._updatingAllCommands=!1;this._batchDirty=!0}},ot.prototype.updateCommands=function(n,i){var c,s,a,w,h,o,k;if(!this._updatingAllCommands&&(c=this._batchIdLookUp,s=c[n],u(s))){for(var p=this._indexOffsets,d=this._indexCounts,e=p[s],l=d[s],r=this._batchedIndices,g=r.length,f=0;f<g;++f)if(a=r[f].offset,w=r[f].count,e>=a&&e<a+w)break;r.push(new et({color:t.clone(i),offset:e,count:l,batchIds:[n]}));var v=[],y=[],b=r[f].batchIds,nt=b.length;for(h=0;h<nt;++h)(o=b[h],o!==n)&&(k=c[o],p[k]<e?v.push(o):y.push(o));y.length!==0&&r.push(new et({color:t.clone(r[f].color),offset:e+l,count:r[f].offset+r[f].count-(e+l),batchIds:y}));v.length!==0?(r[f].count=e-r[f].offset,r[f].batchIds=v):r.splice(f,1);this._batchDirty=!0}},ot.prototype.update=function(n){var i=n.context,t,r;wt(this,i);bt(this,i);ti(this);ii(this,i);switch(this.classificationType){case tt.TERRAIN:t=v.TERRAIN_CLASSIFICATION;break;case tt.CESIUM_3D_TILE:t=v.CESIUM_3D_TILE_CLASSIFICATION;break;default:t=v.CLASSIFICATION}r=n.passes;r.render&&(oi(this,i),si(this,n),wi(this),this._debugWireframe?pi(n,this._commands):pt(n,t,this._commands,this._commandsIgnoreShow));r.pick&&(hi(this),pt(n,t,this._pickCommands))},ot.prototype.isDestroyed=function(){return!1},ot.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spPick=this._spPick&&this._spPick.destroy(),this._vaSwap=this._vaSwap&&this._vaSwap.destroy(),e(this)},ot});t("Scene/ClassificationModel",["../Core/arraySlice","../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/FeatureDetection","../Core/IndexDatatype","../Core/Matrix4","../Core/PrimitiveType","../Core/RuntimeError","../Core/Transforms","../Core/WebGLConstants","../ThirdParty/GltfPipeline/addDefaults","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/GltfPipeline/getAccessorByteStride","../ThirdParty/GltfPipeline/numberOfComponentsForType","../ThirdParty/GltfPipeline/parseGlb","../ThirdParty/GltfPipeline/updateVersion","../ThirdParty/when","./Axis","./ClassificationType","./ModelLoadResources","./ModelUtility","./processModelMaterialsCommon","./processPbrMaterials","./SceneMode","./Vector3DTileBatch","./Vector3DTilePrimitive"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt){"use strict";function pt(n){var i,r,e,h;if(n=o(n,o.EMPTY_OBJECT),i=n.gltf,i instanceof ArrayBuffer&&(i=new Uint8Array(i)),i instanceof Uint8Array)i=it(i),rt(i),d(i),ht(i),ct(i);else throw new w("Only binary glTF is supported as a classifier.");g.buffer(i,function(n){if(!s(n.extras._pipeline.source))throw new w("Buffer data must be embedded in the binary gltf.");});var u=i.nodes,f=i.meshes,c=u[0],l=c.mesh;if(u.length!==1||!s(l))throw new w("Only one node is supported for classification and it must have a mesh.");if(f.length!==1)throw new w("Only one mesh is supported when using b3dm for classification.");if(r=f[0].primitives,r.length!==1)throw new w("Only one primitive per mesh is supported when using b3dm for classification.");if(e=r[0].attributes.POSITION,!s(e))throw new w("The mesh must have a position attribute.");if(h=r[0].attributes._BATCHID,!s(h))throw new w("The mesh must have a batch id attribute.");this._gltf=i;this.show=o(n.show,!0);this.modelMatrix=y.clone(o(n.modelMatrix,y.IDENTITY));this._modelMatrix=y.clone(this.modelMatrix);this._ready=!1;this._readyPromise=ut.defer();this.debugShowBoundingVolume=o(n.debugShowBoundingVolume,!1);this._debugShowBoundingVolume=!1;this.debugWireframe=o(n.debugWireframe,!1);this._debugWireframe=!1;this._classificationType=n.classificationType;this._vertexShaderLoaded=n.vertexShaderLoaded;this._classificationShaderLoaded=n.classificationShaderLoaded;this._uniformMapLoaded=n.uniformMapLoaded;this._pickIdLoaded=n.pickIdLoaded;this._ignoreCommands=o(n.ignoreCommands,!1);this._upAxis=o(n.upAxis,ft.Y);this._batchTable=n.batchTable;this._computedModelMatrix=new y;this._initialRadius=undefined;this._boundingSphere=undefined;this._scaledBoundingSphere=new t;this._state=yt.NEEDS_LOAD;this._loadResources=undefined;this._mode=undefined;this._dirty=!1;this._nodeMatrix=new y;this._primitive=undefined;this._extensionsUsed=undefined;this._extensionsRequired=undefined;this._quantizedUniforms=undefined;this._buffers={};this._vertexArray=undefined;this._shaderProgram=undefined;this._uniformMap=undefined;this._geometryByteLength=0;this._trianglesLength=0;this._rtcCenter=undefined;this._rtcCenterEye=undefined;this._rtcCenter3D=undefined;this._rtcCenter2D=undefined}function ti(n){var t=n.gltf,i=n._loadResources;g.buffer(t,function(n,t){i.buffers[t]=n.extras._pipeline.source})}function ii(n){var r=n.gltf.bufferViews,u=n._loadResources.vertexBuffersToCreate,i,t;g.bufferView(n.gltf,function(n,t){n.target===k.ARRAY_BUFFER&&u.enqueue(t)});i=n._loadResources.indexBuffersToCreate;t={};g.accessor(n.gltf,function(n){var u=n.bufferView,f=r[u];f.target!==k.ELEMENT_ARRAY_BUFFER||s(t[u])||(t[u]=!0,i.enqueue({id:u,componentType:n.componentType}))})}function ri(n,t){var r=t._loadResources,u=t.gltf.bufferViews,f=u[n],i=r.getBuffer(f);t._buffers[n]=i;t._geometryByteLength+=i.byteLength}function ui(n,t,i){var u=i._loadResources,f=i.gltf.bufferViews,e=f[n],r={typedArray:u.getBuffer(e),indexDatatype:t};i._buffers[n]=r;i._geometryByteLength+=r.typedArray.byteLength}function fi(n){var t=n._loadResources,i,r,u;if(t.pendingBufferLoads===0){for(i=t.vertexBuffersToCreate,r=t.indexBuffersToCreate;i.length>0;)ri(i.dequeue(),n);while(r.length>0)u=r.dequeue(),ui(u.id,u.componentType,n)}}function ei(n,t){var r=t.gltf.meshes[0].primitives[0],i=st.modifyShaderForQuantizedAttributes(t.gltf,r,n);return t._quantizedUniforms=i.uniforms,i.shader}function dt(n,t){return s(t)&&(n=t(n)),n}function oi(n){var t=n.gltf,r=st.getAttributeOrUniformBySemantic(t,"POSITION"),v=st.getAttributeOrUniformBySemantic(t,"_BATCHID"),h={},u,c,f,l,i,e,o;h[r]=0;h[v]=1;u=st.getAttributeOrUniformBySemantic(t,"MODELVIEWPROJECTION");s(u)?(c="uniform mat4 "+u+";\n",f=u+" * vec4("+r+", 1.0)"):(l=st.getAttributeOrUniformBySemantic(t,"PROJECTION"),i=st.getAttributeOrUniformBySemantic(t,"MODELVIEW"),s(i)||(i=st.getAttributeOrUniformBySemantic(t,"CESIUM_RTC_MODELVIEW")),c="uniform mat4 "+i+";\nuniform mat4 "+l+";\n",f=l+" * "+i+" * vec4("+r+", 1.0)");var y="    vec4 positionInClipCoords = "+f+";\n",a="attribute vec3 "+r+";\nattribute float "+v+";\n"+c+"void main() {\n"+y+"    gl_Position = czm_depthClampFarPlane(positionInClipCoords);\n}\n";n.extensionsUsed.WEB3D_quantized_attributes&&(a=ei(a,n));e=dt(a,n._vertexShaderLoaded);o=dt("#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeDepthClampedToFarPlane();\n}\n",n._classificationShaderLoaded);e=st.modifyVertexShaderForLogDepth(e,f);o=st.modifyFragmentShaderForLogDepth(o);n._shaderProgram={vertexShaderSource:e,fragmentShaderSource:o,attributeLocations:h}}function si(){return{POSITION:0,_BATCHID:1}}function hi(n){var h=n._loadResources,e,o;if(h.finishedBuffersCreation()&&!s(n._vertexArray)){var r=n._buffers,t=n.gltf,u=t.accessors,c=t.meshes,l=c[0].primitives,i=l[0],a=si(),f={};g.meshPrimitiveAttribute(i,function(n,i){var o=a[i],e;s(o)&&(e=u[n],f[i]={index:o,vertexBuffer:r[e.bufferView],componentsPerAttribute:tt(e.type),componentDatatype:e.componentType,offsetInBytes:e.byteOffset,strideInBytes:nt(t,e)})});s(i.indices)&&(o=u[i.indices],e=r[o.bufferView]);n._vertexArray={attributes:f,indexBuffer:e}}}function ci(n,t){if(!s(n._uniformMap)){var i={};g.technique(n.gltf,function(r){g.techniqueUniform(r,function(r,u){s(r.semantic)&&s(bt[r.semantic])&&(i[u]=bt[r.semantic](t.uniformState,n))})});n._uniformMap=i}}function li(n,t){return st.createUniformsForQuantizedAttributes(n.gltf,t,n._quantizedUniforms)}function ai(n,t){switch(n.mode){case p.TRIANGLES:return t/3;case p.TRIANGLE_STRIP:case p.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function vi(r){var ii=r._batchTable,k=r._uniformMap,it=r._vertexArray,ot=r.gltf,dt=ot.accessors,ri=ot.meshes,d=ri[0].primitives[0],rt=dt[d.indices],ui=d.attributes.POSITION,gt=st.getAccessorMinMax(ot,ui),fi=t.fromCornerPoints(i.fromArray(gt.min),i.fromArray(gt.max)),ut,ft,ni,ti,a,h,c,et,p,w,bt,b;s(rt)?(ft=rt.count,ut=rt.byteOffset/v.getSizeInBytes(rt.componentType)):(ni=dt[d.attributes.POSITION],ft=ni.count,ut=0);r._trianglesLength+=ai(d,ft);s(r._uniformMapLoaded)&&(k=r._uniformMapLoaded(k));r.extensionsUsed.WEB3D_quantized_attributes&&(ti=li(r,d),k=f(k,ti));var g=it.attributes.POSITION,nt=g.componentDatatype,o=g.vertexBuffer,ht=o.byteOffset,ct=o.byteLength/e.getSizeInBytes(nt),lt=e.createArrayBufferView(nt,o.buffer,ht,ct);g=it.attributes._BATCHID;nt=g.componentDatatype;o=g.vertexBuffer;ht=o.byteOffset;ct=o.byteLength/e.getSizeInBytes(nt);a=e.createArrayBufferView(nt,o.buffer,ht,ct);h=it.indexBuffer.typedArray;c=it.indexBuffer.indexDatatype===v.UNSIGNED_SHORT?new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):new Uint32Array(h.buffer,h.byteOffset,h.byteLength/Uint32Array.BYTES_PER_ELEMENT);lt=n(lt);a=n(a);c=n(c,ut,ut+ft);var yt=[],pt=[],l=[],wt=[],tt=a[c[0]];for(yt.push(tt),l.push(0),bt=c.length,b=1;b<bt;++b)et=a[c[b]],et!==tt&&(p=l[l.length-1],w=b-p,yt.push(et),pt.push(w),l.push(b),wt.push(new at({offset:p,count:w,batchIds:[tt],color:u.WHITE})),tt=et);p=l[l.length-1];w=bt-p;pt.push(w);wt.push(new at({offset:p,count:w,batchIds:[tt],color:u.WHITE}));var kt=r._shaderProgram,ei=kt.vertexShaderSource,oi=kt.fragmentShaderSource,si=kt.attributeLocations,hi=s(r._pickIdLoaded)?r._pickIdLoaded():undefined;r._primitive=new vt({classificationType:r._classificationType,positions:lt,indices:c,indexOffsets:l,indexCounts:pt,batchIds:yt,vertexBatchIds:a,batchedIndices:wt,batchTable:ii,boundingVolume:new t,_vertexShaderSource:ei,_fragmentShaderSource:oi,_attributeLocations:si,_uniformMap:k,_pickId:hi,_modelMatrix:new y,_boundingSphere:fi});r._buffers=undefined;r._vertexArray=undefined;r._shaderProgram=undefined;r._uniformMap=undefined}function yi(n){var t=n._loadResources;if(t.finished()&&!s(n._primitive)){var i=n.gltf,r=i.nodes,u=r[0];n._nodeMatrix=st.getTransform(u,n._nodeMatrix);vi(n)}}function gt(n,t){var i=t.context;st.checkSupportedGlExtensions(n.gltf.glExtensionsUsed,i);fi(n);oi(n);hi(n);ci(n,i);yi(n)}function pi(n,u,f,e){var o=n._computedModelMatrix,c,l,a,h;n._mode===lt.SCENE3D||n._ignoreCommands||(c=y.getColumn(o,3,ni),r.equals(c,r.UNIT_W)?(l=n.boundingSphere.center,a=b.wgs84To2DModelMatrix(e,l,wt),o=y.multiply(a,o,wt),s(n._rtcCenter)&&(y.setTranslation(o,r.UNIT_W,o),n._rtcCenter=n._rtcCenter2D)):(o=b.basisTo2D(e,o,wt),n._rtcCenter=n._rtcCenter3D));h=n._primitive;(u||f)&&(y.multiplyTransformation(o,n._nodeMatrix,h._modelMatrix),t.transform(h._boundingSphere,h._modelMatrix,h._boundingVolume),s(n._rtcCenter)&&i.add(n._rtcCenter,h._boundingVolume.center,h._boundingVolume.center))}var kt,yt,bt,ni,wt;return a.supportsTypedArrays()?(kt=new i,yt=st.ModelState,h(pt.prototype,{gltf:{get:function(){return this._gltf}},boundingSphere:{get:function(){if(this._state!==yt.LOADED)throw new l("The model is not loaded.  Use ClassificationModel.readyPromise or wait for ClassificationModel.ready to be true.");var r=this.modelMatrix,t=y.getScale(r,kt),n=this._scaledBoundingSphere;return n.center=i.multiplyComponents(this._boundingSphere.center,t,n.center),n.radius=i.maximumComponent(t)*this._initialRadius,s(this._rtcCenter)&&i.add(this._rtcCenter,n.center,n.center),n}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},dirty:{get:function(){return this._dirty}},extensionsUsed:{get:function(){return s(this._extensionsUsed)||(this._extensionsUsed=st.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return s(this._extensionsRequired)||(this._extensionsRequired=st.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return 0}},classificationType:{get:function(){return this._classificationType}}}),bt={PROJECTION:function(n,t){return st.getGltfSemanticUniforms().PROJECTION(n,t)},MODELVIEW:function(n,t){return st.getGltfSemanticUniforms().MODELVIEW(n,t)},CESIUM_RTC_MODELVIEW:function(n,t){return st.getGltfSemanticUniforms().CESIUM_RTC_MODELVIEW(n,t)},MODELVIEWPROJECTION:function(n,t){return st.getGltfSemanticUniforms().MODELVIEWPROJECTION(n,t)}},ni=new r,wt=new y,pt.prototype.updateCommands=function(n,t){this._primitive.updateCommands(n,t)},pt.prototype.update=function(n){var e,l,f,t,a,o,p,h,r,c;if(n.mode!==lt.MORPHING){if(this._state===yt.NEEDS_LOAD&&s(this.gltf)&&(this._state=yt.LOADING,this._state!==yt.FAILED)){if(e=this.gltf.extensions,s(e)&&s(e.CESIUM_RTC)&&(l=i.fromArray(e.CESIUM_RTC.center),!i.equals(l,i.ZERO))){this._rtcCenter3D=l;var v=n.mapProjection,w=v.ellipsoid,b=w.cartesianToCartographic(this._rtcCenter3D),u=v.project(b);i.fromElements(u.z,u.x,u.y,u);this._rtcCenter2D=u;this._rtcCenterEye=new i;this._rtcCenter=this._rtcCenter3D}this._loadResources=new ot;st.parseBuffers(this)}if(f=this._loadResources,t=!1,this._state===yt.LOADING&&(f.pendingBufferLoads===0&&(st.checkSupportedExtensions(this.extensionsRequired),ti(this),ii(this),this._boundingSphere=st.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,gt(this,n)),f.finished()&&(this._state=yt.LOADED,t=!0)),s(f)&&this._state===yt.LOADED&&(t||gt(this,n),f.finished()&&(this._loadResources=undefined)),a=this.show,(a&&this._state===yt.LOADED||t)&&(this._dirty=!1,o=this.modelMatrix,p=n.mode!==this._mode,this._mode=n.mode,h=!y.equals(this._modelMatrix,o)||p,(h||t)&&(y.clone(o,this._modelMatrix),r=this._computedModelMatrix,y.clone(o,r),this._upAxis===ft.Y?y.multiplyTransformation(r,ft.Y_UP_TO_Z_UP,r):this._upAxis===ft.X&&y.multiplyTransformation(r,ft.X_UP_TO_Z_UP,r)),(h||t)&&(pi(this,h,t,n.mapProjection),this._dirty=!0)),t){c=this;n.afterRender.push(function(){c._ready=!0;c._readyPromise.resolve(c)});return}a&&!this._ignoreCommands&&(this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.debugWireframe=this.debugWireframe,this._primitive.update(n))}},pt.prototype.isDestroyed=function(){return!1},pt.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),c(this)},pt):{}});t("Scene/Batched3DModel3DTileContent",["../Core/Cartesian3","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/DeveloperError","../Core/FeatureDetection","../Core/getStringFromTypedArray","../Core/Matrix4","../Core/RequestType","../Core/RuntimeError","../Core/Transforms","../Renderer/Pass","./Axis","./Cesium3DTileBatchTable","./Cesium3DTileFeature","./Cesium3DTileFeatureTable","./ClassificationModel","./Model","./ModelUtility"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function it(n,t,i,r,u){this._tileset=n;this._tile=t;this._resource=i;this._model=undefined;this._batchTable=undefined;this._features=undefined;this._batchIdAttributeName=undefined;this._diffuseAttributeOrUniformName={};this._rtcCenterTransform=undefined;this._contentModelMatrix=undefined;this.featurePropertiesDirty=!1;ct(this,r,u)}function et(n){var t=tt.getAttributeOrUniformBySemantic(n,"_BATCHID");return u(t)||(t=tt.getAttributeOrUniformBySemantic(n,"BATCHID"),u(t)&&it._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`.")),t}function ut(n){return function(t,i){var e=n._batchTable,o=!u(n._tileset.classificationType),r=n._model.gltf,f;return u(r)&&(n._batchIdAttributeName=et(r),n._diffuseAttributeOrUniformName[i]=tt.getDiffuseAttributeOrUniform(r,i)),f=e.getVertexShaderCallback(o,n._batchIdAttributeName,n._diffuseAttributeOrUniformName[i]),u(f)?f(t):t}}function ot(n){return function(t,i){var e=n._batchTable,o=!u(n._tileset.classificationType),f=n._model.gltf,r;return u(f)&&(n._diffuseAttributeOrUniformName[i]=tt.getDiffuseAttributeOrUniform(f,i)),r=e.getFragmentShaderCallback(o,n._diffuseAttributeOrUniformName[i]),u(r)?r(t):t}}function ft(n){return function(){return n._batchTable.getPickId()}}function st(n){return function(t){var r=n._batchTable,i=r.getClassificationFragmentShaderCallback();return u(i)?i(t):t}}function ht(n){return function(t,i){n._model.updateCommands(t,i)}}function ct(t,f,e){var o=t._tileset,oi=t._tile,dt=t._resource,gt=r(e,0),lt,y,wt,ni,s,k,h,tt,et,bt,ti,ii,at,ri,vt,ui,fi,ct,yt,pt,ei,kt;if(e=gt,lt=new Uint8Array(f),y=new DataView(f),e+=rt,wt=y.getUint32(e,!0),wt!==1)throw new v("Only Batched 3D Model version 1 is supported.  Version "+wt+" is not.");if(e+=rt,ni=y.getUint32(e,!0),e+=rt,s=y.getUint32(e,!0),e+=rt,k=y.getUint32(e,!0),e+=rt,h=y.getUint32(e,!0),e+=rt,tt=y.getUint32(e,!0),e+=rt,h>=570425344?(e-=rt*2,et=s,h=k,tt=0,s=0,k=0,it._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):tt>=570425344&&(e-=rt,et=h,h=s,tt=k,s=0,k=0,it._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")),s===0?bt={BATCH_LENGTH:r(et,0)}:(ti=c(lt,e,s),bt=JSON.parse(ti),e+=s),ii=new Uint8Array(f,e,k),e+=k,at=new d(bt,ii),et=at.getGlobalProperty("BATCH_LENGTH"),at.featuresLength=et,h>0&&(ui=c(lt,e,h),ri=JSON.parse(ui),e+=h,tt>0&&(vt=new Uint8Array(f,e,tt),vt=new Uint8Array(vt),e+=tt)),u(o.classificationType)&&(fi=ht(t)),ct=new b(t,et,ri,vt,fi),t._batchTable=ct,yt=gt+ni-e,yt===0)throw new v("glTF byte length must be greater than 0.");e%4==0?pt=new Uint8Array(f,e,yt):(it._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),pt=new Uint8Array(lt.subarray(e,e+yt)));ei={content:t,primitive:o};t._rtcCenterTransform=l.IDENTITY;kt=at.getGlobalProperty("RTC_CENTER",i.FLOAT,3);u(kt)&&(t._rtcCenterTransform=l.fromTranslation(n.fromArray(kt)));t._contentModelMatrix=l.multiply(oi.computedTransform,t._rtcCenterTransform,new l);t._model=u(o.classificationType)?new g({gltf:pt,cull:!1,basePath:dt,requestType:a.TILES3D,modelMatrix:t._contentModelMatrix,upAxis:o._gltfUpAxis,forwardAxis:w.X,debugWireframe:o.debugWireframe,vertexShaderLoaded:ut(t),classificationShaderLoaded:st(t),uniformMapLoaded:ct.getUniformMapCallback(),pickIdLoaded:ft(t),classificationType:o._classificationType,batchTable:ct}):new nt({gltf:pt,cull:!1,releaseGltfJson:!0,opaquePass:p.CESIUM_3D_TILE,basePath:dt,requestType:a.TILES3D,modelMatrix:t._contentModelMatrix,upAxis:o._gltfUpAxis,forwardAxis:w.X,shadows:o.shadows,debugWireframe:o.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:ut(t),fragmentShaderLoaded:ot(t),uniformMapLoaded:ct.getUniformMapCallback(),pickIdLoaded:ft(t),addBatchIdToGeneratedShaders:et>0,pickObject:ei})}function lt(n){var i=n.featuresLength,r,t;if(!u(n._features)&&i>0){for(r=new Array(i),t=0;t<i;++t)r[t]=new k(n,t);n._features=r}}if(!h.supportsTypedArrays())return{};it._deprecationWarning=e;f(it.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var rt=Uint32Array.BYTES_PER_ELEMENT;return it.prototype.hasProperty=function(n,t){return this._batchTable.hasProperty(n,t)},it.prototype.getFeature=function(n){var t=this.featuresLength;if(!u(n)||n<0||n>=t)throw new s("batchId is required and between zero and featuresLength - 1 ("+(t-1)+").");return lt(this),this._features[n]},it.prototype.applyDebugSettings=function(n,i){i=n?i:t.WHITE;this.featuresLength===0?this._model.color=i:this._batchTable.setAllColor(i)},it.prototype.applyStyle=function(n){this._batchTable.applyStyle(n)},it.prototype.update=function(n,t){var r=t.commandList.length,i,f;this._batchTable.update(n,t);this._contentModelMatrix=l.multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix);this._model.modelMatrix=this._contentModelMatrix;this._model.shadows=this._tileset.shadows;this._model.debugWireframe=this._tileset.debugWireframe;i=this._tileset.clippingPlanes;this._tile.clippingPlanesDirty&&u(i)&&(this._model.clippingPlaneOffsetMatrix=this._tileset.clippingPlaneOffsetMatrix,this._model._clippingPlanes=i.enabled&&this._tile._isClipped?i:undefined);u(i)&&u(this._model._clippingPlanes)&&this._model._clippingPlanes!==i&&(this._model._clippingPlanes=i);this._model.update(t);f=t.commandList.length;r<f&&(t.passes.render||t.passes.pick)&&!u(n.classificationType)&&this._batchTable.addDerivedCommands(t,r)},it.prototype.isDestroyed=function(){return!1},it.prototype.destroy=function(){return this._model=this._model&&this._model.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),o(this)},it});t("Scene/BingMapsStyle",["../Core/freezeObject"],function(n){"use strict";return n({AERIAL:"Aerial",AERIAL_WITH_LABELS:"AerialWithLabels",ROAD:"Road",CANVAS_DARK:"CanvasDark",CANVAS_LIGHT:"CanvasLight",CANVAS_GRAY:"CanvasGray",ORDNANCE_SURVEY:"OrdnanceSurvey",COLLINS_BART:"CollinsBart"})});t("Scene/BingMapsImageryProvider",["../Core/BingMapsApi","../Core/buildModuleUrl","../Core/Cartesian2","../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/Math","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../Core/WebMercatorTilingScheme","../ThirdParty/when","./BingMapsStyle","./DiscardMissingTileImagePolicy","./ImageryProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function g(t){function rt(n){var t,a,w,f,v,d,s,g,p,it,b,h;if(n.resourceSets.length!==1){nt();return}for(t=n.resourceSets[0].resources[0],r._tileWidth=t.imageWidth,r._tileHeight=t.imageHeight,r._maximumLevel=t.zoomMax-1,r._imageUrlSubdomains=t.imageUrlSubdomains,r._imageUrlTemplate=t.imageUrl,a=r._tileProtocol,e(a)||(w=document.location.protocol,a=/^http/.test(w)?w:"http:"),r._imageUrlTemplate=r._imageUrlTemplate.replace(/^http:/,a),e(r._tileDiscardPolicy)||(r._tileDiscardPolicy=new k({missingImageUrl:tt(r,0,0,r._maximumLevel).url,pixelsToCheck:[new i(0,0),new i(120,140),new i(130,160),new i(200,50),new i(200,200)],disableCheckIfAllPixelsAreTransparent:!0})),f=r._attributionList=t.imageryProviders,f||(f=r._attributionList=[]),v=0,d=f.length;v<d;++v)for(s=f[v],s.credit=new u(s.attribution),g=s.coverageAreas,p=0,it=s.coverageAreas.length;p<it;++p)b=g[p],h=b.bbox,b.bbox=new l(c.toRadians(h[1]),c.toRadians(h[0]),c.toRadians(h[3]),c.toRadians(h[2]));r._ready=!0;r._readyPromise.resolve(!0);y.handleSuccess(o)}function nt(){var n="An error occurred while accessing "+d.url+".";o=y.handleError(o,r,r._errorEvent,n,undefined,undefined,undefined,it);r._readyPromise.reject(new v(n))}function it(){var n=d.fetchJsonp("jsonp");w(n,rt,nt)}if(t=f(t,{}),!e(t.url))throw new s("options.url is required.");this._key=n.getKey(t.key);this._resource=a.createIfNeeded(t.url);this._resource.appendForwardSlash();this._tileProtocol=t.tileProtocol;this._mapStyle=f(t.mapStyle,b.AERIAL);this._culture=f(t.culture,"");this._tileDiscardPolicy=t.tileDiscardPolicy;this._proxy=t.proxy;this._credit=new u('<a href="http://www.bing.com"><img src="'+g.logoUrl+'" title="Bing Imagery"/><\/a>');this.defaultGamma=1;this._tilingScheme=new p({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:t.ellipsoid});this._tileWidth=undefined;this._tileHeight=undefined;this._maximumLevel=undefined;this._imageUrlTemplate=undefined;this._imageUrlSubdomains=undefined;this._errorEvent=new h;this._ready=!1;this._readyPromise=w.defer();var d=this._resource.getDerivedResource({url:"REST/v1/Imagery/Metadata/"+this._mapStyle,queryParameters:{incl:"ImageryProviders",key:this._key}}),r=this,o;it()}function tt(n,t,i,r,u){var e=n._imageUrlTemplate,f=n._imageUrlSubdomains,o=(t+i+r)%f.length;return n._resource.getDerivedResource({url:e,request:u,templateValues:{quadkey:g.tileXYToQuadKey(t,i,r),subdomain:f[o],culture:n._culture}})}function rt(n,t,i){var o,r,c,u,a,f,v;for(++t,o=[],r=0,c=n.length;r<c;++r){var s=n[r],y=s.coverageAreas,h=!1;for(u=0,a=s.coverageAreas.length;!h&&u<a;++u)f=y[u],t>=f.zoomMin&&t<=f.zoomMax&&(v=l.intersection(i,f.bbox,it),e(v)&&(h=!0));h&&o.push(s.credit)}return o}var nt,it;return o(g.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},key:{get:function(){return this._key}},mapStyle:{get:function(){return this._mapStyle}},culture:{get:function(){return this._culture}},tileWidth:{get:function(){if(!this._ready)throw new s("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new s("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new s("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new s("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new s("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new s("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new s("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}}),nt=new l,g.prototype.getTileCredits=function(n,t,i){if(!this._ready)throw new s("getTileCredits must not be called before the imagery provider is ready.");var r=this._tilingScheme.tileXYToRectangle(n,t,i,nt);return rt(this._attributionList,i,r)},g.prototype.requestImage=function(n,t,i,r){if(!this._ready)throw new s("requestImage must not be called before the imagery provider is ready.");return d.loadImage(this,tt(this,n,t,i,r))},g.prototype.pickFeatures=function(){return undefined},g.tileXYToQuadKey=function(n,t,i){for(var f,r,e="",u=i;u>=0;--u)f=1<<u,r=0,(n&f)!=0&&(r|=1),(t&f)!=0&&(r|=2),e+=r;return e},g.quadKeyToTileXY=function(n){for(var r,u,f=0,e=0,i=n.length-1,t=i;t>=0;--t)r=1<<t,u=+n[i-t],(u&1)!=0&&(f|=r),(u&2)!=0&&(e|=r);return{x:f,y:e,level:i}},g._logoUrl=undefined,o(g,{logoUrl:{get:function(){return e(g._logoUrl)||(g._logoUrl=t("Assets/Images/bing_maps_credit.png")),g._logoUrl},set:function(n){r.defined("value",n);g._logoUrl=n}}}),it=new l,g});t("Scene/BoxEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(n,t,i,r,u){"use strict";function f(r){r=i(r,o);t.defined("dimensions",r);t.typeOf.number.greaterThanOrEquals("dimensions.x",r.x,0);t.typeOf.number.greaterThanOrEquals("dimensions.y",r.y,0);t.typeOf.number.greaterThanOrEquals("dimensions.z",r.z,0);this._dimensions=n.clone(r)}var o=new n(1,1,1),e;return r(f.prototype,{dimensions:{get:function(){return this._dimensions},set:function(i){t.defined("value",i);t.typeOf.number.greaterThanOrEquals("value.x",i.x,0);t.typeOf.number.greaterThanOrEquals("value.y",i.y,0);t.typeOf.number.greaterThanOrEquals("value.z",i.z,0);n.clone(i,this._dimensions)}}}),e=new n,f.prototype.emit=function(t){var r=this._dimensions,i=n.multiplyByScalar(r,.5,e),f=u.randomBetween(-i.x,i.x),o=u.randomBetween(-i.y,i.y),s=u.randomBetween(-i.z,i.z);t.position=n.fromElements(f,o,s,t.position);t.velocity=n.normalize(t.position,t.velocity)},f});t("Shaders/BrdfLutGeneratorFS",[],function(){"use strict";return"varying vec2 v_textureCoordinates;\nconst float M_PI = 3.141592653589793;\nfloat vdcRadicalInverse(int i)\n{\nfloat r;\nfloat base = 2.0;\nfloat value = 0.0;\nfloat invBase = 1.0 / base;\nfloat invBi = invBase;\nfor (int x = 0; x < 100; x++)\n{\nif (i <= 0)\n{\nbreak;\n}\nr = mod(float(i), base);\nvalue += r * invBi;\ninvBi *= invBase;\ni = int(float(i) * invBase);\n}\nreturn value;\n}\nvec2 hammersley2D(int i, int N)\n{\nreturn vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\nfloat a = roughness * roughness;\nfloat phi = 2.0 * M_PI * xi.x;\nfloat cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\nvec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\nvec3 tangentX = normalize(cross(upVector, N));\nvec3 tangentY = cross(N, tangentX);\nreturn tangentX * H.x + tangentY * H.y + N * H.z;\n}\nfloat G1_Smith(float NdotV, float k)\n{\nreturn NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\nfloat k = roughness * roughness / 2.0;\nreturn G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\nvec2 integrateBrdf(float roughness, float NdotV)\n{\nvec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\nfloat A = 0.0;\nfloat B = 0.0;\nconst int NumSamples = 1024;\nfor (int i = 0; i < NumSamples; i++)\n{\nvec2 xi = hammersley2D(i, NumSamples);\nvec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\nvec3 L = 2.0 * dot(V, H) * H - V;\nfloat NdotL = clamp(L.z, 0.0, 1.0);\nfloat NdotH = clamp(H.z, 0.0, 1.0);\nfloat VdotH = clamp(dot(V, H), 0.0, 1.0);\nif (NdotL > 0.0)\n{\nfloat G = G_Smith(roughness, NdotV, NdotL);\nfloat G_Vis = G * VdotH / (NdotH * NdotV);\nfloat Fc = pow(1.0 - VdotH, 5.0);\nA += (1.0 - Fc) * G_Vis;\nB += Fc * G_Vis;\n}\n}\nreturn vec2(A, B) / float(NumSamples);\n}\nvoid main()\n{\ngl_FragColor = vec4(integrateBrdf(1.0 - v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n"});t("Scene/BrdfLutGenerator",["../Core/BoundingRectangle","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/PixelFormat","../Renderer/Framebuffer","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Shaders/BrdfLutGeneratorFS"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(){this._framebuffer=undefined;this._colorTexture=undefined;this._drawCommand=undefined}function p(t,i){var r=t._framebuffer,u=i.createViewportQuadCommand(v,{framebuffer:r,renderState:o.fromCache({viewport:new n(0,0,256,256)})});t._drawCommand=u}function w(n,t){var i=new h({context:t,width:256,height:256,pixelFormat:u.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new s({wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,minificationFilter:l.NEAREST,magnificationFilter:c.NEAREST})}),r;n._colorTexture=i;r=new f({context:t,colorTextures:[i],destroyAttachments:!1});n._framebuffer=r}return i(y.prototype,{colorTexture:{get:function(){return this._colorTexture}}}),y.prototype.update=function(n){if(!t(this._colorTexture)){var i=n.context;w(this,i);p(this,i);this._drawCommand.execute(i);this._framebuffer=this._framebuffer&&this._framebuffer.destroy();this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),r(this)},y});t("Scene/CameraFlightPath",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/EasingFunction","../Core/Math","../Core/PerspectiveFrustum","../Core/PerspectiveOffCenterFrustum","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function d(n,t,i){var r,u,f,e;return n instanceof s?(e=Math.tan(.5*n.fovy),r=n.near,u=n.near*e,f=n.aspectRatio*u,Math.max(t*r/f,i*r/u)):n instanceof h?(r=n.near,u=n.top,f=n.right,Math.max(t*r/f,i*r/u)):Math.max(t,i)}function nt(n,t,i,r){if(u(r)&&i(.5)>r){var f=i(0),e=i(1),s=i(.5),h=s-f,c=s-e;return function(r){var u=i(r),s,l;return r<=.5?(s=(u-f)/h,o.lerp(n,-o.PI_OVER_TWO,s)):(l=(u-e)/c,o.lerp(-o.PI_OVER_TWO,t,1-l))}}return function(i){return o.lerp(n,t,i)}}function a(n,i,r,f,e){var s=e,w=Math.max(r,f);if(!u(s)){var b=n.position,k=i,l=n.up,a=n.right,nt=n.frustum,v=t.subtract(b,k,g),tt=t.magnitude(t.multiplyByScalar(l,t.dot(v,l),p)),it=t.magnitude(t.multiplyByScalar(a,t.dot(v,a),p));s=Math.min(d(nt,tt,it)*.2,1e9)}if(w<s){var h=8,c=1e6,y=-Math.pow((s-r)*c,1/h),rt=Math.pow((s-f)*c,1/h);return function(n){var t=n*(rt-y)+y;return-Math.pow(t,h)/c+s}}return function(n){return o.lerp(r,f,n)}}function l(n,t){return o.equalsEpsilon(n,o.TWO_PI,o.EPSILON11)&&(n=0),t>n+Math.PI?n+=o.TWO_PI:t<n-Math.PI&&(n-=o.TWO_PI),n}function tt(i,r,u,f,e,s,h){function d(t){var i=t.time/r;c.setView({orientation:{heading:o.lerp(p,f,i),pitch:o.lerp(y,e,i),roll:o.lerp(b,s,i)}});n.lerp(v,u,i,c.position);c.position.z=k(i)}var c=i.camera,v=t.clone(c.position,w),y=c.pitch,p=l(c.heading,f),b=l(c.roll,s),k=a(c,u,v.z,u.z,h);return d}function it(n,t){n.longitude<t.longitude?n.longitude+=o.TWO_PI:t.longitude+=o.TWO_PI}function rt(n,t){var i=n.longitude-t.longitude;i<-o.PI?n.longitude+=o.TWO_PI:i>o.PI&&(t.longitude+=o.TWO_PI)}function et(n,r,f,e,s,h,c,v,y,p){function dt(){var n=w.longitude,i=b.longitude,u=w.latitude,f=b.latitude;return function(s){var c=s.time/r,l=t.fromRadians(o.lerp(n,i,c),o.lerp(u,f,c),et(c));k.setView({destination:l,orientation:{heading:o.lerp(vt,e,c),pitch:ht(c),roll:o.lerp(yt,h,c)}})}}var k=n.camera,ct=n.mapProjection,lt=ct.ellipsoid,w=i.clone(k.positionCartographic,ut),at=k.pitch,vt=l(k.heading,e),yt=l(k.roll,h),b=lt.cartesianToCartographic(f,ft),d,et,ht;if(w.longitude=o.zeroToTwoPi(w.longitude),b.longitude=o.zeroToTwoPi(b.longitude),d=!1,u(v)){var ot=o.zeroToTwoPi(v),pt=Math.min(w.longitude,b.longitude),wt=Math.max(w.longitude,b.longitude),g=ot>=pt&&ot<=wt;if(u(y)){var tt=Math.abs(w.longitude-b.longitude),st=o.TWO_PI-tt,bt=g?tt:st,kt=g?st:tt;bt<kt*y&&!g&&(d=!0)}else g||(d=!0)}return d?it(w,b):rt(w,b),et=a(k,f,w.height,b.height,c),ht=nt(at,s,et,p),dt()}function ot(i,r,u,f,e,s,h){function k(t){var e=t.time/r;c.setView({orientation:{heading:o.lerp(y,f,e)}});n.lerp(v,u,e,c.position);var h=b(e),i=c.frustum,l=i.top/i.right,s=(h-(i.right-i.left))*.5;i.right+=s;i.left-=s;i.top=l*i.right;i.bottom=-i.top}var c=i.camera,v=t.clone(c.position,w),y=l(c.heading,f),p=c.frustum.right-c.frustum.left,b=a(c,u,p,u.z,h);return k}function v(n,t){return{startObject:{},stopObject:{},duration:0,complete:n,cancel:t}}function k(n,t){function i(){typeof t=="function"&&t();n.enableInputs=!0}return i}var y={},g=new t,p=new t,w=new t,ut=new i,ft=new i,b=new i,st=new t;return y.createTween=function(i,s){var h,p,l,it,a,w,kt,dt,lt,gt;if(s=r(s,r.EMPTY_OBJECT),h=s.destination,!u(i))throw new f("scene is required.");if(!u(h))throw new f("destination is required.");if(p=i.mode,p===c.MORPHING)return v();var ni=r(s.convert,!0),at=i.mapProjection,vt=at.ellipsoid,yt=s.maximumHeight,pt=s.flyOverLongitude,wt=s.flyOverLongitudeWeight,bt=s.pitchAdjustHeight,nt=s.easingFunction;ni&&p!==c.SCENE3D&&(vt.cartesianToCartographic(h,b),h=at.project(b,st));l=i.camera;it=s.endTransform;u(it)&&l._setTransform(it);a=s.duration;u(a)||(a=Math.ceil(t.distance(l.position,h)/1e6)+2,a=Math.min(a,3));var rt=r(s.heading,0),ut=r(s.pitch,-o.PI_OVER_TWO),ft=r(s.roll,0),ht=i.screenSpaceCameraController;ht.enableInputs=!1;var d=k(ht,s.complete),ct=k(ht,s.cancel),g=l.frustum,y=i.mode===c.SCENE2D;return(y=y&&n.equalsEpsilon(l.position,h,o.EPSILON6),y=y&&o.equalsEpsilon(Math.max(g.right-g.left,g.top-g.bottom),h.z,o.EPSILON6),y=y||i.mode!==c.SCENE2D&&t.equalsEpsilon(h,l.position,o.EPSILON10),y=y&&o.equalsEpsilon(o.negativePiToPi(rt),o.negativePiToPi(l.heading),o.EPSILON10)&&o.equalsEpsilon(o.negativePiToPi(ut),o.negativePiToPi(l.pitch),o.EPSILON10)&&o.equalsEpsilon(o.negativePiToPi(ft),o.negativePiToPi(l.roll),o.EPSILON10),y)?v(d,ct):(w=new Array(4),w[c.SCENE2D]=ot,w[c.SCENE3D]=et,w[c.COLUMBUS_VIEW]=tt,a<=0)?(kt=function(){var n=w[p](i,1,h,rt,ut,ft,yt,pt,wt,bt);n({time:1});typeof d=="function"&&d()},v(kt,ct)):(dt=w[p](i,a,h,rt,ut,ft,yt,pt,wt,bt),u(nt)||(lt=l.positionCartographic.height,gt=p===c.SCENE3D?vt.cartesianToCartographic(h).height:h.z,nt=lt>gt&&lt>11500?e.CUBIC_OUT:e.QUINTIC_IN_OUT),{duration:a,easingFunction:nt,startObject:{time:0},stopObject:{time:a},update:dt,complete:d,cancel:ct})},y});t("Scene/MapMode2D",["../Core/freezeObject"],function(n){"use strict";return n({ROTATE:0,INFINITE_SCROLL:1})});t("Scene/Camera",["../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/EasingFunction","../Core/Ellipsoid","../Core/EllipsoidGeodesic","../Core/Event","../Core/HeadingPitchRange","../Core/HeadingPitchRoll","../Core/Intersect","../Core/IntersectionTests","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Core/PerspectiveFrustum","../Core/Quaternion","../Core/Ray","../Core/Rectangle","../Core/Transforms","./CameraFlightPath","./MapMode2D","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st){"use strict";function ht(n){var r,t;if(!e(n))throw new s("scene is required.");this._scene=n;this._transform=d.clone(d.IDENTITY);this._invTransform=d.clone(d.IDENTITY);this._actualTransform=d.clone(d.IDENTITY);this._actualInvTransform=d.clone(d.IDENTITY);this._transformChanged=!1;this.position=new i;this._position=new i;this._positionWC=new i;this._positionCartographic=new u;this.direction=new i;this._direction=new i;this._directionWC=new i;this.up=new i;this._up=new i;this._upWC=new i;this.right=new i;this._right=new i;this._rightWC=new i;this.frustum=new tt;this.frustum.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight;this.frustum.fov=b.toRadians(60);this.defaultMoveAmount=1e5;this.defaultLookAmount=Math.PI/60;this.defaultRotateAmount=Math.PI/3600;this.defaultZoomAmount=1e5;this.constrainedAxis=undefined;this.maximumZoomFactor=1.5;this._moveStart=new a;this._moveEnd=new a;this._changed=new a;this._changedPosition=undefined;this._changedDirection=undefined;this._changedFrustum=undefined;this.percentageChanged=.5;this._viewMatrix=new d;this._invViewMatrix=new d;ai(this);this._mode=st.SCENE3D;this._modeChanged=!0;r=n.mapProjection;this._projection=r;this._maxCoord=r.project(new u(Math.PI,b.PI_OVER_TWO));this._max2Dfrustum=undefined;this._suspendTerrainAdjustment=!1;ar(this,ht.DEFAULT_VIEW_RECTANGLE,this.position,!0);t=i.magnitude(this.position);t+=t*ht.DEFAULT_VIEW_FACTOR;i.normalize(this.position,this.position);i.multiplyByScalar(this.position,t,this.position)}function ai(n){d.computeView(n._position,n._direction,n._up,n._right,n._viewMatrix);d.multiply(n._viewMatrix,n._actualInvTransform,n._viewMatrix);d.inverseTransformation(n._viewMatrix,n._invViewMatrix)}function fu(n){ft.basisTo2D(n._projection,n._transform,n._actualTransform)}function vu(n){var h=n._projection,c=h.ellipsoid,l=d.getColumn(n._transform,3,su),o=c.cartesianToCartographic(l,eu),f=h.project(o,ou),e=hu,s,a,t,u,v;e.x=f.z;e.y=f.x;e.z=f.y;e.w=1;s=r.clone(r.UNIT_X,au);a=r.add(d.getColumn(n._transform,0,gt),l,gt);c.cartesianToCartographic(a,o);h.project(o,f);t=cu;t.x=f.z;t.y=f.x;t.z=f.y;t.w=0;i.subtract(t,e,t);t.x=0;u=lu;i.magnitudeSquared(t)>b.EPSILON10?i.cross(s,t,u):(v=r.add(d.getColumn(n._transform,1,gt),l,gt),c.cartesianToCartographic(v,o),h.project(o,f),u.x=f.z,u.y=f.x,u.z=f.y,u.w=0,i.subtract(u,e,u),u.x=0,i.magnitudeSquared(u)<b.EPSILON10&&(r.clone(r.UNIT_Y,t),r.clone(r.UNIT_Z,u)));i.cross(u,s,t);i.normalize(t,t);i.cross(s,t,u);i.normalize(u,u);d.setColumn(n._actualTransform,0,t,n._actualTransform);d.setColumn(n._actualTransform,1,u,n._actualTransform);d.setColumn(n._actualTransform,2,s,n._actualTransform);d.setColumn(n._actualTransform,3,e,n._actualTransform)}function ct(n){var l=n._mode,p=!1,y=0,a,v,r,o,t,s,u,h,f,c,e,w;if(l===st.SCENE2D&&(y=n.frustum.right-n.frustum.left,p=y!==n._positionCartographic.height),a=n._position,v=!i.equals(a,n.position)||p,v&&(a=i.clone(n.position,n._position)),r=n._direction,o=!i.equals(r,n.direction),o&&(i.normalize(n.direction,n.direction),r=i.clone(n.direction,n._direction)),t=n._up,s=!i.equals(t,n.up),s&&(i.normalize(n.up,n.up),t=i.clone(n.up,n._up)),u=n._right,h=!i.equals(u,n.right),h&&(i.normalize(n.right,n.right),u=i.clone(n.right,n._right)),f=n._transformChanged||n._modeChanged,n._transformChanged=!1,f&&(d.inverseTransformation(n._transform,n._invTransform),n._mode===st.COLUMBUS_VIEW||n._mode===st.SCENE2D?d.equals(d.IDENTITY,n._transform)?d.clone(ht.TRANSFORM_2D,n._actualTransform):n._mode===st.COLUMBUS_VIEW?fu(n):vu(n):d.clone(n._transform,n._actualTransform),d.inverseTransformation(n._actualTransform,n._actualInvTransform),n._modeChanged=!1),c=n._actualTransform,(v||f)&&(n._positionWC=d.multiplyByPoint(c,a,n._positionWC),l===st.SCENE3D||l===st.MORPHING?n._positionCartographic=n._projection.ellipsoid.cartesianToCartographic(n._positionWC,n._positionCartographic):(e=ni,e.x=n._positionWC.y,e.y=n._positionWC.z,e.z=n._positionWC.x,l===st.SCENE2D&&(e.z=y),n._projection.unproject(e,n._positionCartographic))),(o||s||h)&&(w=i.dot(r,i.cross(t,u,ni)),Math.abs(1-w)>b.EPSILON2)){var k=1/i.magnitudeSquared(t),g=i.dot(t,r)*k,nt=i.multiplyByScalar(r,g,ni);t=i.normalize(i.subtract(t,nt,n._up),n._up);i.clone(t,n.up);u=i.cross(r,t,n._right);i.clone(u,n.right)}(o||f)&&(n._directionWC=d.multiplyByPointAsVector(c,r,n._directionWC),i.normalize(n._directionWC,n._directionWC));(s||f)&&(n._upWC=d.multiplyByPointAsVector(c,t,n._upWC),i.normalize(n._upWC,n._upWC));(h||f)&&(n._rightWC=d.multiplyByPointAsVector(c,u,n._rightWC),i.normalize(n._rightWC,n._rightWC));(v||o||s||h||f)&&ai(n)}function pi(n,t){var i;return i=b.equalsEpsilon(Math.abs(n.z),1,b.EPSILON3)?Math.atan2(t.y,t.x)-b.PI_OVER_TWO:Math.atan2(n.y,n.x)-b.PI_OVER_TWO,b.TWO_PI-b.zeroToTwoPi(i)}function wi(n){return b.PI_OVER_TWO-b.acosClamped(n.z)}function bi(n,t,i){var r=0;return b.equalsEpsilon(Math.abs(n.z),1,b.EPSILON3)||(r=Math.atan2(-i.z,t.z),r=b.zeroToTwoPi(r+b.TWO_PI)),r}function tf(n,t,r){var e=d.clone(n.transform,fi),o=ft.eastNorthUpToFixedFrame(t,n._projection.ellipsoid,nf),f,u;n._setTransform(o);i.clone(i.ZERO,n.position);r.heading=r.heading-b.PI_OVER_TWO;f=it.fromHeadingPitchRoll(r,ei);u=k.fromQuaternion(f,oi);k.getColumn(u,0,n.direction);k.getColumn(u,2,n.up);i.cross(n.direction,n.up,n.right);n._setTransform(e);n._adjustOrthographicFrustum(!0)}function rf(n,t,r,u){var h=d.clone(n.transform,fi),f,o,s,e;n._setTransform(d.IDENTITY);i.equals(t,n.positionWC)||(u&&(f=n._projection,o=f.ellipsoid.cartesianToCartographic(t,ki),t=f.project(o,ti)),i.clone(t,n.position));r.heading=r.heading-b.PI_OVER_TWO;s=it.fromHeadingPitchRoll(r,ei);e=k.fromQuaternion(s,oi);k.getColumn(e,0,n.direction);k.getColumn(e,2,n.up);i.cross(n.direction,n.up,n.right);n._setTransform(h);n._adjustOrthographicFrustum(!0)}function uf(n,r,u,f){var y=d.clone(n.transform,fi),o,h,l,a,v;if(n._setTransform(d.IDENTITY),!i.equals(r,n.positionWC)){f&&(o=n._projection,h=o.ellipsoid.cartesianToCartographic(r,ki),r=o.project(h,ti));t.clone(r,n.position);var s=-r.z*.5,c=-s,e=n.frustum;c>s&&(l=e.top/e.right,e.right=c,e.left=s,e.top=e.right*l,e.bottom=-e.top)}n._scene.mapMode2D===ot.ROTATE&&(u.heading=u.heading-b.PI_OVER_TWO,u.pitch=-b.PI_OVER_TWO,u.roll=0,a=it.fromHeadingPitchRoll(u,ei),v=k.fromQuaternion(a,oi),k.getColumn(v,2,n.up),i.cross(n.direction,n.up,n.right));n._setTransform(y)}function di(n,t,r,u){var f=i.clone(r.direction,ff),e=i.clone(r.up,ef),s;if(n._scene.mode===st.SCENE3D){var h=n._projection.ellipsoid,c=ft.eastNorthUpToFixedFrame(t,h,pt),o=d.inverseTransformation(c,wt);d.multiplyByPointAsVector(o,f,f);d.multiplyByPointAsVector(o,e,e)}return s=i.cross(f,e,of),u.heading=pi(f,e),u.pitch=wi(f),u.roll=bi(f,e,s),u}function nr(n,t){var e=n._scene.mapMode2D===ot.ROTATE,i=n._maxCoord.x,r=n._maxCoord.y,f,u;e?(u=i,f=-u):(u=t.x-i*2,f=t.x+i*2);t.x>i&&(t.x=u);t.x<-i&&(t.x=f);t.y>r&&(t.y=r);t.y<-r&&(t.y=-r)}function er(n,t){var l=n.position,r=i.normalize(l,sf),f,o,c;if(e(n.constrainedAxis))if(f=i.equalsEpsilon(r,n.constrainedAxis,b.EPSILON2),o=i.equalsEpsilon(r,i.negate(n.constrainedAxis,fr),b.EPSILON2),f||o)(f&&t<0||o&&t>0)&&n.rotate(n.right,t);else{var s=i.normalize(n.constrainedAxis,hf),h=i.dot(r,s),u=b.acosClamped(h);t>0&&t>u&&(t=u-b.EPSILON4);h=i.dot(r,i.negate(s,fr));u=b.acosClamped(h);t<0&&-t>u&&(t=-u+b.EPSILON4);c=i.cross(s,r,cf);n.rotate(c,t)}else n.rotate(n.right,t)}function or(n,t){e(n.constrainedAxis)?n.rotate(n.constrainedAxis,t):n.rotate(n.up,t)}function ri(n,t){var i=n.frustum,f;if(!(i instanceof nt)||!e(i.left)||!e(i.right)||!e(i.bottom)||!e(i.top))throw new s("The camera frustum is expected to be orthographic for 2D camera control.");if(t=t*.5,Math.abs(i.top)+Math.abs(i.bottom)>Math.abs(i.left)+Math.abs(i.right)){var o=i.top-t,r=i.bottom+t,h=n._maxCoord.y;n._scene.mapMode2D===ot.ROTATE&&(h*=n.maximumZoomFactor);r>h&&(r=h,o=-h);o<=r&&(o=1,r=-1);f=i.right/i.top;i.top=o;i.bottom=r;i.right=i.top*f;i.left=-i.right}else{var u=i.right-t,c=i.left+t,l=n._maxCoord.x;n._scene.mapMode2D===ot.ROTATE&&(l*=n.maximumZoomFactor);u>l&&(u=l,c=-l);u<=c&&(u=1,c=-1);f=i.top/i.right;i.right=u;i.left=c;i.top=i.right*f;i.bottom=-i.top}}function sr(n,t){n.move(n.direction,t)}function cr(n,t,r){t=b.clamp(t,-b.PI_OVER_TWO,b.PI_OVER_TWO);n=b.zeroToTwoPi(n)-b.PI_OVER_TWO;var e=it.fromAxisAngle(i.UNIT_Y,-t,af),f=it.fromAxisAngle(i.UNIT_Z,-n,vf),o=it.multiply(f,e,f),s=k.fromQuaternion(o,yf),u=i.clone(i.UNIT_X,lf);return k.multiplyByVector(s,u,u),i.negate(u,u),i.multiplyByScalar(u,r,u),u}function lt(n,t,r,u){var f=Math.abs(i.dot(t,r));return f/u-i.dot(n,r)}function ar(n,t,r,u){var s=n._projection.ellipsoid,wt=u?n:ie,vt=t.north,yt=t.south,rt=t.east,ft=t.west,et,kt,ot,st,ut,ht,c,o,w,k,ct,at,d,nt,f,h,y,tt,a,p,it,v;if(ft>rt&&(rt+=b.TWO_PI),et=(ft+rt)*.5,yt<-b.PI_OVER_TWO+b.RADIANS_PER_DEGREE&&vt>b.PI_OVER_TWO-b.RADIANS_PER_DEGREE?kt=0:(ot=bt,ot.longitude=et,ot.latitude=vt,ot.height=0,st=pf,st.longitude=et,st.latitude=yt,st.height=0,ut=lr,e(ut)&&ut.ellipsoid===s||(lr=ut=new l(undefined,undefined,s)),ut.setEndPoints(ot,st),kt=ut.interpolateUsingFraction(.5,bt).latitude),ht=bt,ht.longitude=et,ht.latitude=kt,ht.height=0,c=s.cartographicToCartesian(ht,te),o=bt,o.longitude=rt,o.latitude=vt,w=s.cartographicToCartesian(o,wf),o.longitude=ft,k=s.cartographicToCartesian(o,kf),o.longitude=et,ct=s.cartographicToCartesian(o,gf),o.latitude=yt,at=s.cartographicToCartesian(o,ne),o.longitude=rt,d=s.cartographicToCartesian(o,df),o.longitude=ft,nt=s.cartographicToCartesian(o,bf),i.subtract(k,c,k),i.subtract(d,c,d),i.subtract(w,c,w),i.subtract(nt,c,nt),i.subtract(ct,c,ct),i.subtract(at,c,at),f=s.geodeticSurfaceNormal(c,wt.direction),i.negate(f,f),h=i.cross(f,i.UNIT_Z,wt.right),i.normalize(h,h),y=i.cross(h,f,wt.up),n.frustum instanceof g){var gt=Math.max(i.distance(w,k),i.distance(d,nt)),ni=Math.max(i.distance(w,d),i.distance(k,nt)),pt,dt,ti=n.frustum._offCenterFrustum.right/n.frustum._offCenterFrustum.top,ii=ni*ti;gt>ii?(pt=gt,dt=pt/ti):(dt=ni,pt=ii);tt=Math.max(pt,dt)}else a=Math.tan(n.frustum.fovy*.5),p=n.frustum.aspectRatio*a,tt=Math.max(lt(f,y,k,a),lt(f,y,d,a),lt(f,y,w,a),lt(f,y,nt,a),lt(f,y,ct,a),lt(f,y,at,a),lt(f,h,k,p),lt(f,h,d,p),lt(f,h,w,p),lt(f,h,nt,p),lt(f,h,ct,p),lt(f,h,at,p)),yt<0&&vt>0&&(it=bt,it.longitude=ft,it.latitude=0,it.height=0,v=s.cartographicToCartesian(it,hi),i.subtract(v,c,v),tt=Math.max(tt,lt(f,y,v,a),lt(f,h,v,p)),it.longitude=rt,v=s.cartographicToCartesian(it,hi),i.subtract(v,c,v),tt=Math.max(tt,lt(f,y,v,a),lt(f,h,v,p)));return i.add(c,i.multiplyByScalar(f,-tt,hi),r)}function ee(n,t,i){var s=n._projection,u,r,o,l,a,v;t.west>t.east&&(t=ut.MAX_VALUE);var h=n._actualTransform,c=n._actualInvTransform,f=re;return f.longitude=t.east,f.latitude=t.north,u=s.project(f,ue),d.multiplyByPoint(h,u,u),d.multiplyByPoint(c,u,u),f.longitude=t.west,f.latitude=t.south,r=s.project(f,fe),d.multiplyByPoint(h,r,r),d.multiplyByPoint(c,r,r),i.x=(u.x-r.x)*.5+r.x,i.y=(u.y-r.y)*.5+r.y,e(n.frustum.fovy)?(o=Math.tan(n.frustum.fovy*.5),l=n.frustum.aspectRatio*o,i.z=Math.max((u.x-r.x)/l,(u.y-r.y)/o)*.5):(a=u.x-r.x,v=u.y-r.y,i.z=Math.max(a,v)),i}function ce(n,t,i){var e=n._projection,r,f;t.west>t.east&&(t=ut.MAX_VALUE);r=oe;r.longitude=t.east;r.latitude=t.north;f=e.project(r,se);r.longitude=t.west;r.latitude=t.south;var u=e.project(r,he),c=Math.abs(f.x-u.x)*.5,o=Math.abs(f.y-u.y)*.5,s,h,l=n.frustum.right/n.frustum.top,a=o*l;return c>a?(s=c,h=s/l):(h=o,s=a),o=Math.max(2*s,2*h),i.x=(f.x-u.x)*.5+u.x,i.y=(f.y-u.y)*.5+u.y,r=e.unproject(i,r),r.height=o,e.project(r,i)}function le(n,t,i,r){var e,u,o;return(i=f(i,c.WGS84),e=n.getPickRay(t,vr),u=w.rayEllipsoid(e,i),!u)?undefined:(o=u.start>0?u.start:u.stop,rt.getPoint(e,o,r))}function ae(n,t,r,u){var o=n.getPickRay(t,yr),f=o.origin,e;return(f=i.fromElements(f.y,f.z,0,f),e=r.unproject(f),e.latitude<-b.PI_OVER_TWO||e.latitude>b.PI_OVER_TWO)?undefined:r.ellipsoid.cartographicToCartesian(e,u)}function ve(n,t,r,u){var e=n.getPickRay(t,pr),o=-e.origin.x/e.direction.x,f;return(rt.getPoint(e,o,u),f=r.unproject(new i(u.y,u.z,0)),f.latitude<-b.PI_OVER_TWO||f.latitude>b.PI_OVER_TWO||f.longitude<-Math.PI||f.longitude>Math.PI)?undefined:r.ellipsoid.cartographicToCartesian(f,u)}function be(n,t,r){var s=n._scene.canvas,l=s.clientWidth,h=s.clientHeight,c=Math.tan(n.frustum.fovy*.5),a=n.frustum.aspectRatio*c,e=n.frustum.near,v=2/l*t.x-1,y=2/h*(h-t.y)-1,o=n.positionWC,f;i.clone(o,r.origin);f=i.multiplyByScalar(n.directionWC,e,ye);i.add(o,f,f);var p=i.multiplyByScalar(n.rightWC,v*e*a,pe),w=i.multiplyByScalar(n.upWC,y*e*c,we),u=i.add(f,p,r.direction);return i.add(u,w,u),i.subtract(u,o,u),i.normalize(u,u),r}function ke(n,t,r){var h=n._scene.canvas,l=h.clientWidth,c=h.clientHeight,u=n.frustum,o,s,f;return e(u._offCenterFrustum)&&(u=u._offCenterFrustum),o=2/l*t.x-1,o*=(u.right-u.left)*.5,s=2/c*(c-t.y)-1,s*=(u.top-u.bottom)*.5,f=r.origin,i.clone(n.position,f),i.multiplyByScalar(n.right,o,kt),i.add(kt,f,f),i.multiplyByScalar(n.up,s,kt),i.add(kt,f,f),i.clone(n.directionWC,r.direction),(n._mode===st.COLUMBUS_VIEW||n._mode===st.SCENE2D)&&i.fromElements(r.origin.z,r.origin.x,r.origin.y,r.origin),r}function de(n,t,r,u,f,e){function s(r){var u=i.lerp(t,o,r.time,new i);n.worldToCameraCoordinatesPoint(u,n.position)}var o=i.clone(t);return r.y>u?o.y-=r.y-u:r.y<-u&&(o.y+=-u-r.y),r.z>f?o.z-=r.z-f:r.z<-f&&(o.z+=-f-r.z),{easingFunction:h.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:e,update:s}}function io(n,t){var r=n.position,o=n.direction,s=n.worldToCameraCoordinatesVector(i.UNIT_X,ge),p=-i.dot(s,r)/i.dot(s,o),u=i.add(r,i.multiplyByScalar(o,p,dr),dr),v,y;n.cameraToWorldCoordinatesPoint(u,u);r=n.cameraToWorldCoordinatesPoint(n.position,no);var h=Math.tan(n.frustum.fovy*.5),w=n.frustum.aspectRatio*h,c=i.magnitude(i.subtract(r,u,to)),b=w*c,k=h*c,l=n._maxCoord.x,a=n._maxCoord.y,f=Math.max(b-l,l),e=Math.max(k-a,a);return(r.z<-f||r.z>f||r.y<-e||r.y>e)&&(v=u.y<-f||u.y>f,y=u.z<-e||u.z>e,v||y)?de(n,r,u,f,e,t):undefined}function ro(n,t){var i=n.frustum,r=Math.tan(i.fovy*.5),u=i.aspectRatio*r;return Math.max(t/u,t/r)}function uo(n,t){var i=n.frustum,r,u,f,o;return e(i._offCenterFrustum)&&(i=i._offCenterFrustum),f=i.right/i.top,o=t*f,t>o?(r=t,u=r/f):(u=t,r=o),Math.max(r,u)*1.5}function tu(n,t,i){var r;e(i)||(i=v.clone(ht.DEFAULT_OFFSET));var f=n._scene.screenSpaceCameraController.minimumZoomDistance,o=n._scene.screenSpaceCameraController.maximumZoomDistance,u=i.range;return e(u)&&u!==0||(r=t.radius,i.range=r===0?nu:n.frustum instanceof g||n._mode===st.SCENE2D?uo(n,r):ro(n,r),i.range=b.clamp(i.range,f,o)),i}function vo(n,t){var e=t.radii,k=n.positionWC,v=i.multiplyComponents(t.oneOverRadii,k,iu),p=i.magnitude(v),o=i.normalize(v,ru),s,y,r,u,f;i.equalsEpsilon(o,i.UNIT_Z,b.EPSILON10)?(s=new i(0,1,0),y=new i(0,0,1)):(s=i.normalize(i.cross(i.UNIT_Z,o,ci),ci),y=i.normalize(i.cross(o,s,uu),uu));var d=Math.sqrt(i.magnitudeSquared(v)-1),h=i.multiplyByScalar(o,1/p,iu),w=d/p,c=i.multiplyByScalar(s,w,ru),l=i.multiplyByScalar(y,w,ci),a=i.add(h,l,dt[0]);return i.subtract(a,c,a),i.multiplyComponents(e,a,a),r=i.subtract(h,l,dt[1]),i.subtract(r,c,r),i.multiplyComponents(e,r,r),u=i.subtract(h,l,dt[2]),i.add(u,c,u),i.multiplyComponents(e,u,u),f=i.add(h,l,dt[3]),i.add(f,c,f),i.multiplyComponents(e,f,f),dt}function ui(n,t,i,r,u,f){li.x=n;li.y=t;var o=r.pickEllipsoid(li,u,yo);return e(o)?(vt[i]=u.cartesianToCartographic(o,vt[i]),1):(vt[i]=u.cartesianToCartographic(f[i],vt[i]),0)}var vi,yi,ni,pt,wt,ii,yt,gi,si,tr,ir,rr,ur,hr,vr,yr,pr,kt,wr,br,kr,gr,at,nu;ht.TRANSFORM_2D=new d(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);ht.TRANSFORM_2D_INVERSE=d.inverseTransformation(ht.TRANSFORM_2D,new d);ht.DEFAULT_VIEW_RECTANGLE=ut.fromDegrees(-95,-20,-70,90);ht.DEFAULT_VIEW_FACTOR=.5;ht.DEFAULT_OFFSET=new v(0,-b.PI_OVER_FOUR,0);ht.prototype._updateCameraChanged=function(){var n=this,f,t,l,a,ut,v;if(n._changed.numberOfListeners!==0){if(f=n.percentageChanged,n._mode===st.SCENE2D){if(!e(n._changedFrustum)){n._changedPosition=i.clone(n.position,n._changedPosition);n._changedFrustum=n.frustum.clone();return}var o=n.position,s=n._changedPosition,r=n.frustum,u=n._changedFrustum,y=o.x+r.left,p=o.x+r.right,w=s.x+u.left,k=s.x+u.right,d=o.y+r.bottom,c=o.y+r.top,g=s.y+u.bottom,nt=s.y+u.top,tt=Math.max(y,w),it=Math.min(p,k),rt=Math.max(d,g),ft=Math.min(c,nt),h;tt>=it||rt>=c?h=1:(t=u,y<w&&p>k&&d<g&&c>nt&&(t=r),h=1-(it-tt)*(ft-rt)/((t.right-t.left)*(t.top-t.bottom)));h>f&&(n._changed.raiseEvent(h),n._changedPosition=i.clone(n.position,n._changedPosition),n._changedFrustum=n.frustum.clone(n._changedFrustum));return}if(!e(n._changedDirection)){n._changedPosition=i.clone(n.positionWC,n._changedPosition);n._changedDirection=i.clone(n.directionWC,n._changedDirection);return}l=b.acosClamped(i.dot(n.directionWC,n._changedDirection));a=e(n.frustum.fovy)?l/(n.frustum.fovy*.5):l;ut=i.distance(n.positionWC,n._changedPosition);v=ut/n.positionCartographic.height;(a>f||v>f)&&(n._changed.raiseEvent(Math.max(a,v)),n._changedPosition=i.clone(n.positionWC,n._changedPosition),n._changedDirection=i.clone(n.directionWC,n._changedDirection))}};vi=new d;yi=new u;ht.prototype._adjustHeightForTerrain=function(){var f=this._scene,o=f.screenSpaceCameraController,y=o.enableCollisionDetection,p=o.minimumCollisionTerrainHeight,a=o.minimumZoomDistance,t,u,s,h,c,v,n,l,r;!this._suspendTerrainAdjustment&&y&&(t=this._mode,u=f.globe,e(u)&&t!==st.SCENE2D&&t!==st.MORPHING)&&(s=u.ellipsoid,h=f.mapProjection,d.equals(this.transform,d.IDENTITY)||(c=d.clone(this.transform,vi),v=i.magnitude(this.position),this._setTransform(d.IDENTITY)),n=yi,t===st.SCENE3D?s.cartesianToCartographic(this.position,n):h.unproject(this.position,n),l=!1,n.height<p&&(r=u.getHeight(n),e(r)&&(r+=a,n.height<r&&(n.height=r,t===st.SCENE3D?s.cartographicToCartesian(n,this.position):h.project(n,this.position),l=!0))),e(c)&&(this._setTransform(c),l&&(i.normalize(this.position,this.position),i.negate(this.position,this.direction),i.multiplyByScalar(this.position,Math.max(v,a),this.position),i.normalize(this.direction,this.direction),i.cross(this.direction,this.up,this.right),i.cross(this.right,this.direction,this.up))))};var eu=new u,ou=new i,gt=new i,su=new r,hu=new r,cu=new r,lu=new r,au=new r;ni=new i;pt=new d;wt=new d;o(ht.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return ct(this),this._invTransform}},viewMatrix:{get:function(){return ct(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return ct(this),this._invViewMatrix}},positionCartographic:{get:function(){return ct(this),this._positionCartographic}},positionWC:{get:function(){return ct(this),this._positionWC}},directionWC:{get:function(){return ct(this),this._directionWC}},upWC:{get:function(){return ct(this),this._upWC}},rightWC:{get:function(){return ct(this),this._rightWC}},heading:{get:function(){var n;if(this._mode!==st.MORPHING){var t=this._projection.ellipsoid,i=d.clone(this._transform,pt),r=ft.eastNorthUpToFixedFrame(this.positionWC,t,wt);return this._setTransform(r),n=pi(this.direction,this.up),this._setTransform(i),n}return undefined}},pitch:{get:function(){var n;if(this._mode!==st.MORPHING){var t=this._projection.ellipsoid,i=d.clone(this._transform,pt),r=ft.eastNorthUpToFixedFrame(this.positionWC,t,wt);return this._setTransform(r),n=wi(this.direction),this._setTransform(i),n}return undefined}},roll:{get:function(){var n;if(this._mode!==st.MORPHING){var t=this._projection.ellipsoid,i=d.clone(this._transform,pt),r=ft.eastNorthUpToFixedFrame(this.positionWC,t,wt);return this._setTransform(r),n=bi(this.direction,this.up,this.right),this._setTransform(i),n}return undefined}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}});ht.prototype.update=function(n){var r,t,f,o,i,u;if(!e(n))throw new s("mode is required.");if(n===st.SCENE2D&&!(this.frustum instanceof nt))throw new s("An OrthographicOffCenterFrustum is required in 2D.");if((n===st.SCENE3D||n===st.COLUMBUS_VIEW)&&!(this.frustum instanceof tt)&&!(this.frustum instanceof g))throw new s("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");if(r=!1,n!==this._mode&&(this._mode=n,this._modeChanged=n!==st.MORPHING,r=this._mode===st.SCENE2D),r){if(t=this._max2Dfrustum=this.frustum.clone(),!(t instanceof nt))throw new s("The camera frustum is expected to be orthographic for 2D camera control.");f=2;o=t.top/t.right;t.right=this._maxCoord.x*f;t.left=-t.right;t.top=o*t.right;t.bottom=-t.top}this._mode===st.SCENE2D&&nr(this,this.position);i=this._scene.globe;u=!e(i)||i._surface.tileProvider.ready&&i._surface._tileLoadQueueHigh.length===0&&i._surface._tileLoadQueueMedium.length===0&&i._surface._tileLoadQueueLow.length===0&&i._surface._debug.tilesWaitingForChildren===0;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!u);u&&this._adjustHeightForTerrain()};var yu=new i,pu=new i,wu=new i;ht.prototype._setTransform=function(n){var r=i.clone(this.positionWC,yu),u=i.clone(this.upWC,pu),f=i.clone(this.directionWC,wu),t;d.clone(n,this._transform);this._transformChanged=!0;ct(this);t=this._actualInvTransform;d.multiplyByPoint(t,r,this.position);d.multiplyByPointAsVector(t,f,this.direction);d.multiplyByPointAsVector(t,u,this.up);i.cross(this.direction,this.up,this.right);ct(this)};var bu=new t,ku=new rt,du=new i,gu=new i;ht.prototype._adjustOrthographicFrustum=function(n){var t,o,r,u,f,s,h,c,l;if(this.frustum instanceof g&&(n||!(this._positionCartographic.height<15e4))){if(!d.equals(d.IDENTITY,this.transform)){this.frustum.width=i.magnitude(this.position);return}t=this._scene;o=t.globe;e(o)&&(f=bu,f.x=t.drawingBufferWidth/2,f.y=t.drawingBufferHeight/2,s=this.getPickRay(f,ku),r=o.pickWorldCoordinates(s,t,du),t.pickPositionSupported&&(u=t.pickPositionWorldCoordinates(f,gu)),e(r)&&e(u)?(h=e(u)?i.distance(u,this.positionWC):Number.POSITIVE_INFINITY,c=e(r)?i.distance(r,this.positionWC):Number.POSITIVE_INFINITY,this.frustum.width=Math.min(h,c)):e(u)?this.frustum.width=i.distance(u,this.positionWC):e(r)&&(this.frustum.width=i.distance(r,this.positionWC)));e(o)&&(e(r)||e(u))||(l=Math.max(this.positionCartographic.height,0),this.frustum.width=l)}};var ti=new i,fi=new d,nf=new d,ei=new it,oi=new k,ki=new u;var ff=new i,ef=new i,of=new i;ii={destination:undefined,orientation:{direction:undefined,up:undefined,heading:undefined,pitch:undefined,roll:undefined},convert:undefined,endTransform:undefined};yt=new y;ht.prototype.setView=function(n){var r,u,o,t;(n=f(n,f.EMPTY_OBJECT),r=f(n.orientation,f.EMPTY_OBJECT),u=this._mode,u!==st.MORPHING)&&(e(n.endTransform)&&this._setTransform(n.endTransform),o=f(n.convert,!0),t=f(n.destination,i.clone(this.positionWC,ti)),e(t)&&e(t.west)&&(t=this.getRectangleCameraCoordinates(t,ti),o=!1),e(r.direction)&&(r=di(this,t,r,ii.orientation)),yt.heading=f(r.heading,0),yt.pitch=f(r.pitch,-b.PI_OVER_TWO),yt.roll=f(r.roll,0),this._suspendTerrainAdjustment=!0,u===st.SCENE3D?tf(this,t,yt):u===st.SCENE2D?uf(this,t,yt,o):rf(this,t,yt,o))};gi=new i;ht.prototype.flyHome=function(n){var u=this._mode,t,f,e,r;u===st.MORPHING&&this._scene.completeMorph();u===st.SCENE2D?this.flyTo({destination:ht.DEFAULT_VIEW_RECTANGLE,duration:n,endTransform:d.IDENTITY}):u===st.SCENE3D?(t=this.getRectangleCameraCoordinates(ht.DEFAULT_VIEW_RECTANGLE),f=i.magnitude(t),f+=f*ht.DEFAULT_VIEW_FACTOR,i.normalize(t,t),i.multiplyByScalar(t,f,t),this.flyTo({destination:t,duration:n,endTransform:d.IDENTITY})):u===st.COLUMBUS_VIEW&&(e=this._projection.ellipsoid.maximumRadius,r=new i(0,-1,1),r=i.multiplyByScalar(i.normalize(r,r),5*e,r),this.flyTo({destination:r,duration:n,orientation:{heading:0,pitch:-Math.acos(i.normalize(r,gi).z),roll:0},endTransform:d.IDENTITY,convert:!1}))};ht.prototype.worldToCameraCoordinates=function(n,t){if(!e(n))throw new s("cartesian is required.");return e(t)||(t=new r),ct(this),d.multiplyByVector(this._actualInvTransform,n,t)};ht.prototype.worldToCameraCoordinatesPoint=function(n,t){if(!e(n))throw new s("cartesian is required.");return e(t)||(t=new i),ct(this),d.multiplyByPoint(this._actualInvTransform,n,t)};ht.prototype.worldToCameraCoordinatesVector=function(n,t){if(!e(n))throw new s("cartesian is required.");return e(t)||(t=new i),ct(this),d.multiplyByPointAsVector(this._actualInvTransform,n,t)};ht.prototype.cameraToWorldCoordinates=function(n,t){if(!e(n))throw new s("cartesian is required.");return e(t)||(t=new r),ct(this),d.multiplyByVector(this._actualTransform,n,t)};ht.prototype.cameraToWorldCoordinatesPoint=function(n,t){if(!e(n))throw new s("cartesian is required.");return e(t)||(t=new i),ct(this),d.multiplyByPoint(this._actualTransform,n,t)};ht.prototype.cameraToWorldCoordinatesVector=function(n,t){if(!e(n))throw new s("cartesian is required.");return e(t)||(t=new i),ct(this),d.multiplyByPointAsVector(this._actualTransform,n,t)};si=new i;ht.prototype.move=function(n,t){if(!e(n))throw new s("direction is required.");var r=this.position;i.multiplyByScalar(n,t,si);i.add(r,si,r);this._mode===st.SCENE2D&&nr(this,r);this._adjustOrthographicFrustum(!0)};ht.prototype.moveForward=function(n){n=f(n,this.defaultMoveAmount);this._mode===st.SCENE2D?ri(this,n):this.move(this.direction,n)};ht.prototype.moveBackward=function(n){n=f(n,this.defaultMoveAmount);this._mode===st.SCENE2D?ri(this,-n):this.move(this.direction,-n)};ht.prototype.moveUp=function(n){n=f(n,this.defaultMoveAmount);this.move(this.up,n)};ht.prototype.moveDown=function(n){n=f(n,this.defaultMoveAmount);this.move(this.up,-n)};ht.prototype.moveRight=function(n){n=f(n,this.defaultMoveAmount);this.move(this.right,n)};ht.prototype.moveLeft=function(n){n=f(n,this.defaultMoveAmount);this.move(this.right,-n)};ht.prototype.lookLeft=function(n){n=f(n,this.defaultLookAmount);this._mode!==st.SCENE2D&&this.look(this.up,-n)};ht.prototype.lookRight=function(n){n=f(n,this.defaultLookAmount);this._mode!==st.SCENE2D&&this.look(this.up,n)};ht.prototype.lookUp=function(n){n=f(n,this.defaultLookAmount);this._mode!==st.SCENE2D&&this.look(this.right,-n)};ht.prototype.lookDown=function(n){n=f(n,this.defaultLookAmount);this._mode!==st.SCENE2D&&this.look(this.right,n)};tr=new it;ir=new k;ht.prototype.look=function(n,t){if(!e(n))throw new s("axis is required.");var h=f(t,this.defaultLookAmount),c=it.fromAxisAngle(n,-h,tr),i=k.fromQuaternion(c,ir),r=this.direction,u=this.up,o=this.right;k.multiplyByVector(i,r,r);k.multiplyByVector(i,u,u);k.multiplyByVector(i,o,o)};ht.prototype.twistLeft=function(n){n=f(n,this.defaultLookAmount);this.look(this.direction,n)};ht.prototype.twistRight=function(n){n=f(n,this.defaultLookAmount);this.look(this.direction,-n)};rr=new it;ur=new k;ht.prototype.rotate=function(n,t){if(!e(n))throw new s("axis is required.");var u=f(t,this.defaultRotateAmount),o=it.fromAxisAngle(n,-u,rr),r=k.fromQuaternion(o,ur);k.multiplyByVector(r,this.position,this.position);k.multiplyByVector(r,this.direction,this.direction);k.multiplyByVector(r,this.up,this.up);i.cross(this.direction,this.up,this.right);i.cross(this.right,this.direction,this.up);this._adjustOrthographicFrustum(!1)};ht.prototype.rotateDown=function(n){n=f(n,this.defaultRotateAmount);er(this,n)};ht.prototype.rotateUp=function(n){n=f(n,this.defaultRotateAmount);er(this,-n)};var sf=new i,hf=new i,cf=new i,fr=new i;ht.prototype.rotateRight=function(n){n=f(n,this.defaultRotateAmount);or(this,-n)};ht.prototype.rotateLeft=function(n){n=f(n,this.defaultRotateAmount);or(this,n)};ht.prototype.zoomIn=function(n){n=f(n,this.defaultZoomAmount);this._mode===st.SCENE2D?ri(this,n):sr(this,n)};ht.prototype.zoomOut=function(n){n=f(n,this.defaultZoomAmount);this._mode===st.SCENE2D?ri(this,-n):sr(this,-n)};ht.prototype.getMagnitude=function(){return this._mode===st.SCENE3D?i.magnitude(this.position):this._mode===st.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===st.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};hr=new d;ht.prototype.lookAt=function(n,t){if(!e(n))throw new s("target is required");if(!e(t))throw new s("offset is required");if(this._mode===st.MORPHING)throw new s("lookAt is not supported while morphing.");var i=ft.eastNorthUpToFixedFrame(n,c.WGS84,hr);this.lookAtTransform(i,t)};var lf=new i,af=new it,vf=new it,yf=new k;ht.prototype.lookAtTransform=function(n,r){var f,u,o;if(!e(n))throw new s("transform is required");if(this._mode===st.MORPHING)throw new s("lookAtTransform is not supported while morphing.");if(this._setTransform(n),e(r)){if(f=e(r.heading)?cr(r.heading,r.pitch,r.range):r,this._mode===st.SCENE2D){t.clone(t.ZERO,this.position);i.negate(f,this.up);this.up.z=0;i.magnitudeSquared(this.up)<b.EPSILON10&&i.clone(i.UNIT_Y,this.up);i.normalize(this.up,this.up);this._setTransform(d.IDENTITY);i.negate(i.UNIT_Z,this.direction);i.cross(this.direction,this.up,this.right);i.normalize(this.right,this.right);u=this.frustum;o=u.top/u.right;u.right=i.magnitude(f)*.5;u.left=-u.right;u.top=o*u.right;u.bottom=-u.top;this._setTransform(n);return}i.clone(f,this.position);i.negate(this.position,this.direction);i.normalize(this.direction,this.direction);i.cross(this.direction,i.UNIT_Z,this.right);i.magnitudeSquared(this.right)<b.EPSILON10&&i.clone(i.UNIT_X,this.right);i.normalize(this.right,this.right);i.cross(this.right,this.direction,this.up);i.normalize(this.up,this.up);this._adjustOrthographicFrustum(!0)}};var bt=new u,pf=new u,wf=new i,bf=new i,kf=new i,df=new i,gf=new i,ne=new i,te=new i,hi=new i,ie={direction:new i,right:new i,up:new i},lr;var re=new u,ue=new i,fe=new i;var oe=new u,se=new i,he=new i;ht.prototype.getRectangleCameraCoordinates=function(n,t){if(!e(n))throw new s("rectangle is required");var r=this._mode;return(e(t)||(t=new i),r===st.SCENE3D)?ar(this,n,t):r===st.COLUMBUS_VIEW?ee(this,n,t):r===st.SCENE2D?ce(this,n,t):undefined};vr=new rt;yr=new rt;pr=new rt;ht.prototype.pickEllipsoid=function(n,t,r){if(!e(n))throw new s("windowPosition is required.");var u=this._scene.canvas;if(u.clientWidth===0||u.clientHeight===0)return undefined;if(e(r)||(r=new i),t=f(t,c.WGS84),this._mode===st.SCENE3D)r=le(this,n,t,r);else if(this._mode===st.SCENE2D)r=ae(this,n,this._projection,r);else if(this._mode===st.COLUMBUS_VIEW)r=ve(this,n,this._projection,r);else return undefined;return r};var ye=new i,pe=new i,we=new i;kt=new i;ht.prototype.getPickRay=function(n,t){if(!e(n))throw new s("windowPosition is required.");e(t)||(t=new rt);var i=this.frustum;return e(i.aspectRatio)&&e(i.fov)&&e(i.near)?be(this,n,t):ke(this,n,t)};wr=new i;br=new i;ht.prototype.distanceToBoundingSphere=function(n){if(!e(n))throw new s("boundingSphere is required.");var t=i.subtract(this.positionWC,n.center,wr),r=i.multiplyByScalar(this.directionWC,i.dot(t,this.directionWC),br);return Math.max(0,i.magnitude(r)-n.radius)};kr=new t;ht.prototype.getPixelSize=function(n,t,i){if(!e(n))throw new s("boundingSphere is required.");if(!e(t))throw new s("drawingBufferWidth is required.");if(!e(i))throw new s("drawingBufferHeight is required.");var u=this.distanceToBoundingSphere(n),r=this.frustum.getPixelDimensions(t,i,u,kr);return Math.max(r.x,r.y)};var ge=new i,dr=new i,no=new i,to=new i;ht.prototype.createCorrectPositionTween=function(n){if(!e(n))throw new s("duration is required.");return this._mode===st.COLUMBUS_VIEW?io(this,n):undefined};gr=new i;at={destination:undefined,heading:undefined,pitch:undefined,roll:undefined,duration:undefined,complete:undefined,cancel:undefined,endTransform:undefined,maximumHeight:undefined,easingFunction:undefined};ht.prototype.cancelFlight=function(){e(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=undefined)};ht.prototype.flyTo=function(n){var r,l,t,i,u,o,h,c;if(n=f(n,f.EMPTY_OBJECT),r=n.destination,!e(r))throw new s("destination is required.");if(l=this._mode,l!==st.MORPHING){if(this.cancelFlight(),t=f(n.orientation,f.EMPTY_OBJECT),e(t.direction)&&(t=di(this,r,t,ii.orientation)),e(n.duration)&&n.duration<=0){i=ii;i.destination=n.destination;i.orientation.heading=t.heading;i.orientation.pitch=t.pitch;i.orientation.roll=t.roll;i.convert=n.convert;i.endTransform=n.endTransform;this.setView(i);typeof n.complete=="function"&&n.complete();return}u=e(r.west);u&&(r=this.getRectangleCameraCoordinates(r,gr));o=this;at.destination=r;at.heading=t.heading;at.pitch=t.pitch;at.roll=t.roll;at.duration=n.duration;at.complete=function(){h===o._currentFlight&&(o._currentFlight=undefined);e(n.complete)&&n.complete()};at.cancel=n.cancel;at.endTransform=n.endTransform;at.convert=u?!1:n.convert;at.maximumHeight=n.maximumHeight;at.pitchAdjustHeight=n.pitchAdjustHeight;at.flyOverLongitude=n.flyOverLongitude;at.flyOverLongitudeWeight=n.flyOverLongitudeWeight;at.easingFunction=n.easingFunction;c=this._scene;h=c.tweens.add(et.createTween(c,at));this._currentFlight=h}};nu=100;ht.prototype.viewBoundingSphere=function(n,t){if(!e(n))throw new s("boundingSphere is required.");if(this._mode===st.MORPHING)throw new s("viewBoundingSphere is not supported while morphing.");t=tu(this,n,t);this.lookAt(n.center,t)};var fo=new d,eo=new i,oo=new i,so=new i,ho=new i,co=new r,lo=new it,ao=new k;ht.prototype.flyToBoundingSphere=function(n,t){var a,o,h,l,u,r,v,y,p;if(!e(n))throw new s("boundingSphere is required.");t=f(t,f.EMPTY_OBJECT);a=this._mode===st.SCENE2D||this._mode===st.COLUMBUS_VIEW;this._setTransform(d.IDENTITY);o=tu(this,n,t.offset);h=a?i.multiplyByScalar(i.UNIT_Z,o.range,eo):cr(o.heading,o.pitch,o.range);l=ft.eastNorthUpToFixedFrame(n.center,c.WGS84,fo);d.multiplyByPoint(l,h,h);a||(u=i.subtract(n.center,h,oo),i.normalize(u,u),r=d.multiplyByPointAsVector(l,i.UNIT_Z,so),1-Math.abs(i.dot(u,r))<b.EPSILON6&&(v=it.fromAxisAngle(u,o.heading,lo),y=k.fromQuaternion(v,ao),i.fromCartesian4(d.getColumn(l,1,co),r),k.multiplyByVector(y,r,r)),p=i.cross(u,r,ho),i.cross(p,u,r),i.normalize(r,r));this.flyTo({destination:h,orientation:{direction:u,up:r},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var iu=new i,ru=new i,ci=new i,uu=new i,dt=[new i,new i,new i,new i];var li=new t,yo=new i,vt=[new u,new u,new u,new u];return ht.prototype.computeViewRectangle=function(t,r){var h,l,o,a,s;t=f(t,c.WGS84);var k=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),d=new n(i.ZERO,t.maximumRadius),g=k.computeVisibility(d);if(g===p.OUTSIDE)return undefined;var v=this._scene.canvas,y=v.clientWidth,w=v.clientHeight,u=0,e=vo(this,t);if(u+=ui(0,0,0,this,t,e),u+=ui(0,w,1,this,t,e),u+=ui(y,w,2,this,t,e),u+=ui(y,0,3,this,t,e),u<2)return ut.MAX_VALUE;for(r=ut.fromCartographicArray(vt,r),h=0,l=vt[3].longitude,o=0;o<4;++o)a=vt[o].longitude,s=Math.abs(a-l),h+=s>b.PI?b.TWO_PI-s:s,l=a;return b.equalsEpsilon(Math.abs(h),b.TWO_PI,b.EPSILON9)&&(r.west=-b.PI,r.east=b.PI,vt[0].latitude>=0?r.north=b.PI_OVER_TWO:r.south=-b.PI_OVER_TWO),r},ht.prototype.switchToPerspectiveFrustum=function(){if(this._mode!==st.SCENE2D&&!(this.frustum instanceof tt)){var n=this._scene;this.frustum=new tt;this.frustum.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight;this.frustum.fov=b.toRadians(60)}},ht.prototype.switchToOrthographicFrustum=function(){var n,t;this._mode===st.SCENE2D||this.frustum instanceof g||(n=this._scene,this.frustum=new g,this.frustum.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,this.frustum.width=i.magnitude(this.position),t=this.frustum.projectionMatrix,e(t)&&this._adjustOrthographicFrustum(!0))},ht.clone=function(n,t){return e(t)||(t=new ht(n._scene)),i.clone(n.position,t.position),i.clone(n.direction,t.direction),i.clone(n.up,t.up),i.clone(n.right,t.right),d.clone(n._transform,t.transform),t._transformChanged=!0,t.frustum=n.frustum.clone(),t},ht});t("Scene/CameraEventType",["../Core/freezeObject"],function(n){"use strict";return n({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4})});t("Scene/CameraEventAggregator",["../Core/Cartesian2","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/KeyboardEventModifier","../Core/Math","../Core/ScreenSpaceEventHandler","../Core/ScreenSpaceEventType","./CameraEventType"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n,i){var r=n;return t(i)&&(r+="+"+i),r}function b(t,i){n.clone(t.distance.startPosition,i.distance.startPosition);n.clone(t.distance.endPosition,i.distance.endPosition);n.clone(t.angleAndHeight.startPosition,i.angleAndHeight.startPosition);n.clone(t.angleAndHeight.endPosition,i.angleAndHeight.endPosition)}function v(i,r,u){var e=c(h.PINCH,r),l=i._update,o=i._isDown,a=i._eventStartPosition,v=i._pressTime,y=i._releaseTime,f;l[e]=!0;o[e]=!1;a[e]=new n;f=i._movement[e];t(f)||(f=i._movement[e]={});f.distance={startPosition:new n,endPosition:new n};f.angleAndHeight={startPosition:new n,endPosition:new n};f.prevAngle=0;i._eventHandler.setInputAction(function(t){i._buttonsDown++;o[e]=!0;v[e]=new Date;n.lerp(t.position1,t.position2,.5,a[e])},s.PINCH_START,r);i._eventHandler.setInputAction(function(){i._buttonsDown=Math.max(i._buttonsDown-1,0);o[e]=!1;y[e]=new Date},s.PINCH_END,r);i._eventHandler.setInputAction(function(t){if(o[e]){l[e]?(b(t,f),l[e]=!1,f.prevAngle=f.angleAndHeight.startPosition.x):(n.clone(t.distance.endPosition,f.distance.endPosition),n.clone(t.angleAndHeight.endPosition,f.angleAndHeight.endPosition));for(var i=f.angleAndHeight.endPosition.x,r=f.prevAngle,s=Math.PI*2;i>=r+Math.PI;)i-=s;while(i<r-Math.PI)i+=s;f.angleAndHeight.endPosition.x=-i*u.clientWidth/12;f.angleAndHeight.startPosition.x=-r*u.clientWidth/12}},s.PINCH_MOVE,r)}function y(i,r){var f=c(h.WHEEL,r),o=i._update,u;o[f]=!0;u=i._movement[f];t(u)||(u=i._movement[f]={});u.startPosition=new n;u.endPosition=new n;i._eventHandler.setInputAction(function(t){var i=15*e.toRadians(t);o[f]?(n.clone(n.ZERO,u.startPosition),u.endPosition.x=0,u.endPosition.y=i,o[f]=!1):u.endPosition.y=u.endPosition.y+i},s.WHEEL,r)}function a(i,r,u){var f=c(u,r),a=i._isDown,v=i._eventStartPosition,y=i._pressTime,p=i._releaseTime,e,o,l;a[f]=!1;v[f]=new n;e=i._lastMovement[f];t(e)||(e=i._lastMovement[f]={startPosition:new n,endPosition:new n,valid:!1});u===h.LEFT_DRAG?(o=s.LEFT_DOWN,l=s.LEFT_UP):u===h.RIGHT_DRAG?(o=s.RIGHT_DOWN,l=s.RIGHT_UP):u===h.MIDDLE_DRAG&&(o=s.MIDDLE_DOWN,l=s.MIDDLE_UP);i._eventHandler.setInputAction(function(t){i._buttonsDown++;e.valid=!1;a[f]=!0;y[f]=new Date;n.clone(t.position,v[f])},o,r);i._eventHandler.setInputAction(function(){i._buttonsDown=Math.max(i._buttonsDown-1,0);a[f]=!1;p[f]=new Date},l,r)}function p(t,i){n.clone(t.startPosition,i.startPosition);n.clone(t.endPosition,i.endPosition)}function w(i,r){var f=i._update,e=i._movement,a=i._lastMovement,v=i._isDown,o,l,u;for(o in h)h.hasOwnProperty(o)&&(l=h[o],t(l)&&(u=c(l,r),f[u]=!0,t(i._lastMovement[u])||(i._lastMovement[u]={startPosition:new n,endPosition:new n,valid:!1}),t(i._movement[u])||(i._movement[u]={startPosition:new n,endPosition:new n})));i._eventHandler.setInputAction(function(u){var s,l,o;for(s in h)h.hasOwnProperty(s)&&(l=h[s],t(l)&&(o=c(l,r),v[o]&&(f[o]?(p(e[o],a[o]),a[o].valid=!0,p(u,e[o]),f[o]=!1):n.clone(u.endPosition,e[o].endPosition))));n.clone(u.endPosition,i._currentMousePosition)},s.MOUSE_MOVE,r)}function l(i){var e,r;if(!t(i))throw new u("canvas is required.");this._eventHandler=new o(i,!0);this._update={};this._movement={};this._lastMovement={};this._isDown={};this._eventStartPosition={};this._pressTime={};this._releaseTime={};this._buttonsDown=0;this._currentMousePosition=new n;y(this,undefined);v(this,undefined,i);a(this,undefined,h.LEFT_DRAG);a(this,undefined,h.RIGHT_DRAG);a(this,undefined,h.MIDDLE_DRAG);w(this,undefined);for(e in f)f.hasOwnProperty(e)&&(r=f[e],t(r)&&(y(this,r),v(this,r,i),a(this,r,h.LEFT_DRAG),a(this,r,h.RIGHT_DRAG),a(this,r,h.MIDDLE_DRAG),w(this,r)))}return i(l.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var n=!this._update[c(h.WHEEL)]||!this._update[c(h.WHEEL,f.SHIFT)]||!this._update[c(h.WHEEL,f.CTRL)]||!this._update[c(h.WHEEL,f.ALT)];return this._buttonsDown>0||n}}}),l.prototype.isMoving=function(n,i){if(!t(n))throw new u("type is required.");var r=c(n,i);return!this._update[r]},l.prototype.getMovement=function(n,i){if(!t(n))throw new u("type is required.");var r=c(n,i);return this._movement[r]},l.prototype.getLastMovement=function(n,i){if(!t(n))throw new u("type is required.");var f=c(n,i),r=this._lastMovement[f];return r.valid?r:undefined},l.prototype.isButtonDown=function(n,i){if(!t(n))throw new u("type is required.");var r=c(n,i);return this._isDown[r]},l.prototype.getStartMousePosition=function(n,i){if(!t(n))throw new u("type is required.");if(n===h.WHEEL)return this._currentMousePosition;var r=c(n,i);return this._eventStartPosition[r]},l.prototype.getButtonPressTime=function(n,i){if(!t(n))throw new u("type is required.");var r=c(n,i);return this._pressTime[r]},l.prototype.getButtonReleaseTime=function(n,i){if(!t(n))throw new u("type is required.");var r=c(n,i);return this._releaseTime[r]},l.prototype.reset=function(){for(var n in this._update)this._update.hasOwnProperty(n)&&(this._update[n]=!0)},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),r(this)},l});t("Scene/Composite3DTileContent",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/FeatureDetection","../Core/getMagic","../Core/RuntimeError","../ThirdParty/when"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,t,i,r,u,f){this._tileset=n;this._tile=t;this._resource=i;this._contents=[];this._readyPromise=o.defer();c(this,r,u,f)}function c(i,r,u,s){var p,c,l,w,a,v,y;if(u=n(u,0),p=new Uint8Array(r),c=new DataView(r),u+=h,l=c.getUint32(u,!0),l!==1)throw new e("Only Composite Tile version 1 is supported. Version "+l+" is not.");for(u+=h,u+=h,w=c.getUint32(u,!0),u+=h,a=[],v=0;v<w;++v){var b=f(p,u),d=c.getUint32(u+h*2,!0),k=s[b];if(t(k))y=k(i._tileset,i._tile,i._resource,r,u),i._contents.push(y),a.push(y.readyPromise);else throw new e("Unknown tile content type, "+b+", inside Composite tile");u+=d}o.all(a).then(function(){i._readyPromise.resolve(i)}).otherwise(function(n){i._readyPromise.reject(n)})}if(!u.supportsTypedArrays())return{};i(s.prototype,{featurePropertiesDirty:{get:function(){for(var t=this._contents,i=t.length,n=0;n<i;++n)if(t[n].featurePropertiesDirty)return!0;return!1},set:function(n){for(var i=this._contents,r=i.length,t=0;t<r;++t)i[t].featurePropertiesDirty=n}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return undefined}}});var h=Uint32Array.BYTES_PER_ELEMENT;return s.prototype.hasProperty=function(){return!1},s.prototype.getFeature=function(){return undefined},s.prototype.applyDebugSettings=function(n,t){for(var r=this._contents,u=r.length,i=0;i<u;++i)r[i].applyDebugSettings(n,t)},s.prototype.applyStyle=function(n){for(var i=this._contents,r=i.length,t=0;t<r;++t)i[t].applyStyle(n)},s.prototype.update=function(n,t){for(var r=this._contents,u=r.length,i=0;i<u;++i)r[i].update(n,t)},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){for(var t=this._contents,i=t.length,n=0;n<i;++n)t[n].destroy();return r(this)},s});t("Scene/Vector3DTileGeometry",["../Core/arraySlice","../Core/BoundingSphere","../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Matrix4","../Core/TaskProcessor","../ThirdParty/when","./ClassificationType","./Vector3DTileBatch","./Vector3DTilePrimitive"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(n){this._boxes=n.boxes;this._boxBatchIds=n.boxBatchIds;this._cylinders=n.cylinders;this._cylinderBatchIds=n.cylinderBatchIds;this._ellipsoids=n.ellipsoids;this._ellipsoidBatchIds=n.ellipsoidBatchIds;this._spheres=n.spheres;this._sphereBatchIds=n.sphereBatchIds;this._modelMatrix=n.modelMatrix;this._batchTable=n.batchTable;this._boundingVolume=n.boundingVolume;this._center=n.center;f(this._center)||(this._center=f(this._boundingVolume)?i.clone(this._boundingVolume.center):i.clone(i.ZERO));this._boundingVolumes=undefined;this._batchedIndices=undefined;this._indices=undefined;this._indexOffsets=undefined;this._indexCounts=undefined;this._positions=undefined;this._vertexBatchIds=undefined;this._batchIds=undefined;this._batchTableColors=undefined;this._packedBuffer=undefined;this._ready=!1;this._readyPromise=c.defer();this._verticesPromise=undefined;this._primitive=undefined;this.debugWireframe=!1;this.forceRebatch=!1;this.classificationType=l.CESIUM_3D_TILE}function p(n){var t=new Float64Array(s.packedLength+i.packedLength),r=0;return i.pack(n._center,t,r),r+=i.packedLength,s.pack(n._modelMatrix,t,r),t}function w(n,i){for(var s,c,f,l,e,u=0,p=i[u++],h=i[u++],w=n._boundingVolumes=new Array(h),o=0;o<h;++o)w[o]=t.unpack(i,u),u+=t.packedLength;for(s=i[u++],c=n._batchedIndices=new Array(s),f=0;f<s;++f){l=r.unpack(i,u);u+=r.packedLength;var b=i[u++],k=i[u++],v=i[u++],y=new Array(v);for(e=0;e<v;++e)y[e]=i[u++];c[f]=new a({color:l,offset:b,count:k,batchIds:y})}return p}function d(t){var s,it,g,rt,h,ut,tt;if(!f(t._primitive)){if(!f(t._verticesPromise)){var i=t._boxes,c=t._boxBatchIds,r=t._cylinders,l=t._cylinderBatchIds,e=t._ellipsoids,a=t._ellipsoidBatchIds,o=t._spheres,y=t._sphereBatchIds,d=t._batchTableColors,nt=t._packedBuffer;if(!f(d)){for(s=0,f(t._boxes)&&(i=t._boxes=n(i),c=t._boxBatchIds=n(c),s+=c.length),f(t._cylinders)&&(r=t._cylinders=n(r),l=t._cylinderBatchIds=n(l),s+=l.length),f(t._ellipsoids)&&(e=t._ellipsoids=n(e),a=t._ellipsoidBatchIds=n(a),s+=a.length),f(t._spheres)&&(o=t._sphere=n(o),y=t._sphereBatchIds=n(y),s+=y.length),d=t._batchTableColors=new Uint32Array(s),it=t._batchTable,g=0;g<s;++g)rt=it.getColor(g,k),d[g]=rt.toRgba();nt=t._packedBuffer=p(t)}if(h=[],f(i)&&h.push(i.buffer,c.buffer),f(r)&&h.push(r.buffer,l.buffer),f(e)&&h.push(e.buffer,a.buffer),f(o)&&h.push(o.buffer,y.buffer),h.push(d.buffer,nt.buffer),ut={boxes:f(i)?i.buffer:undefined,boxBatchIds:f(i)?c.buffer:undefined,cylinders:f(r)?r.buffer:undefined,cylinderBatchIds:f(r)?l.buffer:undefined,ellipsoids:f(e)?e.buffer:undefined,ellipsoidBatchIds:f(e)?a.buffer:undefined,spheres:f(o)?o.buffer:undefined,sphereBatchIds:f(o)?y.buffer:undefined,batchTableColors:d.buffer,packedBuffer:nt.buffer},tt=t._verticesPromise=b.scheduleTask(ut,h),!f(tt))return;tt.then(function(n){var i=new Float64Array(n.packedBuffer),r=w(t,i);t._indices=r===2?new Uint16Array(n.indices):new Uint32Array(n.indices);t._indexOffsets=new Uint32Array(n.indexOffsets);t._indexCounts=new Uint32Array(n.indexCounts);t._positions=new Float32Array(n.positions);t._vertexBatchIds=new Uint16Array(n.vertexBatchIds);t._batchIds=new Uint16Array(n.batchIds);t._ready=!0})}t._ready&&!f(t._primitive)&&(t._primitive=new v({batchTable:t._batchTable,positions:t._positions,batchIds:t._batchIds,vertexBatchIds:t._vertexBatchIds,indices:t._indices,indexOffsets:t._indexOffsets,indexCounts:t._indexCounts,batchedIndices:t._batchedIndices,boundingVolume:t._boundingVolume,boundingVolumes:t._boundingVolumes,center:t._center,pickObject:u(t._pickObject,t)}),t._boxes=undefined,t._boxBatchIds=undefined,t._cylinders=undefined,t._cylinderBatchIds=undefined,t._ellipsoids=undefined,t._ellipsoidBatchIds=undefined,t._spheres=undefined,t._sphereBatchIds=undefined,t._center=undefined,t._modelMatrix=undefined,t._batchTable=undefined,t._boundingVolume=undefined,t._boundingVolumes=undefined,t._batchedIndices=undefined,t._indices=undefined,t._indexOffsets=undefined,t._indexCounts=undefined,t._positions=undefined,t._vertexBatchIds=undefined,t._batchIds=undefined,t._batchTableColors=undefined,t._packedBuffer=undefined,t._verticesPromise=undefined,t._readyPromise.resolve())}}e(y.prototype,{trianglesLength:{get:function(){return f(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return f(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});y.packedBoxLength=s.packedLength+i.packedLength;y.packedCylinderLength=s.packedLength+2;y.packedEllipsoidLength=s.packedLength+i.packedLength;y.packedSphereLength=i.packedLength+1;var b=new h("createVectorTileGeometries"),k=new r;return y.prototype.createFeatures=function(n,t){this._primitive.createFeatures(n,t)},y.prototype.applyDebugSettings=function(n,t){this._primitive.applyDebugSettings(n,t)},y.prototype.applyStyle=function(n,t){this._primitive.applyStyle(n,t)},y.prototype.updateCommands=function(n,t){this._primitive.updateCommands(n,t)},y.prototype.update=function(n){(d(this),this._ready)&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(n))},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),o(this)},y});t("Scene/Geometry3DTileContent",["../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Ellipsoid","../Core/FeatureDetection","../Core/getMagic","../Core/getStringFromTypedArray","../Core/Math","../Core/Matrix4","../Core/Rectangle","../Core/RuntimeError","../ThirdParty/when","./Cesium3DTileBatchTable","./Vector3DTileGeometry"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(n,t,i,r,u){this._tileset=n;this._tile=t;this._resource=i;this._geometries=undefined;this._contentReadyPromise=undefined;this._readyPromise=y.defer();this._batchTable=undefined;this._features=undefined;this.featurePropertiesDirty=!1;tt(this,r,u)}function g(n){return function(t,r){i(n._geometries)&&n._geometries.updateCommands(t,r)}}function nt(n,r){var f,e,o,s,u,h=t(n.BOXES_LENGTH,0),c=t(n.CYLINDERS_LENGTH,0),l=t(n.ELLIPSOIDS_LENGTH,0),a=t(n.SPHERES_LENGTH,0),p,w,b,k,d,g,nt,y;if(h>0&&i(n.BOX_BATCH_IDS)&&(p=r.byteOffset+n.BOX_BATCH_IDS.byteOffset,f=new Uint16Array(r.buffer,p,h)),c>0&&i(n.CYLINDER_BATCH_IDS)&&(w=r.byteOffset+n.CYLINDER_BATCH_IDS.byteOffset,e=new Uint16Array(r.buffer,w,c)),l>0&&i(n.ELLIPSOID_BATCH_IDS)&&(b=r.byteOffset+n.ELLIPSOID_BATCH_IDS.byteOffset,o=new Uint16Array(r.buffer,b,l)),a>0&&i(n.SPHERE_BATCH_IDS)&&(k=r.byteOffset+n.SPHERE_BATCH_IDS.byteOffset,s=new Uint16Array(r.buffer,k,a)),d=i(f)||i(e)||i(o)||i(s),g=h>0&&!i(f)||c>0&&!i(e)||l>0&&!i(o)||a>0&&!i(s),d&&g)throw new v("If one group of batch ids is defined, then all batch ids must be defined.");if(nt=!i(f)&&!i(e)&&!i(o)&&!i(s),nt){if(y=0,!i(f)&&h>0)for(f=new Uint16Array(h),u=0;u<h;++u)f[u]=y++;if(!i(e)&&c>0)for(e=new Uint16Array(c),u=0;u<c;++u)e[u]=y++;if(!i(o)&&l>0)for(o=new Uint16Array(l),u=0;u<l;++u)o[u]=y++;if(!i(s)&&a>0)for(s=new Uint16Array(a),u=0;u<a;++u)s[u]=y++}return{boxes:f,cylinders:e,ellipsoids:o,spheres:s}}function tt(r,u,f){var ft,s,et,ct,a,ot,y,st,lt,e,o,at,b,vt,ht,ut,c,wt,bt,kt,dt,gt,ni,ti,ii;if(f=t(f,0),ft=new Uint8Array(u),s=new DataView(u),f+=k,et=s.getUint32(f,!0),et!==1)throw new v("Only Geometry tile version 1 is supported.  Version "+et+" is not.");if(f+=k,ct=s.getUint32(f,!0),f+=k,ct===0){r._readyPromise.resolve(r);return}if(a=s.getUint32(f,!0),f+=k,a===0)throw new v("Feature table must have a byte length greater than zero");ot=s.getUint32(f,!0);f+=k;y=s.getUint32(f,!0);f+=k;st=s.getUint32(f,!0);f+=k;lt=h(ft,f,a);e=JSON.parse(lt);f+=a;o=new Uint8Array(u,f,ot);f+=ot;y>0&&(vt=h(ft,f,y),at=JSON.parse(vt),f+=y,st>0&&(b=new Uint8Array(u,f,st),b=new Uint8Array(b)));var d=t(e.BOXES_LENGTH,0),tt=t(e.CYLINDERS_LENGTH,0),it=t(e.ELLIPSOIDS_LENGTH,0),rt=t(e.SPHERES_LENGTH,0),yt=d+tt+it+rt,pt=new p(r,yt,at,b,g(r));(r._batchTable=pt,yt!==0)&&(ht=r.tile.computedTransform,i(e.RTC_CENTER)&&(ut=n.unpack(e.RTC_CENTER),l.multiplyByPoint(ht,ut,ut)),c=nt(e,o),(d>0||tt>0||it>0||rt>0)&&(d>0&&(gt=o.byteOffset+e.BOXES.byteOffset,wt=new Float32Array(o.buffer,gt,w.packedBoxLength*d)),tt>0&&(ni=o.byteOffset+e.CYLINDERS.byteOffset,bt=new Float32Array(o.buffer,ni,w.packedCylinderLength*tt)),it>0&&(ti=o.byteOffset+e.ELLIPSOIDS.byteOffset,kt=new Float32Array(o.buffer,ti,w.packedEllipsoidLength*it)),rt>0&&(ii=o.byteOffset+e.SPHERES.byteOffset,dt=new Float32Array(o.buffer,ii,w.packedSphereLength*rt)),r._geometries=new w({boxes:wt,boxBatchIds:c.boxes,cylinders:bt,cylinderBatchIds:c.cylinders,ellipsoids:kt,ellipsoidBatchIds:c.ellipsoids,spheres:dt,sphereBatchIds:c.spheres,center:ut,modelMatrix:ht,batchTable:pt,boundingVolume:r.tile.boundingVolume.boundingVolume})))}function d(n){var r=n.featuresLength,t;!i(n._features)&&r>0&&(t=new Array(r),i(n._geometries)&&n._geometries.createFeatures(n,t),n._features=t)}if(!o.supportsTypedArrays())return{};r(b.prototype,{featuresLength:{get:function(){return i(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return i(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return i(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return i(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var k=Uint32Array.BYTES_PER_ELEMENT;return b.prototype.hasProperty=function(n,t){return this._batchTable.hasProperty(n,t)},b.prototype.getFeature=function(n){var t=this.featuresLength;if(!i(n)||n<0||n>=t)throw new f("batchId is required and between zero and featuresLength - 1 ("+(t-1)+").");return d(this),this._features[n]},b.prototype.applyDebugSettings=function(n,t){i(this._geometries)&&this._geometries.applyDebugSettings(n,t)},b.prototype.applyStyle=function(n){d(this);i(this._geometries)&&this._geometries.applyStyle(n,this._features)},b.prototype.update=function(n,t){if(i(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(t)),i(this._batchTable)&&this._geometries._ready&&this._batchTable.update(n,t),!i(this._contentReadyPromise)){var r=this;this._contentReadyPromise=this._geometries.readyPromise.then(function(){r._readyPromise.resolve(r)})}},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return this._geometries=this._geometries&&this._geometries.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),u(this)},b});t("Scene/ModelInstance",["../Core/defineProperties","../Core/Matrix4"],function(n,t){"use strict";function i(n,i,r){this.primitive=n;this._modelMatrix=t.clone(i);this._instanceId=r}return n(i.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return t.clone(this._modelMatrix)},set:function(n){t.clone(n,this._modelMatrix);this.primitive.expandBoundingSphere(this._modelMatrix);this.primitive._dirty=!0}}}),i});t("Scene/ModelInstanceCollection",["../Core/BoundingSphere","../Core/Cartesian3","../Core/clone","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Matrix4","../Core/PrimitiveType","../Core/Resource","../Core/RuntimeError","../Core/Transforms","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/ShaderSource","../ThirdParty/GltfPipeline/ForEach","../ThirdParty/when","./Model","./ModelInstance","./ModelUtility","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function ot(n){if(n=f(n,f.EMPTY_OBJECT),!e(n.gltf)&&!e(n.url))throw new h("Either options.gltf or options.url is required.");if(e(n.gltf)&&e(n.url))throw new h("Cannot pass in both options.gltf and options.url.");this.show=f(n.show,!0);this._instancingSupported=!1;this._dynamic=f(n.dynamic,!1);this._allowPicking=f(n.allowPicking,!0);this._ready=!1;this._readyPromise=nt.defer();this._state=et.NEEDS_LOAD;this._dirty=!1;this._cull=f(n.cull,!0);this._opaquePass=f(n.opaquePass,k.OPAQUE);this._instances=pt(this,n.instances);this._batchTable=n.batchTable;this._model=undefined;this._vertexBufferTypedArray=undefined;this._vertexBuffer=undefined;this._batchIdBuffer=undefined;this._instancedUniformsByProgram=undefined;this._drawCommands=[];this._modelCommands=undefined;this._boundingSphere=wt(this);this._center=t.clone(this._boundingSphere.center);this._rtcTransform=new c;this._rtcModelView=new c;this._mode=undefined;this.modelMatrix=c.clone(c.IDENTITY);this._modelMatrix=c.clone(this.modelMatrix);this._url=a.createIfNeeded(n.url);this._requestType=n.requestType;this._gltf=n.gltf;this._basePath=a.createIfNeeded(n.basePath);this._asynchronous=n.asynchronous;this._incrementallyLoadTextures=n.incrementallyLoadTextures;this._upAxis=n.upAxis;this._forwardAxis=n.forwardAxis;this.shadows=f(n.shadows,ft.ENABLED);this._shadows=this.shadows;this._pickIdLoaded=n.pickIdLoaded;this.debugShowBoundingVolume=f(n.debugShowBoundingVolume,!1);this._debugShowBoundingVolume=!1;this.debugWireframe=f(n.debugWireframe,!1);this._debugWireframe=!1}function pt(n,t){var r,u,i;for(t=f(t,[]),r=t.length,u=new Array(r),i=0;i<r;++i){var e=t[i],o=e.modelMatrix,s=f(e.batchId,i);u[i]=new it(n,o,s)}return u}function wt(i){for(var u=i.length,f=new Array(u),r=0;r<u;++r)f[r]=c.getTranslation(i._instances[r]._modelMatrix,new t);return n.fromPoints(f)}function bt(n,t,i,r){return function(u,f){var o=u.semantic;if(e(o)&&n.indexOf(o)>-1)if(t.indexOf(o)>-1)r[f]=o;else throw new v('Shader program cannot be optimized for instancing. Uniform "'+f+'" in program "'+i+'" uses unsupported semantic "'+o+'"');}}function ct(n,t){var i,u,f,o,s;if(e(n._instancedUniformsByProgram))return n._instancedUniformsByProgram[t];i={};n._instancedUniformsByProgram=i;var h=["MODEL","MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELINVERSE","MODELVIEWINVERSE","MODELVIEWPROJECTIONINVERSE","MODELINVERSETRANSPOSE","MODELVIEWINVERSETRANSPOSE"],c=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],r=n._model._sourceTechniques;for(u in r)r.hasOwnProperty(u)&&(f=r[u],o=f.program,e(i[o])||(s={},i[o]=s,g.techniqueUniform(f,bt(h,c,t,s))));return i[t]}function kt(n){return function(t,i){var c=ct(n,i),w=e(n._batchTable),r=d.replaceMain(t,"czm_instancing_main"),l="",a="",u,f,o,s,b,v,y,p,h,k,g;for(u in c)c.hasOwnProperty(u)&&(f=c[u],f==="MODELVIEW"||f==="CESIUM_RTC_MODELVIEW"?o="czm_instanced_modelView":f==="MODELVIEWPROJECTION"?(o="czm_instanced_modelViewProjection",l+="mat4 czm_instanced_modelViewProjection;\n",a+="czm_instanced_modelViewProjection = czm_projection * czm_instanced_modelView;\n"):f==="MODELVIEWINVERSETRANSPOSE"&&(o="czm_instanced_modelViewInverseTranspose",l+="mat3 czm_instanced_modelViewInverseTranspose;\n",a+="czm_instanced_modelViewInverseTranspose = mat3(czm_instanced_modelView);\n"),s=new RegExp("uniform.*"+u+".*"),r=r.replace(s,""),s=new RegExp(u+"\\b","g"),r=r.replace(s,o));return b="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n",w?(v="attribute float a_batchId;\n",y="",p=""):(v="",y="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n",p="    v_pickColor = pickColor;\n"),h=b+l+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+v+y+r+"void main()\n{\n    mat4 czm_instanced_model = mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView = czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;\n"+a+"    czm_instancing_main();\n"+p+"}\n",w&&(k=n._model.gltf,g=rt.getDiffuseAttributeOrUniform(k,i),h=n._batchTable.getVertexShaderCallback(!0,"a_batchId",g)(h)),h}}function dt(n){return function(t,i){var r=n._batchTable,u,f;return e(r)?(u=n._model.gltf,f=rt.getDiffuseAttributeOrUniform(u,i),t=r.getFragmentShaderCallback(!0,f)(t)):t="varying vec4 v_pickColor;\n"+t,t}}function gt(n,t){return function(){return c.multiply(t.uniformState.view,n._rtcTransform,n._rtcModelView)}}function ni(n){return function(){return n.computedMatrix}}function ti(n,t){return function(r,u,f){var o,s;r=i(r);r.czm_instanced_modifiedModelView=gt(n,t);r.czm_instanced_nodeTransform=ni(f);o=ct(n,u);for(s in o)o.hasOwnProperty(s)&&delete r[s];return e(n._batchTable)&&(r=n._batchTable.getUniformMapCallback()(r)),r}}function ii(n){return function(t,i){if(e(n._batchTable)){var r=n._model.gltf,u=rt.getDiffuseAttributeOrUniform(r,i);t=n._batchTable.getVertexShaderCallback(!0,"a_batchId",u)(t);t="uniform float a_batchId\n;"+t}return t}}function ri(n){return function(t,i){var r=n._batchTable,u,f;return e(r)?(u=n._model.gltf,f=rt.getDiffuseAttributeOrUniform(u,i),t=r.getFragmentShaderCallback(!0,f)(t)):t="uniform vec4 czm_pickColor;\n"+t,t}}function ui(n){return function(t){return e(n._batchTable)&&(t=n._batchTable.getUniformMapCallback()(t)),t}}function lt(n){var l=n._instances,o=n.length,f=n._center,s=12,t=n._vertexBufferTypedArray,u,h,i,r;for(e(t)||(t=new Float32Array(o*s)),n._dynamic&&(n._vertexBufferTypedArray=t),u=0;u<o;++u)h=l[u]._modelMatrix,i=c.clone(h,st),i[12]-=f.x,i[13]-=f.y,i[14]-=f.z,r=u*s,t[r+0]=i[0],t[r+1]=i[4],t[r+2]=i[8],t[r+3]=i[12],t[r+4]=i[1],t[r+5]=i[5],t[r+6]=i[9],t[r+7]=i[13],t[r+8]=i[2],t[r+9]=i[6],t[r+10]=i[10],t[r+11]=i[14];return t}function fi(n,t){var i,a=n._instances,f=n.length,v=n._dynamic,c=e(n._batchTable),h,u,l;if(c){for(h=new Uint16Array(f),i=0;i<f;++i)h[i]=a[i]._instanceId;n._batchIdBuffer=p.createVertexBuffer({context:t,typedArray:h,usage:w.STATIC_DRAW})}if(!c){for(u=new Uint8Array(f*4),i=0;i<f;++i){var y=n._pickIds[i],o=y.color,s=i*4;u[s]=r.floatToByte(o.red);u[s+1]=r.floatToByte(o.green);u[s+2]=r.floatToByte(o.blue);u[s+3]=r.floatToByte(o.alpha)}n._pickIdBuffer=p.createVertexBuffer({context:t,typedArray:u,usage:w.STATIC_DRAW})}l=lt(n);n._vertexBuffer=p.createVertexBuffer({context:t,typedArray:l,usage:v?w.STREAM_DRAW:w.STATIC_DRAW})}function ei(n){var t=lt(n);n._vertexBuffer.copyFromArrayView(t)}function oi(n,t){for(var r=n._instances,u=r.length,f=new Array(u),i=0;i<u;++i)f[i]=t.createPickId(r[i]);return f}function si(n,t){var h=n._instancingSupported,f=e(n._batchTable),c=n._allowPicking,i={url:n._url,requestType:n._requestType,gltf:n._gltf,basePath:n._basePath,shadows:n._shadows,cacheKey:undefined,asynchronous:n._asynchronous,allowPicking:c,incrementallyLoadTextures:n._incrementallyLoadTextures,upAxis:n._upAxis,forwardAxis:n._forwardAxis,precreatedAttributes:undefined,vertexShaderLoaded:undefined,fragmentShaderLoaded:undefined,uniformMapLoaded:undefined,pickIdLoaded:n._pickIdLoaded,ignoreCommands:!0,opaquePass:n._opaquePass};if(f||(n._pickIds=oi(n,t)),h){fi(n,t);var o=12,r=u.getSizeInBytes(u.FLOAT),s={czm_modelMatrixRow0:{index:0,vertexBuffer:n._vertexBuffer,componentsPerAttribute:4,componentDatatype:u.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:r*o,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:n._vertexBuffer,componentsPerAttribute:4,componentDatatype:u.FLOAT,normalize:!1,offsetInBytes:r*4,strideInBytes:r*o,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:n._vertexBuffer,componentsPerAttribute:4,componentDatatype:u.FLOAT,normalize:!1,offsetInBytes:r*8,strideInBytes:r*o,instanceDivisor:1}};f&&(s.a_batchId={index:0,vertexBuffer:n._batchIdBuffer,componentsPerAttribute:1,componentDatatype:u.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});f||(s.pickColor={index:0,vertexBuffer:n._pickIdBuffer,componentsPerAttribute:4,componentDatatype:u.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});i.precreatedAttributes=s;i.vertexShaderLoaded=kt(n);i.fragmentShaderLoaded=dt(n);i.uniformMapLoaded=ti(n,t);e(n._url)&&(i.cacheKey=n._url.getUrlComponent()+"#instanced")}else i.vertexShaderLoaded=ii(n),i.fragmentShaderLoaded=ri(n),i.uniformMapLoaded=ui(n,t);n._model=e(n._url)?tt.fromGltf(i):new tt(i)}function hi(n){var t;if(n._debugWireframe!==n.debugWireframe){n._debugWireframe=n.debugWireframe;var r=n.debugWireframe?l.LINES:l.TRIANGLES,i=n._drawCommands,u=i.length;for(t=0;t<u;++t)i[t].primitiveType=r}}function ci(n){var i,r,t;if(n.debugShowBoundingVolume!==n._debugShowBoundingVolume)for(n._debugShowBoundingVolume=n.debugShowBoundingVolume,i=n._drawCommands,r=i.length,t=0;t<r;++t)i[t].debugShowBoundingVolume=n.debugShowBoundingVolume}function li(n,t){for(var i,u=t.length,f=n.length,o=n._boundingSphere,s=n._cull,r=0;r<u;++r)i=b.shallowClone(t[r]),i.instanceCount=f,i.boundingVolume=o,i.cull=s,i.pickId=e(n._batchTable)?n._batchTable.getPickId():"v_pickColor",n._drawCommands.push(i)}function ai(n){return function(){return n}}function vi(n){return function(){return n}}function yi(t,r){for(var f,u,s,h=t._instances,l=r.length,a=t.length,v=t._batchTable,y=e(v),p=t._cull,o=0;o<l;++o)for(f=0;f<a;++f)u=b.shallowClone(r[o]),u.modelMatrix=new c,u.boundingVolume=new n,u.cull=p,u.uniformMap=i(u.uniformMap),y?u.uniformMap.a_batchId=ai(h[f]._instanceId):(s=t._pickIds[f],u.uniformMap.czm_pickColor=vi(s.color)),t._drawCommands.push(u)}function at(t){for(var e,r,l,a,v,y,o=t._modelCommands,p=o.length,s=t.length,w=t._rtcTransform,f=t._center,u=0;u<p;++u)for(e=o[u],r=0;r<s;++r){var b=u*s+r,h=t._drawCommands[b],i=c.clone(t._instances[r]._modelMatrix,st);i[12]-=f.x;i[13]-=f.y;i[14]-=f.z;i=c.multiply(w,i,st);l=e.modelMatrix;a=h.modelMatrix;c.multiply(i,l,a);v=e.boundingVolume;y=h.boundingVolume;n.transform(v,i,y)}}function vt(n){for(var i,r=n._nodeCommands,f=r.length,u=[],t=0;t<f;++t)i=r[t],i.show&&u.push(i.command);return u}function pi(n){for(var r,i=n._nodeCommands,u=i.length,t=0;t<u;t++)if(r=i[t],r.command.dirty)return!0;return!1}function yt(n,t){n._drawCommands=[];var i=vt(n._model);t?li(n,i):(yi(n,i),at(n))}function wi(n){var t,i;if(n.shadows!==n._shadows){n._shadows=n.shadows;var u=ft.castShadows(n.shadows),f=ft.receiveShadows(n.shadows),r=n._drawCommands,e=r.length;for(t=0;t<e;++t)i=r[t],i.castShadows=u,i.receiveShadows=f}}var et={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},ht,st;return o(ot.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}}),ht=new t,st=new c,ot.prototype.expandBoundingSphere=function(t){var i=c.getTranslation(t,ht);n.expand(this._boundingSphere,i,this._boundingSphere)},ot.prototype.update=function(n){var e,o,r,i,h,u,s,f;if(n.mode!==ut.MORPHING&&this.show&&this.length!==0){if(e=n.context,this._state===et.NEEDS_LOAD&&(this._state=et.LOADING,this._instancingSupported=e.instancedArrays,si(this,e),o=this,this._model.readyPromise.otherwise(function(n){o._state=et.FAILED;o._readyPromise.reject(n)})),r=this._instancingSupported,i=this._model,i.update(n),i.ready&&this._state===et.LOADING){this._state=et.LOADED;this._ready=!0;h=i.boundingSphere.radius+t.magnitude(i.boundingSphere.center);this._boundingSphere.radius+=h;this._modelCommands=vt(i);yt(this,r);this._readyPromise.resolve(this);return}if(this._state===et.LOADED){var l=n.mode!==this._mode,a=this.modelMatrix,v=!c.equals(this._modelMatrix,a);if((l||v)&&(this._mode=n.mode,c.clone(a,this._modelMatrix),u=c.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform),this._mode!==ut.SCENE3D&&(u=y.basisTo2D(n.mapProjection,u,u)),c.getTranslation(u,this._boundingSphere.center)),r&&this._dirty&&(this._dynamic=!0,this._dirty=!1,ei(this)),pi(i)&&yt(this,r),!r&&(i.dirty||this._dirty||l||v)&&at(this),wi(this),hi(this),ci(this),s=n.passes,s.render||s.pick){var w=n.commandList,p=this._drawCommands,b=p.length;for(f=0;f<b;++f)w.push(p[f])}}}},ot.prototype.isDestroyed=function(){return!1},ot.prototype.destroy=function(){var n,i,t;if(this._model=this._model&&this._model.destroy(),n=this._pickIds,e(n))for(i=n.length,t=0;t<i;++t)n[t].destroy();return s(this)},ot});t("Scene/Instanced3DModel3DTileContent",["../Core/AttributeCompression","../Core/Cartesian3","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/DeveloperError","../Core/Ellipsoid","../Core/FeatureDetection","../Core/getBaseUri","../Core/getStringFromTypedArray","../Core/Matrix3","../Core/Matrix4","../Core/Quaternion","../Core/RequestType","../Core/RuntimeError","../Core/Transforms","../Core/TranslationRotationScale","../Renderer/Pass","./Axis","./Cesium3DTileBatchTable","./Cesium3DTileFeature","./Cesium3DTileFeatureTable","./ModelInstanceCollection"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function et(n,t,i,r,u){this._tileset=n;this._tile=t;this._resource=i;this._modelInstanceCollection=undefined;this._batchTable=undefined;this._features=undefined;this.featurePropertiesDirty=!1;lt(this,r,u)}function ct(n){return function(){return n._batchTable.getPickId()}}function lt(i,e,o){var tr=u(o,0),kt,a,vi,ir,dt,yi,gt,ni,yt,rr,ur,fr,s,at,er,ti,or,ii,ri,vt,ui,sr,pi,wi,h,wt,bi,ki,di,lt,ci,li,nr,bt,ai,ar;if(o=tr,kt=new Uint8Array(e),a=new DataView(e),o+=ot,vi=a.getUint32(o,!0),vi!==1)throw new k("Only Instanced 3D Model version 1 is supported. Version "+vi+" is not.");if(o+=ot,ir=a.getUint32(o,!0),o+=ot,dt=a.getUint32(o,!0),dt===0)throw new k("featureTableJsonByteLength is zero, the feature table must be defined.");if(o+=ot,yi=a.getUint32(o,!0),o+=ot,gt=a.getUint32(o,!0),o+=ot,ni=a.getUint32(o,!0),o+=ot,yt=a.getUint32(o,!0),yt!==1&&yt!==0)throw new k("Only glTF format 0 (uri) or 1 (embedded) are supported. Format "+yt+" is not.");if(o+=ot,rr=v(kt,o,dt),ur=JSON.parse(rr),o+=dt,fr=new Uint8Array(e,o,yi),o+=yi,s=new ut(ur,fr),at=s.getGlobalProperty("INSTANCES_LENGTH"),s.featuresLength=at,!f(at))throw new k("Feature table global property: INSTANCES_LENGTH must be defined");if(gt>0&&(or=v(kt,o,gt),er=JSON.parse(or),o+=gt,ni>0&&(ti=new Uint8Array(e,o,ni),ti=new Uint8Array(ti),o+=ni)),i._batchTable=new it(i,at,er,ti),ii=tr+ir-o,ii===0)throw new k("glTF byte length is zero, i3dm must have a glTF to instance.");o%4==0?ri=new Uint8Array(e,o,ii):(et._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),ri=new Uint8Array(kt.subarray(o,o+ii)));vt={instances:new Array(at),batchTable:i._batchTable,cull:!1,url:undefined,requestType:b.TILES3D,gltf:undefined,basePath:undefined,incrementallyLoadTextures:!1,upAxis:i._tileset._gltfUpAxis,forwardAxis:tt.X,opaquePass:nt.CESIUM_3D_TILE,pickIdLoaded:ct(i)};yt===0?(ui=v(ri),ui=ui.replace(/[\s\0]+$/,""),vt.url=i._resource.getDerivedResource({url:ui})):(vt.gltf=ri,vt.basePath=i._resource.clone());sr=s.getGlobalProperty("EAST_NORTH_UP");wi=s.getGlobalProperty("RTC_CENTER",r.FLOAT,3);f(wi)&&(pi=t.unpack(wi));var vr=vt.instances,pt=new t,yr=new Array(3),fi=new t,ei=new t,oi=new t,l=new y,hr=new w,rt=new t,si=new g,hi=new p;for(h=0;h<at;h++){if(wt=s.getProperty("POSITION",r.FLOAT,3,h,st),!f(wt)){if(wt=yr,bi=s.getProperty("POSITION_QUANTIZED",r.UNSIGNED_SHORT,3,h,st),!f(bi))throw new k("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");if(ki=s.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",r.FLOAT,3),!f(ki))throw new k("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");if(di=s.getGlobalProperty("QUANTIZED_VOLUME_SCALE",r.FLOAT,3),!f(di))throw new k("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(lt=0;lt<3;lt++)wt[lt]=bi[lt]/65535*di[lt]+ki[lt]}t.unpack(wt,0,pt);f(pi)&&t.add(pt,pi,pt);si.translation=pt;var cr=s.getProperty("NORMAL_UP",r.FLOAT,3,h,st),lr=s.getProperty("NORMAL_RIGHT",r.FLOAT,3,h,ht),gi=!1;if(f(cr)){if(!f(lr))throw new k("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");t.unpack(cr,0,ei);t.unpack(lr,0,fi);gi=!0}else if(ci=s.getProperty("NORMAL_UP_OCT32P",r.UNSIGNED_SHORT,2,h,st),li=s.getProperty("NORMAL_RIGHT_OCT32P",r.UNSIGNED_SHORT,2,h,ht),f(ci)){if(!f(li))throw new k("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");n.octDecodeInRange(ci[0],ci[1],65535,ei);n.octDecodeInRange(li[0],li[1],65535,fi);gi=!0}else sr?(d.eastNorthUpToFixedFrame(pt,c.WGS84,hi),p.getRotation(hi,l)):y.clone(y.IDENTITY,l);gi&&(t.cross(fi,ei,oi),t.normalize(oi,oi),y.setColumn(l,0,fi,l),y.setColumn(l,1,ei,l),y.setColumn(l,2,oi,l));w.fromRotationMatrix(l,hr);si.rotation=hr;rt=t.fromElements(1,1,1,rt);nr=s.getProperty("SCALE",r.FLOAT,1,h);f(nr)&&t.multiplyByScalar(rt,nr,rt);bt=s.getProperty("SCALE_NON_UNIFORM",r.FLOAT,3,h,st);f(bt)&&(rt.x*=bt[0],rt.y*=bt[1],rt.z*=bt[2]);si.scale=rt;ai=s.getProperty("BATCH_ID",r.UNSIGNED_SHORT,1,h);f(ai)||(ai=h);p.fromTranslationRotationScale(si,hi);ar=hi.clone();vr[h]={modelMatrix:ar,batchId:ai}}i._modelInstanceCollection=new ft(vt)}function at(n){var i=n.featuresLength,r,t;if(!f(n._features)&&i>0){for(r=new Array(i),t=0;t<i;++t)r[t]=new rt(n,t);n._features=r}}if(!l.supportsTypedArrays())return{};et._deprecationWarning=o;e(et.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){var n=this._modelInstanceCollection._model;return f(n)?n.trianglesLength:0}},geometryByteLength:{get:function(){var n=this._modelInstanceCollection._model;return f(n)?n.geometryByteLength:0}},texturesByteLength:{get:function(){var n=this._modelInstanceCollection._model;return f(n)?n.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var ot=Uint32Array.BYTES_PER_ELEMENT,st=new Array(4),ht=new Array(4);return et.prototype.hasProperty=function(n,t){return this._batchTable.hasProperty(n,t)},et.prototype.getFeature=function(n){var t=this.featuresLength;if(!f(n)||n<0||n>=t)throw new h("batchId is required and between zero and featuresLength - 1 ("+(t-1)+").");return at(this),this._features[n]},et.prototype.applyDebugSettings=function(n,t){t=n?t:i.WHITE;this._batchTable.setAllColor(t)},et.prototype.applyStyle=function(n){this._batchTable.applyStyle(n)},et.prototype.update=function(n,t){var u=t.commandList.length,i,r,e;this._batchTable.update(n,t);this._modelInstanceCollection.modelMatrix=this._tile.computedTransform;this._modelInstanceCollection.shadows=this._tileset.shadows;this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe;i=this._modelInstanceCollection._model;f(i)&&(r=this._tileset.clippingPlanes,this._tile.clippingPlanesDirty&&f(r)&&(i.clippingPlaneOffsetMatrix=this._tileset.clippingPlaneOffsetMatrix,i._clippingPlanes=r.enabled&&this._tile._isClipped?r:undefined),f(r)&&f(i._clippingPlanes)&&i._clippingPlanes!==r&&(i._clippingPlanes=r));this._modelInstanceCollection.update(t);e=t.commandList.length;u<e&&(t.passes.render||t.passes.pick)&&this._batchTable.addDerivedCommands(t,u,!1)},et.prototype.isDestroyed=function(){return!1},et.prototype.destroy=function(){return this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),s(this)},et});t("Scene/Cesium3DTileRefine",["../Core/freezeObject"],function(n){"use strict";return n({ADD:0,REPLACE:1})});t("Scene/PointCloud",["../Core/arraySlice","../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/Math","../Core/Check","../Core/Color","../Core/combine","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/FeatureDetection","../Core/getStringFromTypedArray","../Core/Matrix4","../Core/oneTimeWarning","../Core/OrthographicFrustum","../Core/Plane","../Core/PrimitiveType","../Core/RuntimeError","../Core/Transforms","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../ThirdParty/when","./BlendingState","./Cesium3DTileBatchTable","./Cesium3DTileFeature","./Cesium3DTileFeatureTable","./DracoLoader","./getClipAndStyleCode","./getClippingFunction","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt){"use strict";function ni(n){f.typeOf.object("options",n);f.typeOf.object("options.arrayBuffer",n.arrayBuffer);this._parsedContent=undefined;this._drawCommand=undefined;this._isTranslucent=!1;this._styleTranslucent=!1;this._constantColor=e.clone(e.DARKGRAY);this._highlightColor=e.clone(e.WHITE);this._pointSize=1;this._rtcCenter=undefined;this._quantizedVolumeScale=undefined;this._quantizedVolumeOffset=undefined;this._styleableShaderAttributes=undefined;this._isQuantized=!1;this._isOctEncoded16P=!1;this._isRGB565=!1;this._hasColors=!1;this._hasNormals=!1;this._hasBatchIds=!1;this._decodingState=dt.READY;this._dequantizeInShader=!0;this._isQuantizedDraco=!1;this._isOctEncodedDraco=!1;this._quantizedRange=0;this._octEncodedRange=0;this.backFaceCulling=!1;this._backFaceCulling=!1;this.normalShading=!0;this._normalShading=!0;this._opaqueRenderState=undefined;this._translucentRenderState=undefined;this._mode=undefined;this._ready=!1;this._readyPromise=ht.defer();this._pointsLength=0;this._geometryByteLength=0;this._vertexShaderLoaded=n.vertexShaderLoaded;this._fragmentShaderLoaded=n.fragmentShaderLoaded;this._uniformMapLoaded=n.uniformMapLoaded;this._batchTableLoaded=n.batchTableLoaded;this._pickIdLoaded=n.pickIdLoaded;this._opaquePass=h(n.opaquePass,ut.OPAQUE);this._cull=h(n.cull,!0);this.style=undefined;this._style=undefined;this.styleDirty=!1;this.modelMatrix=p.clone(p.IDENTITY);this._modelMatrix=p.clone(p.IDENTITY);this.time=0;this.shadows=kt.ENABLED;this._boundingSphere=undefined;this.clippingPlanes=undefined;this.isClipped=!1;this.clippingPlanesDirty=!1;this.clippingPlaneOffsetMatrix=undefined;this.attenuation=!1;this._attenuation=!1;this.geometricError=0;this.geometricErrorScale=1;this.maximumAttenuation=this._pointSize;yi(this,n)}function yi(t,r){var rt=r.arrayBuffer,u=h(r.byteOffset,0),ei=new Uint8Array(rt),k=new DataView(rt),ct,ut,at,ft,et,oi,l,yt,p,v,si,f,d,pt,ht,ii,yi,ri,ui,it,fi,pi;if(u+=gt,ct=k.getUint32(u,!0),ct!==1)throw new g("Only Point Cloud tile version 1 is supported.  Version "+ct+" is not.");if(u+=gt,u+=gt,ut=k.getUint32(u,!0),ut===0)throw new g("Feature table must have a byte length greater than zero");if(u+=gt,at=k.getUint32(u,!0),u+=gt,ft=k.getUint32(u,!0),u+=gt,et=k.getUint32(u,!0),u+=gt,oi=y(ei,u,ut),l=JSON.parse(oi),u+=ut,yt=new Uint8Array(rt,u,at),u+=at,ft>0&&(si=y(ei,u,ft),p=JSON.parse(si),u+=ft,et>0&&(v=new Uint8Array(rt,u,et),u+=et)),f=new vt(l,yt),d=f.getGlobalProperty("POINTS_LENGTH"),f.featuresLength=d,!c(d))throw new g("Feature table global property: POINTS_LENGTH must be defined");pt=f.getGlobalProperty("RTC_CENTER",s.FLOAT,3);c(pt)&&(t._rtcCenter=i.unpack(pt));var wt,ot,bt,hi,nt=!1,w=!1,tt=!1,b=!1,ci=!1,kt=!1,li=!1,ai=!1,ni,a,ti,st=c(l.extensions)?l.extensions["3DTILES_draco_point_compression"]:undefined,vi=c(p)&&c(p.extensions)?p.extensions["3DTILES_draco_point_compression"]:undefined;if(c(vi)&&(ti=vi.properties),c(st)){if(a=st.properties,ht=st.byteOffset,ii=st.byteLength,!c(a)||!c(ht)||!c(ii))throw new g("Draco properties, byteOffset, and byteLength must be defined");ni=n(yt,ht,ht+ii);nt=c(a.POSITION);w=c(a.RGB)||c(a.RGBA);tt=c(a.NORMAL);b=c(a.BATCH_ID);kt=c(a.RGBA);t._decodingState=dt.NEEDS_DECODE}if(c(ni)&&(yi={buffer:ni,featureTableProperties:a,batchTableProperties:ti,properties:o(a,ti),dequantizeInShader:t._dequantizeInShader}),!nt)if(c(l.POSITION))wt=f.getPropertyArray("POSITION",s.FLOAT,3),nt=!0;else if(c(l.POSITION_QUANTIZED)){if(wt=f.getPropertyArray("POSITION_QUANTIZED",s.UNSIGNED_SHORT,3),ci=!0,nt=!0,ri=f.getGlobalProperty("QUANTIZED_VOLUME_SCALE",s.FLOAT,3),!c(ri))throw new g("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t._quantizedVolumeScale=i.unpack(ri),t._quantizedRange=65535,ui=f.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",s.FLOAT,3),!c(ui))throw new g("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t._quantizedVolumeOffset=i.unpack(ui)}if(w||(c(l.RGBA)?(ot=f.getPropertyArray("RGBA",s.UNSIGNED_BYTE,4),kt=!0,w=!0):c(l.RGB)?(ot=f.getPropertyArray("RGB",s.UNSIGNED_BYTE,3),w=!0):c(l.RGB565)&&(ot=f.getPropertyArray("RGB565",s.UNSIGNED_SHORT,1),li=!0,w=!0)),tt||(c(l.NORMAL)?(bt=f.getPropertyArray("NORMAL",s.FLOAT,3),tt=!0):c(l.NORMAL_OCT16P)&&(bt=f.getPropertyArray("NORMAL_OCT16P",s.UNSIGNED_BYTE,2),ai=!0,tt=!0)),b||c(l.BATCH_ID)&&(hi=f.getPropertyArray("BATCH_ID",s.UNSIGNED_SHORT,1),b=!0),!nt)throw new g("Either POSITION or POSITION_QUANTIZED must be defined.");if(c(l.CONSTANT_RGBA)&&(it=f.getGlobalProperty("CONSTANT_RGBA",s.UNSIGNED_BYTE,4),t._constantColor=e.fromBytes(it[0],it[1],it[2],it[3],t._constantColor)),b){if(fi=f.getGlobalProperty("BATCH_LENGTH"),!c(fi))throw new g("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");c(v)&&(v=new Uint8Array(v));c(t._batchTableLoaded)&&t._batchTableLoaded(fi,p,v)}!b&&c(v)&&(pi=lt.getBinaryProperties(d,p,v));t._parsedContent={positions:wt,colors:ot,normals:bt,batchIds:hi,styleableProperties:pi,draco:yi};t._pointsLength=d;t._isQuantized=ci;t._isOctEncoded16P=ai;t._isRGB565=li;t._isTranslucent=kt;t._hasColors=w;t._hasNormals=tt;t._hasBatchIds=b}function ki(n){if(!c(ti)){u.setRandomNumberSeed(0);ti=new Array(n);for(var t=0;t<n;++t)ti[t]=u.nextRandomNumber()}return ti}function di(n){for(var v,h,c,l=20,a=n.length/3,y=Math.min(a,l),p=ki(l),r=Number.MAX_VALUE,f=-Number.MAX_VALUE,e=i.fromElements(r,r,r,pi),o=i.fromElements(f,f,f,wi),s=0;s<y;++s)v=Math.floor(p[s]*a),h=i.unpack(n,v*3,bi),i.minimumByComponent(e,h,e),i.maximumByComponent(o,h,o);return c=t.fromCornerPoints(e,o),c.radius+=u.EPSILON2,c}function hi(n){var t=s.fromTypedArray(n);return t===s.INT||t===s.UNSIGNED_INT||t===s.DOUBLE?(w("Cast pnts property to floats",'Point cloud property "'+name+'" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.'),new Float32Array(n)):n}function rr(n,r){var o=r.context,h=n._parsedContent,ri=n._pointsLength,lt=h.positions,fi=h.colors,ei=h.normals,l=h.batchIds,a=h.styleableProperties,at=c(a),vt=n._isQuantized,yt=n._isQuantizedDraco,oi=n._isOctEncoded16P,si=n._isOctEncodedDraco,ai=n._quantizedRange,vi=n._octEncodedRange,yi=n._isRGB565,b=n._isTranslucent,pt=n._hasColors,wt=n._hasNormals,bt=n._hasBatchIds,e,f,kt=[],dt={},v,y,k,g,nt,gt,et,w,ot,ht,u,ni,ti;if(n._styleableShaderAttributes=dt,at){v=ir;for(y in a)a.hasOwnProperty(y)&&(k=a[y],g=hi(k.typedArray),e=k.componentCount,f=s.fromTypedArray(g),nt=tt.createVertexBuffer({context:o,typedArray:g,usage:it.STATIC_DRAW}),n._geometryByteLength+=nt.sizeInBytes,gt={index:v,vertexBuffer:nt,componentsPerAttribute:e,componentDatatype:f,normalize:!1,offsetInBytes:0,strideInBytes:0},kt.push(gt),dt[y]={location:v,componentCount:e},++v)}et=tt.createVertexBuffer({context:o,typedArray:lt,usage:it.STATIC_DRAW});n._geometryByteLength+=et.sizeInBytes;pt&&(w=tt.createVertexBuffer({context:o,typedArray:fi,usage:it.STATIC_DRAW}),n._geometryByteLength+=w.sizeInBytes);wt&&(ot=tt.createVertexBuffer({context:o,typedArray:ei,usage:it.STATIC_DRAW}),n._geometryByteLength+=ot.sizeInBytes);bt&&(l=hi(l),ht=tt.createVertexBuffer({context:o,typedArray:l,usage:it.STATIC_DRAW}),n._geometryByteLength+=ht.sizeInBytes);u=[];f=vt?s.UNSIGNED_SHORT:yt?ai<=255?s.UNSIGNED_BYTE:s.UNSIGNED_SHORT:s.FLOAT;u.push({index:ci,vertexBuffer:et,componentsPerAttribute:3,componentDatatype:f,normalize:!1,offsetInBytes:0,strideInBytes:0});n._cull&&(n._boundingSphere=vt||yt?t.fromCornerPoints(i.ZERO,n._quantizedVolumeScale):di(lt));pt&&(yi?u.push({index:ii,vertexBuffer:w,componentsPerAttribute:1,componentDatatype:s.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0}):(ni=b?4:3,u.push({index:ii,vertexBuffer:w,componentsPerAttribute:ni,componentDatatype:s.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0})));wt&&(oi?(e=2,f=s.UNSIGNED_BYTE):si?(e=2,f=vi<=255?s.UNSIGNED_BYTE:s.UNSIGNED_SHORT):(e=3,f=s.FLOAT),u.push({index:ui,vertexBuffer:ot,componentsPerAttribute:e,componentDatatype:f,normalize:!1,offsetInBytes:0,strideInBytes:0}));bt&&u.push({index:li,vertexBuffer:ht,componentsPerAttribute:1,componentDatatype:s.fromTypedArray(l),normalize:!1,offsetInBytes:0,strideInBytes:0});at&&(u=u.concat(kt));ti=new st({context:o,attributes:u});n._opaqueRenderState=ft.fromCache({depthTest:{enabled:!0}});n._translucentRenderState=ft.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:ct.ALPHA_BLEND});n._drawCommand=new rt({boundingVolume:new t,cull:n._cull,modelMatrix:new p,primitiveType:d.POINTS,vertexArray:ti,count:ri,shaderProgram:undefined,uniformMap:undefined,renderState:b?n._translucentRenderState:n._opaqueRenderState,pass:b?ut.TRANSLUCENT:n._opaquePass,owner:n,castShadows:!1,receiveShadows:!1,pickId:n._pickIdLoaded()})}function ur(n,t){var u=t.context,f=n._isQuantized,s=n._isQuantizedDraco,l=n._isOctEncodedDraco,r={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){var i=gi,r,f;return i.x=n._attenuation?n.maximumAttenuation:n._pointSize,i.y=n.time,n._attenuation&&(r=t.camera.frustum,f=t.mode===bt.SCENE2D||r instanceof b?Number.POSITIVE_INFINITY:u.drawingBufferHeight/t.camera.frustum.sseDenominator,i.z=n.geometricError*n.geometricErrorScale,i.w=f),i},u_highlightColor:function(){return n._highlightColor},u_constantColor:function(){return n._constantColor},u_clippingPlanes:function(){var t=n.clippingPlanes,i=n.isClipped;return i?t.texture:u.defaultTexture},u_clippingPlanesEdgeStyle:function(){var t=n.clippingPlanes,i;return c(t)?(i=e.clone(t.edgeColor,tr),i.alpha=t.edgeWidth,i):e.TRANSPARENT},u_clippingPlanesMatrix:function(){var t=n.clippingPlanes,i;return c(t)?(i=h(n.clippingPlaneOffsetMatrix,n._modelMatrix),p.multiply(u.uniformState.view3D,i,fi),p.multiply(fi,t.modelMatrix,fi)):p.IDENTITY}};(f||s||l)&&(r=o(r,{u_quantizedVolumeScaleAndOctEncodedRange:function(){var t=nr,r;return c(n._quantizedVolumeScale)&&(r=i.clone(n._quantizedVolumeScale,t),i.divideByScalar(r,n._quantizedRange,t)),t.w=n._octEncodedRange,t}}));c(n._uniformMapLoaded)&&(r=n._uniformMapLoaded(r));n._drawCommand.uniformMap=r}function ei(n,t){for(var u=/czm_tiles3d_style_(\w+)/g,i=u.exec(n),r;i!==null;)r=i[1],t.indexOf(r)===-1&&t.push(r),i=u.exec(n)}function oi(n,t){for(var r,u=n.numberOfAttributes,i=0;i<u;++i)if(r=n.getAttribute(i),r.index===t)return r}function si(n){for(var r=ri.length,t=0;t<r;++t){var i=ri[t],u="czm_tiles3d_style_"+i,f=i.toLowerCase();n=n.replace(new RegExp(u+"(\\W)","g"),f+"$1")}return n.replace("()","(vec3 position, vec3 position_absolute, vec4 color, vec3 normal)")}function fr(n,t,i){var k,f,s,at=t.context,di=c(i),vt=n._isQuantized,yt=n._isQuantizedDraco,bt=n._isOctEncoded16P,tt=n._isOctEncodedDraco,kt=n._isRGB565,it=n._isTranslucent,dt=n._hasColors,rt=n._hasNormals,gt=n._hasBatchIds,ni=n._backFaceCulling,ti=n._normalShading,ut=n._drawCommand.vertexArray,gi=n.clippingPlanes,ft=n._attenuation,e,h,l,fi=it,y,p,vi,yi,w,pi,o,wi,v,ht,bi,ct,lt,ki,r,u,b;di&&(y={translucent:!1},e=i.getColorShaderFunction("getColorFromStyle","czm_tiles3d_style_",y),h=i.getShowShaderFunction("getShowFromStyle","czm_tiles3d_style_",y),l=i.getPointSizeShaderFunction("getPointSizeFromStyle","czm_tiles3d_style_",y),c(e)&&y.translucent&&(fi=!0));n._styleTranslucent=fi;var d=c(e),nt=c(h),ot=c(l),hi=n.isClipped,a=[];d&&(ei(e,a),e=si(e));nt&&(ei(h,a),h=si(h));ot&&(ei(l,a),l=si(l));var nr=a.indexOf("COLOR")>=0,ai=a.indexOf("NORMAL")>=0,st=a.filter(function(n){return ri.indexOf(n)===-1});if(ai&&!rt)throw new g("Style references the NORMAL semantic but the point cloud does not have normals");p=n._styleableShaderAttributes;for(f in p)p.hasOwnProperty(f)&&(s=p[f],vi=st.indexOf(f)>=0,yi=oi(ut,s.location),yi.enabled=vi);for(w=dt&&(!d||nr),dt&&(pi=oi(ut,ii),pi.enabled=w),o=rt&&(ti||ni||ai),rt&&(wi=oi(ut,ui),wi.enabled=o),v={a_position:ci},w&&(v.a_color=ii),o&&(v.a_normal=ui),gt&&(v.a_batchId=li),ht="",bi=st.length,k=0;k<bi;++k){if(f=st[k],s=p[f],!c(s))throw new g('Style references a property "'+f+'" that does not exist or is not styleable.');ct=s.componentCount;lt="czm_tiles3d_style_"+f;ki=ct===1?"float":"vec"+ct;ht+="attribute "+ki+" "+lt+"; \n";v[lt]=s.location}ur(n,t);r="attribute vec3 a_position; \nvarying vec4 v_color; \nuniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; \nuniform vec4 u_constantColor; \nuniform vec4 u_highlightColor; \n";r+="float u_pointSize; \nfloat u_time; \n";ft&&(r+="float u_geometricError; \nfloat u_depthMultiplier; \n");r+=ht;w&&(r+=it?"attribute vec4 a_color; \n":kt?"attribute float a_color; \nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0; \nconst float SHIFT_RIGHT_5 = 1.0 / 32.0; \nconst float SHIFT_LEFT_11 = 2048.0; \nconst float SHIFT_LEFT_5 = 32.0; \nconst float NORMALIZE_6 = 1.0 / 64.0; \nconst float NORMALIZE_5 = 1.0 / 32.0; \n":"attribute vec3 a_color; \n");o&&(r+=bt||tt?"attribute vec2 a_normal; \n":"attribute vec3 a_normal; \n");gt&&(r+="attribute float a_batchId; \n");(vt||yt||tt)&&(r+="uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; \n");d&&(r+=e);nt&&(r+=h);ot&&(r+=l);r+="void main() \n{ \n    u_pointSize = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; \n    u_time = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; \n";ft&&(r+="    u_geometricError = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; \n    u_depthMultiplier = u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; \n");r+=w?it?"    vec4 color = a_color; \n":kt?"    float compressed = a_color; \n    float r = floor(compressed * SHIFT_RIGHT_11); \n    compressed -= r * SHIFT_LEFT_11; \n    float g = floor(compressed * SHIFT_RIGHT_5); \n    compressed -= g * SHIFT_LEFT_5; \n    float b = compressed; \n    vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); \n    vec4 color = vec4(rgb, 1.0); \n":"    vec4 color = vec4(a_color, 1.0); \n":"    vec4 color = u_constantColor; \n";r+=vt||yt?"    vec3 position = a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; \n":"    vec3 position = a_position; \n";r+="    vec3 position_absolute = vec3(czm_model * vec4(position, 1.0)); \n";r+=o?bt?"    vec3 normal = czm_octDecode(a_normal); \n":tt?"    vec3 normal = czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; \n":"    vec3 normal = a_normal; \n":"    vec3 normal = vec3(1.0); \n";d&&(r+="    color = getColorFromStyle(position, position_absolute, color, normal); \n");nt&&(r+="    float show = float(getShowFromStyle(position, position_absolute, color, normal)); \n");r+=ot?"    gl_PointSize = getPointSizeFromStyle(position, position_absolute, color, normal); \n":ft?"    vec4 positionEC = czm_modelView * vec4(position, 1.0); \n    float depth = -positionEC.z; \n    gl_PointSize = min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); \n":"    gl_PointSize = u_pointSize; \n";r+="    color = color * u_highlightColor; \n";o&&ti&&(r+="    normal = czm_normal * normal; \n    float diffuseStrength = czm_getLambertDiffuse(czm_sunDirectionEC, normal); \n    diffuseStrength = max(diffuseStrength, 0.4); \n    color.xyz *= diffuseStrength; \n");r+="    v_color = color; \n    gl_Position = czm_modelViewProjection * vec4(position, 1.0); \n";o&&ni&&(r+="    float visible = step(-normal.z, 0.0); \n    gl_Position *= visible; \n    gl_PointSize *= visible; \n");nt&&(r+="    gl_Position *= show; \n    gl_PointSize *= show; \n");r+="} \n";u="varying vec4 v_color; \n";hi&&(u+="uniform sampler2D u_clippingPlanes; \nuniform mat4 u_clippingPlanesMatrix; \nuniform vec4 u_clippingPlanesEdgeStyle; \n",u+="\n",u+=wt(gi,at),u+="\n");u+="void main() \n{ \n    gl_FragColor = v_color; \n";hi&&(u+=pt("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle"));u+="} \n";c(n._vertexShaderLoaded)&&(r=n._vertexShaderLoaded(r));c(n._fragmentShaderLoaded)&&(u=n._fragmentShaderLoaded(u));b=n._drawCommand;c(b.shaderProgram)&&b.shaderProgram.destroy();b.shaderProgram=et.fromCache({context:at,vertexShaderSource:r,fragmentShaderSource:u,attributeLocations:v});try{b.shaderProgram._bind()}catch(tr){throw new g("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.");}}function er(n,t){if(n._decodingState===dt.READY)return!1;if(n._decodingState===dt.NEEDS_DECODE){var r=n._parsedContent,u=r.draco,f=yt.decodePointCloud(u,t);c(f)&&(n._decodingState=dt.DECODING,f.then(function(t){var e,o,f,l,s,a;n._decodingState=dt.READY;var v=c(t.POSITION)?t.POSITION.array:undefined,p=c(t.RGB)?t.RGB.array:undefined,w=c(t.RGBA)?t.RGBA.array:undefined,y=c(t.NORMAL)?t.NORMAL.array:undefined,b=c(t.BATCH_ID)?t.BATCH_ID.array:undefined,k=c(v)&&c(t.POSITION.data.quantization),d=c(y)&&c(t.NORMAL.data.quantization);k&&(e=t.POSITION.data.quantization,o=e.range,n._quantizedVolumeScale=i.fromElements(o,o,o),n._quantizedVolumeOffset=i.unpack(e.minValues),n._quantizedRange=(1<<e.quantizationBits)-1,n._isQuantizedDraco=!0);d&&(n._octEncodedRange=(1<<t.NORMAL.data.quantization.quantizationBits)-1,n._isOctEncodedDraco=!0);f=r.styleableProperties;l=u.batchTableProperties;for(s in l)l.hasOwnProperty(s)&&(a=t[s],c(f)||(f={}),f[s]={typedArray:a.array,componentCount:a.data.componentsPerAttribute});r.positions=h(v,r.positions);r.colors=h(h(w,p),r.colors);r.normals=h(y,r.normals);r.batchIds=h(b,r.batchIds);r.styleableProperties=f}).otherwise(function(t){n._decodingState=dt.FAILED;n._readyPromise.reject(t)}))}return!0}var dt,gt,ri,ai,vi;if(!v.supportsTypedArrays())return{};dt={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};l(ni.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return e.clone(this._highlightColor)},set:function(n){this._highlightColor=e.clone(n,this._highlightColor)}},boundingSphere:{get:function(){if(c(this._drawCommand))return this._drawCommand.boundingVolume},set:function(n){this._boundingSphere=t.clone(n)}}});gt=Uint32Array.BYTES_PER_ELEMENT;var pi=new i,wi=new i,bi=new i,ti;var gi=new r,nr=new r,tr=new e,ci=0,ii=1,ui=2,li=3,ir=4,fi=new p;return ri=["POSITION","COLOR","NORMAL","POSITION_ABSOLUTE"],ai=new r,vi=new i,ni.prototype.update=function(n){var b=n.context,k=er(this,b),f,e,u,a,v,o,s,y,h,w,l;k||(f=!1,e=!p.equals(this._modelMatrix,this.modelMatrix),this._mode!==n.mode&&(this._mode=n.mode,e=!0),c(this._drawCommand)||(rr(this,n),e=!0,f=!0,this._ready=!0,this._readyPromise.resolve(this),this._parsedContent=undefined),e&&(p.clone(this.modelMatrix,this._modelMatrix),u=this._drawCommand.modelMatrix,p.clone(this._modelMatrix,u),c(this._rtcCenter)&&p.multiplyByTranslation(u,this._rtcCenter,u),c(this._quantizedVolumeOffset)&&p.multiplyByTranslation(u,this._quantizedVolumeOffset,u),n.mode!==bt.SCENE3D&&(a=n.mapProjection,v=p.getColumn(u,3,ai),r.equals(v,r.UNIT_W)||nt.basisTo2D(a,u,u)),o=this._drawCommand.boundingVolume,t.clone(this._boundingSphere,o),this._cull&&(s=o.center,p.multiplyByPoint(u,s,s),y=p.getScale(u,vi),o.radius*=i.maximumComponent(y))),this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,f=!0),this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,f=!0),this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,f=!0),this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,f=!0),(this._style!==this.style||this.styleDirty)&&(this._style=this.style,this.styleDirty=!1,f=!0),f&&fr(this,n,this._style),this._drawCommand.castShadows=kt.castShadows(this.shadows),this._drawCommand.receiveShadows=kt.receiveShadows(this.shadows),h=this._highlightColor.alpha<1||this._constantColor.alpha<1||this._styleTranslucent,this._drawCommand.renderState=h?this._translucentRenderState:this._opaqueRenderState,this._drawCommand.pass=h?ut.TRANSLUCENT:this._opaquePass,w=n.commandList,l=n.passes,(l.render||l.pick)&&w.push(this._drawCommand))},ni.prototype.isDestroyed=function(){return!1},ni.prototype.destroy=function(){var n=this._drawCommand;return c(n)&&(n.vertexArray=n.vertexArray&&n.vertexArray.destroy(),n.shaderProgram=n.shaderProgram&&n.shaderProgram.destroy()),a(this)},ni});t("Scene/PointCloud3DTileContent",["../Core/Color","../Core/combine","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/FeatureDetection","../Core/Math","../Renderer/Pass","../Renderer/ShaderSource","./Cesium3DTileBatchTable","./Cesium3DTileFeature","./Cesium3DTileRefine","./PointCloud","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function w(n,t,i,r,u){this._tileset=n;this._tile=t;this._resource=i;this._pickId=undefined;this._batchTable=undefined;this._styleDirty=!1;this._features=undefined;this.featurePropertiesDirty=!1;this._pointCloud=new y({arrayBuffer:r,byteOffset:u,cull:!1,opaquePass:h.CESIUM_3D_TILE,vertexShaderLoaded:b(this),fragmentShaderLoaded:k(this),uniformMapLoaded:d(this),batchTableLoaded:g(this),pickIdLoaded:nt(this)})}function b(n){return function(t){return r(n._batchTable)?n._batchTable.getVertexShaderCallback(!1,"a_batchId",undefined)(t):t}}function k(n){return function(t){return r(n._batchTable)?n._batchTable.getFragmentShaderCallback(!1,undefined)(t):"uniform vec4 czm_pickColor;\n"+t}}function d(n){return function(i){return r(n._batchTable)?n._batchTable.getUniformMapCallback()(i):t(i,{czm_pickColor:function(){return n._pickId.color}})}}function g(n){return function(t,i,r){n._batchTable=new l(n,t,i,r)}}function nt(n){return function(){return r(n._batchTable)?n._batchTable.getPickId():"czm_pickColor"}}function tt(n){var t=n._tileset.pointCloudShading,u=n._tile.contentBoundingVolume.boundingSphere.volume(),f=s.cbrt(u/n.pointsLength),i=n._tile.geometricError;return i===0&&(i=r(t)&&r(t.baseResolution)?t.baseResolution:f),i}function it(n){var i=n.featuresLength,u,t;if(!r(n._features)&&i>0){for(u=new Array(i),t=0;t<i;++t)u[t]=new a(n,t);n._features=u}}return u(w.prototype,{featuresLength:{get:function(){return r(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return r(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}}),w.prototype.hasProperty=function(n,t){return r(this._batchTable)?this._batchTable.hasProperty(n,t):!1},w.prototype.getFeature=function(n){if(!r(this._batchTable))return undefined;var t=this.featuresLength;if(!r(n)||n<0||n>=t)throw new e("batchId is required and between zero and featuresLength - 1 ("+(t-1)+").");return it(this),this._features[n]},w.prototype.applyDebugSettings=function(t,i){this._pointCloud.color=t?i:n.WHITE},w.prototype.applyStyle=function(n){r(this._batchTable)?this._batchTable.applyStyle(n):this._styleDirty=!0},w.prototype.update=function(n,t){var i=this._pointCloud,f=n.pointCloudShading,u=this._tile,e=this._batchTable,s=t.mode,o=n.clippingPlanes,h,c;r(this._pickId)||r(e)||(this._pickId=t.context.createPickId({primitive:n,content:this}));r(e)&&e.update(n,t);h=r(u._contentBoundingVolume)?s===p.SCENE3D?u._contentBoundingVolume.boundingSphere:u._contentBoundingVolume2D.boundingSphere:s===p.SCENE3D?u._boundingVolume.boundingSphere:u._boundingVolume2D.boundingSphere;c=this._styleDirty;this._styleDirty=!1;i.clippingPlaneOffsetMatrix=n.clippingPlaneOffsetMatrix;i.style=r(e)?undefined:n.style;i.styleDirty=c;i.modelMatrix=u.computedTransform;i.time=n.timeSinceLoad;i.shadows=n.shadows;i.boundingSphere=h;i.clippingPlanes=o;i.isClipped=r(o)&&o.enabled&&u._isClipped;i.clippingPlanesDirty=u.clippingPlanesDirty;i.attenuation=r(f)?f.attenuation:!1;i.geometricError=tt(this);i.geometricErrorScale=r(f)?f.geometricErrorScale:1;i.maximumAttenuation=r(f)&&r(f.maximumAttenuation)?f.maximumAttenuation:u.refine===v.ADD?5:n.maximumScreenSpaceError;i.update(t)},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){return this._pickId=this._pickId&&this._pickId.destroy(),this._pointCloud=this._pointCloud&&this._pointCloud.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),f(this)},w});t("Scene/Tileset3DTileContent",["../Core/defaultValue","../Core/defineProperties","../Core/destroyObject","../Core/getStringFromTypedArray","../Core/RuntimeError","../ThirdParty/when"],function(n,t,i,r,u,f){"use strict";function e(n,t,i,r,u){this._tileset=n;this._tile=t;this._resource=i;this._readyPromise=f.defer();this.featurePropertiesDirty=!1;o(this,r,u)}function o(t,i,f){f=n(f,0);var o=new Uint8Array(i),s=r(o,f),e;try{e=JSON.parse(s)}catch(h){t._readyPromise.reject(new u("Invalid tile content."));return}t._tileset.loadTileset(t._resource,e,t._tile);t._readyPromise.resolve(t)}return t(e.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return undefined}}}),e.prototype.hasProperty=function(){return!1},e.prototype.getFeature=function(){return undefined},e.prototype.applyDebugSettings=function(){},e.prototype.applyStyle=function(){},e.prototype.update=function(){},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return i(this)},e});t("Scene/Cesium3DTilePointFeature",["../Core/Cartographic","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","./createBillboardPointCallback"],function(n,t,i,r,u,f){"use strict";function e(n,t,i,r,u){this._content=n;this._billboard=i;this._label=r;this._polyline=u;this._batchId=t;this._billboardImage=undefined;this._billboardColor=undefined;this._billboardOutlineColor=undefined;this._billboardOutlineWidth=undefined;this._billboardSize=undefined;this._pointSize=undefined;this._color=undefined;this._pointSize=undefined;this._pointOutlineColor=undefined;this._pointOutlineWidth=undefined;this._heightOffset=undefined;this._pickIds=new Array(3);o(this)}function o(n){var h=n._billboard;if(r(n._billboardImage)&&n._billboardImage!==h.image){h.image=n._billboardImage;return}if(!r(n._billboardImage)){var u=i(n._color,e.defaultColor),c=i(n._pointOutlineColor,e.defaultPointOutlineColor),o=i(n._pointOutlineWidth,e.defaultPointOutlineWidth),s=i(n._pointSize,e.defaultPointSize),v=n._billboardColor,y=n._billboardOutlineColor,p=n._billboardOutlineWidth,w=n._billboardSize;if(!t.equals(u,v)||!t.equals(c,y)||o!==p||s!==w){n._billboardColor=t.clone(u,n._billboardColor);n._billboardOutlineColor=t.clone(c,n._billboardOutlineColor);n._billboardOutlineWidth=o;n._billboardSize=s;var b=u.alpha,l=u.toCssColorString(),a=c.toCssColorString(),k=JSON.stringify([l,s,a,o]);h.setImage(k,f(b,l,a,o,s))}}}var s=new n;return u(e.prototype,{show:{get:function(){return this._label.show},set:function(n){this._label.show=n;this._billboard.show=n;this._polyline.show=n}},color:{get:function(){return this._color},set:function(n){this._color=t.clone(n,this._color);o(this)}},pointSize:{get:function(){return this._pointSize},set:function(n){this._pointSize=n;o(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(n){this._pointOutlineColor=t.clone(n,this._pointOutlineColor);o(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(n){this._pointOutlineWidth=n;o(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(n){this._label.fillColor=n;this._polyline.show=this._label.show&&n.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(n){this._label.outlineColor=n}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(n){this._label.outlineWidth=n}},font:{get:function(){return this._label.font},set:function(n){this._label.font=n}},labelStyle:{get:function(){return this._label.style},set:function(n){this._label.style=n}},labelText:{get:function(){return this._label.text},set:function(n){r(n)||(n="");this._label.text=n}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(n){this._label.backgroundColor=n}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(n){this._label.backgroundPadding=n}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(n){this._label.showBackground=n}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(n){this._label.scaleByDistance=n;this._billboard.scaleByDistance=n}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(n){this._label.translucencyByDistance=n;this._billboard.translucencyByDistance=n}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(n){this._label.distanceDisplayCondition=n;this._polyline.distanceDisplayCondition=n;this._billboard.distanceDisplayCondition=n}},heightOffset:{get:function(){return this._heightOffset},set:function(n){var f=i(this._heightOffset,0),u=this._content.tileset.ellipsoid,t=u.cartesianToCartographic(this._billboard.position,s),r;t.height=t.height-f+n;r=u.cartographicToCartesian(t);this._billboard.position=r;this._label.position=this._billboard.position;this._polyline.positions=[this._polyline.positions[0],r];this._heightOffset=n}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(n){this._polyline.show=n}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(n){this._polyline.material.uniforms.color=n}},image:{get:function(){return this._billboardImage},set:function(n){var t=this._billboardImage!==n;this._billboardImage=n;t&&o(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(n){this._label.disableDepthTestDistance=n;this._billboard.disableDepthTestDistance=n}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(n){this._billboard.horizontalOrigin=n}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(n){this._billboard.verticalOrigin=n}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(n){this._label.horizontalOrigin=n}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(n){this._label.verticalOrigin=n}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){var n=this._pickIds;return n[0]=this._billboard.pickId,n[1]=this._label.pickId,n[2]=this._polyline.pickId,n}}}),e.defaultColor=t.WHITE,e.defaultPointOutlineColor=t.BLACK,e.defaultPointOutlineWidth=0,e.defaultPointSize=8,e.prototype.hasProperty=function(n){return this._content.batchTable.hasProperty(this._batchId,n)},e.prototype.getPropertyNames=function(n){return this._content.batchTable.getPropertyNames(this._batchId,n)},e.prototype.getProperty=function(n){return this._content.batchTable.getProperty(this._batchId,n)},e.prototype.setProperty=function(n,t){this._content.batchTable.setProperty(this._batchId,n,t);this._content.featurePropertiesDirty=!0},e.prototype.isExactClass=function(n){return this._content.batchTable.isExactClass(this._batchId,n)},e.prototype.isClass=function(n){return this._content.batchTable.isClass(this._batchId,n)},e.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)},e});t("Scene/Vector3DTilePoints",["../Core/arraySlice","../Core/Cartesian2","../Core/Cartesian3","../Core/Color","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DistanceDisplayCondition","../Core/Ellipsoid","../Core/NearFarScalar","../Core/Rectangle","../Core/TaskProcessor","../ThirdParty/when","./BillboardCollection","./Cesium3DTilePointFeature","./HorizontalOrigin","./LabelCollection","./LabelStyle","./PolylineCollection","./VerticalOrigin"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function g(n){this._positions=n.positions;this._batchTable=n.batchTable;this._batchIds=n.batchIds;this._rectangle=n.rectangle;this._minHeight=n.minimumHeight;this._maxHeight=n.maximumHeight;this._billboardCollection=undefined;this._labelCollection=undefined;this._polylineCollection=undefined;this._verticesPromise=undefined;this._packedBuffer=undefined;this._ready=!1;this._readyPromise=a.defer();this._resolvedPromise=!1}function ft(n,t){var u=n._rectangle,f=n._minHeight,e=n._maxHeight,o=2+c.packedLength+s.packedLength,i=new Float64Array(o),r=0;return i[r++]=f,i[r++]=e,c.pack(u,i,r),r+=c.packedLength,s.pack(t,i,r),i}function et(t,r){var f,e,y,o,h,d;if(!u(t._billboardCollection)){if(!u(t._verticesPromise)){f=t._positions;e=t._packedBuffer;u(e)||(f=t._positions=n(f),t._batchIds=n(t._batchIds),e=t._packedBuffer=ft(t,r));var g=[f.buffer,e.buffer],nt={positions:f.buffer,packedBuffer:e.buffer},c=t._verticesPromise=rt.scheduleTask(nt,g);if(!u(c))return;c.then(function(n){t._positions=new Float64Array(n.positions);t._ready=!0})}if(t._ready&&!u(t._billboardCollection)){f=t._positions;var l=t._batchTable,tt=t._batchIds,it=t._billboardCollection=new v({batchTable:l}),et=t._labelCollection=new w({batchTable:l}),a=t._polylineCollection=new k;for(a._useHighlightColor=!0,y=f.length/3,o=0;o<y;++o){var p=tt[o],s=i.unpack(f,o*3,ut),b=it.add();b.position=s;b._batchIndex=p;h=et.add();h.text=" ";h.position=s;h._batchIndex=p;d=a.add();d.positions=[i.clone(s),i.clone(s)]}t._positions=undefined;t._packedBuffer=undefined}}}function ot(n,i){for(var o,u,e=n._batchIds,s=e.length,f=0;f<s;++f)o=e[f],u=i[o],u.show=!0,u.pointSize=y.defaultPointSize,u.color=y.defaultColor,u.pointOutlineColor=y.defaultPointOutlineColor,u.pointOutlineWidth=y.defaultPointOutlineWidth,u.labelColor=r.WHITE,u.labelOutlineColor=r.WHITE,u.labelOutlineWidth=1,u.font="30px sans-serif",u.labelStyle=b.FILL,u.labelText=undefined,u.backgroundColor=new r(.165,.165,.165,.8),u.backgroundPadding=new t(7,5),u.backgroundEnabled=!1,u.scaleByDistance=undefined,u.translucencyByDistance=undefined,u.distanceDisplayCondition=undefined,u.heightOffset=0,u.anchorLineEnabled=!1,u.anchorLineColor=r.WHITE,u.image=undefined,u.disableDepthTestDistance=0,u.horizontalOrigin=p.CENTER,u.verticalOrigin=d.CENTER,u.labelHorizontalOrigin=p.RIGHT,u.labelVerticalOrigin=d.BASELINE}var rt,ut;f(g.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){var n=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return n+t}},readyPromise:{get:function(){return this._readyPromise.promise}}});rt=new l("createVectorTilePoints");ut=new i;g.prototype.createFeatures=function(n,t){for(var f=this._billboardCollection,e=this._labelCollection,o=this._polylineCollection,r=this._batchIds,s=r.length,i=0;i<s;++i){var u=r[i],h=f.get(i),c=e.get(i),l=o.get(i);t[u]=new y(n,u,h,c,l)}};g.prototype.applyDebugSettings=function(n,t){n?(r.clone(t,this._billboardCollection._highlightColor),r.clone(t,this._labelCollection._highlightColor),r.clone(t,this._polylineCollection._highlightColor)):(r.clone(r.WHITE,this._billboardCollection._highlightColor),r.clone(r.WHITE,this._labelCollection._highlightColor),r.clone(r.WHITE,this._polylineCollection._highlightColor))};var st=new r,ht=new r,ct=new r,lt=new r,at=new r,vt=new r,nt=new h,tt=new h,it=new o;return g.prototype.applyStyle=function(n,t){var o,h,e,c,i,r,f,s;if(!u(n)){ot(this,t);return}for(o=this._batchIds,h=o.length,e=0;e<h;++e)c=o[e],i=t[c],u(n.show)&&(i.show=n.show.evaluate(i)),u(n.pointSize)&&(i.pointSize=n.pointSize.evaluate(i)),u(n.color)&&(i.color=n.color.evaluateColor(i,st)),u(n.pointOutlineColor)&&(i.pointOutlineColor=n.pointOutlineColor.evaluateColor(i,ht)),u(n.pointOutlineWidth)&&(i.pointOutlineWidth=n.pointOutlineWidth.evaluate(i)),u(n.labelColor)&&(i.labelColor=n.labelColor.evaluateColor(i,ct)),u(n.labelOutlineColor)&&(i.labelOutlineColor=n.labelOutlineColor.evaluateColor(i,lt)),u(n.labelOutlineWidth)&&(i.labelOutlineWidth=n.labelOutlineWidth.evaluate(i)),u(n.font)&&(i.font=n.font.evaluate(i)),u(n.labelStyle)&&(i.labelStyle=n.labelStyle.evaluate(i)),i.labelText=u(n.labelText)?n.labelText.evaluate(i):undefined,u(n.backgroundColor)&&(i.backgroundColor=n.backgroundColor.evaluateColor(i,at)),u(n.backgroundPadding)&&(i.backgroundPadding=n.backgroundPadding.evaluate(i)),u(n.backgroundEnabled)&&(i.backgroundEnabled=n.backgroundEnabled.evaluate(i)),u(n.scaleByDistance)?(r=n.scaleByDistance.evaluate(i),nt.near=r.x,nt.nearValue=r.y,nt.far=r.z,nt.farValue=r.w,i.scaleByDistance=nt):i.scaleByDistance=undefined,u(n.translucencyByDistance)?(f=n.translucencyByDistance.evaluate(i),tt.near=f.x,tt.nearValue=f.y,tt.far=f.z,tt.farValue=f.w,i.translucencyByDistance=tt):i.translucencyByDistance=undefined,u(n.distanceDisplayCondition)?(s=n.distanceDisplayCondition.evaluate(i),it.near=s.x,it.far=s.y,i.distanceDisplayCondition=it):i.distanceDisplayCondition=undefined,u(n.heightOffset)&&(i.heightOffset=n.heightOffset.evaluate(i)),u(n.anchorLineEnabled)&&(i.anchorLineEnabled=n.anchorLineEnabled.evaluate(i)),u(n.anchorLineColor)&&(i.anchorLineColor=n.anchorLineColor.evaluateColor(i,vt)),i.image=u(n.image)?n.image.evaluate(i):undefined,u(n.disableDepthTestDistance)&&(i.disableDepthTestDistance=n.disableDepthTestDistance.evaluate(i)),u(n.horizontalOrigin)&&(i.horizontalOrigin=n.horizontalOrigin.evaluate(i)),u(n.verticalOrigin)&&(i.verticalOrigin=n.verticalOrigin.evaluate(i)),u(n.labelHorizontalOrigin)&&(i.labelHorizontalOrigin=n.labelHorizontalOrigin.evaluate(i)),u(n.labelVerticalOrigin)&&(i.labelVerticalOrigin=n.labelVerticalOrigin.evaluate(i))},g.prototype.update=function(n){(et(this,n.mapProjection.ellipsoid),this._ready)&&(this._polylineCollection.update(n),this._billboardCollection.update(n),this._labelCollection.update(n),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),e(this)},g});t("Scene/Vector3DTilePolygons",["../Core/arraySlice","../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Ellipsoid","../Core/IndexDatatype","../Core/OrientedBoundingBox","../Core/Rectangle","../Core/TaskProcessor","../ThirdParty/when","./ClassificationType","./Vector3DTileBatch","./Vector3DTilePrimitive"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function w(n){this._batchTable=n.batchTable;this._batchIds=n.batchIds;this._positions=n.positions;this._counts=n.counts;this._indices=n.indices;this._indexCounts=n.indexCounts;this._indexOffsets=undefined;this._batchTableColors=undefined;this._packedBuffer=undefined;this._batchedPositions=undefined;this._transferrableBatchIds=undefined;this._vertexBatchIds=undefined;this._ellipsoid=r(n.ellipsoid,o.WGS84);this._minimumHeight=n.minimumHeight;this._maximumHeight=n.maximumHeight;this._polygonMinimumHeights=n.polygonMinimumHeights;this._polygonMaximumHeights=n.polygonMaximumHeights;this._center=r(n.center,t.ZERO);this._rectangle=n.rectangle;this._center=undefined;this._boundingVolume=n.boundingVolume;this._boundingVolumes=undefined;this._batchedIndices=undefined;this._ready=!1;this._readyPromise=a.defer();this._verticesPromise=undefined;this._primitive=undefined;this.debugWireframe=!1;this.forceRebatch=!1;this.classificationType=v.CESIUM_3D_TILE}function b(n){var r=new Float64Array(3+t.packedLength+o.packedLength+c.packedLength),i=0;return r[i++]=n._indices.BYTES_PER_ELEMENT,r[i++]=n._minimumHeight,r[i++]=n._maximumHeight,t.pack(n._center,r,i),i+=t.packedLength,o.pack(n._ellipsoid,r,i),i+=o.packedLength,c.pack(n._rectangle,r,i),r}function k(n,t){for(var o,c,u,l,f,r=1,s=t[r++],p=n._boundingVolumes=new Array(s),e=0;e<s;++e)p[e]=h.unpack(t,r),r+=h.packedLength;for(o=t[r++],c=n._batchedIndices=new Array(o),u=0;u<o;++u){l=i.unpack(t,r);r+=i.packedLength;var w=t[r++],b=t[r++],a=t[r++],v=new Array(a);for(f=0;f<a;++f)v[f]=t[r++];c[u]=new y({color:l,offset:w,count:b,batchIds:v})}}function nt(t){var it,rt,r,ut,tt;if(!u(t._primitive)){if(!u(t._verticesPromise)){var e=t._positions,o=t._counts,h=t._indexCounts,l=t._indices,f=t._transferrableBatchIds,i=t._batchTableColors,v=t._packedBuffer;if(!u(i)){for(e=t._positions=n(t._positions),o=t._counts=n(t._counts),h=t._indexCounts=n(t._indexCounts),l=t._indices=n(t._indices),t._center=t._ellipsoid.cartographicToCartesian(c.center(t._rectangle)),f=t._transferrableBatchIds=new Uint32Array(t._batchIds),i=t._batchTableColors=new Uint32Array(f.length),it=t._batchTable,rt=i.length,r=0;r<rt;++r)ut=it.getColor(r,g),i[r]=ut.toRgba();v=t._packedBuffer=b(t)}var ft=[e.buffer,o.buffer,h.buffer,l.buffer,f.buffer,i.buffer,v.buffer],y={packedBuffer:v.buffer,positions:e.buffer,counts:o.buffer,indexCounts:h.buffer,indices:l.buffer,batchIds:f.buffer,batchTableColors:i.buffer},w=t._polygonMinimumHeights,nt=t._polygonMaximumHeights;if(u(w)&&u(nt)&&(ft.push(w.buffer,nt.buffer),y.minimumHeights=w,y.maximumHeights=nt),tt=t._verticesPromise=d.scheduleTask(y,ft),!u(tt))return;a(tt,function(n){t._positions=undefined;t._counts=undefined;t._polygonMinimumHeights=undefined;t._polygonMaximumHeights=undefined;var i=new Float64Array(n.packedBuffer),r=i[0];k(t,i);t._indices=s.getSizeInBytes(r)===2?new Uint16Array(n.indices):new Uint32Array(n.indices);t._indexOffsets=new Uint32Array(n.indexOffsets);t._indexCounts=new Uint32Array(n.indexCounts);t._batchedPositions=new Float32Array(n.positions);t._vertexBatchIds=new Uint16Array(n.batchIds);t._ready=!0})}t._ready&&!u(t._primitive)&&(t._primitive=new p({batchTable:t._batchTable,positions:t._batchedPositions,batchIds:t._batchIds,vertexBatchIds:t._vertexBatchIds,indices:t._indices,indexOffsets:t._indexOffsets,indexCounts:t._indexCounts,batchedIndices:t._batchedIndices,boundingVolume:t._boundingVolume,boundingVolumes:t._boundingVolumes,center:t._center}),t._batchTable=undefined,t._batchIds=undefined,t._positions=undefined,t._counts=undefined,t._indices=undefined,t._indexCounts=undefined,t._indexOffsets=undefined,t._batchTableColors=undefined,t._packedBuffer=undefined,t._batchedPositions=undefined,t._transferrableBatchIds=undefined,t._vertexBatchIds=undefined,t._ellipsoid=undefined,t._minimumHeight=undefined,t._maximumHeight=undefined,t._polygonMinimumHeights=undefined,t._polygonMaximumHeights=undefined,t._center=undefined,t._rectangle=undefined,t._boundingVolume=undefined,t._boundingVolumes=undefined,t._batchedIndices=undefined,t._verticesPromise=undefined,t._readyPromise.resolve())}}f(w.prototype,{trianglesLength:{get:function(){return u(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return u(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});var d=new l("createVectorTilePolygons"),g=new i;return w.prototype.createFeatures=function(n,t){this._primitive.createFeatures(n,t)},w.prototype.applyDebugSettings=function(n,t){this._primitive.applyDebugSettings(n,t)},w.prototype.applyStyle=function(n,t){this._primitive.applyStyle(n,t)},w.prototype.updateCommands=function(n,t){this._primitive.updateCommands(n,t)},w.prototype.update=function(n){(nt(this),this._ready)&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(n))},w.prototype.isDestroyed=function(){return!1},w.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),e(this)},w});t("Shaders/Vector3DTilePolylinesVS",[],function(){"use strict";return"attribute vec4 currentPosition;\nattribute vec4 previousPosition;\nattribute vec4 nextPosition;\nattribute vec2 expandAndWidth;\nattribute float a_batchId;\nuniform mat4 u_modifiedModelView;\nvoid main()\n{\nfloat expandDir = expandAndWidth.x;\nfloat width = abs(expandAndWidth.y) + 0.5;\nbool usePrev = expandAndWidth.y < 0.0;\nvec4 p = u_modifiedModelView * currentPosition;\nvec4 prev = u_modifiedModelView * previousPosition;\nvec4 next = u_modifiedModelView * nextPosition;\nfloat angle;\nvec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);\ngl_Position = czm_viewportOrthographic * positionWC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_projection * p);\n#endif\n}\n"});t("Scene/Vector3DTilePolylines",["../Core/arraySlice","../Core/Cartesian3","../Core/Color","../Core/ComponentDatatype","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Ellipsoid","../Core/IndexDatatype","../Core/Matrix4","../Core/Rectangle","../Core/TaskProcessor","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../Shaders/PolylineCommon","../Shaders/Vector3DTilePolylinesVS","../ThirdParty/when","./BlendingState","./Cesium3DTileFeature"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){"use strict";function ft(n){this._positions=n.positions;this._widths=n.widths;this._counts=n.counts;this._batchIds=n.batchIds;this._ellipsoid=u(n.ellipsoid,s.WGS84);this._minimumHeight=n.minimumHeight;this._maximumHeight=n.maximumHeight;this._center=n.center;this._rectangle=n.rectangle;this._boundingVolume=n.boundingVolume;this._batchTable=n.batchTable;this._va=undefined;this._sp=undefined;this._rs=undefined;this._uniformMap=undefined;this._command=undefined;this._transferrableBatchIds=undefined;this._packedBuffer=undefined;this._currentPositions=undefined;this._previousPositions=undefined;this._nextPositions=undefined;this._expandAndWidth=undefined;this._vertexBatchIds=undefined;this._indices=undefined;this._constantColor=i.clone(i.WHITE);this._highlightColor=this._constantColor;this._trianglesLength=0;this._geometryByteLength=0;this._ready=!1;this._readyPromise=it.defer();this._verticesPromise=undefined}function lt(n){var u=n._rectangle,f=n._minimumHeight,e=n._maximumHeight,o=n._ellipsoid,h=n._center,c=2+l.packedLength+s.packedLength+t.packedLength,r=new Float64Array(c),i=0;return r[i++]=f,r[i++]=e,l.pack(u,r,i),i+=l.packedLength,s.pack(o,r,i),i+=s.packedLength,t.pack(h,r,i),r}function at(t,i){if(!f(t._va)){if(!f(t._verticesPromise)){var u=t._positions,e=t._widths,o=t._counts,l=t._transferrableBatchIds,s=t._packedBuffer;f(s)||(u=t._positions=n(u),e=t._widths=n(e),o=t._counts=n(o),l=t._transferrableBatchIds=n(t._batchIds),s=t._packedBuffer=lt(t));var tt=[u.buffer,e.buffer,o.buffer,l.buffer,s.buffer],rt={positions:u.buffer,widths:e.buffer,counts:o.buffer,batchIds:l.buffer,packedBuffer:s.buffer},a=t._verticesPromise=ht.scheduleTask(rt,tt);if(!f(a))return;it(a,function(n){t._currentPositions=new Float32Array(n.currentPositions);t._previousPositions=new Float32Array(n.previousPositions);t._nextPositions=new Float32Array(n.nextPositions);t._expandAndWidth=new Float32Array(n.expandAndWidth);t._vertexBatchIds=new Uint16Array(n.batchIds);var i=n.indexDatatype;t._indices=i===h.UNSIGNED_SHORT?new Uint16Array(n.indices):new Uint32Array(n.indices);t._ready=!0})}if(t._ready&&!f(t._va)){var p=t._currentPositions,w=t._previousPositions,b=t._nextPositions,k=t._expandAndWidth,d=t._vertexBatchIds,c=t._indices,nt=w.byteLength+p.byteLength+b.byteLength;nt+=k.byteLength+d.byteLength+c.byteLength;t._trianglesLength=c.length/3;t._geometryByteLength=nt;var ut=v.createVertexBuffer({context:i,typedArray:w,usage:y.STATIC_DRAW}),ft=v.createVertexBuffer({context:i,typedArray:p,usage:y.STATIC_DRAW}),ot=v.createVertexBuffer({context:i,typedArray:b,usage:y.STATIC_DRAW}),st=v.createVertexBuffer({context:i,typedArray:k,usage:y.STATIC_DRAW}),ct=v.createVertexBuffer({context:i,typedArray:d,usage:y.STATIC_DRAW}),at=v.createIndexBuffer({context:i,typedArray:c,usage:y.STATIC_DRAW,indexDatatype:c.BYTES_PER_ELEMENT===2?h.UNSIGNED_SHORT:h.UNSIGNED_INT}),vt=[{index:et.previousPosition,vertexBuffer:ut,componentDatatype:r.FLOAT,componentsPerAttribute:3},{index:et.currentPosition,vertexBuffer:ft,componentDatatype:r.FLOAT,componentsPerAttribute:3},{index:et.nextPosition,vertexBuffer:ot,componentDatatype:r.FLOAT,componentsPerAttribute:3},{index:et.expandAndWidth,vertexBuffer:st,componentDatatype:r.FLOAT,componentsPerAttribute:2},{index:et.a_batchId,vertexBuffer:ct,componentDatatype:r.UNSIGNED_SHORT,componentsPerAttribute:1}];t._va=new g({context:i,attributes:vt,indexBuffer:at});t._positions=undefined;t._widths=undefined;t._counts=undefined;t._ellipsoid=undefined;t._minimumHeight=undefined;t._maximumHeight=undefined;t._rectangle=undefined;t._transferrableBatchIds=undefined;t._packedBuffer=undefined;t._currentPositions=undefined;t._previousPositions=undefined;t._nextPositions=undefined;t._expandAndWidth=undefined;t._vertexBatchIds=undefined;t._indices=undefined;t._readyPromise.resolve()}}}function vt(n,t){f(n._uniformMap)||(n._uniformMap={u_modifiedModelView:function(){var i=t.uniformState.view;return c.clone(i,ot),c.multiplyByPoint(ot,n._center,st),c.setTranslation(ot,st,ot),ot},u_highlightColor:function(){return n._highlightColor}})}function yt(n){if(!f(n._rs))n._rs=b.fromCache({blending:rt.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:{enabled:!0,factor:-5,units:-5}})}function pt(n,t){if(!f(n._sp)){var i=n._batchTable,r=i.getVertexShaderCallback(!1,"a_batchId",undefined)(tt),u=i.getFragmentShaderCallback()(ct,!1,undefined),e=new d({defines:["VECTOR_TILE"],sources:[nt,r]}),o=new d({defines:["VECTOR_TILE"],sources:[u]});n._sp=k.fromCache({context:t,vertexShaderSource:e,fragmentShaderSource:o,attributeLocations:et})}}function wt(n,t){if(!f(n._command)){var i=n._batchTable.getUniformMapCallback()(n._uniformMap);n._command=new p({owner:n,vertexArray:n._va,renderState:n._rs,shaderProgram:n._sp,uniformMap:i,boundingVolume:n._boundingVolume,pass:w.TRANSLUCENT,pickId:n._batchTable.getPickId()})}t.commandList.push(n._command)}function bt(n,t){for(var e,u,f=n._batchIds,o=f.length,r=0;r<o;++r)e=f[r],u=t[e],u.show=!0,u.color=i.WHITE}var ht,et,ot,st,ct;e(ft.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});ht=new a("createVectorTilePolylines");et={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};ot=new c;st=new t;ct="uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor = u_highlightColor;\n}\n";ft.prototype.createFeatures=function(n,t){for(var r,u=this._batchIds,f=u.length,i=0;i<f;++i)r=u[i],t[r]=new ut(n,r)};ft.prototype.applyDebugSettings=function(n,t){this._highlightColor=n?t:this._constantColor};var kt=new i,dt=i.WHITE,gt=!0;return ft.prototype.applyStyle=function(n,t){var u,e,r,o,i;if(!f(n)){bt(this,t);return}for(u=this._batchIds,e=u.length,r=0;r<e;++r)o=u[r],i=t[o],i.color=f(n.color)?n.color.evaluateColor(i,kt):dt,i.show=f(n.show)?n.show.evaluate(i):gt},ft.prototype.update=function(n){var t=n.context,i;(at(this,t),vt(this,t),pt(this,t),yt(this),this._ready)&&(i=n.passes,(i.render||i.pick)&&wt(this,n))},ft.prototype.isDestroyed=function(){return!1},ft.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),o(this)},ft});t("Scene/Vector3DTileContent",["../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Ellipsoid","../Core/FeatureDetection","../Core/getMagic","../Core/getStringFromTypedArray","../Core/Math","../Core/Matrix4","../Core/Rectangle","../Core/RuntimeError","../ThirdParty/when","./Cesium3DTileBatchTable","./Vector3DTilePoints","./Vector3DTilePolygons","./Vector3DTilePolylines"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function g(n,t,i,r,u){this._tileset=n;this._tile=t;this._resource=i;this._polygons=undefined;this._polylines=undefined;this._points=undefined;this._contentReadyPromise=undefined;this._readyPromise=y.defer();this._batchTable=undefined;this._features=undefined;this.featurePropertiesDirty=!1;ut(this,r,u)}function it(n){return function(t,r){i(n._polygons)&&n._polygons.updateCommands(t,r)}}function rt(n,r){var f,e,o,u,s=t(n.POLYGONS_LENGTH,0),h=t(n.POLYLINES_LENGTH,0),c=t(n.POINTS_LENGTH,0),a,y,p,w,b,k,l;if(s>0&&i(n.POLYGON_BATCH_IDS)&&(a=r.byteOffset+n.POLYGON_BATCH_IDS.byteOffset,f=new Uint16Array(r.buffer,a,s)),h>0&&i(n.POLYLINE_BATCH_IDS)&&(y=r.byteOffset+n.POLYLINE_BATCH_IDS.byteOffset,e=new Uint16Array(r.buffer,y,h)),c>0&&i(n.POINT_BATCH_IDS)&&(p=r.byteOffset+n.POINT_BATCH_IDS.byteOffset,o=new Uint16Array(r.buffer,p,c)),w=i(f)||i(e)||i(o),b=s>0&&!i(f)||h>0&&!i(e)||c>0&&!i(o),w&&b)throw new v("If one group of batch ids is defined, then all batch ids must be defined.");if(k=!i(f)&&!i(e)&&!i(o),k){if(l=0,!i(f)&&s>0)for(f=new Uint16Array(s),u=0;u<s;++u)f[u]=l++;if(!i(e)&&h>0)for(e=new Uint16Array(h),u=0;u<h;++u)e[u]=l++;if(!i(o)&&c>0)for(o=new Uint16Array(c),u=0;u<c;++u)o[u]=l++}return{polygons:f,polylines:e,points:o}}function ut(r,u,f){var bt,y,kt,ri,st,dt,ht,ct,gt,ni,ti,ui,fi,o,s,ei,lt,oi,ft,et,ot,vt,ii,g,yt,ci,li,yi,pi,wi,bi,ki,pt,wt,di,gi;if(f=t(f,0),bt=new Uint8Array(u),y=new DataView(u),f+=d,kt=y.getUint32(f,!0),kt!==1)throw new v("Only Vector tile version 1 is supported.  Version "+kt+" is not.");if(f+=d,ri=y.getUint32(f,!0),f+=d,ri===0){r._readyPromise.resolve(r);return}if(st=y.getUint32(f,!0),f+=d,st===0)throw new v("Feature table must have a byte length greater than zero");dt=y.getUint32(f,!0);f+=d;ht=y.getUint32(f,!0);f+=d;ct=y.getUint32(f,!0);f+=d;gt=y.getUint32(f,!0);f+=d;ni=y.getUint32(f,!0);f+=d;ti=y.getUint32(f,!0);f+=d;ui=y.getUint32(f,!0);f+=d;fi=h(bt,f,st);o=JSON.parse(fi);f+=st;s=new Uint8Array(u,f,dt);f+=dt;ht>0&&(oi=h(bt,f,ht),ei=JSON.parse(oi),f+=ht,ct>0&&(lt=new Uint8Array(u,f,ct),lt=new Uint8Array(lt),f+=ct));var tt=t(o.POLYGONS_LENGTH,0),ut=t(o.POLYLINES_LENGTH,0),si=t(o.POINTS_LENGTH,0),hi=tt+ut+si,at=new p(r,hi,ei,lt,it(r));if(r._batchTable=at,hi!==0){if(i(o.REGION))vt=o.REGION,ft=a.unpack(vt),et=vt[4],ot=vt[5];else throw new v("REGION is required in the feature table.");if(ii=r._tile.computedTransform,i(o.RTC_CENTER)?(g=n.unpack(o.RTC_CENTER),l.multiplyByPoint(ii,g,g)):(g=a.center(ft),g.height=c.lerp(et,ot,.5),g=e.WGS84.cartographicToCartesian(g)),yt=rt(o,s),f+=f%4,tt>0){ci=new Uint32Array(u,f,gt/d);f+=gt;li=new Uint16Array(u,f,ni/nt);f+=ni;var nr=s.byteOffset+o.POLYGON_COUNT.byteOffset,tr=new Uint32Array(s.buffer,nr,tt),ir=s.byteOffset+o.POLYGON_INDEX_COUNT.byteOffset,rr=new Uint32Array(s.buffer,ir,tt),ai,vi;i(o.POLYGON_MINIMUM_HEIGHTS)&&i(o.POLYGON_MAXIMUM_HEIGHTS)&&(yi=s.byteOffset+o.POLYGON_MINIMUM_HEIGHTS.byteOffset,ai=new Float32Array(s.buffer,yi,tt),pi=s.byteOffset+o.POLYGON_MAXIMUM_HEIGHTS.byteOffset,vi=new Float32Array(s.buffer,pi,tt));r._polygons=new b({positions:li,counts:tr,indexCounts:rr,indices:ci,minimumHeight:et,maximumHeight:ot,polygonMinimumHeights:ai,polygonMaximumHeights:vi,center:g,rectangle:ft,boundingVolume:r.tile.boundingVolume.boundingVolume,batchTable:at,batchIds:yt.polygons,modelMatrix:ii})}if(ut>0){if(wi=new Uint16Array(u,f,ti/nt),f+=ti,bi=s.byteOffset+o.POLYLINE_COUNT.byteOffset,ki=new Uint32Array(s.buffer,bi,ut),i(o.POLYLINE_WIDTHS))di=s.byteOffset+o.POLYLINE_WIDTHS.byteOffset,pt=new Uint16Array(s.buffer,di,ut);else for(pt=new Uint16Array(ut),wt=0;wt<ut;++wt)pt[wt]=2;r._polylines=new k({positions:wi,widths:pt,counts:ki,batchIds:yt.polylines,minimumHeight:et,maximumHeight:ot,center:g,rectangle:ft,boundingVolume:r.tile.boundingVolume.boundingVolume,batchTable:at})}si>0&&(gi=new Uint16Array(u,f,ui/nt),r._points=new w({positions:gi,batchIds:yt.points,minimumHeight:et,maximumHeight:ot,rectangle:ft,batchTable:at}))}}function tt(n){var r=n.featuresLength,t;!i(n._features)&&r>0&&(t=new Array(r),i(n._polygons)&&n._polygons.createFeatures(n,t),i(n._polylines)&&n._polylines.createFeatures(n,t),i(n._points)&&n._points.createFeatures(n,t),n._features=t)}if(!o.supportsTypedArrays())return{};r(g.prototype,{featuresLength:{get:function(){return i(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return i(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var n=0;return i(this._polygons)&&(n+=this._polygons.trianglesLength),i(this._polylines)&&(n+=this._polylines.trianglesLength),n}},geometryByteLength:{get:function(){var n=0;return i(this._polygons)&&(n+=this._polygons.geometryByteLength),i(this._polylines)&&(n+=this._polylines.geometryByteLength),n}},texturesByteLength:{get:function(){return i(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return i(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var nt=Uint16Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT;return g.prototype.hasProperty=function(n,t){return this._batchTable.hasProperty(n,t)},g.prototype.getFeature=function(n){var t=this.featuresLength;if(!i(n)||n<0||n>=t)throw new f("batchId is required and between zero and featuresLength - 1 ("+(t-1)+").");return tt(this),this._features[n]},g.prototype.applyDebugSettings=function(n,t){i(this._polygons)&&this._polygons.applyDebugSettings(n,t);i(this._polylines)&&this._polylines.applyDebugSettings(n,t);i(this._points)&&this._points.applyDebugSettings(n,t)},g.prototype.applyStyle=function(n){tt(this);i(this._polygons)&&this._polygons.applyStyle(n,this._features);i(this._polylines)&&this._polylines.applyStyle(n,this._features);i(this._points)&&this._points.applyStyle(n,this._features)},g.prototype.update=function(n,t){var r=!0;if(i(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.update(t),r=r&&this._polygons._ready),i(this._polylines)&&(this._polylines.update(t),r=r&&this._polylines._ready),i(this._points)&&(this._points.update(t),r=r&&this._points._ready),i(this._batchTable)&&r&&this._batchTable.update(n,t),!i(this._contentReadyPromise)){var f=i(this._points)?this._points.readyPromise:undefined,e=i(this._polygons)?this._polygons.readyPromise:undefined,o=i(this._polylines)?this._polylines.readyPromise:undefined,u=this;this._contentReadyPromise=y.all([f,e,o]).then(function(){u._readyPromise.resolve(u)})}},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return this._polygons=this._polygons&&this._polygons.destroy(),this._polylines=this._polylines&&this._polylines.destroy(),this._points=this._points&&this._points.destroy(),this._batchTable=this._batchTable&&this._batchTable.destroy(),u(this)},g});t("Scene/Cesium3DTileContentFactory",["./Batched3DModel3DTileContent","./Composite3DTileContent","./Geometry3DTileContent","./Instanced3DModel3DTileContent","./PointCloud3DTileContent","./Tileset3DTileContent","./Vector3DTileContent"],function(n,t,i,r,u,f,e){"use strict";var o={b3dm:function(t,i,r,u,f){return new n(t,i,r,u,f)},pnts:function(n,t,i,r,f){return new u(n,t,i,r,f)},i3dm:function(n,t,i,u,f){return new r(n,t,i,u,f)},cmpt:function(n,i,r,u,f){return new t(n,i,r,u,f,o)},json:function(n,t,i,r,u){return new f(n,t,i,r,u)},geom:function(n,t,r,u,f){return new i(n,t,r,u,f)},vctr:function(n,t,i,r,u){return new e(n,t,i,r,u)}};return o});t("Scene/Cesium3DTileContentState",["../Core/freezeObject"],function(n){"use strict";return n({UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5})});t("Scene/Cesium3DTileOptimizationHint",["../Core/freezeObject"],function(n){"use strict";return n({NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0})});t("Scene/Empty3DTileContent",["../Core/defineProperties","../Core/destroyObject"],function(n,t){"use strict";function i(n,t){this._tileset=n;this._tile=t;this.featurePropertiesDirty=!1}return n(i.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return undefined}},readyPromise:{get:function(){return undefined}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return undefined}},batchTable:{get:function(){return undefined}}}),i.prototype.hasProperty=function(){return!1},i.prototype.getFeature=function(){return undefined},i.prototype.applyDebugSettings=function(){},i.prototype.applyStyle=function(){},i.prototype.update=function(){},i.prototype.isDestroyed=function(){return!1},i.prototype.destroy=function(){return t(this)},i});t("Scene/TileBoundingRegion",["../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defineProperties","../Core/Ellipsoid","../Core/GeometryInstance","../Core/IntersectionTests","../Core/Matrix4","../Core/OrientedBoundingBox","../Core/Plane","../Core/Ray","../Core/Rectangle","../Core/RectangleOutlineGeometry","./PerInstanceColorAppearance","./Primitive","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function nt(i){r.typeOf.object("options",i);r.typeOf.object("options.rectangle",i.rectangle);this.rectangle=y.clone(i.rectangle);this.minimumHeight=f(i.minimumHeight,0);this.maximumHeight=f(i.maximumHeight,0);this.southwestCornerCartesian=new t;this.northeastCornerCartesian=new t;this.westNormal=new t;this.southNormal=new t;this.eastNormal=new t;this.northNormal=new t;var u=f(i.ellipsoid,o.WGS84);ht(this,i.rectangle,u);this._orientedBoundingBox=l.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,u);this._boundingSphere=n.fromOrientedBoundingBox(this._orientedBoundingBox)}function ht(n,i,r){var u,l,f,v,b,k,nt,s,c,ft,ht,ct;r.cartographicToCartesian(y.southwest(i),n.southwestCornerCartesian);r.cartographicToCartesian(y.northeast(i),n.northeastCornerCartesian);d.longitude=i.west;d.latitude=(i.south+i.north)*.5;d.height=0;u=r.cartographicToCartesian(d,ot);l=t.cross(u,t.UNIT_Z,it);t.normalize(l,n.westNormal);d.longitude=i.east;f=r.cartographicToCartesian(d,st);v=t.cross(t.UNIT_Z,f,it);t.normalize(v,n.eastNormal);var e=t.subtract(u,f,it),p=t.normalize(e,et),w=i.south,o;w>0?(d.longitude=(i.west+i.east)*.5,d.latitude=w,b=r.cartographicToCartesian(d,g.origin),t.clone(p,g.direction),k=a.fromPointNormal(n.southwestCornerCartesian,n.westNormal,ut),h.rayPlane(g,k,n.southwestCornerCartesian),o=r.geodeticSurfaceNormal(b,tt)):o=r.geodeticSurfaceNormalCartographic(y.southeast(i),tt);nt=t.cross(o,e,rt);t.normalize(nt,n.southNormal);s=i.north;s<0?(d.longitude=(i.west+i.east)*.5,d.latitude=s,ft=r.cartographicToCartesian(d,g.origin),t.negate(p,g.direction),ht=a.fromPointNormal(n.northeastCornerCartesian,n.eastNormal,ut),h.rayPlane(g,ht,n.northeastCornerCartesian),c=r.geodeticSurfaceNormal(ft,tt)):c=r.geodeticSurfaceNormalCartographic(y.northwest(i),tt);ct=t.cross(e,c,rt);t.normalize(ct,n.northNormal)}e(nt.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});var it=new t,tt=new t,rt=new t,et=new t,ot=new t,st=new t,d=new i,ut=new a(t.UNIT_X,0),g=new v;var ct=new t,lt=new t,at=new t(0,-1,0),vt=new t(0,0,-1),ft=new t;return nt.prototype.distanceToCamera=function(n){var tt,it,e;r.defined("frameState",n);var a=n.camera,o=a.positionWC,v=a.positionCartographic,f=0;if(!y.contains(this.rectangle,v)){var i=this.southwestCornerCartesian,u=this.northeastCornerCartesian,p=this.westNormal,w=this.southNormal,b=this.eastNormal,d=this.northNormal;n.mode!==k.SCENE3D&&(i=n.mapProjection.project(y.southwest(this.rectangle),ct),i.z=i.y,i.y=i.x,i.x=0,u=n.mapProjection.project(y.northeast(this.rectangle),lt),u.z=u.y,u.y=u.x,u.x=0,p=at,b=t.UNIT_Y,w=vt,d=t.UNIT_Z);var g=t.subtract(o,i,ft),s=t.dot(g,p),h=t.dot(g,w),nt=t.subtract(o,u,ft),c=t.dot(nt,b),l=t.dot(nt,d);s>0?f+=s*s:c>0&&(f+=c*c);h>0?f+=h*h:l>0&&(f+=l*l)}return tt=n.mode===k.SCENE3D?v.height:o.x,it=n.mode===k.SCENE3D?this.maximumHeight:0,e=tt-it,e>0&&(f+=e*e),Math.sqrt(f)},nt.prototype.intersectPlane=function(n){return r.defined("plane",n),this._orientedBoundingBox.intersectPlane(n)},nt.prototype.createDebugVolume=function(n){r.defined("color",n);var t=new c.clone(c.IDENTITY),i=new p({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),f=new s({geometry:i,id:"outline",modelMatrix:t,attributes:{color:u.fromColor(n)}});return new b({geometryInstances:f,appearance:new w({translucent:!1,flat:!0}),asynchronous:!1})},nt});t("Scene/TileBoundingSphere",["../Core/BoundingSphere","../Core/Cartesian3","../Core/Check","../Core/ColorGeometryInstanceAttribute","../Core/defineProperties","../Core/GeometryInstance","../Core/Matrix4","../Core/SphereOutlineGeometry","./PerInstanceColorAppearance","./Primitive"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(t,i){this._boundingSphere=new n(t,i)}return u(c.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}}),c.prototype.distanceToCamera=function(n){i.defined("frameState",n);var r=this._boundingSphere;return Math.max(0,t.distance(r.center,n.camera.positionWC)-r.radius)},c.prototype.intersectPlane=function(t){return i.defined("plane",t),n.intersectPlane(this._boundingSphere,t)},c.prototype.update=function(n,i){t.clone(n,this._boundingSphere.center);this._boundingSphere.radius=i},c.prototype.createDebugVolume=function(n){i.defined("color",n);var t=new o({radius:this.radius}),u=e.fromTranslation(this.center,new e.clone(e.IDENTITY)),c=new f({geometry:t,id:"outline",modelMatrix:u,attributes:{color:r.fromColor(n)}});return new h({geometryInstances:c,appearance:new s({translucent:!1,flat:!0}),asynchronous:!1})},c});t("Scene/TileOrientedBoundingBox",["../Core/BoundingSphere","../Core/BoxOutlineGeometry","../Core/Cartesian3","../Core/Check","../Core/ColorGeometryInstanceAttribute","../Core/defineProperties","../Core/GeometryInstance","../Core/Matrix3","../Core/Matrix4","../Core/OrientedBoundingBox","./PerInstanceColorAppearance","./Primitive"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function a(t,i){this._orientedBoundingBox=new h(t,i);this._boundingSphere=n.fromOrientedBoundingBox(this._orientedBoundingBox)}return f(a.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}}),a.prototype.distanceToCamera=function(n){return r.defined("frameState",n),Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(n.camera.positionWC))},a.prototype.intersectPlane=function(n){return r.defined("plane",n),this._orientedBoundingBox.intersectPlane(n)},a.prototype.update=function(t,r){i.clone(t,this._orientedBoundingBox.center);o.clone(r,this._orientedBoundingBox.halfAxes);n.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)},a.prototype.createDebugVolume=function(n){r.defined("color",n);var f=new t({minimum:new i(-1,-1,-1),maximum:new i(1,1,1)}),o=s.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),h=new e({geometry:f,id:"outline",modelMatrix:o,attributes:{color:u.fromColor(n)}});return new l({geometryInstances:h,appearance:new c({translucent:!1,flat:!0}),asynchronous:!1})},a});t("Scene/Cesium3DTile",["../Core/BoundingSphere","../Core/Cartesian3","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/CullingVolume","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/Ellipsoid","../Core/getMagic","../Core/Intersect","../Core/JulianDate","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/OrientedBoundingBox","../Core/Rectangle","../Core/Request","../Core/RequestScheduler","../Core/RequestState","../Core/RequestType","../Core/Resource","../Core/RuntimeError","../Core/Transforms","../ThirdParty/when","./Cesium3DTileContentFactory","./Cesium3DTileContentState","./Cesium3DTileOptimizationHint","./Cesium3DTileRefine","./Empty3DTileContent","./SceneMode","./TileBoundingRegion","./TileBoundingSphere","./TileOrientedBoundingBox"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt){"use strict";function pt(n,t,r,u){var f,p,b,h,k,c,l,a,d,y,o,nt,tt;this._tileset=n;this._header=r;f=r.content;this.transform=e(r.transform)?w.unpack(r.transform):w.clone(w.IDENTITY);var rt=e(u)?u.computedTransform:n.modelMatrix,s=w.multiply(rt,this.transform,new w),ut=e(u)?u._initialTransform:w.IDENTITY;this._initialTransform=w.multiply(ut,this.transform,new w);this.computedTransform=s;this._boundingVolume=this.createBoundingVolume(r.boundingVolume,s);this._boundingVolume2D=undefined;e(f)&&e(f.boundingVolume)&&(p=this.createBoundingVolume(f.boundingVolume,s));this._contentBoundingVolume=p;this._contentBoundingVolume2D=undefined;e(r.viewerRequestVolume)&&(b=this.createBoundingVolume(r.viewerRequestVolume,s));this._viewerRequestVolume=b;this.geometricError=r.geometricError;e(this.geometricError)||(this.geometricError=e(u)?u.geometricError:n._geometricError,pt._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead."));e(r.refine)?((r.refine==="replace"||r.refine==="add")&&pt._deprecationWarning("lowercase-refine",'This tile uses a lowercase refine "'+r.refine+'". Instead use "'+r.refine.toUpperCase()+'".'),h=r.refine.toUpperCase()==="REPLACE"?ht.REPLACE:ht.ADD):h=e(u)?u.refine:ht.REPLACE;this.refine=h;this.children=[];this.parent=u;t=it.createIfNeeded(t);e(f)?(y=f.uri,e(f.url)&&(pt._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),y=f.url),c=!1,l=ot.UNLOADED,a=t.getDerivedResource({url:y}),d=g.getServerKey(a.getUrlComponent())):(k=new ct(n,this),c=!0,l=ot.READY);this._content=k;this._contentResource=a;this._contentState=l;this._contentReadyToProcessPromise=undefined;this._contentReadyPromise=undefined;this._expiredContent=undefined;this._serverKey=d;this.hasEmptyContent=c;this.hasTilesetContent=!1;this.cacheNode=undefined;o=r.expire;e(o)&&(nt=o.duration,e(o.date)&&(tt=v.fromIso8601(o.date)));this.expireDuration=nt;this.expireDate=tt;this.lastStyleTime=0;this._optimChildrenWithinParent=st.NOT_COMPUTED;this.clippingPlanesDirty=!1;this._distanceToCamera=0;this._centerZDepth=0;this._screenSpaceError=0;this._visibilityPlaneMask=0;this._visible=!1;this._inRequestVolume=!1;this._finalResolution=!0;this._depth=0;this._stackLength=0;this._selectionDepth=0;this._updatedVisibilityFrame=0;this._touchedFrame=0;this._visitedFrame=0;this._selectedFrame=0;this._requestedFrame=0;this._ancestorWithContent=undefined;this._ancestorWithContentAvailable=undefined;this._refines=!1;this._shouldSelect=!1;this._priority=0;this._isClipped=!0;this._clippingPlanesState=0;this._debugBoundingVolume=undefined;this._debugContentBoundingVolume=undefined;this._debugViewerRequestVolume=undefined;this._debugColor=i.fromRandom({alpha:1});this._debugColorizeTiles=!1;this._commandsLength=0;this._color=undefined;this._colorDirty=!1}function ui(n){if(e(n.expireDuration)){var t=v.now(wt);v.addSeconds(t,n.expireDuration,t);e(n.expireDate)?v.lessThan(n.expireDate,t)&&v.clone(t,n.expireDate):n.expireDate=v.clone(t)}}function fi(n){return function(t){n._contentState=ot.FAILED;n._contentReadyPromise.reject(t);n._contentReadyToProcessPromise.reject(t)}}function ei(n){return function(){return n._priority}}function kt(t,i){if(i.mode!==lt.SCENE3D&&!e(t._boundingVolume2D)){var u=t._boundingVolume.boundingSphere,r=n.projectTo2D(u,i.mapProjection,bt);t._boundingVolume2D=new vt(r.center,r.radius)}return i.mode!==lt.SCENE3D?t._boundingVolume2D:t._boundingVolume}function oi(t,i){if(i.mode!==lt.SCENE3D&&!e(t._contentBoundingVolume2D)){var u=t._contentBoundingVolume.boundingSphere,r=n.projectTo2D(u,i.mapProjection,bt);t._contentBoundingVolume2D=new vt(r.center,r.radius)}return i.mode!==lt.SCENE3D?t._contentBoundingVolume2D:t._contentBoundingVolume}function li(n,i,r){var u=t.fromElements(n[0],n[1],n[2],ii),f=p.fromArray(n,3,hi),o;return(u=w.multiplyByPoint(i,u,u),o=w.getRotation(i,ti),f=p.multiply(o,f,f),e(r))?(r.update(u,f),r):new yt(u,f)}function ai(n,t,i,r){var h=k.unpack(n,0,ri),l=n[4],a=n[5],o=b.fromRectangle(h,l,a,c.WGS84,ci),u=o.center,f=o.halfAxes,s;return(t=w.multiplyTransformation(t,w.inverseTransformation(i,dt),dt),u=w.multiplyByPoint(t,u,u),s=w.getRotation(t,ti),f=p.multiply(s,f,f),e(r)&&r instanceof yt)?(r.update(u,f),r):new yt(u,f)}function vi(n,t,i,r){if(!w.equalsEpsilon(t,i,y.EPSILON8))return ai(n,t,i,r);if(e(r))return r;var u=k.unpack(n,0,ri);return new at({rectangle:u,minimumHeight:n[4],maximumHeight:n[5]})}function yi(n,i,r){var u=t.fromElements(n[0],n[1],n[2],ii),f=n[3],o,s;return(u=w.multiplyByPoint(i,u,u),o=w.getScale(i,si),s=t.maximumComponent(o),f*=s,e(r))?(r.update(u,f),r):new vt(u,f)}function pi(n,t,u){var h=e(n._header.content)&&e(n._header.content.boundingVolume),a=n.hasEmptyContent||n.hasTilesetContent,c=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!h,f,o,l,s;c?(f=n._finalResolution?a?i.DARKGRAY:i.WHITE:i.YELLOW,e(n._debugBoundingVolume)||(n._debugBoundingVolume=n._boundingVolume.createDebugVolume(f)),n._debugBoundingVolume.update(u),o=n._debugBoundingVolume.getGeometryInstanceAttributes("outline"),o.color=r.toValue(f,o.color)):!c&&e(n._debugBoundingVolume)&&(n._debugBoundingVolume=n._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&h?(e(n._debugContentBoundingVolume)||(n._debugContentBoundingVolume=n._contentBoundingVolume.createDebugVolume(i.BLUE)),n._debugContentBoundingVolume.update(u)):!t.debugShowContentBoundingVolume&&e(n._debugContentBoundingVolume)&&(n._debugContentBoundingVolume=n._debugContentBoundingVolume.destroy());t.debugShowViewerRequestVolume&&e(n._viewerRequestVolume)?(e(n._debugViewerRequestVolume)||(n._debugViewerRequestVolume=n._viewerRequestVolume.createDebugVolume(i.YELLOW)),n._debugViewerRequestVolume.update(u)):!t.debugShowViewerRequestVolume&&e(n._debugViewerRequestVolume)&&(n._debugViewerRequestVolume=n._debugViewerRequestVolume.destroy());l=t.debugColorizeTiles&&!n._debugColorizeTiles;s=!t.debugColorizeTiles&&n._debugColorizeTiles;l?(n._debugColorizeTiles=!0,n.color=n._debugColor):s&&(n._debugColorizeTiles=!1,n.color=i.WHITE);n._colorDirty&&(n._colorDirty=!1,n._content.applyDebugSettings(!0,n._color));s&&t.makeStyleDirty()}function wi(n,t,i){var u=n._content,r=n._expiredContent;if(e(r)){if(!n.contentReady){r.update(t,i);return}n._expiredContent.destroy();n._expiredContent=undefined}u.update(t,i)}function bi(n,t){var i=t.clippingPlanes,r=0;e(i)&&n._isClipped&&i.enabled&&(r=i.clippingPlanesState);r!==n._clippingPlanesState&&(n._clippingPlanesState=r,n.clippingPlanesDirty=!0)}var wt,bt,ni,gt;pt._deprecationWarning=s;o(pt.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return f(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){return e(this._color)||(this._color=new i),i.clone(this._color)},set:function(n){this._color=i.clone(n,this._color);this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent||e(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===ot.READY}},contentUnloaded:{get:function(){return this._contentState===ot.UNLOADED}},contentExpired:{get:function(){return this._contentState===ot.EXPIRED}},contentFailed:{get:function(){return this._contentState===ot.FAILED}},contentReadyToProcessPromise:{get:function(){if(e(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(e(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});wt=new v;pt.prototype.updateExpiration=function(){if(e(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var n=v.now(wt);v.lessThan(this.expireDate,n)&&(this._contentState=ot.EXPIRED,this._expiredContent=this._content)}};pt.prototype.requestContent=function(){var n=this,t=this._tileset,i,u,f,o,s,r;return this.hasEmptyContent?!1:(i=this._contentResource.clone(),u=this.contentExpired,u&&i.setQueryParameters({expired:this.expireDate.toString()}),f=new d({throttle:!0,throttleByServer:!0,type:tt.TILES3D,priorityFunction:ei(this),serverKey:this._serverKey}),i.request=f,o=i.fetchArrayBuffer(),!e(o))?!1:(s=this._contentState,this._contentState=ot.LOADING,this._contentReadyToProcessPromise=ft.defer(),this._contentReadyPromise=ft.defer(),u&&(this.expireDate=undefined),r=fi(this),o.then(function(i){if(n.isDestroyed()){r();return}var s=new Uint8Array(i),f=l(s),o=et[f],u;return t._disableSkipLevelOfDetail=t._disableSkipLevelOfDetail||f==="vctr"||f==="geom",e(o)?u=o(t,n,n._contentResource,i,0):(u=et.json(t,n,n._contentResource,i,0),n.hasTilesetContent=!0),n._content=u,n._contentState=ot.PROCESSING,n._contentReadyToProcessPromise.resolve(u),u.readyPromise.then(function(t){if(n.isDestroyed()){r();return}ui(n);n._selectedFrame=0;n.lastStyleTime=0;n._contentState=ot.READY;n._contentReadyPromise.resolve(t)})}).otherwise(function(i){if(f.state===nt.CANCELLED){n._contentState=s;--t.statistics.numberOfPendingRequests;++t.statistics.numberOfAttemptedRequests;return}r(i)}),!0)};pt.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||(this._content=this._content&&this._content.destroy(),this._contentState=ot.UNLOADED,this._contentReadyToProcessPromise=undefined,this._contentReadyPromise=undefined,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};bt=new n;pt.prototype.visibility=function(n,t){var s=n.cullingVolume,f=kt(this,n),o=this._tileset,i=o.clippingPlanes,r;return e(i)&&i.enabled&&(r=i.computeIntersectionWithBoundingVolume(f,o.clippingPlaneOffsetMatrix),this._isClipped=r!==a.INSIDE,r===a.OUTSIDE)?u.MASK_OUTSIDE:s.computeVisibilityWithPlaneMask(f,t)};pt.prototype.contentVisibility=function(n){var i;if(!e(this._contentBoundingVolume))return a.INSIDE;var f=n.cullingVolume,r=oi(this,n),u=this._tileset,t=u.clippingPlanes;return e(t)&&t.enabled&&(i=t.computeIntersectionWithBoundingVolume(r,u.clippingPlaneOffsetMatrix),this._isClipped=i!==a.INSIDE,i===a.OUTSIDE)?a.OUTSIDE:f.computeVisibility(r)};pt.prototype.distanceToTile=function(n){var t=kt(this,n);return t.distanceToCamera(n)};ni=new t;pt.prototype.distanceToTileCenter=function(n){var f=kt(this,n),e=f.boundingVolume,i=t.subtract(e.center,n.camera.positionWC,ni),r=t.magnitude(i),u;return t.divideByScalar(i,r,i),u=t.dot(n.camera.directionWC,i),r*u};pt.prototype.insideViewerRequestVolume=function(n){var t=this._viewerRequestVolume;return!e(t)||t.distanceToCamera(n)===0};var ti=new p,si=new t,hi=new p,ii=new t,ri=new k,ci=new b,dt=new w;return pt.prototype.createBoundingVolume=function(n,t,i){if(!e(n))throw new rt("boundingVolume must be defined");if(e(n.box))return li(n.box,t,i);if(e(n.region))return vi(n.region,t,this._initialTransform,i);if(e(n.sphere))return yi(n.sphere,t,i);throw new rt("boundingVolume must contain a sphere, region, or box");},pt.prototype.updateTransform=function(n){var t,r,i,u;(n=f(n,w.IDENTITY),t=w.multiply(n,this.transform,dt),r=!w.equals(t,this.computedTransform),r)&&(w.clone(t,this.computedTransform),i=this._header,u=this._header.content,this._boundingVolume=this.createBoundingVolume(i.boundingVolume,this.computedTransform,this._boundingVolume),e(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(u.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(i.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())},pt.prototype.update=function(n,t){var i=t.commandList.length;bi(this,n);pi(this,n,t);wi(this,n,t);this._commandsLength=t.commandList.length-i;this.clippingPlanesDirty=!1},gt=[],pt.prototype.process=function(n,t){var i=t.commandList;t.commandList=gt;this._content.update(n,t);gt.length=0;t.commandList=i},pt.prototype.isDestroyed=function(){return!1},pt.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),h(this)},pt});t("Scene/Cesium3DTileContent",["../Core/defineProperties","../Core/DeveloperError"],function(n,t){"use strict";function i(){this.featurePropertiesDirty=!1}return n(i.prototype,{featuresLength:{get:function(){t.throwInstantiationError()}},pointsLength:{get:function(){t.throwInstantiationError()}},trianglesLength:{get:function(){t.throwInstantiationError()}},geometryByteLength:{get:function(){t.throwInstantiationError()}},texturesByteLength:{get:function(){t.throwInstantiationError()}},batchTableByteLength:{get:function(){t.throwInstantiationError()}},innerContents:{get:function(){t.throwInstantiationError()}},readyPromise:{get:function(){t.throwInstantiationError()}},tileset:{get:function(){t.throwInstantiationError()}},tile:{get:function(){t.throwInstantiationError()}},url:{get:function(){t.throwInstantiationError()}},batchTable:{get:function(){t.throwInstantiationError()}}}),i.prototype.hasProperty=function(){t.throwInstantiationError()},i.prototype.getFeature=function(){t.throwInstantiationError()},i.prototype.applyDebugSettings=function(){t.throwInstantiationError()},i.prototype.applyStyle=function(){t.throwInstantiationError()},i.prototype.update=function(){t.throwInstantiationError()},i.prototype.isDestroyed=function(){t.throwInstantiationError()},i.prototype.destroy=function(){t.throwInstantiationError()},i});t("Scene/Cesium3DTileOptimizations",["../Core/Cartesian3","../Core/Check","./Cesium3DTileOptimizationHint","./TileBoundingRegion","./TileOrientedBoundingBox"],function(n,t,i,r,u){"use strict";var f={},e=new n;return f.checkChildrenWithinParent=function(f){var s,c,y,l,w,b;t.typeOf.object("tile",f);var v=f.children,k=v.length,a=f.boundingVolume;if(a instanceof u||a instanceof r)for(s=a._orientedBoundingBox,f._optimChildrenWithinParent=i.USE_OPTIMIZATION,c=0;c<k;++c){if(y=v[c],l=y.boundingVolume,!(l instanceof u||l instanceof r)){f._optimChildrenWithinParent=i.SKIP_OPTIMIZATION;break}var h=l._orientedBoundingBox,o=n.subtract(h.center,s.center,e),p=n.magnitude(o);if(n.divideByScalar(o,p,o),w=Math.abs(s.halfAxes[0]*o.x)+Math.abs(s.halfAxes[1]*o.y)+Math.abs(s.halfAxes[2]*o.z)+Math.abs(s.halfAxes[3]*o.x)+Math.abs(s.halfAxes[4]*o.y)+Math.abs(s.halfAxes[5]*o.z)+Math.abs(s.halfAxes[6]*o.x)+Math.abs(s.halfAxes[7]*o.y)+Math.abs(s.halfAxes[8]*o.z),b=Math.abs(h.halfAxes[0]*o.x)+Math.abs(h.halfAxes[1]*o.y)+Math.abs(h.halfAxes[2]*o.z)+Math.abs(h.halfAxes[3]*o.x)+Math.abs(h.halfAxes[4]*o.y)+Math.abs(h.halfAxes[5]*o.z)+Math.abs(h.halfAxes[6]*o.x)+Math.abs(h.halfAxes[7]*o.y)+Math.abs(h.halfAxes[8]*o.z),w<=b+p){f._optimChildrenWithinParent=i.SKIP_OPTIMIZATION;break}}return f._optimChildrenWithinParent===i.USE_OPTIMIZATION},f});t("Scene/Cesium3DTilesetCache",["../Core/defined","../Core/DoublyLinkedList"],function(n,t){"use strict";function i(){this._list=new t;this._sentinel=this._list.add();this._trimTiles=!1}return i.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)},i.prototype.touch=function(t){var i=t.cacheNode;n(i)&&this._list.splice(this._sentinel,i)},i.prototype.add=function(t){n(t.cacheNode)||(t.cacheNode=this._list.add(t))},i.prototype.unloadTile=function(t,i,r){var u=i.cacheNode;n(u)&&(this._list.remove(u),i.cacheNode=undefined,r(t,i))},i.prototype.unloadTiles=function(n,t){var u=this._trimTiles,r;this._trimTiles=!1;for(var f=this._list,e=n.maximumMemoryUsage*1048576,o=this._sentinel,i=f.head;i!==o&&(n.totalMemoryUsageInBytes>e||u);)r=i.item,i=i.next,this.unloadTile(n,r,t)},i.prototype.trim=function(){this._trimTiles=!0},i});t("Scene/Cesium3DTilesetStatistics",["../Core/defined"],function(n){"use strict";function t(){this.selected=0;this.visited=0;this.numberOfCommands=0;this.numberOfAttemptedRequests=0;this.numberOfPendingRequests=0;this.numberOfTilesProcessing=0;this.numberOfTilesWithContentReady=0;this.numberOfTilesTotal=0;this.numberOfFeaturesSelected=0;this.numberOfFeaturesLoaded=0;this.numberOfPointsSelected=0;this.numberOfPointsLoaded=0;this.numberOfTrianglesSelected=0;this.numberOfTilesStyled=0;this.numberOfFeaturesStyled=0;this.numberOfTilesCulledWithChildrenUnion=0;this.geometryByteLength=0;this.texturesByteLength=0;this.batchTableByteLength=0}function i(t,r,u,f){var h=r.innerContents,e=r.pointsLength,c=r.trianglesLength,o=r.featuresLength,l=r.geometryByteLength,a=r.texturesByteLength,v=r.batchTableByteLength,y,s;if(f?(t.numberOfFeaturesLoaded+=u?-o:o,t.numberOfPointsLoaded+=u?-e:e,t.geometryByteLength+=u?-l:l,t.texturesByteLength+=u?-a:a,t.batchTableByteLength+=u?-v:v):(t.numberOfFeaturesSelected+=u?-o:o,t.numberOfPointsSelected+=u?-e:e,t.numberOfTrianglesSelected+=u?-c:c),n(h))for(y=h.length,s=0;s<y;++s)i(t,h[s],u,f)}return t.prototype.clear=function(){this.selected=0;this.visited=0;this.numberOfCommands=0;this.numberOfAttemptedRequests=0;this.numberOfFeaturesSelected=0;this.numberOfPointsSelected=0;this.numberOfTrianglesSelected=0;this.numberOfTilesStyled=0;this.numberOfFeaturesStyled=0;this.numberOfTilesCulledWithChildrenUnion=0},t.prototype.incrementSelectionCounts=function(n){i(this,n,!1,!1)},t.prototype.incrementLoadCounts=function(n){i(this,n,!1,!0)},t.prototype.decrementLoadCounts=function(n){i(this,n,!0,!0)},t.clone=function(n,t){t.selected=n.selected;t.visited=n.visited;t.numberOfCommands=n.numberOfCommands;t.selected=n.selected;t.numberOfAttemptedRequests=n.numberOfAttemptedRequests;t.numberOfPendingRequests=n.numberOfPendingRequests;t.numberOfTilesProcessing=n.numberOfTilesProcessing;t.numberOfTilesWithContentReady=n.numberOfTilesWithContentReady;t.numberOfTilesTotal=n.numberOfTilesTotal;t.numberOfFeaturesSelected=n.numberOfFeaturesSelected;t.numberOfFeaturesLoaded=n.numberOfFeaturesLoaded;t.numberOfPointsSelected=n.numberOfPointsSelected;t.numberOfPointsLoaded=n.numberOfPointsLoaded;t.numberOfTrianglesSelected=n.numberOfTrianglesSelected;t.numberOfTilesStyled=n.numberOfTilesStyled;t.numberOfFeaturesStyled=n.numberOfFeaturesStyled;t.numberOfTilesCulledWithChildrenUnion=n.numberOfTilesCulledWithChildrenUnion;t.geometryByteLength=n.geometryByteLength;t.texturesByteLength=n.texturesByteLength;t.batchTableByteLength=n.batchTableByteLength},t});t("Scene/Cesium3DTilesetTraversal",["../Core/CullingVolume","../Core/defaultValue","../Core/defined","../Core/freezeObject","../Core/Intersect","../Core/ManagedArray","../Core/Math","../Core/OrthographicFrustum","./Cesium3DTileOptimizationHint","./Cesium3DTileRefine","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function ft(){}function a(n){return n._visible&&n._inRequestVolume}function lt(n,t,i){var r=n._maximumScreenSpaceError,u=n._maximumScreenSpaceError;ut(n,t,r,u,i)}function at(n,t,i){var r=Number.MAX_VALUE,u=n._maximumScreenSpaceError;ut(n,t,r,u,i);ht(n,t,i)}function vt(n,t,i){var r=Math.max(n.baseScreenSpaceError,n.maximumScreenSpaceError),u=n.maximumScreenSpaceError;ut(n,t,r,u,i);ht(n,t,i)}function b(n){return n._skipLevelOfDetail}function yt(n,t){n._emptyTiles.push(t)}function pt(t,i){return t._visibilityPlaneMask===n.MASK_INSIDE||t.contentVisibility(i)!==u.OUTSIDE}function k(n,t,i){if(pt(t,i)){var r=t.content;r.featurePropertiesDirty?(r.featurePropertiesDirty=!1,t.lastStyleTime=0,n._selectedTilesToStyle.push(t)):t._selectedFrame<i.frameNumber-1&&n._selectedTilesToStyle.push(t);t._selectedFrame=i.frameNumber;n._selectedTiles.push(t)}}function wt(n,t,i){var u=w.stack,f,r;for(u.push(t);u.length>0;){w.stackMaximumLength=Math.max(w.stackMaximumLength,u.length);var o=u.pop(),e=o.children,s=e.length;for(f=0;f<s;++f)r=e[f],a(r)&&(r.contentAvailable?(tt(n,r,i),nt(n,r,i),k(n,r,i)):r._depth-t._depth<ct&&u.push(r))}}function g(n,t,r){if(!b(n)){t.contentAvailable&&k(n,t,r);return}var u=t.contentAvailable?t:t._ancestorWithContentAvailable;i(u)?u._shouldSelect=!0:wt(n,t,r)}function bt(n,t,i){++n._statistics.visited;t._visitedFrame=i.frameNumber}function nt(n,t,i){t._touchedFrame!==i.frameNumber&&(n._cache.touch(t),t._touchedFrame=i.frameNumber)}function kt(n,t){if(t.refine===h.ADD)return t._distanceToCamera;var r=t.parent,u=i(r)&&(!b(n)||t._screenSpaceError===0||r.hasTilesetContent),f=u?r._screenSpaceError:t._screenSpaceError,e=n.root._screenSpaceError;return e-f}function v(n,t,i){(st(t)||t.contentExpired)&&(t._requestedFrame=i.frameNumber,t._priority=kt(n,t),n._requestedTiles.push(t))}function it(n,t,r,u){var y,p,h,w;if(t===0)return 0;var l=u.camera,f=l.frustum,a=u.context,v=a.drawingBufferHeight,s;if(u.mode===c.SCENE2D||f instanceof o)i(f._offCenterFrustum)&&(f=f._offCenterFrustum),y=a.drawingBufferWidth,p=Math.max(f.top-f.bottom,f.right-f.left)/Math.max(y,v),s=t/p;else if(h=Math.max(r._distanceToCamera,e.EPSILON7),w=l.frustum.sseDenominator,s=t*v/(h*w),n.dynamicScreenSpaceError){var b=n._dynamicScreenSpaceErrorComputedDensity,k=n.dynamicScreenSpaceErrorFactor,d=e.fog(h,b)*k;s-=d}return s}function et(t,r,u){if(r._updatedVisibilityFrame!==u.frameNumber){var f=r.parent,e=i(f)?f.computedTransform:t._modelMatrix,o=i(f)?f._visibilityPlaneMask:n.MASK_INDETERMINATE;r.updateTransform(e);r._distanceToCamera=r.distanceToTile(u);r._centerZDepth=r.distanceToTileCenter(u);r._screenSpaceError=it(t,r.geometricError,r,u);r._visibilityPlaneMask=r.visibility(u,o);r._visible=r._visibilityPlaneMask!==n.MASK_OUTSIDE;r._inRequestVolume=r.insideViewerRequestVolume(u);r._updatedVisibilityFrame=u.frameNumber}}function dt(n,t,i){for(var f,r=!1,e=t.children,o=e.length,u=0;u<o;++u)f=e[u],et(n,f,i),r=r||a(f);return r}function gt(n,t,r){var u=t.parent,f;return!i(u)||u.hasTilesetContent||u.refine!==h.ADD?!1:(f=it(n,u.geometricError,t,r),f<=n._maximumScreenSpaceError)}function ot(n,t,i){var r,u,f,e;if(et(n,t,i),a(t)){if(r=t.children.length>0,t.hasTilesetContent&&r){u=t.children[0];ot(n,u,i);t._visible=u._visible;return}if(gt(n,t,i)){t._visible=!1;return}if(f=t.refine===h.REPLACE,e=t._optimChildrenWithinParent===s.USE_OPTIMIZATION,f&&e&&r&&!dt(n,t,i)){++n._statistics.numberOfTilesCulledWithChildrenUnion;t._visible=!1;return}}}function tt(n,t,r){var u,f;ot(n,t,r);t.updateExpiration();t._shouldSelect=!1;t._finalResolution=!0;t._ancestorWithContent=undefined;t._ancestorWithContentAvailable=undefined;u=t.parent;i(u)&&(f=!st(u)||u._requestedFrame===r.frameNumber,t._ancestorWithContent=f?u:u._ancestorWithContent,t._ancestorWithContentAvailable=u.contentAvailable?u:u._ancestorWithContentAvailable)}function d(n){return n.hasEmptyContent||n.hasTilesetContent}function st(n){return!d(n)&&n.contentUnloaded}function ni(n,t){var r=t._ancestorWithContent;return!n.immediatelyLoadDesiredLevelOfDetail&&i(r)&&t._screenSpaceError<r._screenSpaceError/n.skipScreenSpaceErrorFactor&&t._depth>r._depth+n.skipLevels}function ti(n,t){return t._distanceToCamera===0&&n._distanceToCamera===0?t._centerZDepth-n._centerZDepth:t._distanceToCamera-n._distanceToCamera}function ii(n,t,i,r){for(var p=t.refine===h.REPLACE,e=t.children,s=e.length,u,y,f=0;f<s;++f)tt(n,e[f],r);e.sort(ti);var c=!b(n)&&p&&!d(t),o=!0,l=!1;for(f=0;f<s;++f)u=e[f],a(u)?(i.push(u),l=!0):(c||n.loadSiblings)&&(v(n,u,r),nt(n,u,r)),c&&(y=u._inRequestVolume?d(u)?ui(n,u,r):u.contentAvailable:!1,o=o&&y);return l||(o=!1),o}function ri(n,t,r){return b(n)?n.immediatelyLoadDesiredLevelOfDetail?!1:i(t._ancestorWithContent)?t._screenSpaceError===0?t.parent._screenSpaceError>r:t._screenSpaceError>r:!0:!0}function rt(n,t){return t.children.length===0?!1:t.hasTilesetContent?!t.contentExpired:t._screenSpaceError>n._maximumScreenSpaceError}function ut(n,t,r,u,f){var o=y.stack,s;for(o.push(t);o.length>0;){y.stackMaximumLength=Math.max(y.stackMaximumLength,o.length);var e=o.pop(),p=ri(n,e,r),w=e.refine===h.ADD,b=e.refine===h.REPLACE,l=e.parent,a=!i(l)||l._refines,c=!1;rt(n,e)&&(c=ii(n,e,o,f)&&a);s=!c&&a;d(e)?(yt(n,e,f),v(n,e,f),s&&g(n,e,f)):w?(g(n,e,f),v(n,e,f)):b&&(p?(v(n,e,f),s&&g(n,e,f)):s?(g(n,e,f),v(n,e,f)):ni(n,e)&&v(n,e,f));bt(n,e,f);nt(n,e,f);e._refines=c;e._updatedVisibilityFrame=0}}function ui(n,t,i){var e=!0,u=p.stack,f,h;for(u.push(t);u.length>0;){p.stackMaximumLength=Math.max(p.stackMaximumLength,u.length);var r=u.pop(),o=r.children,c=o.length,s=d(r)&&rt(n,r);if(s||r.contentAvailable||(e=!1),tt(n,r,i),a(r)||(v(n,r,i),nt(n,r,i)),s)for(f=0;f<c;++f)h=o[f],u.push(h)}return e}function ht(n,t,r){var f=l.stack,e=l.ancestorStack,v,o,u,s,c;for(f.push(t);f.length>0||e.length>0;){if(l.stackMaximumLength=Math.max(l.stackMaximumLength,f.length),l.ancestorStackMaximumLength=Math.max(l.ancestorStackMaximumLength,e.length),e.length>0&&(o=e.peek(),o._stackLength===f.length)){e.pop();o!==v&&(o._finalResolution=!1);k(n,o,r);continue}if(u=f.pop(),i(u)){var w=u.refine===h.ADD,b=u._shouldSelect,y=u.children,d=y.length,p=rt(n,u);if(b)if(w)k(n,u,r);else{if(u._selectionDepth=e.length,u._selectionDepth>0&&(n._hasMixedContent=!0),v=u,!p){k(n,u,r);continue}e.push(u);u._stackLength=f.length}if(p)for(s=0;s<d;++s)c=y[s],a(c)&&f.push(c)}}}var y={stack:new f,stackMaximumLength:0},p={stack:new f,stackMaximumLength:0},w={stack:new f,stackMaximumLength:0},l={stack:new f,stackMaximumLength:0,ancestorStack:new f,ancestorStackMaximumLength:0},ct=2;return ft.selectTiles=function(n,t){if(!n.debugFreezeFrame){n._selectedTiles.length=0;n._selectedTilesToStyle.length=0;n._emptyTiles.length=0;n._hasMixedContent=!1;var i=n.root;(tt(n,i,t),a(i))&&(it(n,n._geometricError,i,t)<=n._maximumScreenSpaceError||(b(n)?n.immediatelyLoadDesiredLevelOfDetail?at(n,i,t):vt(n,i,t):lt(n,i,t),y.stack.trim(y.stackMaximumLength),p.stack.trim(p.stackMaximumLength),w.stack.trim(w.stackMaximumLength),l.stack.trim(l.stackMaximumLength),l.ancestorStack.trim(l.ancestorStackMaximumLength)))}},ft});t("Scene/Cesium3DTileStyleEngine",["../Core/defined","../Core/defineProperties"],function(n,t){"use strict";function i(){this._style=undefined;this._styleDirty=!1;this._lastStyleTime=0}return t(i.prototype,{style:{get:function(){return this._style},set:function(n){this._style=n;this._styleDirty=!0}}}),i.prototype.makeDirty=function(){this._styleDirty=!0},i.prototype.applyStyle=function(t,i){var f,r,u,e;if(t.ready&&(!n(this._style)||this._style.ready)){f=this._styleDirty;i.passes.render&&(this._styleDirty=!1);f&&++this._lastStyleTime;var o=this._lastStyleTime,s=t._statistics,h=f?t._selectedTiles:t._selectedTilesToStyle,c=h.length;for(r=0;r<c;++r)u=h[r],u.lastStyleTime!==o&&(e=u.content,u.lastStyleTime=o,e.applyStyle(this._style),s.numberOfFeaturesStyled+=e.featuresLength,++s.numberOfTilesStyled)}},i});t("Shaders/PostProcessStages/PointCloudEyeDomeLighting",[],function(){"use strict";return"#extension GL_EXT_frag_depth : enable\nuniform sampler2D u_pointCloud_colorGBuffer;\nuniform sampler2D u_pointCloud_depthGBuffer;\nuniform vec3 u_distancesAndEdlStrength;\nvarying vec2 v_textureCoordinates;\nvec2 neighborContribution(float log2Depth, vec2 padding)\n{\nfloat depthOrLogDepth = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates + padding));\nif (depthOrLogDepth == 0.0) {\nreturn vec2(0.0);\n}\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(v_textureCoordinates + padding, depthOrLogDepth);\nreturn vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);\n}\nvoid main()\n{\nfloat depthOrLogDepth = czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates));\nvec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);\neyeCoordinate /= eyeCoordinate.w;\nfloat log2Depth = log2(-eyeCoordinate.z);\nif (depthOrLogDepth == 0.0)\n{\ndiscard;\n}\nvec4 color = texture2D(u_pointCloud_colorGBuffer, v_textureCoordinates);\nfloat distX = u_distancesAndEdlStrength.x;\nfloat distY = u_distancesAndEdlStrength.y;\nvec2 responseAndCount = vec2(0.0);\nresponseAndCount += neighborContribution(log2Depth, vec2(0, distY));\nresponseAndCount += neighborContribution(log2Depth, vec2(distX, 0));\nresponseAndCount += neighborContribution(log2Depth, vec2(0, -distY));\nresponseAndCount += neighborContribution(log2Depth, vec2(-distX, 0));\nfloat response = responseAndCount.x / responseAndCount.y;\nfloat shade = exp(-response * 300.0 * u_distancesAndEdlStrength.z);\ncolor.rgb *= shade;\ngl_FragColor = vec4(color);\n#ifdef LOG_DEPTH\nczm_writeLogDepth(1.0 + (czm_projection * vec4(eyeCoordinate.xyz, 1.0)).w);\n#else\ngl_FragDepthEXT = czm_eyeToWindowCoordinates(vec4(eyeCoordinate.xyz, 1.0)).z;\n#endif\n}\n"});t("Scene/PointCloudEyeDomeLighting",["../Core/Cartesian3","../Core/Color","../Core/defined","../Core/destroyObject","../Core/FeatureDetection","../Core/PixelFormat","../Core/PrimitiveType","../Renderer/ClearCommand","../Renderer/DrawCommand","../Renderer/Framebuffer","../Renderer/Pass","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/Sampler","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Scene/BlendingState","../Shaders/PostProcessStages/PointCloudEyeDomeLighting"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){"use strict";function nt(){this._framebuffer=undefined;this._colorGBuffer=undefined;this._depthGBuffer=undefined;this._depthTexture=undefined;this._drawCommand=undefined;this._clearCommand=undefined;this._strength=1;this._radius=1}function it(){return new v({wrapS:k.CLAMP_TO_EDGE,wrapT:k.CLAMP_TO_EDGE,minificationFilter:b.NEAREST,magnificationFilter:w.NEAREST})}function rt(n){var t=n._framebuffer;i(t)&&(n._colorGBuffer.destroy(),n._depthGBuffer.destroy(),n._depthTexture.destroy(),t.destroy(),n._framebuffer=undefined,n._colorGBuffer=undefined,n._depthGBuffer=undefined,n._depthTexture=undefined,n._drawCommand=undefined,n._clearCommand=undefined)}function ft(n,t){var i=t.drawingBufferWidth,r=t.drawingBufferHeight,u=new p({context:t,width:i,height:r,pixelFormat:f.RGBA,pixelDatatype:l.UNSIGNED_BYTE,sampler:it()}),e=new p({context:t,width:i,height:r,pixelFormat:f.RGBA,pixelDatatype:l.UNSIGNED_BYTE,sampler:it()}),o=new p({context:t,width:i,height:r,pixelFormat:f.DEPTH_COMPONENT,pixelDatatype:l.UNSIGNED_INT,sampler:it()});n._framebuffer=new h({context:t,colorTextures:[u,e],depthTexture:o,destroyAttachments:!1});n._colorGBuffer=u;n._depthGBuffer=e;n._depthTexture=o}function et(n,i){var r=g,u={u_pointCloud_colorGBuffer:function(){return n._colorGBuffer},u_pointCloud_depthGBuffer:function(){return n._depthGBuffer},u_distancesAndEdlStrength:function(){return tt.x=n._radius/i.drawingBufferWidth,tt.y=n._radius/i.drawingBufferHeight,tt.z=n._strength,tt}},f=a.fromCache({blending:d.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0}});n._drawCommand=i.createViewportQuadCommand(r,{uniformMap:u,renderState:f,pass:c.CESIUM_3D_TILE,owner:n});n._clearCommand=new o({framebuffer:n._framebuffer,color:new t(0,0,0,0),depth:1,renderState:a.fromCache(),pass:c.CESIUM_3D_TILE,owner:n})}function ot(n,t){var f=t.drawingBufferWidth,e=t.drawingBufferHeight,r=n._colorGBuffer,u=!1,o=i(r)&&(r.width!==f||r.height!==e);return(!i(r)||o)&&(rt(n),ft(n,t),et(n,t),u=!0),u}function ut(n){return n.drawBuffers&&n.fragmentDepth}function st(n,t){var u=n.shaderCache.getDerivedShaderProgram(t,"EC"),f,r;return i(u)||(f=t._attributeLocations,r=t.fragmentShaderSource.clone(),r.sources=r.sources.map(function(n){return n=y.replaceMain(n,"czm_point_cloud_post_process_main"),n.replace(/gl_FragColor/g,"gl_FragData[0]")}),r.sources.unshift("#extension GL_EXT_draw_buffers : enable \n"),r.sources.push("void main() \n{ \n    czm_point_cloud_post_process_main(); \n    gl_FragData[1] = czm_packDepth(gl_FragCoord.z); \n}"),u=n.shaderCache.createDerivedShaderProgram(t,"EC",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:r,attributeLocations:f})),u}var tt=new n;return nt.isSupported=ut,nt.prototype.update=function(n,t,r){var l=n.passes,y=l.pick&&!l.render,f,u,a,v;if(ut(n.context)&&!y){this._strength=r.eyeDomeLightingStrength;this._radius=r.eyeDomeLightingRadius;for(var p=ot(this,n.context),h=n.commandList,w=h.length,o=t;o<w;++o)(f=h[o],f.primitiveType===e.POINTS&&f.pass!==c.TRANSLUCENT)&&(u=f.derivedCommands.pointCloudProcessor,(!i(u)||f.dirty||p||u.framebuffer!==this._framebuffer)&&(u=s.shallowClone(f),f.derivedCommands.pointCloudProcessor=u,u.framebuffer=this._framebuffer,u.shaderProgram=st(n.context,f.shaderProgram),u.castShadows=!1,u.receiveShadows=!1),h[o]=u);a=this._clearCommand;v=this._drawCommand;h.push(v);h.push(a)}},nt.prototype.isDestroyed=function(){return!1},nt.prototype.destroy=function(){return rt(this),r(this)},nt});t("Scene/PointCloudShading",["../Core/defaultValue","./PointCloudEyeDomeLighting"],function(n,t){"use strict";function i(t){var i=n(t,{});this.attenuation=n(i.attenuation,!1);this.geometricErrorScale=n(i.geometricErrorScale,1);this.maximumAttenuation=i.maximumAttenuation;this.baseResolution=i.baseResolution;this.eyeDomeLighting=n(i.eyeDomeLighting,!0);this.eyeDomeLightingStrength=n(i.eyeDomeLightingStrength,1);this.eyeDomeLightingRadius=n(i.eyeDomeLightingRadius,1)}return i.isSupported=function(n){return t.isSupported(n.context)},i});t("Scene/Cesium3DTileset",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/DeveloperError","../Core/DoublyLinkedList","../Core/Ellipsoid","../Core/Event","../Core/JulianDate","../Core/ManagedArray","../Core/Math","../Core/Matrix4","../Core/Resource","../Core/RuntimeError","../Core/Transforms","../Renderer/ClearCommand","../Renderer/Pass","../ThirdParty/when","./Axis","./Cesium3DTile","./Cesium3DTileColorBlendMode","./Cesium3DTileContentState","./Cesium3DTileOptimizations","./Cesium3DTileRefine","./Cesium3DTilesetCache","./Cesium3DTilesetStatistics","./Cesium3DTilesetTraversal","./Cesium3DTileStyleEngine","./ClippingPlaneCollection","./LabelCollection","./PointCloudEyeDomeLighting","./PointCloudShading","./SceneMode","./ShadowMode","./TileBoundingRegion","./TileBoundingSphere","./TileOrientedBoundingBox"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt){"use strict";function ni(n){n=u(n,u.EMPTY_OBJECT);r.defined("options.url",n.url);this._url=undefined;this._basePath=undefined;this._root=undefined;this._asset=undefined;this._properties=undefined;this._geometricError=undefined;this._extensionsUsed=undefined;this._gltfUpAxis=undefined;this._cache=new st;this._processingQueue=[];this._selectedTiles=[];this._emptyTiles=[];this._requestedTiles=[];this._selectedTilesToStyle=[];this._loadTimestamp=undefined;this._timeSinceLoad=0;this._extras=undefined;this._cullWithChildrenBounds=u(n.cullWithChildrenBounds,!0);this._allTilesAdditive=!0;this._hasMixedContent=!1;this._backfaceCommands=new y;this._maximumScreenSpaceError=u(n.maximumScreenSpaceError,16);this._maximumMemoryUsage=u(n.maximumMemoryUsage,512);this._styleEngine=new lt;this._modelMatrix=f(n.modelMatrix)?w.clone(n.modelMatrix):w.clone(w.IDENTITY);this._statistics=new ht;this._statisticsLastColor=new ht;this._statisticsLastPick=new ht;this._tilesLoaded=!1;this._initialTilesLoaded=!1;this._tileDebugLabels=undefined;this._readyPromise=tt.defer();this._classificationType=n.classificationType;this._ellipsoid=u(n.ellipsoid,l.WGS84);this._useBoundingSphereForClipping=!1;this._clippingPlaneOffsetMatrix=undefined;this.dynamicScreenSpaceError=u(n.dynamicScreenSpaceError,!1);this.dynamicScreenSpaceErrorDensity=.00278;this.dynamicScreenSpaceErrorFactor=4;this.dynamicScreenSpaceErrorHeightFalloff=.25;this._dynamicScreenSpaceErrorComputedDensity=0;this.shadows=u(n.shadows,bt.ENABLED);this.show=u(n.show,!0);this.colorBlendMode=ut.HIGHLIGHT;this.colorBlendAmount=.5;this.pointCloudShading=new pt(n.pointCloudShading);this._pointCloudEyeDomeLighting=new yt;this.loadProgress=new a;this.allTilesLoaded=new a;this.initialTilesLoaded=new a;this.tileLoad=new a;this.tileUnload=new a;this.tileFailed=new a;this.tileVisible=new a;this.skipLevelOfDetail=u(n.skipLevelOfDetail,!0);this._skipLevelOfDetail=this.skipLevelOfDetail;this._disableSkipLevelOfDetail=!1;this.baseScreenSpaceError=u(n.baseScreenSpaceError,1024);this.skipScreenSpaceErrorFactor=u(n.skipScreenSpaceErrorFactor,16);this.skipLevels=u(n.skipLevels,1);this.immediatelyLoadDesiredLevelOfDetail=u(n.immediatelyLoadDesiredLevelOfDetail,!1);this.loadSiblings=u(n.loadSiblings,!1);this._clippingPlanes=undefined;this.clippingPlanes=n.clippingPlanes;this.debugFreezeFrame=u(n.debugFreezeFrame,!1);this.debugColorizeTiles=u(n.debugColorizeTiles,!1);this.debugWireframe=u(n.debugWireframe,!1);this.debugShowBoundingVolume=u(n.debugShowBoundingVolume,!1);this.debugShowContentBoundingVolume=u(n.debugShowContentBoundingVolume,!1);this.debugShowViewerRequestVolume=u(n.debugShowViewerRequestVolume,!1);this._tileDebugLabels=undefined;this.debugPickedTileLabelOnly=!1;this.debugPickedTile=undefined;this.debugPickPosition=undefined;this.debugShowGeometricError=u(n.debugShowGeometricError,!1);this.debugShowRenderingStatistics=u(n.debugShowRenderingStatistics,!1);this.debugShowMemoryUsage=u(n.debugShowMemoryUsage,!1);this.debugShowUrl=u(n.debugShowUrl,!1);this._credits=undefined;var t=this,i;tt(n.url).then(function(n){var r;return i=b.createIfNeeded(n),t._credits=i.credits,i.extension==="json"?r=i.getBaseUri(!0):i.isDataUri&&(r=""),t._url=i.url,t._basePath=r,ni.loadJson(i)}).then(function(n){t._root=t.loadTileset(i,n);var r=f(n.asset.gltfUpAxis)?it.fromName(n.asset.gltfUpAxis):it.Y;t._asset=n.asset;t._properties=n.properties;t._geometricError=n.geometricError;t._extensionsUsed=n.extensionsUsed;t._gltfUpAxis=r;t._extras=n.extras;f(n.root.transform)||(t._useBoundingSphereForClipping=!0,t._clippingPlaneOffsetMatrix=d.eastNorthUpToFixedFrame(t.boundingSphere.center));t._readyPromise.resolve(t)}).otherwise(function(n){t._readyPromise.reject(n)})}function pi(n,r){var c,f,l,e,o,u=r.camera,a=n._root,s=a.contentBoundingVolume,tt,it,y,b,d;if(s instanceof kt)c=t.normalize(u.positionWC,fi),f=u.directionWC,l=u.positionCartographic.height,e=s.minimumHeight,o=s.maximumHeight;else{var v=w.inverseTransformation(a.computedTransform,li),g=r.mapProjection.ellipsoid,nt=s.boundingVolume,h=w.multiplyByPoint(v,nt.center,ai);t.magnitude(h)>g.minimumRadius?(tt=i.fromCartesian(h,g,ci),c=t.normalize(u.positionWC,fi),f=u.directionWC,l=u.positionCartographic.height,e=0,o=tt.height*2):(it=w.multiplyByPoint(v,u.positionWC,vi),c=t.UNIT_Z,f=w.multiplyByPointAsVector(v,u.directionWC,yi),f=t.normalize(f,f),l=it.z,s instanceof gt?(y=a._header.boundingVolume.box[11],e=h.z-y,o=h.z+y):s instanceof dt&&(b=nt.radius,e=h.z-b,o=h.z+b))}var ut=n.dynamicScreenSpaceErrorHeightFalloff,rt=e+(o-e)*ut,ft=o,et=p.clamp((l-rt)/(ft-rt),0,1),ot=Math.abs(t.dot(f,c)),k=1-ot;k=k*(1-et);d=n.dynamicScreenSpaceErrorDensity;d*=k;n._dynamicScreenSpaceErrorComputedDensity=d}function wi(n,t){if(!t.hasEmptyContent){var i=n._statistics,r=t.contentExpired,u=t.requestContent();if(!u){++i.numberOfAttemptedRequests;return}r&&(t.hasTilesetContent?fr(n,t):(i.decrementLoadCounts(t.content),--n._statistics.numberOfTilesWithContentReady));++i.numberOfPendingRequests;t.contentReadyToProcessPromise.then(di(n,t));t.contentReadyPromise.then(nr(n,t)).otherwise(gi(n,t))}}function bi(n,t){return n._priority-t._priority}function ki(n){var i=n._requestedTiles,r=i.length,t;for(i.sort(bi),t=0;t<r;++t)wi(n,i[t])}function di(n,t){return function(){n._processingQueue.push(t);--n._statistics.numberOfPendingRequests;++n._statistics.numberOfTilesProcessing}}function gi(n,t){return function(i){n._processingQueue.indexOf(t)>=0?--n._statistics.numberOfTilesProcessing:--n._statistics.numberOfPendingRequests;var r=t._contentResource.url,u=f(i.message)?i.message:i.toString();n.tileFailed.numberOfListeners>0?n.tileFailed.raiseEvent({url:r,message:u}):(console.log("A 3D tile failed to load: "+r),console.log("Error: "+u))}}function nr(n,t){return function(){--n._statistics.numberOfTilesProcessing;t.hasTilesetContent||(n._statistics.incrementLoadCounts(t.content),++n._statistics.numberOfTilesWithContentReady,n._cache.add(t));n.tileLoad.raiseEvent(t)}}function tr(n){for(var u,t=n._processingQueue,f=t.length,i=0,r=0;r<f;++r){if(u=t[r],u._contentState!==ft.PROCESSING){++i;continue}i>0&&(t[r-i]=u)}t.length-=i}function ir(n,t){var r,u,i;for(tr(n),r=n._processingQueue,u=r.length,i=0;i<u;++i)r[i].process(n,t)}function oi(n){var t=n/1048576;return t<1?t.toLocaleString(undefined,ei):Math.round(t).toLocaleString()}function ii(n){var r=n.boundingVolume.boundingVolume,i=r.halfAxes,o=r.radius,u=t.clone(r.center,ti),e;return f(i)?(u.x+=.75*(i[0]+i[3]+i[6]),u.y+=.75*(i[1]+i[4]+i[7]),u.z+=.75*(i[2]+i[5]+i[8])):f(o)&&(e=t.normalize(r.center,ti),e=t.multiplyByScalar(e,.75*o,ti),u=t.add(e,r.center,ti)),u}function ri(n,t,i){var r="",u=0,f,e,o;return t.debugShowGeometricError&&(r+="\nGeometric error: "+n.geometricError,u++),t.debugShowRenderingStatistics&&(r+="\nCommands: "+n.commandsLength,u++,f=n.content.pointsLength,f>0&&(r+="\nPoints: "+n.content.pointsLength,u++),e=n.content.trianglesLength,e>0&&(r+="\nTriangles: "+n.content.trianglesLength,u++),r+="\nFeatures: "+n.content.featuresLength,u++),t.debugShowMemoryUsage&&(r+="\nTexture Memory: "+oi(n.content.texturesByteLength),r+="\nGeometry Memory: "+oi(n.content.geometryByteLength),u+=2),t.debugShowUrl&&(r+="\nUrl: "+n._header.content.uri,u++),o={text:r.substring(1),position:i,font:19-u+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY},t._tileDebugLabels.add(o)}function rr(t,i){var r,u,e=t._selectedTiles,c=e.length,o=t._emptyTiles,l=o.length,s,h;if(t._tileDebugLabels.removeAll(),t.debugPickedTileLabelOnly)f(t.debugPickedTile)&&(s=f(t.debugPickPosition)?t.debugPickPosition:ii(t.debugPickedTile),h=ri(t.debugPickedTile,t,s),h.pixelOffset=new n(15,-15));else{for(r=0;r<c;++r)u=e[r],ri(u,t,ii(u));for(r=0;r<l;++r)u=o[r],u.hasTilesetContent&&ri(u,t,ii(u))}t._tileDebugLabels.update(i)}function ur(n,t){var e,w,h,c,o;n._styleEngine.applyStyle(n,t);var s=n._statistics,r=t.commandList,l=r.length,a=n._selectedTiles,v=a.length,y=n._emptyTiles,b=y.length,k=n.tileVisible,i,u,p=n._skipLevelOfDetail&&n._hasMixedContent&&t.context.stencilBuffer&&v>0;for(n._backfaceCommands.length=0,p&&r.push(si),e=r.length,i=0;i<v;++i)u=a[i],k.raiseEvent(u),u.update(n,t),s.incrementSelectionCounts(u.content),++s.selected;for(i=0;i<b;++i)u=y[i],u.update(n,t);if(w=r.length,h=w-e,n._backfaceCommands.trim(),p){for(c=n._backfaceCommands.values,o=c.length,r.length+=o,i=h-1;i>=0;--i)r[e+o+i]=r[e+i];for(i=0;i<o;++i)r[e+i]=c[i]}s.numberOfCommands=r.length-l;n.pointCloudShading.attenuation&&n.pointCloudShading.eyeDomeLighting&&h>0&&n._pointCloudEyeDomeLighting.update(t,l,n.pointCloudShading);n.debugShowGeometricError||n.debugShowRenderingStatistics||n.debugShowMemoryUsage||n.debugShowUrl?(f(n._tileDebugLabels)||(n._tileDebugLabels=new vt),rr(n,t)):n._tileDebugLabels=n._tileDebugLabels&&n._tileDebugLabels.destroy()}function fr(n,t){var f=t,o=n._statistics,i=ui,u,e,r;for(i.push(t);i.length>0;){for(t=i.pop(),u=t.children,e=u.length,r=0;r<e;++r)i.push(u[r]);t!==f&&(er(n,t),--o.numberOfTilesTotal)}f.children=[]}function hi(n,t){n.tileUnload.raiseEvent(t);n._statistics.decrementLoadCounts(t.content);--n._statistics.numberOfTilesWithContentReady;t.unloadContent()}function er(n,t){n._cache.unloadTile(n,t,hi);t.destroy()}function or(n){n._cache.unloadTiles(n,hi)}function sr(n,t){var i=n._statistics,r=n._statisticsLastColor,u=i.numberOfPendingRequests,f=i.numberOfTilesProcessing,o=r.numberOfPendingRequests,s=r.numberOfTilesProcessing,e=u!==o||f!==s;e&&t.afterRender.push(function(){n.loadProgress.raiseEvent(u,f)});n._tilesLoaded=i.numberOfPendingRequests===0&&i.numberOfTilesProcessing===0&&i.numberOfAttemptedRequests===0;e&&n._tilesLoaded&&(t.afterRender.push(function(){n.allTilesLoaded.raiseEvent()}),n._initialTilesLoaded||(n._initialTilesLoaded=!0,t.afterRender.push(function(){n.initialTilesLoaded.raiseEvent()})))}var ti,ei,si,ui;e(ni.prototype,{asset:{get:function(){if(!this.ready)throw new h("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._asset}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(n){at.setOwner(n,this,"_clippingPlanes")}},properties:{get:function(){if(!this.ready)throw new h("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._properties}},ready:{get:function(){return f(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},url:{get:function(){return this._url}},basePath:{get:function(){return o("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead."),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(n){this._styleEngine.style=n}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(n){r.typeOf.number.greaterThanOrEquals("maximumScreenSpaceError",n,0);this._maximumScreenSpaceError=n}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(n){r.typeOf.number.greaterThanOrEquals("value",n,0);this._maximumMemoryUsage=n}},root:{get:function(){if(!this.ready)throw new h("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._root}},boundingSphere:{get:function(){if(!this.ready)throw new h("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(n){this._modelMatrix=w.clone(n,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){var n=this._statistics;return n.texturesByteLength+n.geometryByteLength+n.batchTableByteLength}},clippingPlaneOffsetMatrix:{get:function(){return this._useBoundingSphereForClipping?this._clippingPlaneOffsetMatrix:this.root.computedTransform}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},extras:{get:function(){if(!this.ready)throw new h("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._extras}}});ni.loadJson=function(n){var t=b.createIfNeeded(n);return t.fetchJson()};ni.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};ni.prototype.loadTileset=function(n,t,i){var o=t.asset,a,s,u,e,r,h,v,c,y,l;if(!f(o))throw new k("Tileset must have an asset property.");if(o.version!=="0.0"&&o.version!=="1.0")throw new k("The tileset must be 3D Tiles version 0.0 or 1.0.");for(a=this._statistics,s=o.tilesetVersion,f(s)?(this._basePath+="?v="+s,n.setQueryParameters({v:s})):delete n.queryParameters.v,u=new rt(this,n,t.root,i),f(i)&&(i.children.push(u),u._depth=i._depth+1),e=[],e.push(u);e.length>0;){if(r=e.pop(),++a.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&r.refine===ot.ADD,h=r._header.children,f(h))for(v=h.length,c=0;c<v;++c)y=h[c],l=new rt(this,n,y,r),r.children.push(l),l._depth=r._depth+1,e.push(l);this._cullWithChildrenBounds&&et.checkChildrenWithinParent(r)}return u};var fi=new t,ci=new i,li=new w,ai=new t,vi=new t,yi=new t;return ti=new t,ei={maximumFractionDigits:3},si=new g({stencil:0,pass:nt.CESIUM_3D_TILE}),ui=[],ni.prototype.trimLoadedTiles=function(){this._cache.trim()},ni.prototype.update=function(n){var t,s,i,h,r;if(n.mode!==wt.MORPHING&&this.show&&this.ready){f(this._loadTimestamp)||(this._loadTimestamp=v.clone(n.time));t=this._clippingPlanes;f(t)&&t.enabled&&(t.update(n),this._useBoundingSphereForClipping&&(this._clippingPlaneOffsetMatrix=d.eastNorthUpToFixedFrame(this.boundingSphere.center)));this._timeSinceLoad=Math.max(v.secondsDifference(n.time,this._loadTimestamp)*1e3,0);this._skipLevelOfDetail=this.skipLevelOfDetail&&!f(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive;var o=n.passes,c=o.render,l=o.pick,u=c,e=this._statistics;if(e.clear(),this.dynamicScreenSpaceError&&pi(this,n),u&&this._cache.reset(),this._requestedTiles.length=0,ct.selectTiles(this,n),u&&(ki(this),ir(this,n)),ur(this,n),u&&or(this),sr(this,n),s=l?this._statisticsLastPick:this._statisticsLastColor,ht.clone(e,s),e.selected!==0&&(i=this._credits,f(i)))for(h=i.length,r=0;r<h;r++)n.creditDisplay.addCredit(i[r])}},ni.prototype.hasExtension=function(n){return f(this._extensionsUsed)?this._extensionsUsed.indexOf(n)>-1:!1},ni.prototype.isDestroyed=function(){return!1},ni.prototype.destroy=function(){var n,i,r,u,t;if(this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),f(this._root))for(n=ui,n.push(this._root);n.length>0;)for(i=n.pop(),i.destroy(),r=i.children,u=r.length,t=0;t<u;++t)n.push(r[t]);return this._root=undefined,s(this)},ni});t("Scene/ConditionsExpression",["../Core/clone","../Core/defined","../Core/defineProperties","./Expression"],function(n,t,i,r){"use strict";function u(t,i){this._conditionsExpression=n(t,!0);this._conditions=t.conditions;this._runtimeConditions=undefined;e(this,i)}function f(n,t){this.condition=n;this.expression=t}function e(n,i){var o=[],e=n._conditions,s,u;if(t(e)){for(s=e.length,u=0;u<s;++u){var h=e[u],c=String(h[0]),l=String(h[1]);o.push(new f(new r(c,i),new r(l,i)))}n._runtimeConditions=o}}return i(u.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}}),u.prototype.evaluate=function(n,i){var u=this._runtimeConditions,e,r,f;if(!t(u))return undefined;for(e=u.length,r=0;r<e;++r)if(f=u[r],f.condition.evaluate(n))return f.expression.evaluate(n,i)},u.prototype.evaluateColor=function(n,i){var u=this._runtimeConditions,e,r,f;if(!t(u))return undefined;for(e=u.length,r=0;r<e;++r)if(f=u[r],f.condition.evaluate(n))return f.expression.evaluateColor(n,i)},u.prototype.getShaderFunction=function(n,i,r,u){var e=this._runtimeConditions,o,s,f;if(!t(e)||e.length===0)return undefined;for(o="",s=e.length,f=0;f<s;++f){var h=e[f],c=h.condition.getShaderExpression(i,r),l=h.expression.getShaderExpression(i,r);o+="    "+(f===0?"if":"else if")+" ("+c+") \n    { \n        return "+l+"; \n    } \n"}return u+" "+n+"() \n{ \n"+o+"    return "+u+"(1.0); \n} \n"},u});t("Scene/Cesium3DTileStyle",["../Core/clone","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Resource","../ThirdParty/when","./ConditionsExpression","./Expression"],function(n,t,i,r,u,f,e,o,s){"use strict";function c(n){var t,r,i;this._style=undefined;this._ready=!1;this._show=undefined;this._color=undefined;this._pointSize=undefined;this._pointOutlineColor=undefined;this._pointOutlineWidth=undefined;this._labelColor=undefined;this._labelOutlineColor=undefined;this._labelOutlineWidth=undefined;this._font=undefined;this._labelStyle=undefined;this._labelText=undefined;this._backgroundColor=undefined;this._backgroundPadding=undefined;this._backgroundEnabled=undefined;this._scaleByDistance=undefined;this._translucencyByDistance=undefined;this._distanceDisplayCondition=undefined;this._heightOffset=undefined;this._anchorLineEnabled=undefined;this._anchorLineColor=undefined;this._image=undefined;this._disableDepthTestDistance=undefined;this._horizontalOrigin=undefined;this._verticalOrigin=undefined;this._labelHorizontalOrigin=undefined;this._labelVerticalOrigin=undefined;this._meta=undefined;this._colorShaderFunction=undefined;this._showShaderFunction=undefined;this._pointSizeShaderFunction=undefined;this._colorShaderFunctionReady=!1;this._showShaderFunctionReady=!1;this._pointSizeShaderFunctionReady=!1;this._colorShaderTranslucent=!1;typeof n=="string"||n instanceof f?(r=f.createIfNeeded(n),t=r.fetchJson(n)):t=e.resolve(n);i=this;this._readyPromise=t.then(function(n){return l(i,n),i})}function l(r,u){var o,h,f,e;if(r._style=n(u,!0),u=t(u,t.EMPTY_OBJECT),r.show=u.show,r.color=u.color,r.pointSize=u.pointSize,r.pointOutlineColor=u.pointOutlineColor,r.pointOutlineWidth=u.pointOutlineWidth,r.labelColor=u.labelColor,r.labelOutlineColor=u.labelOutlineColor,r.labelOutlineWidth=u.labelOutlineWidth,r.labelStyle=u.labelStyle,r.font=u.font,r.labelText=u.labelText,r.backgroundColor=u.backgroundColor,r.backgroundPadding=u.backgroundPadding,r.backgroundEnabled=u.backgroundEnabled,r.scaleByDistance=u.scaleByDistance,r.translucencyByDistance=u.translucencyByDistance,r.distanceDisplayCondition=u.distanceDisplayCondition,r.heightOffset=u.heightOffset,r.anchorLineEnabled=u.anchorLineEnabled,r.anchorLineColor=u.anchorLineColor,r.image=u.image,r.disableDepthTestDistance=u.disableDepthTestDistance,r.horizontalOrigin=u.horizontalOrigin,r.verticalOrigin=u.verticalOrigin,r.labelHorizontalOrigin=u.labelHorizontalOrigin,r.labelVerticalOrigin=u.labelVerticalOrigin,o={},i(u.meta)){h=u.defines;f=t(u.meta,t.EMPTY_OBJECT);for(e in f)f.hasOwnProperty(e)&&(o[e]=new s(f[e],h))}r._meta=o;r._ready=!0}function h(n,r){var u=t(n._style,t.EMPTY_OBJECT).defines;if(i(r)){if(typeof r=="boolean"||typeof r=="number")return new s(String(r));if(typeof r=="string")return new s(r,u);if(i(r.conditions))return new o(r,u)}else return undefined;return r}return r(c.prototype,{style:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._style}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},show:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._show},set:function(n){this._show=h(this,n);this._showShaderFunctionReady=!1}},color:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._color},set:function(n){this._color=h(this,n);this._colorShaderFunctionReady=!1}},pointSize:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointSize},set:function(n){this._pointSize=h(this,n);this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointOutlineColor},set:function(n){this._pointOutlineColor=h(this,n)}},pointOutlineWidth:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointOutlineWidth},set:function(n){this._pointOutlineWidth=h(this,n)}},labelColor:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelColor},set:function(n){this._labelColor=h(this,n)}},labelOutlineColor:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelOutlineColor},set:function(n){this._labelOutlineColor=h(this,n)}},labelOutlineWidth:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelOutlineWidth},set:function(n){this._labelOutlineWidth=h(this,n)}},font:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._font},set:function(n){this._font=h(this,n)}},labelStyle:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelStyle},set:function(n){this._labelStyle=h(this,n)}},labelText:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelText},set:function(n){this._labelText=h(this,n)}},backgroundColor:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundColor},set:function(n){this._backgroundColor=h(this,n)}},backgroundPadding:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundPadding},set:function(n){this._backgroundPadding=h(this,n)}},backgroundEnabled:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundEnabled},set:function(n){this._backgroundEnabled=h(this,n)}},scaleByDistance:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._scaleByDistance},set:function(n){this._scaleByDistance=h(this,n)}},translucencyByDistance:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._translucencyByDistance},set:function(n){this._translucencyByDistance=h(this,n)}},distanceDisplayCondition:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._distanceDisplayCondition},set:function(n){this._distanceDisplayCondition=h(this,n)}},heightOffset:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._heightOffset},set:function(n){this._heightOffset=h(this,n)}},anchorLineEnabled:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._anchorLineEnabled},set:function(n){this._anchorLineEnabled=h(this,n)}},anchorLineColor:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._anchorLineColor},set:function(n){this._anchorLineColor=h(this,n)}},image:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._image},set:function(n){this._image=h(this,n)}},disableDepthTestDistance:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._disableDepthTestDistance},set:function(n){this._disableDepthTestDistance=h(this,n)}},horizontalOrigin:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._horizontalOrigin},set:function(n){this._horizontalOrigin=h(this,n)}},verticalOrigin:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._verticalOrigin},set:function(n){this._verticalOrigin=h(this,n)}},labelHorizontalOrigin:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelHorizontalOrigin},set:function(n){this._labelHorizontalOrigin=h(this,n)}},labelVerticalOrigin:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelVerticalOrigin},set:function(n){this._labelVerticalOrigin=h(this,n)}},meta:{get:function(){if(!this._ready)throw new u("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._meta},set:function(n){this._meta=n}}}),c.prototype.getColorShaderFunction=function(n,t,r){return this._colorShaderFunctionReady?(r.translucent=this._colorShaderTranslucent,this._colorShaderFunction):(this._colorShaderFunctionReady=!0,this._colorShaderFunction=i(this.color)?this.color.getShaderFunction(n,t,r,"vec4"):undefined,this._colorShaderTranslucent=r.translucent,this._colorShaderFunction)},c.prototype.getShowShaderFunction=function(n,t,r){return this._showShaderFunctionReady?this._showShaderFunction:(this._showShaderFunctionReady=!0,this._showShaderFunction=i(this.show)?this.show.getShaderFunction(n,t,r,"bool"):undefined,this._showShaderFunction)},c.prototype.getPointSizeShaderFunction=function(n,t,r){return this._pointSizeShaderFunctionReady?this._pointSizeShaderFunction:(this._pointSizeShaderFunctionReady=!0,this._pointSizeShaderFunction=i(this.pointSize)?this.pointSize.getShaderFunction(n,t,r,"float"):undefined,this._pointSizeShaderFunction)},c});t("Scene/CircleEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(n,t,i,r,u){"use strict";function f(n){n=i(n,1);t.typeOf.number.greaterThan("radius",n,0);this._radius=i(n,1)}return r(f.prototype,{radius:{get:function(){return this._radius},set:function(n){t.typeOf.number.greaterThan("value",n,0);this._radius=n}}}),f.prototype.emit=function(t){var i=u.randomBetween(0,u.TWO_PI),r=u.randomBetween(0,this._radius),f=r*Math.cos(i),e=r*Math.sin(i);t.position=n.fromElements(f,e,0,t.position);t.velocity=n.clone(n.UNIT_Z,t.velocity)},f});t("Scene/computeFlyToLocationForRectangle",["../Core/defined","../Core/Rectangle","../Core/sampleTerrainMostDetailed","./SceneMode","../ThirdParty/when"],function(n,t,i,r,u){"use strict";function f(i,e){var o=e.terrainProvider;return n(o)?o.readyPromise.then(function(){var s=o.availability,u;return!n(s)||e.mode===r.SCENE2D?i:(u=[t.center(i),t.southeast(i),t.southwest(i),t.northeast(i),t.northwest(i)],f._sampleTerrainMostDetailed(o,u).then(function(n){var o=n.reduce(function(n,t){return Math.max(t.height,n)},-Number.MAX_VALUE),t,s=e.camera,u=e.mapProjection,h=u.ellipsoid,f=s.getRectangleCameraCoordinates(i);return t=e.mode===r.SCENE3D?h.cartesianToCartographic(f):u.unproject(f),t.height+=o,t}))}):u.resolve(i)}return f._sampleTerrainMostDetailed=i,f});t("Scene/ConeEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(n,t,i,r,u){"use strict";function f(n){this._angle=i(n,e)}var e=u.toRadians(30);return r(f.prototype,{angle:{get:function(){return this._angle},set:function(n){t.typeOf.number("value",n);this._angle=n}}}),f.prototype.emit=function(t){var f=Math.tan(this._angle),i=u.randomBetween(0,u.TWO_PI),r=u.randomBetween(0,f),e=r*Math.cos(i),o=r*Math.sin(i);t.velocity=n.fromElements(e,o,1,t.velocity);n.normalize(t.velocity,t.velocity);t.position=n.clone(n.ZERO,t.position)},f});t("Scene/UrlTemplateImageryProvider",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/combine","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/GeographicProjection","../Core/isArray","../Core/Math","../Core/Rectangle","../Core/Resource","../Core/WebMercatorTilingScheme","../ThirdParty/when","./ImageryProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function g(n){if(!e(n))throw new s("options is required.");if(!w.isPromise(n)&&!e(n.url))throw new s("options is required.");this._errorEvent=new h;this._resource=undefined;this._urlSchemeZeroPadding=undefined;this._pickFeaturesResource=undefined;this._tileWidth=undefined;this._tileHeight=undefined;this._maximumLevel=undefined;this._minimumLevel=undefined;this._tilingScheme=undefined;this._rectangle=undefined;this._tileDiscardPolicy=undefined;this._credit=undefined;this._hasAlphaChannel=undefined;this._readyPromise=undefined;this._tags=undefined;this._pickFeaturesTags=undefined;this.enablePickFeatures=!0;this.reinitialize(n)}function wt(n,t,i,r,u){rt=!1;ut=!1;var f=n._resource,c=f.getUrlComponent(!0),o=n._tags,s={},h=c.match(lt);return e(h)&&h.forEach(function(u){var f=u.substring(1,u.length-1);e(o[f])&&(s[f]=o[f](n,t,i,r))}),f.getDerivedResource({request:u,templateValues:s})}function bt(n,t,i,r,u,f,o){rt=!1;ut=!1;st=!1;ht=!1;var s=n._pickFeaturesResource,a=s.getUrlComponent(!0),h=n._pickFeaturesTags,c={},l=a.match(lt);return e(l)&&l.forEach(function(s){var l=s.substring(1,s.length-1);e(h[l])&&(c[l]=h[l](n,t,i,r,u,f,o))}),s.getDerivedResource({templateValues:c})}function tt(n,t,i){var u,r;return n&&n.urlSchemeZeroPadding&&n.urlSchemeZeroPadding.hasOwnProperty(t)&&(u=n.urlSchemeZeroPadding[t],typeof u=="string"&&(r=u.length,r>1&&(i=i.length>=r?i:new Array(r-i.toString().length+1).join("0")+i))),i}function kt(n,t){return tt(n,"{x}",t)}function dt(n,t,i,r){var u=n.tilingScheme.getNumberOfXTilesAtLevel(r)-t-1;return tt(n,"{reverseX}",u)}function gt(n,t,i){return tt(n,"{y}",i)}function ni(n,t,i,r){var u=n.tilingScheme.getNumberOfYTilesAtLevel(r)-i-1;return tt(n,"{reverseY}",u)}function ti(n,t,i,r){var u=n.maximumLevel,f=e(u)&&r<u?u-r-1:r;return tt(n,"{reverseZ}",f)}function ii(n,t,i,r){return tt(n,"{z}",r)}function ri(n,t,i,r){var u=(t+i+r)%n._subdomains.length;return n._subdomains[u]}function ft(n,t,i,r){rt||(n.tilingScheme.tileXYToRectangle(t,i,r,k),k.west=a.toDegrees(k.west),k.south=a.toDegrees(k.south),k.east=a.toDegrees(k.east),k.north=a.toDegrees(k.north),rt=!0)}function ui(n,t,i,r){return ft(n,t,i,r),k.west}function fi(n,t,i,r){return ft(n,t,i,r),k.south}function ei(n,t,i,r){return ft(n,t,i,r),k.east}function oi(n,t,i,r){return ft(n,t,i,r),k.north}function et(n,t,i,r){ut||(n.tilingScheme.tileXYToNativeRectangle(t,i,r,it),ut=!0)}function si(n,t,i,r){return et(n,t,i,r),it.west}function hi(n,t,i,r){return et(n,t,i,r),it.south}function ci(n,t,i,r){return et(n,t,i,r),it.east}function li(n,t,i,r){return et(n,t,i,r),it.north}function ai(n){return n.tileWidth}function vi(n){return n.tileHeight}function yi(n,t,i,r,u,f){return ot(n,t,i,r,u,f),nt.x}function pi(n,t,i,r,u,f){return ot(n,t,i,r,u,f),nt.y}function wi(n,t,i,r,u,f){return ot(n,t,i,r,u,f),n.tileWidth-nt.x-1}function bi(n,t,i,r,u,f){return ot(n,t,i,r,u,f),n.tileHeight-nt.y-1}function ot(n,t,i,r,u,f){if(!st){ct(n,t,i,r,u,f);var o=d,e=n.tilingScheme.tileXYToNativeRectangle(t,i,r,vt);nt.x=n.tileWidth*(o.x-e.west)/e.width|0;nt.y=n.tileHeight*(e.north-o.y)/e.height|0;st=!0}}function ki(n,t,i,r,u){return a.toDegrees(u)}function di(n,t,i,r,u,f){return a.toDegrees(f)}function gi(n,t,i,r,u,f){return ct(n,t,i,r,u,f),d.x}function nr(n,t,i,r,u,f){return ct(n,t,i,r,u,f),d.y}function ct(n,t,i,r,u,f){if(!ht){if(n.tilingScheme.projection instanceof c)d.x=a.toDegrees(u),d.y=a.toDegrees(f);else{var e=yt;e.longitude=u;e.latitude=f;n.tilingScheme.projection.project(e,d)}ht=!0}}function tr(n,t,i,r,u,f,e){return e}var lt=/{[^}]+}/g,at={x:kt,y:gt,z:ii,s:ri,reverseX:dt,reverseY:ni,reverseZ:ti,westDegrees:ui,southDegrees:fi,eastDegrees:ei,northDegrees:oi,westProjected:si,southProjected:hi,eastProjected:ci,northProjected:li,width:ai,height:vi},pt=r(at,{i:yi,j:pi,reverseI:wi,reverseJ:bi,longitudeDegrees:ki,latitudeDegrees:di,longitudeProjected:gi,latitudeProjected:nr,format:tr}),vt,d,yt;o(g.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this.ready)throw new s("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this.ready)throw new s("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this.ready)throw new s("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this.ready)throw new s("minimumLevel must not be called before the imagery provider is ready.");return this._minimumLevel}},tilingScheme:{get:function(){if(!this.ready)throw new s("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this.ready)throw new s("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this.ready)throw new s("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return e(this._resource)}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){if(!this.ready)throw new s("credit must not be called before the imagery provider is ready.");return this._credit}},hasAlphaChannel:{get:function(){if(!this.ready)throw new s("hasAlphaChannel must not be called before the imagery provider is ready.");return this._hasAlphaChannel}}});g.prototype.reinitialize=function(n){var t=this;t._readyPromise=w(n).then(function(n){var i;if(!e(n))throw new s("options is required.");if(!e(n.url))throw new s("options.url is required.");var o=n.customTags,h=r(at,o),c=r(pt,o),a=y.createIfNeeded(n.url),w=y.createIfNeeded(n.pickFeaturesUrl);return t.enablePickFeatures=f(n.enablePickFeatures,t.enablePickFeatures),t._urlSchemeZeroPadding=f(n.urlSchemeZeroPadding,t.urlSchemeZeroPadding),t._tileDiscardPolicy=n.tileDiscardPolicy,t._getFeatureInfoFormats=n.getFeatureInfoFormats,t._subdomains=n.subdomains,t._subdomains=l(t._subdomains)?t._subdomains.slice():e(t._subdomains)&&t._subdomains.length>0?t._subdomains.split(""):["a","b","c"],t._tileWidth=f(n.tileWidth,256),t._tileHeight=f(n.tileHeight,256),t._minimumLevel=f(n.minimumLevel,0),t._maximumLevel=n.maximumLevel,t._tilingScheme=f(n.tilingScheme,new p({ellipsoid:n.ellipsoid})),t._rectangle=f(n.rectangle,t._tilingScheme.rectangle),t._rectangle=v.intersection(t._rectangle,t._tilingScheme.rectangle),t._hasAlphaChannel=f(n.hasAlphaChannel,!0),i=n.credit,typeof i=="string"&&(i=new u(i)),t._credit=i,t._resource=a,t._tags=h,t._pickFeaturesResource=w,t._pickFeaturesTags=c,!0})};g.prototype.getTileCredits=function(){if(!this.ready)throw new s("getTileCredits must not be called before the imagery provider is ready.");return undefined};g.prototype.requestImage=function(n,t,i,r){if(!this.ready)throw new s("requestImage must not be called before the imagery provider is ready.");return b.loadImage(this,wt(this,n,t,i,r))};g.prototype.pickFeatures=function(n,t,i,r,u){function c(n,t){return n.callback(t)}function f(){if(o>=h._getFeatureInfoFormats.length)return w([]);var e=h._getFeatureInfoFormats[o],s=bt(h,n,t,i,r,u,e.format);return(++o,e.type==="json")?s.fetchJson().then(e.callback).otherwise(f):e.type==="xml"?s.fetchXML().then(e.callback).otherwise(f):e.type==="text"||e.type==="html"?s.fetchText().then(e.callback).otherwise(f):s.fetch({responseType:e.format}).then(c.bind(undefined,e)).otherwise(f)}if(!this.ready)throw new s("pickFeatures must not be called before the imagery provider is ready.");if(!this.enablePickFeatures||!e(this._pickFeaturesResource)||this._getFeatureInfoFormats.length===0)return undefined;var o=0,h=this;return f()};var rt=!1,k=new v,ut=!1,it=new v;var st=!1,nt=new n,ht=!1;return vt=new v,d=new t,yt=new i,g});t("Scene/createOpenStreetMapImageryProvider",["../Core/appendForwardSlash","../Core/Credit","../Core/defaultValue","../Core/DeveloperError","../Core/Rectangle","../Core/Resource","../Core/WebMercatorTilingScheme","./UrlTemplateImageryProvider"],function(n,t,i,r,u,f,e,o){"use strict";function h(h){var l,c;h=i(h,{});l=i(h.url,"https://a.tile.openstreetmap.org/");l=n(l)+("{z}/{x}/{y}."+i(h.fileExtension,"png"));var k=f.createIfNeeded(l),a=new e({ellipsoid:h.ellipsoid}),v=i(h.minimumLevel,0),d=h.maximumLevel,y=i(h.rectangle,a.rectangle),p=a.positionToTileXY(u.southwest(y),v),w=a.positionToTileXY(u.northeast(y),v),b=(Math.abs(w.x-p.x)+1)*(Math.abs(w.y-p.y)+1);if(b>4)throw new r("The rectangle and minimumLevel indicate that there are "+b+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");return c=i(h.credit,s),typeof c=="string"&&(c=new t(c)),new o({url:k,credit:c,tilingScheme:a,tileWidth:256,tileHeight:256,minimumLevel:v,maximumLevel:d,rectangle:y})}var s=new t("MapQuest, Open Street Map and contributors, CC-BY-SA");return h});t("Scene/createTangentSpaceDebugPrimitive",["../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/GeometryInstance","../Core/GeometryPipeline","../Core/Matrix4","./PerInstanceColorAppearance","./Primitive"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(h){var l,c;if(h=t(h,t.EMPTY_OBJECT),l=[],c=h.geometry,!i(c))throw new r("options.geometry is required.");i(c.attributes)&&i(c.primitiveType)||(c=c.constructor.createGeometry(c));var a=c.attributes,v=e.clone(t(h.modelMatrix,e.IDENTITY)),y=t(h.length,1e4);return(i(a.normal)&&l.push(new u({geometry:f.createLineSegmentsForVectors(c,"normal",y),attributes:{color:new n(1,0,0,1)},modelMatrix:v})),i(a.tangent)&&l.push(new u({geometry:f.createLineSegmentsForVectors(c,"tangent",y),attributes:{color:new n(0,1,0,1)},modelMatrix:v})),i(a.bitangent)&&l.push(new u({geometry:f.createLineSegmentsForVectors(c,"bitangent",y),attributes:{color:new n(0,0,1,1)},modelMatrix:v})),l.length>0)?new s({asynchronous:!1,geometryInstances:l,appearance:new o({flat:!0,translucent:!1})}):undefined}return h});t("Scene/createTileMapServiceImageryProvider",["../Core/Cartesian2","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/GeographicProjection","../Core/GeographicTilingScheme","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../Core/WebMercatorTilingScheme","../ThirdParty/when","./UrlTemplateImageryProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(y){function nt(u){for(var ht,ut,rt,a,lt,at,ft,et,pt,wt,yt,dt,ot,v,vt,st=[],tt=u.childNodes[0].childNodes,nt=0;nt<tt.length;nt++)if(/tileformat/i.test(tt.item(nt).nodeName))ot=tt.item(nt);else if(/tilesets/i.test(tt.item(nt).nodeName))for(vt=tt.item(nt),ht=tt.item(nt).childNodes,ut=0;ut<ht.length;ut++)/tileset/i.test(ht.item(ut).nodeName)&&st.push(ht.item(ut));else/boundingbox/i.test(tt.item(nt).nodeName)&&(v=tt.item(nt));if(!r(vt)||!r(v)){rt="Unable to find expected tilesets or bbox attributes in "+d.url+".";w=c.handleError(w,b,b.errorEvent,rt,undefined,undefined,undefined,g);w.retry||p.reject(new h(rt));return}var gt=i(y.fileExtension,ot.getAttribute("extension")),ni=i(y.tileWidth,parseInt(ot.getAttribute("width"),10)),ti=i(y.tileHeight,parseInt(ot.getAttribute("height"),10)),ct=i(y.minimumLevel,parseInt(st[0].getAttribute("order"),10)),ii=i(y.maximumLevel,parseInt(st[st.length-1].getAttribute("order"),10)),it=vt.getAttribute("profile"),s=y.tilingScheme;if(!r(s))if(it==="geodetic"||it==="global-geodetic")s=new e({ellipsoid:y.ellipsoid});else if(it==="mercator"||it==="global-mercator")s=new l({ellipsoid:y.ellipsoid});else{rt=d.url+"specifies an unsupported profile attribute, "+it+".";w=c.handleError(w,b,b.errorEvent,rt,undefined,undefined,undefined,g);w.retry||p.reject(new h(rt));return}a=o.clone(y.rectangle);r(a)||(pt=i(y.flipXY,!1),pt?(ft=new n(parseFloat(v.getAttribute("miny")),parseFloat(v.getAttribute("minx"))),et=new n(parseFloat(v.getAttribute("maxy")),parseFloat(v.getAttribute("maxx")))):(ft=new n(parseFloat(v.getAttribute("minx")),parseFloat(v.getAttribute("miny"))),et=new n(parseFloat(v.getAttribute("maxx")),parseFloat(v.getAttribute("maxy")))),wt=it==="geodetic"||it==="mercator",s.projection instanceof f||wt?(lt=t.fromDegrees(ft.x,ft.y),at=t.fromDegrees(et.x,et.y)):(yt=s.projection,lt=yt.unproject(ft),at=yt.unproject(et)),a=new o(lt.longitude,lt.latitude,at.longitude,at.latitude));a.west<s.rectangle.west&&(a.west=s.rectangle.west);a.east>s.rectangle.east&&(a.east=s.rectangle.east);a.south<s.rectangle.south&&(a.south=s.rectangle.south);a.north>s.rectangle.north&&(a.north=s.rectangle.north);var bt=s.positionToTileXY(o.southwest(a),ct),kt=s.positionToTileXY(o.northeast(a),ct),ri=(Math.abs(kt.x-bt.x)+1)*(Math.abs(kt.y-bt.y)+1);ri>4&&(ct=0);dt=k.getDerivedResource({url:"{z}/{x}/{reverseY}."+gt});p.resolve({url:dt,tilingScheme:s,rectangle:a,tileWidth:ni,tileHeight:ti,minimumLevel:ct,maximumLevel:ii,tileDiscardPolicy:y.tileDiscardPolicy,credit:y.credit})}function tt(){var t=i(y.fileExtension,"png"),u=i(y.tileWidth,256),f=i(y.tileHeight,256),e=i(y.minimumLevel,0),o=y.maximumLevel,n=r(y.tilingScheme)?y.tilingScheme:new l({ellipsoid:y.ellipsoid}),s=i(y.rectangle,n.rectangle),h=k.getDerivedResource({url:"{z}/{x}/{reverseY}."+t});p.resolve({url:h,tilingScheme:n,rectangle:s,tileWidth:u,tileHeight:f,minimumLevel:e,maximumLevel:o,tileDiscardPolicy:y.tileDiscardPolicy,credit:y.credit})}function g(){d.fetchXML().then(nt).otherwise(tt)}if(y=i(y,{}),!r(y.url))throw new u("options.url is required.");var p=a.defer(),b=new v(p.promise),w,k,d;return a(y.url).then(function(n){k=s.createIfNeeded(n);k.appendForwardSlash();d=k.getDerivedResource({url:"tilemapresource.xml"});g()}).otherwise(function(n){p.reject(n)}),b}return y});t("Scene/GoogleEarthEnterpriseMapsProvider",["../Core/buildModuleUrl","../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/GeographicTilingScheme","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../Core/WebMercatorTilingScheme","../ThirdParty/when","./ImageryProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){"use strict";function w(n){function nt(i){var r,c,o,e;try{r=JSON.parse(i)}catch(y){r=JSON.parse(i.replace(/([\[\{,])[\n\r ]*([A-Za-z0-9]+)[\n\r ]*:/g,'$1"$2":'))}for(o=0;o<r.layers.length;o++)if(r.layers[o].id===t._channel){c=r.layers[o];break}if(!u(c)){e="Could not find layer with channel (id) of "+t._channel+".";f=a.handleError(f,t,t._errorEvent,e,undefined,undefined,undefined,p);throw new l(e);}if(!u(c.version)){e="Could not find a version in channel (id) "+t._channel+".";f=a.handleError(f,t,t._errorEvent,e,undefined,undefined,undefined,p);throw new l(e);}if(t._version=c.version,u(r.projection)&&r.projection==="flat")t._tilingScheme=new s({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new h(-Math.PI,-Math.PI,Math.PI,Math.PI),ellipsoid:n.ellipsoid});else if(u(r.projection)&&r.projection!=="mercator"){e="Unsupported projection "+r.projection+".";f=a.handleError(f,t,t._errorEvent,e,undefined,undefined,undefined,p);throw new l(e);}else t._tilingScheme=new v({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:n.ellipsoid});t._ready=!0;t._readyPromise.resolve(!0);a.handleSuccess(f)}function tt(){var n="An error occurred while accessing "+d.url+".";f=a.handleError(f,t,t._errorEvent,n,undefined,undefined,undefined,p);t._readyPromise.reject(new l(n))}function p(){var n=d.fetchText();y(n,nt,tt)}var d,t,f;if(n=r(n,{}),!u(n.url))throw new e("options.url is required.");if(!u(n.channel))throw new e("options.channel is required.");var g=n.url,b=r(n.path,"/default_map"),k=c.createIfNeeded(g).getDerivedResource({url:b[0]==="/"?b.substring(1):b});k.appendForwardSlash();this._resource=k;this._url=g;this._path=b;this._tileDiscardPolicy=n.tileDiscardPolicy;this._channel=n.channel;this._requestType="ImageryMaps";this._credit=new i('<a href="http://www.google.com/enterprise/mapsearth/products/earthenterprise.html"><img src="'+w.logoUrl+'" title="Google Imagery"/><\/a>');this.defaultGamma=1.9;this._tilingScheme=undefined;this._version=undefined;this._tileWidth=256;this._tileHeight=256;this._maximumLevel=n.maximumLevel;this._errorEvent=new o;this._ready=!1;this._readyPromise=y.defer();d=k.getDerivedResource({url:"query",queryParameters:{request:"Json",vars:"geeServerDefs",is2d:"t"}});t=this;p()}return f(w.prototype,{url:{get:function(){return this._url}},path:{get:function(){return this._path}},proxy:{get:function(){return this._resource.proxy}},channel:{get:function(){return this._channel}},tileWidth:{get:function(){if(!this._ready)throw new e("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new e("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new e("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new e("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new e("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},version:{get:function(){if(!this._ready)throw new e("version must not be called before the imagery provider is ready.");return this._version}},requestType:{get:function(){if(!this._ready)throw new e("requestType must not be called before the imagery provider is ready.");return this._requestType}},rectangle:{get:function(){if(!this._ready)throw new e("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new e("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),w.prototype.getTileCredits=function(){return undefined},w.prototype.requestImage=function(n,t,i,r){if(!this._ready)throw new e("requestImage must not be called before the imagery provider is ready.");var u=this._resource.getDerivedResource({url:"query",request:r,queryParameters:{request:this._requestType,channel:this._channel,version:this._version,x:n,y:t,z:i+1}});return p.loadImage(this,u)},w.prototype.pickFeatures=function(){return undefined},w._logoUrl=undefined,f(w,{logoUrl:{get:function(){return u(w._logoUrl)||(w._logoUrl=n("Assets/Images/google_earth_credit.png")),w._logoUrl},set:function(n){t.defined("value",n);w._logoUrl=n}}}),w});t("Scene/MapboxImageryProvider",["../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/MapboxApi","../Core/Resource","./UrlTemplateImageryProvider"],function(n,t,i,r,u,f,e,o){"use strict";function s(r){var p,a,s,w,v,y,l;if(r=t(r,t.EMPTY_OBJECT),p=r.mapId,!i(p))throw new u("options.mapId is required.");a=r.url;i(a)||(a="https://{s}.tiles.mapbox.com/v4/");this._url=a;s=e.createIfNeeded(a);w=f.getAccessToken(r.accessToken);this._mapId=p;this._accessToken=w;this._accessTokenErrorCredit=n.clone(f.getErrorCredit(r.accessToken));v=t(r.format,"png");/\./.test(v)||(v="."+v);this._format=v;y=s.getUrlComponent();c.test(y)||(y+="/");y+=p+"/{z}/{x}/{y}"+this._format;s.url=y;s.setQueryParameters({access_token:w});i(r.credit)?(l=r.credit,typeof l=="string"&&(l=new n(l))):l=h;this._resource=s;this._imageryProvider=new o({url:s,credit:l,ellipsoid:r.ellipsoid,minimumLevel:r.minimumLevel,maximumLevel:r.maximumLevel,rectangle:r.rectangle})}var c=/\/$/,h=new n('&copy; <a href="https://www.mapbox.com/about/maps/">Mapbox<\/a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap<\/a> <strong><a href="https://www.mapbox.com/map-feedback/">Improve this map<\/a><\/strong>');return r(s.prototype,{url:{get:function(){return this._url}},ready:{get:function(){return this._imageryProvider.ready}},readyPromise:{get:function(){return this._imageryProvider.readyPromise}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}}),s.prototype.getTileCredits=function(){if(i(this._accessTokenErrorCredit))return[this._accessTokenErrorCredit]},s.prototype.requestImage=function(n,t,i,r){return this._imageryProvider.requestImage(n,t,i,r)},s.prototype.pickFeatures=function(n,t,i,r,u){return this._imageryProvider.pickFeatures(n,t,i,r,u)},s._defaultCredit=h,s});t("Scene/SingleTileImageryProvider",["../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/GeographicTilingScheme","../Core/Rectangle","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../ThirdParty/when"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function a(r){function d(n){a._image=n;a._tileWidth=n.width;a._tileHeight=n.height;a._ready=!0;a._readyPromise.resolve(!0);c.handleSuccess(a._errorEvent)}function g(n){var t="Failed to load image "+y.url+".";p=c.handleError(p,a,a._errorEvent,t,0,0,0,w,n);a._readyPromise.reject(new h(t))}function w(){l(y.fetchImage(),d,g)}var v,a,p;if(r=t(r,{}),!i(r.url))throw new u("options.url is required.");var y=s.createIfNeeded(r.url),b=t(r.rectangle,o.MAX_VALUE),k=new e({rectangle:b,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:r.ellipsoid});this._tilingScheme=k;this._resource=y;this._image=undefined;this._texture=undefined;this._tileWidth=0;this._tileHeight=0;this._errorEvent=new f;this._ready=!1;this._readyPromise=l.defer();v=r.credit;typeof v=="string"&&(v=new n(v));this._credit=v;a=this;w()}return r(a.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new u("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new u("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new u("maximumLevel must not be called before the imagery provider is ready.");return 0}},minimumLevel:{get:function(){if(!this._ready)throw new u("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new u("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new u("tileDiscardPolicy must not be called before the imagery provider is ready.");return undefined}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}}),a.prototype.getTileCredits=function(){return undefined},a.prototype.requestImage=function(){if(!this._ready)throw new u("requestImage must not be called before the imagery provider is ready.");return this._image},a.prototype.pickFeatures=function(){return undefined},a});t("Scene/GetFeatureInfoFormat",["../Core/Cartographic","../Core/defined","../Core/DeveloperError","../Core/RuntimeError","./ImageryLayerFeatureInfo"],function(n,t,i,r,u){"use strict";function h(n,r,u){if(!t(n))throw new i("type is required.");if(this.type=n,!t(r))if(n==="json")r="application/json";else if(n==="xml")r="text/xml";else if(n==="html")r="text/html";else if(n==="text")r="text/plain";else throw new i('format is required when type is not "json", "xml", "html", or "text".');if(this.format=r,!t(u))if(n==="json")u=c;else if(n==="xml")u=y;else if(n==="html")u=s;else if(n==="text")u=s;else throw new i('callback is required when type is not "json", "xml", "html", or "text".');this.callback=u}function c(i){for(var r,f,h,c,o=[],s=i.features,e=0;e<s.length;++e)r=s[e],f=new u,f.data=r,f.properties=r.properties,f.configureNameFromProperties(r.properties),f.configureDescriptionFromProperties(r.properties),t(r.geometry)&&r.geometry.type==="Point"&&(h=r.geometry.coordinates[0],c=r.geometry.coordinates[1],f.position=n.fromDegrees(h,c)),o.push(f);return o}function y(n){var t=n.documentElement;if(t.localName==="MultiFeatureCollection"&&t.namespaceURI===e)return p(n);if(t.localName==="FeatureInfoResponse"&&t.namespaceURI===l)return w(n);if(t.localName==="FeatureCollection"&&t.namespaceURI===a)return b(n);if(t.localName==="ServiceExceptionReport")throw new r((new XMLSerializer).serializeToString(t));else return t.localName==="msGMLOutput"?k(n):d(n)}function p(n){for(var r,f,a,v,t,s=[],y=n.documentElement,h=y.getElementsByTagNameNS(e,"Feature"),o=0;o<h.length;++o){var c=h[o],i={},l=c.getElementsByTagNameNS(e,"Val");for(r=0;r<l.length;++r)f=l[r],f.hasAttribute("ref")&&(a=f.getAttribute("ref"),v=f.textContent.trim(),i[a]=v);t=new u;t.data=c;t.properties=i;t.configureNameFromProperties(i);t.configureDescriptionFromProperties(i);s.push(t)}return s}function w(n){var w=n.documentElement,s=[],t,h=w.getElementsByTagNameNS("*","FIELDS"),i,c,l,r,a,v,u,y,p,e,o;if(h.length>0)for(i=0;i<h.length;++i){for(c=h[i],t={},l=c.attributes,r=0;r<l.length;++r)a=l[r],t[a.name]=a.value;s.push(f(c,t))}else for(v=w.getElementsByTagNameNS("*","FeatureInfo"),u=0;u<v.length;++u){for(y=v[u],t={},p=y.childNodes,e=0;e<p.length;++e)o=p[e],o.nodeType===Node.ELEMENT_NODE&&(t[o.localName]=o.textContent);s.push(f(y,t))}return s}function b(n){for(var i,r,u=[],s=n.documentElement,e=s.getElementsByTagNameNS(v,"featureMember"),t=0;t<e.length;++t)i=e[t],r={},o(i,r),u.push(f(i,r));return u}function k(n){for(var c,u,e,l,a=[],s,h=n.documentElement.childNodes,i=0;i<h.length;i++)if(h[i].nodeType===Node.ELEMENT_NODE){s=h[i];break}if(!t(s))throw new r("Unable to find first child of the feature info xml document");for(c=s.childNodes,u=0;u<c.length;++u)e=c[u],e.nodeType===Node.ELEMENT_NODE&&(l={},o(e,l),a.push(f(e,l)));return a}function o(n,t){for(var i,u=!0,r=0;r<n.childNodes.length;++r)(i=n.childNodes[r],i.nodeType===Node.ELEMENT_NODE&&(u=!1),i.localName!=="Point"&&i.localName!=="LineString"&&i.localName!=="Polygon"&&i.localName!=="boundedBy")&&i.hasChildNodes()&&o(i,t)&&(t[i.localName]=i.textContent);return u}function f(n,t){var i=new u;return i.data=n,i.properties=t,i.configureNameFromProperties(t),i.configureDescriptionFromProperties(t),i}function d(n){var f=(new XMLSerializer).serializeToString(n),i=document.createElement("div"),r=document.createElement("pre"),t;return r.textContent=f,i.appendChild(r),t=new u,t.data=n,t.description=i.innerHTML,[t]}function s(n){var r,i,t;return g.test(n)?undefined:nt.test(n)?undefined:(i=tt.exec(n),i&&i.length>1&&(r=i[1]),t=new u,t.name=r,t.description=n,t.data=n,[t])}var e="http://www.mapinfo.com/mxp",l="http://www.esri.com/wms",a="http://www.opengis.net/wfs",v="http://www.opengis.net/gml",g=/<body>\s*<\/body>/im,nt=/<ServiceExceptionReport([\s\S]*)<\/ServiceExceptionReport>/im,tt=/<title>([\s\S]*)<\/title>/im;return h});t("Scene/WebMapServiceImageryProvider",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/freezeObject","../Core/GeographicTilingScheme","../Core/Resource","../Core/WebMercatorProjection","./GetFeatureInfoFormat","./UrlTemplateImageryProvider"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(i){var s,a,u,v;if(i=n(i,n.EMPTY_OBJECT),!t(i.url))throw new r("options.url is required.");if(!t(i.layers))throw new r("options.layers is required.");s=e.createIfNeeded(i.url);a=s.clone();s.setQueryParameters(c.DefaultParameters,!0);a.setQueryParameters(c.GetFeatureInfoDefaultParameters,!0);t(i.parameters)&&s.setQueryParameters(l(i.parameters));t(i.getFeatureInfoParameters)&&a.setQueryParameters(l(i.getFeatureInfoParameters));u={};u.layers=i.layers;u.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}";u.width="{width}";u.height="{height}";parseFloat(s.queryParameters.version)>=1.3?u.crs=n(i.crs,i.tilingScheme&&i.tilingScheme.projection instanceof o?"EPSG:3857":"CRS:84"):u.srs=n(i.srs,i.tilingScheme&&i.tilingScheme.projection instanceof o?"EPSG:3857":"EPSG:4326");s.setQueryParameters(u,!0);a.setQueryParameters(u,!0);v={query_layers:i.layers,x:"{i}",y:"{j}",info_format:"{format}"};a.setQueryParameters(v,!0);this._resource=s;this._pickFeaturesResource=a;this._layers=i.layers;this._tileProvider=new h({url:s,pickFeaturesUrl:a,tilingScheme:n(i.tilingScheme,new f({ellipsoid:i.ellipsoid})),rectangle:i.rectangle,tileWidth:i.tileWidth,tileHeight:i.tileHeight,minimumLevel:i.minimumLevel,maximumLevel:i.maximumLevel,subdomains:i.subdomains,tileDiscardPolicy:i.tileDiscardPolicy,credit:i.credit,getFeatureInfoFormats:n(i.getFeatureInfoFormats,c.DefaultGetFeatureInfoFormats),enablePickFeatures:i.enablePickFeatures})}function l(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t.toLowerCase()]=n[t]);return i}return i(c.prototype,{url:{get:function(){return this._resource._url}},proxy:{get:function(){return this._resource.proxy}},layers:{get:function(){return this._layers}},tileWidth:{get:function(){return this._tileProvider.tileWidth}},tileHeight:{get:function(){return this._tileProvider.tileHeight}},maximumLevel:{get:function(){return this._tileProvider.maximumLevel}},minimumLevel:{get:function(){return this._tileProvider.minimumLevel}},tilingScheme:{get:function(){return this._tileProvider.tilingScheme}},rectangle:{get:function(){return this._tileProvider.rectangle}},tileDiscardPolicy:{get:function(){return this._tileProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._tileProvider.errorEvent}},ready:{get:function(){return this._tileProvider.ready}},readyPromise:{get:function(){return this._tileProvider.readyPromise}},credit:{get:function(){return this._tileProvider.credit}},hasAlphaChannel:{get:function(){return this._tileProvider.hasAlphaChannel}},enablePickFeatures:{get:function(){return this._tileProvider.enablePickFeatures},set:function(n){this._tileProvider.enablePickFeatures=n}}}),c.prototype.getTileCredits=function(n,t,i){return this._tileProvider.getTileCredits(n,t,i)},c.prototype.requestImage=function(n,t,i,r){return this._tileProvider.requestImage(n,t,i,r)},c.prototype.pickFeatures=function(n,t,i,r,u){return this._tileProvider.pickFeatures(n,t,i,r,u)},c.DefaultParameters=u({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"}),c.GetFeatureInfoDefaultParameters=u({service:"WMS",version:"1.1.1",request:"GetFeatureInfo"}),c.DefaultGetFeatureInfoFormats=u([u(new s("json","application/json")),u(new s("xml","text/xml")),u(new s("text","text/html"))]),c});t("Scene/TimeDynamicImagery",["../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/JulianDate","../Core/Request","../Core/RequestType"],function(n,t,i,r,u,f,e,o){"use strict";function s(i){i=t(i,t.EMPTY_OBJECT);n.typeOf.object("options.clock",i.clock);n.typeOf.object("options.times",i.times);n.typeOf.func("options.requestImageFunction",i.requestImageFunction);n.typeOf.func("options.reloadFunction",i.reloadFunction);this._tileCache={};this._tilesRequestedForInterval=[];var r=this._clock=i.clock;this._times=i.times;this._requestImageFunction=i.requestImageFunction;this._reloadFunction=i.reloadFunction;this._currentIntervalIndex=-1;r.onTick.addEventListener(this._clockOnTick,this);this._clockOnTick(r)}function h(n,t,i){return n+"-"+t+"-"+i}function a(n){var t=n.split("-");return t.length!==3?undefined:{x:Number(t[0]),y:Number(t[1]),level:Number(t[2])}}function c(n){var r=n._times,e,t,h;if(!i(r))return undefined;var u=n._clock,o=u.currentTime,c=u.canAnimate&&u.shouldAnimate,s=u.multiplier;return!c&&s!==0?undefined:(t=r.indexOf(o),t<0)?undefined:(h=r.get(t),s>0?(e=f.secondsDifference(h.stop,o),++t):(e=f.secondsDifference(h.start,o),--t),e/=s,t>=0&&e<=5?r.get(t):undefined)}function l(n,t,r){var h=n._times.indexOf(r.start),c=n._tileCache,u=c[h],f;if(i(u)||(u=c[h]={}),f=t.key,i(u[f]))return!0;var s=a(f),l=new e({throttle:!0,throttleByServer:!0,type:o.IMAGERY,priorityFunction:t.priorityFunction}),v=n._requestImageFunction(s.x,s.y,s.level,l,r);return i(v)?(u[f]={promise:v,request:l},!0):!1}return r(s.prototype,{clock:{get:function(){return this._clock},set:function(n){if(!i(n))throw new u("value is required.");this._clock!==n&&(this._clock=n,this._clockOnTick(n),this._reloadFunction())}},times:{get:function(){return this._times},set:function(n){if(!i(n))throw new u("value is required.");this._times!==n&&(this._times=n,this._clockOnTick(this._clock),this._reloadFunction())}},currentInterval:{get:function(){return this._times.get(this._currentIntervalIndex)}}}),s.prototype.getFromCache=function(n,t,r,u){var e=h(n,t,r),s,f=this._tileCache[this._currentIntervalIndex],o;return i(f)&&i(f[e])&&(o=f[e],s=o.promise.otherwise(function(n){u.state=o.request.state;throw n;}),delete f[e]),s},s.prototype.checkApproachingInterval=function(n,t,r,u){var s=h(n,t,r),f=this._tilesRequestedForInterval,e=c(this),o={key:s,priorityFunction:u.priorityFunction};i(e)&&l(this,o,e)||f.push(o);f.length>=512&&f.splice(0,256)},s.prototype._clockOnTick=function(n){var a=n.currentTime,v=this._times,h=v.indexOf(a),f=this._currentIntervalIndex,t,e,o,r,u,s;if(h!==f){t=this._tileCache[f];for(e in t)t.hasOwnProperty(e)&&t[e].request.cancel();delete this._tileCache[f];this._tilesRequestedForInterval=[];this._currentIntervalIndex=h;this._reloadFunction();return}if(o=c(this),i(o))for(r=this._tilesRequestedForInterval,u=!0;u;){if(r.length===0)break;s=r.pop();u=l(this,s,o);u||r.push(s)}},s});t("Scene/WebMapTileServiceImageryProvider",["../Core/combine","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/freezeObject","../Core/isArray","../Core/Rectangle","../Core/Resource","../Core/WebMercatorTilingScheme","../ThirdParty/when","./ImageryProvider","./TimeDynamicImagery"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n){var d,o,v;if(n=i(n,i.EMPTY_OBJECT),!r(n.url))throw new f("options.url is required.");if(!r(n.layer))throw new f("options.layer is required.");if(!r(n.style))throw new f("options.style is required.");if(!r(n.tileMatrixSetID))throw new f("options.tileMatrixSetID is required.");if(r(n.times)&&!r(n.clock))throw new f("options.times was specified, so options.clock is required.");var u=c.createIfNeeded(n.url),p=n.style,k=n.tileMatrixSetID,it=u.url;it.indexOf("{")>=0?(d={style:p,Style:p,TileMatrixSet:k},u.setTemplateValues(d),this._useKvp=!1):(u.setQueryParameters(b),this._useKvp=!0);this._resource=u;this._layer=n.layer;this._style=p;this._tileMatrixSetID=k;this._tileMatrixLabels=n.tileMatrixLabels;this._format=i(n.format,"image/jpeg");this._tileDiscardPolicy=n.tileDiscardPolicy;this._tilingScheme=r(n.tilingScheme)?n.tilingScheme:new l({ellipsoid:n.ellipsoid});this._tileWidth=i(n.tileWidth,256);this._tileHeight=i(n.tileHeight,256);this._minimumLevel=i(n.minimumLevel,0);this._maximumLevel=n.maximumLevel;this._rectangle=i(n.rectangle,this._tilingScheme.rectangle);this._dimensions=n.dimensions;o=this;this._reload=undefined;r(n.times)&&(this._timeDynamicImagery=new y({clock:n.clock,times:n.times,requestImageFunction:function(n,t,i,r,u){return w(o,n,t,i,r,u)},reloadFunction:function(){r(o._reload)&&o._reload()}}));this._readyPromise=a.resolve(!0);var g=this._tilingScheme.positionToTileXY(h.southwest(this._rectangle),this._minimumLevel),nt=this._tilingScheme.positionToTileXY(h.northeast(this._rectangle),this._minimumLevel),tt=(Math.abs(nt.x-g.x)+1)*(Math.abs(nt.y-g.y)+1);if(tt>4)throw new f("The imagery provider's rectangle and minimumLevel indicate that there are "+tt+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");this._errorEvent=new e;v=n.credit;this._credit=typeof v=="string"?new t(v):v;this._subdomains=n.subdomains;this._subdomains=s(this._subdomains)?this._subdomains.slice():r(this._subdomains)&&this._subdomains.length>0?this._subdomains.split(""):["a","b","c"]}function w(t,i,u,f,e,o){var a=t._tileMatrixLabels,y=r(a)?a[f]:f.toString(),p=t._subdomains,c=t._dimensions,l=r(o)?o.data:undefined,h,w,s;return t._useKvp?(s={},s.tilematrix=y,s.layer=t._layer,s.style=t._style,s.tilerow=u,s.tilecol=i,s.tilematrixset=t._tileMatrixSetID,s.format=t._format,r(c)&&(s=n(s,c)),r(l)&&(s=n(s,l)),h=t._resource.getDerivedResource({queryParameters:s,request:e})):(w={TileMatrix:y,TileRow:u.toString(),TileCol:i.toString(),s:p[(i+u+f)%p.length]},h=t._resource.getDerivedResource({request:e}),h.setTemplateValues(w),r(c)&&h.setTemplateValues(c),r(l)&&h.setTemplateValues(l)),v.loadImage(t,h)}var b=o({service:"WMTS",version:"1.0.0",request:"GetTile"});return u(p.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},format:{get:function(){return this._format}},ready:{value:!0},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(n){this._timeDynamicImagery.clock=n}},times:{get:function(){return this._timeDynamicImagery.times},set:function(n){this._timeDynamicImagery.times=n}},dimensions:{get:function(){return this._dimensions},set:function(n){this._dimensions!==n&&(this._dimensions=n,r(this._reload)&&this._reload())}}}),p.prototype.getTileCredits=function(){return undefined},p.prototype.requestImage=function(n,t,i,u){var f,e=this._timeDynamicImagery,o;return r(e)&&(o=e.currentInterval,f=e.getFromCache(n,t,i,u)),r(f)||(f=w(this,n,t,i,u,o)),r(f)&&r(e)&&e.checkApproachingInterval(n,t,i,u),f},p.prototype.pickFeatures=function(){return undefined},p});t("Scene/IonImageryProvider",["../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/IonResource","../Core/RuntimeError","../ThirdParty/when","./ArcGisMapServerImageryProvider","./BingMapsImageryProvider","./createTileMapServiceImageryProvider","./GoogleEarthEnterpriseMapsProvider","./MapboxImageryProvider","./SingleTileImageryProvider","./UrlTemplateImageryProvider","./WebMapServiceImageryProvider","./WebMapTileServiceImageryProvider"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function d(n){return function(t){return new n(t)}}function g(t){var f,u;t=i(t,i.EMPTY_OBJECT);n.typeOf.number("options.assetId",t.assetId);f=o._createEndpointResource(t.assetId,t);this.defaultAlpha=undefined;this.defaultBrightness=undefined;this.defaultContrast=undefined;this.defaultHue=undefined;this.defaultSaturation=undefined;this.defaultGamma=undefined;this.defaultMinificationFilter=undefined;this.defaultMagnificationFilter=undefined;this._ready=!1;this._tileCredits=undefined;this._errorEvent=new e;u=this;this._readyPromise=f.fetchJson().then(function(n){var i,e,c;if(n.type!=="IMAGERY")return h.reject(new s("Cesium ion asset "+t.assetId+" is not an imagery asset."));if(e=n.externalType,r(e)){if(c=nt[e],!r(c))return h.reject(new s("Unrecognized Cesium ion imagery type: "+e));i=c(n.options)}else i=a({url:new o(n,f)});return u._tileCredits=o.getCreditsFromEndpoint(n,f),i.errorEvent.addEventListener(function(n){n.provider=u;u._errorEvent.raiseEvent(n)}),u._imageryProvider=i,i.readyPromise.then(function(){return u._ready=!0,!0})})}var nt={ARCGIS_MAPSERVER:d(c),BING:d(l),GOOGLE_EARTH:d(v),MAPBOX:d(y),SINGLE_TILE:d(p),TMS:a,URL_TEMPLATE:d(w),WMS:d(b),WMTS:d(k)};return u(g.prototype,{ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},rectangle:{get:function(){if(!this._ready)throw new f("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.rectangle}},tileWidth:{get:function(){if(!this._ready)throw new f("tileWidth must not be called before the imagery provider is ready.");return this._imageryProvider.tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new f("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new f("maximumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new f("minimumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){if(!this._ready)throw new f("tilingScheme must not be called before the imagery provider is ready.");return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new f("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new f("credit must not be called before the imagery provider is ready.");return this._imageryProvider.credit}},hasAlphaChannel:{get:function(){if(!this._ready)throw new f("hasAlphaChannel must not be called before the imagery provider is ready.");return this._imageryProvider.hasAlphaChannel}}}),g.prototype.getTileCredits=function(n,t,i){if(!this._ready)throw new f("getTileCredits must not be called before the imagery provider is ready.");var u=this._imageryProvider.getTileCredits(n,t,i);return r(u)?this._tileCredits.concat(u):this._tileCredits},g.prototype.requestImage=function(n,t,i,r){if(!this._ready)throw new f("requestImage must not be called before the imagery provider is ready.");return this._imageryProvider.requestImage(n,t,i,r)},g.prototype.pickFeatures=function(n,t,i,r,u){if(!this._ready)throw new f("pickFeatures must not be called before the imagery provider is ready.");return this._imageryProvider.pickFeatures(n,t,i,r,u)},g});t("Scene/IonWorldImageryStyle",["../Core/freezeObject"],function(n){"use strict";return n({AERIAL:2,AERIAL_WITH_LABELS:3,ROAD:4})});t("Scene/createWorldImagery",["./IonImageryProvider","./IonWorldImageryStyle","../Core/defaultValue"],function(n,t,i){"use strict";function r(r){r=i(r,i.EMPTY_OBJECT);var u=i(r.style,t.AERIAL);return new n({assetId:u})}return r});t("Scene/CreditDisplay",["../Core/AssociativeArray","../Core/buildModuleUrl","../Core/Check","../Core/Credit","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject"],function(n,t,i,r,u,f,e,o){"use strict";function g(n,t){for(var u,f=n.length,i=0;i<f;i++)if(u=n[i],r.equals(u,t))return!0;return!1}function nt(n){var i=n._previousCesiumCredit,t=n._currentCesiumCredit;r.equals(t,i)||(f(i)&&n._cesiumCreditContainer.removeChild(i.element),f(t)&&n._cesiumCreditContainer.appendChild(t.element),n._previousCesiumCredit=t)}function p(n){var t=document.createElement("span");return t.textContent=n,t.className=y,t}function w(n,t){if(f(t)){var i=document.createElement(t);i._creditId=n._creditId;i.appendChild(n);n=i}return n}function b(n,t,i,r){for(var s,h,c,l,a,e=n.childNodes,u=-1,o=0;o<t.length;++o)s=t[o],f(s)&&(u=o,f(i)&&(u*=2,o>0&&(h=u-1,e.length<=h?n.appendChild(p(i)):(c=e[h],c.className!==y&&n.replaceChild(p(i),c)))),l=s.element,e.length<=u?n.appendChild(w(l,r)):(a=e[u],a._creditId!==s._id&&n.replaceChild(w(l,r),a)));for(++u;u<e.length;)n.removeChild(e[u])}function tt(n){var t=n._lightboxCredits,i=n.viewport.clientWidth,r=n.viewport.clientHeight;i!==n._lastViewportWidth&&(i<v?(t.className="cesium-credit-lightbox cesium-credit-lightbox-mobile",t.style.marginTop="0"):(t.className="cesium-credit-lightbox cesium-credit-lightbox-expanded",t.style.marginTop=Math.floor((r-t.clientHeight)*.5)+"px"),n._lastViewportWidth=i);i>=v&&r!==n._lastViewportHeight&&(t.style.marginTop=Math.floor((r-t.clientHeight)*.5)+"px",n._lastViewportHeight=r)}function h(n,t){var r=n+" {";for(var i in t)t.hasOwnProperty(i)&&(r+=i+": "+t[i]+"; ");return r+" }\n"}function it(){var n="",t,i;n+=h(".cesium-credit-lightbox-overlay",{display:"none","z-index":"1",position:"absolute",top:"0",left:"0",width:"100%",height:"100%","background-color":"rgba(80, 80, 80, 0.8)"});n+=h(".cesium-credit-lightbox",{"background-color":"#303336",color:c,position:"relative","min-height":d+"px",margin:"auto"});n+=h(".cesium-credit-lightbox > ul > li a, .cesium-credit-lightbox > ul > li a:visited",{color:c});n+=h(".cesium-credit-lightbox > ul > li a:hover",{color:a});n+=h(".cesium-credit-lightbox.cesium-credit-lightbox-expanded",{border:"1px solid #444","border-radius":"5px","max-width":"370px"});n+=h(".cesium-credit-lightbox.cesium-credit-lightbox-mobile",{height:"100%",width:"100%"});n+=h(".cesium-credit-lightbox-title",{padding:"20px 20px 0 20px"});n+=h(".cesium-credit-lightbox-close",{"font-size":"18pt",cursor:"pointer",position:"absolute",top:"0",right:"6px",color:c});n+=h(".cesium-credit-lightbox-close:hover",{color:a});n+=h(".cesium-credit-lightbox > ul",{margin:"0",padding:"12px 20px 12px 40px","font-size":"13px"});n+=h(".cesium-credit-lightbox > ul > li",{"padding-bottom":"6px"});n+=h(".cesium-credit-lightbox > ul > li *",{padding:"0",margin:"0"});n+=h(".cesium-credit-expand-link",{"padding-left":"5px",cursor:"pointer","text-decoration":"underline",color:c});n+=h(".cesium-credit-expand-link:hover",{color:a});n+=h(".cesium-credit-text",{color:c});n+=h(".cesium-credit-textContainer *, .cesium-credit-logoContainer *",{display:"inline"});t=document.head;i=document.createElement("style");i.innerHTML=n;t.insertBefore(i,t.firstChild)}function s(t,f,e){function k(n){o.contains(n.target)||b.hideLightbox()}var b,h,o,y,l,p,a,v,c,w;i.defined("container",t);b=this;e=u(e,document.body);h=document.createElement("div");h.className="cesium-credit-lightbox-overlay";e.appendChild(h);o=document.createElement("div");o.className="cesium-credit-lightbox";h.appendChild(o);h.addEventListener("click",k,!1);y=document.createElement("div");y.className="cesium-credit-lightbox-title";y.textContent="Data provided by:";o.appendChild(y);l=document.createElement("a");l.onclick=this.hideLightbox.bind(this);l.innerHTML="&times;";l.className="cesium-credit-lightbox-close";o.appendChild(l);p=document.createElement("ul");o.appendChild(p);a=document.createElement("div");a.className="cesium-credit-logoContainer";a.style.display="inline";t.appendChild(a);v=document.createElement("div");v.className="cesium-credit-textContainer";v.style.display="inline";t.appendChild(v);c=document.createElement("a");c.className="cesium-credit-expand-link";c.onclick=this.showLightbox.bind(this);c.textContent="Data attribution";t.appendChild(c);it();w=r.clone(s.cesiumCredit);this._delimiter=u(f,"  ");this._screenContainer=v;this._cesiumCreditContainer=a;this._lastViewportHeight=undefined;this._lastViewportWidth=undefined;this._lightboxCredits=o;this._creditList=p;this._lightbox=h;this._hideLightbox=k;this._expandLink=c;this._expanded=!1;this._defaultCredits=[];this._cesiumCredit=w;this._previousCesiumCredit=undefined;this._currentCesiumCredit=w;this._currentFrameCredits={screenCredits:new n,lightboxCredits:new n};this._defaultCredit=undefined;this.viewport=e;this.container=t}function k(){if(!f(l)){var n=t("Assets/Images/ion-credit.png");l=new r('<a href="https://cesium.com/" target="_blank"><img src="'+n+'" title="Cesium ion"/><\/a>',!0)}return s._cesiumCreditInitialized||(s._cesiumCredit=l,s._cesiumCreditInitialized=!0),l}var v=576,d=100,c="#ffffff",a="#48b",y="cesium-credit-delimiter",l;return s.prototype.addCredit=function(n){if(i.defined("credit",n),n._isIon){f(this._defaultCredit)||(this._defaultCredit=r.clone(k()));this._currentCesiumCredit=this._defaultCredit;return}n.showOnScreen?this._currentFrameCredits.screenCredits.set(n.id,n):this._currentFrameCredits.lightboxCredits.set(n.id,n)},s.prototype.addDefaultCredit=function(n){i.defined("credit",n);var t=this._defaultCredits;g(t,n)||t.push(n)},s.prototype.removeDefaultCredit=function(n){i.defined("credit",n);var t=this._defaultCredits,r=t.indexOf(n);r!==-1&&t.splice(r,1)},s.prototype.showLightbox=function(){this._lightbox.style.display="block";this._expanded=!0},s.prototype.hideLightbox=function(){this._lightbox.style.display="none";this._expanded=!1},s.prototype.update=function(){this._expanded&&tt(this)},s.prototype.beginFrame=function(){var u=this._currentFrameCredits,f=u.screenCredits,t,n,i;for(f.removeAll(),t=this._defaultCredits,n=0;n<t.length;++n)i=t[n],f.set(i.id,i);u.lightboxCredits.removeAll();r.equals(s.cesiumCredit,this._cesiumCredit)||(this._cesiumCredit=r.clone(s.cesiumCredit));this._currentCesiumCredit=this._cesiumCredit},s.prototype.endFrame=function(){var t=this._currentFrameCredits.screenCredits.values,n;b(this._screenContainer,t,this._delimiter,undefined);n=this._currentFrameCredits.lightboxCredits.values;this._expandLink.style.display=n.length>0?"inline":"none";b(this._creditList,n,undefined,"li");nt(this)},s.prototype.destroy=function(){return this._lightbox.removeEventListener("click",this._hideLightbox,!1),this.container.removeChild(this._cesiumCreditContainer),this.container.removeChild(this._screenContainer),this.container.removeChild(this._expandLink),this.viewport.removeChild(this._lightbox),o(this)},s.prototype.isDestroyed=function(){return!1},s._cesiumCredit=undefined,s._cesiumCreditInitialized=!1,e(s,{cesiumCredit:{get:function(){return k(),s._cesiumCredit},set:function(n){s._cesiumCredit=n;s._cesiumCreditInitialized=!0}}}),s});t("Scene/DebugAppearance",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","./Appearance"],function(n,t,i,r,u){"use strict";function f(i){var f,h,o,e,s,c,l;if(i=n(i,n.EMPTY_OBJECT),f=i.attributeName,h=i.perInstanceAttribute,!t(f))throw new r("options.attributeName is required.");if(t(h)||(h=!1),o=n(i.glslDatatype,"vec3"),e="v_"+f,f==="normal"||f==="tangent"||f==="bitangent")s="vec4 getColor() { return vec4(("+e+" + vec3(1.0)) * 0.5, 1.0); }\n";else{f==="st"&&(o="vec2");switch(o){case"float":s="vec4 getColor() { return vec4(vec3("+e+"), 1.0); }\n";break;case"vec2":s="vec4 getColor() { return vec4("+e+", 0.0, 1.0); }\n";break;case"vec3":s="vec4 getColor() { return vec4("+e+", 1.0); }\n";break;case"vec4":s="vec4 getColor() { return "+e+"; }\n";break;default:throw new r("options.glslDatatype must be float, vec2, vec3, or vec4.");}}c="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute float batchId;\n"+(h?"":"attribute "+o+" "+f+";\n")+"varying "+o+" "+e+";\nvoid main()\n{\nvec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);\n"+(h?e+" = czm_batchTable_"+f+"(batchId);\n":e+" = "+f+";\n")+"gl_Position = czm_modelViewProjectionRelativeToEye * p;\n}";l="varying "+o+" "+e+";\n"+s+"\nvoid main()\n{\ngl_FragColor = getColor();\n}";this.material=undefined;this.translucent=n(i.translucent,!1);this._vertexShaderSource=n(i.vertexShaderSource,c);this._fragmentShaderSource=n(i.fragmentShaderSource,l);this._renderState=u.getDefaultRenderState(!1,!1,i.renderState);this._closed=n(i.closed,!1);this._attributeName=f;this._glslDatatype=o}return i(f.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},attributeName:{get:function(){return this._attributeName}},glslDatatype:{get:function(){return this._glslDatatype}}}),f.prototype.getFragmentShaderSource=u.prototype.getFragmentShaderSource,f.prototype.isTranslucent=u.prototype.isTranslucent,f.prototype.getRenderState=u.prototype.getRenderState,f});t("Scene/DebugCameraPrimitive",["../Core/Cartesian3","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/FrustumGeometry","../Core/FrustumOutlineGeometry","../Core/GeometryInstance","../Core/Matrix3","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Core/PerspectiveFrustum","../Core/PerspectiveOffCenterFrustum","../Core/Quaternion","./PerInstanceColorAppearance","./Primitive"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function k(n){if(n=r(n,r.EMPTY_OBJECT),!u(n.camera))throw new e("options.camera is required.");this._camera=n.camera;this._color=r(n.color,t.CYAN);this._updateOnChange=r(n.updateOnChange,!0);this.show=r(n.show,!0);this.id=n.id;this._id=undefined;this._outlinePrimitives=[];this._planesPrimitives=[]}var d=new n,g=new c,nt=new p,tt=new v,it=new y,rt=new l,ut=new a,ft=new t,et=[1,1e5];return k.prototype.update=function(r){var f,e,u,lt,st,ht,k,ot,ct,a,vt;if(this.show){if(f=this._planesPrimitives,e=this._outlinePrimitives,this._updateOnChange){for(lt=f.length,u=0;u<lt;++u)e[u]=e[u]&&e[u].destroy(),f[u]=f[u]&&f[u].destroy();f.length=0;e.length=0}if(f.length===0){st=this._camera;ht=st.frustum;k=ht instanceof v?tt:ht instanceof y?it:ht instanceof l?rt:ut;k=ht.clone(k);ot=r.frustumSplits;ct=ot.length-1;ct<=0&&(ot=et,ot[0]=this._camera.frustum.near,ot[1]=this._camera.frustum.far,ct=1);var yt=st.positionWC,pt=st.directionWC,wt=st.upWC,at=st.rightWC;for(at=n.negate(at,d),a=g,c.setColumn(a,0,at,a),c.setColumn(a,1,wt,a),c.setColumn(a,2,pt,a),vt=p.fromRotationMatrix(a,nt),f.length=e.length=ct,u=0;u<ct;++u)k.near=ot[u],k.far=ot[u+1],f[u]=new b({geometryInstances:new h({geometry:new o({origin:yt,orientation:vt,frustum:k,_drawNearPlane:u===0}),attributes:{color:i.fromColor(t.fromAlpha(this._color,.1,ft))},id:this.id,pickPrimitive:this}),appearance:new w({translucent:!0,flat:!0}),asynchronous:!1}),e[u]=new b({geometryInstances:new h({geometry:new s({origin:yt,orientation:vt,frustum:k,_drawNearPlane:u===0}),attributes:{color:i.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new w({translucent:!1,flat:!0}),asynchronous:!1})}for(lt=f.length,u=0;u<lt;++u)e[u].update(r),f[u].update(r)}},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){for(var t=this._planesPrimitives.length,n=0;n<t;++n)this._outlinePrimitives[n]=this._outlinePrimitives[n]&&this._outlinePrimitives[n].destroy(),this._planesPrimitives[n]=this._planesPrimitives[n]&&this._planesPrimitives[n].destroy();return f(this)},k});t("Scene/DebugModelMatrixPrimitive",["../Core/Cartesian3","../Core/Color","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/GeometryInstance","../Core/Matrix4","../Core/PolylineGeometry","./PolylineColorAppearance","./Primitive"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(n){n=i(n,i.EMPTY_OBJECT);this.length=i(n.length,1e7);this._length=undefined;this.width=i(n.width,2);this._width=undefined;this.show=i(n.show,!0);this.modelMatrix=e.clone(i(n.modelMatrix,e.IDENTITY));this._modelMatrix=new e;this.id=n.id;this._id=undefined;this._primitive=undefined}return c.prototype.update=function(i){if(this.show){if(!r(this._primitive)||!e.equals(this._modelMatrix,this.modelMatrix)||this._length!==this.length||this._width!==this.width||this._id!==this.id){this._modelMatrix=e.clone(this.modelMatrix,this._modelMatrix);this._length=this.length;this._width=this.width;this._id=this.id;r(this._primitive)&&this._primitive.destroy();this.modelMatrix[12]===0&&this.modelMatrix[13]===0&&this.modelMatrix[14]===0&&(this.modelMatrix[14]=.01);var u=new f({geometry:new o({positions:[n.ZERO,n.UNIT_X],width:this.width,vertexFormat:s.VERTEX_FORMAT,colors:[t.RED,t.RED],followSurface:!1}),modelMatrix:e.multiplyByUniformScale(this.modelMatrix,this.length,new e),id:this.id,pickPrimitive:this}),c=new f({geometry:new o({positions:[n.ZERO,n.UNIT_Y],width:this.width,vertexFormat:s.VERTEX_FORMAT,colors:[t.GREEN,t.GREEN],followSurface:!1}),modelMatrix:e.multiplyByUniformScale(this.modelMatrix,this.length,new e),id:this.id,pickPrimitive:this}),l=new f({geometry:new o({positions:[n.ZERO,n.UNIT_Z],width:this.width,vertexFormat:s.VERTEX_FORMAT,colors:[t.BLUE,t.BLUE],followSurface:!1}),modelMatrix:e.multiplyByUniformScale(this.modelMatrix,this.length,new e),id:this.id,pickPrimitive:this});this._primitive=new h({geometryInstances:[u,c,l],appearance:new s,asynchronous:!1})}this._primitive.update(i)}},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),u(this)},c});t("Shaders/DepthPlaneFS",[],function(){"use strict";return"varying vec4 positionEC;\nvoid main()\n{\nczm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\nvec3 direction = normalize(positionEC.xyz);\nczm_ray ray = czm_ray(vec3(0.0), direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nif (!czm_isEmpty(intersection))\n{\ngl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n}\nelse\n{\ndiscard;\n}\nczm_writeLogDepth();\n}\n"});t("Shaders/DepthPlaneVS",[],function(){"use strict";return"attribute vec4 position;\nvarying vec4 positionEC;\nvoid main()\n{\npositionEC = czm_modelView * position;\ngl_Position = czm_projection * positionEC;\nczm_vertexLogDepth();\n}\n"});t("Scene/DepthPlane",["../Core/BoundingSphere","../Core/Cartesian3","../Core/ComponentDatatype","../Core/defined","../Core/FeatureDetection","../Core/Geometry","../Core/GeometryAttribute","../Core/PrimitiveType","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../Shaders/DepthPlaneFS","../Shaders/DepthPlaneVS","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function d(){this._rs=undefined;this._sp=undefined;this._va=undefined;this._command=undefined;this._mode=undefined;this._useLogDepth=!1}function rt(n,i){var o=n.radii,w=i.camera.positionWC,s=t.multiplyComponents(n.oneOverRadii,w,tt),a=t.magnitude(s),v=t.normalize(s,it),y=t.normalize(t.cross(t.UNIT_Z,s,nt),nt),b=t.normalize(t.cross(v,y,k),k),d=Math.sqrt(t.magnitudeSquared(s)-1),h=t.multiplyByScalar(v,1/a,tt),p=d/a,c=t.multiplyByScalar(y,p,it),l=t.multiplyByScalar(b,p,nt),e=t.add(h,l,k),r,u,f;return t.subtract(e,c,e),t.multiplyComponents(o,e,e),t.pack(e,g,0),r=t.subtract(h,l,k),t.subtract(r,c,r),t.multiplyComponents(o,r,r),t.pack(r,g,3),u=t.add(h,l,k),t.add(u,c,u),t.multiplyComponents(o,u,u),t.pack(u,g,6),f=t.subtract(h,l,k),t.add(f,c,f),t.multiplyComponents(o,f,f),t.pack(f,g,9),g}var g=u.supportsTypedArrays()?new Float32Array(12):[],tt=new t,it=new t,nt=new t,k=new t;return d.prototype.update=function(u){var k,d,ut,nt,ft;if(this._mode=u.mode,u.mode===b.SCENE3D){var tt=u.context,it=u.mapProjection.ellipsoid,g=u.useLogDepth;r(this._command)||(this._rs=l.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new h({renderState:this._rs,boundingVolume:new n(t.ZERO,it.maximumRadius),pass:c.OPAQUE,owner:this}));r(this._sp)&&this._useLogDepth===g||(this._useLogDepth=g,k=new v({sources:[w]}),d=new v({sources:[p]}),g&&(ut="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n",d.sources.push(ut),d.defines.push("LOG_DEPTH"),k.defines.push("LOG_DEPTH"),k.defines.push("DISABLE_GL_POSITION_LOG_DEPTH")),this._sp=a.replaceCache({shaderProgram:this._sp,context:tt,vertexShaderSource:k,fragmentShaderSource:d,attributeLocations:{position:0}}),this._command.shaderProgram=this._sp);nt=rt(it,u);r(this._va)?this._va.getAttribute(0).vertexBuffer.copyFromArrayView(nt):(ft=new f({attributes:{position:new e({componentDatatype:i.FLOAT,componentsPerAttribute:3,values:nt})},indices:[0,1,2,2,1,3],primitiveType:o.TRIANGLES}),this._va=y.fromGeometry({context:tt,geometry:ft,attributeLocations:{position:0},bufferUsage:s.DYNAMIC_DRAW}),this._command.vertexArray=this._va)}},d.prototype.execute=function(n,t){this._mode===b.SCENE3D&&this._command.execute(n,t)},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy();this._va=this._va&&this._va.destroy()},d});t("Scene/DerivedCommand",["../Core/defaultValue","../Core/defined","../Renderer/DrawCommand","../Renderer/RenderState","../Renderer/ShaderSource"],function(n,t,i,r,u){"use strict";function f(){}function s(n,i){var c=n.shaderCache.getDerivedShaderProgram(i,"depthOnly"),s,y,h;if(!t(c)){for(var p=i._attributeLocations,f=i.fragmentShaderSource,l=!1,a=f.sources,v=a.length,r=0;r<v;++r)if(e.test(a[r])||o.test(a[r])){l=!0;break}for(s=!1,y=f.defines,v=y.length,r=0;r<v;++r)if(y[r]==="LOG_DEPTH"){s=!0;break}l||s?!l&&s&&(h="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor = vec4(1.0); \n    czm_writeLogDepth(); \n} \n",f=new u({defines:["LOG_DEPTH"],sources:[h]})):(h="void main() \n{ \n    gl_FragColor = vec4(1.0); \n} \n",f=new u({sources:[h]}));c=n.shaderCache.createDerivedShaderProgram(i,"depthOnly",{vertexShaderSource:i.vertexShaderSource,fragmentShaderSource:f,attributeLocations:p})}return c}function h(n,i){var e=n._depthOnlyRenderStateCache,u=e[i.id],f;return t(u)||(f=r.getState(i),f.depthMask=!0,f.colorMask={red:!1,green:!1,blue:!1,alpha:!1},u=r.fromCache(f),e[i.id]=u),u}function v(n,i){var y=n.shaderCache.getDerivedShaderProgram(i,"logDepth"),p,v;if(!t(y)){var b=i._attributeLocations,e=i.vertexShaderSource.clone(),o=i.fragmentShaderSource.clone();e.defines=t(e.defines)?e.defines.slice(0):[];e.defines.push("LOG_DEPTH");o.defines=t(o.defines)?o.defines.slice(0):[];o.defines.push("LOG_DEPTH");for(var w,s=!1,f=e.sources,h=f.length,r=0;r<h;++r)if(l.test(f[r])){s=!0;break}if(!s){for(r=0;r<h;++r)f[r]=u.replaceMain(f[r],"czm_log_depth_main");w="\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n";f.push(w)}for(p=!0,s=!1,f=o.sources,h=f.length,r=0;r<h;++r)c.test(f[r])&&(s=!0),a.test(f[r])&&(p=!1);if(v="",p&&(v+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),!s){for(r=0;r<h;r++)f[r]=u.replaceMain(f[r],"czm_log_depth_main");v+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}f.push(v);y=n.shaderCache.createDerivedShaderProgram(i,"logDepth",{vertexShaderSource:e,fragmentShaderSource:o,attributeLocations:b})}return y}function y(n,i,r){var o=n.shaderCache.getDerivedShaderProgram(i,"pick"),f;if(!t(o)){var l=i._attributeLocations,e=i.fragmentShaderSource,c=e.sources,s=c.length,a="void main() \n{ \n    czm_non_pick_main(); \n    if (gl_FragColor.a == 0.0) { \n        discard; \n    } \n    gl_FragColor = "+r+"; \n} \n",h=new Array(s+1);for(f=0;f<s;++f)h[f]=u.replaceMain(c[f],"czm_non_pick_main");h[s]=a;e=new u({sources:h,defines:e.defines});o=n.shaderCache.createDerivedShaderProgram(i,"pick",{vertexShaderSource:i.vertexShaderSource,fragmentShaderSource:e,attributeLocations:l})}return o}function p(n,i){var e=n._pickRenderStateCache,u=e[i.id],f;return t(u)||(f=r.getState(i),f.blending.enabled=!1,f.depthMask=!0,u=r.fromCache(f),e[i.id]=u),u}var e=/\bgl_FragDepthEXT\b/,o=/\bdiscard\b/;f.createDepthOnlyDerivedCommand=function(n,r,u,f){t(f)||(f={});var e,o;return t(f.depthOnlyCommand)&&(e=f.depthOnlyCommand.shaderProgram,o=f.depthOnlyCommand.renderState),f.depthOnlyCommand=i.shallowClone(r,f.depthOnlyCommand),t(e)&&f.shaderProgramId===r.shaderProgram.id?(f.depthOnlyCommand.shaderProgram=e,f.depthOnlyCommand.renderState=o):(f.depthOnlyCommand.shaderProgram=s(u,r.shaderProgram),f.depthOnlyCommand.renderState=h(n,r.renderState),f.shaderProgramId=r.shaderProgram.id),f};var c=/\s+czm_writeLogDepth\(/,l=/\s+czm_vertexLogDepth\(/,a=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;return f.createLogDepthCommand=function(n,r,u){t(u)||(u={});var f;return t(u.command)&&(f=u.command.shaderProgram),u.command=i.shallowClone(n,u.command),t(f)&&u.shaderProgramId===n.shaderProgram.id?u.command.shaderProgram=f:(u.command.shaderProgram=v(r,n.shaderProgram),u.shaderProgramId=n.shaderProgram.id),u},f.createPickDerivedCommand=function(n,r,u,f){t(f)||(f={});var e,o;return t(f.pickCommand)&&(e=f.pickCommand.shaderProgram,o=f.pickCommand.renderState),f.pickCommand=i.shallowClone(r,f.pickCommand),t(e)&&f.shaderProgramId===r.shaderProgram.id?(f.pickCommand.shaderProgram=e,f.pickCommand.renderState=o):(f.pickCommand.shaderProgram=y(u,r.shaderProgram,r.pickId),f.pickCommand.renderState=p(n,r.renderState),f.shaderProgramId=r.shaderProgram.id),f},f});t("Scene/DeviceOrientationCameraController",["../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/Matrix3","../Core/Quaternion"],function(n,t,i,r,u,f){"use strict";function e(t){function f(t){var i=t.alpha;if(!n(i)){u._alpha=undefined;u._beta=undefined;u._gamma=undefined;return}u._alpha=r.toRadians(i);u._beta=r.toRadians(t.beta);u._gamma=r.toRadians(t.gamma)}if(!n(t))throw new i("scene is required.");this._scene=t;this._lastAlpha=undefined;this._lastBeta=undefined;this._lastGamma=undefined;this._alpha=undefined;this._beta=undefined;this._gamma=undefined;var u=this;window.addEventListener("deviceorientation",f,!1);this._removeListener=function(){window.removeEventListener("deviceorientation",f,!1)}}function c(n,t,i,r){var c=n.direction,l=n.right,a=n.up,p=f.fromAxisAngle(c,i,o),y=f.fromAxisAngle(l,r,s),v=f.multiply(y,p,y),w=f.fromAxisAngle(a,t,o),e;f.multiply(w,v,v);e=u.fromQuaternion(v,h);u.multiplyByVector(e,l,l);u.multiplyByVector(e,a,a);u.multiplyByVector(e,c,c)}var s=new f,o=new f,h=new u;return e.prototype.update=function(){if(n(this._alpha)){n(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);var t=this._lastAlpha-this._alpha,i=this._lastBeta-this._beta,r=this._lastGamma-this._gamma;c(this._scene.camera,-t,i,r);this._lastAlpha=this._alpha;this._lastBeta=this._beta;this._lastGamma=this._gamma}},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this._removeListener(),t(this)},e});t("Shaders/EllipsoidFS",[],function(){"use strict";return"#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#endif\nuniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\nvarying vec3 v_positionEC;\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\nvec3 positionEC = czm_pointAlongRay(ray, intersection);\nvec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\nvec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\nvec3 sphericalNormal = normalize(positionMC / u_radii);\nvec3 normalMC = geodeticNormal * side;\nvec3 normalEC = normalize(czm_normal * normalMC);\nvec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\nvec3 positionToEyeEC = -positionEC;\nczm_materialInput materialInput;\nmaterialInput.s = st.s;\nmaterialInput.st = st;\nmaterialInput.str = (positionMC + u_radii) / u_radii;\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef ONLY_SUN_LIGHTING\nreturn czm_private_phong(normalize(positionToEyeEC), material);\n#else\nreturn czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\nvoid main()\n{\nfloat maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\nvec3 direction = normalize(v_positionEC);\nvec3 ellipsoidCenter = czm_modelView[3].xyz;\nfloat t1 = -1.0;\nfloat t2 = -1.0;\nfloat b = -2.0 * dot(direction, ellipsoidCenter);\nfloat c = dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\nfloat discriminant = b * b - 4.0 * c;\nif (discriminant >= 0.0) {\nt1 = (-b - sqrt(discriminant)) * 0.5;\nt2 = (-b + sqrt(discriminant)) * 0.5;\n}\nif (t1 < 0.0 && t2 < 0.0) {\ndiscard;\n}\nfloat t = min(t1, t2);\nif (t < 0.0) {\nt = 0.0;\n}\nczm_ellipsoid ellipsoid = czm_ellipsoidNew(ellipsoidCenter, u_radii);\nczm_ray ray = czm_ray(t * direction, direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nif (czm_isEmpty(intersection))\n{\ndiscard;\n}\nvec4 outsideFaceColor = (intersection.start != 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\nvec4 insideFaceColor = (outsideFaceColor.a < 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\ngl_FragColor = mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\ngl_FragColor.a = 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\nt = (intersection.start != 0.0) ? intersection.start : intersection.stop;\nvec3 positionEC = czm_pointAlongRay(ray, t);\nvec4 positionCC = czm_projection * vec4(positionEC, 1.0);\n#ifdef LOG_DEPTH\nczm_writeLogDepth(1.0 + positionCC.w);\n#else\nfloat z = positionCC.z / positionCC.w;\nfloat n = czm_depthRange.near;\nfloat f = czm_depthRange.far;\ngl_FragDepthEXT = (z * (f - n) + f + n) * 0.5;\n#endif\n#endif\n#endif\n}\n"});t("Shaders/EllipsoidVS",[],function(){"use strict";return"attribute vec3 position;\nuniform vec3 u_radii;\nvarying vec3 v_positionEC;\nvoid main()\n{\nvec4 p = vec4(u_radii * position, 1.0);\nv_positionEC = (czm_modelView * p).xyz;\ngl_Position = czm_modelViewProjection * p;\ngl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\nczm_vertexLogDepth();\n}\n"});t("Scene/EllipsoidPrimitive",["../Core/BoundingSphere","../Core/BoxGeometry","../Core/Cartesian3","../Core/combine","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/Matrix4","../Core/VertexFormat","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../Shaders/EllipsoidFS","../Shaders/EllipsoidVS","./BlendingState","./CullFace","./Material","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function it(t){t=u(t,u.EMPTY_OBJECT);this.center=i.clone(u(t.center,i.ZERO));this._center=new i;this.radii=i.clone(t.radii);this._radii=new i;this._oneOverEllipsoidRadiiSquared=new i;this._boundingSphere=new n;this.modelMatrix=s.clone(u(t.modelMatrix,s.IDENTITY));this._modelMatrix=new s;this._computedModelMatrix=new s;this.show=u(t.show,!0);this.material=u(t.material,nt.fromType(nt.ColorType));this._material=undefined;this._translucent=undefined;this.id=t.id;this._id=undefined;this.debugShowBoundingVolume=u(t.debugShowBoundingVolume,!1);this.onlySunLighting=u(t.onlySunLighting,!1);this._onlySunLighting=!1;this._depthTestEnabled=u(t.depthTestEnabled,!0);this._useLogDepth=!1;this._sp=undefined;this._rs=undefined;this._va=undefined;this._pickSP=undefined;this._pickId=undefined;this._colorCommand=new l({owner:u(t._owner,this)});this._pickCommand=new l({owner:u(t._owner,this),pickOnly:!0});var r=this;this._uniforms={u_radii:function(){return r.radii},u_oneOverEllipsoidRadiiSquared:function(){return r._oneOverEllipsoidRadiiSquared}};this._pickUniforms={czm_pickColor:function(){return r._pickId.color}}}function ft(n){var r=n.cache.ellipsoidPrimitive_vertexArray,u;return f(r)?r:(u=t.createGeometry(t.fromDimensions({dimensions:new i(2,2,2),vertexFormat:h.POSITION_ONLY})),r=w.fromGeometry({context:n,geometry:u,attributeLocations:rt,bufferUsage:c.STATIC_DRAW,interleave:!0}),n.cache.ellipsoidPrimitive_vertexArray=r,r)}var rt={position:0},ut="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n";return it.prototype.update=function(t){var it,c,et,ot,st,ht,ct,e,nt,u,lt,at,l;if(this.show&&t.mode===tt.SCENE3D&&f(this.center)&&f(this.radii)){if(!f(this.material))throw new o("this.material must be defined.");var w=t.context,h=this.material.isTranslucent(),vt=this._translucent!==h;(!f(this._rs)||vt)&&(this._translucent=h,this._rs=v.fromCache({cull:{enabled:!0,face:g.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!h&&w.fragmentDepth,blending:h?d.ALPHA_BLEND:undefined}));f(this._va)||(this._va=ft(w));it=!1;c=this.radii;i.equals(this._radii,c)||(i.clone(c,this._radii),et=this._oneOverEllipsoidRadiiSquared,et.x=1/(c.x*c.x),et.y=1/(c.y*c.y),et.z=1/(c.z*c.z),it=!0);s.equals(this.modelMatrix,this._modelMatrix)&&i.equals(this.center,this._center)||(s.clone(this.modelMatrix,this._modelMatrix),i.clone(this.center,this._center),s.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),it=!0);it&&(i.clone(i.ZERO,this._boundingSphere.center),this._boundingSphere.radius=i.maximumComponent(c),n.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));ot=this._material!==this.material;this._material=this.material;this._material.update(w);st=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;ht=t.useLogDepth;ct=this._useLogDepth!==ht;this._useLogDepth=ht;e=this._colorCommand;(ot||st||vt||ct)&&(nt=new p({sources:[k]}),u=new p({sources:[this.material.shaderSource,b]}),this.onlySunLighting&&u.defines.push("ONLY_SUN_LIGHTING"),!h&&w.fragmentDepth&&u.defines.push("WRITE_DEPTH"),this._useLogDepth&&(nt.defines.push("LOG_DEPTH","DISABLE_GL_POSITION_LOG_DEPTH"),u.defines.push("LOG_DEPTH"),u.sources.push(ut)),this._sp=y.replaceCache({context:w,shaderProgram:this._sp,vertexShaderSource:nt,fragmentShaderSource:u,attributeLocations:rt}),e.vertexArray=this._va,e.renderState=this._rs,e.shaderProgram=this._sp,e.uniformMap=r(this._uniforms,this.material._uniforms),e.executeInClosestFrustum=h);lt=t.commandList;at=t.passes;at.render&&(e.boundingVolume=this._boundingSphere,e.debugShowBoundingVolume=this.debugShowBoundingVolume,e.modelMatrix=this._computedModelMatrix,e.pass=h?a.TRANSLUCENT:a.OPAQUE,lt.push(e));at.pick&&(l=this._pickCommand,f(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=w.createPickId({primitive:this,id:this.id})),(ot||st||!f(this._pickSP)||ct)&&(nt=new p({sources:[k]}),u=new p({sources:[this.material.shaderSource,b],pickColorQualifier:"uniform"}),this.onlySunLighting&&u.defines.push("ONLY_SUN_LIGHTING"),!h&&w.fragmentDepth&&u.defines.push("WRITE_DEPTH"),this._useLogDepth&&(nt.defines.push("LOG_DEPTH"),u.defines.push("LOG_DEPTH"),u.sources.push(ut)),this._pickSP=y.replaceCache({context:w,shaderProgram:this._pickSP,vertexShaderSource:nt,fragmentShaderSource:u,attributeLocations:rt}),l.vertexArray=this._va,l.renderState=this._rs,l.shaderProgram=this._pickSP,l.uniformMap=r(r(this._uniforms,this._pickUniforms),this.material._uniforms),l.executeInClosestFrustum=h),l.boundingVolume=this._boundingSphere,l.modelMatrix=this._computedModelMatrix,l.pass=h?a.TRANSLUCENT:a.OPAQUE,lt.push(l))}},it.prototype.isDestroyed=function(){return!1},it.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),e(this)},it});t("Shaders/Appearances/EllipsoidSurfaceAppearanceFS",[],function(){"use strict";return"varying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nmaterialInput.s = v_st.s;\nmaterialInput.st = v_st;\nmaterialInput.str = vec3(v_st, 0.0);\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});t("Shaders/Appearances/EllipsoidSurfaceAppearanceVS",[],function(){"use strict";return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p = czm_computePosition();\nv_positionMC = position3DHigh + position3DLow;\nv_positionEC = (czm_modelViewRelativeToEye * p).xyz;\nv_st = st;\ngl_Position = czm_modelViewProjectionRelativeToEye * p;\n}\n"});t("Scene/EllipsoidSurfaceAppearance",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/VertexFormat","../Shaders/Appearances/EllipsoidSurfaceAppearanceFS","../Shaders/Appearances/EllipsoidSurfaceAppearanceVS","./Appearance","./Material"],function(n,t,i,r,u,f,e,o){"use strict";function s(i){i=n(i,n.EMPTY_OBJECT);var s=n(i.translucent,!0),r=n(i.aboveGround,!1);this.material=t(i.material)?i.material:o.fromType(o.ColorType);this.translucent=n(i.translucent,!0);this._vertexShaderSource=n(i.vertexShaderSource,f);this._fragmentShaderSource=n(i.fragmentShaderSource,u);this._renderState=e.getDefaultRenderState(s,!r,i.renderState);this._closed=!1;this._flat=n(i.flat,!1);this._faceForward=n(i.faceForward,r);this._aboveGround=r}return i(s.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return s.VERTEX_FORMAT}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}},aboveGround:{get:function(){return this._aboveGround}}}),s.VERTEX_FORMAT=r.POSITION_AND_ST,s.prototype.getFragmentShaderSource=e.prototype.getFragmentShaderSource,s.prototype.isTranslucent=e.prototype.isTranslucent,s.prototype.getRenderState=e.prototype.getRenderState,s});t("Scene/Fog",["../Core/Cartesian3","../Core/defined","../Core/Math","./SceneMode"],function(n,t,i,r){"use strict";function l(){this.enabled=!0;this.density=.0002;this.screenSpaceErrorFactor=2;this.minimumBrightness=.1}function v(n){var t=o,r=t.length,i;if(n<t[0])return u=0;if(n>t[r-1])return u=r-2;if(n>=t[u]){if(u+1<r&&n<t[u+1])return u;if(u+2<r&&n<t[u+2])return++u,u}else if(u-1>=0&&n>=t[u-1])return--u,u;for(i=0;i<r-2;++i)if(n>=t[i]&&n<t[i+1])break;return u=i}for(var c,s,e,u,a,o=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],f=[2e-5,.0002,.0001,7e-5,5e-5,4e-5,3e-5,19e-6,1e-5,85e-7,62e-7,58e-7,53e-7,52e-7,51e-7,42e-7,4e-6,34e-7,26e-7,22e-7],h=0;h<f.length;++h)f[h]*=1e6;for(c=f[1],s=f[f.length-1],e=0;e<f.length;++e)f[e]=(f[e]-s)/(c-s);return u=0,a=new n,l.prototype.update=function(u){var d=u.fog.enabled=this.enabled,h,l,b,k;if(d){if(h=u.camera,l=h.positionCartographic,!t(l)||l.height>8e5||u.mode!==r.SCENE3D){u.fog.enabled=!1;return}var p=l.height,e=v(p),g=i.clamp((p-o[e])/(o[e+1]-o[e]),0,1),y=i.lerp(f[e],f[e+1],g),w=this.density*1e6,nt=w/c*s;y=y*(w-nt)*1e-6;b=n.normalize(h.positionWC,a);k=Math.abs(n.dot(h.directionWC,b));y*=1-k;u.fog.density=y;u.fog.sse=this.screenSpaceErrorFactor;u.fog.minimumBrightness=this.minimumBrightness}},l});t("Scene/FrameRateMonitor",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Core/getTimestamp","../Core/TimeConstants"],function(n,t,i,r,u,f,e,o){"use strict";function s(i){function o(){c(e)}var e,r;if(!t(i)||!t(i.scene))throw new u("options.scene is required.");this._scene=i.scene;this.samplingWindow=n(i.samplingWindow,s.defaultSettings.samplingWindow);this.quietPeriod=n(i.quietPeriod,s.defaultSettings.quietPeriod);this.warmupPeriod=n(i.warmupPeriod,s.defaultSettings.warmupPeriod);this.minimumFrameRateDuringWarmup=n(i.minimumFrameRateDuringWarmup,s.defaultSettings.minimumFrameRateDuringWarmup);this.minimumFrameRateAfterWarmup=n(i.minimumFrameRateAfterWarmup,s.defaultSettings.minimumFrameRateAfterWarmup);this._lowFrameRate=new f;this._nominalFrameRate=new f;this._frameTimes=[];this._needsQuietPeriod=!0;this._quietPeriodEndTime=0;this._warmupPeriodEndTime=0;this._frameRateIsLow=!1;this._lastFramesPerSecond=undefined;this._pauseCount=0;e=this;this._preUpdateRemoveListener=this._scene.preUpdate.addEventListener(function(n,t){h(e,t)});this._hiddenPropertyName=document.hidden!==undefined?"hidden":document.mozHidden!==undefined?"mozHidden":document.msHidden!==undefined?"msHidden":document.webkitHidden!==undefined?"webkitHidden":undefined;r=document.hidden!==undefined?"visibilitychange":document.mozHidden!==undefined?"mozvisibilitychange":document.msHidden!==undefined?"msvisibilitychange":document.webkitHidden!==undefined?"webkitvisibilitychange":undefined;this._visibilityChangeRemoveListener=undefined;t(r)&&(document.addEventListener(r,o,!1),this._visibilityChangeRemoveListener=function(){document.removeEventListener(r,o,!1)})}function h(n){var t,i,r,u;if(!(n._pauseCount>0))if(t=e(),n._needsQuietPeriod)n._needsQuietPeriod=!1,n._frameTimes.length=0,n._quietPeriodEndTime=t+n.quietPeriod/o.SECONDS_PER_MILLISECOND,n._warmupPeriodEndTime=n._quietPeriodEndTime+(n.warmupPeriod+n.samplingWindow)/o.SECONDS_PER_MILLISECOND;else if(t>=n._quietPeriodEndTime&&(n._frameTimes.push(t),i=t-n.samplingWindow/o.SECONDS_PER_MILLISECOND,n._frameTimes.length>=2&&n._frameTimes[0]<=i)){while(n._frameTimes.length>=2&&n._frameTimes[1]<i)n._frameTimes.shift();r=(t-n._frameTimes[0])/(n._frameTimes.length-1);n._lastFramesPerSecond=1e3/r;u=1e3/(t>n._warmupPeriodEndTime?n.minimumFrameRateAfterWarmup:n.minimumFrameRateDuringWarmup);r>u?n._frameRateIsLow||(n._frameRateIsLow=!0,n._needsQuietPeriod=!0,n.lowFrameRate.raiseEvent(n.scene,n._lastFramesPerSecond)):n._frameRateIsLow&&(n._frameRateIsLow=!1,n._needsQuietPeriod=!0,n.nominalFrameRate.raiseEvent(n.scene,n._lastFramesPerSecond))}}function c(n){document[n._hiddenPropertyName]?n.pause():n.unpause()}return s.defaultSettings={samplingWindow:5,quietPeriod:2,warmupPeriod:5,minimumFrameRateDuringWarmup:4,minimumFrameRateAfterWarmup:8},s.fromScene=function(n){if(!t(n))throw new u("scene is required.");return(!t(n._frameRateMonitor)||n._frameRateMonitor.isDestroyed())&&(n._frameRateMonitor=new s({scene:n})),n._frameRateMonitor},i(s.prototype,{scene:{get:function(){return this._scene}},lowFrameRate:{get:function(){return this._lowFrameRate}},nominalFrameRate:{get:function(){return this._nominalFrameRate}},lastFramesPerSecond:{get:function(){return this._lastFramesPerSecond}}}),s.prototype.pause=function(){++this._pauseCount;this._pauseCount===1&&(this._frameTimes.length=0,this._lastFramesPerSecond=undefined)},s.prototype.unpause=function(){--this._pauseCount;this._pauseCount<=0&&(this._pauseCount=0,this._needsQuietPeriod=!0)},s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._preUpdateRemoveListener(),t(this._visibilityChangeRemoveListener)&&this._visibilityChangeRemoveListener(),r(this)},s});t("Scene/FrameState",["./SceneMode"],function(n){"use strict";function t(t,i,r){this.context=t;this.commandList=[];this.shadowMaps=[];this.brdfLutGenerator=undefined;this.environmentMap=undefined;this.mode=n.SCENE3D;this.morphTime=n.getMorphTime(n.SCENE3D);this.frameNumber=0;this.time=undefined;this.jobScheduler=r;this.mapProjection=undefined;this.camera=undefined;this.cullingVolume=undefined;this.occluder=undefined;this.maximumScreenSpaceError=undefined;this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1};this.creditDisplay=i;this.afterRender=[];this.scene3DOnly=!1;this.fog={enabled:!1,density:undefined,sse:undefined,minimumBrightness:undefined};this.terrainExaggeration=1;this.shadowState={shadowsEnabled:!0,lightShadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0};this.imagerySplitPosition=0;this.frustumSplits=[];this.backgroundColor=undefined;this.minimumDisableDepthTestDistance=undefined;this.invertClassification=!1;this.invertClassificationColor=undefined;this.useLogDepth=!1}return t});t("Scene/FrustumCommands",["../Core/defaultValue","../Renderer/Pass"],function(n,t){"use strict";function i(i,r){var u;this.near=n(i,0);this.far=n(r,0);var f=t.NUMBER_OF_PASSES,e=new Array(f),o=new Array(f);for(u=0;u<f;++u)e[u]=[],o[u]=0;this.commands=e;this.indices=o}return i});t("Shaders/GlobeFS",[],function(){"use strict";return"uniform vec4 u_initialColor;\n#if TEXTURE_UNITS > 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nuniform sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n#if defined(FOG) && (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE)\nuniform float u_minimumBrightness;\n#endif\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\nvec4 sampleAndBlend(\nvec4 previousColor,\nsampler2D textureToSample,\nvec2 tileTextureCoordinates,\nvec4 textureCoordinateRectangle,\nvec4 textureCoordinateTranslationAndScale,\nfloat textureAlpha,\nfloat textureBrightness,\nfloat textureContrast,\nfloat textureHue,\nfloat textureSaturation,\nfloat textureOneOverGamma,\nfloat split)\n{\nvec2 alphaMultiplier = step(textureCoordinateRectangle.st, tileTextureCoordinates);\ntextureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nalphaMultiplier = step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\ntextureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nvec2 translation = textureCoordinateTranslationAndScale.xy;\nvec2 scale = textureCoordinateTranslationAndScale.zw;\nvec2 textureCoordinates = tileTextureCoordinates * scale + translation;\nvec4 value = texture2D(textureToSample, textureCoordinates);\nvec3 color = value.rgb;\nfloat alpha = value.a;\n#ifdef APPLY_SPLIT\nfloat splitPosition = czm_imagerySplitPosition;\nif (split < 0.0 && gl_FragCoord.x > splitPosition) {\nalpha = 0.0;\n}\nelse if (split > 0.0 && gl_FragCoord.x < splitPosition) {\nalpha = 0.0;\n}\n#endif\n#ifdef APPLY_BRIGHTNESS\ncolor = mix(vec3(0.0), color, textureBrightness);\n#endif\n#ifdef APPLY_CONTRAST\ncolor = mix(vec3(0.5), color, textureContrast);\n#endif\n#ifdef APPLY_HUE\ncolor = czm_hue(color, textureHue);\n#endif\n#ifdef APPLY_SATURATION\ncolor = czm_saturation(color, textureSaturation);\n#endif\n#ifdef APPLY_GAMMA\ncolor = pow(color, vec3(textureOneOverGamma));\n#endif\nfloat sourceAlpha = alpha * textureAlpha;\nfloat outAlpha = mix(previousColor.a, 1.0, sourceAlpha);\nvec3 outColor = mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\nreturn vec4(outColor, outAlpha);\n}\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\nif (v_textureCoordinates.x < u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z < v_textureCoordinates.x ||\nv_textureCoordinates.y < u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w < v_textureCoordinates.y)\n{\ndiscard;\n}\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nfloat clipDistance = clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\nvec4 color = computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n#ifdef SHOW_TILE_BOUNDARIES\nif (v_textureCoordinates.x < (1.0/256.0) || v_textureCoordinates.x > (255.0/256.0) ||\nv_textureCoordinates.y < (1.0/256.0) || v_textureCoordinates.y > (255.0/256.0))\n{\ncolor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n#endif\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING)\nvec3 normalMC = czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));\nvec3 normalEC = czm_normal3D * normalMC;\n#endif\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nfloat cameraDist;\nif (czm_sceneMode == czm_sceneMode2D)\n{\ncameraDist = max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n}\nelse if (czm_sceneMode == czm_sceneModeColumbusView)\n{\ncameraDist = -czm_view[3].z;\n}\nelse\n{\ncameraDist = length(czm_view[3]);\n}\nfloat fadeOutDist = u_lightingFadeDistance.x;\nfloat fadeInDist = u_lightingFadeDistance.y;\nif (czm_sceneMode != czm_sceneMode3D) {\nvec3 radii = czm_getWgs84EllipsoidEC().radii;\nfloat maxRadii = max(radii.x, max(radii.y, radii.z));\nfadeOutDist -= maxRadii;\nfadeInDist -= maxRadii;\n}\nfloat fade = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\nfloat fade = 0.0;\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nvec2 waterMaskTranslation = u_waterMaskTranslationAndScale.xy;\nvec2 waterMaskScale = u_waterMaskTranslationAndScale.zw;\nvec2 waterMaskTextureCoordinates = v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\nwaterMaskTextureCoordinates.y = 1.0 - waterMaskTextureCoordinates.y;\nfloat mask = texture2D(u_waterMask, waterMaskTextureCoordinates).r;\nif (mask > 0.0)\n{\nmat3 enuToEye = czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\nvec2 ellipsoidTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC);\nvec2 ellipsoidFlippedTextureCoordinates = czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\nvec2 textureCoordinates = mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\ncolor = computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n}\n#endif\n#ifdef APPLY_MATERIAL\nczm_materialInput materialInput;\nmaterialInput.st = v_textureCoordinates.st;\nmaterialInput.normalEC = normalize(v_normalEC);\nmaterialInput.slope = v_slope;\nmaterialInput.height = v_height;\nczm_material material = czm_getMaterial(materialInput);\ncolor.xyz = mix(color.xyz, material.diffuse, material.alpha);\n#endif\n#if defined(ENABLE_VERTEX_LIGHTING)\nfloat diffuseIntensity = clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\nvec4 finalColor = vec4(color.rgb * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\nfloat diffuseIntensity = clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalEC) * 5.0 + 0.3, 0.0, 1.0);\ndiffuseIntensity = mix(1.0, diffuseIntensity, fade);\nvec4 finalColor = vec4(color.rgb * diffuseIntensity, color.a);\n#else\nvec4 finalColor = color;\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nvec4 clippingPlanesEdgeColor = vec4(1.0);\nclippingPlanesEdgeColor.rgb = u_clippingPlanesEdgeStyle.rgb;\nfloat clippingPlanesEdgeWidth = u_clippingPlanesEdgeStyle.a;\nif (clipDistance < clippingPlanesEdgeWidth)\n{\nfinalColor = clippingPlanesEdgeColor;\n}\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nconst float fExposure = 2.0;\nvec3 fogColor = v_fogMieColor + finalColor.rgb * v_fogRayleighColor;\nfogColor = vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#ifdef FOG\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\nfloat darken = clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\nfogColor *= darken;\n#endif\nfinalColor = vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#ifdef GROUND_ATMOSPHERE\nif (czm_sceneMode != czm_sceneMode3D)\n{\ngl_FragColor = finalColor;\nreturn;\n}\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) && (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\nczm_ellipsoid ellipsoid = czm_getWgs84EllipsoidEC();\nfloat mpp = czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0));\nvec2 xy = gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\nxy *= czm_viewport.zw * mpp * 0.5;\nvec3 direction = normalize(vec3(xy, -czm_currentFrustum.x));\nczm_ray ray = czm_ray(vec3(0.0), direction);\nczm_raySegment intersection = czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\nvec3 ellipsoidPosition = czm_pointAlongRay(ray, intersection.start);\nellipsoidPosition = (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\nAtmosphereColor atmosColor = computeGroundAtmosphereFromSpace(ellipsoidPosition, true);\nvec3 groundAtmosphereColor = atmosColor.mie + finalColor.rgb * atmosColor.rayleigh;\ngroundAtmosphereColor = vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\nfadeInDist = u_nightFadeDistance.x;\nfadeOutDist = u_nightFadeDistance.y;\nfloat sunlitAtmosphereIntensity = clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\ngroundAtmosphereColor = mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\nvec3 groundAtmosphereColor = fogColor;\n#endif\nfinalColor = vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n#endif\ngl_FragColor = finalColor;\n}\n#ifdef SHOW_REFLECTIVE_OCEAN\nfloat waveFade(float edge0, float edge1, float x)\n{\nfloat y = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\nreturn pow(1.0 - y, 5.0);\n}\nfloat linearFade(float edge0, float edge1, float x)\n{\nreturn clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\nconst float oceanFrequencyLowAltitude = 825000.0;\nconst float oceanAnimationSpeedLowAltitude = 0.004;\nconst float oceanOneOverAmplitudeLowAltitude = 1.0 / 2.0;\nconst float oceanSpecularIntensity = 0.5;\nconst float oceanFrequencyHighAltitude = 125000.0;\nconst float oceanAnimationSpeedHighAltitude = 0.008;\nconst float oceanOneOverAmplitudeHighAltitude = 1.0 / 2.0;\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\nvec3 positionToEyeEC = -positionEyeCoordinates;\nfloat positionToEyeECLength = length(positionToEyeEC);\nvec3 normalizedpositionToEyeEC = normalize(normalize(positionToEyeEC));\nfloat waveIntensity = waveFade(70000.0, 1000000.0, positionToEyeECLength);\n#ifdef SHOW_OCEAN_WAVES\nfloat time = czm_frameNumber * oceanAnimationSpeedHighAltitude;\nvec4 noise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\nvec3 normalTangentSpaceHighAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\ntime = czm_frameNumber * oceanAnimationSpeedLowAltitude;\nnoise = czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\nvec3 normalTangentSpaceLowAltitude = vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\nfloat highAltitudeFade = linearFade(0.0, 60000.0, positionToEyeECLength);\nfloat lowAltitudeFade = 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\nvec3 normalTangentSpace =\n(highAltitudeFade * normalTangentSpaceHighAltitude) +\n(lowAltitudeFade * normalTangentSpaceLowAltitude);\nnormalTangentSpace = normalize(normalTangentSpace);\nnormalTangentSpace.xy *= waveIntensity;\nnormalTangentSpace = normalize(normalTangentSpace);\n#else\nvec3 normalTangentSpace = vec3(0.0, 0.0, 1.0);\n#endif\nvec3 normalEC = enuToEye * normalTangentSpace;\nconst vec3 waveHighlightColor = vec3(0.3, 0.45, 0.6);\nfloat diffuseIntensity = czm_getLambertDiffuse(czm_sunDirectionEC, normalEC) * maskValue;\nvec3 diffuseHighlight = waveHighlightColor * diffuseIntensity * (1.0 - fade);\n#ifdef SHOW_OCEAN_WAVES\nfloat tsPerturbationRatio = normalTangentSpace.z;\nvec3 nonDiffuseHighlight = mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\nvec3 nonDiffuseHighlight = vec3(0.0);\n#endif\nfloat specularIntensity = czm_getSpecular(czm_sunDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0) + 0.25 * czm_getSpecular(czm_moonDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0);\nfloat surfaceReflectance = mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\nfloat specular = specularIntensity * surfaceReflectance;\nreturn vec4(imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular, imageryColor.a);\n}\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n"});t("Shaders/GlobeVS",[],function(){"use strict";return"#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_height;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn u_modifiedModelViewProjection * vec4(position, 1.0);\n}\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\nconst float maxTileWidth = 0.003068;\nfloat positionFraction = textureCoordinates.y;\nfloat southLatitude = u_southAndNorthLatitude.x;\nfloat northLatitude = u_southAndNorthLatitude.y;\nif (northLatitude - southLatitude > maxTileWidth)\n{\nfloat southMercatorY = u_southMercatorYAndOneOverHeight.x;\nfloat oneOverMercatorHeight = u_southMercatorYAndOneOverHeight.y;\nfloat currentLatitude = mix(southLatitude, northLatitude, textureCoordinates.y);\ncurrentLatitude = clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\npositionFraction = czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n}\nreturn positionFraction;\n}\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\nreturn textureCoordinates.y;\n}\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\nfloat yPositionFraction = get2DYPositionFraction(textureCoordinates);\nvec4 rtcPosition2D = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nreturn u_modifiedModelViewProjection * rtcPosition2D;\n}\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn getPositionPlanarEarth(position, height, textureCoordinates);\n}\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\nvec3 position3DWC = position + u_center3D;\nfloat yPositionFraction = get2DYPositionFraction(textureCoordinates);\nvec4 position2DWC = vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nvec4 morphPosition = czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\nreturn czm_modelViewProjection * morphPosition;\n}\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\nvec2 xy = czm_decompressTextureCoordinates(compressed0.x);\nvec2 zh = czm_decompressTextureCoordinates(compressed0.y);\nvec3 position = vec3(xy, zh.x);\nfloat height = zh.y;\nvec2 textureCoordinates = czm_decompressTextureCoordinates(compressed0.z);\nheight = height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\nposition = (u_scaleAndBias * vec4(position, 1.0)).xyz;\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\nfloat encodedNormal = compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = czm_decompressTextureCoordinates(compressed0.w).x;\nfloat encodedNormal = 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = compressed0.w;\n#else\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = 0.0;\n#endif\n#else\nvec3 position = position3DAndHeight.xyz;\nfloat height = position3DAndHeight.w;\nvec2 textureCoordinates = textureCoordAndEncodedNormals.xy;\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) && defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = textureCoordAndEncodedNormals.z;\nfloat encodedNormal = textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT = textureCoordAndEncodedNormals.z;\nfloat encodedNormal = 0.0;\n#else\nfloat webMercatorT = textureCoordinates.y;\nfloat encodedNormal = 0.0;\n#endif\n#endif\nvec3 position3DWC = position + u_center3D;\ngl_Position = getPosition(position, height, textureCoordinates);\nv_textureCoordinates = vec3(textureCoordinates, webMercatorT);\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\nv_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\nv_positionMC = position3DWC;\nvec3 normalMC = czm_octDecode(encodedNormal);\nv_normalMC = normalMC;\nv_normalEC = czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION)\nv_positionEC = (u_modifiedModelView * vec4(position, 1.0)).xyz;\nv_positionMC = position3DWC;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nAtmosphereColor atmosFogColor = computeGroundAtmosphereFromSpace(position3DWC, false);\nv_fogMieColor = atmosFogColor.mie;\nv_fogRayleighColor = atmosFogColor.rayleigh;\nv_distance = length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n#ifdef APPLY_MATERIAL\nvec3 finalNormal = normalMC;\nvec3 ellipsoidNormal = normalize(position3DWC.xyz);\nv_slope = abs(dot(ellipsoidNormal, finalNormal));\nv_height = height;\n#endif\n}\n"});t("Shaders/GroundAtmosphere",[],function(){"use strict";return"const float fInnerRadius = 6378137.0;\nconst float fOuterRadius = 6378137.0 * 1.025;\nconst float fOuterRadius2 = fOuterRadius * fOuterRadius;\nconst float Kr = 0.0025;\nconst float Km = 0.0015;\nconst float ESun = 15.0;\nconst float fKrESun = Kr * ESun;\nconst float fKmESun = Km * ESun;\nconst float fKr4PI = Kr * 4.0 * czm_pi;\nconst float fKm4PI = Km * 4.0 * czm_pi;\nconst float fScale = 1.0 / (fOuterRadius - fInnerRadius);\nconst float fScaleDepth = 0.25;\nconst float fScaleOverScaleDepth = fScale / fScaleDepth;\nstruct AtmosphereColor\n{\nvec3 mie;\nvec3 rayleigh;\n};\nconst int nSamples = 2;\nconst float fSamples = 2.0;\nfloat scale(float fCos)\n{\nfloat x = 1.0 - fCos;\nreturn fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool useSunLighting)\n{\nvec3 v3InvWavelength = vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\nvec3 v3Ray = v3Pos - czm_viewerPositionWC;\nfloat fFar = length(v3Ray);\nv3Ray /= fFar;\nfloat fCameraHeight = length(czm_viewerPositionWC);\nfloat fCameraHeight2 = fCameraHeight * fCameraHeight;\nfloat B = 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\nfloat C = fCameraHeight2 - fOuterRadius2;\nfloat fDet = max(0.0, B*B - 4.0 * C);\nfloat fNear = 0.5 * (-B - sqrt(fDet));\nvec3 v3Start = czm_viewerPositionWC + v3Ray * fNear;\nfFar -= fNear;\nfloat fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\nfloat fLightAngle = useSunLighting ? dot(czm_sunDirectionWC, v3Pos) / length(v3Pos) : 1.0;\nfloat fCameraAngle = dot(-v3Ray, v3Pos) / length(v3Pos);\nfloat fCameraScale = scale(fCameraAngle);\nfloat fLightScale = scale(fLightAngle);\nfloat fCameraOffset = fDepth*fCameraScale;\nfloat fTemp = (fLightScale + fCameraScale);\nfloat fSampleLength = fFar / fSamples;\nfloat fScaledLength = fSampleLength * fScale;\nvec3 v3SampleRay = v3Ray * fSampleLength;\nvec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\nvec3 v3FrontColor = vec3(0.0);\nvec3 v3Attenuate = vec3(0.0);\nfor(int i=0; i<nSamples; i++)\n{\nfloat fHeight = length(v3SamplePoint);\nfloat fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\nfloat fScatter = fDepth*fTemp - fCameraOffset;\nv3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\nv3FrontColor += v3Attenuate * (fDepth * fScaledLength);\nv3SamplePoint += v3SampleRay;\n}\nAtmosphereColor color;\ncolor.mie = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\ncolor.rayleigh = v3Attenuate;\nreturn color;\n}\n"});t("Scene/GlobeSurfaceShaderSet",["../Core/defined","../Core/destroyObject","../Core/TerrainQuantization","../Renderer/ShaderProgram","./getClippingFunction","./SceneMode"],function(n,t,i,r,u,f){"use strict";function o(n,t,i,r,u){this.numberOfDayTextures=n;this.flags=t;this.material=i;this.shaderProgram=r;this.clippingShaderState=u}function e(){this.baseVertexShaderSource=undefined;this.baseFragmentShaderSource=undefined;this._shadersByTexturesFlags=[];this.material=undefined}function s(n){var t;switch(n){case f.SCENE3D:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";break;case f.SCENE2D:case f.COLUMBUS_VIEW:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";break;case f.MORPHING:t="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }"}return t}function h(n){return n?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }"}return e.prototype.getShaderProgram=function(t){var k=t.frameState,p=t.surfaceTile,a=t.numberOfDayTextures,d=t.applyBrightness,g=t.applyContrast,nt=t.applyHue,tt=t.applySaturation,it=t.applyGamma,rt=t.applyAlpha,ut=t.applySplit,lt=t.showReflectiveOcean,at=t.showOceanWaves,vt=t.enableLighting,yt=t.showGroundAtmosphere,pt=t.perFragmentGroundAtmosphere,wt=t.hasVertexNormals,bt=t.useWebMercatorProjection,kt=t.enableFog,ft=t.enableClippingPlanes,et=t.clippingPlanes,ri=t.clippedByBoundaries,dt=0,gt="",ni=p.pickTerrain.mesh.encoding,ui=ni.quantization,ot,st,ht,ct,e,y,l,f,b,c,ii;ui===i.BITS12&&(dt=1,gt="QUANTIZATION_BITS12");ot=0;st="";p.terrainData._createdByUpsampling&&(ot=1,st="DISABLE_GL_POSITION_LOG_DEPTH");ht=0;ct="";ri&&(ht=1,ct="TILE_LIMIT_RECTANGLE");var ti=k.mode,w=ti|d<<2|g<<3|nt<<4|tt<<5|it<<6|rt<<7|lt<<8|at<<9|vt<<10|yt<<11|pt<<12|wt<<13|bt<<14|kt<<15|dt<<16|ut<<17|ft<<18|ot<<19|ht<<20,v=0;if(n(et)&&(v=ft?et.clippingPlanesState:0),e=p.surfaceShader,n(e)&&e.numberOfDayTextures===a&&e.flags===w&&e.material===this.material&&e.clippingShaderState===v)return e.shaderProgram;if(y=this._shadersByTexturesFlags[a],n(y)||(y=this._shadersByTexturesFlags[a]=[]),e=y[w],!n(e)||e.material!==this.material||e.clippingShaderState!==v){for(l=this.baseVertexShaderSource.clone(),f=this.baseFragmentShaderSource.clone(),v!==0&&f.sources.unshift(u(et,k.context)),l.defines.push(gt,st),f.defines.push("TEXTURE_UNITS "+a,ct),d&&f.defines.push("APPLY_BRIGHTNESS"),g&&f.defines.push("APPLY_CONTRAST"),nt&&f.defines.push("APPLY_HUE"),tt&&f.defines.push("APPLY_SATURATION"),it&&f.defines.push("APPLY_GAMMA"),rt&&f.defines.push("APPLY_ALPHA"),lt&&(f.defines.push("SHOW_REFLECTIVE_OCEAN"),l.defines.push("SHOW_REFLECTIVE_OCEAN")),at&&f.defines.push("SHOW_OCEAN_WAVES"),vt&&(wt?(l.defines.push("ENABLE_VERTEX_LIGHTING"),f.defines.push("ENABLE_VERTEX_LIGHTING")):(l.defines.push("ENABLE_DAYNIGHT_SHADING"),f.defines.push("ENABLE_DAYNIGHT_SHADING"))),yt&&(l.defines.push("GROUND_ATMOSPHERE"),f.defines.push("GROUND_ATMOSPHERE"),pt&&f.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE")),l.defines.push("INCLUDE_WEB_MERCATOR_Y"),f.defines.push("INCLUDE_WEB_MERCATOR_Y"),kt&&(l.defines.push("FOG"),f.defines.push("FOG")),ut&&f.defines.push("APPLY_SPLIT"),ft&&f.defines.push("ENABLE_CLIPPING_PLANES"),b="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates)\n    {\n        vec4 color = initialColor;\n",c=0;c<a;++c)b+="    color = sampleAndBlend(\n        color,\n        u_dayTextures["+c+"],\n        u_dayTextureUseWebMercatorT["+c+"] ? textureCoordinates.xz : textureCoordinates.xy,\n        u_dayTextureTexCoordsRectangle["+c+"],\n        u_dayTextureTranslationAndScale["+c+"],\n        "+(rt?"u_dayTextureAlpha["+c+"]":"1.0")+",\n        "+(d?"u_dayTextureBrightness["+c+"]":"0.0")+",\n        "+(g?"u_dayTextureContrast["+c+"]":"0.0")+",\n        "+(nt?"u_dayTextureHue["+c+"]":"0.0")+",\n        "+(tt?"u_dayTextureSaturation["+c+"]":"0.0")+",\n        "+(it?"u_dayTextureOneOverGamma["+c+"]":"0.0")+",\n        "+(ut?"u_dayTextureSplit["+c+"]":"0.0")+"\n    );\n";b+="        return color;\n    }";f.sources.push(b);l.sources.push(s(ti));l.sources.push(h(bt));ii=r.fromCache({context:k.context,vertexShaderSource:l,fragmentShaderSource:f,attributeLocations:ni.getAttributeLocations()});e=y[w]=new o(a,w,this.material,ii,v)}return p.surfaceShader=e,e.shaderProgram},e.prototype.destroy=function(){var r,u,f=this._shadersByTexturesFlags,e,i;for(e in f)if(f.hasOwnProperty(e)){if(i=f[e],!n(i))continue;for(r in i)i.hasOwnProperty(r)&&(u=i[r],n(u)&&u.shaderProgram.destroy())}return t(this)},e});t("Scene/ImageryState",["../Core/freezeObject"],function(n){"use strict";return n({UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7})});t("Scene/QuadtreeTileLoadState",["../Core/freezeObject"],function(n){"use strict";return n({START:0,LOADING:1,DONE:2,FAILED:3})});t("Scene/TerrainState",["../Core/freezeObject"],function(n){"use strict";return n({FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6})});t("Scene/TileTerrain",["../Core/BoundingSphere","../Core/Cartesian3","../Core/defined","../Core/DeveloperError","../Core/IndexDatatype","../Core/OrientedBoundingBox","../Core/Request","../Core/RequestState","../Core/RequestType","../Core/TileProviderError","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/VertexArray","../ThirdParty/when","./TerrainState"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n){this.state=y.UNLOADED;this.data=undefined;this.mesh=undefined;this.vertexArray=undefined;this.upsampleDetails=n;this.request=undefined}function k(n,t,r,u,f,c){function a(t){n.data=t;n.state=y.RECEIVED;n.request=undefined}function p(){if(n.request.state===o.CANCELLED){n.data=undefined;n.state=y.UNLOADED;n.request=undefined;return}n.state=y.FAILED;n.request=undefined;var i="Failed to obtain terrain tile X: "+r+" Y: "+u+" Level: "+f+".";t._requestError=h.handleError(t._requestError,t,t.errorEvent,i,r,u,f,l)}function l(){var o=new e({throttle:!0,throttleByServer:!0,type:s.TERRAIN,priorityFunction:c});n.request=o;n.data=t.requestTileGeometry(r,u,f,o);i(n.data)?(n.state=y.RECEIVING,v(n.data,a,p)):(n.state=y.UNLOADED,n.request=undefined)}l()}function w(n,t,r,u,f,e){var s=r.tilingScheme,h=n.data,o=h.createMesh(s,u,f,e,t.terrainExaggeration);i(o)&&(n.state=y.TRANSFORMING,v(o,function(t){n.mesh=t;n.state=y.TRANSFORMED},function(){n.state=y.FAILED}))}function b(n,t){var s=n.mesh.vertices,h=c.createVertexBuffer({context:t,typedArray:s,usage:l.STATIC_DRAW}),v=n.mesh.encoding.getAttributes(h),f=n.mesh.indices.indexBuffers||{},r=f[t.id],e,o;!i(r)||r.isDestroyed()?(e=n.mesh.indices,o=e.BYTES_PER_ELEMENT===2?u.UNSIGNED_SHORT:u.UNSIGNED_INT,r=c.createIndexBuffer({context:t,typedArray:e,usage:l.STATIC_DRAW,indexDatatype:o}),r.vertexArrayDestroyable=!1,r.referenceCount=1,f[t.id]=r,n.mesh.indices.indexBuffers=f):++r.referenceCount;n.vertexArray=new a({context:t,attributes:v,indexBuffer:r});n.state=y.READY}return p.prototype.freeResources=function(){if(this.state=y.UNLOADED,this.data=undefined,this.mesh=undefined,i(this.vertexArray)){var n=this.vertexArray.indexBuffer;this.vertexArray.destroy();this.vertexArray=undefined;!n.isDestroyed()&&i(n.referenceCount)&&(--n.referenceCount,n.referenceCount===0&&n.destroy())}},p.prototype.publishToTile=function(i){var r=i.data,u=this.mesh;t.clone(u.center,r.center);r.minimumHeight=u.minimumHeight;r.maximumHeight=u.maximumHeight;r.boundingSphere3D=n.clone(u.boundingSphere3D,r.boundingSphere3D);r.orientedBoundingBox=f.clone(u.orientedBoundingBox,r.orientedBoundingBox);r.tileBoundingRegion.minimumHeight=u.minimumHeight;r.tileBoundingRegion.maximumHeight=u.maximumHeight;i.data.occludeePointInScaledSpace=t.clone(u.occludeePointInScaledSpace,r.occludeePointInScaledSpace)},p.prototype.processLoadStateMachine=function(n,t,i,r,u,f){this.state===y.UNLOADED&&k(this,t,i,r,u,f);this.state===y.RECEIVED&&w(this,n,t,i,r,u);this.state===y.TRANSFORMED&&b(this,n.context,t,i,r,u)},p.prototype.processUpsampleStateMachine=function(n,t,u,f,e){var o,s;if(this.state===y.UNLOADED){if(o=this.upsampleDetails,!i(o))throw new r("TileTerrain cannot upsample unless provided upsampleDetails.");var h=o.data,c=o.x,l=o.y,a=o.level;if(this.data=h.upsample(t.tilingScheme,c,l,a,u,f,e),!i(this.data))return;this.state=y.RECEIVING;s=this;v(this.data,function(n){s.data=n;s.state=y.RECEIVED},function(){s.state=y.FAILED})}this.state===y.RECEIVED&&w(this,n,t,u,f,e);this.state===y.TRANSFORMED&&b(this,n.context,t,u,f,e)},p});t("Scene/GlobeSurfaceTile",["../Core/BoundingSphere","../Core/Cartesian3","../Core/Cartesian4","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/IntersectionTests","../Core/PixelFormat","../Renderer/PixelDatatype","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","./ImageryState","./QuadtreeTileLoadState","./SceneMode","./TerrainState","./TileBoundingRegion","./TileTerrain"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function g(){this.imagery=[];this.waterMaskTexture=undefined;this.waterMaskTranslationAndScale=new i(0,0,1,1);this.terrainData=undefined;this.center=new t;this.vertexArray=undefined;this.minimumHeight=0;this.maximumHeight=0;this.boundingSphere3D=new n;this.boundingSphere2D=new n;this.orientedBoundingBox=undefined;this.tileBoundingRegion=undefined;this.occludeePointInScaledSpace=new t;this.loadedTerrain=undefined;this.upsampledTerrain=undefined;this.pickBoundingSphere=new n;this.pickTerrain=undefined;this.surfaceShader=undefined;this.isClipped=!0;this.clippedByBoundaries=!1}function it(n,i,r,f,e,o){if(n.decodePosition(f,e,o),u(i)&&i!==w.SCENE3D){var s=r.ellipsoid,h=s.cartesianToCartographic(o);r.project(h,o);t.fromElements(o.z,o.x,o.y,o)}return o}function ot(n){var t,i;return u(n.parent)&&u(n.parent.data)&&(t=n.parent.data.minimumHeight,i=n.parent.data.maximumHeight),new k({rectangle:n.rectangle,ellipsoid:n.tilingScheme.ellipsoid,minimumHeight:t,maximumHeight:i})}function st(n,t){return function(){return n.tileBoundingRegion.distanceToCamera(t)}}function ht(n,t,i){var e=n.data,o=lt(n),r,s,f;for(u(o)&&(e.upsampledTerrain=new d(o)),yt(n,t)&&(e.loadedTerrain=new d),r=0,s=i.length;r<s;++r)f=i.get(r),f.show&&f._createTileImagerySkeletons(n,t)}function ct(n,t,i,f){var e=n.data,o=e.loadedTerrain,s=e.upsampledTerrain,h=!1;u(o)&&(o.processLoadStateMachine(t,i,n.x,n.y,n.level,n._priorityFunction),o.state>=b.RECEIVED&&(e.terrainData!==o.data&&(e.terrainData=o.data,wt(t.context,e),vt(n)),h=!0),o.state===b.READY?(o.publishToTile(n),u(n.data.vertexArray)&&f.push(n.data.vertexArray),n.data.vertexArray=o.vertexArray,o.vertexArray=undefined,e.pickTerrain=r(e.loadedTerrain,e.upsampledTerrain),e.loadedTerrain=undefined,e.upsampledTerrain=undefined):o.state===b.FAILED&&(e.loadedTerrain=undefined));!h&&u(s)&&(s.processUpsampleStateMachine(t,i,n.x,n.y,n.level),s.state>=b.RECEIVED&&e.terrainData!==s.data&&(e.terrainData=s.data,i.hasWaterMask&&bt(n),at(n)),s.state===b.READY?(s.publishToTile(n),u(n.data.vertexArray)&&f.push(n.data.vertexArray),n.data.vertexArray=s.vertexArray,s.vertexArray=undefined,e.pickTerrain=e.upsampledTerrain,e.upsampledTerrain=undefined):s.state===b.FAILED&&(e.upsampledTerrain=undefined))}function lt(n){for(var t=n.parent;u(t)&&u(t.data)&&!u(t.data.terrainData);)t=t.parent;return!u(t)||!u(t.data)?undefined:{data:t.data.terrainData,x:t.x,y:t.y,level:t.level}}function at(n){nt(n,n._southwestChild);nt(n,n._southeastChild);nt(n,n._northwestChild);nt(n,n._northeastChild)}function nt(n,t){if(u(t)&&t.state!==p.START){var i=t.data;if(u(i.terrainData)&&!i.terrainData.wasCreatedByUpsampling())return;u(i.upsampledTerrain)&&i.upsampledTerrain.freeResources();i.upsampledTerrain=new d({data:n.data.terrainData,x:n.x,y:n.y,level:n.level});t.state=p.LOADING}}function vt(n){var t=n.data;tt(n,t,n.southwestChild);tt(n,t,n.southeastChild);tt(n,t,n.northwestChild);tt(n,t,n.northeastChild)}function tt(n,t,i){if(i.state!==p.START){var r=i.data;if(u(r.terrainData)&&!r.terrainData.wasCreatedByUpsampling())return;u(r.upsampledTerrain)&&r.upsampledTerrain.freeResources();r.upsampledTerrain=new d({data:t.terrainData,x:n.x,y:n.y,level:n.level});t.terrainData.isChildAvailable(n.x,n.y,i.x,i.y)&&(u(r.loadedTerrain)||(r.loadedTerrain=new d));i.state=p.LOADING}}function yt(n,t){var r=t.getTileDataAvailable(n.x,n.y,n.level),i;return u(r)?r:(i=n.parent,!u(i))?!0:!u(i.data)||!u(i.data.terrainData)?!1:i.data.terrainData.isChildAvailable(i.x,i.y,n.x,n.y)}function pt(n){var t=n.cache.tile_waterMaskData,i,r;return u(t)||(i=new c({context:n,pixelFormat:o.LUMINANCE,pixelDatatype:s.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}}),i.referenceCount=1,r=new h({wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,minificationFilter:a.LINEAR,magnificationFilter:l.LINEAR}),t={allWaterTexture:i,sampler:r,destroy:function(){this.allWaterTexture.destroy()}},n.cache.tile_waterMaskData=t),t}function wt(n,t){var e=t.waterMaskTexture,r,h,f,l,a;if(u(e)&&(--e.referenceCount,e.referenceCount===0&&e.destroy(),t.waterMaskTexture=undefined),r=t.terrainData.waterMask,u(r)){if(h=pt(n),l=r.length,l===1)if(r[0]!==0)f=h.allWaterTexture;else return;else a=Math.sqrt(l),f=new c({context:n,pixelFormat:o.LUMINANCE,pixelDatatype:s.UNSIGNED_BYTE,source:{width:a,height:a,arrayBufferView:r},sampler:h.sampler,flipY:!1}),f.referenceCount=0;++f.referenceCount;t.waterMaskTexture=f;i.fromElements(0,0,1,1,t.waterMaskTranslationAndScale)}}function bt(n){for(var i=n.data,t=n.parent;u(t)&&!u(t.data.terrainData)||t.data.terrainData.wasCreatedByUpsampling();)t=t.parent;if(u(t)&&u(t.data.waterMaskTexture)){i.waterMaskTexture=t.data.waterMaskTexture;++i.waterMaskTexture.referenceCount;var r=t.rectangle,f=n.rectangle,e=f.width,o=f.height,s=e/r.width,h=o/r.height;i.waterMaskTranslationAndScale.x=s*(f.west-r.west)/e;i.waterMaskTranslationAndScale.y=h*(f.south-r.south)/o;i.waterMaskTranslationAndScale.z=s;i.waterMaskTranslationAndScale.w=h}}f(g.prototype,{eligibleForUnloading:{get:function(){for(var f,n=this.loadedTerrain,o=u(n)&&(n.state===b.RECEIVING||n.state===b.TRANSFORMING),t=this.upsampledTerrain,s=u(t)&&(t.state===b.RECEIVING||t.state===b.TRANSFORMING),i=!o&&!s,e=this.imagery,r=0,h=e.length;i&&r<h;++r)f=e[r],i=!u(f.loadingImagery)||f.loadingImagery.state!==y.TRANSITIONING;return i}}});var rt=new t,ut=new t,ft=new t,et=new t;return g.prototype.pick=function(n,i,r,f,o){var v=this.pickTerrain,h,s;if(!u(v)||(h=v.mesh,!u(h)))return undefined;var l=h.vertices,c=h.indices,a=h.encoding,p=c.length;for(s=0;s<p;s+=3){var w=c[s],b=c[s+1],k=c[s+2],d=it(a,i,r,l,w,rt),g=it(a,i,r,l,b,ut),nt=it(a,i,r,l,k,ft),y=e.rayTriangle(n,d,g,nt,f,et);if(u(y))return t.clone(y,o)}return undefined},g.prototype.freeResources=function(){u(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,this.waterMaskTexture.referenceCount===0&&this.waterMaskTexture.destroy(),this.waterMaskTexture=undefined);this.terrainData=undefined;u(this.loadedTerrain)&&(this.loadedTerrain.freeResources(),this.loadedTerrain=undefined);u(this.upsampledTerrain)&&(this.upsampledTerrain.freeResources(),this.upsampledTerrain=undefined);u(this.pickTerrain)&&(this.pickTerrain.freeResources(),this.pickTerrain=undefined);for(var i=this.imagery,n=0,t=i.length;n<t;++n)i[n].freeResources();this.imagery.length=0;this.freeVertexArray()},g.prototype.freeVertexArray=function(){var n;u(this.vertexArray)&&(n=this.vertexArray.indexBuffer,this.vertexArray=this.vertexArray.destroy(),!n.isDestroyed()&&u(n.referenceCount)&&(--n.referenceCount,n.referenceCount===0&&n.destroy()));u(this.wireframeVertexArray)&&(n=this.wireframeVertexArray.indexBuffer,this.wireframeVertexArray=this.wireframeVertexArray.destroy(),!n.isDestroyed()&&u(n.referenceCount)&&(--n.referenceCount,n.referenceCount===0&&n.destroy()))},g.processStateMachine=function(n,t,i,r,f){var e=n.data,o,k,d,c,nt,l;u(e)||(e=n.data=new g,e.tileBoundingRegion=ot(n));u(n._priorityFunction)||(n._priorityFunction=st(e,t));n.state===p.START&&(ht(n,i,r),n.state=p.LOADING);n.state===p.LOADING&&ct(n,t,i,f);for(var w=u(e.vertexArray),b=!u(e.loadedTerrain)&&!u(e.upsampledTerrain),h=u(e.terrainData)&&e.terrainData.wasCreatedByUpsampling(),a=e.imagery,s=0,v=a.length;s<v;++s){if(o=a[s],!u(o.loadingImagery)){h=!1;continue}if(o.loadingImagery.state===y.PLACEHOLDER)if(k=o.loadingImagery.imageryLayer,k.imageryProvider.ready){o.freeResources();a.splice(s,1);k._createTileImagerySkeletons(n,i,s);--s;v=a.length;continue}else h=!1;d=o.processStateMachine(n,t);b=b&&d;w=w&&(d||u(o.readyImagery));h=h&&u(o.loadingImagery)&&(o.loadingImagery.state===y.FAILED||o.loadingImagery.state===y.INVALID)}if(n.upsampledFromParent=h,s===v&&(w&&(n.renderable=!0),b)){c=n._loadedCallbacks;nt={};for(l in c)c.hasOwnProperty(l)&&(c[l](n)||(nt[l]=c[l]));n._loadedCallbacks=nt;n.state=p.DONE;n._priorityFunction=undefined}},g});t("Shaders/ReprojectWebMercatorFS",[],function(){"use strict";return"uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n"});t("Shaders/ReprojectWebMercatorVS",[],function(){"use strict";return"attribute vec4 position;\nattribute float webMercatorT;\nuniform vec2 u_textureDimensions;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nv_textureCoordinates = vec2(position.x, webMercatorT);\ngl_Position = czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));\n}\n"});t("Scene/Imagery",["../Core/defined","../Core/destroyObject","./ImageryState"],function(n,t,i){"use strict";function r(t,r,u,f,e){var o;if(this.imageryLayer=t,this.x=r,this.y=u,this.level=f,this.request=undefined,f!==0){var s=r/2|0,h=u/2|0,c=f-1;this.parent=t.getImageryFromCache(s,h,c)}this.state=i.UNLOADED;this.imageUrl=undefined;this.image=undefined;this.texture=undefined;this.textureWebMercator=undefined;this.credits=undefined;this.referenceCount=0;!n(e)&&t.imageryProvider.ready&&(o=t.imageryProvider.tilingScheme,e=o.tileXYToRectangle(r,u,f));this.rectangle=e}return r.createPlaceholder=function(n){var t=new r(n,0,0,0);return t.addReference(),t.state=i.PLACEHOLDER,t},r.prototype.addReference=function(){++this.referenceCount},r.prototype.releaseReference=function(){return(--this.referenceCount,this.referenceCount===0)?(this.imageryLayer.removeImageryFromCache(this),n(this.parent)&&this.parent.releaseReference(),n(this.image)&&n(this.image.destroy)&&this.image.destroy(),n(this.texture)&&this.texture.destroy(),n(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),t(this),0):this.referenceCount},r.prototype.processStateMachine=function(n,t,r){this.state===i.UNLOADED&&(this.state=i.TRANSITIONING,this.imageryLayer._requestImagery(this,r));this.state===i.RECEIVED&&(this.state=i.TRANSITIONING,this.imageryLayer._createTexture(n.context,this));var u=this.state===i.READY&&t&&!this.texture;(this.state===i.TEXTURE_LOADED||u)&&(this.state=i.TRANSITIONING,this.imageryLayer._reprojectTexture(n,this,t))},r});t("Scene/ImagerySplitDirection",["../Core/freezeObject"],function(n){"use strict";return n({LEFT:-1,NONE:0,RIGHT:1})});t("Scene/TileImagery",["../Core/defined","./ImageryState"],function(n,t){"use strict";function i(n,t,i){this.readyImagery=undefined;this.loadingImagery=n;this.textureCoordinateRectangle=t;this.textureTranslationAndScale=undefined;this.useWebMercatorT=i}return i.prototype.freeResources=function(){n(this.readyImagery)&&this.readyImagery.releaseReference();n(this.loadingImagery)&&this.loadingImagery.releaseReference()},i.prototype.processStateMachine=function(i,r){var f=this.loadingImagery,o=f.imageryLayer,u,e;if(f.processStateMachine(r,!this.useWebMercatorT,i._priorityFunction),f.state===t.READY)return n(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=undefined,this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(i,this),!0;for(u=f.parent;n(u)&&(u.state!==t.READY||!this.useWebMercatorT&&!n(u.texture));)u.state!==t.FAILED&&u.state!==t.INVALID&&(e=e||u),u=u.parent;return(this.readyImagery!==u&&(n(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=u,n(u)&&(u.addReference(),this.textureTranslationAndScale=o._calculateTextureTranslationAndScale(i,this))),f.state===t.FAILED||f.state===t.INVALID)?n(e)?(e.processStateMachine(r,!this.useWebMercatorT,i._priorityFunction),!1):!0:!1},i});t("Scene/ImageryLayer",["../Core/Cartesian2","../Core/Cartesian4","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/FeatureDetection","../Core/GeographicProjection","../Core/GeographicTilingScheme","../Core/IndexDatatype","../Core/Math","../Core/PixelFormat","../Core/Rectangle","../Core/Request","../Core/RequestState","../Core/RequestType","../Core/TerrainProvider","../Core/TileProviderError","../Core/WebMercatorProjection","../Core/WebMercatorTilingScheme","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/ComputeCommand","../Renderer/ContextLimits","../Renderer/MipmapHint","../Renderer/Sampler","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Renderer/VertexArray","../Shaders/ReprojectWebMercatorFS","../Shaders/ReprojectWebMercatorVS","../ThirdParty/when","./Imagery","./ImagerySplitDirection","./ImageryState","./TileImagery"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt){"use strict";function gt(n,t){this._imageryProvider=n;t=i(t,{});this.alpha=i(t.alpha,i(n.defaultAlpha,1));this.brightness=i(t.brightness,i(n.defaultBrightness,gt.DEFAULT_BRIGHTNESS));this.contrast=i(t.contrast,i(n.defaultContrast,gt.DEFAULT_CONTRAST));this.hue=i(t.hue,i(n.defaultHue,gt.DEFAULT_HUE));this.saturation=i(t.saturation,i(n.defaultSaturation,gt.DEFAULT_SATURATION));this.gamma=i(t.gamma,i(n.defaultGamma,gt.DEFAULT_GAMMA));this.splitDirection=i(t.splitDirection,i(n.defaultSplit,gt.DEFAULT_SPLIT));this.minificationFilter=i(t.minificationFilter,i(n.defaultMinificationFilter,gt.DEFAULT_MINIFICATION_FILTER));this.magnificationFilter=i(t.magnificationFilter,i(n.defaultMagnificationFilter,gt.DEFAULT_MAGNIFICATION_FILTER));this.show=i(t.show,!0);this._minimumTerrainLevel=t.minimumTerrainLevel;this._maximumTerrainLevel=t.maximumTerrainLevel;this._rectangle=i(t.rectangle,v.MAX_VALUE);this._maximumAnisotropy=t.maximumAnisotropy;this._imageryCache={};this._skeletonPlaceholder=new dt(wt.createPlaceholder(this));this._show=!0;this._layerIndex=-1;this._isBaseLayer=!1;this._requestImageError=undefined;this._reprojectComputeCommands=[]}function fi(n,t,i){return n+":"+t+":"+i}function ei(n,t,u,f){var e=n.minificationFilter,s=n.magnificationFilter,k=e===ct.LINEAR&&s===ht.LINEAR,c,y,o,v;if(k&&!a.isCompressedFormat(f.pixelFormat)&&l.isPowerOfTwo(f.width)&&l.isPowerOfTwo(f.height)){e=ct.LINEAR_MIPMAP_LINEAR;var p=rt.maximumTextureFilterAnisotropy,w=Math.min(p,i(n._maximumAnisotropy,p)),b=fi(e,s,w),h=t.cache.imageryLayerMipmapSamplers;r(h)||(h={},t.cache.imageryLayerMipmapSamplers=h);c=h[b];r(c)||(c=h[b]=new ft({wrapS:lt.CLAMP_TO_EDGE,wrapT:lt.CLAMP_TO_EDGE,minificationFilter:e,magnificationFilter:s,maximumAnisotropy:w}));f.generateMipmap(ut.NICEST);f.sampler=c}else y=fi(e,s,0),o=t.cache.imageryLayerNonMipmapSamplers,r(o)||(o={},t.cache.imageryLayerNonMipmapSamplers=o),v=o[y],r(v)||(v=o[y]=new ft({wrapS:lt.CLAMP_TO_EDGE,wrapT:lt.CLAMP_TO_EDGE,minificationFilter:e,magnificationFilter:s})),f.sampler=v;u.state=kt.READY}function oi(n,t,i){return JSON.stringify([n,t,i])}function hi(n,t,i,u){var f=t.cache.imageryLayer_reproject,o,s,h,p,it,a,v,e,k,y,wt,bt,kt,g;if(!r(f)){for(f=t.cache.imageryLayer_reproject={vertexArray:undefined,shaderProgram:undefined,sampler:undefined,destroy:function(){r(this.framebuffer)&&this.framebuffer.destroy();r(this.vertexArray)&&this.vertexArray.destroy();r(this.shaderProgram)&&this.shaderProgram.destroy()}},o=new Float32Array(256),s=0,h=0;h<64;++h)p=h/63,o[s++]=0,o[s++]=p,o[s++]=1,o[s++]=p;var w={position:0,webMercatorT:1},dt=b.getRegularGridIndices(2,64),gt=nt.createIndexBuffer({context:t,typedArray:dt,usage:tt.STATIC_DRAW,indexDatatype:c.UNSIGNED_SHORT});f.vertexArray=new at({context:t,attributes:[{index:w.position,vertexBuffer:nt.createVertexBuffer({context:t,typedArray:o,usage:tt.STATIC_DRAW}),componentsPerAttribute:2},{index:w.webMercatorT,vertexBuffer:nt.createVertexBuffer({context:t,sizeInBytes:512,usage:tt.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:gt});it=new ot({sources:[yt]});f.shaderProgram=et.fromCache({context:t,vertexShaderSource:it,fragmentShaderSource:vt,attributeLocations:w});f.sampler=new ft({wrapS:lt.CLAMP_TO_EDGE,wrapT:lt.CLAMP_TO_EDGE,minificationFilter:ct.LINEAR,magnificationFilter:ht.LINEAR})}i.sampler=f.sampler;a=i.width;v=i.height;ni.textureDimensions.x=a;ni.textureDimensions.y=v;ni.texture=i;e=Math.sin(u.south);k=.5*Math.log((1+e)/(1-e));e=Math.sin(u.north);var ti=.5*Math.log((1+e)/(1-e)),ii=1/(ti-k),rt=new st({context:t,width:a,height:v,pixelFormat:i.pixelFormat,pixelDatatype:i.pixelDatatype,preMultiplyAlpha:i.preMultiplyAlpha});l.isPowerOfTwo(a)&&l.isPowerOfTwo(v)&&rt.generateMipmap(ut.NICEST);var ri=u.south,ui=u.north,d=si,pt=0;for(y=0;y<64;++y)wt=y/63,bt=l.lerp(ri,ui,wt),e=Math.sin(bt),kt=.5*Math.log((1+e)/(1-e)),g=(kt-k)*ii,d[pt++]=g,d[pt++]=g;f.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(d);n.shaderProgram=f.shaderProgram;n.outputTexture=rt;n.uniformMap=ni;n.vertexArray=f.vertexArray}function ci(n,t,i){var u=n._imageryProvider,r=u.tilingScheme,f=r.ellipsoid,e=(n._imageryProvider.tilingScheme.projection instanceof s)?1:Math.cos(i),o=r.rectangle,h=f.maximumRadius*o.width*e/(u.tileWidth*r.getNumberOfXTilesAtLevel(0)),c=h/t,l=Math.log(c)/Math.log(2),a=Math.round(l);return a|0}var ni,si;u(gt.prototype,{imageryProvider:{get:function(){return this._imageryProvider}},rectangle:{get:function(){return this._rectangle}}});gt.DEFAULT_BRIGHTNESS=1;gt.DEFAULT_CONTRAST=1;gt.DEFAULT_HUE=0;gt.DEFAULT_SATURATION=1;gt.DEFAULT_GAMMA=1;gt.DEFAULT_SPLIT=bt.NONE;gt.DEFAULT_MINIFICATION_FILTER=ct.LINEAR;gt.DEFAULT_MAGNIFICATION_FILTER=ht.LINEAR;gt.prototype.isBaseLayer=function(){return this._isBaseLayer};gt.prototype.isDestroyed=function(){return!1};gt.prototype.destroy=function(){return f(this)};var ii=new v,ri=new v,ti=new v,ui=new v;return gt.prototype.getViewableRectangle=function(){var n=this._imageryProvider,t=this._rectangle;return n.readyPromise.then(function(){return v.intersection(n.rectangle,t)})},gt.prototype._createTileImagerySkeletons=function(n,i,u){var et=n.data,p,h,y,ut,ot,st,ht,at,nt,w,vt,yt,g,tt,pt,wt;if(r(this._minimumTerrainLevel)&&n.level<this._minimumTerrainLevel||r(this._maximumTerrainLevel)&&n.level>this._maximumTerrainLevel)return!1;if(p=this._imageryProvider,r(u)||(u=et.imagery.length),!p.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),et.imagery.splice(u,0,this._skeletonPlaceholder),!0;var ct=p.tilingScheme.projection instanceof d&&n.rectangle.north<d.MaximumLatitude&&n.rectangle.south>-d.MaximumLatitude,b=v.intersection(p.rectangle,this._rectangle,ii),f=v.intersection(n.rectangle,b,ri);if(!r(f)){if(!this.isBaseLayer())return!1;h=b;y=n.rectangle;f=ri;y.south>=h.north?f.north=f.south=h.north:y.north<=h.south?f.north=f.south=h.south:(f.south=Math.max(y.south,h.south),f.north=Math.min(y.north,h.north));y.west>=h.east?f.west=f.east=h.east:y.east<=h.west?f.west=f.east=h.west:(f.west=Math.max(y.west,h.west),f.east=Math.min(y.east,h.east))}ut=0;f.south>0?ut=f.south:f.north<0&&(ut=f.north);var bt=1*i.getLevelMaximumGeometricError(n.level),o=ci(this,bt,ut);o=Math.max(0,o);ot=p.maximumLevel;o>ot&&(o=ot);r(p.minimumLevel)&&(st=p.minimumLevel,o<st&&(o=st));var c=p.tilingScheme,l=c.positionToTileXY(v.northwest(f),o),a=c.positionToTileXY(v.southeast(f),o),it=n.rectangle.width/512,rt=n.rectangle.height/512,lt=c.tileXYToRectangle(l.x,l.y,o);Math.abs(lt.south-n.rectangle.north)<rt&&l.y<a.y&&++l.y;Math.abs(lt.east-n.rectangle.west)<it&&l.x<a.x&&++l.x;ht=c.tileXYToRectangle(a.x,a.y,o);Math.abs(ht.north-n.rectangle.south)<rt&&a.y>l.y&&--a.y;Math.abs(ht.west-n.rectangle.east)<it&&a.x>l.x&&--a.x;var e=v.clone(n.rectangle,ui),k=c.tileXYToRectangle(l.x,l.y,o),s=v.intersection(k,b,ti),ft;for(ct?(c.rectangleToNativeRectangle(e,e),c.rectangleToNativeRectangle(k,k),c.rectangleToNativeRectangle(s,s),c.rectangleToNativeRectangle(b,b),ft=c.tileXYToNativeRectangle.bind(c),it=e.width/512,rt=e.height/512):ft=c.tileXYToRectangle.bind(c),nt=0,w=1,!this.isBaseLayer()&&Math.abs(s.west-e.west)>=it&&(nt=Math.min(1,(s.west-e.west)/e.width)),!this.isBaseLayer()&&Math.abs(s.north-e.north)>=rt&&(w=Math.max(0,(s.north-e.south)/e.height)),yt=w,g=l.x;g<=a.x;g++)if(at=nt,k=ft(g,l.y,o),s=v.simpleIntersection(k,b,ti),r(s))for(nt=Math.min(1,(s.east-e.west)/e.width),g===a.x&&(this.isBaseLayer()||Math.abs(s.east-e.east)<it)&&(nt=1),w=yt,tt=l.y;tt<=a.y;tt++)(vt=w,k=ft(g,tt,o),s=v.simpleIntersection(k,b,ti),r(s))&&(w=Math.max(0,(s.south-e.south)/e.height),tt===a.y&&(this.isBaseLayer()||Math.abs(s.south-e.south)<rt)&&(w=0),pt=new t(at,w,nt,vt),wt=this.getImageryFromCache(g,tt,o),et.imagery.splice(u,0,new dt(wt,pt,ct)),++u);return!0},gt.prototype._calculateTextureTranslationAndScale=function(n,i){var r=i.readyImagery.rectangle,u=n.rectangle,f;i.useWebMercatorT&&(f=i.readyImagery.imageryLayer.imageryProvider.tilingScheme,r=f.rectangleToNativeRectangle(r,ii),u=f.rectangleToNativeRectangle(u,ui));var e=u.width,o=u.height,s=e/r.width,h=o/r.height;return new t(s*(u.west-r.west)/e,h*(u.south-r.south)/o,s,h)},gt.prototype._requestImagery=function(n,t){function o(t){if(!r(t))return f();n.image=t;n.state=kt.RECEIVED;n.request=undefined;k.handleSuccess(u._requestImageError)}function f(t){if(n.request.state===p.CANCELLED){n.state=kt.UNLOADED;n.request=undefined;return}n.state=kt.FAILED;n.request=undefined;var r="Failed to obtain image tile X: "+n.x+" Y: "+n.y+" Level: "+n.level+".";u._requestImageError=k.handleError(u._requestImageError,i,i.errorEvent,r,n.x,n.y,n.level,e,t)}function e(){var e=new y({throttle:!0,throttleByServer:!0,type:w.IMAGERY,priorityFunction:t}),u;if(n.request=e,n.state=kt.TRANSITIONING,u=i.requestImage(n.x,n.y,n.level,e),!r(u)){n.state=kt.UNLOADED;n.request=undefined;return}r(i.getTileCredits)&&(n.credits=i.getTileCredits(n.x,n.y,n.level));pt(u,o,f)}var i=this._imageryProvider,u=this;e()},gt.prototype._createTexture=function(n,t){var u=this._imageryProvider,i=t.image,f,o,s;if(r(u.tileDiscardPolicy)&&(f=u.tileDiscardPolicy,r(f))){if(!f.isReady()){t.state=kt.RECEIVED;return}if(f.shouldDiscardImage(i)){t.state=kt.INVALID;return}}if(this.minificationFilter!==ct.NEAREST&&this.minificationFilter!==ct.LINEAR)throw new e("ImageryLayer minification filter must be NEAREST or LINEAR");o=new ft({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter});s=r(i.internalFormat)?new st({context:n,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView},sampler:o}):new st({context:n,source:i,pixelFormat:u.hasAlphaChannel?a.RGBA:a.RGB,sampler:o});u.tilingScheme.projection instanceof d?t.textureWebMercator=s:t.texture=s;t.image=undefined;t.state=kt.TEXTURE_LOADED},gt.prototype._reprojectTexture=function(n,t,r){var u=t.textureWebMercator||t.texture,h=t.rectangle,f=n.context,e,o;r=i(r,!0);r&&!(this._imageryProvider.tilingScheme.projection instanceof s)&&h.width/u.width>1e-5?(e=this,t.addReference(),o=new it({persists:!0,owner:this,preExecute:function(n){hi(n,f,u,t.rectangle)},postExecute:function(n){t.texture=n;ei(e,f,t,n);t.releaseReference()}}),this._reprojectComputeCommands.push(o)):(r&&(t.texture=u),ei(this,f,t,u))},gt.prototype.queueReprojectionCommands=function(n){for(var t=this._reprojectComputeCommands,r=t.length,i=0;i<r;++i)n.commandList.push(t[i]);t.length=0},gt.prototype.cancelReprojections=function(){this._reprojectComputeCommands.length=0},gt.prototype.getImageryFromCache=function(n,t,i,u){var e=oi(n,t,i),f=this._imageryCache[e];return r(f)||(f=new wt(this,n,t,i,u),this._imageryCache[e]=f),f.addReference(),f},gt.prototype.removeImageryFromCache=function(n){var t=oi(n.x,n.y,n.level);delete this._imageryCache[t]},ni={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new n,texture:undefined},si=o.supportsTypedArrays()?new Float32Array(128):undefined,gt});t("Scene/GlobeSurfaceTileProvider",["../Core/BoundingSphere","../Core/BoxOutlineGeometry","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/combine","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Core/GeometryInstance","../Core/GeometryPipeline","../Core/IndexDatatype","../Core/Intersect","../Core/Math","../Core/Matrix4","../Core/OrientedBoundingBox","../Core/OrthographicFrustum","../Core/PrimitiveType","../Core/Rectangle","../Core/SphereOutlineGeometry","../Core/TerrainQuantization","../Core/Visibility","../Core/WebMercatorProjection","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Pass","../Renderer/RenderState","../Renderer/VertexArray","../Scene/BlendingState","../Scene/DepthFunction","../Scene/PerInstanceColorAppearance","../Scene/Primitive","./ClippingPlaneCollection","./GlobeSurfaceTile","./ImageryLayer","./QuadtreeTileLoadState","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri){"use strict";function ui(n){if(!c(n))throw new v("options is required.");if(c(n.terrainProvider))if(c(n.imageryLayers)){if(!c(n.surfaceShaderSet))throw new v("options.surfaceShaderSet is required.");}else throw new v("options.imageryLayers is required.");else throw new v("options.terrainProvider is required.");this.lightingFadeOutDistance=65e5;this.lightingFadeInDistance=9e6;this.hasWaterMask=!1;this.oceanNormalMap=undefined;this.zoomedOutOceanSpecularIntensity=.5;this.enableLighting=!1;this.showGroundAtmosphere=!1;this.shadows=ri.RECEIVE_ONLY;this._quadtree=undefined;this._terrainProvider=n.terrainProvider;this._imageryLayers=n.imageryLayers;this._surfaceShaderSet=n.surfaceShaderSet;this._renderState=undefined;this._blendRenderState=undefined;this._errorEvent=new y;this._imageryLayers.layerAdded.addEventListener(ui.prototype._onLayerAdded,this);this._imageryLayers.layerRemoved.addEventListener(ui.prototype._onLayerRemoved,this);this._imageryLayers.layerMoved.addEventListener(ui.prototype._onLayerMoved,this);this._imageryLayers.layerShownOrHidden.addEventListener(ui.prototype._onLayerShownOrHidden,this);this._tileLoadedEvent=new y;this._imageryLayersUpdatedEvent=new y;this._layerOrderChanged=!1;this._tilesToRenderByTextureCount=[];this._drawCommands=[];this._uniformMaps=[];this._usedDrawCommands=0;this._vertexArraysToDestroy=[];this._debug={wireframe:!1,boundingSphereTile:undefined};this._baseColor=undefined;this._firstPassInitialColor=undefined;this.baseColor=new e(0,0,.5,1);this._clippingPlanes=undefined;this.cartographicLimitRectangle=rt.clone(rt.MAX_VALUE)}function pi(n,t){var r=n.loadingImagery,i;return c(r)||(r=n.readyImagery),i=t.loadingImagery,c(i)||(i=t.readyImagery),r.imageryLayer._layerIndex-i.imageryLayer._layerIndex}function wi(n){var t=n.indexBuffer;n.destroy();!t.isDestroyed()&&c(t.referenceCount)&&(--t.referenceCount,t.referenceCount===0&&t.destroy())}function bi(n,t){var f=t.creditDisplay,u,i,e,r;for(n._terrainProvider.ready&&c(n._terrainProvider.credit)&&f.addCredit(n._terrainProvider.credit),u=n._imageryLayers,i=0,e=u.length;i<e;++i)r=u.get(i).imageryProvider,r.ready&&c(r.credit)&&f.addCredit(r.credit)}function oi(n,t){if(t.west<t.east)return t;var i=rt.clone(t,gi),r=rt.center(n,nr);return r.longitude>0?i.east=d.PI:i.west=-d.PI,i}function er(n,t,i){return function(r){for(var f,e,o=-1,s=r.data.imagery,a=s.length,l,u=0;u<a;++u)if(f=s[u],e=h(f.readyImagery,f.loadingImagery),e.imageryLayer===t){o=u;break}if(o!==-1){if(l=o+n,f=s[l],e=c(f)?h(f.readyImagery,f.loadingImagery):undefined,!c(e)||e.imageryLayer!==t)return!t._createTileImagerySkeletons(r,i,l);for(u=o;u<l;++u)s[u].freeResources();s.splice(o,n)}return!0}}function or(n,t){return{u_initialColor:function(){return this.properties.initialColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){var t=n.context.uniformState.view,i=g.multiplyByPoint(t,this.properties.rtc,hi);return g.setTranslation(t,i,si),si},u_modifiedModelViewProjection:function(){var t=n.context.uniformState.view,i=n.context.uniformState.projection,r=g.multiplyByPoint(t,this.properties.rtc,hi);return g.setTranslation(t,r,fi),g.multiply(i,fi,fi),fi},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_clippingPlanes:function(){var i=t._clippingPlanes;return c(i)&&c(i.texture)?i.texture:n.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){var i=t._clippingPlanes;return c(i)?g.multiply(n.context.uniformState.view,i.modelMatrix,ci):g.IDENTITY},u_clippingPlanesEdgeStyle:function(){var n=this.properties.clippingPlanesEdgeColor;return n.alpha=this.properties.clippingPlanesEdgeWidth,n},u_minimumBrightness:function(){return n.fog.minimumBrightness},properties:{initialColor:new u(0,0,.5,1),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:undefined,lightingFadeDistance:new i(65e5,9e6),nightFadeDistance:new i(1e7,4e7),center3D:undefined,rtc:new r,modifiedModelView:new g,tileRectangle:new u,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayIntensity:0,southAndNorthLatitude:new i,southMercatorYAndOneOverHeight:new i,waterMask:undefined,waterMaskTranslationAndScale:new u,minMaxHeight:new i,scaleAndBias:new g,clippingPlanesEdgeColor:e.clone(e.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new u}}}function sr(n,t,i){var r=i.data;c(r.wireframeVertexArray)||c(r.terrainData)&&c(r.terrainData._mesh)&&(r.wireframeVertexArray=hr(n,r.vertexArray,r.terrainData._mesh))}function hr(n,t,i){var r={indices:i.indices,primitiveType:it.TRIANGLES},u,f;return w.toWireframe(r),u=r.indices,f=st.createIndexBuffer({context:n,typedArray:u,usage:ht.STATIC_DRAW,indexDatatype:b.UNSIGNED_SHORT}),new yt({context:n,attributes:t._attributes,indexBuffer:f})}function cr(t,i,f){var y=i.data,yr=f.creditDisplay,gt=y.terrainData,ti,yt,pr,pt,si,nu,hi,h,l,a,et,o,k,ut,lr,tt,ar,dt,yu,ht,vr,w,pu;if(c(gt)&&c(gt.credits))for(ti=gt.credits,yt=0,pr=ti.length;yt<pr;++yt)yr.addCredit(ti[yt]);var ui=ct.maximumTextureImageUnits,wr=y.waterMaskTexture,fi=t.hasWaterMask&&c(wr),br=t.oceanNormalMap,kr=fi&&c(br),wu=t.terrainProvider.ready&&t.terrainProvider.hasVertexNormals,bu=f.fog.enabled,dr=t.showGroundAtmosphere,ku=ri.castShadows(t.shadows),du=ri.receiveShadows(t.shadows),gr=!1;dr&&(pt=f.mode,si=f.camera,nu=pt===ii.SCENE2D||pt===ii.COLUMBUS_VIEW?si.positionCartographic.height:r.magnitude(si.positionWC),hi=t.nightFadeOutDistance,pt!==ii.SCENE3D&&(hi-=f.mapProjection.ellipsoid.maximumRadius),gr=nu>hi);fi&&--ui;kr&&--ui;var b=y.center,wt=y.pickTerrain.mesh.encoding,p=tr,ci=0,pi=0,wi=0,tu=0,iu=!1;if(f.mode!==ii.SCENE3D){var bi=f.mapProjection,ru=bi.project(rt.southwest(i.rectangle),ur),uu=bi.project(rt.northeast(i.rectangle),fr);if(p.x=ru.x,p.y=ru.y,p.z=uu.x,p.w=uu.y,f.mode!==ii.MORPHING&&(b=rr,b.x=0,b.y=(p.z+p.x)*.5,b.z=(p.w+p.y)*.5,p.x-=b.y,p.y-=b.z,p.z-=b.y,p.w-=b.z),f.mode===ii.SCENE2D&&wt.quantization===ft.BITS12){var fu=1/(Math.pow(2,12)-1)*.5,eu=(p.z-p.x)*fu,ou=(p.w-p.y)*fu;p.x-=eu;p.y-=ou;p.z+=eu;p.w+=ou}bi instanceof ot&&(ci=i.rectangle.south,pi=i.rectangle.north,wi=ot.geodeticLatitudeToMercatorAngle(ci),tu=1/(ot.geodeticLatitudeToMercatorAngle(pi)-wi),iu=!0)}h=yi;h.frameState=f;h.surfaceTile=y;h.showReflectiveOcean=fi;h.showOceanWaves=kr;h.enableLighting=t.enableLighting;h.showGroundAtmosphere=dr;h.perFragmentGroundAtmosphere=gr;h.hasVertexNormals=wu;h.useWebMercatorProjection=iu;h.clippedByBoundaries=y.clippedByBoundaries;var su=y.imagery,bt=0,hu=su.length,gu=t._renderState,nf=t._blendRenderState,cu=gu,lu=t._firstPassInitialColor,tf=f.context;c(t._debug.boundingSphereTile)||ei();do{l=0;t._drawCommands.length<=t._usedDrawCommands?(a=new lt,a.owner=i,a.cull=!1,a.boundingVolume=new n,a.orientedBoundingBox=undefined,et=or(f,t),t._drawCommands.push(a),t._uniformMaps.push(et)):(a=t._drawCommands[t._usedDrawCommands],et=t._uniformMaps[t._usedDrawCommands]);a.owner=i;++t._usedDrawCommands;i===t._debug.boundingSphereTile&&(c(y.orientedBoundingBox)?li(y.orientedBoundingBox,e.RED).update(f):c(y.boundingSphere3D)&&ai(y.boundingSphere3D,e.RED).update(f));o=et.properties;u.clone(lu,o.initialColor);o.oceanNormalMap=br;o.lightingFadeDistance.x=t.lightingFadeOutDistance;o.lightingFadeDistance.y=t.lightingFadeInDistance;o.nightFadeDistance.x=t.nightFadeOutDistance;o.nightFadeDistance.y=t.nightFadeInDistance;o.zoomedOutOceanSpecularIntensity=t.zoomedOutOceanSpecularIntensity;o.center3D=y.center;r.clone(b,o.rtc);u.clone(p,o.tileRectangle);o.southAndNorthLatitude.x=ci;o.southAndNorthLatitude.y=pi;o.southMercatorYAndOneOverHeight.x=wi;o.southMercatorYAndOneOverHeight.y=tu;var vt=ir,kt=oi(i.rectangle,t.cartographicLimitRectangle),st=i.rectangle,au=1/st.width,vu=1/st.height;vt.x=(kt.west-st.west)*au;vt.y=(kt.south-st.south)*vu;vt.z=(kt.east-st.west)*au;vt.w=(kt.north-st.south)*vu;u.clone(vt,o.localizedCartographicLimitRectangle);for(var rf=bu&&d.fog(i._distance,f.fog.density)>d.EPSILON3,ki=!1,di=!1,gi=!1,nr=!1,er=!1,hr=!1,cr=!1;l<ui&&bt<hu;)if(k=su[bt],ut=k.readyImagery,++bt,c(ut)&&ut.imageryLayer.alpha!==0){if(lr=k.useWebMercatorT?ut.textureWebMercator:ut.texture,!c(lr))throw new v("readyImagery is not actually ready!");if(tt=ut.imageryLayer,c(k.textureTranslationAndScale)||(k.textureTranslationAndScale=tt._calculateTextureTranslationAndScale(i,k)),o.dayTextures[l]=lr,o.dayTextureTranslationAndScale[l]=k.textureTranslationAndScale,o.dayTextureTexCoordsRectangle[l]=k.textureCoordinateRectangle,o.dayTextureUseWebMercatorT[l]=k.useWebMercatorT,o.dayTextureAlpha[l]=tt.alpha,hr=hr||o.dayTextureAlpha[l]!==1,o.dayTextureBrightness[l]=tt.brightness,ki=ki||o.dayTextureBrightness[l]!==ni.DEFAULT_BRIGHTNESS,o.dayTextureContrast[l]=tt.contrast,di=di||o.dayTextureContrast[l]!==ni.DEFAULT_CONTRAST,o.dayTextureHue[l]=tt.hue,gi=gi||o.dayTextureHue[l]!==ni.DEFAULT_HUE,o.dayTextureSaturation[l]=tt.saturation,nr=nr||o.dayTextureSaturation[l]!==ni.DEFAULT_SATURATION,o.dayTextureOneOverGamma[l]=1/tt.gamma,er=er||o.dayTextureOneOverGamma[l]!==1/ni.DEFAULT_GAMMA,o.dayTextureSplit[l]=tt.splitDirection,cr=cr||o.dayTextureSplit[l]!==0,c(ut.credits))for(ar=ut.credits,dt=0,yu=ar.length;dt<yu;++dt)yr.addCredit(ar[dt]);++l}o.dayTextures.length=l;o.waterMask=wr;u.clone(y.waterMaskTranslationAndScale,o.waterMaskTranslationAndScale);o.minMaxHeight.x=wt.minimumHeight;o.minMaxHeight.y=wt.maximumHeight;g.clone(wt.matrix,o.scaleAndBias);ht=t._clippingPlanes;vr=c(ht)&&ht.enabled&&i.isClipped;vr&&(o.clippingPlanesEdgeColor=e.clone(ht.edgeColor,o.clippingPlanesEdgeColor),o.clippingPlanesEdgeWidth=ht.edgeWidth);c(t.uniformMap)&&(et=s(et,t.uniformMap));h.numberOfDayTextures=l;h.applyBrightness=ki;h.applyContrast=di;h.applyHue=gi;h.applySaturation=nr;h.applyGamma=er;h.applyAlpha=hr;h.applySplit=cr;h.enableFog=rf;h.enableClippingPlanes=vr;h.clippingPlanes=ht;a.shaderProgram=t._surfaceShaderSet.getShaderProgram(h);a.castShadows=ku;a.receiveShadows=du;a.renderState=cu;a.primitiveType=it.TRIANGLES;a.vertexArray=y.vertexArray;a.uniformMap=et;a.pass=at.GLOBE;t._debug.wireframe&&(sr(tf,t,i),c(y.wireframeVertexArray)&&(a.vertexArray=y.wireframeVertexArray,a.primitiveType=it.LINES));w=a.boundingVolume;pu=a.orientedBoundingBox;f.mode!==ii.SCENE3D?(n.fromRectangleWithHeights2D(i.rectangle,f.mapProjection,y.minimumHeight,y.maximumHeight,w),r.fromElements(w.center.z,w.center.x,w.center.y,w.center),f.mode===ii.MORPHING&&(w=n.union(y.boundingSphere3D,w,w))):(a.boundingVolume=n.clone(y.boundingSphere3D,w),a.orientedBoundingBox=nt.clone(y.orientedBoundingBox,pu));f.commandList.push(a);cu=nf;lu=vi}while(bt<hu)}var ci,li,ai,ei,vi,yi;l(ui.prototype,{baseColor:{get:function(){return this._baseColor},set:function(n){if(!c(n))throw new v("value is required.");this._baseColor=n;this._firstPassInitialColor=u.fromColor(n,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(n){if(!c(n))throw new v("value is required.");this._quadtree=n}},ready:{get:function(){return this._terrainProvider.ready&&(this._imageryLayers.length===0||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},tileLoadedEvent:{get:function(){return this._tileLoadedEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(n){if(this._terrainProvider!==n){if(!c(n))throw new v("terrainProvider is required.");this._terrainProvider=n;c(this._quadtree)&&this._quadtree.invalidateAllTiles()}}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(n){dt.setOwner(n,this,"_clippingPlanes")}}});ui.prototype.update=function(){this._imageryLayers._update()};ui.prototype.initialize=function(n){var t,r,i;for(this._imageryLayers.queueReprojectionCommands(n),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile(function(n){n.data.imagery.sort(pi)})),bi(this,n),t=this._vertexArraysToDestroy,r=t.length,i=0;i<r;++i)wi(t[i]);t.length=0};ui.prototype.beginUpdate=function(n){for(var r,t,u=this._tilesToRenderByTextureCount,i=0,f=u.length;i<f;++i)r=u[i],c(r)&&(r.length=0);t=this._clippingPlanes;c(t)&&t.enabled&&t.update(n);this._usedDrawCommands=0};ui.prototype.endUpdate=function(n){var u,t,f,i,r,e;for(c(this._renderState)||(this._renderState=vt.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:wt.LESS}}),this._blendRenderState=vt.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:wt.LESS_OR_EQUAL},blending:pt.ALPHA_BLEND})),u=this._tilesToRenderByTextureCount,t=0,f=u.length;t<f;++t)if(i=u[t],c(i))for(r=0,e=i.length;r<e;++r)cr(this,i[r],n)};ui.prototype.updateForPick=function(n){for(var i=this._drawCommands,t=0,r=this._usedDrawCommands;t<r;++t)n.commandList.push(i[t])};ui.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()};ui.prototype.getLevelMaximumGeometricError=function(n){return this._terrainProvider.getLevelMaximumGeometricError(n)};ui.prototype.loadTile=function(n,t){gt.processStateMachine(t,n,this._terrainProvider,this._imageryLayers,this._vertexArraysToDestroy);var i=this._tileLoadedEvent;t._loadedCallbacks.tileLoadedEvent=function(){return i.raiseEvent(),!0}};var ki=new n,di=new rt,gi=new rt,nr=new f;ui.prototype.computeTileVisibility=function(t,i,u){var y=this.computeDistanceToTile(t,i),p,l,s,a,o,w,v;if(t._distance=y,i.fog.enabled&&d.fog(y,i.fog.density)>=1)return et.NONE;var e=t.data,b=i.cullingVolume,f=h(e.orientedBoundingBox,e.boundingSphere3D);return(e.clippedByBoundaries=!1,p=oi(t.rectangle,this.cartographicLimitRectangle),l=rt.simpleIntersection(p,t.rectangle,di),!c(l))?et.NONE:(rt.equals(l,t.rectangle)||(e.clippedByBoundaries=!0),i.mode!==ii.SCENE3D&&(f=ki,n.fromRectangleWithHeights2D(t.rectangle,i.mapProjection,e.minimumHeight,e.maximumHeight,f),r.fromElements(f.center.z,f.center.x,f.center.y,f.center),i.mode===ii.MORPHING&&(f=n.union(e.boundingSphere3D,f,f))),s=this._clippingPlanes,c(s)&&s.enabled&&(a=s.computeIntersectionWithBoundingVolume(f),t.isClipped=a!==k.INSIDE,a===k.OUTSIDE))?et.NONE:(o=b.computeVisibility(f),o===k.OUTSIDE)?et.NONE:(w=i.mode===ii.SCENE3D&&i.camera.frustum instanceof tt,i.mode===ii.SCENE3D&&!w&&c(u))?(v=e.occludeePointInScaledSpace,!c(v))?o:u.ellipsoid.isScaledSpacePointVisible(v)?o:et.NONE:o};var si=new g,fi=new g,tr=new u,ir=new u,rr=new r,hi=new r,ur=new r,fr=new r;return ui.prototype.showTileThisFrame=function(n){for(var u,t,f,i=0,e=n.data.imagery,r=0,o=e.length;r<o;++r)u=e[r],c(u.readyImagery)&&u.readyImagery.imageryLayer.alpha!==0&&++i;t=this._tilesToRenderByTextureCount[i];c(t)||(t=[],this._tilesToRenderByTextureCount[i]=t);t.push(n);f=this._debug;++f.tilesRendered;f.texturesRendered+=i},ui.prototype.computeDistanceToTile=function(n,t){var i=n.data,r=i.tileBoundingRegion;return r.distanceToCamera(t)},ui.prototype.isDestroyed=function(){return!1},ui.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),a(this)},ui.prototype._onLayerAdded=function(n){if(n.show){var t=this._terrainProvider,i=this,r=n.imageryProvider,u=this._imageryLayersUpdatedEvent;r._reload=function(){n._imageryCache={};i._quadtree.forEachLoadedTile(function(i){var e,s,l;if(!c(i._loadedCallbacks[n._layerIndex])){for(var o=i.data.imagery,a=o.length,u=-1,f=0,r=0;r<a;++r)if(e=o[r],s=h(e.readyImagery,e.loadingImagery),s.imageryLayer===n)u===-1&&(u=r),++f;else if(u!==-1)break;u!==-1&&(l=u+f,n._createTileImagerySkeletons(i,t,l)&&(i._loadedCallbacks[n._layerIndex]=er(f,n,t),i.state=ti.LOADING))}})};this._quadtree.forEachLoadedTile(function(i){n._createTileImagerySkeletons(i,t)&&(i.state=ti.LOADING)});this._layerOrderChanged=!0;u.raiseEvent()}},ui.prototype._onLayerRemoved=function(n){this._quadtree.forEachLoadedTile(function(t){for(var u,f,e=t.data.imagery,i=-1,o=0,r=0,s=e.length;r<s;++r)if(u=e[r],f=u.loadingImagery,c(f)||(f=u.readyImagery),f.imageryLayer===n)i===-1&&(i=r),u.freeResources(),++o;else if(i!==-1)break;i!==-1&&e.splice(i,o)});c(n.imageryProvider)&&(n.imageryProvider._reload=undefined);this._imageryLayersUpdatedEvent.raiseEvent()},ui.prototype._onLayerMoved=function(){this._layerOrderChanged=!0;this._imageryLayersUpdatedEvent.raiseEvent()},ui.prototype._onLayerShownOrHidden=function(n,t,i){i?this._onLayerAdded(n,t):this._onLayerRemoved(n,t)},ci=new g,function(){function s(n){return new kt({geometryInstances:n,appearance:new bt({translucent:!1,flat:!0}),asynchronous:!1})}var f=new p({geometry:t.fromDimensions({dimensions:new r(2,2,2)})}),e=new p({geometry:new ut({radius:1})}),n=new g,u,i;li=function(t,r){return t===u?i:(ei(),u=t,n=g.fromRotationTranslation(t.halfAxes,t.center,n),f.modelMatrix=n,f.attributes.color=o.fromColor(r),i=s(f))};ai=function(t,r){return t===u?i:(ei(),u=t,n=g.fromTranslation(t.center,n),n=g.multiplyByUniformScale(n,t.radius,n),e.modelMatrix=n,e.attributes.color=o.fromColor(r),i=s(e))};ei=function(){c(i)&&(i.destroy(),i=undefined,u=undefined)}}(),vi=new u(0,0,0,0),yi={frameState:undefined,surfaceTile:undefined,numberOfDayTextures:undefined,applyBrightness:undefined,applyContrast:undefined,applyHue:undefined,applySaturation:undefined,applyGamma:undefined,applyAlpha:undefined,applySplit:undefined,showReflectiveOcean:undefined,showOceanWaves:undefined,enableLighting:undefined,showGroundAtmosphere:undefined,perFragmentGroundAtmosphere:undefined,hasVertexNormals:undefined,useWebMercatorProjection:undefined,enableFog:undefined,enableClippingPlanes:undefined,clippingPlanes:undefined,clippedByBoundaries:undefined},ui});t("Scene/ImageryLayerCollection",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Event","../Core/Math","../Core/Rectangle","../ThirdParty/when","./ImageryLayer"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(){this._layers=[];this.layerAdded=new f;this.layerRemoved=new f;this.layerMoved=new f;this.layerShownOrHidden=new f}function l(n,i){if(!t(i))throw new u("layer is required.");var r=n.indexOf(i);if(r===-1)throw new u("layer is not in this collection.");return r}function a(n,t,i){var r=n._layers,u;(t=e.clamp(t,0,r.length-1),i=e.clamp(i,0,r.length-1),t!==i)&&(u=r[t],r[t]=r[i],r[i]=u,n._update(),n.layerMoved.raiseEvent(u,i,t))}i(c.prototype,{length:{get:function(){return this._layers.length}}});c.prototype.add=function(n,i){var r=t(i);if(!t(n))throw new u("layer is required.");if(r)if(i<0)throw new u("index must be greater than or equal to zero.");else if(i>this._layers.length)throw new u("index must be less than or equal to the number of layers.");r?this._layers.splice(i,0,n):(i=this._layers.length,this._layers.push(n));this._update();this.layerAdded.raiseEvent(n,i)};c.prototype.addImageryProvider=function(n,i){if(!t(n))throw new u("imageryProvider is required.");var r=new h(n);return this.add(r,i),r};c.prototype.remove=function(t,i){i=n(i,!0);var r=this._layers.indexOf(t);return r!==-1?(this._layers.splice(r,1),this._update(),this.layerRemoved.raiseEvent(t,r),i&&t.destroy(),!0):!1};c.prototype.removeAll=function(t){var r,i,f,u;for(t=n(t,!0),r=this._layers,i=0,f=r.length;i<f;i++)u=r[i],this.layerRemoved.raiseEvent(u,i),t&&u.destroy();this._layers=[]};c.prototype.contains=function(n){return this.indexOf(n)!==-1};c.prototype.indexOf=function(n){return this._layers.indexOf(n)};c.prototype.get=function(n){if(!t(n))throw new u("index is required.","index");return this._layers[n]};c.prototype.raise=function(n){var t=l(this._layers,n);a(this,t,t+1)};c.prototype.lower=function(n){var t=l(this._layers,n);a(this,t,t-1)};c.prototype.raiseToTop=function(n){var t=l(this._layers,n);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(n),this._update(),this.layerMoved.raiseEvent(n,this._layers.length-1,t))};c.prototype.lowerToBottom=function(n){var t=l(this._layers,n);t!==0&&(this._layers.splice(t,1),this._layers.splice(0,0,n),this._update(),this.layerMoved.raiseEvent(n,0,t))};var v=new o;return c.prototype.pickImageryLayerFeatures=function(n,i){var g=i.globe.pick(n,i),f,p,r,a,w,y,h,u,k,c,l,d;if(!t(g))return undefined;for(f=i.globe.ellipsoid.cartesianToCartographic(g),p=i.globe._surface._tilesToRender,a=0;!t(r)&&a<p.length;++a)w=p[a],o.contains(w.rectangle,f)&&(r=w);if(!t(r))return undefined;var nt=r.data.imagery,b=[],tt=[];for(y=nt.length-1;y>=0;--y)(h=nt[y],u=h.readyImagery,t(u))&&(k=u.imageryLayer.imageryProvider,t(k.pickFeatures))&&o.contains(u.rectangle,f)&&(c=v,l=1/1024,c.west=e.lerp(r.rectangle.west,r.rectangle.east,h.textureCoordinateRectangle.x-l),c.east=e.lerp(r.rectangle.west,r.rectangle.east,h.textureCoordinateRectangle.z+l),c.south=e.lerp(r.rectangle.south,r.rectangle.north,h.textureCoordinateRectangle.y-l),c.north=e.lerp(r.rectangle.south,r.rectangle.north,h.textureCoordinateRectangle.w+l),o.contains(c,f))&&(d=k.pickFeatures(u.x,u.y,u.level,f.longitude,f.latitude),t(d))&&(b.push(d),tt.push(u.imageryLayer));return b.length===0?undefined:s.all(b,function(n){for(var i,s,e,r,o=[],u=0;u<n.length;++u)if(i=n[u],s=tt[u],t(i)&&i.length>0)for(e=0;e<i.length;++e)r=i[e],r.imageryLayer=s,t(r.position)||(r.position=f),o.push(r);return o})},c.prototype.queueReprojectionCommands=function(n){for(var i=this._layers,t=0,r=i.length;t<r;++t)i[t].queueReprojectionCommands(n)},c.prototype.cancelReprojections=function(){for(var t=this._layers,n=0,i=t.length;n<i;++n)t[n].cancelReprojections()},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this.removeAll(!0),r(this)},c.prototype._update=function(){for(var f=!0,e=this._layers,r,n,i=0,u=e.length;i<u;++i)n=e[i],n._layerIndex=i,n.show?(n._isBaseLayer=f,f=!1):n._isBaseLayer=!1,n.show!==n._show&&(t(n._show)&&(t(r)||(r=[]),r.push(n)),n._show=n.show);if(t(r))for(i=0,u=r.length;i<u;++i)n=r[i],this.layerShownOrHidden.raiseEvent(n,n._layerIndex,n.show)},c});t("Scene/QuadtreeOccluders",["../Core/Cartesian3","../Core/defineProperties","../Core/EllipsoidalOccluder"],function(n,t,i){"use strict";function r(t){this._ellipsoid=new i(t.ellipsoid,n.ZERO)}return t(r.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),r});t("Scene/QuadtreeTile",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Rectangle","./QuadtreeTileLoadState"],function(n,t,i,r,u){"use strict";function f(t){if(!n(t))throw new i("options is required.");if(n(t.x))if(n(t.y)){if(t.x<0||t.y<0)throw new i("options.x and options.y must be greater than or equal to zero.");}else throw new i("options.y is required.");else throw new i("options.x is required.");if(!n(t.level))throw new i("options.level is required and must be greater than or equal to zero.");if(!n(t.tilingScheme))throw new i("options.tilingScheme is required.");this._tilingScheme=t.tilingScheme;this._x=t.x;this._y=t.y;this._level=t.level;this._parent=t.parent;this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level);this._southwestChild=undefined;this._southeastChild=undefined;this._northwestChild=undefined;this._northeastChild=undefined;this._replacementPrevious=undefined;this._replacementNext=undefined;this._distance=0;this._priorityFunction=undefined;this._customData=[];this._frameUpdated=undefined;this._frameRendered=undefined;this._loadedCallbacks={};this.state=u.START;this.renderable=!1;this.upsampledFromParent=!1;this.data=undefined}function e(t){n(t)&&t.freeResources()}return f.createLevelZeroTiles=function(t){var r,u;if(!n(t))throw new i("tilingScheme is required.");var e=t.getNumberOfXTilesAtLevel(0),o=t.getNumberOfYTilesAtLevel(0),s=new Array(e*o),h=0;for(r=0;r<o;++r)for(u=0;u<e;++u)s[h++]=new f({tilingScheme:t,x:u,y:r,level:0});return s},f.prototype._updateCustomData=function(t,i,u){var e=this.customData,f,o,h,s,c;if(n(i)&&n(u)){for(e=e.filter(function(n){return u.indexOf(n)===-1}),this._customData=e,h=this._rectangle,f=0;f<i.length;++f)o=i[f],r.contains(h,o.positionCartographic)&&e.push(o);this._frameUpdated=t}else if(s=this._parent,n(s)&&this._frameUpdated!==s._frameUpdated){for(e.length=0,h=this._rectangle,c=s.customData,f=0;f<c.length;++f)o=c[f],r.contains(h,o.positionCartographic)&&e.push(o);this._frameUpdated=s._frameUpdated}},t(f.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return n(this._southwestChild)||(this._southwestChild=new f({tilingScheme:this.tilingScheme,x:this.x*2,y:this.y*2+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return n(this._southeastChild)||(this._southeastChild=new f({tilingScheme:this.tilingScheme,x:this.x*2+1,y:this.y*2+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return n(this._northwestChild)||(this._northwestChild=new f({tilingScheme:this.tilingScheme,x:this.x*2,y:this.y*2,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return n(this._northeastChild)||(this._northeastChild=new f({tilingScheme:this.tilingScheme,x:this.x*2+1,y:this.y*2,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<u.DONE}},eligibleForUnloading:{get:function(){var t=!0;return n(this.data)&&(t=this.data.eligibleForUnloading,n(t)||(t=!0)),t}}}),f.prototype.freeResources=function(){this.state=u.START;this.renderable=!1;this.upsampledFromParent=!1;n(this.data)&&n(this.data.freeResources)&&this.data.freeResources();e(this._southwestChild);this._southwestChild=undefined;e(this._southeastChild);this._southeastChild=undefined;e(this._northwestChild);this._northwestChild=undefined;e(this._northeastChild);this._northeastChild=undefined},f});t("Scene/TileReplacementQueue",["../Core/defined"],function(n){"use strict";function t(){this.head=undefined;this.tail=undefined;this.count=0;this._lastBeforeStartOfFrame=undefined}function i(n,t){var r=t.replacementPrevious,i=t.replacementNext;t===n._lastBeforeStartOfFrame&&(n._lastBeforeStartOfFrame=i);t===n.head?n.head=i:r.replacementNext=i;t===n.tail?n.tail=r:i.replacementPrevious=r;t.replacementPrevious=undefined;t.replacementNext=undefined;--n.count}return t.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head},t.prototype.trimTiles=function(t){for(var r=this.tail,u=!0,f;u&&n(this._lastBeforeStartOfFrame)&&this.count>t&&n(r);)u=r!==this._lastBeforeStartOfFrame,f=r.replacementPrevious,r.eligibleForUnloading&&(r.freeResources(),i(this,r)),r=f},t.prototype.markTileRendered=function(t){var r=this.head;if(r===t){t===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=t.replacementNext);return}if(++this.count,!n(r)){t.replacementPrevious=undefined;t.replacementNext=undefined;this.head=t;this.tail=t;return}(n(t.replacementPrevious)||n(t.replacementNext))&&i(this,t);t.replacementPrevious=undefined;t.replacementNext=r;r.replacementPrevious=t;this.head=t},t});t("Scene/QuadtreePrimitive",["../Core/Cartesian3","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/getTimestamp","../Core/Math","../Core/OrthographicFrustum","../Core/Ray","../Core/Rectangle","../Core/Visibility","./QuadtreeOccluders","./QuadtreeTile","./QuadtreeTileLoadState","./SceneMode","./TileReplacementQueue"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function g(n){if(!r(n)||!r(n.tileProvider))throw new f("options.tileProvider is required.");if(r(n.tileProvider.quadtree))throw new f("A QuadtreeTileProvider can only be used with a single QuadtreePrimitive");this._tileProvider=n.tileProvider;this._tileProvider.quadtree=this;this._debug={enableDebugOutput:!1,maxDepth:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var t=this._tileProvider.tilingScheme,u=t.ellipsoid;this._tilesToRender=[];this._tileLoadQueueHigh=[];this._tileLoadQueueMedium=[];this._tileLoadQueueLow=[];this._tileReplacementQueue=new b;this._levelZeroTiles=undefined;this._loadQueueTimeSlice=5;this._tilesInvalidated=!1;this._addHeightCallbacks=[];this._removeHeightCallbacks=[];this._tileToUpdateHeights=[];this._lastTileIndex=0;this._updateHeightsTimeSlice=2;this.maximumScreenSpaceError=i(n.maximumScreenSpaceError,2);this.tileCacheSize=i(n.tileCacheSize,100);this._occluders=new v({ellipsoid:u});this._tileLoadProgressEvent=new e;this._lastTileLoadQueueLength=0}function ct(n){var f=n._tileReplacementQueue,t,i,u,e;if(f.head=undefined,f.tail=undefined,f.count=0,ot(n),t=n._levelZeroTiles,r(t))for(i=0;i<t.length;++i){var s=t[i],o=s.customData,h=o.length;for(u=0;u<h;++u)e=o[u],e.level=0,n._addHeightCallbacks.push(e);t[i].freeResources()}n._levelZeroTiles=undefined;n._tileProvider.cancelReprojections()}function ot(n){var t=n._debug;t.maxDepth=0;t.tilesVisited=0;t.tilesCulled=0;t.tilesRendered=0;t.tilesWaitingForChildren=0;n._tileLoadQueueHigh.length=0;n._tileLoadQueueMedium.length=0;n._tileLoadQueueLow.length=0}function lt(n,t){var r=n._tileLoadQueueHigh.length+n._tileLoadQueueMedium.length+n._tileLoadQueueLow.length,i;(r!==n._lastTileLoadQueueLength||n._tilesInvalidated)&&(t.afterRender.push(e.prototype.raiseEvent.bind(n._tileLoadProgressEvent,r)),n._lastTileLoadQueueLength=r);i=n._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.tilesVisited!==i.lastTilesVisited||i.tilesRendered!==i.lastTilesRendered||i.tilesCulled!==i.lastTilesCulled||i.maxDepth!==i.lastMaxDepth||i.tilesWaitingForChildren!==i.lastTilesWaitingForChildren)&&(console.log("Visited "+i.tilesVisited+", Rendered: "+i.tilesRendered+", Culled: "+i.tilesCulled+", Max Depth: "+i.maxDepth+", Waiting for children: "+i.tilesWaitingForChildren),i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren)}function at(n,t){var i=l.center(n.rectangle,rt),f=i.longitude-it.longitude,e=i.latitude-it.latitude,r,u;return i=l.center(t.rectangle,rt),r=i.longitude-it.longitude,u=i.latitude-it.latitude,f*f+e*e-(r*r+u*u)}function vt(n,t){var s=n._debug,l,e,v,i,f,p;if(!s.suspendLodUpdate){if(l=n._tilesToRender,l.length=0,e=n._tileProvider,!r(n._levelZeroTiles))if(e.ready)v=e.tilingScheme,n._levelZeroTiles=y.createLevelZeroTiles(v);else return;n._occluders.ellipsoid.cameraPosition=t.camera.positionWC;f=n._levelZeroTiles;p=f.length>1?n._occluders:undefined;it=t.camera.positionCartographic;f.sort(at);var h=n._addHeightCallbacks,c=n._removeHeightCallbacks,w=t.frameNumber,u,o;if(h.length>0||c.length>0){for(u=0,o=f.length;u<o;++u)i=f[u],i._updateCustomData(w,h,c);h.length=0;c.length=0}for(u=0,o=f.length;u<o;++u)i=f[u],n._tileReplacementQueue.markTileRendered(i),i.renderable?e.computeTileVisibility(i,t,p)!==a.NONE?st(n,t,i):(i.needsLoading&&n._tileLoadQueueLow.push(i),++s.tilesCulled):(i.needsLoading&&n._tileLoadQueueHigh.push(i),++s.tilesWaitingForChildren)}}function st(n,t,i){var o=n._debug;if(++o.tilesVisited,n._tileReplacementQueue.markTileRendered(i),i._updateCustomData(t.frameNumber),i.level>o.maxDepth&&(o.maxDepth=i.level),pt(n,t,i)<n.maximumScreenSpaceError){i.needsLoading&&n._tileLoadQueueMedium.push(i);ut(n,i);return}var r=i.southwestChild,u=i.southeastChild,f=i.northwestChild,e=i.northeastChild,s=r.renderable&&u.renderable&&f.renderable&&e.renderable,h=r.upsampledFromParent&&u.upsampledFromParent&&f.upsampledFromParent&&e.upsampledFromParent;s?h?(ut(n,i),ht(n,t.camera.positionCartographic,r,u,f,e),i.needsLoading&&n._tileLoadQueueMedium.push(i)):(yt(n,r,u,f,e,t),i.needsLoading&&n._tileLoadQueueLow.push(i)):(ht(n,t.camera.positionCartographic,r,u,f,e),ut(n,i),i.needsLoading&&n._tileLoadQueueLow.push(i))}function ht(n,t,i,r,u,f){t.longitude<i.east?t.latitude<i.north?(k(n,i),k(n,r),k(n,u),k(n,f)):(k(n,u),k(n,i),k(n,f),k(n,r)):t.latitude<i.north?(k(n,r),k(n,i),k(n,f),k(n,u)):(k(n,f),k(n,u),k(n,r),k(n,i))}function k(n,t){n._tileReplacementQueue.markTileRendered(t);t.needsLoading&&(t.renderable?n._tileLoadQueueLow.push(t):n._tileLoadQueueHigh.push(t))}function yt(n,t,i,r,u,f){var s=f.camera.positionCartographic,e=n._tileProvider,o=n._occluders;s.longitude<t.rectangle.east?s.latitude<t.rectangle.north?(d(n,t,e,f,o),d(n,i,e,f,o),d(n,r,e,f,o),d(n,u,e,f,o)):(d(n,r,e,f,o),d(n,t,e,f,o),d(n,u,e,f,o),d(n,i,e,f,o)):s.latitude<t.rectangle.north?(d(n,i,e,f,o),d(n,t,e,f,o),d(n,u,e,f,o),d(n,r,e,f,o)):(d(n,u,e,f,o),d(n,r,e,f,o),d(n,i,e,f,o),d(n,t,e,f,o))}function d(n,t,i,r,u){i.computeTileVisibility(t,r,u)!==a.NONE?st(n,r,t):(++n._debug.tilesCulled,n._tileReplacementQueue.markTileRendered(t),t.needsLoading&&n._tileLoadQueueLow.push(t))}function pt(n,t,i){if(t.mode===w.SCENE2D||t.camera.frustum instanceof h)return wt(n,t,i);var f=n._tileProvider.getLevelMaximumGeometricError(i.level),u=i._distance,e=t.context.drawingBufferHeight,o=t.camera.frustum.sseDenominator,r=f*e/(u*o);return t.fog.enabled&&(r=r-s.fog(u,t.fog.density)*t.fog.sse),r}function wt(n,t,i){var o=t.camera,u=o.frustum;r(u._offCenterFrustum)&&(u=u._offCenterFrustum);var e=t.context,h=e.drawingBufferWidth,c=e.drawingBufferHeight,l=n._tileProvider.getLevelMaximumGeometricError(i.level),a=Math.max(u.top-u.bottom,u.right-u.left)/Math.max(h,c),f=l/a;return t.fog.enabled&&t.mode!==w.SCENE2D&&(f=f-s.fog(i._distance,t.fog.density)*t.fog.sse),f}function ut(n,t){n._tilesToRender.push(t);++n._debug.tilesRendered}function bt(n,t){var u=n._tileLoadQueueHigh,f=n._tileLoadQueueMedium,e=n._tileLoadQueueLow,i,r;(u.length!==0||f.length!==0||e.length!==0)&&(n._tileReplacementQueue.trimTiles(n.tileCacheSize),i=o()+n._loadQueueTimeSlice,r=n._tileProvider,ft(n,t,r,i,u),ft(n,t,r,i,f),ft(n,t,r,i,e))}function ft(n,t,i,r,u){for(var e,f=0,s=u.length;f<s&&o()<r;++f)e=u[f],n._tileReplacementQueue.markTileRendered(e),i.loadTile(t,e)}function dt(u,f){var y=kt,s,e,st,ht,ct,lt,g,it,at,c,b,rt,a;y.length=0;for(var v=u._tileToUpdateHeights,vt=u._tileProvider.terrainProvider,yt=o(),pt=u._updateHeightsTimeSlice,wt=yt+pt,ut=f.mode,k=f.mapProjection,d=k.ellipsoid,h;v.length>0;){if(s=v[0],s.state!==p.DONE){y.push(s);v.shift();u._lastTileIndex=0;continue}var ft=s.customData,bt=ft.length,ot=!1;for(h=u._lastTileIndex;h<bt;++h){if(e=ft[h],s.level>e.level)r(e.positionOnEllipsoidSurface)||(e.positionOnEllipsoidSurface=n.fromRadians(e.positionCartographic.longitude,e.positionCartographic.latitude,0,d)),ut===w.SCENE3D?(st=d.geodeticSurfaceNormal(e.positionOnEllipsoidSurface,tt.direction),ht=d.getSurfaceNormalIntersectionWithZAxis(e.positionOnEllipsoidSurface,11500,tt.origin),r(ht)||(ct=Math.min(i(s.data.minimumHeight,0),-11500),lt=n.multiplyByScalar(st,Math.abs(ct)+1,nt),n.subtract(e.positionOnEllipsoidSurface,lt,tt.origin))):(t.clone(e.positionCartographic,et),et.height=-11500,k.project(et,nt),n.fromElements(nt.z,nt.x,nt.y,nt),n.clone(nt,tt.origin),n.clone(n.UNIT_X,tt.direction)),g=s.data.pick(tt,ut,k,!1,nt),r(g)&&(e.callback(g),e.level=s.level);else if(s.level===e.level){for(it=s.children,at=it.length,b=0;b<at;++b)if(c=it[b],l.contains(c.rectangle,e.positionCartographic))break;rt=vt.getTileDataAvailable(c.x,c.y,c.level);a=s.parent;(r(rt)&&!rt||r(a)&&r(a.data)&&r(a.data.terrainData)&&!a.data.terrainData.isChildAvailable(a.x,a.y,c.x,c.y))&&e.removeFunc()}if(o()>=wt){ot=!0;break}}if(ot){u._lastTileIndex=h;break}else u._lastTileIndex=0,v.shift()}for(h=0;h<y.length;h++)v.push(y[h])}function gt(n,t){for(var i,f=n._tileProvider,u=n._tilesToRender,e=n._tileToUpdateHeights,r=0,o=u.length;r<o;++r)i=u[r],f.showTileThisFrame(i,t),i._frameRendered!==t.frameNumber-1&&e.push(i),i._frameRendered=t.frameNumber}var it,rt;u(g.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}}});g.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0};g.prototype.forEachLoadedTile=function(n){for(var t=this._tileReplacementQueue.head;r(t);)t.state!==p.START&&n(t),t=t.replacementNext};g.prototype.forEachRenderedTile=function(n){for(var i=this._tilesToRender,t=0,r=i.length;t<r;++t)n(i[t])};g.prototype.updateHeight=function(n,t){var r=this,i={positionOnEllipsoidSurface:undefined,positionCartographic:n,level:-1,callback:t};return i.removeFunc=function(){for(var t=r._addHeightCallbacks,u=t.length,n=0;n<u;++n)if(t[n]===i){t.splice(n,1);break}r._removeHeightCallbacks.push(i)},r._addHeightCallbacks.push(i),i.removeFunc};g.prototype.update=function(n){r(this._tileProvider.update)&&this._tileProvider.update(n)};g.prototype.beginFrame=function(n){var t=n.passes;t.render&&((this._tilesInvalidated&&(ct(this),this._tilesInvalidated=!1),this._tileProvider.initialize(n),this._debug.suspendLodUpdate)||(ot(this),this._tileReplacementQueue.markStartOfRenderFrame()))};g.prototype.render=function(n){var i=n.passes,t=this._tileProvider;i.render&&(t.beginUpdate(n),vt(this,n),gt(this,n),t.endUpdate(n));i.pick&&this._tilesToRender.length>0&&t.updateForPick(n)};g.prototype.endFrame=function(n){var t=n.passes;t.render&&n.mode!==w.MORPHING&&(bt(this,n),dt(this,n),lt(this,n))};g.prototype.isDestroyed=function(){return!1};g.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};rt=new t;var tt=new c,et=new t,nt=new n,kt=[];return g});t("Scene/Globe",["../Core/BoundingSphere","../Core/buildModuleUrl","../Core/Cartesian3","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Ellipsoid","../Core/EllipsoidTerrainProvider","../Core/Event","../Core/IntersectionTests","../Core/Ray","../Core/Rectangle","../Core/Resource","../Renderer/ShaderSource","../Renderer/Texture","../Shaders/GlobeFS","../Shaders/GlobeVS","../Shaders/GroundAtmosphere","../ThirdParty/when","./GlobeSurfaceShaderSet","./GlobeSurfaceTileProvider","./ImageryLayerCollection","./QuadtreePrimitive","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et){"use strict";function ot(n){n=u(n,h.WGS84);var i=new c({ellipsoid:n}),r=new rt;this._ellipsoid=n;this._imageryLayerCollection=r;this._surfaceShaderSet=new tt;this._material=undefined;this._surface=new ut({tileProvider:new it({terrainProvider:i,imageryLayers:r,surfaceShaderSet:this._surfaceShaderSet})});this._terrainProvider=i;this._terrainProviderChanged=new l;st(this);this.show=!0;this._oceanNormalMapResourceDirty=!0;this._oceanNormalMapResource=new p({url:t("Assets/Textures/waterNormalsSmall.jpg")});this.maximumScreenSpaceError=2;this.tileCacheSize=100;this.enableLighting=!1;this.showGroundAtmosphere=!0;this.lightingFadeOutDistance=1e7;this.lightingFadeInDistance=2e7;this.nightFadeOutDistance=1e7;this.nightFadeInDistance=5e7;this.showWaterEffect=!0;this.depthTestAgainstTerrain=!1;this.shadows=et.RECEIVE_ONLY;this._oceanNormalMap=undefined;this._zoomedOutOceanSpecularIntensity=undefined}function st(n){var t=[],r=f(n._material)&&(n._material.shaderSource.match(/slope/)||n._material.shaderSource.match("normalEC")),i=[g];f(n._material)&&(!r||n._terrainProvider.requestVertexNormals)?(i.push(n._material.shaderSource),t.push("APPLY_MATERIAL"),n._surface._tileProvider.uniformMap=n._material._uniforms):n._surface._tileProvider.uniformMap=undefined;i.push(k);n._surfaceShaderSet.baseVertexShaderSource=new w({sources:[g,d],defines:t});n._surfaceShaderSet.baseFragmentShaderSource=new w({sources:i,defines:t});n._surfaceShaderSet.material=n._material}function yt(t){return function(i,r){var u=n.distanceSquaredTo(i.pickBoundingSphere,t),f=n.distanceSquaredTo(r.pickBoundingSphere,t);return u-f}}function ht(n,t){return y.contains(n.rectangle,t)?n:undefined}var ct,lt,at;e(ot.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tileLoadedEvent:{get:function(){return this._surface.tileProvider.tileLoadedEvent}},tilesLoaded:{get:function(){return f(this._surface)?this._surface.tileProvider.ready&&this._surface._tileLoadQueueHigh.length===0&&this._surface._tileLoadQueueMedium.length===0&&this._surface._tileLoadQueueLow.length===0:!0}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(n){this._surface.tileProvider.baseColor=n}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(n){this._surface.tileProvider.clippingPlanes=n}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(n){this._surface.tileProvider.cartographicLimitRectangle=n}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(n){this._oceanNormalMapResource.url=n;this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(n){n!==this._terrainProvider&&(this._terrainProvider=n,this._terrainProviderChanged.raiseEvent(n),f(this._material)&&st(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(n){this._material!==n&&(this._material=n,st(this))}}});ct=[];lt={start:0,stop:0};ot.prototype.pickWorldCoordinates=function(t,r,u){var v,l,y,e,h,o,w,p;if(!f(t))throw new s("ray is required");if(!f(r))throw new s("scene is required");var b=r.mode,k=r.mapProjection,c=ct;for(c.length=0,v=this._surface._tilesToRender,l=v.length,e=0;e<l;++e)(y=v[e],h=y.data,f(h))&&(o=h.pickBoundingSphere,b!==ft.SCENE3D?(n.fromRectangleWithHeights2D(y.rectangle,k,h.minimumHeight,h.maximumHeight,o),i.fromElements(o.center.z,o.center.x,o.center.y,o.center)):n.clone(h.boundingSphere3D,o),w=a.raySphere(t,o,lt),f(w)&&c.push(h));for(c.sort(yt(t.origin)),l=c.length,e=0;e<l;++e)if(p=c[e].pick(t,r.mode,r.mapProjection,!0,u),f(p))break;return p};at=new r;ot.prototype.pick=function(n,t,r){if(r=this.pickWorldCoordinates(n,t,r),f(r)&&t.mode!==ft.SCENE3D){r=i.fromElements(r.y,r.z,r.x,r);var u=t.mapProjection.unproject(r,at);r=t.globe.ellipsoid.cartographicToCartesian(u,r)}return r};var pt=new i,vt=new i,wt=new r,bt=new v;return ot.prototype.getHeight=function(n){var r,t,e,a,v,p,l;if(!f(n))throw new s("cartographic is required");if(r=this._surface._levelZeroTiles,f(r)){for(a=r.length,e=0;e<a;++e)if(t=r[e],y.contains(t.rectangle,n))break;if(!f(t)||!y.contains(t.rectangle,n))return undefined;while(t.renderable)t=ht(t.southwestChild,n)||ht(t.southeastChild,n)||ht(t.northwestChild,n)||t.northeastChild;while(f(t)&&(!f(t.data)||!f(t.data.pickTerrain)))t=t.parent;if(!f(t))return undefined;var o=this._surface._tileProvider.tilingScheme.ellipsoid,c=i.fromRadians(n.longitude,n.latitude,0,o,pt),h=bt,w=o.geodeticSurfaceNormal(c,h.direction),b=o.getSurfaceNormalIntersectionWithZAxis(c,11500,h.origin);return(f(b)||(v=Math.min(u(t.data.minimumHeight,0),-11500),p=i.multiplyByScalar(w,Math.abs(v)+1,vt),i.subtract(c,p,h.origin)),l=t.data.pick(h,undefined,undefined,!1,vt),!f(l))?undefined:o.cartesianToCartographic(l,wt).height}},ot.prototype.update=function(n){this.show&&n.passes.render&&this._surface.update(n)},ot.prototype.beginFrame=function(n){var r=this._surface,t=r.tileProvider,o=this.terrainProvider,s=this.showWaterEffect&&o.ready&&o.hasWaterMask,u,e,i,h,c;s&&this._oceanNormalMapResourceDirty&&(this._oceanNormalMapResourceDirty=!1,u=this._oceanNormalMapResource,e=u.url,f(e)?(i=this,nt(u.fetchImage(),function(t){e===i._oceanNormalMapResource.url&&(i._oceanNormalMap=i._oceanNormalMap&&i._oceanNormalMap.destroy(),i._oceanNormalMap=new b({context:n.context,source:t}))})):this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy());h=n.passes;c=n.mode;h.render&&(this._zoomedOutOceanSpecularIntensity=this.showGroundAtmosphere?.4:.5,r.maximumScreenSpaceError=this.maximumScreenSpaceError,r.tileCacheSize=this.tileCacheSize,t.terrainProvider=this.terrainProvider,t.lightingFadeOutDistance=this.lightingFadeOutDistance,t.lightingFadeInDistance=this.lightingFadeInDistance,t.nightFadeOutDistance=this.nightFadeOutDistance,t.nightFadeInDistance=this.nightFadeInDistance,t.zoomedOutOceanSpecularIntensity=c===ft.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,t.hasWaterMask=s,t.oceanNormalMap=this._oceanNormalMap,t.enableLighting=this.enableLighting,t.showGroundAtmosphere=this.showGroundAtmosphere,t.shadows=this.shadows,r.beginFrame(n))},ot.prototype.render=function(n){if(this.show){f(this._material)&&this._material.update(n.context);var t=this._surface,i=n.passes;i.render&&t.render(n);i.pick&&t.render(n)}},ot.prototype.endFrame=function(n){this.show&&n.passes.render&&this._surface.endFrame(n)},ot.prototype.isDestroyed=function(){return!1},ot.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),o(this)},ot});t("Shaders/PostProcessStages/DepthViewPacked",[],function(){"use strict";return"uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nfloat z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\nz_window = czm_reverseLogDepth(z_window);\nfloat n_range = czm_depthRange.near;\nfloat f_range = czm_depthRange.far;\nfloat z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\nfloat scale = pow(z_ndc * 0.5 + 0.5, 8.0);\ngl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"});t("Shaders/PostProcessStages/PassThrough",[],function(){"use strict";return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n}\n"});t("Shaders/PostProcessStages/PassThroughDepth",[],function(){"use strict";return"uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n"});t("Scene/GlobeDepth",["../Core/BoundingRectangle","../Core/Color","../Core/defined","../Core/destroyObject","../Core/PixelFormat","../Renderer/ClearCommand","../Renderer/Framebuffer","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/ShaderSource","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureWrap","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Shaders/PostProcessStages/DepthViewPacked","../Shaders/PostProcessStages/PassThrough","../Shaders/PostProcessStages/PassThroughDepth"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function k(){this._colorTexture=undefined;this._depthStencilTexture=undefined;this._globeDepthTexture=undefined;this.framebuffer=undefined;this._copyDepthFramebuffer=undefined;this._clearColorCommand=undefined;this._copyColorCommand=undefined;this._copyDepthCommand=undefined;this._viewport=new n;this._rs=undefined;this._useScissorTest=!1;this._scissorRectangle=undefined;this._useLogDepth=undefined;this._debugGlobeDepthViewportCommand=undefined}function nt(n,t,r,u){if(!i(n._debugGlobeDepthViewportCommand)||u!==n._useLogDepth){var f=new h({defines:[u?"LOG_DEPTH":""],sources:["uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});n._debugGlobeDepthViewportCommand=t.createViewportQuadCommand(f,{uniformMap:{u_depthTexture:function(){return n._globeDepthTexture}},owner:n});n._useLogDepth=u}n._debugGlobeDepthViewportCommand.execute(t,r)}function d(n){n._colorTexture=n._colorTexture&&!n._colorTexture.isDestroyed()&&n._colorTexture.destroy();n._depthStencilTexture=n._depthStencilTexture&&!n._depthStencilTexture.isDestroyed()&&n._depthStencilTexture.destroy();n._globeDepthTexture=n._globeDepthTexture&&!n._globeDepthTexture.isDestroyed()&&n._globeDepthTexture.destroy()}function g(n){n.framebuffer=n.framebuffer&&!n.framebuffer.isDestroyed()&&n.framebuffer.destroy();n._copyDepthFramebuffer=n._copyDepthFramebuffer&&!n._copyDepthFramebuffer.isDestroyed()&&n._copyDepthFramebuffer.destroy()}function tt(n,t,i,r){n._colorTexture=new l({context:t,width:i,height:r,pixelFormat:u.RGBA,pixelDatatype:o.UNSIGNED_BYTE,sampler:new c({wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,minificationFilter:y.NEAREST,magnificationFilter:v.NEAREST})});n._depthStencilTexture=new l({context:t,width:i,height:r,pixelFormat:u.DEPTH_STENCIL,pixelDatatype:o.UNSIGNED_INT_24_8});n._globeDepthTexture=new l({context:t,width:i,height:r,pixelFormat:u.RGBA,pixelDatatype:o.UNSIGNED_BYTE,sampler:new c({wrapS:a.CLAMP_TO_EDGE,wrapT:a.CLAMP_TO_EDGE,minificationFilter:y.NEAREST,magnificationFilter:v.NEAREST})})}function it(n,t){n.framebuffer=new e({context:t,colorTextures:[n._colorTexture],depthStencilTexture:n._depthStencilTexture,destroyAttachments:!1});n._copyDepthFramebuffer=new e({context:t,colorTextures:[n._globeDepthTexture],destroyAttachments:!1})}function rt(n,t,r,u){var f=n._colorTexture,e=!i(f)||f.width!==r||f.height!==u;(!i(n.framebuffer)||e)&&(d(n),g(n),tt(n,t,r,u),it(n,t))}function ut(r,u,e,o,h){r._viewport.width=e;r._viewport.height=o;var c=!n.equals(r._viewport,h.viewport),l=c!==r._useScissorTest;r._useScissorTest=c;n.equals(r._scissorRectangle,h.viewport)||(r._scissorRectangle=n.clone(h.viewport,r._scissorRectangle),l=!0);i(r._rs)&&n.equals(r._viewport,r._rs.viewport)&&!l||(r._rs=s.fromCache({viewport:r._viewport,scissorTest:{enabled:r._useScissorTest,rectangle:r._scissorRectangle}}));i(r._copyDepthCommand)||(r._copyDepthCommand=u.createViewportQuadCommand(b,{uniformMap:{u_depthTexture:function(){return r._depthStencilTexture}},owner:r}));r._copyDepthCommand.framebuffer=r._copyDepthFramebuffer;i(r._copyColorCommand)||(r._copyColorCommand=u.createViewportQuadCommand(w,{uniformMap:{colorTexture:function(){return r._colorTexture}},owner:r}));r._copyDepthCommand.renderState=r._rs;r._copyColorCommand.renderState=r._rs;i(r._clearColorCommand)||(r._clearColorCommand=new f({color:new t(0,0,0,0),stencil:0,owner:r}));r._clearColorCommand.framebuffer=r.framebuffer}return k.prototype.executeDebugGlobeDepth=function(n,t,i){nt(this,n,t,i)},k.prototype.update=function(n,t,i){var r=i.width,u=i.height;rt(this,n,r,u);ut(this,n,r,u,t);n.uniformState.globeDepthTexture=undefined},k.prototype.executeCopyDepth=function(n,t){i(this._copyDepthCommand)&&(this._copyDepthCommand.execute(n,t),n.uniformState.globeDepthTexture=this._globeDepthTexture)},k.prototype.executeCopyColor=function(n,t){i(this._copyColorCommand)&&this._copyColorCommand.execute(n,t)},k.prototype.clear=function(n,r,u){var f=this._clearColorCommand;i(f)&&(t.clone(u,f.color),f.execute(n,r))},k.prototype.isDestroyed=function(){return!1},k.prototype.destroy=function(){d(this);g(this);i(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy());i(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy());var n=this._debugGlobeDepthViewportCommand;return i(n)&&(n.shaderProgram=n.shaderProgram.destroy()),r(this)},k});t("Scene/GoogleEarthEnterpriseImageryProvider",["../Core/Credit","../Core/decodeGoogleEarthEnterpriseData","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../Core/GeographicTilingScheme","../Core/GoogleEarthEnterpriseMetadata","../Core/loadImageFromTypedArray","../Core/Math","../Core/Rectangle","../Core/Request","../Core/Resource","../Core/RuntimeError","../Core/TileProviderError","../ThirdParty/protobuf-minimal","../ThirdParty/when"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function d(){this._image=new Image}function k(t){var u,k,a,h,w;if(t=i(t,i.EMPTY_OBJECT),!(r(t.url)||r(t.metadata)))throw new f("options.url or options.metadata is required.");r(t.metadata)?u=t.metadata:(k=v.createIfNeeded(t.url),u=new s(k));this._metadata=u;this._tileDiscardPolicy=t.tileDiscardPolicy;this._tilingScheme=new o({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new l(-c.PI,-c.PI,c.PI,c.PI),ellipsoid:t.ellipsoid});a=t.credit;typeof a=="string"&&(a=new n(a));this._credit=a;this._tileWidth=256;this._tileHeight=256;this._maximumLevel=23;r(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new d);this._errorEvent=new e;this._ready=!1;h=this;this._readyPromise=u.readyPromise.then(function(n){if(!u.imageryPresent){var t=new y("The server "+u.url+" doesn't have imagery");return w=p.handleError(w,h,h._errorEvent,t.message,undefined,undefined,undefined,t),b.reject(t)}return p.handleSuccess(w),h._ready=n,n}).otherwise(function(n){return w=p.handleError(w,h,h._errorEvent,n.message,undefined,undefined,undefined,n),b.reject(n)})}function g(n,t,i,u,f,e){var h=s.tileXYToQuadKey(i,u,f),o=t.imageryVersion;return o=r(o)&&o>0?o:1,n._metadata.resource.getDerivedResource({url:"flatfile?f1-0"+h+"-i."+o.toString(),request:e})}function nt(n){var t="JFIF",i;return n[6]===t.charCodeAt(0)&&n[7]===t.charCodeAt(1)&&n[8]===t.charCodeAt(2)&&n[9]===t.charCodeAt(3)?"image/jpeg":(i="PNG",n[1]===i.charCodeAt(0)&&n[2]===i.charCodeAt(1)&&n[3]===i.charCodeAt(2))?"image/png":undefined}function tt(n){for(var t=w.Reader.create(n),h=t.len,i={},f,u,s,e,o;t.pos<h;){f=t.uint32();switch(f>>>3){case 1:i.imageType=t.uint32();break;case 2:i.imageData=t.bytes();break;case 3:i.alphaType=t.uint32();break;case 4:i.imageAlpha=t.bytes();break;case 5:if(u=i.copyrightIds,r(u)||(u=i.copyrightIds=[]),(f&7)==2)for(s=t.uint32()+t.pos;t.pos<s;)u.push(t.uint32());else u.push(t.uint32());break;default:t.skipType(f&7)}}if(e=i.imageType,r(e))switch(e){case 0:i.imageType="image/jpeg";break;case 4:i.imageType="image/png";break;default:throw new y("GoogleEarthEnterpriseImageryProvider: Unsupported image type.");}return o=i.alphaType,r(o)&&o!==0&&(console.log("GoogleEarthEnterpriseImageryProvider: External alpha not supported."),delete i.alphaType,delete i.imageAlpha),i}return d.prototype.isReady=function(){return!0},d.prototype.shouldDiscardImage=function(n){return n===this._image},u(k.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tileWidth:{get:function(){if(!this._ready)throw new f("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new f("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new f("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new f("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new f("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new f("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new f("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}}),k.prototype.getTileCredits=function(n,t,i){var u,e,o;if(!this._ready)throw new f("getTileCredits must not be called before the imagery provider is ready.");return(u=this._metadata,e=u.getTileInformation(n,t,i),r(e)&&(o=u.providers[e.imageryProvider],r(o)))?[o]:undefined},k.prototype.requestImage=function(n,i,u,e){var y,v;if(!this._ready)throw new f("requestImage must not be called before the imagery provider is ready.");var c=this._tileDiscardPolicy._image,o=this._metadata,p=s.tileXYToQuadKey(n,i,u),l=o.getTileInformation(n,i,u);return r(l)?l.hasImagery()?(v=g(this,l,n,i,u,e).fetchArrayBuffer(),!r(v))?undefined:v.then(function(n){var i,u,f,e;return(t(o.key,n),i=new Uint8Array(n),f=o.protoImagery,r(f)&&f||(u=nt(i)),r(u)||r(f)&&!f||(e=tt(i),u=e.imageType,i=e.imageData),!r(u)||!r(i))?c:h(i,u)}):c:o.isValid(p)?(y=new a({throttle:e.throttle,throttleByServer:e.throttleByServer,type:e.type,priorityFunction:e.priorityFunction}),o.populateSubtree(n,i,u,y),undefined):c},k.prototype.pickFeatures=function(){return undefined},k});t("Scene/GridImageryProvider",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","../Core/GeographicTilingScheme","../ThirdParty/when"],function(n,t,i,r,u,f,e){"use strict";function o(n){n=t(n,t.EMPTY_OBJECT);this._tilingScheme=i(n.tilingScheme)?n.tilingScheme:new f({ellipsoid:n.ellipsoid});this._cells=t(n.cells,8);this._color=t(n.color,s);this._glowColor=t(n.glowColor,h);this._glowWidth=t(n.glowWidth,6);this._backgroundColor=t(n.backgroundColor,c);this._errorEvent=new u;this._tileWidth=t(n.tileWidth,256);this._tileHeight=t(n.tileHeight,256);this._canvasSize=t(n.canvasSize,256);this._canvas=this._createGridCanvas();this._readyPromise=e.resolve(!0)}var s=new n(1,1,1,.4),h=new n(0,1,0,.05),c=new n(0,.5,0,.2);return r(o.prototype,{proxy:{get:function(){return undefined}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return undefined}},minimumLevel:{get:function(){return undefined}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return undefined}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return undefined}},hasAlphaChannel:{get:function(){return!0}}}),o.prototype._drawGrid=function(n){for(var f,t,u=0,i=this._canvasSize,r=0;r<=this._cells;++r)f=r/this._cells,t=1+f*(i-1),n.moveTo(t,u),n.lineTo(t,i),n.moveTo(u,t),n.lineTo(i,t);n.stroke()},o.prototype._createGridCanvas=function(){var r=document.createElement("canvas"),u,f;r.width=this._canvasSize;r.height=this._canvasSize;var t=0,i=this._canvasSize,n=r.getContext("2d"),e=this._backgroundColor.toCssColorString();return n.fillStyle=e,n.fillRect(t,t,i,i),u=this._glowColor.toCssColorString(),n.strokeStyle=u,n.lineWidth=this._glowWidth,n.strokeRect(t,t,i,i),this._drawGrid(n),n.lineWidth=this._glowWidth*.5,n.strokeRect(t,t,i,i),this._drawGrid(n),f=this._color.toCssColorString(),n.strokeStyle=f,n.lineWidth=2,n.strokeRect(t,t,i,i),n.lineWidth=1,this._drawGrid(n),r},o.prototype.getTileCredits=function(){return undefined},o.prototype.requestImage=function(){return this._canvas},o.prototype.pickFeatures=function(){return undefined},o});t("Scene/InvertClassification",["../Core/Color","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/PixelFormat","../Renderer/ClearCommand","../Renderer/Framebuffer","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/Sampler","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Shaders/PostProcessStages/PassThrough","./BlendingState","./StencilFunction","./StencilOperation"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function d(){this.previousFramebuffer=undefined;this._previousFramebuffer=undefined;this._texture=undefined;this._classifiedTexture=undefined;this._depthStencilTexture=undefined;this._fbo=undefined;this._fboClassified=undefined;this._rsUnclassified=undefined;this._rsClassified=undefined;this._unclassifiedCommand=undefined;this._classifiedCommand=undefined;this._translucentCommand=undefined;this._clearColorCommand=new f({color:new n(0,0,0,0),owner:this});this._clearCommand=new f({color:new n(0,0,0,0),depth:1,stencil:0});var t=this;this._uniformMap={colorTexture:function(){return t._texture},depthTexture:function(){return t._depthStencilTexture},classifiedTexture:function(){return t._classifiedTexture}}}i(d.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}});d.isTranslucencySupported=function(n){return n.depthTexture&&n.fragmentDepth};var g=15,nt=0,tt={depthMask:!1,stencilTest:{enabled:!0,frontFunction:b.EQUAL,frontOperation:{fail:k.KEEP,zFail:k.KEEP,zPass:k.KEEP},backFunction:b.NEVER,reference:nt,mask:g},blending:w.ALPHA_BLEND},it={depthMask:!1,stencilTest:{enabled:!0,frontFunction:b.NOT_EQUAL,frontOperation:{fail:k.KEEP,zFail:k.KEEP,zPass:k.KEEP},backFunction:b.NEVER,reference:nt,mask:g},blending:w.ALPHA_BLEND},rt={depthMask:!0,depthTest:{enabled:!0},blending:w.ALPHA_BLEND},ut="#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n    bool isClassified = all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor = czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor = vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor = color * highlightColor;\n    gl_FragDepthEXT = texture2D(depthTexture, v_textureCoordinates).r;\n}\n",ft="uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    if (color.a == 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor = color * czm_invertClassificationColor;\n#else\n    gl_FragColor = color;\n#endif\n}\n";return d.prototype.update=function(n){var i=this._texture,b=!t(i)||this.previousFramebuffer!==this._previousFramebuffer,w,d;this._previousFramebuffer=this.previousFramebuffer;var r=n.drawingBufferWidth,f=n.drawingBufferHeight,k=!t(i)||i.width!==r||i.height!==f;if((k||b)&&(this._texture=this._texture&&this._texture.destroy(),this._classifiedTexture=this._classifiedTexture&&this._classifiedTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._texture=new l({context:n,width:r,height:f,pixelFormat:u.RGBA,pixelDatatype:o.UNSIGNED_BYTE,sampler:new h({wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE,minificationFilter:v.LINEAR,magnificationFilter:a.LINEAR})}),t(this._previousFramebuffer)||(this._classifiedTexture=new l({context:n,width:r,height:f,pixelFormat:u.RGBA,pixelDatatype:o.UNSIGNED_BYTE,sampler:new h({wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE,minificationFilter:v.LINEAR,magnificationFilter:a.LINEAR})}),this._depthStencilTexture=new l({context:n,width:r,height:f,pixelFormat:u.DEPTH_STENCIL,pixelDatatype:o.UNSIGNED_INT_24_8}))),(!t(this._fbo)||k||b)&&(this._fbo=this._fbo&&this._fbo.destroy(),this._fboClassified=this._fboClassified&&this._fboClassified.destroy(),t(this._previousFramebuffer)?(w=this._previousFramebuffer.depthStencilTexture,d=this._previousFramebuffer.depthStencilRenderbuffer):w=this._depthStencilTexture,this._fbo=new e({context:n,colorTextures:[this._texture],depthStencilTexture:w,depthStencilRenderbuffer:d,destroyAttachments:!1}),t(this._previousFramebuffer)||(this._fboClassified=new e({context:n,colorTextures:[this._classifiedTexture],depthStencilTexture:w,destroyAttachments:!1}))),t(this._rsUnclassified)||(this._rsUnclassified=s.fromCache(tt),this._rsClassified=s.fromCache(it),this._rsDefault=s.fromCache(rt)),!t(this._unclassifiedCommand)||b){t(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());var g=t(this._previousFramebuffer)?ft:ut,nt=new c({defines:["UNCLASSIFIED"],sources:[g]}),et=new c({sources:[g]});this._unclassifiedCommand=n.createViewportQuadCommand(nt,{renderState:t(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this});this._classifiedCommand=n.createViewportQuadCommand(et,{renderState:t(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this});t(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy());t(this._previousFramebuffer)||(this._translucentCommand=n.createViewportQuadCommand(p,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}},d.prototype.clear=function(n,i){var r=i.framebuffer;t(this._previousFramebuffer)?(i.framebuffer=this._fbo,this._clearColorCommand.execute(n,i)):(i.framebuffer=this._fbo,this._clearCommand.execute(n,i),i.framebuffer=this._fboClassified,this._clearCommand.execute(n,i));i.framebuffer=r},d.prototype.executeClassified=function(n,i){if(!t(this._previousFramebuffer)){var r=i.framebuffer;i.framebuffer=this._fboClassified;this._translucentCommand.execute(n,i);i.framebuffer=r}this._classifiedCommand.execute(n,i)},d.prototype.executeUnclassified=function(n,t){this._unclassifiedCommand.execute(n,t)},d.prototype.isDestroyed=function(){return!1},d.prototype.destroy=function(){return this._fbo=this._fbo&&this._fbo.destroy(),this._texture=this._texture&&this._texture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),t(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),r(this)},d});t("Scene/JobScheduler",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/getTimestamp","./JobType"],function(n,t,i,r,u){"use strict";function e(n){this._total=n;this.usedThisFrame=0;this.stolenFromMeThisFrame=0;this.starvedThisFrame=!1;this.starvedLastFrame=!1}function f(t){var f,o,r,s,h;if(n(t)&&t.length!==u.NUMBER_OF_JOB_TYPES)throw new i("A budget must be specified for each job type; budgets.length should equal JobType.NUMBER_OF_JOB_TYPES.");for(f=new Array(u.NUMBER_OF_JOB_TYPES),f[u.TEXTURE]=new e(n(t)?t[u.TEXTURE]:10),f[u.PROGRAM]=new e(n(t)?t[u.PROGRAM]:10),f[u.BUFFER]=new e(n(t)?t[u.BUFFER]:30),o=f.length,s=0,r=0;r<o;++r)s+=f[r].total;for(h=new Array(o),r=0;r<o;++r)h[r]=!1;this._totalBudget=s;this._totalUsedThisFrame=0;this._budgets=f;this._executedThisFrame=h}return t(e.prototype,{total:{get:function(){return this._total}}}),f.getTimestamp=r,t(f.prototype,{totalBudget:{get:function(){return this._totalBudget}}}),f.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget},f.prototype.resetBudgets=function(){for(var n,i=this._budgets,r=i.length,t=0;t<r;++t)n=i[t],n.starvedLastFrame=n.starvedThisFrame,n.starvedThisFrame=!1,n.usedThisFrame=0,n.stolenFromMeThisFrame=0;this._totalUsedThisFrame=0},f.prototype.execute=function(n,t){var o=this._budgets,r=o[t],s=this._executedThisFrame[t],i,h,u,c,e;if(this._totalUsedThisFrame>=this._totalBudget&&s)return r.starvedThisFrame=!0,!1;if(r.usedThisFrame+r.stolenFromMeThisFrame>=r.total){for(h=o.length,u=0;u<h;++u)if(i=o[u],i.usedThisFrame+i.stolenFromMeThisFrame<i.total&&!i.starvedLastFrame)break;if(u===h&&s)return!1;s&&(r.starvedThisFrame=!0)}return c=f.getTimestamp(),n.execute(),e=f.getTimestamp()-c,this._totalUsedThisFrame+=e,i?i.stolenFromMeThisFrame+=e:r.usedThisFrame+=e,this._executedThisFrame[t]=!0,!0},f});t("Scene/Moon",["../Core/buildModuleUrl","../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Ellipsoid","../Core/IauOrientationAxes","../Core/Matrix3","../Core/Matrix4","../Core/Simon1994PlanetaryPositions","../Core/Transforms","./EllipsoidPrimitive","./Material"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";function y(t){t=i(t,i.EMPTY_OBJECT);var u=t.textureUrl;r(u)||(u=n("Assets/Textures/moonSmall.jpg"));this.show=i(t.show,!0);this.textureUrl=u;this._ellipsoid=i(t.ellipsoid,e.MOON);this.onlySunLighting=i(t.onlySunLighting,!0);this._ellipsoidPrimitive=new a({radii:this.ellipsoid.radii,material:v.fromType(v.ImageType),depthTestEnabled:!1,_owner:this});this._ellipsoidPrimitive.material.translucent=!1;this._axes=new o}u(y.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var p=new s,b=new s,k=new t,w=[];return y.prototype.update=function(n){var i,u,t,f,e;if(this.show)return i=this._ellipsoidPrimitive,i.material.uniforms.image=this.textureUrl,i.onlySunLighting=this.onlySunLighting,u=n.time,r(l.computeIcrfToFixedMatrix(u,p))||l.computeTemeToPseudoFixedMatrix(u,p),t=this._axes.evaluate(u,b),s.transpose(t,t),s.multiply(p,t,t),f=c.computeMoonPositionInEarthInertialFrame(u,k),s.multiplyByVector(p,f,f),h.fromRotationTranslation(t,f,i.modelMatrix),e=n.commandList,n.commandList=w,w.length=0,i.update(n),n.commandList=e,w.length===1?w[0]:undefined},y.prototype.isDestroyed=function(){return!1},y.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),f(this)},y});t("Scene/NeverTileDiscardPolicy",[],function(){"use strict";function n(){}return n.prototype.isReady=function(){return!0},n.prototype.shouldDiscardImage=function(){return!1},n});t("Shaders/AdjustTranslucentFS",[],function(){"use strict";return"#ifdef MRT\n#extension GL_EXT_draw_buffers : enable\n#endif\nuniform vec4 u_bgColor;\nuniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nif (texture2D(u_depthTexture, v_textureCoordinates).r < 1.0)\n{\n#ifdef MRT\ngl_FragData[0] = u_bgColor;\ngl_FragData[1] = vec4(u_bgColor.a);\n#else\ngl_FragColor = u_bgColor;\n#endif\nreturn;\n}\ndiscard;\n}\n"});t("Shaders/CompositeOITFS",[],function(){"use strict";return"uniform sampler2D u_opaque;\nuniform sampler2D u_accumulation;\nuniform sampler2D u_revealage;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 opaque = texture2D(u_opaque, v_textureCoordinates);\nvec4 accum = texture2D(u_accumulation, v_textureCoordinates);\nfloat r = texture2D(u_revealage, v_textureCoordinates).r;\n#ifdef MRT\nvec4 transparent = vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n#else\nvec4 transparent = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n#endif\ngl_FragColor = (1.0 - transparent.a) * transparent + transparent.a * opaque;\nif (opaque != czm_backgroundColor)\n{\ngl_FragColor.a = 1.0;\n}\n}\n"});t("Scene/OIT",["../Core/BoundingRectangle","../Core/Color","../Core/defined","../Core/destroyObject","../Core/PixelFormat","../Core/WebGLConstants","../Renderer/ClearCommand","../Renderer/DrawCommand","../Renderer/Framebuffer","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/ShaderSource","../Renderer/Texture","../Shaders/AdjustTranslucentFS","../Shaders/CompositeOITFS","./BlendEquation","./BlendFunction"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(i){this._translucentMultipassSupport=!1;this._translucentMRTSupport=!1;var r=i.colorBufferFloat&&i.depthTexture;this._translucentMRTSupport=i.drawBuffers&&r;this._translucentMultipassSupport=!this._translucentMRTSupport&&r;this._opaqueFBO=undefined;this._opaqueTexture=undefined;this._depthStencilTexture=undefined;this._accumulationTexture=undefined;this._translucentFBO=undefined;this._alphaFBO=undefined;this._adjustTranslucentFBO=undefined;this._adjustAlphaFBO=undefined;this._opaqueClearCommand=new e({color:new t(0,0,0,0),owner:this});this._translucentMRTClearCommand=new e({color:new t(0,0,0,1),owner:this});this._translucentMultipassClearCommand=new e({color:new t(0,0,0,0),owner:this});this._alphaClearCommand=new e({color:new t(1,1,1,1),owner:this});this._translucentRenderStateCache={};this._alphaRenderStateCache={};this._compositeCommand=undefined;this._adjustTranslucentCommand=undefined;this._adjustAlphaCommand=undefined;this._viewport=new n;this._rs=undefined;this._useScissorTest=!1;this._scissorRectangle=undefined}function nt(n){n._accumulationTexture=n._accumulationTexture&&!n._accumulationTexture.isDestroyed()&&n._accumulationTexture.destroy();n._revealageTexture=n._revealageTexture&&!n._revealageTexture.isDestroyed()&&n._revealageTexture.destroy()}function k(n){n._translucentFBO=n._translucentFBO&&!n._translucentFBO.isDestroyed()&&n._translucentFBO.destroy();n._alphaFBO=n._alphaFBO&&!n._alphaFBO.isDestroyed()&&n._alphaFBO.destroy();n._adjustTranslucentFBO=n._adjustTranslucentFBO&&!n._adjustTranslucentFBO.isDestroyed()&&n._adjustTranslucentFBO.destroy();n._adjustAlphaFBO=n._adjustAlphaFBO&&!n._adjustAlphaFBO.isDestroyed()&&n._adjustAlphaFBO.destroy()}function tt(n){nt(n);k(n)}function it(n,t,i,r){nt(n);n._accumulationTexture=new a({context:t,width:i,height:r,pixelFormat:u.RGBA,pixelDatatype:h.FLOAT});var f=new Float32Array(i*r*4);n._revealageTexture=new a({context:t,pixelFormat:u.RGBA,pixelDatatype:h.FLOAT,source:{arrayBufferView:f,width:i,height:r},flipY:!1})}function rt(n,t){var i,r;if(k(n),i=f.FRAMEBUFFER_COMPLETE,r=!0,n._translucentMRTSupport&&(n._translucentFBO=new s({context:t,colorTextures:[n._accumulationTexture,n._revealageTexture],depthStencilTexture:n._depthStencilTexture,destroyAttachments:!1}),n._adjustTranslucentFBO=new s({context:t,colorTextures:[n._accumulationTexture,n._revealageTexture],destroyAttachments:!1}),(n._translucentFBO.status!==i||n._adjustTranslucentFBO.status!==i)&&(k(n),n._translucentMRTSupport=!1)),!n._translucentMRTSupport){n._translucentFBO=new s({context:t,colorTextures:[n._accumulationTexture],depthStencilTexture:n._depthStencilTexture,destroyAttachments:!1});n._alphaFBO=new s({context:t,colorTextures:[n._revealageTexture],depthStencilTexture:n._depthStencilTexture,destroyAttachments:!1});n._adjustTranslucentFBO=new s({context:t,colorTextures:[n._accumulationTexture],destroyAttachments:!1});n._adjustAlphaFBO=new s({context:t,colorTextures:[n._revealageTexture],destroyAttachments:!1});var u=n._translucentFBO.status===i,e=n._alphaFBO.status===i,o=n._adjustTranslucentFBO.status===i,h=n._adjustAlphaFBO.status===i;u&&e&&o&&h||(tt(n),n._translucentMultipassSupport=!1,r=!1)}return r}function d(n,t,r,u){var f=r[u.id],e;return i(f)||(e=c.getState(u),e.depthMask=!1,e.blending=t,f=c.fromCache(e),r[u.id]=f),f}function ot(n,t,i){return d(t,ut,n._translucentRenderStateCache,i)}function st(n,t,i){return d(t,ft,n._translucentRenderStateCache,i)}function ht(n,t,i){return d(t,et,n._alphaRenderStateCache,i)}function g(n,t,r,u){var e=n.shaderCache.getDerivedShaderProgram(t,r),o,f;return i(e)||(o=t._attributeLocations,f=t.fragmentShaderSource.clone(),f.sources=f.sources.map(function(n){return n=l.replaceMain(n,"czm_translucent_main"),n=n.replace(/gl_FragColor/g,"czm_gl_FragColor"),n=n.replace(/\bdiscard\b/g,"czm_discard = true"),n.replace(/czm_phong/g,"czm_translucentPhong")}),f.sources.splice(0,0,(u.indexOf("gl_FragData")!==-1?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard = false;\n"),f.sources.push("void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n"+u+"}\n"),e=n.shaderCache.createDerivedShaderProgram(t,r,{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:f,attributeLocations:o})),e}function vt(n,t){return g(n,t,"translucentMRT",ct)}function yt(n,t){return g(n,t,"translucentMultipass",lt)}function pt(n,t){return g(n,t,"alphaMultipass",at)}function wt(n,t,r,u,f,e){var o,s,h,c=t.context,v=t.frameState.useLogDepth,p=u.framebuffer,y=f.length,a=t.frameState.shadowState.lightShadowsEnabled,l;for(u.framebuffer=n._adjustTranslucentFBO,n._adjustTranslucentCommand.execute(c,u),u.framebuffer=n._adjustAlphaFBO,n._adjustAlphaCommand.execute(c,u),l=n._opaqueFBO,u.framebuffer=n._translucentFBO,h=0;h<y;++h)o=f[h],o=v?o.derivedCommands.logDepth.command:o,s=a&&o.receiveShadows?o.derivedCommands.oit.shadows.translucentCommand:o.derivedCommands.oit.translucentCommand,r(s,t,c,u,l);for(i(e)&&(o=e.unclassifiedCommand,s=a&&o.receiveShadows?o.derivedCommands.oit.shadows.translucentCommand:o.derivedCommands.oit.translucentCommand,r(s,t,c,u,l)),u.framebuffer=n._alphaFBO,h=0;h<y;++h)o=f[h],o=v?o.derivedCommands.logDepth.command:o,s=a&&o.receiveShadows?o.derivedCommands.oit.shadows.alphaCommand:o.derivedCommands.oit.alphaCommand,r(s,t,c,u,l);i(e)&&(o=e.unclassifiedCommand,s=a&&o.receiveShadows?o.derivedCommands.oit.shadows.alphaCommand:o.derivedCommands.oit.alphaCommand,r(s,t,c,u,l));u.framebuffer=p}function bt(n,t,r,u,f,e){var c=t.context,v=t.frameState.useLogDepth,y=u.framebuffer,p=f.length,a=t.frameState.shadowState.lightShadowsEnabled,l,o,s,h;for(u.framebuffer=n._adjustTranslucentFBO,n._adjustTranslucentCommand.execute(c,u),l=n._opaqueFBO,u.framebuffer=n._translucentFBO,h=0;h<p;++h)o=f[h],o=v?o.derivedCommands.logDepth.command:o,s=a&&o.receiveShadows?o.derivedCommands.oit.shadows.translucentCommand:o.derivedCommands.oit.translucentCommand,r(s,t,c,u,l);i(e)&&(o=e.unclassifiedCommand,s=a&&o.receiveShadows?o.derivedCommands.oit.shadows.translucentCommand:o.derivedCommands.oit.translucentCommand,r(s,t,c,u,l));u.framebuffer=y}b.prototype.update=function(t,r,u){var f,e,o,p,w;if(this.isSupported()){this._opaqueFBO=u;this._opaqueTexture=u.getColorTexture(0);this._depthStencilTexture=u.depthStencilTexture;var s=this._opaqueTexture.width,h=this._opaqueTexture.height,a=this._accumulationTexture,b=!i(a)||a.width!==s||a.height!==h;(b&&it(this,t,s,h),i(this._translucentFBO)&&!b||rt(this,t))&&(f=this,i(this._compositeCommand)||(e=new l({sources:[y]}),this._translucentMRTSupport&&e.defines.push("MRT"),o={u_opaque:function(){return f._opaqueTexture},u_accumulation:function(){return f._accumulationTexture},u_revealage:function(){return f._revealageTexture}},this._compositeCommand=t.createViewportQuadCommand(e,{uniformMap:o,owner:this})),i(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(e=new l({defines:["MRT"],sources:[v]}),o={u_bgColor:function(){return f._translucentMRTClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=t.createViewportQuadCommand(e,{uniformMap:o,owner:this})):this._translucentMultipassSupport&&(e=new l({sources:[v]}),o={u_bgColor:function(){return f._translucentMultipassClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustTranslucentCommand=t.createViewportQuadCommand(e,{uniformMap:o,owner:this}),o={u_bgColor:function(){return f._alphaClearCommand.color},u_depthTexture:function(){return f._depthStencilTexture}},this._adjustAlphaCommand=t.createViewportQuadCommand(e,{uniformMap:o,owner:this}))),this._viewport.width=s,this._viewport.height=h,p=!n.equals(this._viewport,r.viewport),w=p!==this._useScissorTest,this._useScissorTest=p,n.equals(this._scissorRectangle,r.viewport)||(this._scissorRectangle=n.clone(r.viewport,this._scissorRectangle),w=!0),i(this._rs)&&n.equals(this._viewport,this._rs.viewport)&&!w||(this._rs=c.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}})),i(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs),this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs),i(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs))}};var ut={enabled:!0,color:new t(0,0,0,0),equationRgb:p.ADD,equationAlpha:p.ADD,functionSourceRgb:w.ONE,functionDestinationRgb:w.ONE,functionSourceAlpha:w.ZERO,functionDestinationAlpha:w.ONE_MINUS_SOURCE_ALPHA},ft={enabled:!0,color:new t(0,0,0,0),equationRgb:p.ADD,equationAlpha:p.ADD,functionSourceRgb:w.ONE,functionDestinationRgb:w.ONE,functionSourceAlpha:w.ONE,functionDestinationAlpha:w.ONE},et={enabled:!0,color:new t(0,0,0,0),equationRgb:p.ADD,equationAlpha:p.ADD,functionSourceRgb:w.ZERO,functionDestinationRgb:w.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:w.ZERO,functionDestinationAlpha:w.ONE_MINUS_SOURCE_ALPHA};var ct="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragData[0] = vec4(Ci * wzi, ai);\n    gl_FragData[1] = vec4(ai * wzi);\n",lt="    vec3 Ci = czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai = czm_gl_FragColor.a;\n    float wzi = czm_alphaWeight(ai);\n    gl_FragColor = vec4(Ci, ai) * wzi;\n",at="    float ai = czm_gl_FragColor.a;\n    gl_FragColor = vec4(ai);\n";return b.prototype.createDerivedCommands=function(n,t,r){var u,e,f,s,h,c;return i(r)||(r={}),this._translucentMRTSupport?(i(r.translucentCommand)&&(u=r.translucentCommand.shaderProgram,e=r.translucentCommand.renderState),r.translucentCommand=o.shallowClone(n,r.translucentCommand),i(u)&&r.shaderProgramId===n.shaderProgram.id?(r.translucentCommand.shaderProgram=u,r.translucentCommand.renderState=e):(r.translucentCommand.shaderProgram=vt(t,n.shaderProgram),r.translucentCommand.renderState=ot(this,t,n.renderState),r.shaderProgramId=n.shaderProgram.id)):(i(r.translucentCommand)&&(f=r.translucentCommand.shaderProgram,s=r.translucentCommand.renderState,h=r.alphaCommand.shaderProgram,c=r.alphaCommand.renderState),r.translucentCommand=o.shallowClone(n,r.translucentCommand),r.alphaCommand=o.shallowClone(n,r.alphaCommand),i(f)&&r.shaderProgramId===n.shaderProgram.id?(r.translucentCommand.shaderProgram=f,r.translucentCommand.renderState=s,r.alphaCommand.shaderProgram=h,r.alphaCommand.renderState=c):(r.translucentCommand.shaderProgram=yt(t,n.shaderProgram),r.translucentCommand.renderState=st(this,t,n.renderState),r.alphaCommand.shaderProgram=pt(t,n.shaderProgram),r.alphaCommand.renderState=ht(this,t,n.renderState),r.shaderProgramId=n.shaderProgram.id)),r},b.prototype.executeCommands=function(n,t,i,r,u){if(this._translucentMRTSupport){bt(this,n,t,i,r,u);return}wt(this,n,t,i,r,u)},b.prototype.execute=function(n,t){this._compositeCommand.execute(n,t)},b.prototype.clear=function(n,i,r){var f=i.framebuffer,u;i.framebuffer=this._opaqueFBO;t.clone(r,this._opaqueClearCommand.color);this._opaqueClearCommand.execute(n,i);i.framebuffer=this._translucentFBO;u=this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand;u.execute(n,i);this._translucentMultipassSupport&&(i.framebuffer=this._alphaFBO,this._alphaClearCommand.execute(n,i));i.framebuffer=f},b.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return tt(this),i(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy()),i(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy()),i(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy()),r(this)},b});t("Scene/Particle",["../Core/Cartesian2","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties"],function(n,t,i,r,u,f,e){"use strict";function o(i){i=u(i,u.EMPTY_OBJECT);this.mass=u(i.mass,1);this.position=t.clone(u(i.position,t.ZERO));this.velocity=t.clone(u(i.velocity,t.ZERO));this.life=u(i.life,Number.MAX_VALUE);this.image=i.image;this.startColor=r.clone(u(i.startColor,r.WHITE));this.endColor=r.clone(u(i.endColor,r.WHITE));this.startScale=u(i.startScale,1);this.endScale=u(i.endScale,1);this.imageSize=n.clone(u(i.imageSize,h));this._age=0;this._normalizedAge=0;this._billboard=undefined}var h=new n(1,1),s;return e(o.prototype,{age:{get:function(){return this._age}},normalizedAge:{get:function(){return this._normalizedAge}}}),s=new t,o.prototype.update=function(n,i){return t.multiplyByScalar(this.velocity,n,s),t.add(this.position,s,this.position),f(i)&&i(this,n),this._age+=n,this._normalizedAge=this.life===Number.MAX_VALUE?0:this._age/this.life,this._age<=this.life},o});t("Scene/ParticleBurst",["../Core/defaultValue","../Core/defineProperties"],function(n,t){"use strict";function i(t){t=n(t,n.EMPTY_OBJECT);this.time=n(t.time,0);this.minimum=n(t.minimum,0);this.maximum=n(t.maximum,50);this._complete=!1}return t(i.prototype,{complete:{get:function(){return this._complete}}}),i});t("Scene/ParticleEmitter",["../Core/DeveloperError"],function(n){"use strict";function t(){throw new n("This type should not be instantiated directly.  Instead, use BoxEmitter, CircleEmitter, ConeEmitter or SphereEmitter.");}return t.prototype.emit=function(){n.throwInstantiationError()},t});t("Scene/ParticleSystem",["../Core/Cartesian2","../Core/Cartesian3","../Core/Check","../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Event","../Core/JulianDate","../Core/Math","../Core/Matrix4","./BillboardCollection","./CircleEmitter","./Particle"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(n){n=u(n,u.EMPTY_OBJECT);this.show=u(n.show,!0);this.updateCallback=n.updateCallback;this.loop=u(n.loop,!0);this.image=u(n.image,undefined);var t=n.emitter;f(t)||(t=new v(.5));this._emitter=t;this._bursts=n.bursts;this._modelMatrix=l.clone(u(n.modelMatrix,l.IDENTITY));this._emitterModelMatrix=l.clone(u(n.emitterModelMatrix,l.IDENTITY));this._matrixDirty=!0;this._combinedMatrix=new l;this._startColor=r.clone(u(n.color,u(n.startColor,r.WHITE)));this._endColor=r.clone(u(n.color,u(n.endColor,r.WHITE)));this._startScale=u(n.scale,u(n.startScale,1));this._endScale=u(n.scale,u(n.endScale,1));this._emissionRate=u(n.emissionRate,5);this._minimumSpeed=u(n.speed,u(n.minimumSpeed,1));this._maximumSpeed=u(n.speed,u(n.maximumSpeed,1));this._minimumParticleLife=u(n.particleLife,u(n.minimumParticleLife,5));this._maximumParticleLife=u(n.particleLife,u(n.maximumParticleLife,5));this._minimumMass=u(n.mass,u(n.minimumMass,1));this._maximumMass=u(n.mass,u(n.maximumMass,1));this._minimumImageSize=u(n.imageSize,u(n.minimumImageSize,b));this._maximumImageSize=u(n.imageSize,u(n.maximumImageSize,b));this._lifetime=u(n.lifetime,Number.MAX_VALUE);this._billboardCollection=undefined;this._particles=[];this._particlePool=[];this._previousTime=undefined;this._currentTime=0;this._carryOver=0;this._complete=new s;this._isComplete=!1;this._updateParticlePool=!0;this._particleEstimate=0}function d(n){var c=n._emissionRate,l=n._maximumParticleLife,e=0,i=n._bursts,o,t,r,u;if(f(i))for(o=i.length,t=0;t<o;++t)e+=i[t].maximum;var a=n._billboardCollection,v=n.image,s=Math.ceil(c*l+e),p=n._particles,h=n._particlePool,w=Math.max(s-p.length-h.length,0);for(r=0;r<w;++r)u=new y,u._billboard=a.add({image:v}),h.push(u);n._particleEstimate=s}function g(n){var t=n._particlePool.pop();return f(t)||(t=new y),t}function nt(n,t){n._particlePool.push(t)}function tt(n){for(var f,e=n._particles,t=n._particlePool,o=n._billboardCollection,s=e.length,i=t.length,h=n._particleEstimate,u=i-Math.max(h-s-i,0),r=u;r<i;++r)f=t[r],o.remove(f._billboard);t.length=u}function it(n){f(n._billboard)&&(n._billboard.show=!1)}function k(n,t){var i=t._billboard;f(i)||(i=t._billboard=n._billboardCollection.add({image:t.image}));i.width=t.imageSize.x;i.height=t.imageSize.y;i.position=t.position;i.show=!0;var u=c.lerp(t.startColor.red,t.endColor.red,t.normalizedAge),e=c.lerp(t.startColor.green,t.endColor.green,t.normalizedAge),o=c.lerp(t.startColor.blue,t.endColor.blue,t.normalizedAge),s=c.lerp(t.startColor.alpha,t.endColor.alpha,t.normalizedAge);i.color=new r(u,e,o,s);i.scale=c.lerp(t.startScale,t.endScale,t.normalizedAge)}function rt(n,i){i.startColor=r.clone(n._startColor,i.startColor);i.endColor=r.clone(n._endColor,i.endColor);i.startScale=n._startScale;i.endScale=n._endScale;i.image=n.image;i.life=c.randomBetween(n._minimumParticleLife,n._maximumParticleLife);i.mass=c.randomBetween(n._minimumMass,n._maximumMass);i.imageSize.x=c.randomBetween(n._minimumImageSize.x,n._maximumImageSize.x);i.imageSize.y=c.randomBetween(n._minimumImageSize.y,n._maximumImageSize.y);i._normalizedAge=0;i._age=0;var u=c.randomBetween(n._minimumSpeed,n._maximumSpeed);t.multiplyByScalar(i.velocity,u,i.velocity);n._particles.push(i)}function ut(n,t){var e,r,o,u,i,s;if(n._isComplete)return 0;if(t=c.mod(t,n._lifetime),e=t*n._emissionRate,r=Math.floor(e),n._carryOver+=e-r,n._carryOver>1&&(r++,n._carryOver-=1),f(n.bursts))for(o=n.bursts.length,u=0;u<o;u++)i=n.bursts[u],s=n._currentTime,f(i)&&!i._complete&&s>i.time&&(r+=c.randomBetween(i.minimum,i.maximum),i._complete=!0);return r}var b=new n(1,1),w;return e(p.prototype,{emitter:{get:function(){return this._emitter},set:function(n){i.defined("value",n);this._emitter=n}},bursts:{get:function(){return this._bursts},set:function(n){this._bursts=n;this._updateParticlePool=!0}},modelMatrix:{get:function(){return this._modelMatrix},set:function(n){i.defined("value",n);this._matrixDirty=this._matrixDirty||!l.equals(this._modelMatrix,n);l.clone(n,this._modelMatrix)}},emitterModelMatrix:{get:function(){return this._emitterModelMatrix},set:function(n){i.defined("value",n);this._matrixDirty=this._matrixDirty||!l.equals(this._emitterModelMatrix,n);l.clone(n,this._emitterModelMatrix)}},startColor:{get:function(){return this._startColor},set:function(n){i.defined("value",n);r.clone(n,this._startColor)}},endColor:{get:function(){return this._endColor},set:function(n){i.defined("value",n);r.clone(n,this._endColor)}},startScale:{get:function(){return this._startScale},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._startScale=n}},endScale:{get:function(){return this._endScale},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._endScale=n}},emissionRate:{get:function(){return this._emissionRate},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._emissionRate=n;this._updateParticlePool=!0}},minimumSpeed:{get:function(){return this._minimumSpeed},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._minimumSpeed=n}},maximumSpeed:{get:function(){return this._maximumSpeed},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._maximumSpeed=n}},minimumParticleLife:{get:function(){return this._minimumParticleLife},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._minimumParticleLife=n}},maximumParticleLife:{get:function(){return this._maximumParticleLife},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._maximumParticleLife=n;this._updateParticlePool=!0}},minimumMass:{get:function(){return this._minimumMass},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._minimumMass=n}},maximumMass:{get:function(){return this._maximumMass},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._maximumMass=n}},minimumImageSize:{get:function(){return this._minimumImageSize},set:function(n){i.typeOf.object("value",n);i.typeOf.number.greaterThanOrEquals("value.x",n.x,0);i.typeOf.number.greaterThanOrEquals("value.y",n.y,0);this._minimumImageSize=n}},maximumImageSize:{get:function(){return this._maximumImageSize},set:function(n){i.typeOf.object("value",n);i.typeOf.number.greaterThanOrEquals("value.x",n.x,0);i.typeOf.number.greaterThanOrEquals("value.y",n.y,0);this._maximumImageSize=n}},lifetime:{get:function(){return this._lifetime},set:function(n){i.typeOf.number.greaterThanOrEquals("value",n,0);this._lifetime=n}},complete:{get:function(){return this._complete}},isComplete:{get:function(){return this._isComplete}}}),w=new t,p.prototype.update=function(n){var u,s,v,y;if(this.show){f(this._billboardCollection)||(this._billboardCollection=new a);this._updateParticlePool&&(d(this),this._updateParticlePool=!1);u=0;this._previousTime&&(u=h.secondsDifference(n.time,this._previousTime));u<0&&(u=0);for(var e=this._particles,p=this._emitter,b=this.updateCallback,i,o=e.length,r=0;r<o;++r)i=e[r],i.update(u,b)?k(this,i):(it(i),nt(this,i),e[r]=e[o-1],--r,--o);if(e.length=o,s=ut(this,u),s>0&&f(p))for(this._matrixDirty&&(this._combinedMatrix=l.multiply(this.modelMatrix,this.emitterModelMatrix,this._combinedMatrix),this._matrixDirty=!1),v=this._combinedMatrix,r=0;r<s;r++)i=g(this),this._emitter.emit(i),t.add(i.position,i.velocity,w),l.multiplyByPoint(v,w,w),i.position=l.multiplyByPoint(v,i.position,i.position),t.subtract(w,i.position,i.velocity),t.normalize(i.velocity,i.velocity),rt(this,i),k(this,i);if(this._billboardCollection.update(n),this._previousTime=h.clone(n.time,this._previousTime),this._currentTime+=u,this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=c.mod(this._currentTime,this._lifetime),this.bursts)for(y=this.bursts.length,r=0;r<y;r++)this.bursts[r]._complete=!1}else this._isComplete=!0,this._complete.raiseEvent(this);n.frameNumber%120==0&&tt(this)}},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),o(this)},p});t("Widgets/getElement",["../Core/DeveloperError"],function(n){"use strict";function t(t){if(typeof t=="string"){var i=document.getElementById(t);if(i===null)throw new n('Element with id "'+t+'" does not exist in the document.');t=i}return t}return t});t("Scene/PerformanceDisplay",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/getTimestamp","../Widgets/getElement"],function(n,t,i,r,u,f,e){"use strict";function o(i){var c,r,o,s,h;if(i=n(i,n.EMPTY_OBJECT),c=e(i.container),!t(c))throw new u("container is required");this._container=c;r=document.createElement("div");r.className="cesium-performanceDisplay";o=document.createElement("div");o.className="cesium-performanceDisplay-fps";this._fpsText=document.createTextNode("");o.appendChild(this._fpsText);s=document.createElement("div");s.className="cesium-performanceDisplay-ms";this._msText=document.createTextNode("");s.appendChild(this._msText);r.appendChild(s);r.appendChild(o);this._container.appendChild(r);this._lastFpsSampleTime=f();this._lastMsSampleTime=f();this._fpsFrameCount=0;this._msFrameCount=0;this._throttled=!1;h=document.createElement("div");h.className="cesium-performanceDisplay-throttled";this._throttledText=document.createTextNode("");h.appendChild(this._throttledText);r.appendChild(h)}return i(o.prototype,{throttled:{get:function(){return this._throttled},set:function(n){this._throttled!==n&&(this._throttledText.nodeValue=n?"(throttled)":"",this._throttled=n)}}}),o.prototype.update=function(t){var i=f(),s=n(t,!0),r,u,e,o;this._fpsFrameCount++;r=i-this._lastFpsSampleTime;r>1e3&&(u="N/A",s&&(u=this._fpsFrameCount*1e3/r|0),this._fpsText.nodeValue=u+" FPS",this._lastFpsSampleTime=i,this._fpsFrameCount=0);this._msFrameCount++;e=i-this._lastMsSampleTime;e>200&&(o="N/A",s&&(o=(e/this._msFrameCount).toFixed(2)),this._msText.nodeValue=o+" MS",this._lastMsSampleTime=i,this._msFrameCount=0)},o.prototype.destroy=function(){return r(this)},o});t("Scene/PickDepth",["../Core/Cartesian4","../Core/defined","../Core/destroyObject","../Core/PixelFormat","../Renderer/Framebuffer","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/ShaderSource","../Renderer/Texture"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(){this._framebuffer=undefined;this._depthTexture=undefined;this._textureToCopy=undefined;this._copyDepthCommand=undefined;this._useLogDepth=undefined;this._debugPickDepthViewportCommand=undefined}function a(n,i,r,u){if(!t(n._debugPickDepthViewportCommand)||u!==n._useLogDepth){var f=new o({defines:[u?"LOG_DEPTH":""],sources:["uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window = czm_unpackDepth(texture2D(u_texture, v_textureCoordinates));\n    z_window = czm_reverseLogDepth(z_window); \n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    float z_ndc = (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale = pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor = vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});n._debugPickDepthViewportCommand=i.createViewportQuadCommand(f,{uniformMap:{u_texture:function(){return n._depthTexture}},owner:n});n._useLogDepth=u}n._debugPickDepthViewportCommand.execute(i,r)}function c(n){n._depthTexture=n._depthTexture&&!n._depthTexture.isDestroyed()&&n._depthTexture.destroy()}function l(n){n._framebuffer=n._framebuffer&&!n._framebuffer.isDestroyed()&&n._framebuffer.destroy()}function v(n,t,i,u){n._depthTexture=new s({context:t,width:i,height:u,pixelFormat:r.RGBA,pixelDatatype:f.UNSIGNED_BYTE})}function y(n,t,i,r){c(n);l(n);v(n,t,i,r);n._framebuffer=new u({context:t,colorTextures:[n._depthTexture],destroyAttachments:!1})}function p(n,i,r){var f=r.width,e=r.height,u=n._depthTexture,o=!t(u)||u.width!==f||u.height!==e;(!t(n._framebuffer)||o)&&y(n,i,f,e)}function w(n,i,r){if(!t(n._copyDepthCommand))n._copyDepthCommand=i.createViewportQuadCommand("uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor = czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\n}\n",{renderState:e.fromCache(),uniformMap:{u_texture:function(){return n._textureToCopy}},owner:n});n._textureToCopy=r;n._copyDepthCommand.framebuffer=n._framebuffer}h.prototype.executeDebugPickDepth=function(n,t,i){a(this,n,t,i)};h.prototype.update=function(n,t){p(this,n,t);w(this,n,t)};var b=new n,k=new n(1,1/255,1/65025,1/16581375);return h.prototype.getDepth=function(t,i,r){var f=t.readPixels({x:i,y:r,width:1,height:1,framebuffer:this._framebuffer}),u=n.unpack(f,0,b);return n.divideByScalar(u,255,u),n.dot(u,k)},h.prototype.executeCopyDepth=function(n,t){this._copyDepthCommand.execute(n,t)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return c(this),l(this),this._copyDepthCommand.shaderProgram=t(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy(),i(this)},h});t("Scene/PickDepthFramebuffer",["../Core/BoundingRectangle","../Core/Color","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/PixelFormat","../Renderer/Framebuffer","../Renderer/PassState","../Renderer/PixelDatatype","../Renderer/Renderbuffer","../Renderer/RenderbufferFormat","../Renderer/Texture"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function a(){this._depthStencilTexture=undefined;this._framebuffer=undefined;this._passState=undefined}function v(n){n._framebuffer=n._framebuffer&&n._framebuffer.destroy();n._depthStencilTexture=n._depthStencilTexture&&n._depthStencilTexture.destroy()}function y(t,i){var u=i.drawingBufferWidth,h=i.drawingBufferHeight,r;t._depthStencilTexture=new l({context:i,width:u,height:h,pixelFormat:f.DEPTH_STENCIL,pixelDatatype:s.UNSIGNED_INT_24_8});t._framebuffer=new e({context:i,depthStencilTexture:t._depthStencilTexture,destroyAttachments:!1});r=new o(i);r.blendingEnabled=!1;r.scissorTest={enabled:!0,rectangle:new n};r.viewport=new n;t._passState=r}return a.prototype.update=function(n,t,i){var e=i.width,f=i.height,o,u;return r(this._framebuffer)&&e===this._depthStencilTexture.width&&f===this._depthStencilTexture.height||(v(this),y(this,n)),o=this._framebuffer,u=this._passState,u.framebuffer=o,u.viewport.width=e,u.viewport.height=f,u.scissorTest.rectangle.x=t.x,u.scissorTest.rectangle.y=f-t.y,u.scissorTest.rectangle.width=1,u.scissorTest.rectangle.height=1,u},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return v(this),u(this)},a});t("Scene/PickFramebuffer",["../Core/BoundingRectangle","../Core/Color","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Renderer/Framebuffer","../Renderer/PassState","../Renderer/Renderbuffer","../Renderer/RenderbufferFormat","../Renderer/Texture"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(t){var i=new e(t);i.blendingEnabled=!1;i.scissorTest={enabled:!0,rectangle:new n};i.viewport=new n;this._context=t;this._fb=undefined;this._passState=i;this._width=0;this._height=0}c.prototype.begin=function(t,i){var c=this._context,u=i.width,e=i.height;return n.clone(t,this._passState.scissorTest.rectangle),r(this._fb)&&this._width===u&&this._height===e||(this._width=u,this._height=e,this._fb=this._fb&&this._fb.destroy(),this._fb=new f({context:c,colorTextures:[new h({context:c,width:u,height:e})],depthStencilRenderbuffer:new o({context:c,width:u,height:e,format:s.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb),this._passState.viewport.width=u,this._passState.viewport.height=e,this._passState};var l=new t;return c.prototype.end=function(n){for(var e,p,d,o=i(n.width,1),h=i(n.height,1),w=this._context,s=w.readPixels({x:n.x,y:n.y,width:o,height:h,framebuffer:this._fb}),b=Math.max(o,h),g=b*b,c=Math.floor(o*.5),a=Math.floor(h*.5),u=0,f=0,v=0,y=-1,k=0;k<g;++k){if(-c<=u&&u<=c&&-a<=f&&f<=a&&(e=4*((a-f)*o+u+c),l.red=t.byteToFloat(s[e]),l.green=t.byteToFloat(s[e+1]),l.blue=t.byteToFloat(s[e+2]),l.alpha=t.byteToFloat(s[e+3]),p=w.getObjectByPickColor(l),r(p)))return p;(u===f||u<0&&-u===f||u>0&&u===1-f)&&(d=v,v=-y,y=d);u+=v;f+=y}return undefined},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this._fb=this._fb&&this._fb.destroy(),u(this)},c});t("Scene/PostProcessStageSampleMode",[],function(){"use strict";return{NEAREST:0,LINEAR:1}});t("Scene/PostProcessStage",["../Core/BoundingRectangle","../Core/Check","../Core/Color","../Core/combine","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/Math","../Core/PixelFormat","../Core/Resource","../Renderer/PassState","../Renderer/PixelDatatype","../Renderer/RenderState","../Renderer/Sampler","../Renderer/ShaderSource","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../ThirdParty/when","./PostProcessStageSampleMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){"use strict";function rt(r){var c,o;r=f(r,f.EMPTY_OBJECT);var a=r.fragmentShader,s=f(r.textureScale,1),p=f(r.pixelFormat,l.RGBA);if(t.typeOf.string("options.fragmentShader",a),t.typeOf.number.greaterThan("options.textureScale",s,0),t.typeOf.number.lessThanOrEquals("options.textureScale",s,1),!l.isColorFormat(p))throw new h("options.pixelFormat must be a color format.");this._fragmentShader=a;this._uniforms=r.uniforms;this._textureScale=s;this._forcePowerOfTwo=f(r.forcePowerOfTwo,!1);this._sampleMode=f(r.sampleMode,it.NEAREST);this._pixelFormat=p;this._pixelDatatype=f(r.pixelDatatype,y.UNSIGNED_BYTE);this._clearColor=f(r.clearColor,i.BLACK);this._uniformMap=undefined;this._command=undefined;this._colorTexture=undefined;this._depthTexture=undefined;this._idTexture=undefined;this._actualUniforms={};this._dirtyUniforms=[];this._texturesToRelease=[];this._texturesToCreate=[];this._texturePromise=undefined;c=new v;c.scissorTest={enabled:!0,rectangle:e(r.scissorRectangle)?n.clone(r.scissorRectangle):new n};this._passState=c;this._ready=!1;o=r.name;e(o)||(o=u());this._name=o;this._logDepthChanged=undefined;this._useLogDepth=undefined;this._selectedIdTexture=undefined;this._selected=undefined;this._selectedShadow=undefined;this._parentSelected=undefined;this._parentSelectedShadow=undefined;this._combinedSelected=undefined;this._combinedSelectedShadow=undefined;this._selectedLength=0;this._parentSelectedLength=0;this._selectedDirty=!0;this._textureCache=undefined;this._index=undefined;this.enabled=!0;this._enabled=!0}function et(n,t,i){var r=t[i];return(typeof r=="string"||r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof HTMLVideoElement||r instanceof ImageData)&&n._dirtyUniforms.push(i),{get:function(){return t[i]},set:function(r){var o=t[i],u,f;t[i]=r;u=n._actualUniforms;f=u[i];e(f)&&f!==o&&f instanceof k&&!e(n._textureCache.getStageByName(i))&&(n._texturesToRelease.push(f),delete u[i],delete u[i+"Dimensions"]);o instanceof k&&n._texturesToRelease.push(o);typeof r=="string"||r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof HTMLVideoElement||r instanceof ImageData?n._dirtyUniforms.push(i):u[i]=r}}}function ot(n,t){return function(){var i=n._actualUniforms[t];return typeof i=="function"?i():i}}function st(n,t){return function(){var i=n[t]();return e(i)?i.dimensions:undefined}}function ht(n){var t,f;if(!e(n._uniformMap)){var u={},s={},i=n._uniforms,h=n._actualUniforms;for(t in i)i.hasOwnProperty(t)&&(typeof i[t]!="function"?(u[t]=ot(n,t),s[t]=et(n,i,t)):(u[t]=i[t],s[t]=i[t]),h[t]=i[t],f=u[t](),(typeof f=="string"||f instanceof k||f instanceof HTMLImageElement||f instanceof HTMLCanvasElement||f instanceof HTMLVideoElement)&&(u[t+"Dimensions"]=st(u,t)));n._uniforms={};o(n._uniforms,s);n._uniformMap=r(u,{colorTexture:function(){return n._colorTexture},colorTextureDimensions:function(){return n._colorTexture.dimensions},depthTexture:function(){return n._depthTexture},depthTextureDimensions:function(){return n._depthTexture.dimensions},czm_idTexture:function(){return n._idTexture},czm_selectedIdTexture:function(){return n._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/n._selectedIdTexture.width}})}}function ct(n,t){var i,r,u;(!e(n._command)||n._logDepthChanged||n._selectedDirty)&&(i=n._fragmentShader,e(n._selectedIdTexture)&&(r=n._selectedIdTexture.width,i=i.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""),i="#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected = false;\n    vec4 id = texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i = 0; i < "+r+"; ++i) \n    { \n        vec4 selectedId = texture2D(czm_selectedIdTexture, vec2(float(i) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n"+i),u=new b({defines:[n._useLogDepth?"LOG_DEPTH":""],sources:[i]}),n._command=t.createViewportQuadCommand(u,{uniformMap:n._uniformMap,owner:n}))}function lt(n){var u=n._sampleMode,t,i,r;u===it.LINEAR?(t=g.LINEAR,i=d.LINEAR):(t=g.NEAREST,i=d.NEAREST);r=n._sampler;e(r)&&r.minificationFilter===t&&r.magnificationFilter===i||(n._sampler=new w({wrapS:nt.CLAMP_TO_EDGE,wrapT:nt.CLAMP_TO_EDGE,minificationFilter:t,magnificationFilter:i}))}function at(n,t){return function(i){n._texturesToCreate.push({name:t,source:i})}}function vt(n,t){return function(){return n._textureCache.getOutputTexture(t)}}function yt(n,t){for(var s,r,l=n._texturesToRelease,o=l.length,h,v,y,u,p,c,f,w,b,i=0;i<o;++i)s=l[i],s=s&&s.destroy();for(l.length=0,h=n._texturesToCreate,o=h.length,i=0;i<o;++i)v=h[i],r=v.name,y=v.source,n._actualUniforms[r]=new k({context:t,source:y});if(h.length=0,u=n._dirtyUniforms,u.length===0&&!e(n._texturePromise)){n._ready=!0;return}if(u.length!==0&&!e(n._texturePromise)){for(o=u.length,p=n._uniforms,c=[],i=0;i<o;++i)r=u[i],f=p[r],w=n._textureCache.getStageByName(f),e(w)?n._actualUniforms[r]=vt(n,f):typeof f=="string"?(b=new a({url:f}),c.push(b.fetchImage().then(at(n,r)))):n._texturesToCreate.push({name:r,source:f});u.length=0;c.length>0?(n._ready=!1,n._texturePromise=tt.all(c).then(function(){n._ready=!0;n._texturePromise=undefined})):n._ready=!0}}function ut(n){var r,u,i,t;if(e(n._command)&&(n._command.shaderProgram=n._command.shaderProgram&&n._command.shaderProgram.destroy(),n._command=undefined),n._selectedIdTexture=n._selectedIdTexture&&n._selectedIdTexture.destroy(),r=n._textureCache,e(r)){u=n._uniforms;i=n._actualUniforms;for(t in i)i.hasOwnProperty(t)&&i[t]instanceof k&&(e(r.getStageByName(u[t]))||i[t].destroy(),n._dirtyUniforms.push(t))}}function pt(n){var r=e(n._selected)?n._selected.length:0,u=e(n._parentSelected)?n._parentSelected:0,i=n._selected!==n._selectedShadow||r!==n._selectedLength,t;if(i=i||n._parentSelected!==n._parentSelectedShadow||u!==n._parentSelectedLength,n._combinedSelected=e(n._selected)&&e(n._parentSelected)?n._selected.concat(n._parentSelected):e(n._parentSelected)?n._parentSelected:n._selected,!i&&e(n._combinedSelected)){if(!e(n._combinedSelectedShadow))return!0;for(r=n._combinedSelected.length,t=0;t<r;++t)if(n._combinedSelected[t]!==n._combinedSelectedShadow[t])return!0}return i}function wt(n,t){var a,s,o,h,v,c,u,r,f,b,tt,p;if(n._selectedDirty&&(n._selectedIdTexture=n._selectedIdTexture&&n._selectedIdTexture.destroy(),n._selectedIdTexture=undefined,a=n._combinedSelected,e(a))){for(h=0,v=a.length,s=0;s<v;++s)o=a[s],e(o.pickIds)?h+=o.pickIds.length:e(o.pickId)&&++h;if(v===0||h===0){c=new Uint8Array(4);c[0]=255;c[1]=255;c[2]=255;c[3]=255;n._selectedIdTexture=new k({context:t,pixelFormat:l.RGBA,pixelDatatype:y.UNSIGNED_BYTE,source:{arrayBufferView:c,width:1,height:1},sampler:new w({wrapS:nt.CLAMP_TO_EDGE,wrapT:nt.CLAMP_TO_EDGE,minificationFilter:g.NEAREST,magnificationFilter:d.NEAREST})});return}for(r=0,f=new Uint8Array(h*4),s=0;s<v;++s)if(o=a[s],e(o.pickIds))for(b=o.pickIds,tt=b.length,p=0;p<tt;++p)u=b[p].color,f[r]=i.floatToByte(u.red),f[r+1]=i.floatToByte(u.green),f[r+2]=i.floatToByte(u.blue),f[r+3]=i.floatToByte(u.alpha),r+=4;else e(o.pickId)&&(u=o.pickId.color,f[r]=i.floatToByte(u.red),f[r+1]=i.floatToByte(u.green),f[r+2]=i.floatToByte(u.blue),f[r+3]=i.floatToByte(u.alpha),r+=4);n._selectedIdTexture=new k({context:t,pixelFormat:l.RGBA,pixelDatatype:y.UNSIGNED_BYTE,source:{arrayBufferView:f,width:h,height:1},sampler:new w({wrapS:nt.CLAMP_TO_EDGE,wrapT:nt.CLAMP_TO_EDGE,minificationFilter:g.NEAREST,magnificationFilter:d.NEAREST})})}}o(rt.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(e(this._textureCache)){var n=this._textureCache.getFramebuffer(this._name);if(e(n))return n.getColorTexture(0)}return undefined}},selected:{get:function(){return this._selected},set:function(n){this._selected=n}},parentSelected:{get:function(){return this._parentSelected},set:function(n){this._parentSelected=n}}});var ft=/uniform\s+sampler2D\s+depthTexture/g;return rt.prototype._isSupported=function(n){return!ft.test(this._fragmentShader)||n.depthTexture},rt.prototype.update=function(t,i){var f,r,u;(this.enabled===this._enabled||this.enabled||ut(this),this._enabled=this.enabled,this._enabled)&&(this._logDepthChanged=i!==this._useLogDepth,this._useLogDepth=i,this._selectedDirty=pt(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=e(this._selected)?this._selected.length:0,this._parentSelectedLength=e(this._parentSelected)?this._parentSelected.length:0,wt(this,t),ht(this),yt(this,t),ct(this,t),lt(this),this._selectedDirty=!1,this._ready)&&(f=this._textureCache.getFramebuffer(this._name),this._command.framebuffer=f,e(f))&&(r=f.getColorTexture(0),(r.width!==t.drawingBufferWidth||r.height!==t.drawingBufferHeight)&&(u=this._renderState,e(u)&&r.width===u.viewport.width&&r.height===u.viewport.height||(this._renderState=p.fromCache({viewport:new n(0,0,r.width,r.height)}))),this._command.renderState=u)},rt.prototype.execute=function(n,t,i,r){if(e(this._command)&&e(this._command.framebuffer)&&this._ready&&this._enabled){this._colorTexture=t;this._depthTexture=i;this._idTexture=r;w.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);var u=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:undefined;e(u)&&(u.context=n);this._command.execute(n,u)}},rt.prototype.isDestroyed=function(){return!1},rt.prototype.destroy=function(){return ut(this),s(this)},rt});t("Shaders/PostProcessStages/AmbientOcclusionGenerate",[],function(){"use strict";return"uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\nvarying vec2 v_textureCoordinates;\nvec4 clipToEye(vec2 uv, float depth)\n{\nvec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\nvec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\nposEC = posEC / posEC.w;\nreturn posEC;\n}\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\nvec4 posInCameraUp = clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\nvec4 posInCameraDown = clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\nvec4 posInCameraLeft = clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\nvec4 posInCameraRight = clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\nvec3 up = posInCamera.xyz - posInCameraUp.xyz;\nvec3 down = posInCameraDown.xyz - posInCamera.xyz;\nvec3 left = posInCamera.xyz - posInCameraLeft.xyz;\nvec3 right = posInCameraRight.xyz - posInCamera.xyz;\nvec3 DX = length(left) < length(right) ? left : right;\nvec3 DY = length(up) < length(down) ? up : down;\nreturn normalize(cross(DY, DX));\n}\nvoid main(void)\n{\nfloat depth = czm_readDepth(depthTexture, v_textureCoordinates);\nvec4 posInCamera = clipToEye(v_textureCoordinates, depth);\nif (posInCamera.z > frustumLength)\n{\ngl_FragColor = vec4(1.0);\nreturn;\n}\nvec2 pixelSize = 1.0 / czm_viewport.zw;\nfloat depthU = czm_readDepth(depthTexture, v_textureCoordinates- vec2(0.0, pixelSize.y));\nfloat depthD = czm_readDepth(depthTexture, v_textureCoordinates+ vec2(0.0, pixelSize.y));\nfloat depthL = czm_readDepth(depthTexture, v_textureCoordinates- vec2(pixelSize.x, 0.0));\nfloat depthR = czm_readDepth(depthTexture, v_textureCoordinates+ vec2(pixelSize.x, 0.0));\nvec3 normalInCamera = getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\nfloat ao = 0.0;\nvec2 sampleDirection = vec2(1.0, 0.0);\nfloat gapAngle = 90.0 * czm_radiansPerDegree;\nfloat randomVal = texture2D(randomTexture, v_textureCoordinates).x;\nfloat inverseViewportWidth = 1.0 / czm_viewport.z;\nfloat inverseViewportHeight = 1.0 / czm_viewport.w;\nfor (int i = 0; i < 4; i++)\n{\nfloat newGapAngle = gapAngle * (float(i) + randomVal);\nfloat cosVal = cos(newGapAngle);\nfloat sinVal = sin(newGapAngle);\nvec2 rotatedSampleDirection = vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\nfloat localAO = 0.0;\nfloat localStepSize = stepSize;\nfor (int j = 0; j < 6; j++)\n{\nvec2 directionWithStep = vec2(rotatedSampleDirection.x * localStepSize * inverseViewportWidth, rotatedSampleDirection.y * localStepSize * inverseViewportHeight);\nvec2 newCoords = directionWithStep + v_textureCoordinates;\nif(newCoords.x > 1.0 || newCoords.y > 1.0 || newCoords.x < 0.0 || newCoords.y < 0.0)\n{\nbreak;\n}\nfloat stepDepthInfo = czm_readDepth(depthTexture, newCoords);\nvec4 stepPosInCamera = clipToEye(newCoords, stepDepthInfo);\nvec3 diffVec = stepPosInCamera.xyz - posInCamera.xyz;\nfloat len = length(diffVec);\nif (len > lengthCap)\n{\nbreak;\n}\nfloat dotVal = clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\nfloat weight = len / lengthCap;\nweight = 1.0 - weight * weight;\nif (dotVal < bias)\n{\ndotVal = 0.0;\n}\nlocalAO = max(localAO, dotVal * weight);\nlocalStepSize += stepSize;\n}\nao += localAO;\n}\nao /= 4.0;\nao = 1.0 - clamp(ao, 0.0, 1.0);\nao = pow(ao, intensity);\ngl_FragColor = vec4(vec3(ao), 1.0);\n}\n"});t("Shaders/PostProcessStages/AmbientOcclusionModulate",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 color = texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 ao = texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\ngl_FragColor.rgb = ambientOcclusionOnly ? ao : ao * color;\n}\n"});t("Shaders/PostProcessStages/BlackAndWhite",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform float gradations;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\nif (czm_selected()) {\ngl_FragColor = vec4(rgb, 1.0);\nreturn;\n}\n#endif\nfloat luminance = czm_luminance(rgb);\nfloat darkness = luminance * gradations;\ndarkness = (darkness - fract(darkness)) / gradations;\ngl_FragColor = vec4(vec3(darkness), 1.0);\n}\n"});t("Shaders/PostProcessStages/BloomComposite",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool  glowOnly;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec4 bloom = texture2D(bloomTexture, v_textureCoordinates);\nvec4 color = texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor = glowOnly ? bloom : bloom + color;\n}\n"});t("Shaders/PostProcessStages/Brightness",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 target = vec3(0.0);\ngl_FragColor = vec4(mix(target, rgb, brightness), 1.0);\n}\n"});t("Shaders/PostProcessStages/ContrastBias",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 sceneColor = texture2D(colorTexture, v_textureCoordinates).xyz;\nsceneColor = czm_RGBToHSB(sceneColor);\nsceneColor.z += brightness;\nsceneColor = czm_HSBToRGB(sceneColor);\nfloat factor = (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\nsceneColor = factor * (sceneColor - vec3(0.5)) + vec3(0.5);\ngl_FragColor = vec4(sceneColor, 1.0);\n}\n"});t("Shaders/PostProcessStages/DepthOfField",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(vec2 uv, float depth)\n{\nvec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\nvec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\nposInCamera = posInCamera / posInCamera.w;\nreturn posInCamera;\n}\nfloat computeDepthBlur(float depth)\n{\nfloat f;\nif (depth < focalDistance)\n{\nf = (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n}\nelse\n{\nf = (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\nf = pow(f, 0.1);\n}\nf *= f;\nf = clamp(f, 0.0, 1.0);\nreturn pow(f, 0.5);\n}\nvoid main(void)\n{\nfloat depth = czm_readDepth(depthTexture, v_textureCoordinates);\nvec4 posInCamera = toEye(v_textureCoordinates, depth);\nfloat d = computeDepthBlur(-posInCamera.z);\ngl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n"});t("Shaders/PostProcessStages/DepthView",[],function(){"use strict";return"uniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nfloat depth = czm_readDepth(depthTexture, v_textureCoordinates);\ngl_FragColor = vec4(vec3(depth), 1.0);\n}\n"});t("Shaders/PostProcessStages/EdgeDetection",[],function(){"use strict";return"uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nfloat directions[3];\ndirections[0] = -1.0;\ndirections[1] = 0.0;\ndirections[2] = 1.0;\nfloat scalars[3];\nscalars[0] = 3.0;\nscalars[1] = 10.0;\nscalars[2] = 3.0;\nfloat padx = 1.0 / czm_viewport.z;\nfloat pady = 1.0 / czm_viewport.w;\n#ifdef CZM_SELECTED_FEATURE\nbool selected = false;\nfor (int i = 0; i < 3; ++i)\n{\nfloat dir = directions[i];\nselected = selected || czm_selected(vec2(-padx, dir * pady));\nselected = selected || czm_selected(vec2(padx, dir * pady));\nselected = selected || czm_selected(vec2(dir * padx, -pady));\nselected = selected || czm_selected(vec2(dir * padx, pady));\nif (selected)\n{\nbreak;\n}\n}\nif (!selected)\n{\ngl_FragColor = vec4(color.rgb, 0.0);\nreturn;\n}\n#endif\nfloat horizEdge = 0.0;\nfloat vertEdge = 0.0;\nfor (int i = 0; i < 3; ++i)\n{\nfloat dir = directions[i];\nfloat scale = scalars[i];\nhorizEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\nhorizEdge += texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\nvertEdge -= texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\nvertEdge += texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n}\nfloat len = sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\ngl_FragColor = vec4(color.rgb, len > length ? color.a : 0.0);\n}\n"});t("Shaders/PostProcessStages/FXAA",[],function(){"use strict";return"varying vec2 v_textureCoordinates;\nuniform sampler2D colorTexture;\nconst float fxaaQualitySubpix = 0.5;\nconst float fxaaQualityEdgeThreshold = 0.125;\nconst float fxaaQualityEdgeThresholdMin = 0.0833;\nvoid main()\n{\nvec2 fxaaQualityRcpFrame = vec2(1.0) / czm_viewport.zw;\nvec4 color = FxaaPixelShader(\nv_textureCoordinates,\ncolorTexture,\nfxaaQualityRcpFrame,\nfxaaQualitySubpix,\nfxaaQualityEdgeThreshold,\nfxaaQualityEdgeThresholdMin);\nfloat alpha = texture2D(colorTexture, v_textureCoordinates).a;\ngl_FragColor = vec4(color.rgb, alpha);\n}\n"});t("Shaders/PostProcessStages/GaussianBlur1D",[],function(){"use strict";return"#define SAMPLES 8\nuniform float delta;\nuniform float sigma;\nuniform float direction;\nuniform sampler2D colorTexture;\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec2 st = v_textureCoordinates;\nvec2 dir = vec2(1.0 - direction, direction);\n#ifdef USE_STEP_SIZE\nvec2 step = vec2(stepSize / czm_viewport.zw);\n#else\nvec2 step = step;\n#endif\nvec3 g;\ng.x = 1.0 / (sqrt(czm_twoPi) * sigma);\ng.y = exp((-0.5 * delta * delta) / (sigma * sigma));\ng.z = g.y * g.y;\nvec4 result = texture2D(colorTexture, st) * g.x;\nfor (int i = 1; i < SAMPLES; ++i)\n{\ng.xy *= g.yz;\nvec2 offset = float(i) * dir * step;\nresult += texture2D(colorTexture, st - offset) * g.x;\nresult += texture2D(colorTexture, st + offset) * g.x;\n}\ngl_FragColor = result;\n}\n"});t("Shaders/PostProcessStages/LensFlare",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float earthRadius;\nuniform float intensity;\nvarying vec2 v_textureCoordinates;\n#define DISTANCE_TO_SPACE 6500000.0\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\nvec4 positionEC = czm_view * vec4(WC, 1.0);\npositionEC = vec4(positionEC.x + earthRadius , positionEC.y, positionEC.z, 1.0);\nvec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\nreturn czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\nvec2 NDC = texcoord * 2.0 - 1.0;\nvec4 earthPosSC = getNDCFromWC(vec3(0.0), 0.0);\nvec4 earthPosSCEdge = getNDCFromWC(vec3(0.0), earthRadius * 1.5);\nNDC.xy -= earthPosSC.xy;\nfloat X = abs(NDC.x) * sceneSize.x;\nfloat Y = abs(NDC.y) * sceneSize.y;\nreturn clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\nvec2 sceneSize = czm_viewport.zw;\nvec3 color;\nif(isSpace)\n{\ncolor.r = isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\ncolor.g = isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\ncolor.b = isInEarth(texcoord  + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n}\nelse\n{\ncolor.r = texture2D(tex, texcoord + direction * distortion.r).r;\ncolor.g = texture2D(tex, texcoord + direction * distortion.g).g;\ncolor.b = texture2D(tex, texcoord + direction * distortion.b).b;\n}\nreturn vec4(clamp(color, 0.0, 1.0), 0.0);\n}\nvoid main(void)\n{\nvec4 originalColor = texture2D(colorTexture, v_textureCoordinates);\nvec3 rgb = originalColor.rgb;\nbool isSpace = length(czm_viewerPositionWC.xyz) > DISTANCE_TO_SPACE;\nvec4 sunPos = czm_morphTime == 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\nvec4 sunPositionEC = czm_view * sunPos;\nvec4 sunPositionWC = czm_eyeToWindowCoordinates(sunPositionEC);\nsunPos = czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\nif(!isSpace || !((sunPos.x >= -1.1 && sunPos.x <= 1.1) && (sunPos.y >= -1.1 && sunPos.y <= 1.1)))\n{\ngl_FragColor = originalColor;\nreturn;\n}\nvec2 texcoord = -v_textureCoordinates + vec2(1.0);\nvec2 texelSize = 1.0 / czm_viewport.zw;\nvec3 distortionVec = vec3(-texelSize.x * distortion, 0.0, texelSize.x * distortion);\nvec2 ghostVec = (vec2(0.5) - texcoord) * ghostDispersal;\nvec3 direction = normalize(vec3(ghostVec, 0.0));\nvec4 result = vec4(0.0);\nvec4 ghost = vec4(0.0);\nfor (int i = 0; i < 4; ++i)\n{\nvec2 offset = fract(texcoord + ghostVec * float(i));\nghost += textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n}\nresult += ghost;\nvec2 haloVec = normalize(ghostVec) * haloWidth;\nfloat weightForHalo = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\nweightForHalo = pow(1.0 - weightForHalo, 5.0);\nresult += textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\nvec2 dirtTexCoords = (v_textureCoordinates * czm_viewport.zw) / dirtTextureDimensions;\nif (dirtTexCoords.x > 1.0)\n{\ndirtTexCoords.x = mod(floor(dirtTexCoords.x), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n}\nif (dirtTexCoords.y > 1.0)\n{\ndirtTexCoords.y = mod(floor(dirtTexCoords.y), 2.0) == 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n}\nresult += texture2D(dirtTexture, dirtTexCoords);\nfloat camrot = czm_view[0].z + czm_view[1].y;\nfloat cosValue = cos(camrot);\nfloat sinValue = sin(camrot);\nmat3 rotation = mat3(\ncosValue, -sinValue, 0.0,\nsinValue, cosValue, 0.0,\n0.0, 0.0, 1.0\n);\nvec3 st1 = vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\nvec3 st2 = vec3((rotation * st1).xy, 1.0);\nvec3 st3 = st2 * 0.5 + vec3(0.5);\nvec2 lensStarTexcoord = st3.xy;\nfloat weightForLensFlare = length(vec3(sunPos.xy, 0.0));\nfloat oneMinusWeightForLensFlare = max(1.0 - weightForLensFlare, 0.0);\nif (!isSpace)\n{\nresult *= oneMinusWeightForLensFlare * intensity * 0.2;\n}\nelse\n{\nresult *= oneMinusWeightForLensFlare * intensity;\nresult *= texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n}\nresult += texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor = result;\n}\n"});t("Shaders/PostProcessStages/NightVision",[],function(){"use strict";return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nfloat rand(vec2 co)\n{\nreturn fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\nvoid main(void)\n{\nfloat noiseValue = rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\nvec3 rgb = texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 green = vec3(0.0, 1.0, 0.0);\ngl_FragColor = vec4((noiseValue + rgb) * green, 1.0);\n}\n"});t("Shaders/PostProcessStages/Silhouette",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec4 silhouetteColor = texture2D(silhouetteTexture, v_textureCoordinates);\nvec4 color = texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor = mix(color, silhouetteColor, silhouetteColor.a);\n}\n"});t("ThirdParty/Shaders/FXAA3_11",[],function(){"use strict";return"#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\nFxaaFloat4 FxaaPixelShader(\nFxaaFloat2 pos,\nFxaaTex tex,\nFxaaFloat2 fxaaQualityRcpFrame,\nFxaaFloat fxaaQualitySubpix,\nFxaaFloat fxaaQualityEdgeThreshold,\nFxaaFloat fxaaQualityEdgeThresholdMin\n) {\nFxaaFloat2 posM;\nposM.x = pos.x;\nposM.y = pos.y;\nFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat maxSM = max(lumaS, lumaM);\nFxaaFloat minSM = min(lumaS, lumaM);\nFxaaFloat maxESM = max(lumaE, maxSM);\nFxaaFloat minESM = min(lumaE, minSM);\nFxaaFloat maxWN = max(lumaN, lumaW);\nFxaaFloat minWN = min(lumaN, lumaW);\nFxaaFloat rangeMax = max(maxWN, maxESM);\nFxaaFloat rangeMin = min(minWN, minESM);\nFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\nFxaaFloat range = rangeMax - rangeMin;\nFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\nFxaaBool earlyExit = range < rangeMaxClamped;\nif(earlyExit)\nreturn rgbyM;\nFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNS = lumaN + lumaS;\nFxaaFloat lumaWE = lumaW + lumaE;\nFxaaFloat subpixRcpRange = 1.0/range;\nFxaaFloat subpixNSWE = lumaNS + lumaWE;\nFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\nFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\nFxaaFloat lumaNESE = lumaNE + lumaSE;\nFxaaFloat lumaNWNE = lumaNW + lumaNE;\nFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\nFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\nFxaaFloat lumaNWSW = lumaNW + lumaSW;\nFxaaFloat lumaSWSE = lumaSW + lumaSE;\nFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\nFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\nFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\nFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\nFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\nFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\nFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\nFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\nFxaaBool horzSpan = edgeHorz >= edgeVert;\nFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\nif(!horzSpan) lumaN = lumaW;\nif(!horzSpan) lumaS = lumaE;\nif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\nFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\nFxaaFloat gradientN = lumaN - lumaM;\nFxaaFloat gradientS = lumaS - lumaM;\nFxaaFloat lumaNN = lumaN + lumaM;\nFxaaFloat lumaSS = lumaS + lumaM;\nFxaaBool pairN = abs(gradientN) >= abs(gradientS);\nFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\nif(pairN) lengthSign = -lengthSign;\nFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\nFxaaFloat2 posB;\nposB.x = posM.x;\nposB.y = posM.y;\nFxaaFloat2 offNP;\noffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\noffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\nif(!horzSpan) posB.x += lengthSign * 0.5;\nif( horzSpan) posB.y += lengthSign * 0.5;\nFxaaFloat2 posN;\nposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\nposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\nFxaaFloat2 posP;\nposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\nposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\nFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\nFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\nFxaaFloat subpixE = subpixC * subpixC;\nFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\nif(!pairN) lumaNN = lumaSS;\nFxaaFloat gradientScaled = gradient * 1.0/4.0;\nFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\nFxaaFloat subpixF = subpixD * subpixE;\nFxaaBool lumaMLTZero = lumaMM < 0.0;\nlumaEndN -= lumaNN * 0.5;\nlumaEndP -= lumaNN * 0.5;\nFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\nFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\nFxaaBool doneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\ndoneN = abs(lumaEndN) >= gradientScaled;\ndoneP = abs(lumaEndP) >= gradientScaled;\nif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\nif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\ndoneNP = (!doneN) || (!doneP);\nif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\nif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\nFxaaFloat dstN = posM.x - posN.x;\nFxaaFloat dstP = posP.x - posM.x;\nif(!horzSpan) dstN = posM.y - posN.y;\nif(!horzSpan) dstP = posP.y - posM.y;\nFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\nFxaaFloat spanLength = (dstP + dstN);\nFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\nFxaaFloat spanLengthRcp = 1.0/spanLength;\nFxaaBool directionN = dstN < dstP;\nFxaaFloat dst = min(dstN, dstP);\nFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\nFxaaFloat subpixG = subpixF * subpixF;\nFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\nFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\nFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\nFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\nif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\nif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\nreturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n"});t("Scene/PostProcessStageComposite",["../Core/Check","../Core/createGuid","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject"],function(n,t,i,r,u,f){"use strict";function e(u){u=i(u,i.EMPTY_OBJECT);n.defined("options.stages",u.stages);n.typeOf.number.greaterThan("options.stages.length",u.stages.length,0);this._stages=u.stages;this._inputPreviousStageTexture=i(u.inputPreviousStageTexture,!0);var f=u.name;r(f)||(f=t());this._name=f;this._uniforms=u.uniforms;this._textureCache=undefined;this._index=undefined;this._selected=undefined;this._selectedShadow=undefined;this._parentSelected=undefined;this._parentSelectedShadow=undefined;this._combinedSelected=undefined;this._combinedSelectedShadow=undefined;this._selectedLength=0;this._parentSelectedLength=0;this._selectedDirty=!0}function o(n){var u=r(n._selected)?n._selected.length:0,f=r(n._parentSelected)?n._parentSelected:0,i=n._selected!==n._selectedShadow||u!==n._selectedLength,t;if(i=i||n._parentSelected!==n._parentSelectedShadow||f!==n._parentSelectedLength,n._combinedSelected=r(n._selected)&&r(n._parentSelected)?n._selected.concat(n._parentSelected):r(n._parentSelected)?n._parentSelected:n._selected,!i&&r(n._combinedSelected)){if(!r(n._combinedSelectedShadow))return!0;for(u=n._combinedSelected.length,t=0;t<u;++t)if(n._combinedSelected[t]!==n._combinedSelectedShadow[t])return!0}return i}return u(e.prototype,{ready:{get:function(){for(var t=this._stages,i=t.length,n=0;n<i;++n)if(!t[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(n){for(var i=this._stages,r=i.length,t=0;t<r;++t)i[t].enabled=n}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(n){this._selected=n}},parentSelected:{get:function(){return this._parentSelected},set:function(n){this._parentSelected=n}}}),e.prototype._isSupported=function(n){for(var i=this._stages,r=i.length,t=0;t<r;++t)if(!i[t]._isSupported(n))return!1;return!0},e.prototype.get=function(t){return n.typeOf.number.greaterThanOrEquals("index",t,0),n.typeOf.number.lessThan("index",t,this.length),this._stages[t]},e.prototype.update=function(n,t){var u,e,i,f;for(this._selectedDirty=o(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=r(this._selected)?this._selected.length:0,this._parentSelectedLength=r(this._parentSelected)?this._parentSelected.length:0,u=this._stages,e=u.length,i=0;i<e;++i)f=u[i],this._selectedDirty&&(f.parentSelected=this._combinedSelected),f.update(n,t)},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){for(var t=this._stages,i=t.length,n=0;n<i;++n)t[n].destroy();return f(this)},e});t("Scene/PostProcessStageLibrary",["../Core/buildModuleUrl","../Core/createGuid","../Core/Color","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/Ellipsoid","../Shaders/PostProcessStages/AmbientOcclusionGenerate","../Shaders/PostProcessStages/AmbientOcclusionModulate","../Shaders/PostProcessStages/BlackAndWhite","../Shaders/PostProcessStages/BloomComposite","../Shaders/PostProcessStages/Brightness","../Shaders/PostProcessStages/ContrastBias","../Shaders/PostProcessStages/DepthOfField","../Shaders/PostProcessStages/DepthView","../Shaders/PostProcessStages/EdgeDetection","../Shaders/PostProcessStages/FXAA","../Shaders/PostProcessStages/GaussianBlur1D","../Shaders/PostProcessStages/LensFlare","../Shaders/PostProcessStages/NightVision","../Shaders/PostProcessStages/Silhouette","../ThirdParty/Shaders/FXAA3_11","./PostProcessStage","./PostProcessStageComposite","./PostProcessStageSampleMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut){"use strict";function et(n){var r=1,f=2,e=1,o="#define USE_STEP_SIZE\n"+k,t=new it({name:n+"_x_direction",fragmentShader:o,uniforms:{delta:r,sigma:f,stepSize:e,direction:0},sampleMode:ut.LINEAR}),i=new it({name:n+"_y_direction",fragmentShader:o,uniforms:{delta:r,sigma:f,stepSize:e,direction:1},sampleMode:ut.LINEAR}),s={};return u(s,{delta:{get:function(){return t.uniforms.delta},set:function(n){var r=t.uniforms,u=i.uniforms;r.delta=u.delta=n}},sigma:{get:function(){return t.uniforms.sigma},set:function(n){var r=t.uniforms,u=i.uniforms;r.sigma=u.sigma=n}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(n){var r=t.uniforms,u=i.uniforms;r.stepSize=u.stepSize=n}}}),new rt({name:n,stages:[t,i],uniforms:s})}function st(n){var t,e,o;if(!r(n))return ft.createEdgeDetectionStage();var s=new rt({name:"czm_edge_detection_multiple",stages:n,inputPreviousStageTexture:!1}),i={},u="",f="";for(t=0;t<n.length;++t)u+="uniform sampler2D edgeTexture"+t+"; \n",f+="        vec4 edge"+t+" = texture2D(edgeTexture"+t+", v_textureCoordinates); \n        if (edge"+t+".a > 0.0) \n        { \n            color = edge"+t+"; \n            break; \n        } \n",i["edgeTexture"+t]=n[t].name;return e=u+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color = vec4(0.0); \n    for (int i = 0; i < "+n.length+"; i++) \n    { \n"+f+"    } \n    gl_FragColor = color; \n} \n",o=new it({name:"czm_edge_detection_combine",fragmentShader:e,uniforms:i}),new rt({name:"czm_edge_detection_composite",stages:[s,o]})}var ft={},ot;return ft.createBlurStage=function(){return et("czm_blur")},ft.createDepthOfFieldStage=function(){var n=et("czm_depth_of_field_blur"),t=new it({name:"czm_depth_of_field_composite",fragmentShader:y,uniforms:{focalDistance:5,blurTexture:n.name}}),i={};return u(i,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(n){t.uniforms.focalDistance=n}},delta:{get:function(){return n.uniforms.delta},set:function(t){n.uniforms.delta=t}},sigma:{get:function(){return n.uniforms.sigma},set:function(t){n.uniforms.sigma=t}},stepSize:{get:function(){return n.uniforms.stepSize},set:function(t){n.uniforms.stepSize=t}}}),new rt({name:"czm_depth_of_field",stages:[n,t],inputPreviousStageTexture:!1,uniforms:i})},ft.isDepthOfFieldSupported=function(n){return n.context.depthTexture},ft.createEdgeDetectionStage=function(){var n=t();return new it({name:"czm_edge_detection_"+n,fragmentShader:w,uniforms:{length:.25,color:i.clone(i.BLACK)}})},ft.isEdgeDetectionSupported=function(n){return n.context.depthTexture},ft.createSilhouetteStage=function(n){var t=st(n),i=new it({name:"czm_silhouette_color_edges",fragmentShader:nt,uniforms:{silhouetteTexture:t.name}});return new rt({name:"czm_silhouette",stages:[t,i],inputPreviousStageTexture:!1,uniforms:t.uniforms})},ft.isSilhouetteSupported=function(n){return n.context.depthTexture},ft.createBloomStage=function(){var t=new it({name:"czm_bloom_contrast_bias",fragmentShader:v,uniforms:{contrast:128,brightness:-.3}}),n=et("czm_bloom_blur"),r=new rt({name:"czm_bloom_contrast_bias_blur",stages:[t,n]}),i=new it({name:"czm_bloom_generate_composite",fragmentShader:l,uniforms:{glowOnly:!1,bloomTexture:r.name}}),f={};return u(f,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(n){i.uniforms.glowOnly=n}},contrast:{get:function(){return t.uniforms.contrast},set:function(n){t.uniforms.contrast=n}},brightness:{get:function(){return t.uniforms.brightness},set:function(n){t.uniforms.brightness=n}},delta:{get:function(){return n.uniforms.delta},set:function(t){n.uniforms.delta=t}},sigma:{get:function(){return n.uniforms.sigma},set:function(t){n.uniforms.sigma=t}},stepSize:{get:function(){return n.uniforms.stepSize},set:function(t){n.uniforms.stepSize=t}}}),new rt({name:"czm_bloom",stages:[r,i],inputPreviousStageTexture:!1,uniforms:f})},ft.createAmbientOcclusionStage=function(){var n=new it({name:"czm_ambient_occlusion_generate",fragmentShader:s,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:undefined}}),t=et("czm_ambient_occlusion_blur");t.uniforms.stepSize=.86;var r=new rt({name:"czm_ambient_occlusion_generate_blur",stages:[n,t]}),i=new it({name:"czm_ambient_occlusion_composite",fragmentShader:h,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:r.name}}),f={};return u(f,{intensity:{get:function(){return n.uniforms.intensity},set:function(t){n.uniforms.intensity=t}},bias:{get:function(){return n.uniforms.bias},set:function(t){n.uniforms.bias=t}},lengthCap:{get:function(){return n.uniforms.lengthCap},set:function(t){n.uniforms.lengthCap=t}},stepSize:{get:function(){return n.uniforms.stepSize},set:function(t){n.uniforms.stepSize=t}},frustumLength:{get:function(){return n.uniforms.frustumLength},set:function(t){n.uniforms.frustumLength=t}},randomTexture:{get:function(){return n.uniforms.randomTexture},set:function(t){n.uniforms.randomTexture=t}},delta:{get:function(){return t.uniforms.delta},set:function(n){t.uniforms.delta=n}},sigma:{get:function(){return t.uniforms.sigma},set:function(n){t.uniforms.sigma=n}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(n){t.uniforms.stepSize=n}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(n){i.uniforms.ambientOcclusionOnly=n}}}),new rt({name:"czm_ambient_occlusion",stages:[r,i],inputPreviousStageTexture:!1,uniforms:f})},ft.isAmbientOcclusionSupported=function(n){return n.context.depthTexture},ot="#define FXAA_QUALITY_PRESET 39 \n"+tt+"\n"+b,ft.createFXAAStage=function(){return new it({name:"czm_FXAA",fragmentShader:ot,sampleMode:ut.LINEAR})},ft.createBlackAndWhiteStage=function(){return new it({name:"czm_black_and_white",fragmentShader:c,uniforms:{gradations:5}})},ft.createBrightnessStage=function(){return new it({name:"czm_brightness",fragmentShader:a,uniforms:{brightness:.5}})},ft.createNightVisionStage=function(){return new it({name:"czm_night_vision",fragmentShader:g})},ft.createDepthViewStage=function(){return new it({name:"czm_depth_view",fragmentShader:p})},ft.createLensFlareStage=function(){return new it({name:"czm_lens_flare",fragmentShader:d,uniforms:{dirtTexture:n("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:n("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,earthRadius:o.WGS84.maximumRadius}})},ft});t("Scene/PostProcessStageTextureCache",["../Core/Color","../Core/defined","../Core/Math","../Core/destroyObject","../Renderer/ClearCommand","../Renderer/Framebuffer","../Renderer/Texture"],function(n,t,i,r,u,f,e){"use strict";function o(n){this._collection=n;this._framebuffers=[];this._stageNameToFramebuffer={};this._width=undefined;this._height=undefined;this._updateDependencies=!1}function h(n){while(t(n.length))n=n.get(n.length-1);return n.name}function l(n,i,r,u,f){var s,v,e,c,y,o,l,a;if(!u.enabled||!u._isSupported(i))return f;if(s=r[u.name]={},t(f)&&(v=n.getStageByName(f),s[h(v)]=!0),e=u.uniforms,t(e))for(c=Object.getOwnPropertyNames(e),y=c.length,o=0;o<y;++o)l=e[c[o]],typeof l=="string"&&(a=n.getStageByName(l),t(a)&&(s[h(a)]=!0));return u.name}function s(n,i,r,u,f){var o,c,e,w,b,a;if(t(u.enabled)&&!u.enabled||t(u._isSupported)&&!u._isSupported(i))return f;var y=!t(u.inputPreviousStageTexture)||u.inputPreviousStageTexture,v=f,p=u.length;for(o=0;o<p;++o)c=u.get(o),v=t(c.length)?s(n,i,r,c,f):l(n,i,r,c,f),y&&(f=v);if(!y)for(e=1;e<p;++e)for(w=h(u.get(e)),b=r[w],a=0;a<e;++a)b[h(u.get(a))]=!0;return v}function a(n,i){var r={};if(t(n.ambientOcclusion)){var f=n.ambientOcclusion,e=n.bloom,o=n.fxaa,u=s(n,i,r,f,undefined);u=s(n,i,r,e,u);u=s(n,i,r,n,u);l(n,i,r,o,u)}else s(n,i,r,n,undefined);return r}function v(i,r,u){for(var k=i._collection,e=k.getStageByName(r),c=e._textureScale,l=e._forcePowerOfTwo,a=e._pixelFormat,v=e._pixelDatatype,y=e._clearColor,f,h=i._framebuffers,p=h.length,s,o=0;o<p;++o)if(f=h[o],c===f.textureScale&&l===f.forcePowerOfTwo&&a===f.pixelFormat&&v===f.pixelDatatype&&n.equals(y,f.clearColor)){var w=f.stages,d=w.length,b=!1;for(s=0;s<d;++s)if(u[w[s]]){b=!0;break}if(!b)break}return t(f)&&o<p?(f.stages.push(r),f):(f={textureScale:c,forcePowerOfTwo:l,pixelFormat:a,pixelDatatype:v,clearColor:y,stages:[r],buffer:undefined,clear:undefined},h.push(f),f)}function y(n,t){var r=a(n._collection,t);for(var i in r)r.hasOwnProperty(i)&&(n._stageNameToFramebuffer[i]=v(n,i,r[i]))}function c(n){for(var t,r=n._framebuffers,u=r.length,i=0;i<u;++i)t=r[i],t.buffer=t.buffer&&t.buffer.destroy(),t.buffer=undefined}function p(n,t){for(var v=n._width,y=n._height,l=n._framebuffers,p=l.length,s=0;s<p;++s){var r=l[s],a=r.textureScale,h=Math.ceil(v*a),c=Math.ceil(y*a),o=Math.min(h,c);r.forcePowerOfTwo&&(i.isPowerOfTwo(o)||(o=i.nextPowerOfTwo(o)),h=o,c=o);r.buffer=new f({context:t,colorTextures:[new e({context:t,width:h,height:c,pixelFormat:r.pixelFormat,pixelDatatype:r.pixelDatatype})]});r.clear=new u({color:r.clearColor,framebuffer:r.buffer})}}return o.prototype.updateDependencies=function(){this._updateDependencies=!0},o.prototype.update=function(n){var i=this._collection,r=this._updateDependencies,o=t(i.ambientOcclusion)&&i.ambientOcclusion.enabled&&i.ambientOcclusion._isSupported(n),s=t(i.bloom)&&i.bloom.enabled&&i.bloom._isSupported(n),h=t(i.fxaa)&&i.fxaa.enabled&&i.fxaa._isSupported(n),u=!t(i._activeStages)||i._activeStages.length>0||o||s||h;if((r||!u&&this._framebuffers.length>0)&&(c(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=undefined,this._height=undefined),r||u){this._framebuffers.length===0&&y(this,n);var f=n.drawingBufferWidth,e=n.drawingBufferHeight,l=this._width!==f||this._height!==e;(r||l)&&(this._width=f,this._height=e,this._updateDependencies=!1,c(this),p(this,n))}},o.prototype.clear=function(n){for(var i=this._framebuffers,t=0;t<0;++t)i[t].clear.execute(n)},o.prototype.getStageByName=function(n){return this._collection.getStageByName(n)},o.prototype.getOutputTexture=function(n){return this._collection.getOutputTexture(n)},o.prototype.getFramebuffer=function(n){var i=this._stageNameToFramebuffer[n];return t(i)?i.buffer:undefined},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return c(this),r(this)},o});t("Scene/PostProcessStageCollection",["../Core/arraySlice","../Core/Check","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/PixelFormat","../Renderer/PixelDatatype","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","../Shaders/PostProcessStages/PassThrough","./PostProcessStageLibrary","./PostProcessStageTextureCache"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(){var o=p.createFXAAStage(),t=p.createAmbientOcclusionStage(),f=p.createBloomStage(),n,e,u,c;t.enabled=!1;f.enabled=!1;var s=new w(this),h={},i=g;for(i.push(o,t,f);i.length>0;)if(n=i.pop(),h[n.name]=n,n._textureCache=s,e=n.length,r(e))for(u=0;u<e;++u)i.push(n.get(u));this._stages=[];this._activeStages=[];this._previousActiveStages=[];this._randomTexture=undefined;c=this;t.uniforms.randomTexture=function(){return c._randomTexture};this._ao=t;this._bloom=f;this._fxaa=o;this._lastLength=undefined;this._aoEnabled=undefined;this._bloomEnabled=undefined;this._fxaaEnabled=undefined;this._stagesRemoved=!1;this._textureCacheDirty=!1;this._stageNames=h;this._textureCache=s}function nt(n){var t,f,i;if(n._stagesRemoved){n._stagesRemoved=!1;var r=[],u=n._stages,e=u.length;for(t=0,f=0;t<e;++t)i=u[t],i&&(i._index=f++,r.push(i));n._stages=r}}function d(n){while(r(n.length))n=n.get(n.length-1);return n.outputTexture}function k(n,t,i,u,f){if(r(n.execute)){n.execute(t,i,u,f);return}var o=n.length,e;if(n.inputPreviousStageTexture)for(k(n.get(0),t,i,u,f),e=1;e<o;++e)k(n.get(e),t,d(n.get(e-1)),u,f);else for(e=0;e<o;++e)k(n.get(e),t,i,u,f)}var g=[];return u(b.prototype,{ready:{get:function(){for(var i,n=!1,r=this._stages,o=r.length,t=o-1;t>=0;--t)i=r[t],n=n||i.ready&&i.enabled;var u=this._fxaa,f=this._ao,e=this._bloom;return n=n||u.ready&&u.enabled,n=n||f.ready&&f.enabled,n||e.ready&&e.enabled}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return nt(this),this._stages.length}},outputTexture:{get:function(){var f=this._fxaa,e,o,t,n,i,u;if(f.enabled&&f.ready)return this.getOutputTexture(f.name);for(e=this._stages,o=e.length,t=o-1;t>=0;--t)if(n=e[t],r(n)&&n.ready&&n.enabled)return this.getOutputTexture(n.name);return(i=this._bloom,i.enabled&&i.ready)?this.getOutputTexture(i.name):(u=this._ao,u.enabled&&u.ready)?this.getOutputTexture(u.name):undefined}},hasSelected:{get:function(){for(var u=n(this._stages),t,f,i;u.length>0;){if(t=u.pop(),r(t.selected))return!0;if(f=t.length,r(f))for(i=0;i<f;++i)u.push(t.get(i))}return!1}}}),b.prototype.add=function(n){var o,u,i,s,f,h;for(t.typeOf.object("stage",n),o=this._stageNames,u=g,u.push(n);u.length>0;){if(i=u.pop(),r(o[i.name]))throw new e(i.name+" has already been added to the collection or does not have a unique name.");if(o[i.name]=i,i._textureCache=this._textureCache,s=i.length,r(s))for(f=0;f<s;++f)u.push(i.get(f))}return h=this._stages,n._index=h.length,h.push(n),this._textureCacheDirty=!0,n},b.prototype.remove=function(n){var e,t,i,f,u;if(!this.contains(n))return!1;for(e=this._stageNames,t=g,t.push(n);t.length>0;)if(i=t.pop(),delete e[i.name],f=i.length,r(f))for(u=0;u<f;++u)t.push(i.get(u));return this._stages[n._index]=undefined,this._stagesRemoved=!0,this._textureCacheDirty=!0,n._index=undefined,n._textureCache=undefined,n.destroy(),!0},b.prototype.contains=function(n){return r(n)&&r(n._index)&&n._textureCache===this._textureCache},b.prototype.get=function(n){nt(this);var i=this._stages,r=i.length;return t.typeOf.number.greaterThanOrEquals("stages length",r,0),t.typeOf.number.greaterThanOrEquals("index",n,0),t.typeOf.number.lessThan("index",n,r),i[n]},b.prototype.removeAll=function(){for(var n=this._stages,i=n.length,t=0;t<i;++t)this.remove(n[t]);n.length=0},b.prototype.getStageByName=function(n){return this._stageNames[n]},b.prototype.update=function(n,t){var p,e,b,it;nt(this);p=this._activeStages;e=this._activeStages=this._previousActiveStages;this._previousActiveStages=p;for(var w=this._stages,u=e.length=w.length,y,f=0,i=0;i<u;++i)y=w[i],y.ready&&y.enabled&&y._isSupported(n)&&(e[f++]=y);if(e.length=f,b=f!==p.length,!b)for(i=0;i<f;++i)if(e[i]!==p[i]){b=!0;break}var d=this._ao,g=this._bloom,tt=this._fxaa,k=d.enabled&&d._isSupported(n),rt=g.enabled&&g._isSupported(n),ut=tt.enabled&&tt._isSupported(n);if((b||this._textureCacheDirty||f!==this._lastLength||k!==this._aoEnabled||rt!==this._bloomEnabled||ut!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._lastLength=f,this._aoEnabled=k,this._bloomEnabled=rt,this._fxaaEnabled=ut,this._textureCacheDirty=!1),r(this._randomTexture)&&!k&&(this._randomTexture.destroy(),this._randomTexture=undefined),!r(this._randomTexture)&&k){for(u=196608,it=new Uint8Array(u),i=0;i<u;i+=3)it[i]=Math.floor(Math.random()*255);this._randomTexture=new c({context:n,pixelFormat:o.RGB,pixelDatatype:s.UNSIGNED_BYTE,source:{arrayBufferView:it,width:256,height:256},sampler:new h({wrapS:v.REPEAT,wrapT:v.REPEAT,minificationFilter:a.NEAREST,magnificationFilter:l.NEAREST})})}for(this._textureCache.update(n),tt.update(n,t),d.update(n,t),g.update(n,t),u=w.length,i=0;i<u;++i)w[i].update(n,t)},b.prototype.clear=function(n){this._textureCache.clear(n)},b.prototype.getOutputTexture=function(n){var t=this.getStageByName(n);return r(t)?d(t):undefined},b.prototype.execute=function(n,t,i,r){var f=this._activeStages,h=f.length,c=this._fxaa,e=this._ao,o=this._bloom,a=e.enabled&&e._isSupported(n),v=o.enabled&&o._isSupported(n),y=c.enabled&&c._isSupported(n),u,l,s;if(y||a||v||h!==0){if(u=t,a&&e.ready&&(k(e,n,u,i,r),u=d(e)),v&&o.ready&&(k(o,n,u,i,r),u=d(o)),l=u,h>0){for(k(f[0],n,u,i,r),s=1;s<h;++s)k(f[s],n,d(f[s-1]),i,r);l=d(f[h-1])}y&&c.ready&&k(c,n,l,i,r)}},b.prototype.copy=function(n,t){if(!r(this._copyColorCommand)){var i=this;this._copyColorCommand=n.createViewportQuadCommand(y,{uniformMap:{colorTexture:function(){return i.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t;this._copyColorCommand.execute(n)},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),f(this)},b});t("Scene/QuadtreeTileProvider",["../Core/defineProperties","../Core/DeveloperError"],function(n,t){"use strict";function i(){t.throwInstantiationError()}return i.computeDefaultLevelZeroMaximumGeometricError=function(n){return n.ellipsoid.maximumRadius*2*Math.PI*.25/(65*n.getNumberOfXTilesAtLevel(0))},n(i.prototype,{quadtree:{get:t.throwInstantiationError,set:t.throwInstantiationError},ready:{get:t.throwInstantiationError},tilingScheme:{get:t.throwInstantiationError},errorEvent:{get:t.throwInstantiationError}}),i.prototype.update=t.throwInstantiationError,i.prototype.beginUpdate=t.throwInstantiationError,i.prototype.endUpdate=t.throwInstantiationError,i.prototype.getLevelMaximumGeometricError=t.throwInstantiationError,i.prototype.loadTile=t.throwInstantiationError,i.prototype.computeTileVisibility=t.throwInstantiationError,i.prototype.showTileThisFrame=t.throwInstantiationError,i.prototype.computeDistanceToTile=t.throwInstantiationError,i.prototype.isDestroyed=t.throwInstantiationError,i.prototype.destroy=t.throwInstantiationError,i});t("Scene/SceneTransitioner",["../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/defined","../Core/destroyObject","../Core/EasingFunction","../Core/Math","../Core/Matrix4","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Core/PerspectiveFrustum","../Core/Ray","../Core/ScreenSpaceEventHandler","../Core/ScreenSpaceEventType","../Core/Transforms","./Camera","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function k(n){i.typeOf.object("scene",n);this._scene=n;this._currentTweens=[];this._morphHandler=undefined;this._morphCancelled=!1;this._completeMorph=undefined;this._morphToOrthographic=!1}function d(n,t){if(n._scene.completeMorphOnUserInput){n._morphHandler=new a(n._scene.canvas,!1);var i=function(){n._morphCancelled=!0;n._scene.camera.cancelFlight();t(n)};n._completeMorph=i;n._morphHandler.setInputAction(i,v.LEFT_DOWN);n._morphHandler.setInputAction(i,v.MIDDLE_DOWN);n._morphHandler.setInputAction(i,v.RIGHT_DOWN);n._morphHandler.setInputAction(i,v.WHEEL)}}function nt(n){for(var i=n._currentTweens,t=0;t<i.length;++t)i[t].cancelTween();n._currentTweens.length=0;n._morphHandler=n._morphHandler&&n._morphHandler.destroy()}function ft(n,t){var f=n._scene,r=f.camera,i=g,e=i.position,h=i.direction,c=i.up,l=f.mapProjection.unproject(r.position,hi),s,u;return t.cartographicToCartesian(l,e),s=t.scaleToGeodeticSurface(e,ci),u=y.eastNorthUpToFixedFrame(s,t,li),o.multiplyByPointAsVector(u,r.direction,h),o.multiplyByPointAsVector(u,r.up,c),i}function it(t,i,r,u){function k(t){b(c,v,t.time,e.position);b(l,y,t.time,e.direction);b(a,w,t.time,e.up);n.cross(e.direction,e.up,e.right);n.normalize(e.right,e.right)}var h;i*=.5;var s=t._scene,e=s.camera,c=n.clone(e.position,ai),l=n.clone(e.direction,vi),a=n.clone(e.up,yi),v=o.multiplyByPoint(p.TRANSFORM_2D_INVERSE,r.position,pi),y=o.multiplyByPointAsVector(p.TRANSFORM_2D_INVERSE,r.direction,wi),w=o.multiplyByPointAsVector(p.TRANSFORM_2D_INVERSE,r.up,bi);h=s.tweens.add({duration:i,easingFunction:f.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:k,complete:function(){pt(t,s,0,1,i,u)}});t._currentTweens.push(h)}function di(t,i,r){var f,o,u,s,h,c;i/=3;f=t._scene;o=f.camera;i>0?(u=g,n.fromDegrees(0,0,5*r.maximumRadius,r,u.position),n.negate(u.position,u.direction),n.normalize(u.direction,u.direction),n.clone(n.UNIT_Z,u.up)):(o.position.z=o.frustum.right-o.frustum.left,u=ft(t,r));t._morphToOrthographic?(s=ki,s.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight,s.width=o.frustum.right-o.frustum.left):(s=tt,s.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight,s.fov=e.toRadians(60));u.frustum=s;h=wt(u);d(t,h);c=t._morphToOrthographic?function(){it(t,i,u,h)}:function(){vt(t,i,u,function(){it(t,i,u,h)})};i>0?(f._mode=w.SCENE2D,o.flyTo({duration:i,destination:n.fromDegrees(0,0,5*r.maximumRadius,r,rt),complete:function(){f._mode=w.MORPHING;c()}})):c()}function b(t,i,r,u){return n.lerp(t,i,r,u)}function lt(n,t,i,r,u){function y(n){o.frustum.fov=e.lerp(c,l,n.time);var t=a/Math.tan(o.frustum.fov*.5);r(o,t)}var h=n._scene,o=h.camera,v;if(!(o.frustum instanceof s)){var c=o.frustum.fov,l=e.RADIANS_PER_DEGREE*.5,a=i.position.z*Math.tan(c*.5);o.frustum.far=a/Math.tan(l*.5)+1e7;v=h.tweens.add({duration:t,easingFunction:f.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:y,complete:function(){o.frustum=i.frustum.clone();u(n)}});n._currentTweens.push(v)}}function sr(t,i){function rt(t){b(l,h,t.time,u.position);b(k,g,t.time,u.direction);b(it,nt,t.time,u.up);n.cross(u.direction,u.up,u.right);n.normalize(u.right,u.right);u._adjustOrthographicFrustum(!0)}function ft(n,t){n.position.z=t}var a,v,y,e,c,w,tt;i*=.5;var s=t._scene,u=s.camera,l=n.clone(u.position,gi),k=n.clone(u.direction,nr),it=n.clone(u.up,tr),g=n.negate(n.UNIT_Z,ir),nt=n.clone(n.UNIT_Y,rr),h=ut;i>0?(n.clone(n.ZERO,ut),h.z=5*s.mapProjection.ellipsoid.maximumRadius):(n.clone(l,ut),a=fr,o.multiplyByPoint(p.TRANSFORM_2D,l,a.origin),o.multiplyByPointAsVector(p.TRANSFORM_2D,k,a.direction),v=s.globe,r(v)&&(y=v.pickWorldCoordinates(a,s,er),r(y)&&(o.multiplyByPoint(p.TRANSFORM_2D_INVERSE,y,h),h.z+=n.distance(l,h))));e=ur;e.right=h.z*.5;e.left=-e.right;e.top=e.right*(s.drawingBufferHeight/s.drawingBufferWidth);e.bottom=-e.top;c=or;c.position=h;c.direction=g;c.up=nt;c.frustum=e;w=bt(c);d(t,w);tt=s.tweens.add({duration:i,easingFunction:f.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:rt,complete:function(){lt(t,i,c,ft,w)}});t._currentTweens.push(tt)}function pr(t,i,u){function tt(n,t){n.position.x=t}function it(){lt(t,i,f,tt,k)}var l,b,c,g,e,h,k;i*=.5;var s=t._scene,v=s.camera,f=hr;if(i>0)n.clone(n.ZERO,f.position),f.position.z=5*u.maximumRadius,n.negate(n.UNIT_Z,f.direction),n.clone(n.UNIT_Y,f.up);else{u.cartesianToCartographic(v.positionWC,at);s.mapProjection.project(at,f.position);n.negate(n.UNIT_Z,f.direction);n.clone(n.UNIT_Y,f.up);l=ar;n.clone(f.position2D,l.origin);var a=n.clone(v.directionWC,l.direction),nt=u.scaleToGeodeticSurface(v.positionWC,yr),w=y.eastNorthUpToFixedFrame(nt,u,vr);o.inverseTransformation(w,w);o.multiplyByPointAsVector(w,a,a);o.multiplyByPointAsVector(p.TRANSFORM_2D,a,a);b=s.globe;r(b)&&(c=b.pickWorldCoordinates(l,s,lr),r(c)&&(g=n.distance(f.position2D,c),c.x+=g,n.clone(c,f.position2D)))}o.multiplyByPoint(p.TRANSFORM_2D,f.position,f.position2D);o.multiplyByPointAsVector(p.TRANSFORM_2D,f.direction,f.direction2D);o.multiplyByPointAsVector(p.TRANSFORM_2D,f.up,f.up2D);e=f.frustum;e.right=f.position.z*.5;e.left=-e.right;e.top=e.right*(s.drawingBufferHeight/s.drawingBufferWidth);e.bottom=-e.top;h=cr;o.multiplyByPoint(p.TRANSFORM_2D_INVERSE,f.position2D,h.position);n.clone(f.direction,h.direction);n.clone(f.up,h.up);h.frustum=e;k=bt(h);d(t,k);yt(t,i,f,it)}function vt(n,t,i,r){function v(n){u.frustum.fov=e.lerp(o,h,n.time);u.position.z=c/Math.tan(u.frustum.fov*.5)}var s=n._scene,u=s.camera,a=u.frustum.right-u.frustum.left,l;u.frustum=i.frustum.clone();var h=u.frustum.fov,o=e.RADIANS_PER_DEGREE*.5,c=a*Math.tan(h*.5);u.frustum.far=c/Math.tan(o*.5)+1e7;u.frustum.fov=o;l=s.tweens.add({duration:t,easingFunction:f.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:v,complete:function(){r(n)}});n._currentTweens.push(l)}function wr(t,i,r,u){function h(){function p(t){b(h,s,t.time,e.position);b(v,c,t.time,e.direction);b(y,l,t.time,e.up);n.cross(e.direction,e.up,e.right);n.normalize(e.right,e.right)}var a;e.frustum=r.frustum.clone();var h=n.clone(e.position,et),v=n.clone(e.direction,ot),y=n.clone(e.up,st);h.z=s.z;a=o.tweens.add({duration:i,easingFunction:f.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){u(t)}});t._currentTweens.push(a)}i*=.5;var o=t._scene,e=o.camera,s=n.clone(r.position,rt),c=n.clone(r.direction,ht),l=n.clone(r.up,ct);o._mode=w.MORPHING;t._morphToOrthographic?h():vt(t,0,r,h)}function yt(t,i,r,u){function y(t){b(s,l,t.time,e.position);b(h,a,t.time,e.direction);b(c,v,t.time,e.up);n.cross(e.direction,e.up,e.right);n.normalize(e.right,e.right);e._adjustOrthographicFrustum(!0)}var o=t._scene,e=o.camera,s=n.clone(e.position,et),h=n.clone(e.direction,ot),c=n.clone(e.up,st),l=n.clone(r.position2D,rt),a=n.clone(r.direction2D,ht),v=n.clone(r.up2D,ct),p=o.tweens.add({duration:i,easingFunction:f.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:y,complete:function(){pt(t,o,1,0,i,u)}});t._currentTweens.push(p)}function pt(n,t,i,u,e,o){var s={object:t,property:"morphTime",startValue:i,stopValue:u,duration:e,easingFunction:f.QUARTIC_OUT},h;r(o)&&(s.complete=function(){o(n)});h=t.tweens.addProperty(s);n._currentTweens.push(h)}function wt(t){return function(i){var f=i._scene,u,e,o;f._mode=w.SCENE3D;f.morphTime=w.getMorphTime(w.SCENE3D);nt(i);u=f.camera;(i._previousMode!==w.MORPHING||i._morphCancelled)&&(i._morphCancelled=!1,n.clone(t.position,u.position),n.clone(t.direction,u.direction),n.clone(t.up,u.up),n.cross(u.direction,u.up,u.right),n.normalize(u.right,u.right),u.frustum=t.frustum.clone());e=u.frustum;f.frameState.useLogDepth&&(e.near=.1,e.far=1e10);o=r(i._completeMorph);i._completeMorph=undefined;f.camera.update(f.mode);i._scene.morphComplete.raiseEvent(i,i._previousMode,w.SCENE3D,o)}}function bt(t){return function(i){var f=i._scene,u,e;f._mode=w.SCENE2D;f.morphTime=w.getMorphTime(w.SCENE2D);nt(i);u=f.camera;n.clone(t.position,u.position);u.position.z=f.mapProjection.ellipsoid.maximumRadius*2;n.clone(t.direction,u.direction);n.clone(t.up,u.up);n.cross(u.direction,u.up,u.right);n.normalize(u.right,u.right);u.frustum=t.frustum.clone();e=r(i._completeMorph);i._completeMorph=undefined;f.camera.update(f.mode);i._scene.morphComplete.raiseEvent(i,i._previousMode,w.SCENE2D,e)}}function br(t){return function(i){var f=i._scene,u,e,o;f._mode=w.COLUMBUS_VIEW;f.morphTime=w.getMorphTime(w.COLUMBUS_VIEW);nt(i);u=f.camera;(i._previousModeMode!==w.MORPHING||i._morphCancelled)&&(i._morphCancelled=!1,n.clone(t.position,u.position),n.clone(t.direction,u.direction),n.clone(t.up,u.up),n.cross(u.direction,u.up,u.right),n.normalize(u.right,u.right));e=u.frustum;f.frameState.useLogDepth&&(e.near=.1,e.far=1e10);o=r(i._completeMorph);i._completeMorph=undefined;f.camera.update(f.mode);i._scene.morphComplete.raiseEvent(i,i._previousMode,w.COLUMBUS_VIEW,o)}}var g,tt;k.prototype.completeMorph=function(){r(this._completeMorph)&&this._completeMorph()};k.prototype.morphTo2D=function(n,t){r(this._completeMorph)&&this._completeMorph();var i=this._scene;(this._previousMode=i.mode,this._morphToOrthographic=i.camera.frustum instanceof s,this._previousMode!==w.SCENE2D&&this._previousMode!==w.MORPHING)&&(this._scene.morphStart.raiseEvent(this,this._previousMode,w.SCENE2D,!0),i._mode=w.MORPHING,i.camera._setTransform(o.IDENTITY),this._previousMode===w.COLUMBUS_VIEW?sr(this,n):pr(this,n,t),n===0&&r(this._completeMorph)&&this._completeMorph())};var kt=new n,dt=new n,gt=new n,ni=new n,ti=new n,ii=new n,ri=new n,ui=new t,fi=new o,ei=new c,oi=new s,si={position:undefined,direction:undefined,up:undefined,position2D:undefined,direction2D:undefined,up2D:undefined,frustum:undefined};k.prototype.morphToColumbusView=function(t,i){var f,l,k,v,a,s,b;if(r(this._completeMorph)&&this._completeMorph(),f=this._scene,this._previousMode=f.mode,this._previousMode!==w.COLUMBUS_VIEW&&this._previousMode!==w.MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,w.COLUMBUS_VIEW,!0);f.camera._setTransform(o.IDENTITY);var u=kt,h=dt,c=gt;t>0?(u.x=0,u.y=-1,u.z=1,u=n.multiplyByScalar(n.normalize(u,u),5*i.maximumRadius,u),n.negate(n.normalize(u,h),h),n.cross(n.UNIT_X,h,c)):(l=f.camera,this._previousMode===w.SCENE2D?(n.clone(l.position,u),u.z=l.frustum.right-l.frustum.left,n.negate(n.UNIT_Z,h),n.clone(n.UNIT_Y,c)):(n.clone(l.positionWC,u),n.clone(l.directionWC,h),n.clone(l.upWC,c),k=i.scaleToGeodeticSurface(u,ri),v=y.eastNorthUpToFixedFrame(k,i,fi),o.inverseTransformation(v,v),f.mapProjection.project(i.cartesianToCartographic(u,ui),u),o.multiplyByPointAsVector(v,h,h),o.multiplyByPointAsVector(v,c,c)));this._morphToOrthographic?(a=oi,a.width=f.camera.frustum.right-f.camera.frustum.left,a.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight):(a=ei,a.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight,a.fov=e.toRadians(60));s=si;s.position=u;s.direction=h;s.up=c;s.frustum=a;b=br(s);d(this,b);this._previousMode===w.SCENE2D?wr(this,t,s,b):(s.position2D=o.multiplyByPoint(p.TRANSFORM_2D,u,ni),s.direction2D=o.multiplyByPointAsVector(p.TRANSFORM_2D,h,ti),s.up2D=o.multiplyByPointAsVector(p.TRANSFORM_2D,c,ii),f._mode=w.MORPHING,yt(this,t,s,b));t===0&&r(this._completeMorph)&&this._completeMorph()}};g={position:new n,direction:new n,up:new n,frustum:undefined};tt=new c;k.prototype.morphTo3D=function(t,i){var f,u,h,c,l;(r(this._completeMorph)&&this._completeMorph(),f=this._scene,this._previousMode=f.mode,this._previousMode!==w.SCENE3D&&this._previousMode!==w.MORPHING)&&(this._scene.morphStart.raiseEvent(this,this._previousMode,w.SCENE3D,!0),f._mode=w.MORPHING,f.camera._setTransform(o.IDENTITY),this._previousMode===w.SCENE2D?di(this,t,i):(t>0?(u=g,n.fromDegrees(0,0,5*i.maximumRadius,i,u.position),n.negate(u.position,u.direction),n.normalize(u.direction,u.direction),n.clone(n.UNIT_Z,u.up)):u=ft(this,i),c=f.camera,c.frustum instanceof s?h=c.frustum.clone():(h=tt,h.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight,h.fov=e.toRadians(60)),u.frustum=h,l=wt(u),d(this,l),it(this,t,u,l)),t===0&&r(this._completeMorph)&&this._completeMorph())};k.prototype.isDestroyed=function(){return!1};k.prototype.destroy=function(){return nt(this),u(this)};var hi=new t,ci=new n,li=new o;var ai=new n,vi=new n,yi=new n,pi=new n,wi=new n,bi=new n;var ki=new s,et=new n,ot=new n,st=new n,rt=new n,ht=new n,ct=new n;var gi=new n,nr=new n,tr=new n,ut=new n,ir=new n,rr=new n,ur=new h,fr=new l,er=new n,or={position:undefined,direction:undefined,up:undefined,frustum:undefined};var at=new t,hr={position:new n,direction:new n,up:new n,position2D:new n,direction2D:new n,up2D:new n,frustum:new h},cr={position:new n,direction:new n,up:new n,frustum:undefined},lr=new n,ar=new l,vr=new o,yr=new n;return k});t("Scene/TweenCollection",["../Core/clone","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/EasingFunction","../Core/getTimestamp","../Core/TimeConstants","../ThirdParty/Tween"],function(n,t,i,r,u,f,e,o,s){"use strict";function c(t,i,r,u,f,e,o,s,h,c){this._tweens=t;this._tweenjs=i;this._startObject=n(r);this._stopObject=n(u);this._duration=f;this._delay=e;this._easingFunction=o;this._update=s;this._complete=h;this.cancel=c;this.needsStart=!0}function h(){this._tweens=[]}return r(c.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}}),c.prototype.cancelTween=function(){this._tweens.remove(this)},r(h.prototype,{length:{get:function(){return this._tweens.length}}}),h.prototype.add=function(r){var h;if(r=t(r,t.EMPTY_OBJECT),!i(r.startObject)||!i(r.stopObject))throw new u("options.startObject and options.stopObject are required.");if(!i(r.duration)||r.duration<0)throw new u("options.duration is required and must be positive.");if(r.duration===0)return i(r.complete)&&r.complete(),new c(this);var y=r.duration/o.SECONDS_PER_MILLISECOND,l=t(r.delay,0),p=l/o.SECONDS_PER_MILLISECOND,a=t(r.easingFunction,f.LINEAR_NONE),v=r.startObject,e=new s.Tween(v);if(e.to(n(r.stopObject),y),e.delay(p),e.easing(a),i(r.update))e.onUpdate(function(){r.update(v)});e.onComplete(t(r.complete,null));return e.repeat(t(r._repeat,0)),h=new c(this,e,r.startObject,r.stopObject,r.duration,l,a,r.update,r.complete,r.cancel),this._tweens.push(h),h},h.prototype.addProperty=function(n){function s(n){r[f]=n.value}n=t(n,t.EMPTY_OBJECT);var r=n.object,f=n.property,e=n.startValue,o=n.stopValue;if(!i(r)||!i(n.property))throw new u("options.object and options.property are required.");if(!i(r[f]))throw new u("options.object must have the specified property.");if(!i(e)||!i(o))throw new u("options.startValue and options.stopValue are required.");return this.add({startObject:{value:e},stopObject:{value:o},duration:t(n.duration,3),delay:n.delay,easingFunction:n.easingFunction,update:s,complete:n.complete,cancel:n.cancel,_repeat:n._repeat})},h.prototype.addAlpha=function(n){function o(n){for(var i=f.length,t=0;t<i;++t)r.uniforms[f[t]].alpha=n.alpha}var r,f,e;if(n=t(n,t.EMPTY_OBJECT),r=n.material,!i(r))throw new u("options.material is required.");f=[];for(e in r.uniforms)r.uniforms.hasOwnProperty(e)&&i(r.uniforms[e])&&i(r.uniforms[e].alpha)&&f.push(e);if(f.length===0)throw new u("material has no properties with alpha components.");return this.add({startObject:{alpha:t(n.startValue,0)},stopObject:{alpha:t(n.stopValue,1)},duration:t(n.duration,3),delay:n.delay,easingFunction:n.easingFunction,update:o,complete:n.complete,cancel:n.cancel})},h.prototype.addOffsetIncrement=function(n){var r,f;if(n=t(n,t.EMPTY_OBJECT),r=n.material,!i(r))throw new u("material is required.");if(!i(r.uniforms.offset))throw new u("material.uniforms must have an offset property.");return f=r.uniforms,this.addProperty({object:f,property:"offset",startValue:f.offset,stopValue:f.offset+1,duration:n.duration,delay:n.delay,easingFunction:n.easingFunction,update:n.update,cancel:n.cancel,_repeat:Infinity})},h.prototype.remove=function(n){if(!i(n))return!1;var t=this._tweens.indexOf(n);return t!==-1?(n.tweenjs.stop(),i(n.cancel)&&n.cancel(),this._tweens.splice(t,1),!0):!1},h.prototype.removeAll=function(){for(var n,t=this._tweens,r=0;r<t.length;++r)n=t[r],n.tweenjs.stop(),i(n.cancel)&&n.cancel();t.length=0},h.prototype.contains=function(n){return i(n)&&this._tweens.indexOf(n)!==-1},h.prototype.get=function(n){if(!i(n))throw new u("index is required.");return this._tweens[n]},h.prototype.update=function(n){var f=this._tweens,t=0,r,u;for(n=i(n)?n/o.SECONDS_PER_MILLISECOND:e();t<f.length;)r=f[t],u=r.tweenjs,r.needsStart?(r.needsStart=!1,u.start(n)):u.update(n)?t++:(u.stop(),f.splice(t,1))},h});t("Scene/ScreenSpaceCameraController",["../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/Ellipsoid","../Core/HeadingPitchRoll","../Core/IntersectionTests","../Core/isArray","../Core/KeyboardEventModifier","../Core/Math","../Core/Matrix3","../Core/Matrix4","../Core/OrthographicFrustum","../Core/Plane","../Core/Quaternion","../Core/Ray","../Core/Transforms","./CameraEventAggregator","./CameraEventType","./MapMode2D","./SceneMode","./SceneTransforms","./TweenCollection"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function at(i){if(!f(i))throw new o("scene is required.");this.enableInputs=!0;this.enableTranslate=!0;this.enableZoom=!0;this.enableRotate=!0;this.enableTilt=!0;this.enableLook=!0;this.inertiaSpin=.9;this.inertiaTranslate=.9;this.inertiaZoom=.8;this.maximumMovementRatio=.1;this.bounceAnimationTime=3;this.minimumZoomDistance=1;this.maximumZoomDistance=Number.POSITIVE_INFINITY;this.translateEventTypes=tt.LEFT_DRAG;this.zoomEventTypes=[tt.RIGHT_DRAG,tt.WHEEL,tt.PINCH];this.rotateEventTypes=tt.LEFT_DRAG;this.tiltEventTypes=[tt.MIDDLE_DRAG,tt.PINCH,{eventType:tt.LEFT_DRAG,modifier:a.CTRL},{eventType:tt.RIGHT_DRAG,modifier:a.CTRL}];this.lookEventTypes={eventType:tt.LEFT_DRAG,modifier:a.SHIFT};this.minimumPickingTerrainHeight=15e4;this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight;this.minimumCollisionTerrainHeight=15e3;this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight;this.minimumTrackBallHeight=75e5;this._minimumTrackBallHeight=this.minimumTrackBallHeight;this.enableCollisionDetection=!0;this._scene=i;this._globe=undefined;this._ellipsoid=undefined;this._aggregator=new nt(i.canvas);this._lastInertiaSpinMovement=undefined;this._lastInertiaZoomMovement=undefined;this._lastInertiaTranslateMovement=undefined;this._lastInertiaTiltMovement=undefined;this._tweens=new ft;this._tween=undefined;this._horizontalRotationAxis=undefined;this._tiltCenterMousePosition=new n(-1,-1);this._tiltCenter=new t;this._rotateMousePosition=new n(-1,-1);this._rotateStartPosition=new t;this._strafeStartPosition=new t;this._zoomMouseStart=new n(-1,-1);this._zoomWorldPosition=new t;this._useZoomWorldPosition=!1;this._tiltCVOffMap=!1;this._looking=!1;this._rotating=!1;this._strafing=!1;this._zoomingOnVector=!1;this._rotatingZoom=!1;var u=i.mapProjection;this._maxCoord=u.project(new r(Math.PI,v.PI_OVER_TWO));this._zoomFactor=5;this._rotateFactor=undefined;this._rotateRateRangeAdjustment=undefined;this._maximumRotateRate=1.77;this._minimumRotateRate=1/5e3;this._minimumZoomRate=20;this._maximumZoomRate=5906376272e3}function cr(n,t){if(n<0)return 0;var i=(1-t)*25;return Math.exp(-i*n)}function lr(t){return n.equalsEpsilon(t.startPosition,t.endPosition,v.EPSILON14)}function vr(t,i,r,u,e,o,s){var h=o[s],v,c,y;f(h)||(h=o[s]={startPosition:new n,endPosition:new n,motion:new n,active:!1});var a=t.getButtonPressTime(i,r),l=t.getButtonReleaseTime(i,r),p=a&&l&&(l.getTime()-a.getTime())/1e3,w=new Date,b=l&&(w.getTime()-l.getTime())/1e3;if(a&&l&&p<ar){if(v=cr(b,u),h.active)h.startPosition=n.clone(h.endPosition,h.startPosition),h.endPosition=n.multiplyByScalar(h.motion,v,h.endPosition),h.endPosition=n.add(h.startPosition,h.endPosition,h.endPosition),h.motion=n.clone(n.ZERO,h.motion);else{if(c=t.getLastMovement(i,r),!f(c)||lr(c))return;h.motion.x=(c.endPosition.x-c.startPosition.x)*.5;h.motion.y=(c.endPosition.y-c.startPosition.y)*.5;h.startPosition=n.clone(c.startPosition,h.startPosition);h.endPosition=n.multiplyByScalar(h.motion,v,h.endPosition);h.endPosition=n.add(h.startPosition,h.endPosition,h.endPosition);h.active=!0}if(isNaN(h.endPosition.x)||isNaN(h.endPosition.y)||n.distance(h.startPosition,h.endPosition)<.5){h.active=!1;return}t.isButtonDown(i,r)||(y=t.getStartMousePosition(i,r),e(o,y,h))}else h.active=!1}function et(n,t,i,r,u,e){var o,v,s;if(f(i))for(o=n._aggregator,l(i)||(hi[0]=i,i=hi),v=i.length,s=0;s<v;++s){var h=i[s],c=f(h.eventType)?h.eventType:h,a=h.modifier,y=o.isMoving(c,a)&&o.getMovement(c,a),p=o.getStartMousePosition(c,a);n.enableInputs&&t&&(y?r(n,p,y):u<1&&vr(o,c,a,u,r,n,e))}}function dt(i,r,u,e,o,s){var wi=1,bi,it,c,nt,et,ot,fi,st,di,lt,ei,at,yt,a,pt,wt,y,k,bt,dt,oi,p,ai,vi,rr,pi,g;f(s)&&(wi=v.clamp(Math.abs(s),.25,1));var tt=i.minimumZoomDistance*wi,ni=i.maximumZoomDistance,ur=o-tt,ti=e*ur;if((ti=v.clamp(ti,i._minimumZoomRate,i._maximumZoomRate),bi=u.endPosition.y-u.startPosition.y,it=bi/i._scene.canvas.clientHeight,it=Math.min(it,i.maximumMovementRatio),c=ti*it,!(c>0)||!(Math.abs(o-tt)<1))&&(!(c<0)||!(Math.abs(o-ni)<1))){o-c<tt?c=o-tt-1:o-c>ni&&(c=o-ni);var ft=i._scene,h=ft.camera,b=ft.mode,ii=kt.orientation;if(ii.heading=h.heading,ii.pitch=h.pitch,ii.roll=h.roll,h.frustum instanceof w){Math.abs(c)>0&&(h.zoomIn(c),h._adjustOrthographicFrustum());return}var ri=n.equals(r,i._zoomMouseStart),ki=i._zoomingOnVector,ui=i._rotatingZoom,l;if(ri||(i._zoomMouseStart=n.clone(r,i._zoomMouseStart),f(i._globe)&&(b===rt.SCENE2D?(l=h.getPickRay(r,vt).origin,l=t.fromElements(l.y,l.z,l.x)):l=ht(i,r,yr)),f(l)?(i._useZoomWorldPosition=!0,i._zoomWorldPosition=t.clone(l,i._zoomWorldPosition)):i._useZoomWorldPosition=!1,ki=i._zoomingOnVector=!1,ui=i._rotatingZoom=!1),!i._useZoomWorldPosition){h.zoomIn(c);return}if(nt=b===rt.COLUMBUS_VIEW,h.positionCartographic.height<2e6&&(ui=!0),!ri||ui){if(b===rt.SCENE2D)et=i._zoomWorldPosition,ot=h.position,!t.equals(et,ot)&&h.positionCartographic.height<i._maxCoord.x*2&&(fi=h.position.x,st=t.subtract(et,ot,wr),t.normalize(st,st),di=t.distance(et,ot)*c/(h.getMagnitude()*.5),h.move(st,di*.5),(h.position.x<0&&fi>0||h.position.x>0&&fi<0)&&(l=h.getPickRay(r,vt).origin,l=t.fromElements(l.y,l.z,l.x),i._zoomWorldPosition=t.clone(l,i._zoomWorldPosition)));else if(b===rt.SCENE3D)if(lt=t.normalize(h.position,tu),h.positionCartographic.height<3e3&&Math.abs(t.dot(h.direction,lt))<.6)nt=!0;else{if(ei=ft.canvas,at=br,at.x=ei.clientWidth/2,at.y=ei.clientHeight/2,yt=ht(i,at,kr),f(yt)&&h.positionCartographic.height<1e6){if(a=ru,t.clone(h.position,a),pt=i._zoomWorldPosition,wt=iu,wt=t.normalize(pt,wt),t.dot(wt,lt)<0)return;if(y=lu,k=eu,t.clone(h.direction,k),t.add(a,t.multiplyByScalar(k,1e3,ct),y),bt=ou,dt=su,t.subtract(pt,a,bt),t.normalize(bt,dt),oi=t.dot(lt,dt),oi>=0){i._zoomMouseStart.x=-1;return}var si=Math.acos(-oi),fr=t.magnitude(a),gi=t.magnitude(pt),hi=fr-c,er=t.magnitude(bt),or=Math.asin(v.clamp(er/gi*Math.sin(si),-1,1)),sr=Math.asin(v.clamp(hi/gi*Math.sin(si),-1,1)),gt=or-sr+si,d=uu;t.normalize(a,d);p=fu;p=t.cross(dt,d,p);p=t.normalize(p,p);t.normalize(t.cross(d,p,ct),k);t.multiplyByScalar(t.normalize(y,ct),t.magnitude(y)-c,y);t.normalize(a,a);t.multiplyByScalar(a,hi,a);ai=hu;t.multiplyByScalar(t.add(t.multiplyByScalar(d,Math.cos(gt)-1,ci),t.multiplyByScalar(k,Math.sin(gt),li),ct),hi,ai);t.add(a,ai,a);t.normalize(y,d);t.normalize(t.cross(d,p,ct),k);vi=cu;t.multiplyByScalar(t.add(t.multiplyByScalar(d,Math.cos(gt)-1,ci),t.multiplyByScalar(k,Math.sin(gt),li),ct),t.magnitude(y),vi);t.add(y,vi,y);t.clone(a,h.position);t.normalize(t.subtract(y,a,ct),h.direction);t.clone(h.direction,h.direction);t.cross(h.direction,h.up,h.right);t.cross(h.right,h.direction,h.up);h.setView(kt);return}if(f(yt)){var nr=t.normalize(yt,dr),tr=t.normalize(i._zoomWorldPosition,gr),yi=t.dot(tr,nr);if(yi>0&&yi<1){var ir=v.acosClamped(yi),hr=t.cross(tr,nr,nu),cr=Math.abs(ir)>v.toRadians(20)?h.positionCartographic.height*.75:h.positionCartographic.height-c,lr=c/cr;h.rotate(hr,ir*lr)}}else nt=!0}i._rotatingZoom=!nt}!ri&&nt||ki?(pi=ut.wgs84ToWindowCoordinates(ft,i._zoomWorldPosition,pr),rr=b!==rt.COLUMBUS_VIEW&&n.equals(r,i._zoomMouseStart)&&f(pi)?h.getPickRay(pi,vt):h.getPickRay(r,vt),g=rr.direction,(b===rt.COLUMBUS_VIEW||b===rt.SCENE2D)&&t.fromElements(g.y,g.z,g.x,g),h.move(g,c),i._zoomingOnVector=!0):h.zoomIn(c);h.setView(kt)}}function pu(n,i,r){var h=n._scene,o=h.camera,u=o.getPickRay(r.startPosition,au).origin,f=o.getPickRay(r.endPosition,vu).origin,e,s;u=t.fromElements(u.y,u.z,u.x,u);f=t.fromElements(f.y,f.z,f.x,f);e=t.subtract(u,f,yu);s=t.magnitude(e);s>0&&(t.normalize(e,e),o.move(e,s))}function ai(n,t,i){f(i.distance)&&(i=i.distance);var r=n._scene,u=r.camera;dt(n,t,i,n._zoomFactor,u.getMagnitude())}function vi(t,i,r){var u,s,h,y;if(f(r.angleAndHeight)){ku(t,i,r.angleAndHeight);return}var c=t._scene,p=c.camera,l=c.canvas,a=l.clientWidth,o=l.clientHeight,e=wu;e.x=2/a*r.startPosition.x-1;e.y=2/o*(o-r.startPosition.y)-1;e=n.normalize(e,e);u=bu;u.x=2/a*r.endPosition.x-1;u.y=2/o*(o-r.endPosition.y)-1;u=n.normalize(u,u);s=v.acosClamped(e.x);e.y<0&&(s=v.TWO_PI-s);h=v.acosClamped(u.x);u.y<0&&(h=v.TWO_PI-h);y=h-s;p.twistRight(y)}function ku(n,t,i){var r=n._rotateFactor*n._rotateRateRangeAdjustment,e;r>n._maximumRotateRate&&(r=n._maximumRotateRate);r<n._minimumRotateRate&&(r=n._minimumRotateRate);var f=n._scene,o=f.camera,s=f.canvas,u=(i.endPosition.x-i.startPosition.x)/s.clientWidth;u=Math.min(u,n.maximumMovementRatio);e=r*u*Math.PI*4;o.twistRight(e)}function du(n){var t=n._scene.mapMode2D===it.ROTATE;p.equals(p.IDENTITY,n._scene.camera.transform)?(et(n,n.enableTranslate,n.translateEventTypes,pu,n.inertiaTranslate,"_lastInertiaTranslateMovement"),et(n,n.enableZoom,n.zoomEventTypes,ai,n.inertiaZoom,"_lastInertiaZoomMovement"),t&&et(n,n.enableRotate,n.tiltEventTypes,vi,n.inertiaSpin,"_lastInertiaTiltMovement")):(et(n,n.enableZoom,n.zoomEventTypes,ai,n.inertiaZoom,"_lastInertiaZoomMovement"),t&&et(n,n.enableRotate,n.translateEventTypes,vi,n.inertiaSpin,"_lastInertiaSpinMovement"))}function ht(n,i,r){var u=n._scene,h=n._globe,o=u.camera,e;if(!f(h))return undefined;u.pickPositionSupported&&(e=u.pickPositionWorldCoordinates(i,gu));var c=o.getPickRay(i,yi),s=h.pickWorldCoordinates(c,u,nf),l=f(e)?t.distance(e,o.positionWC):Number.POSITIVE_INFINITY,a=f(s)?t.distance(s,o.positionWC):Number.POSITIVE_INFINITY;return l<a?t.clone(e,r):t.clone(s,r)}function hf(i,r,u){var a,e,d,y;if(t.equals(r,i._translateMousePosition)||(i._looking=!1),t.equals(r,i._strafeMousePosition)||(i._strafing=!1),i._looking){st(i,r,u);return}if(i._strafing){wt(i,r,u);return}var g=i._scene,o=g.camera,h=n.clone(u.startPosition,of),nt=n.clone(u.endPosition,sf),p=o.getPickRay(h,pi),l=t.clone(t.ZERO,ff),tt=t.UNIT_X,s;if(o.position.z<i._minimumPickingTerrainHeight&&(s=ht(i,h,wi),f(s)&&(l.x=s.x)),l.x>o.position.z&&f(s)){t.clone(s,i._strafeStartPosition);i._strafing=!0;wt(i,r,u);i._strafeMousePosition=n.clone(r,i._strafeMousePosition);return}a=b.fromPointNormal(l,tt,ef);p=o.getPickRay(h,pi);var w=c.rayPlane(p,a,wi),it=o.getPickRay(nt,tf),k=c.rayPlane(it,a,rf);if(!f(w)||!f(k)){i._looking=!0;st(i,r,u);n.clone(r,i._translateMousePosition);return}e=t.subtract(w,k,uf);d=e.x;e.x=e.y;e.y=e.z;e.z=d;y=t.magnitude(e);y>v.EPSILON6&&(t.normalize(e,e),o.move(e,y))}function wf(t,i,r){if(f(r.angleAndHeight)&&(r=r.angleAndHeight),n.equals(i,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking){st(t,i,r);return}var o=t._scene,u=o.camera,e=t._maxCoord,s=Math.abs(u.position.x)-e.x<0&&Math.abs(u.position.y)-e.y<0;t._tiltCVOffMap||!s||u.position.z>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,bf(t,i,r)):kf(t,i,r)}function bf(i,r,u){var c=i._scene,o=c.camera,b=c.canvas,l=bi,e,a,y,rt,ft,w;l.x=b.clientWidth/2;l.y=b.clientHeight/2;var k=o.getPickRay(l,gt),d=t.UNIT_X,nt=k.origin,tt=k.direction,h,it=t.dot(d,tt);if(Math.abs(it)>v.EPSILON6&&(h=-t.dot(d,nt)/it),!f(h)||h<=0){i._looking=!0;st(i,r,u);n.clone(r,i._tiltCenterMousePosition);return}e=t.multiplyByScalar(tt,h,yt);t.add(nt,e,e);a=c.mapProjection;y=a.ellipsoid;t.fromElements(e.y,e.z,e.x,e);rt=a.unproject(e,ti);y.cartographicToCartesian(rt,e);var et=g.eastNorthUpToFixedFrame(e,y,ki),ht=i._globe,ut=i._ellipsoid;i._globe=undefined;i._ellipsoid=s.UNIT_SPHERE;i._rotateFactor=1;i._rotateRateRangeAdjustment=1;ft=p.clone(o.transform,di);o._setTransform(et);ot(i,r,u,t.UNIT_Z);o._setTransform(ft);i._globe=ht;i._ellipsoid=ut;w=ut.maximumRadius;i._rotateFactor=1/w;i._rotateRateRangeAdjustment=w}function kf(i,r,u){var ii=i._scene,e=ii.camera,o,w,et=t.UNIT_X,ei,tt,ct,rt,at,ut,oi,vt,d,wt,si,hi,ci,a,bt,l,kt,li,ft,ai,dt;if(n.equals(r,i._tiltCenterMousePosition))o=t.clone(i._tiltCenter,yt);else{if(e.position.z<i._minimumPickingTerrainHeight&&(o=ht(i,r,yt)),!f(o)){w=e.getPickRay(r,gt);var ri=w.origin,ui=w.direction,nt,fi=t.dot(et,ui);if(Math.abs(fi)>v.EPSILON6&&(nt=-t.dot(et,ri)/fi),!f(nt)||nt<=0){i._looking=!0;st(i,r,u);n.clone(r,i._tiltCenterMousePosition);return}o=t.multiplyByScalar(ui,nt,yt);t.add(ri,o,o)}n.clone(r,i._tiltCenterMousePosition);t.clone(o,i._tiltCenter)}ei=ii.canvas;tt=bi;tt.x=ei.clientWidth/2;tt.y=i._tiltCenterMousePosition.y;w=e.getPickRay(tt,gt);ct=t.clone(t.ZERO,af);ct.x=o.x;var vi=b.fromPointNormal(ct,et,vf),h=c.rayPlane(w,vi,cf),lt=e._projection,it=lt.ellipsoid;t.fromElements(o.y,o.z,o.x,o);rt=lt.unproject(o,ti);it.cartographicToCartesian(rt,o);at=g.eastNorthUpToFixedFrame(o,it,ki);f(h)?(t.fromElements(h.y,h.z,h.x,h),rt=lt.unproject(h,ti),it.cartographicToCartesian(rt,h),ut=g.eastNorthUpToFixedFrame(h,it,lf)):ut=at;oi=i._globe;vt=i._ellipsoid;i._globe=undefined;i._ellipsoid=s.UNIT_SPHERE;i._rotateFactor=1;i._rotateRateRangeAdjustment=1;d=t.UNIT_Z;wt=p.clone(e.transform,di);e._setTransform(at);si=t.cross(t.UNIT_Z,t.normalize(e.position,ni),ni);hi=t.dot(e.right,si);ot(i,r,u,d,!1,!0);e._setTransform(ut);hi<0?(u.startPosition.y>u.endPosition.y&&(d=undefined),ci=e.constrainedAxis,e.constrainedAxis=undefined,ot(i,r,u,d,!0,!1),e.constrainedAxis=ci):ot(i,r,u,d,!0,!1);f(e.constrainedAxis)&&(a=t.cross(e.direction,e.constrainedAxis,pt),t.equalsEpsilon(a,t.ZERO,v.EPSILON6)||(t.dot(a,e.right)<0&&t.negate(a,a),t.cross(a,e.direction,e.up),t.cross(e.direction,e.up,e.right),t.normalize(e.up,e.up),t.normalize(e.right,e.right)));e._setTransform(wt);i._globe=oi;i._ellipsoid=vt;bt=vt.maximumRadius;i._rotateFactor=1/bt;i._rotateRateRangeAdjustment=bt;l=t.clone(e.positionWC,ni);e._adjustHeightForTerrain();t.equals(e.positionWC,l)||(e._setTransform(ut),e.worldToCameraCoordinatesPoint(l,l),kt=t.magnitudeSquared(l),t.magnitudeSquared(e.position)>kt&&(t.normalize(e.position,e.position),t.multiplyByScalar(e.position,Math.sqrt(kt),e.position)),li=t.angleBetween(l,e.position),ft=t.cross(l,e.position,l),t.normalize(ft,ft),ai=k.fromAxisAngle(ft,li,yf),dt=y.fromQuaternion(ai,pf),y.multiplyByVector(dt,e.direction,e.direction),y.multiplyByVector(dt,e.up,e.up),t.cross(e.direction,e.up,e.right),t.cross(e.right,e.direction,e.up),e._setTransform(wt))}function df(n,i,r){var e,o,s;f(r.distance)&&(r=r.distance);var h=n._scene,c=h.camera,l=h.canvas,u=gi;if(u.x=l.clientWidth/2,u.y=l.clientHeight/2,e=c.getPickRay(u,nr),c.position.z<n._minimumPickingTerrainHeight&&(o=ht(n,u,tr)),f(o))s=t.distance(e.origin,o);else{var a=t.UNIT_X,v=e.origin,y=e.direction;s=-t.dot(a,v)/t.dot(a,y)}dt(n,i,r,n._zoomFactor,s)}function gf(n){var u=n._scene,r=u.camera,t,i;p.equals(p.IDENTITY,r.transform)?(t=n._tweens,n._aggregator.anyButtonDown&&t.removeAll(),et(n,n.enableTilt,n.tiltEventTypes,wf,n.inertiaSpin,"_lastInertiaTiltMovement"),et(n,n.enableTranslate,n.translateEventTypes,hf,n.inertiaTranslate,"_lastInertiaTranslateMovement"),et(n,n.enableZoom,n.zoomEventTypes,df,n.inertiaZoom,"_lastInertiaZoomMovement"),et(n,n.enableLook,n.lookEventTypes,st),n._aggregator.anyButtonDown||f(n._lastInertiaZoomMovement)&&n._lastInertiaZoomMovement.active||f(n._lastInertiaTranslateMovement)&&n._lastInertiaTranslateMovement.active||t.contains(n._tween)||(i=r.createCorrectPositionTween(n.bounceAnimationTime),f(i)&&(n._tween=t.add(i))),t.update()):(et(n,n.enableRotate,n.rotateEventTypes,ot,n.inertiaSpin,"_lastInertiaSpinMovement"),et(n,n.enableZoom,n.zoomEventTypes,ur,n.inertiaZoom,"_lastInertiaZoomMovement"))}function wt(n,i,r){var o=n._scene,e=o.camera,s=ht(n,r.startPosition,ir),l,h;if(f(s)){var a=r.endPosition,v=e.getPickRay(a,ne),u=t.clone(e.direction,re);(o.mode===rt.COLUMBUS_VIEW&&t.fromElements(u.z,u.x,u.y,u),l=b.fromPointNormal(s,u,te),h=c.rayPlane(v,l,ie),f(h))&&(u=t.subtract(s,h,u),o.mode===rt.COLUMBUS_VIEW&&t.fromElements(u.y,u.z,u.x,u),t.add(e.position,u,e.position))}}function ee(i,r,u){var d=i._scene,h=d.camera,b,k;if(!p.equals(h.transform,p.IDENTITY)){ot(i,r,u);return}var c,e,l,a=i._ellipsoid.geodeticSurfaceNormal(h.position,fe),v=i._ellipsoid.cartesianToCartographic(h.positionWC,ue).height,y=i._globe,o,w=!1;if(f(y)&&v<i._minimumPickingTerrainHeight&&(o=ht(i,u.startPosition,ir),f(o)&&(b=h.getPickRay(u.startPosition,yi),k=i._ellipsoid.geodeticSurfaceNormal(o),w=Math.abs(t.dot(b.direction,k))<.05,w&&!i._looking&&(i._rotating=!1,i._strafing=!0))),n.equals(r,i._rotateMousePosition)){i._looking?st(i,r,u,a):i._rotating?ot(i,r,u):i._strafing?(t.clone(o,i._strafeStartPosition),wt(i,r,u)):(c=t.magnitude(i._rotateStartPosition),e=ii,e.x=e.y=e.z=c,l=s.fromCartesian3(e,ri),fi(i,r,u,l));return}i._looking=!1;i._rotating=!1;i._strafing=!1;f(y)&&v<i._minimumPickingTerrainHeight?f(o)?t.magnitude(h.position)<t.magnitude(o)?(t.clone(o,i._strafeStartPosition),i._strafing=!0,wt(i,r,u)):(c=t.magnitude(o),e=ii,e.x=e.y=e.z=c,l=s.fromCartesian3(e,ri),fi(i,r,u,l),t.clone(o,i._rotateStartPosition)):(i._looking=!0,st(i,r,u,a)):f(h.pickEllipsoid(u.startPosition,i._ellipsoid,rr))?(fi(i,r,u,i._ellipsoid),t.clone(rr,i._rotateStartPosition)):v>i._minimumTrackBallHeight?(i._rotating=!0,ot(i,r,u)):(i._looking=!0,st(i,r,u,a));n.clone(r,i._rotateMousePosition)}function ot(n,i,r,e,o,s){var p,h,l,a,w,b;o=u(o,!1);s=u(s,!1);var v=n._scene,c=v.camera,y=v.canvas,k=c.constrainedAxis;f(e)&&(c.constrainedAxis=e);p=t.magnitude(c.position);h=n._rotateFactor*(p-n._rotateRateRangeAdjustment);h>n._maximumRotateRate&&(h=n._maximumRotateRate);h<n._minimumRotateRate&&(h=n._minimumRotateRate);l=(r.startPosition.x-r.endPosition.x)/y.clientWidth;a=(r.startPosition.y-r.endPosition.y)/y.clientHeight;l=Math.min(l,n.maximumMovementRatio);a=Math.min(a,n.maximumMovementRatio);w=h*l*Math.PI*2;b=h*a*Math.PI;o||c.rotateRight(w);s||c.rotateUp(b);c.constrainedAxis=k}function fi(i,r,u,e){var lt=i._scene,s=lt.camera,at=n.clone(u.startPosition,le),vt=n.clone(u.endPosition,ae),h=s.pickEllipsoid(at,e,oe),c=s.pickEllipsoid(vt,e,se),d,g,nt,o,l,b,k,ut,ft;if(!f(h)||!f(c)){i._rotating=!0;ot(i,r,u);return}if(h=s.worldToCameraCoordinates(h,h),c=s.worldToCameraCoordinates(c,c),f(s.constrainedAxis)){o=s.constrainedAxis;l=t.mostOrthogonalAxis(o,bt);t.cross(l,o,l);t.normalize(l,l);var tt=t.cross(o,l,ui),yt=t.magnitude(h),it=t.dot(o,h),p=Math.acos(it/yt),a=t.multiplyByScalar(o,it,he);t.subtract(h,a,a);t.normalize(a,a);var pt=t.magnitude(c),rt=t.dot(o,c),w=Math.acos(rt/pt),y=t.multiplyByScalar(o,rt,ce);t.subtract(c,y,y);t.normalize(y,y);b=Math.acos(t.dot(a,l));t.dot(a,tt)<0&&(b=v.TWO_PI-b);k=Math.acos(t.dot(y,l));t.dot(y,tt)<0&&(k=v.TWO_PI-k);ut=b-k;ft=t.equalsEpsilon(o,s.position,v.EPSILON2)?s.right:t.cross(o,s.position,bt);var et=t.cross(o,ft,bt),st=t.dot(et,t.subtract(h,o,ui)),ht=t.dot(et,t.subtract(c,o,ui)),ct;ct=st>0&&ht>0?w-p:st>0&&ht<=0?t.dot(s.position,o)>0?-p-w:p+w:p-w;s.rotateRight(ut);s.rotateUp(ct)}else t.normalize(h,h),t.normalize(c,c),d=t.dot(h,c),g=t.cross(h,c,bt),d<1&&!t.equalsEpsilon(g,t.ZERO,v.EPSILON14)&&(nt=Math.acos(d),s.rotate(g,nt))}function ur(n,i,r){var l,o,s,a,v;f(r.distance)&&(r=r.distance);var y=n._ellipsoid,h=n._scene,u=h.camera,c=h.canvas,e=gi;e.x=c.clientWidth/2;e.y=c.clientHeight/2;l=u.getPickRay(e,nr);s=y.cartesianToCartographic(u.position,ye).height;s<n._minimumPickingTerrainHeight&&(o=ht(n,e,tr));a=f(o)?t.distance(l.origin,o):s;v=t.normalize(u.position,ve);dt(n,i,r,n._zoomFactor,a,t.dot(v,u.direction))}function de(t,i,r){var h=t._scene,u=h.camera,e,o,s;if(p.equals(u.transform,p.IDENTITY)){if(f(r.angleAndHeight)&&(r=r.angleAndHeight),n.equals(i,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){e=t._ellipsoid.geodeticSurfaceNormal(u.position,si);st(t,i,r,e);return}o=t._ellipsoid;s=o.cartesianToCartographic(u.position,oi);t._tiltOnEllipsoid||s.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,no(t,i,r)):to(t,i,r)}}function no(i,r,u){var e=i._ellipsoid,tt=i._scene,o=tt.camera,et=i.minimumZoomDistance*.25,it=e.cartesianToCartographic(o.positionWC,ge).height,a,h,l,y,w,b,k,rt,ft,nt;if(!(it-et-1<v.EPSILON3)||!(u.endPosition.y-u.startPosition.y<0)){if(a=tt.canvas,h=fr,h.x=a.clientWidth/2,h.y=a.clientHeight/2,l=o.getPickRay(h,ei),w=c.rayEllipsoid(l,e),f(w))y=d.getPoint(l,w.start,lt);else if(it>i._minimumTrackBallHeight){if(b=c.grazingAltitudeLocation(l,e),!f(b))return;k=e.cartesianToCartographic(b,oi);k.height=0;y=e.cartographicToCartesian(k,lt)}else{i._looking=!0;rt=i._ellipsoid.geodeticSurfaceNormal(o.position,si);st(i,r,u,rt);n.clone(r,i._tiltCenterMousePosition);return}var ht=g.eastNorthUpToFixedFrame(y,e,er),ct=i._globe,ut=i._ellipsoid;i._globe=undefined;i._ellipsoid=s.UNIT_SPHERE;i._rotateFactor=1;i._rotateRateRangeAdjustment=1;ft=p.clone(o.transform,or);o._setTransform(ht);ot(i,r,u,t.UNIT_Z);o._setTransform(ft);i._globe=ct;i._ellipsoid=ut;nt=ut.maximumRadius;i._rotateFactor=1/nt;i._rotateRateRangeAdjustment=nt}}function to(i,r,u){var rt=i._ellipsoid,at=i._scene,e=at.camera,h,l,a,vt,yt,wt,nt,b,ut,ni,ti,ui,w,ft,o,et,fi,it,hi,ct;if(n.equals(r,i._tiltCenterMousePosition))h=t.clone(i._tiltCenter,lt);else{if(h=ht(i,r,lt),!f(h)){if(l=e.getPickRay(r,ei),a=c.rayEllipsoid(l,rt),!f(a)){vt=rt.cartesianToCartographic(e.position,oi);vt.height<=i._minimumTrackBallHeight&&(i._looking=!0,yt=i._ellipsoid.geodeticSurfaceNormal(e.position,si),st(i,r,u,yt),n.clone(r,i._tiltCenterMousePosition));return}h=d.getPoint(l,a.start,lt)}n.clone(r,i._tiltCenterMousePosition);t.clone(h,i._tiltCenter)}wt=at.canvas;nt=fr;nt.x=wt.clientWidth/2;nt.y=i._tiltCenterMousePosition.y;l=e.getPickRay(nt,ei);var tt=t.magnitude(h),ci=t.fromElements(tt,tt,tt,ii),bt=s.fromCartesian3(ci,ri);if(a=c.rayEllipsoid(l,bt),f(a)){var li=t.magnitude(l.origin)>tt?a.start:a.stop,kt=d.getPoint(l,li,pe),ai=g.eastNorthUpToFixedFrame(h,rt,er),dt=g.eastNorthUpToFixedFrame(kt,bt,we),vi=i._globe,gt=i._ellipsoid;i._globe=undefined;i._ellipsoid=s.UNIT_SPHERE;i._rotateFactor=1;i._rotateRateRangeAdjustment=1;b=t.UNIT_Z;ut=p.clone(e.transform,or);e._setTransform(ai);ni=t.cross(kt,e.positionWC,pt);ti=t.dot(e.rightWC,ni);ot(i,r,u,b,!1,!0);e._setTransform(dt);ti<0?(u.startPosition.y>u.endPosition.y&&(b=undefined),ui=e.constrainedAxis,e.constrainedAxis=undefined,ot(i,r,u,b,!0,!1),e.constrainedAxis=ui):ot(i,r,u,b,!0,!1);f(e.constrainedAxis)&&(w=t.cross(e.direction,e.constrainedAxis,pt),t.equalsEpsilon(w,t.ZERO,v.EPSILON6)||(t.dot(w,e.right)<0&&t.negate(w,w),t.cross(w,e.direction,e.up),t.cross(e.direction,e.up,e.right),t.normalize(e.up,e.up),t.normalize(e.right,e.right)));e._setTransform(ut);i._globe=vi;i._ellipsoid=gt;ft=gt.maximumRadius;i._rotateFactor=1/ft;i._rotateRateRangeAdjustment=ft;o=t.clone(e.positionWC,pt);e._adjustHeightForTerrain();t.equals(e.positionWC,o)||(e._setTransform(dt),e.worldToCameraCoordinatesPoint(o,o),et=t.magnitudeSquared(o),t.magnitudeSquared(e.position)>et&&(t.normalize(e.position,e.position),t.multiplyByScalar(e.position,Math.sqrt(et),e.position)),fi=t.angleBetween(o,e.position),it=t.cross(o,e.position,o),t.normalize(it,it),hi=k.fromAxisAngle(it,fi,be),ct=y.fromQuaternion(hi,ke),y.multiplyByVector(ct,e.direction,e.direction),y.multiplyByVector(ct,e.up,e.up),t.cross(e.direction,e.up,e.right),t.cross(e.right,e.direction,e.up),e._setTransform(ut))}}function st(n,i,r,e){var ut=n._scene,s=ut.camera,y=io,a,l,g,p,rt;y.x=r.startPosition.x;y.y=0;a=ro;a.x=r.endPosition.x;a.y=0;var b=s.getPickRay(y,sr),k=s.getPickRay(a,hr),o=0,h,c;if(s.frustum instanceof w?(h=b.origin,c=k.origin,t.add(s.direction,h,h),t.add(s.direction,c,c),t.subtract(h,s.position,h),t.subtract(c,s.position,c),t.normalize(h,h),t.normalize(c,c)):(h=b.direction,c=k.direction),l=t.dot(h,c),l<1&&(o=Math.acos(l)),o=r.startPosition.x>r.endPosition.x?-o:o,g=n._horizontalRotationAxis,f(e)?s.look(e,-o):f(g)?s.look(g,-o):s.lookLeft(o),y.x=0,y.y=r.startPosition.y,a.x=0,a.y=r.endPosition.y,b=s.getPickRay(y,sr),k=s.getPickRay(a,hr),o=0,s.frustum instanceof w?(h=b.origin,c=k.origin,t.add(s.direction,h,h),t.add(s.direction,c,c),t.subtract(h,s.position,h),t.subtract(c,s.position,c),t.normalize(h,h),t.normalize(c,c)):(h=b.direction,c=k.direction),l=t.dot(h,c),l<1&&(o=Math.acos(l)),o=r.startPosition.y>r.endPosition.y?-o:o,e=u(e,g),f(e)){var d=s.direction,nt=t.negate(e,uo),tt=t.equalsEpsilon(d,e,v.EPSILON2),it=t.equalsEpsilon(d,nt,v.EPSILON2);tt||it?(tt&&o<0||it&&o>0)&&s.look(s.right,-o):(l=t.dot(d,e),p=v.acosClamped(l),o>0&&o>p&&(o=p-v.EPSILON4),l=t.dot(d,nt),p=v.acosClamped(l),o<0&&-o>p&&(o=-p+v.EPSILON4),rt=t.cross(e,d,fo),s.look(rt,o))}else s.lookUp(o)}function eo(n){et(n,n.enableRotate,n.rotateEventTypes,ee,n.inertiaSpin,"_lastInertiaSpinMovement");et(n,n.enableZoom,n.zoomEventTypes,ur,n.inertiaZoom,"_lastInertiaZoomMovement");et(n,n.enableTilt,n.tiltEventTypes,de,n.inertiaSpin,"_lastInertiaTiltMovement");et(n,n.enableLook,n.lookEventTypes,st)}var ar=.4,hi=[],vt=new d,yr=new t,pr=new n,wr=new t,br=new n,kr=new t,dr=new t,gr=new t,nu=new t,tu=new t,iu=new t,ru=new t,uu=new t,fu=new t,eu=new t,ou=new t,su=new t,hu=new t,cu=new t,lu=new t,ct=new t,ci=new t,li=new t,kt={orientation:new h},au=new d,vu=new d,yu=new t,wu=new n,bu=new n,yi=new d,gu=new t,nf=new t,pi=new d,tf=new d,wi=new t,rf=new t,uf=new t,ff=new t,ef=new b(t.UNIT_X,0),of=new n,sf=new n,bi=new n,gt=new d,yt=new t,cf=new t,ki=new p,lf=new p,af=new t,vf=new b(t.UNIT_X,0),ni=new t,ti=new r,di=new p,yf=new k,pf=new y,pt=new t,gi=new n,nr=new d,tr=new t,ne=new d,te=new b(t.UNIT_X,0),ie=new t,re=new t,ir=new t,rr=new t,ue=new r,ii=new t,ri=new s,fe=new t,oe=i.clone(i.UNIT_W),se=i.clone(i.UNIT_W),bt=new t,ui=new t,he=new t,ce=new t,le=new n,ae=new n,ve=new t,ye=new r,fr=new n,ei=new d,lt=new t,pe=new t,er=new p,we=new p,or=new p,be=new k,ke=new y,oi=new r,si=new t,ge=new r,io=new n,ro=new n,sr=new d,hr=new d,uo=new t,fo=new t;return at.prototype.update=function(){var i,r,n;p.equals(this._scene.camera.transform,p.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=f(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=undefined,this._ellipsoid=s.UNIT_SPHERE);this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration;this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration;this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;i=this._ellipsoid.maximumRadius;this._rotateFactor=1/i;this._rotateRateRangeAdjustment=i;r=this._scene;n=r.mode;n===rt.SCENE2D?du(this):n===rt.COLUMBUS_VIEW?(this._horizontalRotationAxis=t.UNIT_Z,gf(this)):n===rt.SCENE3D&&(this._horizontalRotationAxis=undefined,eo(this));this._aggregator.reset()},at.prototype.isDestroyed=function(){return!1},at.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),e(this)},at});t("Scene/ShadowMapShader",["../Core/defined","../Renderer/ShaderSource"],function(n,t){"use strict";function i(){}return i.getShadowCastShaderKeyword=function(n,t,i,r){return"castShadow "+n+" "+t+" "+i+" "+r},i.createShadowCastVertexShader=function(i,r,u){var o=i.defines.slice(0),f=i.sources.slice(0),s,h,c,e,l;if(o.push("SHADOW_MAP"),u&&o.push("GENERATE_POSITION"),s=t.findPositionVarying(i),h=n(s),r&&!h){for(c=f.length,e=0;e<c;++e)f[e]=t.replaceMain(f[e],"czm_shadow_cast_main");l="varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC = (czm_inverseProjection * gl_Position).xyz; \n}";f.push(l)}return new t({defines:o,sources:f})},i.createShadowCastFragmentShader=function(i,r,u,f){var a=i.defines.slice(0),o=i.sources.slice(0),h=t.findPositionVarying(i),c=n(h),l,s,e;for(c||(h="v_positionEC"),l=o.length,s=0;s<l;++s)o[s]=t.replaceMain(o[s],"czm_shadow_cast_main");return e="",r&&(c||(e+="varying vec3 v_positionEC; \n"),e+="uniform vec4 shadowMap_lightPositionEC; \n"),e+=f?"void main() \n{ \n":"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a == 0.0) \n    { \n       discard; \n    } \n",e+=r?"    float distance = length("+h+"); \n    if (distance >= shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /= shadowMap_lightPositionEC.w; // radius \n    gl_FragColor = czm_packDepth(distance); \n":u?"    gl_FragColor = vec4(1.0); \n":"    gl_FragColor = czm_packDepth(gl_FragCoord.z); \n",e+="} \n",o.push(e),new t({defines:a,sources:o})},i.getShadowReceiveShaderKeyword=function(n,t,i,r){var u=n._usesDepthTexture,f=n._polygonOffsetSupported,e=n._isPointLight,o=n._isSpotLight,s=n._numberOfCascades>1,h=n.debugCascadeColors,c=n.softShadows;return"receiveShadow "+u+f+e+o+s+h+c+t+i+r},i.createShadowReceiveVertexShader=function(n,i,r){var u=n.defines.slice(0),f=n.sources.slice(0);return u.push("SHADOW_MAP"),i&&(r?u.push("GENERATE_POSITION_AND_NORMAL"):u.push("GENERATE_POSITION")),new t({defines:u,sources:f})},i.createShadowReceiveFragmentShader=function(i,r,u,f,e){for(var o,b,y=t.findNormalVarying(i),l=!f&&n(y)||f&&e,p=t.findPositionVarying(i),k=n(p),d=r._usesDepthTexture,g=r._polygonOffsetSupported,h=r._isPointLight,nt=r._isSpotLight,w=r._numberOfCascades>1,tt=r.debugCascadeColors,it=r.softShadows,v=h?r._pointBias:f?r._terrainBias:r._primitiveBias,s=i.defines.slice(0),c=i.sources.slice(0),rt=c.length,a=0;a<rt;++a)c[a]=t.replaceMain(c[a],"czm_shadow_receive_main");return h?s.push("USE_CUBE_MAP_SHADOW"):d&&s.push("USE_SHADOW_DEPTH_TEXTURE"),it&&!h&&s.push("USE_SOFT_SHADOWS"),w&&u&&f&&(l?s.push("ENABLE_VERTEX_LIGHTING"):s.push("ENABLE_DAYNIGHT_SHADING")),u&&v.normalShading&&l&&(s.push("USE_NORMAL_SHADING"),v.normalShadingSmooth>0&&s.push("USE_NORMAL_SHADING_SMOOTH")),o="",o+=h?"uniform samplerCube shadowMap_textureCube; \n":"uniform sampler2D shadowMap_texture; \n",b=k?"    return vec4("+p+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n",o+="uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+b+"} \nvec3 getNormalEC() \n{ \n"+(l?"    return normalize("+y+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(v.normalOffset&&l?"    float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale = 1.0 - nDotL; \n    vec3 offset = normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz += offset; \n":"")+"} \n",o+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC = getPositionEC(); \n    vec3 normalEC = getNormalEC(); \n    float depth = -positionEC.z; \n",o+="    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n",f?o+="    shadowParameters.depthBias *= max(depth * 0.01, 1.0); \n":g||(o+="    shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); \n"),o+=h?"    vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance = length(directionEC); \n    directionEC = normalize(directionEC); \n    float radius = shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance > radius) \n    { \n        return; \n    } \n    vec3 directionWC  = czm_inverseViewRotation * directionEC; \n    shadowParameters.depth = distance / radius; \n    shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords = directionWC; \n    float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":nt?"    vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /= shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":w?"    float maxDepth = shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth > maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights = czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition = czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade = max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility = mix(visibility, 1.0, fade); \n"+(tt?"    // Draw cascade colors for debugging \n    gl_FragColor *= czm_cascadeColor(weights); \n":""):"    float nDotL = clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition = shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords = shadowPosition.xy; \n    shadowParameters.depth = shadowPosition.z; \n    shadowParameters.nDotL = nDotL; \n    float visibility = czm_shadowVisibility(shadowMap_texture, shadowParameters); \n",o+="    gl_FragColor.rgb *= visibility; \n} \n",c.push(o),new t({defines:s,sources:c})},i});t("Scene/ShadowMap",["../Core/BoundingRectangle","../Core/BoundingSphere","../Core/BoxOutlineGeometry","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/Cartographic","../Core/clone","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/combine","../Core/CullingVolume","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/DeveloperError","../Core/FeatureDetection","../Core/GeometryInstance","../Core/Intersect","../Core/Math","../Core/Matrix4","../Core/OrthographicOffCenterFrustum","../Core/PerspectiveFrustum","../Core/PixelFormat","../Core/Quaternion","../Core/SphereOutlineGeometry","../Core/WebGLConstants","../Renderer/ClearCommand","../Renderer/ContextLimits","../Renderer/CubeMap","../Renderer/DrawCommand","../Renderer/Framebuffer","../Renderer/Pass","../Renderer/PassState","../Renderer/PixelDatatype","../Renderer/Renderbuffer","../Renderer/RenderbufferFormat","../Renderer/RenderState","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap","./Camera","./CullFace","./DebugCameraPrimitive","./PerInstanceColorAppearance","./Primitive","./ShadowMapShader"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi){"use strict";function hi(n){var i,e,h,o;if(n=a(n,a.EMPTY_OBJECT),i=n.context,!v(i))throw new w("context is required.");if(!v(n.lightCamera))throw new w("lightCamera is required.");if(v(n.numberOfCascades)&&n.numberOfCascades!==1&&n.numberOfCascades!==4)throw new w("Only one or four cascades are supported.");for(this._enabled=a(n.enabled,!0),this._softShadows=a(n.softShadows,!1),this._normalOffset=a(n.normalOffset,!0),this.dirty=!0,this.fromLightSource=a(n.fromLightSource,!0),this.darkness=a(n.darkness,.3),this._darkness=this.darkness,this.maximumDistance=a(n.maximumDistance,5e3),this._outOfView=!1,this._outOfViewPrevious=!1,this._needsUpdate=!0,e=!0,(b.isInternetExplorer()||b.isEdge()||(b.isChrome()||b.isFirefox())&&b.isWindows()&&!i.depthTexture)&&(e=!1),this._polygonOffsetSupported=e,this._terrainBias={polygonOffset:e,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:.0001},this._primitiveBias={polygonOffset:e,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2e-5},this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:.0005},this._depthAttachment=undefined,this._colorAttachment=undefined,this._shadowMapMatrix=new nt,this._shadowMapTexture=undefined,this._lightDirectionEC=new u,this._lightPositionEC=new f,this._distance=0,this._lightCamera=n.lightCamera,this._shadowMapCamera=new vi,this._shadowMapCullingVolume=undefined,this._sceneCamera=undefined,this._boundingSphere=new t,this._isPointLight=a(n.isPointLight,!1),this._pointLightRadius=a(n.pointLightRadius,100),this._cascadesEnabled=this._isPointLight?!1:a(n.cascadesEnabled,!0),this._numberOfCascades=this._cascadesEnabled?a(n.numberOfCascades,4):0,this._fitNearFar=!0,this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE],this._textureSize=new r,this._isSpotLight=!1,this._cascadesEnabled?this._shadowMapCamera.frustum=new tt:v(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0),this._cascadeSplits=[new f,new f],this._cascadeMatrices=[new nt,new nt,new nt,new nt],this._cascadeDistances=new f,h=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1,this._passes=new Array(h),o=0;o<h;++o)this._passes[o]=new cr(i);this.debugShow=!1;this.debugFreezeFrame=!1;this._debugFreezeFrame=!1;this._debugCascadeColors=!1;this._debugLightFrustum=undefined;this._debugCameraFrustum=undefined;this._debugCascadeFrustums=new Array(this._numberOfCascades);this._debugShadowViewCommand=undefined;this._usesDepthTexture=i.depthTexture;this._isPointLight&&(this._usesDepthTexture=!1);this._primitiveRenderState=undefined;this._terrainRenderState=undefined;this._pointRenderState=undefined;pi(this);this._clearCommand=new ot({depth:1,color:new s});this._clearPassState=new vt(i);this._size=a(n.size,2048);this.size=this._size}function cr(n){this.camera=new vi;this.passState=new vt(n);this.framebuffer=undefined;this.textureOffsets=undefined;this.commandList=[];this.cullingVolume=undefined}function yi(n,t){return bt.fromCache({cull:{enabled:!0,face:ri.BACK},depthTest:{enabled:!0},colorMask:{red:n,green:n,blue:n,alpha:n},depthMask:!0,polygonOffset:{enabled:t.polygonOffset,factor:t.polygonOffsetFactor,units:t.polygonOffsetUnits}})}function pi(n){var t=!n._usesDepthTexture;n._primitiveRenderState=yi(t,n._primitiveBias);n._terrainRenderState=yi(t,n._terrainBias);n._pointRenderState=yi(t,n._pointBias)}function wi(n){for(var r,t,u=n._passes.length,i=0;i<u;++i)r=n._passes[i],t=r.framebuffer,v(t)&&!t.isDestroyed()&&t.destroy(),r.framebuffer=undefined;n._depthAttachment=n._depthAttachment&&n._depthAttachment.destroy();n._colorAttachment=n._colorAttachment&&n._colorAttachment.destroy()}function bi(){return new kt({wrapS:ti.CLAMP_TO_EDGE,wrapT:ti.CLAMP_TO_EDGE,minificationFilter:ni.NEAREST,magnificationFilter:gt.NEAREST})}function lr(n,t){for(var u,f=new pt({context:t,width:n._textureSize.x,height:n._textureSize.y,format:wt.DEPTH_COMPONENT16}),i=new dt({context:t,width:n._textureSize.x,height:n._textureSize.y,pixelFormat:rt.RGBA,pixelDatatype:yt.UNSIGNED_BYTE,sampler:bi()}),e=new lt({context:t,depthRenderbuffer:f,colorTextures:[i],destroyAttachments:!1}),o=n._passes.length,r=0;r<o;++r)u=n._passes[r],u.framebuffer=e,u.passState.framebuffer=e;n._shadowMapTexture=i;n._depthAttachment=f;n._colorAttachment=i}function ar(n,t){for(var u,i=new dt({context:t,width:n._textureSize.x,height:n._textureSize.y,pixelFormat:rt.DEPTH_STENCIL,pixelDatatype:yt.UNSIGNED_INT_24_8,sampler:bi()}),f=new lt({context:t,depthStencilTexture:i,destroyAttachments:!1}),e=n._passes.length,r=0;r<e;++r)u=n._passes[r],u.framebuffer=f,u.passState.framebuffer=f;n._shadowMapTexture=i;n._depthAttachment=i}function vr(n,t){for(var u,f,e=new pt({context:t,width:n._textureSize.x,height:n._textureSize.y,format:wt.DEPTH_COMPONENT16}),i=new ht({context:t,width:n._textureSize.x,height:n._textureSize.y,pixelFormat:rt.RGBA,pixelDatatype:yt.UNSIGNED_BYTE,sampler:bi()}),o=[i.negativeX,i.negativeY,i.negativeZ,i.positiveX,i.positiveY,i.positiveZ],r=0;r<6;++r)u=new lt({context:t,depthRenderbuffer:e,colorTextures:[o[r]],destroyAttachments:!1}),f=n._passes[r],f.framebuffer=u,f.passState.framebuffer=u;n._shadowMapTexture=i;n._depthAttachment=e;n._colorAttachment=i}function ki(n,t){n._isPointLight?vr(n,t):n._usesDepthTexture?ar(n,t):lr(n,t)}function yr(n,t){n._usesDepthTexture&&n._passes[0].framebuffer.status!==et.FRAMEBUFFER_COMPLETE&&(n._usesDepthTexture=!1,pi(n),wi(n),ki(n,t))}function pr(n,t){v(n._passes[0].framebuffer)&&n._shadowMapTexture.width===n._textureSize.x||(wi(n),ki(n,t),yr(n,t),di(n,t))}function di(n,t,i){i=a(i,0);(n._isPointLight||i===0)&&(n._clearCommand.framebuffer=n._passes[i].framebuffer,n._clearCommand.execute(t,n._clearPassState))}function wr(t,i){var f,e;t._size=i;var r=t._passes,s=r.length,u=t._textureSize;for(t._isPointLight?(i=st.maximumCubeMapSize>=i?i:st.maximumCubeMapSize,u.x=i,u.y=i,f=new n(0,0,i,i),r[0].passState.viewport=f,r[1].passState.viewport=f,r[2].passState.viewport=f,r[3].passState.viewport=f,r[4].passState.viewport=f,r[5].passState.viewport=f):s===1?(i=st.maximumTextureSize>=i?i:st.maximumTextureSize,u.x=i,u.y=i,r[0].passState.viewport=new n(0,0,i,i)):s===4&&(i=st.maximumTextureSize>=i*2?i:st.maximumTextureSize/2,u.x=i*2,u.y=i*2,r[0].passState.viewport=new n(0,0,i,i),r[1].passState.viewport=new n(i,0,i,i),r[2].passState.viewport=new n(0,i,i,i),r[3].passState.viewport=new n(i,i,i,i)),t._clearPassState.viewport=new n(0,0,u.x,u.y),e=0;e<s;++e){var h=r[e],o=h.passState.viewport,c=o.x/u.x,l=o.y/u.y,a=o.width/u.x,v=o.height/u.y;h.textureOffsets=new nt(a,0,0,c,0,v,0,l,0,0,1,0,0,0,0,1)}}function br(n,t){var r,i;return r=n._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv = v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y < 0.5) \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = -1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = -1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z = -1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x < 0.333) \n        { \n            dir.x = 1.0; \n            dir.y = uv.x * 6.0 - 1.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x < 0.666) \n        { \n            dir.y = 1.0; \n            dir.x = uv.x * 6.0 - 3.0; \n            dir.z = uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z = 1.0; \n            dir.x = uv.x * 6.0 - 5.0; \n            dir.y = uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow = czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(n._usesDepthTexture?"    float shadow = texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow = czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor = vec4(vec3(shadow), 1.0); \n} \n",i=t.createViewportQuadCommand(r,{uniformMap:{shadowMap_texture:function(){return n._shadowMapTexture},shadowMap_textureCube:function(){return n._shadowMapTexture}}}),i.pass=at.OVERLAY,i}function kr(t,i){var o=i.context,e=i.context.drawingBufferWidth,s=i.context.drawingBufferHeight,f=Math.min(e,s)*.3,u=gi,r;u.x=e-f;u.y=0;u.width=f;u.height=f;r=t._debugShadowViewCommand;v(r)||(r=br(t,o),t._debugShadowViewCommand=r);v(r.renderState)&&n.equals(r.renderState.viewport,u)||(r.renderState=bt.fromCache({viewport:n.clone(u)}));i.commandList.push(t._debugShadowViewCommand)}function dr(n,t){var r=new k({geometry:new i({minimum:new u(-.5,-.5,-.5),maximum:new u(.5,.5,.5)}),attributes:{color:h.fromColor(t)}}),f=new k({geometry:new ft({radius:.5}),attributes:{color:h.fromColor(t)}});return new ei({geometryInstances:[r,f],appearance:new fi({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:n})}function gr(n,t){var r,i;if(kr(n,t),r=n.debugFreezeFrame&&!n._debugFreezeFrame,n._debugFreezeFrame=n.debugFreezeFrame,n.debugFreezeFrame&&(r&&(n._debugCameraFrustum=n._debugCameraFrustum&&n._debugCameraFrustum.destroy(),n._debugCameraFrustum=new ui({camera:n._sceneCamera,color:s.CYAN,updateOnChange:!1})),n._debugCameraFrustum.update(t)),n._cascadesEnabled){if(n.debugFreezeFrame)for(r&&(n._debugLightFrustum=n._debugLightFrustum&&n._debugLightFrustum.destroy(),n._debugLightFrustum=new ui({camera:n._shadowMapCamera,color:s.YELLOW,updateOnChange:!1})),n._debugLightFrustum.update(t),i=0;i<n._numberOfCascades;++i)r&&(n._debugCascadeFrustums[i]=n._debugCascadeFrustums[i]&&n._debugCascadeFrustums[i].destroy(),n._debugCascadeFrustums[i]=new ui({camera:n._passes[i].camera,color:nr[i],updateOnChange:!1})),n._debugCascadeFrustums[i].update(t)}else if(n._isPointLight){if(!v(n._debugLightFrustum)||n._needsUpdate){var e=n._shadowMapCamera.positionWC,o=ut.IDENTITY,f=n._pointLightRadius*2,h=u.fromElements(f,f,f,tr),c=nt.fromTranslationQuaternionRotationScale(e,o,h,ci);n._debugLightFrustum=n._debugLightFrustum&&n._debugLightFrustum.destroy();n._debugLightFrustum=dr(c,s.YELLOW)}n._debugLightFrustum.update(t)}else(!v(n._debugLightFrustum)||n._needsUpdate)&&(n._debugLightFrustum=new ui({camera:n._shadowMapCamera,color:s.YELLOW,updateOnChange:!1})),n._debugLightFrustum.update(t)}function vi(){this.viewMatrix=new nt;this.inverseViewMatrix=new nt;this.frustum=undefined;this.positionCartographic=new e;this.positionWC=new u;this.directionWC=u.clone(u.UNIT_Z);this.upWC=u.clone(u.UNIT_Y);this.rightWC=u.clone(u.UNIT_X);this.viewProjectionMatrix=new nt}function ru(n,t){var c=n._shadowMapCamera,y=n._sceneCamera,p=y.frustum.near,ut=y.frustum.far,l=n._numberOfCascades,i,yt=ut-p,pt=ut/p,ot=.9,st=!1,a,r,ft,w,s,it,b,h,rt;for(t.shadowState.closestObjectSize<200&&(st=!0,ot=.9),a=iu,r=nu,r[0]=p,r[l]=ut,i=0;i<l;++i){var ht=(i+1)/l,wt=p*Math.pow(pt,ht),bt=p+yt*ht,ct=g.lerp(bt,wt,ot);r[i+1]=ct;a[i]=ct-r[i]}if(st){for(i=0;i<l;++i)a[i]=Math.min(a[i],n._maximumCascadeDistances[i]);for(ft=r[0],i=0;i<l-1;++i)ft+=a[i],r[i+1]=ft}f.unpack(r,0,n._cascadeSplits[0]);f.unpack(r,1,n._cascadeSplits[1]);f.unpack(a,0,n._cascadeDistances);var v=c.frustum,k=v.left,lt=v.right,d=v.bottom,at=v.top,tt=v.near,vt=v.far,kt=c.positionWC,dt=c.directionWC,gt=c.upWC,et=y.frustum.clone(tu),ni=c.getViewProjection();for(i=0;i<l;++i){et.near=r[i];et.far=r[i+1];var ti=nt.multiply(et.projectionMatrix,y.viewMatrix,ci),ii=nt.inverse(ti,ci),ri=nt.multiply(ni,ii,ci),o=u.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,rr),e=u.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,ur);for(w=0;w<8;++w)s=f.clone(si[w],li[w]),nt.multiplyByVector(ri,s,s),u.divideByScalar(s,s.w,s),u.minimumByComponent(s,o,o),u.maximumByComponent(s,e,e);o.x=Math.max(o.x,0);o.y=Math.max(o.y,0);o.z=0;e.x=Math.min(e.x,1);e.y=Math.min(e.y,1);e.z=Math.min(e.z,1);it=n._passes[i];b=it.camera;b.clone(c);h=b.frustum;h.left=k+o.x*(lt-k);h.right=k+e.x*(lt-k);h.bottom=d+o.y*(at-d);h.top=d+e.y*(at-d);h.near=tt+o.z*(vt-tt);h.far=tt+e.z*(vt-tt);it.cullingVolume=b.frustum.computeCullingVolume(kt,dt,gt);rt=n._cascadeMatrices[i];nt.multiply(b.getViewProjection(),y.inverseViewMatrix,rt);nt.multiply(it.textureOffsets,rt,rt)}}function ou(n,t){var i=n._shadowMapCamera,p=n._sceneCamera,d=nt.multiply(p.frustum.projectionMatrix,p.viewMatrix,ci),g=nt.inverse(d,ci),y=i.directionWC,s=p.directionWC,l=u.cross(y,s,fu),a,o,v,w;s=u.cross(l,y,eu);u.normalize(s,s);u.normalize(l,l);var tt=u.fromElements(0,0,0,fr),h=nt.computeView(tt,y,s,l,uu),it=nt.multiply(h,g,ci),e=u.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,rr),r=u.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,ur);for(a=0;a<8;++a)o=f.clone(si[a],li[a]),nt.multiplyByVector(it,o,o),u.divideByScalar(o,o.w,o),u.minimumByComponent(o,e,e),u.maximumByComponent(o,r,r);r.z+=1e3;e.z-=10;v=fr;v.x=-(.5*(e.x+r.x));v.y=-(.5*(e.y+r.y));v.z=-r.z;w=nt.fromTranslation(v,ci);h=nt.multiply(w,h,h);var b=.5*(r.x-e.x),k=.5*(r.y-e.y),rt=r.z-e.z,c=i.frustum;c.left=-b;c.right=b;c.bottom=-k;c.top=k;c.near=.01;c.far=rt;nt.clone(h,i.viewMatrix);nt.inverse(h,i.inverseViewMatrix);nt.getTranslation(i.inverseViewMatrix,i.positionWC);t.mapProjection.ellipsoid.cartesianToCartographic(i.positionWC,i.positionCartographic);u.clone(y,i.directionWC);u.clone(s,i.upWC);u.clone(l,i.rightWC)}function lu(n,t){var u=new it,r,i;for(u.fov=g.PI_OVER_TWO,u.near=1,u.far=n._pointLightRadius,u.aspectRatio=1,r=0;r<6;++r)i=n._passes[r].camera,i.positionWC=n._shadowMapCamera.positionWC,i.positionCartographic=t.mapProjection.ellipsoid.cartesianToCartographic(i.positionWC,i.positionCartographic),i.directionWC=su[r],i.upWC=hu[r],i.rightWC=cu[r],nt.computeView(i.positionWC,i.directionWC,i.upWC,i.rightWC,i.viewMatrix),nt.inverse(i.viewMatrix,i.inverseViewMatrix),i.frustum=u}function yu(n,i){var o=n._sceneCamera,f=n._shadowMapCamera,r=er,e,h;if(n._cascadesEnabled){if(o.frustum.near>=n.maximumDistance){n._outOfView=!0;n._needsUpdate=!1;return}var c=i.mapProjection.ellipsoid.geodeticSurfaceNormal(o.positionWC,au),l=u.negate(f.directionWC,vu),s=u.dot(c,l),a=g.clamp(s/.1,0,1);if(n._darkness=g.lerp(1,n.darkness,a),s<0){n._outOfView=!0;n._needsUpdate=!1;return}n._needsUpdate=!0;n._outOfView=!1}else n._isPointLight?(r.center=f.positionWC,r.radius=n._pointLightRadius,n._outOfView=i.cullingVolume.computeVisibility(r)===d.OUTSIDE,n._needsUpdate=!n._outOfView&&!n._boundingSphere.equals(r),t.clone(r,n._boundingSphere)):(e=f.frustum.far/2,h=u.add(f.positionWC,u.multiplyByScalar(f.directionWC,e,or),or),r.center=h,r.radius=e,n._outOfView=i.cullingVolume.computeVisibility(r)===d.OUTSIDE,n._needsUpdate=!n._outOfView&&!n._boundingSphere.equals(r),t.clone(r,n._boundingSphere))}function pu(n,t){var r=t.camera,s=n._lightCamera,h=n._sceneCamera,f=n._shadowMapCamera,i,e,o;n._cascadesEnabled?u.clone(s.directionWC,f.directionWC):n._isPointLight?u.clone(s.positionWC,f.positionWC):f.clone(s);i=n._lightDirectionEC;nt.multiplyByPointAsVector(r.viewMatrix,f.directionWC,i);u.normalize(i,i);u.negate(i,i);nt.multiplyByPoint(r.viewMatrix,f.positionWC,n._lightPositionEC);n._lightPositionEC.w=n._pointLightRadius;n._fitNearFar?(e=Math.min(t.shadowState.nearPlane,n.maximumDistance),o=Math.min(t.shadowState.farPlane,n.maximumDistance+1)):(e=r.frustum.near,o=n.maximumDistance);n._sceneCamera=ii.clone(r,h);r.frustum.clone(n._sceneCamera.frustum);n._sceneCamera.frustum.near=e;n._sceneCamera.frustum.far=o;n._distance=o-e;yu(n,t);!n._outOfViewPrevious&&n._outOfView&&(n._needsUpdate=!0);n._outOfViewPrevious=n._outOfView}function hr(n,t,i){var r=n._isPointLight?n._pointBias:i?n._terrainBias:n._primitiveBias,u={shadowMap_texture:function(){return n._shadowMapTexture},shadowMap_textureCube:function(){return n._shadowMapTexture},shadowMap_matrix:function(){return n._shadowMapMatrix},shadowMap_cascadeSplits:function(){return n._cascadeSplits},shadowMap_cascadeMatrices:function(){return n._cascadeMatrices},shadowMap_lightDirectionEC:function(){return n._lightDirectionEC},shadowMap_lightPositionEC:function(){return n._lightPositionEC},shadowMap_cascadeDistances:function(){return n._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var t=sr;return t.x=1/n._textureSize.x,t.y=1/n._textureSize.y,f.fromElements(t.x,t.y,r.depthBias,r.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return f.fromElements(r.normalOffsetScale,n._distance,n.maximumDistance,n._darkness,this.combinedUniforms2)},combinedUniforms1:new f,combinedUniforms2:new f};return c(t,u,!1)}function wu(n,t,i,r,u,f){var s,e,a,b;if(v(f)&&(s=f.shaderProgram,e=f.renderState,a=f.uniformMap),f=ct.shallowClone(i,f),f.castShadows=!0,f.receiveShadows=!1,!v(s)||u!==i.shaderProgram.id||t){var h=i.shaderProgram,c=i.pass===at.GLOBE,y=i.pass!==at.TRANSLUCENT,l=n._isPointLight,p=n._usesDepthTexture,w=oi.getShadowCastShaderKeyword(l,c,p,y);if(s=r.shaderCache.getDerivedShaderProgram(h,w),!v(s)){var k=h.vertexShaderSource,d=h.fragmentShaderSource,g=oi.createShadowCastVertexShader(k,l,c),nt=oi.createShadowCastFragmentShader(d,l,p,y);s=r.shaderCache.createDerivedShaderProgram(h,w,{vertexShaderSource:g,fragmentShaderSource:nt,attributeLocations:h._attributeLocations})}e=n._primitiveRenderState;l?e=n._pointRenderState:c&&(e=n._terrainRenderState);b=i.renderState.cull.enabled;b||(e=o(e,!1),e.cull=o(e.cull,!1),e.cull.enabled=!1,e=bt.fromCache(e));a=hr(n,i.uniformMap,c)}return f.shaderProgram=s,f.renderState=e,f.uniformMap=a,f}var gi,si,ci,li,ai,nr,tr,ir,sr;for(hi.MAXIMUM_DISTANCE=2e4,hi.prototype.debugCreateRenderStates=function(){pi(this)},y(hi.prototype,{enabled:{get:function(){return this._enabled},set:function(n){this.dirty=this._enabled!==n;this._enabled=n}},normalOffset:{get:function(){return this._normalOffset},set:function(n){this.dirty=this._normalOffset!==n;this._normalOffset=n;this._terrainBias.normalOffset=n;this._primitiveBias.normalOffset=n;this._pointBias.normalOffset=n}},softShadows:{get:function(){return this._softShadows},set:function(n){this.dirty=this._softShadows!==n;this._softShadows=n}},size:{get:function(){return this._size},set:function(n){wr(this,n)}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(n){this.dirty=this._debugCascadeColors!==n;this._debugCascadeColors=n}}}),gi=new n,si=new Array(8),si[0]=new f(-1,-1,-1,1),si[1]=new f(1,-1,-1,1),si[2]=new f(1,1,-1,1),si[3]=new f(-1,1,-1,1),si[4]=new f(-1,-1,1,1),si[5]=new f(1,-1,1,1),si[6]=new f(1,1,1,1),si[7]=new f(-1,1,1,1),ci=new nt,li=new Array(8),ai=0;ai<8;++ai)li[ai]=new f;nr=[s.RED,s.GREEN,s.BLUE,s.MAGENTA];tr=new u;vi.prototype.clone=function(n){nt.clone(n.viewMatrix,this.viewMatrix);nt.clone(n.inverseViewMatrix,this.inverseViewMatrix);this.frustum=n.frustum.clone(this.frustum);e.clone(n.positionCartographic,this.positionCartographic);u.clone(n.positionWC,this.positionWC);u.clone(n.directionWC,this.directionWC);u.clone(n.upWC,this.upWC);u.clone(n.rightWC,this.rightWC)};ir=new nt(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);vi.prototype.getViewProjection=function(){var n=this.viewMatrix,t=this.frustum.projectionMatrix;return nt.multiply(t,n,this.viewProjectionMatrix),nt.multiply(ir,this.viewProjectionMatrix,this.viewProjectionMatrix),this.viewProjectionMatrix};var nu=new Array(5),tu=new it,iu=new Array(4),rr=new u,ur=new u;var uu=new nt,fu=new u,eu=new u,fr=new u;var su=[new u(-1,0,0),new u(0,-1,0),new u(0,0,-1),new u(1,0,0),new u(0,1,0),new u(0,0,1)],hu=[new u(0,-1,0),new u(0,0,-1),new u(0,-1,0),new u(0,-1,0),new u(0,0,1),new u(0,-1,0)],cu=[new u(0,0,1),new u(1,0,0),new u(-1,0,0),new u(0,0,-1),new u(1,0,0),new u(1,0,0)];var au=new u,vu=new u,er=new t,or=er.center;return hi.prototype.update=function(n){var i;if(pu(this,n),this._needsUpdate)if(pr(this,n.context),this._isPointLight&&lu(this,n),this._cascadesEnabled&&(ou(this,n),this._numberOfCascades>1&&ru(this,n)),this._isPointLight)this._shadowMapCullingVolume=l.fromBoundingSphere(this._boundingSphere);else{var t=this._shadowMapCamera,r=t.positionWC,u=t.directionWC,f=t.upWC;this._shadowMapCullingVolume=t.frustum.computeCullingVolume(r,u,f);this._passes.length===1&&this._passes[0].camera.clone(t)}this._passes.length===1&&(i=this._sceneCamera.inverseViewMatrix,nt.multiply(this._shadowMapCamera.getViewProjection(),i,this._shadowMapMatrix));this.debugShow&&gr(this,n)},hi.prototype.updatePass=function(n,t){di(this,n,t)},sr=new r,hi.createReceiveDerivedCommand=function(n,t,i,r,u){var f,h,l,a,c,y,p;v(u)||(u={});var w=n.length>0,e=t.shaderProgram,b=e.vertexShaderSource,k=e.fragmentShaderSource,o=t.pass===at.GLOBE,s=!1;return o&&(s=t.owner.data.pickTerrain.mesh.encoding.hasVertexNormals),t.receiveShadows&&w&&(v(u.receiveCommand)&&(f=u.receiveCommand.shaderProgram,h=u.receiveCommand.uniformMap),u.receiveCommand=ct.shallowClone(t,u.receiveCommand),u.castShadows=!1,u.receiveShadows=!0,l=u.receiveShaderCastShadows!==t.castShadows,a=u.receiveShaderProgramId!==t.shaderProgram.id,(!v(f)||a||i||l)&&(c=oi.getShadowReceiveShaderKeyword(n[0],t.castShadows,o,s),f=r.shaderCache.getDerivedShaderProgram(e,c),v(f)||(y=oi.createShadowReceiveVertexShader(b,o,s),p=oi.createShadowReceiveFragmentShader(k,n[0],t.castShadows,o,s),f=r.shaderCache.createDerivedShaderProgram(e,c,{vertexShaderSource:y,fragmentShaderSource:p,attributeLocations:e._attributeLocations})),h=hr(n[0],t.uniformMap,o)),u.receiveCommand.shaderProgram=f,u.receiveCommand.uniformMap=h,u.receiveShaderProgramId=t.shaderProgram.id,u.receiveShaderCastShadows=t.castShadows),u},hi.createCastDerivedCommand=function(n,t,i,r,u){var f,s,o,e;if(v(u)||(u={}),t.castShadows){for(f=u.castCommands,v(f)||(f=u.castCommands=[]),s=u.castShaderProgramId,o=n.length,f.length=o,e=0;e<o;++e)f[e]=wu(n[e],i,t,r,s,f[e]);u.castShaderProgramId=t.shaderProgram.id}return u},hi.prototype.isDestroyed=function(){return!1},hi.prototype.destroy=function(){wi(this);this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy();this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy();this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var n=0;n<this._numberOfCascades;++n)this._debugCascadeFrustums[n]=this._debugCascadeFrustums[n]&&this._debugCascadeFrustums[n].destroy();return p(this)},hi});t("Shaders/PostProcessStages/AdditiveBlend",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform sampler2D colorTexture2;\nuniform vec2 center;\nuniform float radius;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 color0 = texture2D(colorTexture, v_textureCoordinates);\nvec4 color1 = texture2D(colorTexture2, v_textureCoordinates);\nfloat x = length(gl_FragCoord.xy - center) / radius;\nfloat t = smoothstep(0.5, 0.8, x);\ngl_FragColor = mix(color0 + color1, color1, t);\n}\n"});t("Shaders/PostProcessStages/BrightPass",[],function(){"use strict";return"uniform sampler2D colorTexture;\nuniform float avgLuminance;\nuniform float threshold;\nuniform float offset;\nvarying vec2 v_textureCoordinates;\nfloat key(float avg)\n{\nfloat guess = 1.5 - (1.5 / (avg * 0.1 + 1.0));\nreturn max(0.0, guess) + 0.1;\n}\nvoid main()\n{\nvec4 color = texture2D(colorTexture, v_textureCoordinates);\nvec3 xyz = czm_RGBToXYZ(color.rgb);\nfloat luminance = xyz.r;\nfloat scaledLum = key(avgLuminance) * luminance / avgLuminance;\nfloat brightLum = max(scaledLum - threshold, 0.0);\nfloat brightness = brightLum / (offset + brightLum);\nxyz.r = brightness;\ngl_FragColor = vec4(czm_XYZToRGB(xyz), 1.0);\n}\n"});t("Scene/SceneFramebuffer",["../Core/Color","../Core/defined","../Core/destroyObject","../Core/PixelFormat","../Renderer/ClearCommand","../Renderer/Framebuffer","../Renderer/PixelDatatype","../Renderer/Renderbuffer","../Renderer/RenderbufferFormat","../Renderer/RenderState","../Renderer/Sampler","../Renderer/Texture","../Renderer/TextureMagnificationFilter","../Renderer/TextureMinificationFilter","../Renderer/TextureWrap"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){"use strict";function p(){this._colorTexture=undefined;this._idTexture=undefined;this._depthStencilTexture=undefined;this._depthStencilRenderbuffer=undefined;this._framebuffer=undefined;this._idFramebuffer=undefined;this._idClearColor=new n(0,0,0,0);this._clearCommand=new u({color:new n(0,0,0,0),depth:1,owner:this})}function w(n){n._framebuffer=n._framebuffer&&n._framebuffer.destroy();n._idFramebuffer=n._idFramebuffer&&n._idFramebuffer.destroy();n._colorTexture=n._colorTexture&&n._colorTexture.destroy();n._idTexture=n._idTexture&&n._idTexture.destroy();n._depthStencilTexture=n._depthStencilTexture&&n._depthStencilTexture.destroy();n._depthStencilRenderbuffer=n._depthStencilRenderbuffer&&n._depthStencilRenderbuffer.destroy();n._depthStencilIdTexture=n._depthStencilIdTexture&&n._depthStencilIdTexture.destroy();n._depthStencilIdRenderbuffer=n._depthStencilIdRenderbuffer&&n._depthStencilIdRenderbuffer.destroy();n._framebuffer=undefined;n._idFramebuffer=undefined;n._colorTexture=undefined;n._idTexture=undefined;n._depthStencilTexture=undefined;n._depthStencilRenderbuffer=undefined;n._depthStencilIdTexture=undefined;n._depthStencilIdRenderbuffer=undefined}return p.prototype.update=function(n,i){var u=i.width,h=i.height,p=this._colorTexture;t(p)&&p.width===u&&p.height===h||(w(this),this._colorTexture=new l({context:n,width:u,height:h,pixelFormat:r.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new c({wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE,minificationFilter:v.NEAREST,magnificationFilter:a.NEAREST})}),this._idTexture=new l({context:n,width:u,height:h,pixelFormat:r.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new c({wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE,minificationFilter:v.NEAREST,magnificationFilter:a.NEAREST})}),n.depthTexture?(this._depthStencilTexture=new l({context:n,width:u,height:h,pixelFormat:r.DEPTH_STENCIL,pixelDatatype:e.UNSIGNED_INT_24_8,sampler:new c({wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE,minificationFilter:v.NEAREST,magnificationFilter:a.NEAREST})}),this._depthStencilIdTexture=new l({context:n,width:u,height:h,pixelFormat:r.DEPTH_STENCIL,pixelDatatype:e.UNSIGNED_INT_24_8,sampler:new c({wrapS:y.CLAMP_TO_EDGE,wrapT:y.CLAMP_TO_EDGE,minificationFilter:v.NEAREST,magnificationFilter:a.NEAREST})})):(this._depthStencilRenderbuffer=new o({context:n,width:u,height:h,format:s.DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new o({context:n,width:u,height:h,format:s.DEPTH_STENCIL})),this._framebuffer=new f({context:n,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._idFramebuffer=new f({context:n,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1}))},p.prototype.clear=function(t,i,r){var u=i.framebuffer;i.framebuffer=this._framebuffer;n.clone(r,this._clearCommand.color);this._clearCommand.execute(t,i);i.framebuffer=this._idFramebuffer;n.clone(this._idClearColor,this._clearCommand.color);this._clearCommand.execute(t,i);i.framebuffer=u},p.prototype.getFramebuffer=function(){return this._framebuffer},p.prototype.getIdFramebuffer=function(){return this._idFramebuffer},p.prototype.isDestroyed=function(){return!1},p.prototype.destroy=function(){return w(this),i(this)},p});t("Scene/SunPostProcess",["../Core/BoundingRectangle","../Core/Cartesian2","../Core/Cartesian4","../Core/defined","../Core/destroyObject","../Core/Math","../Core/Matrix4","../Core/Transforms","../Shaders/PostProcessStages/AdditiveBlend","../Shaders/PostProcessStages/BrightPass","../Shaders/PostProcessStages/GaussianBlur1D","../Shaders/PostProcessStages/PassThrough","./PostProcessStage","./PostProcessStageComposite","./PostProcessStageSampleMode","./PostProcessStageTextureCache","./SceneFramebuffer"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(){var r,i,f,n,e,o,u;for(this._sceneFramebuffer=new w,r=.125,i=new Array(6),i[0]=new a({fragmentShader:l,textureScale:r,forcePowerOfTwo:!0,sampleMode:y.LINEAR}),f=i[1]=new a({fragmentShader:h,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:r,forcePowerOfTwo:!0}),n=this,this._delta=1,this._sigma=2,this._blurStep=new t,i[2]=new a({fragmentShader:c,uniforms:{step:function(){return n._blurStep.x=n._blurStep.y=1/f.outputTexture.width,n._blurStep},delta:function(){return n._delta},sigma:function(){return n._sigma},direction:0},textureScale:r,forcePowerOfTwo:!0}),i[3]=new a({fragmentShader:c,uniforms:{step:function(){return n._blurStep.x=n._blurStep.y=1/f.outputTexture.width,n._blurStep},delta:function(){return n._delta},sigma:function(){return n._sigma},direction:1},textureScale:r,forcePowerOfTwo:!0}),i[4]=new a({fragmentShader:l,sampleMode:y.LINEAR}),this._uCenter=new t,this._uRadius=undefined,i[5]=new a({fragmentShader:s,uniforms:{center:function(){return n._uCenter},radius:function(){return n._uRadius},colorTexture2:function(){return n._sceneFramebuffer.getFramebuffer().getColorTexture(0)}}}),this._stages=new v({stages:i}),e=new p(this),o=i.length,u=0;u<o;++u)i[u]._textureCache=e;this._textureCache=e;this.length=i.length}function tt(i,r,u){var l=r.uniformState,y=l.sunPositionWC,ht=l.view,tt=l.viewProjection,ct=l.projection,a=e.computeViewportTransformation(u,0,1,d),p=e.multiplyByPoint(ht,y,g),c=o.pointToGLWindowCoordinates(tt,a,y,k),h,v;p.x+=f.SOLAR_RADIUS;var it=o.pointToGLWindowCoordinates(ct,a,p,p),rt=t.magnitude(t.subtract(it,c,it))*60,s=nt;s.x=rt;s.y=rt;i._uCenter=t.clone(c,i._uCenter);i._uRadius=Math.max(s.x,s.y)*.15;var ut=r.drawingBufferWidth,ft=r.drawingBufferHeight,et=i._stages,w=et.get(0),ot=w.outputTexture.width,st=w.outputTexture.height,b=new n;for(b.width=ot,b.height=st,a=e.computeViewportTransformation(b,0,1,d),c=o.pointToGLWindowCoordinates(tt,a,y,k),s.x*=ot/ut,s.y*=st/ft,h=w.scissorRectangle,h.x=Math.max(c.x-s.x*.5,0),h.y=Math.max(c.y-s.y*.5,0),h.width=Math.min(s.x,ut),h.height=Math.min(s.y,ft),v=1;v<4;++v)n.clone(h,et.get(v).scissorRectangle)}b.prototype.get=function(n){return this._stages.get(n)};b.prototype.getStageByName=function(n){for(var i,r=this._stages.length,t=0;t<r;++t)if(i=this._stages.get(t),i.name===n)return i;return undefined};var g=new i,k=new t,nt=new t,d=new e;return b.prototype.clear=function(n,t,i){this._sceneFramebuffer.clear(n,t,i);this._textureCache.clear(n)},b.prototype.update=function(n){var t=n.context,i=n.viewport,r=this._sceneFramebuffer,u;return r.update(t,i),u=r.getFramebuffer(),this._textureCache.update(t),this._stages.update(t,!1),tt(this,t,i),u},b.prototype.execute=function(n){var r=this._sceneFramebuffer.getFramebuffer().getColorTexture(0),i=this._stages,u=i.length,t;for(i.get(0).execute(n,r),t=1;t<u;++t)i.get(t).execute(n,i.get(t-1).outputTexture)},b.prototype.copy=function(n,t){if(!r(this._copyColorCommand)){var i=this;this._copyColorCommand=n.createViewportQuadCommand(l,{uniformMap:{colorTexture:function(){return i._stages.get(i._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t;this._copyColorCommand.execute(n)},b.prototype.isDestroyed=function(){return!1},b.prototype.destroy=function(){return this._textureCache.destroy(),this._stages.destroy(),u(this)},b});t("Scene/View",["../Core/BoundingRectangle","../Core/Cartesian3","../Core/CullingVolume","../Core/defined","../Core/getTimestamp","../Core/Interval","../Core/Math","../Core/Matrix4","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Renderer/ClearCommand","../Renderer/Pass","../Renderer/PassState","./Camera","./FrustumCommands","./GlobeDepth","./OIT","./PickDepthFramebuffer","./PickFramebuffer","./SceneFramebuffer","./SceneMode","./ShadowMap"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){"use strict";function it(t,i,r){var u=t.context,e=[],o=i.frustum.near,s=i.frustum.far,h=t.logarithmicDepthBuffer?t.logarithmicDepthFarToNearRatio:t.farToNearRatio,y=Math.ceil(Math.log(s/o)/Math.log(h)),c,l,f;et(o,s,h,y,t.logarithmicDepthBuffer,e,!1,undefined);u.depthTexture&&(c=new p);t._useOIT&&u.depthTexture&&(l=new w(u));f=new a(u);f.viewport=n.clone(r);this.camera=i;this._cameraClone=v.clone(i);this._cameraStartFired=!1;this._cameraMovedTime=undefined;this.viewport=r;this.passState=f;this.pickFramebuffer=new k(u);this.pickDepthFramebuffer=new b;this.sceneFramebuffer=new d;this.globeDepth=c;this.oit=l;this.pickDepths=[];this.debugGlobeDepths=[];this.frustumCommandsList=e;this.debugFrustumStatistics=undefined;this.updateFrustums=!1}function ot(n,t){var i=Math.max(Math.abs(n.x),Math.abs(t.x)),r=Math.max(Math.abs(n.y),Math.abs(t.y)),u=Math.max(Math.abs(n.z),Math.abs(t.z));return Math.max(Math.max(i,r),u)}function st(n,i,r){var u=1/Math.max(1,ot(n.position,i.position));return t.multiplyByScalar(n.position,u,ut),t.multiplyByScalar(i.position,u,ft),t.equalsEpsilon(ut,ft,r)&&t.equalsEpsilon(n.direction,i.direction,r)&&t.equalsEpsilon(n.up,i.up,r)&&t.equalsEpsilon(n.right,i.right,r)&&o.equalsEpsilon(n.transform,i.transform,r)&&n.frustum.equalsEpsilon(i.frustum,r)}function et(n,t,i,u,f,e,o,s){var h,c,l,a;for(e.length=u,h=0;h<u;++h)o?(c=Math.min(t-s,n+h*s),l=Math.min(t,c+s)):(c=Math.max(n,Math.pow(i,h)*n),l=i*c,f||(l=Math.min(t,l))),a=e[h],r(a)?(a.near=c,a.far=l):a=e[h]=new y(c,l)}function ht(n,t,i,u){var s,c,f,h,l,o;for(n.debugShowFrustums&&(i.debugOverlappingFrustums=0),s=t.frustumCommandsList,c=s.length,f=0;f<c;++f){var e=s[f],a=e.near,v=e.far;if(!(u.start>v)){if(u.stop<a)break;if(h=i.pass,l=e.indices[h]++,e.commands[h][l]=i,n.debugShowFrustums&&(i.debugOverlappingFrustums|=1<<f),i.executeInClosestFrustum)break}}n.debugShowFrustums&&(o=t.debugFrustumStatistics.commandsInFrustums,o[i.debugOverlappingFrustums]=r(o[i.debugOverlappingFrustums])?o[i.debugOverlappingFrustums]+1:1,++t.debugFrustumStatistics.totalCommands);n.updateDerivedCommands(i)}var ut=new t,ft=new t,rt,tt;return it.prototype.checkForCameraUpdates=function(n){var t=this.camera,i=this._cameraClone;return st(t,i,e.EPSILON15)?(this._cameraStartFired&&u()-this._cameraMovedTime>n.cameraEventWaitTime&&(t.moveEnd.raiseEvent(),this._cameraStartFired=!1),!1):(this._cameraStartFired||(t.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=u(),v.clone(t,i),!0)},rt=new i,tt=new f,it.prototype.createPotentiallyVisibleSet=function(n){var f=n.frameState,t=f.camera,gt=t.directionWC,ni=t.positionWC,at=n._computeCommandList,vt=n._overlayCommandList,yt=f.commandList,k,d,p,wt,it,s,w,ct,bt,ut,h;n.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});var o=this.frustumCommandsList,b=o.length,ti=l.NUMBER_OF_PASSES;for(k=0;k<b;++k)for(d=0;d<ti;++d)o[k].indices[d]=0;at.length=0;vt.length=0;var i=Number.MAX_VALUE,u=-Number.MAX_VALUE,pt=!1,ft=f.shadowState.shadowsEnabled,v=Number.MAX_VALUE,y=-Number.MAX_VALUE,ot=Number.MAX_VALUE,ii=f.mode===g.SCENE3D?f.occluder:undefined,st=f.cullingVolume,ri=rt.planes;for(p=0;p<5;++p)ri[p]=st.planes[p];for(st=rt,wt=yt.length,it=0;it<wt;++it)if(s=yt[it],w=s.pass,w===l.COMPUTE)at.push(s);else if(w===l.OVERLAY)vt.push(s);else{if(ct=s.boundingVolume,r(ct)){if(!n.isVisible(s,st,ii))continue;tt=ct.computePlaneDistances(ni,gt,tt);i=Math.min(i,tt.start);u=Math.max(u,tt.stop);ft&&s.receiveShadows&&tt.start<nt.MAXIMUM_DISTANCE&&!(w===l.GLOBE&&tt.start<-100&&tt.stop>100)&&(bt=tt.stop-tt.start,w!==l.GLOBE&&tt.start<100&&(ot=Math.min(ot,bt)),v=Math.min(v,tt.start),y=Math.max(y,tt.stop))}else tt.start=t.frustum.near,tt.stop=t.frustum.far,pt=!(s instanceof c);ht(n,this,s,tt)}pt?(i=t.frustum.near,u=t.frustum.far):(i=Math.min(Math.max(i,t.frustum.near),t.frustum.far),u=Math.max(Math.min(u,t.frustum.far),i),ft&&(v=Math.min(Math.max(v,t.frustum.near),t.frustum.far),y=Math.max(Math.min(y,t.frustum.far),v)));ft&&(f.shadowState.nearPlane=v,f.shadowState.farPlane=y,f.shadowState.closestObjectSize=ot);var kt=n.mode===g.SCENE2D,lt=f.useLogDepth,dt=lt?n.logarithmicDepthFarToNearRatio:n.farToNearRatio,a;for(kt?(u=Math.min(u,t.position.z+n.nearToFarDistance2D),i=Math.min(i,u),a=Math.ceil(Math.max(1,u-i)/n.nearToFarDistance2D)):a=Math.ceil(Math.log(u/i)/Math.log(dt)),(this.updateFrustums||i!==Number.MAX_VALUE&&(a!==b||o.length!==0&&(i<o[0].near||u>o[b-1].far&&(lt||!e.equalsEpsilon(u,o[b-1].far,e.EPSILON8)))))&&(this.updateFrustums=!1,et(i,u,dt,a,lt,o,kt,n.nearToFarDistance2D),this.createPotentiallyVisibleSet(n)),ut=f.frustumSplits,ut.length=a+1,h=0;h<a;++h)ut[h]=o[h].near,h===a-1&&(ut[h+1]=o[h].far)},it.prototype.destroy=function(){this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy();this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy();this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy();this.globeDepth=this.globeDepth&&this.globeDepth.destroy();this.oit=this.oit&&this.oit.destroy();for(var i=this.pickDepths,r=this.debugGlobeDepths,t=i.length,n=0;n<t;++n)i[n].destroy();for(t=r.length,n=0;n<t;++n)r[n].destroy()},it});t("Scene/Scene",["../Core/ApproximateTerrainHeights","../Core/BoundingRectangle","../Core/BoundingSphere","../Core/BoxGeometry","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartographic","../Core/Check","../Core/Color","../Core/ColorGeometryInstanceAttribute","../Core/createGuid","../Core/CullingVolume","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/deprecationWarning","../Core/destroyObject","../Core/DeveloperError","../Core/EllipsoidGeometry","../Core/Event","../Core/GeographicProjection","../Core/GeometryInstance","../Core/GeometryPipeline","../Core/Intersect","../Core/JulianDate","../Core/Math","../Core/Matrix4","../Core/mergeSort","../Core/Occluder","../Core/OrthographicFrustum","../Core/OrthographicOffCenterFrustum","../Core/PerspectiveFrustum","../Core/PerspectiveOffCenterFrustum","../Core/PixelFormat","../Core/Ray","../Core/RequestScheduler","../Core/ShowGeometryInstanceAttribute","../Core/TaskProcessor","../Core/Transforms","../Renderer/ClearCommand","../Renderer/ComputeEngine","../Renderer/Context","../Renderer/ContextLimits","../Renderer/DrawCommand","../Renderer/Framebuffer","../Renderer/Pass","../Renderer/PixelDatatype","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/Texture","./BrdfLutGenerator","./Camera","./Cesium3DTileFeature","./CreditDisplay","./DebugCameraPrimitive","./DepthPlane","./DerivedCommand","./DeviceOrientationCameraController","./Fog","./FrameState","./GlobeDepth","./InvertClassification","./JobScheduler","./MapMode2D","./PerformanceDisplay","./PerInstanceColorAppearance","./PickDepth","./PostProcessStageCollection","./Primitive","./PrimitiveCollection","./SceneMode","./SceneTransforms","./SceneTransitioner","./ScreenSpaceCameraController","./ShadowMap","./SunPostProcess","./TweenCollection","./View"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr,tr,ir,rr,ur,fr,er,or,sr,hr,cr,lr,ar,vr,yr){"use strict";function pr(n){var o,r,h,f,y,l;n=a(n,a.EMPTY_OBJECT);var u=n.canvas,p=n.contextOptions,i=n.creditContainer,e=n.creditViewport;if(!v(u))throw new b("options and options.canvas are required.");o=v(i);r=new gt(u,p);o||(i=document.createElement("div"),i.style.position="absolute",i.style.bottom="0",i.style["text-shadow"]="0 0 2px #000000",i.style.color="#ffffff",i.style["font-size"]="10px",i.style["padding-right"]="5px",u.parentNode.appendChild(i));v(e)||(e=u.parentNode);this._id=c();this._jobScheduler=new gi;this._frameState=new bi(r,new li(i,"  ",e),this._jobScheduler);this._frameState.scene3DOnly=a(n.scene3DOnly,!1);this._removeCreditContainer=!o;this._creditContainer=i;this._canvas=u;this._context=r;this._computeEngine=new dt(r);this._globe=undefined;this._primitives=new er;this._groundPrimitives=new er;this._logDepthBuffer=r.fragmentDepth;this._logDepthBufferDirty=!0;this._tweens=new vr;this._shaderFrameCount=0;this._sunPostProcess=undefined;this._computeCommandList=[];this._overlayCommandList=[];this._useOIT=a(n.orderIndependentTranslucency,!0);this._executeOITFunction=undefined;this._depthPlane=new vi;this._clearColorCommand=new kt({color:new s,stencil:0,owner:this});this._depthClearCommand=new kt({depth:1,owner:this});this._stencilClearCommand=new kt({stencil:0});this._depthOnlyRenderStateCache={};this._pickRenderStateCache={};this._transitioner=new hr(this);this._preUpdate=new d;this._postUpdate=new d;this._renderError=new d;this._preRender=new d;this._postRender=new d;this._pickPositionCache={};this._pickPositionCacheDirty=!1;this._minimumDisableDepthTestDistance=0;this.rethrowRenderErrors=!1;this.completeMorphOnUserInput=!0;this.morphStart=new d;this.morphComplete=new d;this.skyBox=undefined;this.skyAtmosphere=undefined;this.sun=undefined;this.sunBloom=!0;this._sunBloom=undefined;this.moon=undefined;this.backgroundColor=s.clone(s.BLACK);this._mode=or.SCENE3D;this._mapProjection=v(n.mapProjection)?n.mapProjection:new g;this.morphTime=1;this.farToNearRatio=1e3;this.logarithmicDepthFarToNearRatio=1e9;this.nearToFarDistance2D=175e4;this.debugCommandFilter=undefined;this.debugShowCommands=!1;this.debugShowFrustums=!1;this.debugShowFramesPerSecond=!1;this.debugShowGlobeDepth=!1;this.debugShowDepthFrustum=1;this.debugShowFrustumPlanes=!1;this._debugShowFrustumPlanes=!1;this._debugFrustumPlanes=undefined;this.useDepthPicking=!0;this.pickTranslucentDepth=!1;this.cameraEventWaitTime=500;this.fog=new wi;this._sunCamera=new hi(this);this.shadowMap=new lr({context:r,lightCamera:this._sunCamera,enabled:a(n.shadows,!1)});this.invertClassification=!1;this.invertClassificationColor=s.clone(s.WHITE);this._actualInvertClassificationColor=s.clone(this._invertClassificationColor);this._invertClassification=new di;this.focalLength=undefined;this.eyeSeparation=undefined;this.postProcessStages=new ur;this._brdfLutGenerator=new si;this._terrainExaggeration=a(n.terrainExaggeration,1);this._performanceDisplay=undefined;this._debugVolume=undefined;this._screenSpaceCameraController=new cr(this);this._mapMode2D=a(n.mapMode2D,nr.INFINITE_SCROLL);this._environmentState={skyBoxCommand:undefined,skyAtmosphereCommand:undefined,sunDrawCommand:undefined,sunComputeCommand:undefined,moonCommand:undefined,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:undefined,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1};this._useWebVR=!1;this._cameraVR=undefined;this._aspectRatioVR=undefined;this.requestRenderMode=a(n.requestRenderMode,!1);this._renderRequested=!0;this.maximumRenderTimeChange=a(n.maximumRenderTimeChange,0);this._lastRenderTime=undefined;this._frameRateMonitor=undefined;this._removeRequestListenerCallback=yt.requestCompletedEvent.addEventListener(iu(this));this._removeTaskProcessorListenerCallback=wt.taskCompletedEvent.addEventListener(iu(this));this._removeGlobeCallbacks=[];h=new t(0,0,r.drawingBufferWidth,r.drawingBufferHeight);f=new hi(this);this._logDepthBuffer&&(f.frustum.near=.1,f.frustum.far=1e10);y=new t(0,0,1,1);l=new hi(this);l.frustum=new st({width:.01,aspectRatio:1,near:.1});this._view=new yr(this,f,h);this._pickOffscreenView=new yr(this,l,y);this._defaultView=new yr(this,f,h);this._view=this._defaultView;ru(this,0,rt.now());this.initializeFrame()}function df(n,t){for(var r,i=0;i<n._removeGlobeCallbacks.length;++i)n._removeGlobeCallbacks[i]();n._removeGlobeCallbacks.length=0;r=[];v(t)&&(r.push(t.imageryLayersUpdatedEvent.addEventListener(iu(n))),r.push(t.terrainProviderChanged.addEventListener(iu(n))));n._removeGlobeCallbacks=r}function bu(n,t,i){var e=n._frameState,u=n._context,f=n._view.oit,s=e.shadowState.lightShadowMaps,o=e.shadowState.lightShadowsEnabled,r=t.derivedCommands;o&&t.receiveShadows&&(r.shadows=lr.createReceiveDerivedCommand(s,t,i,u,r.shadows));v(t.pickId)&&(r.picking=yi.createPickDerivedCommand(n,t,u,r.picking));t.pass===ri.TRANSLUCENT&&v(f)&&f.isSupported()&&(o&&t.receiveShadows?(r.oit=v(r.oit)?r.oit:{},r.oit.shadows=f.createDerivedCommands(r.shadows.receiveCommand,u,r.oit.shadows)):r.oit=f.createDerivedCommands(t,u,r.oit));t.pickOnly||(r.depth=yi.createDepthOnlyDerivedCommand(n,t,u,r.depth));r.originalCommand=t}function gf(n){var t=n.globe,i;return n._mode===or.SCENE3D&&v(t)&&t.show?(i=t.ellipsoid,hu.radius=i.minimumRadius,cu=ot.fromBoundingSphere(hu,n.camera.positionWC,cu)):undefined}function ku(n){n.render=!1;n.pick=!1;n.depth=!1;n.postProcess=!1;n.offscreen=!1}function ru(n,t,i){var u=n.camera,r=n._frameState;r.commandList.length=0;r.shadowMaps.length=0;r.brdfLutGenerator=n._brdfLutGenerator;r.environmentMap=n.skyBox&&n.skyBox._cubeMap;r.mode=n._mode;r.morphTime=n.morphTime;r.mapProjection=n.mapProjection;r.frameNumber=t;r.time=rt.clone(i,r.time);r.camera=u;r.cullingVolume=u.frustum.computeCullingVolume(u.positionWC,u.directionWC,u.upWC);r.occluder=gf(n);r.terrainExaggeration=n._terrainExaggeration;r.minimumDisableDepthTestDistance=n._minimumDisableDepthTestDistance;r.invertClassification=n.invertClassification;r.useLogDepth=n._logDepthBuffer&&!(n.camera.frustum instanceof st||n.camera.frustum instanceof ht);n._actualInvertClassificationColor=s.clone(n.invertClassificationColor,n._actualInvertClassificationColor);di.isTranslucencySupported(n._context)||(n._actualInvertClassificationColor.alpha=1);r.invertClassificationColor=n._actualInvertClassificationColor;r.maximumScreenSpaceError=v(n.globe)?n.globe.maximumScreenSpaceError:2;ku(r.passes)}function ne(n){var r={},t=n.vertexAttributes;for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i].index);return r}function te(n,t,i){var b=t.context,c=a(i,n.shaderProgram),h=c.fragmentShaderSource.clone(),e=[],o,u,r,f,w;if(h.sources=h.sources.map(function(n){n=ei.replaceMain(n,"czm_Debug_main");for(var i=/gl_FragData\[(\d+)\]/g,t;(t=i.exec(n))!==null;)e.indexOf(t[1])===-1&&e.push(t[1]);return n}),o=e.length,u="void main() \n{ \n    czm_Debug_main(); \n",t.debugShowCommands)if(v(n._debugColor)||(n._debugColor=s.fromRandom()),f=n._debugColor,o>0)for(r=0;r<o;++r)u+="    gl_FragData["+e[r]+"].rgb *= vec3("+f.red+", "+f.green+", "+f.blue+"); \n";else u+="    gl_FragColor.rgb *= vec3("+f.red+", "+f.green+", "+f.blue+"); \n";if(t.debugShowFrustums){var l=n.debugOverlappingFrustums&1?"1.0":"0.0",y=n.debugOverlappingFrustums&2?"1.0":"0.0",p=n.debugOverlappingFrustums&4?"1.0":"0.0";if(o>0)for(r=0;r<o;++r)u+="    gl_FragData["+e[r]+"].rgb *= vec3("+l+", "+y+", "+p+"); \n";else u+="    gl_FragColor.rgb *= vec3("+l+", "+y+", "+p+"); \n"}return u+="}",h.sources.push(u),w=ne(c),fi.fromCache({context:b,vertexShaderSource:c.vertexShaderSource,fragmentShaderSource:h,attributeLocations:w})}function ie(n,t,i){var r=ti.shallowClone(n);r.shaderProgram=te(n,t);r.execute(t.context,i);r.shaderProgram.destroy()}function re(n,t,i,u){var e=t._frameState,p=e.context,s=n.boundingVolume,c,o,a,w,l,b,d,g,it,y;v(t._debugVolume)&&t._debugVolume.destroy();o=f.clone(s.center);e.mode!==or.SCENE3D&&(o=ft.multiplyByPoint(gr,o,o),a=e.mapProjection,w=a.unproject(o),o=a.ellipsoid.cartographicToCartesian(w));v(s.radius)?(l=s.radius,c=tt.toWireframe(k.createGeometry(new k({radii:new f(l,l,l),vertexFormat:ir.FLAT_VERTEX_FORMAT}))),t._debugVolume=new fr({geometryInstances:new nt({geometry:c,modelMatrix:ft.fromTranslation(o),attributes:{color:new h(1,0,0,1)}}),appearance:new ir({flat:!0,translucent:!1}),asynchronous:!1})):(b=s.halfAxes,c=tt.toWireframe(r.createGeometry(r.fromDimensions({dimensions:new f(2,2,2),vertexFormat:ir.FLAT_VERTEX_FORMAT}))),t._debugVolume=new fr({geometryInstances:new nt({geometry:c,modelMatrix:ft.fromRotationTranslation(b,o,new ft),attributes:{color:new h(1,0,0,1)}}),appearance:new ir({flat:!0,translucent:!1}),asynchronous:!1}));d=e.commandList;g=e.commandList=[];t._debugVolume.update(e);n=g[0];e.useLogDepth&&(it=yi.createLogDepthCommand(n,p),n=it.command);v(u)&&(y=i.framebuffer,i.framebuffer=u);n.execute(p,i);v(y)&&(i.framebuffer=y);e.commandList=d}function wr(n,t,i,r,u){var e=t._frameState,f;if(!v(t.debugCommandFilter)||t.debugCommandFilter(n)){if(n instanceof kt){n.execute(i,r);return}if(n.debugShowBoundingVolume&&v(n.boundingVolume)&&re(n,t,r,u),e.useLogDepth&&v(n.derivedCommands.logDepth)&&(n=n.derivedCommands.logDepth.command),f=e.passes,f.pick||f.depth){if(f.pick&&!f.depth&&v(n.derivedCommands.picking)){n=n.derivedCommands.picking.pickCommand;n.execute(i,r);return}if(v(n.derivedCommands.depth)){n=n.derivedCommands.depth.depthOnlyCommand;n.execute(i,r);return}}if(t.debugShowCommands||t.debugShowFrustums){ie(n,t,r);return}e.shadowState.lightShadowsEnabled&&n.receiveShadows&&v(n.derivedCommands.shadows)?n.derivedCommands.shadows.receiveCommand.execute(i,r):n.execute(i,r)}}function uu(n,t,i,r){var f=t._frameState,u=n.derivedCommands;v(u)&&(f.useLogDepth&&v(u.logDepth)&&(n=u.logDepth.command),u=n.derivedCommands,v(u.picking)?(n=u.picking.pickCommand,n.execute(i,r)):v(u.depth)&&(n=u.depth.depthOnlyCommand,n.execute(i,r)))}function ue(n,t,i){return t.boundingVolume.distanceSquaredTo(i)-n.boundingVolume.distanceSquaredTo(i)}function fe(n,t,i){return n.boundingVolume.distanceSquaredTo(i)-t.boundingVolume.distanceSquaredTo(i)+ut.EPSILON12}function ee(n,t,i,r,u){var e=n.context,o,f;for(et(r,ue,n.camera.positionWC),v(u)&&t(u.unclassifiedCommand,n,e,i),o=r.length,f=0;f<o;++f)t(r[f],n,e,i)}function oe(n,t,i,r,u){var e=n.context,o,f;for(et(r,fe,n.camera.positionWC),v(u)&&t(u.unclassifiedCommand,n,e,i),o=r.length,f=0;f<o;++f)t(r[f],n,e,i)}function du(n,t){var r=n._view.debugGlobeDepths,i=r[t];return!v(i)&&n.context.depthTexture&&(i=new ki,r[t]=i),i}function fu(n,t){var r=n._view.pickDepths,i=r[t];return v(i)||(i=new rr,r[t]=i),i}function au(n,t){var c=n.camera,r=n.context,o=r.uniformState,h,d,g,nt,k,y,u,l,ht,f,e,ct,lt,at,it,vt;o.updateCamera(c);h=v(c.frustum.fov)?c.frustum.clone(gu):v(c.frustum.infiniteProjectionMatrix)?c.frustum.clone(nf):v(c.frustum.width)?c.frustum.clone(tf):c.frustum.clone(rf);h.near=c.frustum.near;h.far=c.frustum.far;o.updateFrustum(h);o.updatePass(ri.ENVIRONMENT);var rt=n._frameState.passes,w=rt.pick,s=n._environmentState,a=n._view,ut=s.renderTranslucentDepthForPick,yt=s.useWebVR;w||(d=s.skyBoxCommand,v(d)&&wr(d,n,r,t),s.isSkyAtmosphereVisible&&wr(s.skyAtmosphereCommand,n,r,t),s.isSunVisible&&(s.sunDrawCommand.execute(r,t),n.sunBloom&&!yt&&(g=s.useGlobeDepthFramebuffer?a.globeDepth.framebuffer:s.usePostProcess?a.sceneFramebuffer.getFramebuffer():s.originalFramebuffer,n._sunPostProcess.execute(r),n._sunPostProcess.copy(r,g),t.framebuffer=g)),s.isMoonVisible&&s.moonCommand.execute(r,t));s.useOIT?(v(n._executeOITFunction)||(n._executeOITFunction=function(n,t,i,r,u){a.oit.executeCommands(n,t,i,r,u)}),nt=n._executeOITFunction):nt=rt.render?ee:oe;var b=s.clearGlobeDepth,ft=s.useDepthPlane,p=n._depthClearCommand,tt=n._stencilClearCommand,et=n._depthPlane,pt=s.usePostProcessSelected,wt=c.position.z,i,ot=a.frustumCommandsList,st=ot.length;for(k=0;k<st;++k){for(y=st-k-1,u=ot[y],n.mode===or.SCENE2D?(c.position.z=wt-u.near+1,h.far=Math.max(1,u.far-u.near),h.near=1,o.update(n.frameState),o.updateFrustum(h)):(h.near=y!==0?u.near*n.opaqueFrustumNearOffset:u.near,h.far=u.far,o.updateFrustum(h)),l=n.debugShowGlobeDepth?du(n,y):a.globeDepth,n.debugShowGlobeDepth&&v(l)&&s.useGlobeDepthFramebuffer&&(l.update(r,t,a.viewport),l.clear(r,t,n._clearColorCommand.color),ht=t.framebuffer,t.framebuffer=l.framebuffer),p.execute(r,t),r.stencilBuffer&&tt.execute(r,t),o.updatePass(ri.GLOBE),f=u.commands[ri.GLOBE],e=u.indices[ri.GLOBE],i=0;i<e;++i)wr(f[i],n,r,t);for(v(l)&&s.useGlobeDepthFramebuffer&&(l.update(r,t,a.viewport),l.executeCopyDepth(r,t)),n.debugShowGlobeDepth&&v(l)&&s.useGlobeDepthFramebuffer&&(t.framebuffer=ht),o.updatePass(ri.TERRAIN_CLASSIFICATION),f=u.commands[ri.TERRAIN_CLASSIFICATION],e=u.indices[ri.TERRAIN_CLASSIFICATION],i=0;i<e;++i)wr(f[i],n,r,t);for(o.updatePass(ri.CLASSIFICATION),f=u.commands[ri.CLASSIFICATION],e=u.indices[ri.CLASSIFICATION],i=0;i<e;++i)wr(f[i],n,r,t);if(b&&p.execute(r,t),!s.useInvertClassification||w){for(o.updatePass(ri.CESIUM_3D_TILE),f=u.commands[ri.CESIUM_3D_TILE],e=u.indices[ri.CESIUM_3D_TILE],i=0;i<e;++i)wr(f[i],n,r,t);for(o.updatePass(ri.CESIUM_3D_TILE_CLASSIFICATION),f=u.commands[ri.CESIUM_3D_TILE_CLASSIFICATION],e=u.indices[ri.CESIUM_3D_TILE_CLASSIFICATION],i=0;i<e;++i)wr(f[i],n,r,t);for(o.updatePass(ri.CLASSIFICATION),f=u.commands[ri.CLASSIFICATION],e=u.indices[ri.CLASSIFICATION],i=0;i<e;++i)wr(f[i],n,r,t)}else{for(n._invertClassification.clear(r,t),ct=t.framebuffer,t.framebuffer=n._invertClassification._fbo,o.updatePass(ri.CESIUM_3D_TILE),f=u.commands[ri.CESIUM_3D_TILE],e=u.indices[ri.CESIUM_3D_TILE],i=0;i<e;++i)wr(f[i],n,r,t);for(o.updatePass(ri.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),f=u.commands[ri.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],e=u.indices[ri.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],i=0;i<e;++i)wr(f[i],n,r,t);for(t.framebuffer=ct,n._invertClassification.executeClassified(r,t),n.frameState.invertClassificationColor.alpha===1&&n._invertClassification.executeUnclassified(r,t),e>0&&r.stencilBuffer&&tt.execute(r,t),o.updatePass(ri.CESIUM_3D_TILE_CLASSIFICATION),f=u.commands[ri.CESIUM_3D_TILE_CLASSIFICATION],e=u.indices[ri.CESIUM_3D_TILE_CLASSIFICATION],i=0;i<e;++i)wr(f[i],n,r,t);for(o.updatePass(ri.CLASSIFICATION),f=u.commands[ri.CLASSIFICATION],e=u.indices[ri.CLASSIFICATION],i=0;i<e;++i)wr(f[i],n,r,t)}for(e>0&&r.stencilBuffer&&tt.execute(r,t),b&&ft&&et.execute(r,t),o.updatePass(ri.OPAQUE),f=u.commands[ri.OPAQUE],e=u.indices[ri.OPAQUE],i=0;i<e;++i)wr(f[i],n,r,t);if(y!==0&&n.mode!==or.SCENE2D&&(h.near=u.near,o.updateFrustum(h)),!w&&s.useInvertClassification&&n.frameState.invertClassificationColor.alpha<1&&(lt=n._invertClassification),o.updatePass(ri.TRANSLUCENT),f=u.commands[ri.TRANSLUCENT],f.length=u.indices[ri.TRANSLUCENT],nt(n,wr,t,f,lt),r.depthTexture&&n.useDepthPicking&&(s.useGlobeDepthFramebuffer||ut)&&(at=ut?t.framebuffer.depthStencilTexture:l.framebuffer.depthStencilTexture,it=fu(n,y),it.update(r,at),it.executeCopyDepth(r,t)),!w&&pt){for(vt=t.framebuffer,t.framebuffer=a.sceneFramebuffer.getIdFramebuffer(),h.near=y!==0?u.near*n.opaqueFrustumNearOffset:u.near,h.far=u.far,o.updateFrustum(h),o.updatePass(ri.GLOBE),f=u.commands[ri.GLOBE],e=u.indices[ri.GLOBE],i=0;i<e;++i)uu(f[i],n,r,t);for(b&&(p.framebuffer=t.framebuffer,p.execute(r,t),p.framebuffer=undefined),b&&ft&&et.execute(r,t),o.updatePass(ri.CESIUM_3D_TILE),f=u.commands[ri.CESIUM_3D_TILE],e=u.indices[ri.CESIUM_3D_TILE],i=0;i<e;++i)uu(f[i],n,r,t);for(o.updatePass(ri.OPAQUE),f=u.commands[ri.OPAQUE],e=u.indices[ri.OPAQUE],i=0;i<e;++i)uu(f[i],n,r,t);for(o.updatePass(ri.TRANSLUCENT),f=u.commands[ri.TRANSLUCENT],e=u.indices[ri.TRANSLUCENT],i=0;i<e;++i)uu(f[i],n,r,t);t.framebuffer=vt}}}function uf(n){var f=n.context.uniformState,i,r,u,t;for(f.updatePass(ri.COMPUTE),i=n._environmentState.sunComputeCommand,v(i)&&i.execute(n._computeEngine),r=n._computeCommandList,u=r.length,t=0;t<u;++t)r[t].execute(n._computeEngine)}function se(n,t){var u=n.context.uniformState,i;u.updatePass(ri.OVERLAY);var f=n.context,r=n._overlayCommandList,e=r.length;for(i=0;i<e;++i)r[i].execute(f,t)}function he(n,t,i){for(var r,e,h,f,c,l=i.shadowMapCullingVolume,a=i.isPointLight,u=i.passes,o=u.length,v=t.length,s=0;s<v;++s)if(r=t[s],n.updateDerivedCommands(r),r.castShadows&&(r.pass===ri.GLOBE||r.pass===ri.CESIUM_3D_TILE||r.pass===ri.OPAQUE||r.pass===ri.TRANSLUCENT)&&n.isVisible(r,l))if(a)for(e=0;e<o;++e)u[e].commandList.push(r);else if(o===1)u[0].commandList.push(r);else for(h=!1,f=o-1;f>=0;--f)if(c=u[f].cullingVolume,n.isVisible(r,c))u[f].commandList.push(r),h=!0;else if(h)break}function ff(n){var l=n.frameState,a=l.shadowState.shadowMaps,p=a.length,f,o,r,i,t,s,h,v,u,y,e,c;if(l.shadowState.shadowsEnabled)for(f=n.context,o=f.uniformState,r=0;r<p;++r)if(i=a[r],!i.outOfView){for(s=i.passes,h=s.length,t=0;t<h;++t)s[t].commandList.length=0;for(v=n.frameState.commandList,he(n,v,i),t=0;t<h;++t)for(u=i.passes[t],o.updateCamera(u.camera),i.updatePass(f,t),y=u.commandList.length,e=0;e<y;++e)c=u.commandList[e],o.updatePass(c.pass),wr(c.derivedCommands.shadows.castCommands[r],n,f,u.passState)}}function eu(n,t,i){var r=n._frameState,u=r.mode,f=n._environmentState.useWebVR;f?ce(n,t,i):u!==or.SCENE2D||n._mapMode2D===nr.ROTATE?kr(!0,n,t,i):(vu(n,t,i),de(n,t))}function ce(n,t,i){var s=n._view,r=s.camera,p=n._environmentState,h=p.renderTranslucentDepthForPick,u,e,o;vu(n,t,i);h||of(n);s.createPotentiallyVisibleSet(n);h||(uf(n),ff(n));u=t.viewport;u.x=0;u.y=0;u.width=u.width*.5;e=hi.clone(r,n._cameraVR);e.frustum=r.frustum;var c=r.frustum.near,l=c*a(n.focalLength,5),v=a(n.eyeSeparation,l/30),y=f.multiplyByScalar(e.right,v*.5,ef);r.frustum.aspectRatio=u.width/u.height;o=.5*v*c/l;f.add(e.position,y,r.position);r.frustum.xOffset=o;au(n,t);u.x=u.width;f.subtract(e.position,y,r.position);r.frustum.xOffset=-o;au(n,t);hi.clone(e,r)}function de(n,i){var h=n.context,o=n.frameState,r=n.camera,v=i.viewport,u=t.clone(v,ke),s,c,y,p;i.viewport=u;var w=le,a=ae,b=n.mapProjection;b.project(w,a);var k=f.clone(r.position,ve),d=ft.clone(r.transform,pe),g=r.frustum.clone();r._setTransform(ft.IDENTITY);var nt=ft.computeViewportTransformation(u,0,1,ye),tt=r.frustum.projectionMatrix,l=r.positionWC.y,it=f.fromElements(ut.sign(l)*a.x-l,0,-r.positionWC.x,we),e=bt.pointToGLWindowCoordinates(tt,nt,it,be);e.x=Math.floor(e.x);s=u.x;c=u.width;l===0||e.x<=s||e.x>=s+c?kr(!0,n,i):Math.abs(s+c*.5-e.x)<1?(u.width=e.x-u.x,r.position.x*=ut.sign(r.position.x),r.frustum.right=0,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),h.uniformState.update(o),kr(!0,n,i),u.x=e.x,r.position.x=-r.position.x,r.frustum.right=-r.frustum.left,r.frustum.left=0,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),h.uniformState.update(o),kr(!1,n,i)):e.x>s+c*.5?(u.width=e.x-s,y=r.frustum.right,r.frustum.right=a.x-l,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),h.uniformState.update(o),kr(!0,n,i),u.x=e.x,u.width=s+c-e.x,r.position.x=-r.position.x,r.frustum.left=-r.frustum.right,r.frustum.right=y-r.frustum.right*2,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),h.uniformState.update(o),kr(!1,n,i)):(u.x=e.x,u.width=s+c-e.x,p=r.frustum.left,r.frustum.left=-a.x-l,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),h.uniformState.update(o),kr(!0,n,i),u.x=s,u.width=e.x-s,r.position.x=-r.position.x,r.frustum.right=-r.frustum.left,r.frustum.left=p-r.frustum.left*2,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),h.uniformState.update(o),kr(!1,n,i));r._setTransform(d);f.clone(k,r.position);r.frustum=g.clone();i.viewport=v}function kr(n,t,i,r){var f=t._environmentState,e=t._view,u=f.renderTranslucentDepthForPick;n||u||(t.frameState.commandList.length=0);u||of(t);e.createPotentiallyVisibleSet(t);n&&(v(r)&&vu(t,i,r),u||(uf(t),ff(t)));au(t,i)}function nu(n){var i=n._frameState,s=n._view,t=n._environmentState,a=i.passes.render,y=i.passes.offscreen,e=n.skyAtmosphere,r=n.globe,u,h,c,f;!a||n._mode!==or.SCENE2D&&s.camera.frustum instanceof st?(t.skyAtmosphereCommand=undefined,t.skyBoxCommand=undefined,t.sunDrawCommand=undefined,t.sunComputeCommand=undefined,t.moonCommand=undefined):(v(e)&&v(r)&&(e.setDynamicAtmosphereColor(r.enableLighting),t.isReadyForAtmosphere=t.isReadyForAtmosphere||r._surface._tilesToRender.length>0),t.skyAtmosphereCommand=v(e)?e.update(i):undefined,t.skyBoxCommand=v(n.skyBox)?n.skyBox.update(i):undefined,u=v(n.sun)?n.sun.update(i,s.passState):undefined,t.sunDrawCommand=v(u)?u.drawCommand:undefined,t.sunComputeCommand=v(u)?u.computeCommand:undefined,t.moonCommand=v(n.moon)?n.moon.update(i):undefined);h=t.clearGlobeDepth=v(r)&&(!r.depthTestAgainstTerrain||n.mode===or.SCENE2D);c=t.useDepthPlane=h&&n.mode===or.SCENE3D;c&&n._depthPlane.update(i);t.renderTranslucentDepthForPick=!1;t.useWebVR=n._useWebVR&&n.mode!==or.SCENE2D&&!y;var l=i.mode===or.SCENE3D?i.occluder:undefined,o=i.cullingVolume,p=lu.planes;for(f=0;f<5;++f)p[f]=o.planes[f];o=lu;t.isSkyAtmosphereVisible=v(t.skyAtmosphereCommand)&&t.isReadyForAtmosphere;t.isSunVisible=n.isVisible(t.sunDrawCommand,o,l);t.isMoonVisible=n.isVisible(t.moonCommand,o,l)}function ge(n){var t=n._frameState;n.debugShowFrustumPlanes!==n._debugShowFrustumPlanes&&(n._debugFrustumPlanes=n.debugShowFrustumPlanes?new ai({camera:n.camera,updateOnChange:!1}):n._debugFrustumPlanes&&n._debugFrustumPlanes.destroy(),n._debugShowFrustumPlanes=n.debugShowFrustumPlanes);v(n._debugFrustumPlanes)&&n._debugFrustumPlanes.update(t)}function no(n){var t=n._frameState,f=t.shadowMaps,e=f.length,o=e>0&&!t.passes.pick&&n.mode===or.SCENE3D,r,u,i;if(o!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=o),t.shadowState.lightShadowsEnabled=!1,o){for(r=0;r<e;++r)if(f[r]!==t.shadowState.shadowMaps[r]){++t.shadowState.lastDirtyTime;break}for(t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0,u=0;u<e;++u)i=f[u],i.update(t),t.shadowState.shadowMaps.push(i),i.fromLightSource&&(t.shadowState.lightShadowMaps.push(i),t.shadowState.lightShadowsEnabled=!0),i.dirty&&(++t.shadowState.lastDirtyTime,i.dirty=!1)}}function of(n){var t=n._frameState;n._groundPrimitives.update(t);n._primitives.update(t);ge(n);no(n);n._globe&&n._globe.render(t)}function vu(n,t,i){var r=n._context,g=n._frameState,u=n._environmentState,f=n._view,nt=n._frameState.passes,l=nt.pick,k=u.useWebVR,c,a,o,y,e,h,d,p,w,b;u.originalFramebuffer=t.framebuffer;v(n.sun)&&n.sunBloom!==n._sunBloom?(n.sunBloom&&!k?n._sunPostProcess=new ar:v(n._sunPostProcess)&&(n._sunPostProcess=n._sunPostProcess.destroy()),n._sunBloom=n.sunBloom):!v(n.sun)&&v(n._sunPostProcess)&&(n._sunPostProcess=n._sunPostProcess.destroy(),n._sunBloom=!1);c=n._clearColorCommand;s.clone(i,c.color);c.execute(r,t);a=u.useGlobeDepthFramebuffer=v(f.globeDepth);a&&(f.globeDepth.update(r,t,f.viewport),f.globeDepth.clear(r,t,i));o=f.oit;y=u.useOIT=!l&&v(o)&&o.isSupported();y&&(o.update(r,t,f.globeDepth.framebuffer),o.clear(r,t,i),u.useOIT=o.isSupported());e=n.postProcessStages;h=u.usePostProcess=!l&&(e.length>0||e.ambientOcclusion.enabled||e.fxaa.enabled||e.bloom.enabled);u.usePostProcessSelected=!1;h&&(f.sceneFramebuffer.update(r,f.viewport),f.sceneFramebuffer.clear(r,t,i),e.update(r,g.useLogDepth),e.clear(r),h=u.usePostProcess=e.ready,u.usePostProcessSelected=h&&e.hasSelected);u.isSunVisible&&n.sunBloom&&!k?(t.framebuffer=n._sunPostProcess.update(t),n._sunPostProcess.clear(r,t,i)):a?t.framebuffer=f.globeDepth.framebuffer:h&&(t.framebuffer=f.sceneFramebuffer.getFramebuffer());v(t.framebuffer)&&c.execute(r,t);d=u.useInvertClassification=!l&&v(t.framebuffer)&&n.invertClassification;d&&(n.frameState.invertClassificationColor.alpha===1&&u.useGlobeDepthFramebuffer&&(p=f.globeDepth.framebuffer),v(p)||r.depthTexture?(n._invertClassification.previousFramebuffer=p,n._invertClassification.update(r),n._invertClassification.clear(r,t),n.frameState.invertClassificationColor.alpha<1&&y&&(w=n._invertClassification.unclassifiedCommand,b=w.derivedCommands,b.oit=o.createDerivedCommands(w,r,b.oit))):u.useInvertClassification=!1)}function ou(n,t){var i=n._context,b=n._frameState,f=n._environmentState,r=n._view,e=f.useOIT,u=f.useGlobeDepthFramebuffer,o=f.usePostProcess,s=f.originalFramebuffer,v=u?r.globeDepth.framebuffer:undefined,h=r.sceneFramebuffer.getFramebuffer(),k=r.sceneFramebuffer.getIdFramebuffer(),c,l,p,w;if(e&&(t.framebuffer=o?h:s,r.oit.execute(i,t)),o){c=h;u&&!e&&(c=v);var y=n.postProcessStages,d=c.getColorTexture(0),g=k.getColorTexture(0),nt=a(v,h).depthStencilTexture;y.execute(i,d,nt,g);y.copy(i,s)}e||o||!u||(t.framebuffer=s,r.globeDepth.executeCopyColor(i,t));l=b.useLogDepth;n.debugShowGlobeDepth&&u&&(p=du(n,n.debugShowDepthFrustum-1),p.executeDebugGlobeDepth(i,t,l));n.debugShowPickDepth&&u&&(w=fu(n,n.debugShowDepthFrustum-1),w.executeDebugPickDepth(i,t,l))}function yu(n){for(var t=n._frameState.afterRender,i=0,r=t.length;i<r;++i)t[i](),n.requestRender();t.length=0}function to(n,t){var i,r,u;n.debugShowFramesPerSecond?(v(n._performanceDisplay)||(i=document.createElement("div"),i.className="cesium-performanceDisplay-defaultContainer",r=n._canvas.parentNode,r.appendChild(i),u=new tr({container:i}),n._performanceDisplay=u,n._performanceContainer=i),n._performanceDisplay.throttled=n.requestRenderMode,n._performanceDisplay.update(t)):v(n._performanceDisplay)&&(n._performanceDisplay=n._performanceDisplay&&n._performanceDisplay.destroy(),n._performanceContainer.parentNode.removeChild(n._performanceContainer))}function io(n){var t=n._frameState;v(n.globe)&&n.globe.update(t);t.creditDisplay.update()}function ro(n,i){var p,l,h,e,u;n._pickPositionCacheDirty=!0;var o=n.context,y=o.uniformState,r=n._frameState,c=n._defaultView;n._view=c;p=ut.incrementWrap(r.frameNumber,15e6,1);ru(n,p,i);r.passes.render=!0;r.passes.postProcess=n.postProcessStages.hasSelected;l=a(n.backgroundColor,s.BLACK);r.backgroundColor=l;r.creditDisplay.beginFrame();n.fog.update(r);y.update(r);h=n.shadowMap;v(h)&&h.enabled&&(f.negate(y.sunDirectionWC,n._sunCamera.direction),r.shadowMaps.push(h));n._computeCommandList.length=0;n._overlayCommandList.length=0;e=c.viewport;e.x=0;e.y=0;e.width=o.drawingBufferWidth;e.height=o.drawingBufferHeight;u=c.passState;u.framebuffer=undefined;u.blendingEnabled=undefined;u.scissorTest=undefined;u.viewport=t.clone(e,u.viewport);v(n.globe)&&n.globe.beginFrame(r);nu(n);eu(n,u,l);ou(n,u);u.framebuffer=undefined;se(n,u);v(n.globe)&&(n.globe.endFrame(r),n.globe.tilesLoaded||(n._renderRequested=!0));r.creditDisplay.endFrame();o.endFrame()}function sf(n,t,i){try{i(n,t)}catch(r){if(n._renderError.raiseEvent(n,r),n.rethrowRenderErrors)throw r;}}function oo(n,t,i,r,u){var h=n.camera,e=h.frustum,c,l,y,o,a,s;return v(e._offCenterFrustum)&&(e=e._offCenterFrustum),c=2*(t.x-u.x)/u.width-1,c*=(e.right-e.left)*.5,l=2*(u.height-t.y-u.y)/u.height-1,l*=(e.top-e.bottom)*.5,y=ft.clone(h.transform,eo),h._setTransform(ft.IDENTITY),o=f.clone(h.position,fo),f.multiplyByScalar(h.right,c,su),f.add(su,o,o),f.multiplyByScalar(h.up,l,su),f.add(su,o,o),h._setTransform(y),n.mode===or.SCENE2D&&f.fromElements(o.z,o.x,o.y,o),a=e.getPixelDimensions(u.width,u.height,1,hf),s=uo,s.right=a.x*.5,s.left=-s.right,s.top=a.y*.5,s.bottom=-s.top,s.near=e.near,s.far=e.far,s.computeCullingVolume(o,h.directionWC,h.upWC)}function so(n,t,i,r,u){var o=n.camera,e=o.frustum,s=e.near,h=Math.tan(e.fovy*.5),p=e.aspectRatio*h,w=2*(t.x-u.x)/u.width-1,b=2*(u.height-t.y-u.y)/u.height-1,c=w*s*p,l=b*s*h,a=e.getPixelDimensions(u.width,u.height,1,hf),v=a.x*i*.5,y=a.y*r*.5,f=cf;return f.top=l+y,f.bottom=l-y,f.right=c+v,f.left=c-v,f.near=s,f.far=e.far,f.computeCullingVolume(o.positionWC,o.directionWC,o.upWC)}function lf(n,t,i,r,u){var f=n.camera.frustum;return f instanceof st||f instanceof ht?oo(n,t,i,r,u):so(n,t,i,r,u)}function ho(n,i){var f=n._context,e=n._frameState,s=n._environmentState,o=n._defaultView,r,u;n._view=o;r=o.viewport;r.x=0;r.y=0;r.width=f.drawingBufferWidth;r.height=f.drawingBufferHeight;u=o.passState;u.viewport=t.clone(r,u.viewport);ku(e.passes);e.passes.pick=!0;e.passes.depth=!0;e.cullingVolume=lf(n,i,1,1,r);nu(n);s.renderTranslucentDepthForPick=!0;u=o.pickDepthFramebuffer.update(f,i,r);eu(n,u,pu);ou(n,u);f.endFrame()}function co(n,t){return!v(t)||t.length===0?!1:t.indexOf(n)>-1||t.indexOf(n.primitive)>-1||t.indexOf(n.id)>-1}function yf(n,t,i){var r,f,h=[],c=[],l=[],a=[],e,u,y,o,s;for(v(n)||(n=Number.MAX_VALUE),e=t();v(e);){if(u=e.object,y=e.position,v(y)&&!v(u)){h.push(e);break}if(!v(u)||!v(u.primitive))break;if(!co(u,i)&&(h.push(e),0>=--n))break;o=u.primitive;s=!1;typeof o.getGeometryInstanceAttributes=="function"&&v(u.id)&&(f=o.getGeometryInstanceAttributes(u.id),v(f)&&v(f.show)&&(s=!0,f.show=pt.toValue(!1,f.show),l.push(f)));u instanceof ci&&(s=!0,u.show=!1,a.push(u));s||(o.show=!1,c.push(o));e=t()}for(r=0;r<c.length;++r)c[r].show=!0;for(r=0;r<l.length;++r)f=l[r],f.show=pt.toValue(!0,f.show);for(r=0;r<a.length;++r)a[r].show=!0;return h}function lo(n,t){var i=n.direction,u=f.mostOrthogonalAxis(i,wu),r=f.cross(i,u,wu),e=f.cross(i,r,pf);t.position=n.origin;t.direction=i;t.up=e;t.right=r}function ao(n,i){var e=n._context,w=e.uniformState,u=n._frameState,r=n._pickOffscreenView,s,h,c,l,f,a,o;if(n._view=r,lo(i,r.camera),br=t.clone(r.viewport,br),s=r.pickFramebuffer.begin(br,r.viewport),n._jobScheduler.disableThisFrame(),ru(n,u.frameNumber,u.time),u.invertClassification=!1,u.passes.pick=!0,u.passes.offscreen=!0,w.update(u),nu(n,r),eu(n,s,pu),ou(n,s),c=r.pickFramebuffer.end(e),n._context.depthTexture)for(l=r.frustumCommandsList.length,f=0;f<l;++f)if(a=fu(n,f),o=a.getDepth(e,0,0),o>0&&o<1){var y=r.frustumCommandsList[f],p=y.near*(f!==0?n.opaqueFrustumNearOffset:1),b=y.far,k=p+o*(b-p);h=vt.getPoint(i,k);break}return n._view=n._defaultView,e.endFrame(),yu(n),v(c)||v(h)?{object:c,position:h}:void 0}function wf(n,t,i,r){if(o.defined("ray",t),n._mode!==or.SCENE3D)throw new b("Ray intersections are only supported in 3D mode.");var u=function(){return ao(n,t)};return yf(i,u,r)}function kf(t,i){var o=t.globe,s=v(o)?o.ellipsoid:t.mapProjection.ellipsoid,c=n._defaultMaxTerrainHeight,h=s.geodeticSurfaceNormalCartographic(i,yo),l=e.toCartesian(i,s,vo),u=po,r;return u.origin=l,u.direction=h,r=new vt,vt.getPoint(u,c,r.origin),f.negate(h,r.direction),r}function wo(n,t){var i=n.globe,r=v(i)?i.ellipsoid:n.mapProjection.ellipsoid,u=e.fromCartesian(t,r,bf);return kf(n,u)}var iu=function(n){return function(){n.frameState.afterRender.push(function(){n.requestRender()})}},hu,cu,lu,gr,ef,cf,vf,wu,pf;y(pr.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return ni.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return ni.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},globe:{get:function(){return this._globe},set:function(n){this._globe=this._globe&&this._globe.destroy();this._globe=n;df(this,n)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(n){this._view.camera=n}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},frameState:{get:function(){return this._frameState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){return v(this.globe)?this.globe.imageryLayers:undefined}},terrainProvider:{get:function(){return v(this.globe)?this.globe.terrainProvider:undefined},set:function(n){v(this.globe)&&(this.globe.terrainProvider=n)}},terrainProviderChanged:{get:function(){return v(this.globe)?this.globe.terrainProviderChanged:undefined}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(n){if(this.scene3DOnly&&n!==or.SCENE3D)throw new b("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(n===or.SCENE2D)this.morphTo2D(0);else if(n===or.SCENE3D)this.morphTo3D(0);else if(n===or.COLUMBUS_VIEW)this.morphToColumbusView(0);else throw new b("value must be a valid SceneMode enumeration.");this._mode=n}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(n){if(this.camera.frustum instanceof st)throw new b("VR is unsupported with an orthographic projection.");this._useWebVR=n;this._useWebVR?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new hi(this),v(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new pi(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=undefined,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(n){this._frameState.imagerySplitPosition=n}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(n){if(!v(n)||n<0)throw new b("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=n}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(n){n=this._context.fragmentDepth&&n;this._logDepthBuffer!==n&&(this._logDepthBuffer=n,this._logDepthBufferDirty=!0,this._defaultView.updateFrustums=!0)}},opaqueFrustumNearOffset:{get:function(){return this._frameState.useLogDepth?.9:.9999}}});pr.prototype.getCompressedTextureFormatSupported=function(n){var t=this.context;return(n==="WEBGL_compressed_texture_s3tc"||n==="s3tc")&&t.s3tc||(n==="WEBGL_compressed_texture_pvrtc"||n==="pvrtc")&&t.pvrtc||(n==="WEBGL_compressed_texture_etc1"||n==="etc1")&&t.etc1};pr.prototype.updateDerivedCommands=function(n){var l,a;if(v(n.derivedCommands)){var i=this._frameState,u=this._context,r=!1,f=i.shadowState.lastDirtyTime;n.lastDirtyTime!==f&&(n.lastDirtyTime=f,n.dirty=!0,r=!0);var e=i.useLogDepth,t=n.derivedCommands,o=v(t.logDepth),s=v(t.originalCommand),h=e&&!o,c=!e&&!s;n.dirty=n.dirty||h||c;n.dirty&&(n.dirty=!1,l=i.shadowState.shadowMaps,a=i.shadowState.shadowsEnabled,a&&n.castShadows&&(t.shadows=lr.createCastDerivedCommand(l,n,r,u,t.shadows)),(o||h)&&(t.logDepth=yi.createLogDepthCommand(n,u,t.logDepth),bu(this,t.logDepth.command,r)),(s||c)&&bu(this,n,r))}};hu=new i;lu=new l;pr.prototype.isVisible=function(n,t,i){return v(n)&&(!v(n.boundingVolume)||!n.cull||t.computeVisibility(n.boundingVolume)!==it.OUTSIDE&&(!v(i)||!n.boundingVolume.isOccluded(i)))};gr=new ft(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);gr=ft.inverseTransformation(gr,gr);var gu=new ct,nf=new lt,tf=new st,rf=new ht;ef=new f;var le=new e(Math.PI,ut.PI_OVER_TWO),ae=new f,ve=new f,ye=new ft,pe=new ft,we=new f,be=new f,ke=new t;pr.prototype.initializeFrame=function(){this._shaderFrameCount++==120&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms());this._tweens.update();this._screenSpaceCameraController.update();v(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update();this.camera.update(this._mode);this.camera._updateCameraChanged()};pr.prototype.render=function(n){var i,t,r;v(n)||(n=rt.now());this._jobScheduler.resetBudgets();this._preUpdate.raiseEvent(this,n);sf(this,n,io);this._postUpdate.raiseEvent(this,n);i=this._view.checkForCameraUpdates(this);t=!this.requestRenderMode||this._renderRequested||i||this._logDepthBufferDirty||this.mode===or.MORPHING;!t&&v(this.maximumRenderTimeChange)&&v(this._lastRenderTime)&&(r=Math.abs(rt.secondsDifference(this._lastRenderTime,n)),t=t||r>this.maximumRenderTimeChange);t&&(this._lastRenderTime=rt.clone(n,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._preRender.raiseEvent(this,n),sf(this,n,ro),yt.update());to(this,t);yu(this);t&&this._postRender.raiseEvent(this,n)};pr.prototype.forceRender=function(n){this._renderRequested=!0;this.render(n)};pr.prototype.requestRender=function(){this._renderRequested=!0};pr.prototype.clampLineWidth=function(n){return Math.max(ni.minimumAliasedLineWidth,Math.min(n,ni.maximumAliasedLineWidth))};var uo=new ht,fo=new f,su=new f,hf=new u,eo=new ft;cf=new lt;var dr=3,tu=3,br=new t(0,0,dr,tu),pu=new s(0,0,0,0),af=new u;pr.prototype.pick=function(n,i,r){var u,o,h,c;if(!v(n))throw new b("windowPosition is undefined.");dr=a(i,3);tu=a(r,dr);var s=this._context,l=s.uniformState,f=this._frameState,e=this._defaultView;return this._view=e,u=e.viewport,u.x=0,u.y=0,u.width=s.drawingBufferWidth,u.height=s.drawingBufferHeight,o=e.passState,o.viewport=t.clone(u,o.viewport),h=sr.transformWindowToDrawingBuffer(this,n,af),this._jobScheduler.disableThisFrame(),ru(this,f.frameNumber,f.time),f.cullingVolume=lf(this,h,dr,tu,u),f.invertClassification=!1,f.passes.pick=!0,l.update(f),nu(this),br.x=h.x-(dr-1)*.5,br.y=this.drawingBufferHeight-h.y-(tu-1)*.5,br.width=dr,br.height=tu,o=e.pickFramebuffer.begin(br,e.viewport),eu(this,o,pu),ou(this,o),c=e.pickFramebuffer.end(br),s.endFrame(),yu(this),c};pr.prototype.pickPositionWorldCoordinates=function(n,t){var s,r,i,u,l,w,e,k,c,o,a;if(!this.useDepthPicking)return undefined;if(!v(n))throw new b("windowPosition is undefined.");if(!this._context.depthTexture)throw new b("Picking from the depth buffer is not supported. Check pickPositionSupported.");if(s=n.toString(),this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(s))return f.clone(this._pickPositionCache[s],t);var y=this._context,h=y.uniformState,p=this._defaultView;for(this._view=p,r=sr.transformWindowToDrawingBuffer(this,n,af),this.pickTranslucentDepth?ho(this,r):nu(this),r.y=this.drawingBufferHeight-r.y,i=this.camera,u=v(i.frustum.fov)?i.frustum.clone(gu):v(i.frustum.infiniteProjectionMatrix)?i.frustum.clone(nf):v(i.frustum.width)?i.frustum.clone(tf):i.frustum.clone(rf),l=p.frustumCommandsList,w=l.length,e=0;e<w;++e)if(k=fu(this,e),c=k.getDepth(y,r.x,r.y),c>0&&c<1)return o=l[e],this.mode===or.SCENE2D?(a=i.position.z,i.position.z=a-o.near+1,u.far=Math.max(1,o.far-o.near),u.near=1,h.update(this.frameState),h.updateFrustum(u)):(u.near=o.near*(e!==0?this.opaqueFrustumNearOffset:1),u.far=o.far,h.updateFrustum(u)),t=sr.drawingBufferToWgs84Coordinates(this,r,c,t),this.mode===or.SCENE2D&&(i.position.z=a,h.update(this.frameState)),this._pickPositionCache[s]=f.clone(t),t;return this._pickPositionCache[s]=undefined,undefined};vf=new e;pr.prototype.pickPosition=function(n,t){if(t=this.pickPositionWorldCoordinates(n,t),v(t)&&this.mode!==or.SCENE3D){f.fromElements(t.y,t.z,t.x,t);var i=this.mapProjection,r=i.ellipsoid,u=i.unproject(t,vf);r.cartographicToCartesian(u,t)}return t};pr.prototype.drillPick=function(n,t,i,r){var u=this,f=function(){var t=u.pick(n,i,r);if(v(t))return{object:t}},e=yf(t,f);return e.map(function(n){return n.object})};wu=new f;pf=new f;pr.prototype.pickFromRay=function(n,t){var i=wf(this,n,1,t);if(i.length>0)return i[0]};pr.prototype.drillPickFromRay=function(n,t,i){return wf(this,n,t,i)};var vo=new f,yo=new f,po=new vt,bf=new e;return pr.prototype.sampleHeight=function(n,t){var r,i;if(o.defined("position",n),!this.sampleHeightSupported)throw new b("sampleHeight required depth texture support. Check sampleHeightSupported.");if(r=kf(this,n),i=this.pickFromRay(r,t),v(i)){var f=i.position,u=this.globe,s=v(u)?u.ellipsoid:this.mapProjection.ellipsoid,h=e.fromCartesian(f,s,bf);return h.height}},pr.prototype.clampToHeight=function(n,t,i){if(o.defined("cartesian",n),!this.clampToHeightSupported)throw new b("clampToHeight required depth texture support. Check clampToHeightSupported.");var u=wo(this,n),r=this.pickFromRay(u,t);if(v(r))return f.clone(r.position,i)},pr.prototype.cartesianToCanvasCoordinates=function(n,t){return sr.wgs84ToWindowCoordinates(this,n,t)},pr.prototype.completeMorph=function(){this._transitioner.completeMorph()},pr.prototype.morphTo2D=function(n){var t,i=this.globe;t=v(i)?i.ellipsoid:this.mapProjection.ellipsoid;n=a(n,2);this._transitioner.morphTo2D(n,t)},pr.prototype.morphToColumbusView=function(n){var t,i=this.globe;t=v(i)?i.ellipsoid:this.mapProjection.ellipsoid;n=a(n,2);this._transitioner.morphToColumbusView(n,t)},pr.prototype.morphTo3D=function(n){var t,i=this.globe;t=v(i)?i.ellipsoid:this.mapProjection.ellipsoid;n=a(n,2);this._transitioner.morphTo3D(n,t)},pr.prototype.isDestroyed=function(){return!1},pr.prototype.destroy=function(){this._tweens.removeAll();this._computeEngine=this._computeEngine&&this._computeEngine.destroy();this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy();this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy();this._primitives=this._primitives&&this._primitives.destroy();this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy();this._globe=this._globe&&this._globe.destroy();this.skyBox=this.skyBox&&this.skyBox.destroy();this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy();this._debugSphere=this._debugSphere&&this._debugSphere.destroy();this.sun=this.sun&&this.sun.destroy();this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy();this._depthPlane=this._depthPlane&&this._depthPlane.destroy();this._transitioner=this._transitioner&&this._transitioner.destroy();this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy();this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy();this._defaultView=this._defaultView&&this._defaultView.destroy();this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy();this._view=undefined;this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer);this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy();this._context=this._context&&this._context.destroy();this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy();v(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer));this._removeRequestListenerCallback();this._removeTaskProcessorListenerCallback();for(var n=0;n<this._removeGlobeCallbacks.length;++n)this._removeGlobeCallbacks[n]();return this._removeGlobeCallbacks.length=0,w(this)},pr});t("Shaders/SkyAtmosphereFS",[],function(){"use strict";return"#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift;\n#endif\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor;\nconst float g = -0.95;\nconst float g2 = g * g;\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\nvoid main (void)\n{\nfloat cosAngle = dot(czm_sunDirectionWC, normalize(v_toCamera)) / length(v_toCamera);\nfloat rayleighPhase = 0.75 * (1.0 + cosAngle * cosAngle);\nfloat miePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\nconst float exposure = 2.0;\nvec3 rgb = rayleighPhase * v_rayleighColor + miePhase * v_mieColor;\nrgb = vec3(1.0) - exp(-exposure * rgb);\n#ifdef COLOR_CORRECT\nvec3 hsb = czm_RGBToHSB(rgb);\nhsb.x += u_hsbShift.x;\nhsb.y = clamp(hsb.y + u_hsbShift.y, 0.0, 1.0);\nhsb.z = hsb.z > czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0;\nrgb = czm_HSBToRGB(hsb);\n#endif\nfloat atmosphereAlpha = clamp((u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.x) / (u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.z), 0.0, 1.0);\nfloat nightAlpha = (u_cameraAndRadiiAndDynamicAtmosphereColor.w > 0.0) ? clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), 0.0, 1.0) : 1.0;\natmosphereAlpha *= pow(nightAlpha, 0.5);\ngl_FragColor = vec4(rgb, mix(rgb.b, 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\n}\n"});t("Shaders/SkyAtmosphereVS",[],function(){"use strict";return"attribute vec4 position;\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor;\nconst float Kr = 0.0025;\nconst float Kr4PI = Kr * 4.0 * czm_pi;\nconst float Km = 0.0015;\nconst float Km4PI = Km * 4.0 * czm_pi;\nconst float ESun = 15.0;\nconst float KmESun = Km * ESun;\nconst float KrESun = Kr * ESun;\nconst vec3 InvWavelength = vec3(\n5.60204474633241,\n9.473284437923038,\n19.643802610477206);\nconst float rayleighScaleDepth = 0.25;\nconst int nSamples = 2;\nconst float fSamples = 2.0;\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nfloat scale(float cosAngle)\n{\nfloat x = 1.0 - cosAngle;\nreturn rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nvoid main(void)\n{\nfloat cameraHeight = u_cameraAndRadiiAndDynamicAtmosphereColor.x;\nfloat outerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.y;\nfloat innerRadius = u_cameraAndRadiiAndDynamicAtmosphereColor.z;\nvec3 positionV3 = position.xyz;\nvec3 ray = positionV3 - czm_viewerPositionWC;\nfloat far = length(ray);\nray /= far;\nfloat atmosphereScale = 1.0 / (outerRadius - innerRadius);\n#ifdef SKY_FROM_SPACE\nfloat B = 2.0 * dot(czm_viewerPositionWC, ray);\nfloat C = cameraHeight * cameraHeight - outerRadius * outerRadius;\nfloat det = max(0.0, B*B - 4.0 * C);\nfloat near = 0.5 * (-B - sqrt(det));\nvec3 start = czm_viewerPositionWC + ray * near;\nfar -= near;\nfloat startAngle = dot(ray, start) / outerRadius;\nfloat startDepth = exp(-1.0 / rayleighScaleDepth );\nfloat startOffset = startDepth*scale(startAngle);\n#else // SKY_FROM_ATMOSPHERE\nvec3 start = czm_viewerPositionWC;\nfloat height = length(start);\nfloat depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\nfloat startAngle = dot(ray, start) / height;\nfloat startOffset = depth*scale(startAngle);\n#endif\nfloat sampleLength = far / fSamples;\nfloat scaledLength = sampleLength * atmosphereScale;\nvec3 sampleRay = ray * sampleLength;\nvec3 samplePoint = start + sampleRay * 0.5;\nvec3 frontColor = vec3(0.0, 0.0, 0.0);\nvec3 lightDir = (u_cameraAndRadiiAndDynamicAtmosphereColor.w > 0.0) ? czm_sunPositionWC - czm_viewerPositionWC : czm_viewerPositionWC;\nlightDir = normalize(lightDir);\nfor(int i=0; i<nSamples; i++)\n{\nfloat height = length(samplePoint);\nfloat depth = exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\nfloat fLightAngle = dot(lightDir, samplePoint) / height;\nfloat fCameraAngle = dot(ray, samplePoint) / height;\nfloat fScatter = (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\nvec3 attenuate = exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\nfrontColor += attenuate * (depth * scaledLength);\nsamplePoint += sampleRay;\n}\nv_mieColor = frontColor * KmESun;\nv_rayleighColor = frontColor * (InvWavelength * KrESun);\nv_toCamera = czm_viewerPositionWC - positionV3;\ngl_Position = czm_modelViewProjection * position;\n}\n"});t("Scene/SkyAtmosphere",["../Core/Cartesian3","../Core/Cartesian4","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Ellipsoid","../Core/EllipsoidGeometry","../Core/GeometryPipeline","../Core/Math","../Core/VertexFormat","../Renderer/BufferUsage","../Renderer/DrawCommand","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/ShaderSource","../Renderer/VertexArray","../Shaders/SkyAtmosphereFS","../Shaders/SkyAtmosphereVS","./BlendingState","./CullFace","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt){"use strict";function tt(r){var f,u;r=i(r,e.WGS84);this.show=!0;this._ellipsoid=r;this._command=new a({owner:this});this._spSkyFromSpace=undefined;this._spSkyFromAtmosphere=undefined;this._spSkyFromSpaceColorCorrect=undefined;this._spSkyFromAtmosphereColorCorrect=undefined;this.hueShift=0;this.saturationShift=0;this.brightnessShift=0;this._hueSaturationBrightness=new n;f=new t;f.w=0;f.y=n.maximumComponent(n.multiplyByScalar(r.radii,1.025,new n));f.z=r.maximumRadius;this._cameraAndRadiiAndDynamicAtmosphereColor=f;u=this;this._command.uniformMap={u_cameraAndRadiiAndDynamicAtmosphereColor:function(){return u._cameraAndRadiiAndDynamicAtmosphereColor},u_hsbShift:function(){return u._hueSaturationBrightness.x=u.hueShift,u._hueSaturationBrightness.y=u.saturationShift,u._hueSaturationBrightness.z=u.brightnessShift,u._hueSaturationBrightness}}}function it(n){return!(h.equalsEpsilon(n.hueShift,0,h.EPSILON7)&&h.equalsEpsilon(n.saturationShift,0,h.EPSILON7)&&h.equalsEpsilon(n.brightnessShift,0,h.EPSILON7))}return u(tt.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),tt.prototype.setDynamicAtmosphereColor=function(n){this._cameraAndRadiiAndDynamicAtmosphereColor.w=n?1:0},tt.prototype.update=function(t){var h,i,u,a,f,e,et,rt;if(!this.show||(h=t.mode,h!==nt.SCENE3D&&h!==nt.MORPHING)||!t.passes.render)return undefined;if(i=this._command,r(i.vertexArray)||(u=t.context,a=o.createGeometry(new o({radii:n.multiplyByScalar(this._ellipsoid.radii,1.025,new n),slicePartitions:256,stackPartitions:256,vertexFormat:c.POSITION_ONLY})),i.vertexArray=w.fromGeometry({context:u,geometry:a,attributeLocations:s.createAttributeLocations(a),bufferUsage:l.STATIC_DRAW}),i.renderState=v.fromCache({cull:{enabled:!0,face:g.FRONT},blending:d.ALPHA_BLEND,depthMask:!1}),f=new p({defines:["SKY_FROM_SPACE"],sources:[k]}),this._spSkyFromSpace=y.fromCache({context:u,vertexShaderSource:f,fragmentShaderSource:b}),f=new p({defines:["SKY_FROM_ATMOSPHERE"],sources:[k]}),this._spSkyFromAtmosphere=y.fromCache({context:u,vertexShaderSource:f,fragmentShaderSource:b})),e=it(this),e&&(!r(this._spSkyFromSpaceColorCorrect)||!r(this._spSkyFromAtmosphereColorCorrect))){var ut=t.context,tt=new p({defines:["SKY_FROM_SPACE"],sources:[k]}),ft=new p({defines:["COLOR_CORRECT"],sources:[b]});this._spSkyFromSpaceColorCorrect=y.fromCache({context:ut,vertexShaderSource:tt,fragmentShaderSource:ft});tt=new p({defines:["SKY_FROM_ATMOSPHERE"],sources:[k]});this._spSkyFromAtmosphereColorCorrect=y.fromCache({context:ut,vertexShaderSource:tt,fragmentShaderSource:ft})}return et=t.camera.positionWC,rt=n.magnitude(et),this._cameraAndRadiiAndDynamicAtmosphereColor.x=rt,i.shaderProgram=rt>this._cameraAndRadiiAndDynamicAtmosphereColor.y?e?this._spSkyFromSpaceColorCorrect:this._spSkyFromSpace:e?this._spSkyFromAtmosphereColorCorrect:this._spSkyFromAtmosphere,i},tt.prototype.isDestroyed=function(){return!1},tt.prototype.destroy=function(){var n=this._command;return n.vertexArray=n.vertexArray&&n.vertexArray.destroy(),this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy(),this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy(),this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy(),this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy(),f(this)},tt});t("Shaders/SkyBoxFS",[],function(){"use strict";return"uniform samplerCube u_cubeMap;\nvarying vec3 v_texCoord;\nvoid main()\n{\nvec3 rgb = textureCube(u_cubeMap, normalize(v_texCoord)).rgb;\ngl_FragColor = vec4(rgb, czm_morphTime);\n}\n"});t("Shaders/SkyBoxVS",[],function(){"use strict";return"attribute vec3 position;\nvarying vec3 v_texCoord;\nvoid main()\n{\nvec3 p = czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\ngl_Position = czm_projection * vec4(p, 1.0);\nv_texCoord = position.xyz;\n}\n"});t("Scene/SkyBox",["../Core/BoxGeometry","../Core/Cartesian3","../Core/defaultValue","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Core/GeometryPipeline","../Core/Matrix4","../Core/VertexFormat","../Renderer/BufferUsage","../Renderer/CubeMap","../Renderer/DrawCommand","../Renderer/loadCubeMap","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/VertexArray","../Shaders/SkyBoxFS","../Shaders/SkyBoxVS","./BlendingState","./SceneMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function g(n){this.sources=n.sources;this._sources=undefined;this.show=i(n.show,!0);this._command=new l({modelMatrix:o.clone(o.IDENTITY),owner:this});this._cubeMap=undefined}return g.prototype.update=function(i){var l=this,g,u,o,nt,tt;if(!this.show||i.mode!==d.SCENE3D&&i.mode!==d.MORPHING||!i.passes.render)return undefined;if(g=i.context,this._sources!==this.sources){if(this._sources=this.sources,u=this.sources,!r(u.positiveX)||!r(u.negativeX)||!r(u.positiveY)||!r(u.negativeY)||!r(u.positiveZ)||!r(u.negativeZ))throw new f("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof u.positiveX!=typeof u.negativeX||typeof u.positiveX!=typeof u.positiveY||typeof u.positiveX!=typeof u.negativeY||typeof u.positiveX!=typeof u.positiveZ||typeof u.positiveX!=typeof u.negativeZ)throw new f("this.sources properties must all be the same type.");typeof u.positiveX=="string"?a(g,this._sources).then(function(n){l._cubeMap=l._cubeMap&&l._cubeMap.destroy();l._cubeMap=n}):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new c({context:g,source:u}))}return(o=this._command,r(o.vertexArray)||(o.uniformMap={u_cubeMap:function(){return l._cubeMap}},nt=n.createGeometry(n.fromDimensions({dimensions:new t(2,2,2),vertexFormat:s.POSITION_ONLY})),tt=e.createAttributeLocations(nt),o.vertexArray=p.fromGeometry({context:g,geometry:nt,attributeLocations:tt,bufferUsage:h.STATIC_DRAW}),o.shaderProgram=y.fromCache({context:g,vertexShaderSource:b,fragmentShaderSource:w,attributeLocations:tt}),o.renderState=v.fromCache({blending:k.ALPHA_BLEND})),!r(this._cubeMap))?undefined:o},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){var n=this._command;return n.vertexArray=n.vertexArray&&n.vertexArray.destroy(),n.shaderProgram=n.shaderProgram&&n.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),u(this)},g});t("Scene/SphereEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(n,t,i,r,u){"use strict";function f(n){n=i(n,1);t.typeOf.number.greaterThan("radius",n,0);this._radius=i(n,1)}return r(f.prototype,{radius:{get:function(){return this._radius},set:function(n){t.typeOf.number.greaterThan("value",n,0);this._radius=n}}}),f.prototype.emit=function(t){var f=u.randomBetween(0,u.TWO_PI),i=u.randomBetween(0,u.PI),r=u.randomBetween(0,this._radius),e=r*Math.cos(f)*Math.sin(i),o=r*Math.sin(f)*Math.sin(i),s=r*Math.cos(i);t.position=n.fromElements(e,o,s,t.position);t.velocity=n.normalize(t.position,t.velocity)},f});t("Scene/StyleExpression",["../Core/DeveloperError"],function(n){"use strict";function t(){}return t.prototype.evaluate=function(){n.throwInstantiationError()},t.prototype.evaluateColor=function(){n.throwInstantiationError()},t.prototype.getShaderFunction=function(){n.throwInstantiationError()},t});t("Shaders/SunFS",[],function(){"use strict";return"uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor = texture2D(u_texture, v_textureCoordinates);\n}\n"});t("Shaders/SunTextureFS",[],function(){"use strict";return"uniform float u_glowLengthTS;\nuniform float u_radiusTS;\nvarying vec2 v_textureCoordinates;\nvec2 rotate(vec2 p, vec2 direction)\n{\nreturn vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\n}\nvec4 addBurst(vec2 position, vec2 direction)\n{\nvec2 rotatedPosition = rotate(position, direction) * vec2(25.0, 0.75);\nfloat radius = length(rotatedPosition);\nfloat burst = 1.0 - smoothstep(0.0, 0.55, radius);\nreturn vec4(burst);\n}\nvoid main()\n{\nvec2 position = v_textureCoordinates - vec2(0.5);\nfloat radius = length(position);\nfloat surface = step(radius, u_radiusTS);\nvec4 color = vec4(1.0, 1.0, surface + 0.2, surface);\nfloat glow = 1.0 - smoothstep(0.0, 0.55, radius);\ncolor.ba += mix(vec2(0.0), vec2(1.0), glow) * 0.75;\nvec4 burst = vec4(0.0);\nburst += 0.4 * addBurst(position, vec2(0.38942,  0.92106));\nburst += 0.4 * addBurst(position, vec2(0.99235,  0.12348));\nburst += 0.4 * addBurst(position, vec2(0.60327, -0.79754));\nburst += 0.3 * addBurst(position, vec2(0.31457,  0.94924));\nburst += 0.3 * addBurst(position, vec2(0.97931,  0.20239));\nburst += 0.3 * addBurst(position, vec2(0.66507, -0.74678));\ncolor += clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\ngl_FragColor = clamp(color, vec4(0.0), vec4(1.0));\n}\n"});t("Shaders/SunVS",[],function(){"use strict";return"attribute vec2 direction;\nuniform float u_size;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 position;\nif (czm_morphTime == 1.0)\n{\nposition = vec4(czm_sunPositionWC, 1.0);\n}\nelse\n{\nposition = vec4(czm_sunPositionColumbusView.zxy, 1.0);\n}\nvec4 positionEC = czm_view * position;\nvec4 positionWC = czm_eyeToWindowCoordinates(positionEC);\nvec2 halfSize = vec2(u_size * 0.5);\nhalfSize *= ((direction * 2.0) - 1.0);\ngl_Position = czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\nv_textureCoordinates = direction;\n}\n"});t("Scene/Sun",["../Core/BoundingSphere","../Core/Cartesian2","../Core/Cartesian3","../Core/Cartesian4","../Core/ComponentDatatype","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/IndexDatatype","../Core/Math","../Core/Matrix4","../Core/PixelFormat","../Core/PrimitiveType","../Renderer/Buffer","../Renderer/BufferUsage","../Renderer/ComputeCommand","../Renderer/DrawCommand","../Renderer/RenderState","../Renderer/ShaderProgram","../Renderer/Texture","../Renderer/VertexArray","../Shaders/SunFS","../Shaders/SunTextureFS","../Shaders/SunVS","./BlendingState","./SceneMode","./SceneTransforms"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft){"use strict";function et(){this.show=!0;this._drawCommand=new w({primitiveType:a.TRIANGLES,boundingVolume:new n,owner:this});this._commands={drawCommand:this._drawCommand,computeCommand:undefined};this._boundingVolume=new n;this._boundingVolume2D=new n;this._texture=undefined;this._drawingBufferWidth=undefined;this._drawingBufferHeight=undefined;this._radiusTS=undefined;this._size=undefined;this.glowFactor=1;this._glowFactorDirty=!1;var t=this;this._uniformMap={u_texture:function(){return t._texture},u_size:function(){return t._size}}}e(et.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(n){n=Math.max(n,0);this._glowFactor=n;this._glowFactorDirty=!0}}});var st=new t,ht=new t,ct=new r,ot=new r;return et.prototype.update=function(r,e){var at,et,yt,gt,w,kt,o,ii,ri,ui,fi;if(!this.show||(at=r.mode,at===ut.SCENE2D||at===ut.MORPHING)||!r.passes.render)return undefined;var a=r.context,wt=e.viewport.width,bt=e.viewport.height;if((!f(this._texture)||wt!==this._drawingBufferWidth||bt!==this._drawingBufferHeight||this._glowFactorDirty)&&(this._texture=this._texture&&this._texture.destroy(),this._drawingBufferWidth=wt,this._drawingBufferHeight=bt,this._glowFactorDirty=!1,et=Math.max(wt,bt),et=Math.pow(2,Math.ceil(Math.log(et)/Math.log(2))-2),et=Math.max(1,et),this._texture=new d({context:a,width:et,height:et,pixelFormat:l.RGBA}),this._glowLengthTS=this._glowFactor*5,this._radiusTS=1/(1+2*this._glowLengthTS)*.5,yt=this,gt={u_glowLengthTS:function(){return yt._glowLengthTS},u_radiusTS:function(){return yt._radiusTS}},this._commands.computeCommand=new p({fragmentShaderSource:tt,outputTexture:this._texture,uniformMap:gt,persists:!1,owner:this,postExecute:function(){yt._commands.computeCommand=undefined}})),w=this._drawCommand,!f(w.vertexArray)){kt={direction:0};o=new Uint8Array(8);o[0]=0;o[1]=0;o[2]=255;o[3]=0;o[4]=255;o[5]=255;o[6]=0;o[7]=255;var ei=v.createVertexBuffer({context:a,typedArray:o,usage:y.STATIC_DRAW}),oi=[{index:kt.direction,vertexBuffer:ei,componentsPerAttribute:2,normalize:!0,componentDatatype:u.UNSIGNED_BYTE}],si=v.createIndexBuffer({context:a,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:y.STATIC_DRAW,indexDatatype:s.UNSIGNED_SHORT});w.vertexArray=new g({context:a,attributes:oi,indexBuffer:si});w.shaderProgram=k.fromCache({context:a,vertexShaderSource:it,fragmentShaderSource:nt,attributeLocations:kt});w.renderState=b.fromCache({blending:rt.ALPHA_BLEND});w.uniformMap=this._uniformMap}var ni=a.uniformState.sunPositionWC,dt=a.uniformState.sunPositionColumbusView,pt=this._boundingVolume,vt=this._boundingVolume2D;i.clone(ni,pt.center);vt.center.x=dt.z;vt.center.y=dt.x;vt.center.z=dt.y;pt.radius=h.SOLAR_RADIUS+h.SOLAR_RADIUS*this._glowLengthTS;vt.radius=pt.radius;at===ut.SCENE3D?n.clone(pt,w.boundingVolume):at===ut.COLUMBUS_VIEW&&n.clone(vt,w.boundingVolume);var hi=ft.computeActualWgs84Position(r,ni,ot),ci=i.magnitude(i.subtract(hi,r.camera.position,ot)),ti=a.uniformState.projection,lt=ct;return lt.x=0,lt.y=0,lt.z=-ci,lt.w=1,ii=c.multiplyByVector(ti,lt,ot),ri=ft.clipToGLWindowCoordinates(e.viewport,ii,st),lt.x=h.SOLAR_RADIUS,ui=c.multiplyByVector(ti,lt,ot),fi=ft.clipToGLWindowCoordinates(e.viewport,ui,ht),this._size=Math.ceil(t.magnitude(t.subtract(fi,ri,ot))),this._size=2*this._size*(1+2*this._glowLengthTS),this._commands},et.prototype.isDestroyed=function(){return!1},et.prototype.destroy=function(){var n=this._drawCommand;return n.vertexArray=n.vertexArray&&n.vertexArray.destroy(),n.shaderProgram=n.shaderProgram&&n.shaderProgram.destroy(),this._texture=this._texture&&this._texture.destroy(),o(this)},et});t("Scene/TileBoundingVolume",["../Core/DeveloperError"],function(n){"use strict";function t(){}return t.prototype.boundingVolume=undefined,t.prototype.boundingSphere=undefined,t.prototype.distanceToCamera=function(){n.throwInstantiationError()},t.prototype.intersectPlane=function(){n.throwInstantiationError()},t.prototype.createDebugVolume=function(){n.throwInstantiationError()},t});t("Scene/TileCoordinatesImageryProvider",["../Core/Color","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/Event","../Core/GeographicTilingScheme","../ThirdParty/when"],function(n,t,i,r,u,f,e){"use strict";function o(r){r=t(r,t.EMPTY_OBJECT);this._tilingScheme=i(r.tilingScheme)?r.tilingScheme:new f({ellipsoid:r.ellipsoid});this._color=t(r.color,n.YELLOW);this._errorEvent=new u;this._tileWidth=t(r.tileWidth,256);this._tileHeight=t(r.tileHeight,256);this._readyPromise=e.resolve(!0)}return r(o.prototype,{proxy:{get:function(){return undefined}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return undefined}},minimumLevel:{get:function(){return undefined}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){return undefined}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return undefined}},hasAlphaChannel:{get:function(){return!0}}}),o.prototype.getTileCredits=function(){return undefined},o.prototype.requestImage=function(n,t,i){var u=document.createElement("canvas"),r,f,e;return u.width=256,u.height=256,r=u.getContext("2d"),f=this._color.toCssColorString(),r.strokeStyle=f,r.lineWidth=2,r.strokeRect(1,1,255,255),e="L"+i+"X"+n+"Y"+t,r.font="bold 25px Arial",r.textAlign="center",r.fillStyle="black",r.fillText(e,127,127),r.fillStyle=f,r.fillText(e,124,124),u},o.prototype.pickFeatures=function(){return undefined},o});t("Scene/TileDiscardPolicy",["../Core/DeveloperError"],function(n){"use strict";function t(){n.throwInstantiationError()}return t.prototype.isReady=n.throwInstantiationError,t.prototype.shouldDiscardImage=n.throwInstantiationError,t});t("Scene/TileState",["../Core/freezeObject"],function(n){"use strict";return n({START:0,LOADING:1,READY:2,UPSAMPLED_ONLY:3})});t("Scene/TimeDynamicPointCloud",["../Core/arrayFill","../Core/Check","../Core/combine","../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/Event","../Core/getTimestamp","../Core/JulianDate","../Core/Math","../Core/Matrix4","../Core/Resource","../ThirdParty/when","./ClippingPlaneCollection","./PointCloud","./PointCloudEyeDomeLighting","./PointCloudShading","./SceneMode","./ShadowMode"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){"use strict";function g(i){i=r(i,r.EMPTY_OBJECT);t.typeOf.object("options.clock",i.clock);t.typeOf.object("options.intervals",i.intervals);this.show=r(i.show,!0);this.modelMatrix=l.clone(r(i.modelMatrix,l.IDENTITY));this.shadows=r(i.shadows,d.ENABLED);this.maximumMemoryUsage=r(i.maximumMemoryUsage,256);this.shading=new b(i.shading);this.style=i.style;this.frameFailed=new o;this.frameChanged=new o;this._clock=i.clock;this._intervals=i.intervals;this._clippingPlanes=undefined;this.clippingPlanes=i.clippingPlanes;this._pointCloudEyeDomeLighting=new w;this._loadTimestamp=undefined;this._clippingPlanesState=0;this._styleDirty=!1;this._pickId=undefined;this._totalMemoryUsageInBytes=0;this._frames=[];this._previousInterval=undefined;this._nextInterval=undefined;this._lastRenderedFrame=undefined;this._clockMultiplier=0;this._readyPromise=v.defer();this._runningSum=0;this._runningLength=0;this._runningIndex=0;this._runningSamples=n(new Array(5),0);this._runningAverage=0}function ht(n){return"uniform vec4 czm_pickColor;\n"+n}function ct(n){return function(t){return i(t,{czm_pickColor:function(){return n._pickId.color}})}}function lt(){return"czm_pickColor"}function it(n){var t=n._clock,i=t.canAnimate&&t.shouldAnimate,r=t.multiplier;return i?r:0}function nt(n,t){return n._intervals.indexOf(t.start)}function at(n,t){var u=n._intervals,f=n._clock,r=it(n);if(r===0)return undefined;var e=n._getAverageLoadTime(),o=h.addSeconds(f.currentTime,e*r,ut),i=u.indexOf(o),s=nt(n,t);return i===s&&(r>=0?++i:--i),u.get(i)}function vt(n){var t=n._intervals,i=n._clock,r=i.currentTime,u=t.indexOf(r);return t.get(u)}function yt(n,t,i){var f=it(n),r=nt(n,t),u=nt(n,i);return f>=0?r>=u:r<=u}function pt(n,t){return function(i){var r=u(i.message)?i.message:i.toString();n.frameFailed.numberOfListeners>0?n.frameFailed.raiseEvent({uri:t,message:r}):(console.log("A frame failed to load: "+t),console.log("Error: "+r))}}function wt(n,t,i){var f=nt(n,t),e=n._frames,r=e[f];if(!u(r)){var o=t.data.transform,c=u(o)?l.fromArray(o):undefined,h=t.data.uri;r={pointCloud:undefined,transform:c,timestamp:s(),sequential:!0,ready:!1,touchedFrameNumber:i.frameNumber};e[f]=r;a.fetchArrayBuffer({url:h}).then(function(t){return r.pointCloud=new p({arrayBuffer:t,cull:!0,fragmentShaderLoaded:ht,uniformMapLoaded:ct(n),pickIdLoaded:lt}),r.pointCloud.readyPromise}).otherwise(pt(n,h))}return r}function bt(n,t){n._runningSum+=t;n._runningSum-=n._runningSamples[n._runningIndex];n._runningSamples[n._runningIndex]=t;n._runningLength=Math.min(n._runningLength+1,n._runningSamples.length);n._runningIndex=(n._runningIndex+1)%n._runningSamples.length;n._runningAverage=n._runningSum/n._runningLength}function kt(n,t,i,r){var f,e,o,h;t.touchedFrameNumber<r.frameNumber-1&&(t.sequential=!1);f=t.pointCloud;u(f)&&!t.ready&&(e=r.commandList,o=e.length,et(n,t,i,r),f.ready&&(t.ready=!0,n._totalMemoryUsageInBytes+=f.geometryByteLength,e.length=o,t.sequential&&(h=(s()-t.timestamp)/1e3,bt(n,h))));t.touchedFrameNumber=r.frameNumber}function dt(n,t){var i=n.shading;return u(i)&&u(i.baseResolution)?i.baseResolution:u(t.boundingSphere)?c.cbrt(t.boundingSphere.volume()/t.pointsLength):0}function gt(n){var t=n.shading;return u(t)&&u(t.maximumAttenuation)?t.maximumAttenuation:10}function et(n,t,i,f){var e=t.pointCloud,s=r(t.transform,l.IDENTITY),o;e.modelMatrix=l.multiplyTransformation(n.modelMatrix,s,ft);e.style=n.style;e.time=i.timeSinceLoad;e.shadows=n.shadows;e.clippingPlanes=n._clippingPlanes;e.isClipped=i.isClipped;o=n.shading;u(o)&&(e.attenuation=o.attenuation,e.geometricError=dt(n,e),e.geometricErrorScale=o.geometricErrorScale,e.maximumAttenuation=gt(n));e.update(f);t.touchedFrameNumber=f.frameNumber}function rt(n,t,i,r){var u=wt(n,t,r);kt(n,u,i,r)}function ni(n){return function(t){return t.touchedFrameNumber<n.frameNumber}}function ot(n,t){for(var i,f,e=n._frames,o=e.length,r=0;r<o;++r)i=e[r],u(i)&&(!u(t)||t(i))&&(f=i.pointCloud,i.ready&&(n._totalMemoryUsageInBytes-=f.geometryByteLength),u(f)&&f.destroy(),i===n._lastRenderedFrame&&(n._lastRenderedFrame=undefined),e[r]=undefined)}function ti(n,t){var r=nt(n,t),i=n._frames[r];if(u(i)&&i.ready)return i}function st(n,t,i,r,f){return u(i)?i.ready?!0:(rt(n,t,r,f),i.ready):!1}function ii(n,t,i,r,u){var f,e,o,c=n._intervals,l=n._frames,s=nt(n,i),h=nt(n,t);if(s>=h){for(f=s;f>=h;--f)if(e=c.get(f),o=l[f],st(n,e,o,r,u))return e}else for(f=s;f<=h;++f)if(e=c.get(f),o=l[f],st(n,e,o,r,u))return e;return t}function ri(n,t,i){for(var r,e=n._frames,o=e.length,f=0;f<o;++f)r=e[f],u(r)&&u(r.pointCloud)&&(r.pointCloud.clippingPlanesDirty=t,r.pointCloud.styleDirty=i)}var ut,ft,tt;return f(g.prototype,{clippingPlanes:{get:function(){return this._clippingPlanes},set:function(n){y.setOwner(n,this,"_clippingPlanes")}},totalMemoryUsageInBytes:{get:function(){return this._totalMemoryUsageInBytes}},boundingSphere:{get:function(){if(u(this._lastRenderedFrame))return this._lastRenderedFrame.pointCloud.boundingSphere}},readyPromise:{get:function(){return this._readyPromise.promise}}}),g.prototype.makeStyleDirty=function(){this._styleDirty=!0},g.prototype._getAverageLoadTime=function(){return this._runningLength===0?.05:this._runningAverage},ut=new h,ft=new l,tt={timeSinceLoad:0,isClipped:!1,clippingPlanesDirty:!1},g.prototype.update=function(n){var a,t,f,d,g,nt,ut;if(n.mode!==k.MORPHING&&this.show){u(this._pickId)||(this._pickId=n.context.createPickId({primitive:this}));u(this._loadTimestamp)||(this._loadTimestamp=h.clone(n.time));var ft=Math.max(h.secondsDifference(n.time,this._loadTimestamp)*1e3,0),o=this._clippingPlanes,c=0,l=!1,y=u(o)&&o.enabled;y&&(o.update(n),c=o.clippingPlanesState);this._clippingPlanesState!==c&&(this._clippingPlanesState=c,l=!0);a=this._styleDirty;this._styleDirty=!1;(l||a)&&ri(this,l,a);tt.timeSinceLoad=ft;tt.isClipped=y;var s=this.shading,st=this._pointCloudEyeDomeLighting,p=n.commandList,w=p.length,i=this._previousInterval,r=this._nextInterval,e=vt(this);if(u(e)){var b=!1,v=it(this),ht=v===0;v!==this._clockMultiplier&&(b=!0,this._clockMultiplier=v);(!u(i)||ht)&&(i=e);(!u(r)||b||yt(this,e,r))&&(r=at(this,e));i=ii(this,i,e,tt,n);t=ti(this,i);u(t)||(rt(this,i,tt,n),t=this._lastRenderedFrame);u(t)&&et(this,t,tt,n);u(r)&&rt(this,r,tt,n);f=this;u(t)&&!u(this._lastRenderedFrame)&&n.afterRender.push(function(){f._readyPromise.resolve(f)});u(t)&&t!==this._lastRenderedFrame&&f.frameChanged.numberOfListeners>0&&n.afterRender.push(function(){f.frameChanged.raiseEvent(f)});this._previousInterval=i;this._nextInterval=r;this._lastRenderedFrame=t;d=this._totalMemoryUsageInBytes;g=this.maximumMemoryUsage*1048576;d>g&&ot(this,ni(n));nt=p.length;ut=nt-w;u(s)&&s.attenuation&&s.eyeDomeLighting&&ut>0&&st.update(n,w,s)}}},g.prototype.isDestroyed=function(){return!1},g.prototype.destroy=function(){return ot(this),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),e(this)},g});t("Shaders/ViewportQuadFS",[],function(){"use strict";return"varying vec2 v_textureCoordinates;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.s = v_textureCoordinates.s;\nmaterialInput.st = v_textureCoordinates;\nmaterialInput.str = vec3(v_textureCoordinates, 0.0);\nmaterialInput.normalEC = vec3(0.0, 0.0, -1.0);\nczm_material material = czm_getMaterial(materialInput);\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n}\n"});t("Scene/ViewportQuad",["../Core/BoundingRectangle","../Core/Color","../Core/defined","../Core/destroyObject","../Core/DeveloperError","../Renderer/Pass","../Renderer/RenderState","../Renderer/ShaderSource","../Shaders/ViewportQuadFS","./BlendingState","./Material"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function l(r,u){this.show=!0;i(r)||(r=new n);this.rectangle=n.clone(r);i(u)||(u=c.fromType(c.ColorType,{color:new t(1,1,1,1)}));this.material=u;this._material=undefined;this._overlayCommand=undefined;this._rs=undefined}return l.prototype.update=function(t){var r,l,c,a;if(this.show){if(!i(this.material))throw new u("this.material must be defined.");if(!i(this.rectangle))throw new u("this.rectangle must be defined.");r=this._rs;i(r)&&n.equals(r.viewport,this.rectangle)||(this._rs=e.fromCache({blending:h.ALPHA_BLEND,viewport:this.rectangle}));l=t.passes;l.render&&(c=t.context,this._material===this.material&&i(this._overlayCommand)||(this._material=this.material,i(this._overlayCommand)&&this._overlayCommand.shaderProgram.destroy(),a=new o({sources:[this._material.shaderSource,s]}),this._overlayCommand=c.createViewportQuadCommand(a,{renderState:this._rs,uniformMap:this._material._uniforms,owner:this}),this._overlayCommand.pass=f.OVERLAY),this._material.update(c),this._overlayCommand.uniformMap=this._material._uniforms,t.commandList.push(this._overlayCommand))}},l.prototype.isDestroyed=function(){return!1},l.prototype.destroy=function(){return i(this._overlayCommand)&&(this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.destroy()),r(this)},l}),function(){(function(n){var u=this||eval("this"),i=u.document,e=u.navigator,r=u.jQuery,f=u.JSON;(function(n){"function"==typeof t&&t.amd?t("ThirdParty/knockout-3.4.2",["exports","require"],n):"object"==typeof exports&&"object"==typeof module?n(module.exports||exports):n(u.ko={})})(function(t,o){function b(n,t){return null===n||typeof n in nt?n===t:!1}function tt(t,i){var r;return function(){r||(r=s.a.setTimeout(function(){r=n;t()},i))}}function it(n,t){var i;return function(){clearTimeout(i);i=s.a.setTimeout(n,t)}}function rt(n,t){t&&t!==v?"beforeChange"===t?this.Ob(n):this.Ja(n,t):this.Pb(n)}function ut(n,t){null!==t&&t.k&&t.k()}function ft(n,t){var i=this.Mc,r=i[h];r.T||(this.ob&&this.Oa[t]?(i.Sb(t,n,this.Oa[t]),this.Oa[t]=null,--this.ob):r.s[t]||i.Sb(t,n,r.t?{$:n}:i.yc(n)),n.Ha&&n.Hc())}function k(n,t,i,r){s.d[n]={init:function(n,u,f,e,o){var c,h;return s.m(function(){var l=u(),f=s.a.c(l),f=!i!=!f,e=!h;(e||t||f!==c)&&(e&&s.xa.Ca()&&(h=s.a.wa(s.f.childNodes(n),!0)),f?(e||s.f.fa(n,s.a.wa(h)),s.hb(r?r(o,l):o,n)):s.f.za(n),c=f)},null,{i:n}),{controlsDescendantBindings:!0}}};s.h.va[n]=!1;s.f.aa[n]=!0}var s="undefined"!=typeof t?t:{},nt,v,l,y,a,p,h,d,g,w;s.b=function(n,t){for(var i=n.split("."),r=s,u=0;u<i.length-1;u++)r=r[i[u]];r[i[i.length-1]]=t};s.H=function(n,t,i){n[t]=i};s.version="3.4.2";s.b("version",s.version);s.options={deferUpdates:!1,useOnlyNativeEvents:!1};s.a=function(){function o(n,t){for(var i in n)n.hasOwnProperty(i)&&t(i,n[i])}function l(n,t){if(t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function a(n,t){return n.__proto__=t,n}function v(n,t,i,r){var u=n[t].match(c)||[];s.a.r(i.match(c),function(n){s.a.ra(u,n,r)});n[t]=u.join(" ")}var y={__proto__:[]}instanceof Array,w="function"==typeof Symbol,h={},p={};h[e&&/Firefox\/2/i.test(e.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];h.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");o(h,function(n,t){if(t.length)for(var i=0,r=t.length;i<r;i++)p[t[i]]=n});var b={propertychange:!0},t=i&&function(){for(var t=3,r=i.createElement("div"),u=r.getElementsByTagName("i");r.innerHTML="<!--[if gt IE "+ ++t+"]><i><\/i><![endif]-->",u[0];);return 4<t?t:n}(),c=/\S+/g;return{gc:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],r:function(n,t){for(var i=0,r=n.length;i<r;i++)t(n[i],i)},o:function(n,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(n,t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},Vb:function(n,t,i){for(var r=0,u=n.length;r<u;r++)if(t.call(i,n[r],r))return n[r];return null},Na:function(n,t){var i=s.a.o(n,t);0<i?n.splice(i,1):0===i&&n.shift()},Wb:function(n){n=n||[];for(var i=[],t=0,r=n.length;t<r;t++)0>s.a.o(i,n[t])&&i.push(n[t]);return i},ib:function(n,t){n=n||[];for(var r=[],i=0,u=n.length;i<u;i++)r.push(t(n[i],i));return r},Ma:function(n,t){n=n||[];for(var r=[],i=0,u=n.length;i<u;i++)t(n[i],i)&&r.push(n[i]);return r},ta:function(n,t){if(t instanceof Array)n.push.apply(n,t);else for(var i=0,r=t.length;i<r;i++)n.push(t[i]);return n},ra:function(n,t,i){var r=s.a.o(s.a.Bb(n),t);0>r?i&&n.push(t):i||n.splice(r,1)},la:y,extend:l,$a:a,ab:y?a:l,D:o,Ea:function(n,t){if(!n)return n;var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=t(n[i],i,n));return r},rb:function(n){for(;n.firstChild;)s.removeNode(n.firstChild)},nc:function(n){n=s.a.W(n);for(var r=(n[0]&&n[0].ownerDocument||i).createElement("div"),t=0,u=n.length;t<u;t++)r.appendChild(s.ba(n[t]));return r},wa:function(n,t){for(var r,i=0,f=n.length,u=[];i<f;i++)r=n[i].cloneNode(!0),u.push(t?s.ba(r):r);return u},fa:function(n,t){if(s.a.rb(n),t)for(var i=0,r=t.length;i<r;i++)n.appendChild(t[i])},uc:function(n,t){var r=n.nodeType?[n]:n;if(0<r.length){for(var f=r[0],e=f.parentNode,i=0,u=t.length;i<u;i++)e.insertBefore(t[i],f);for(i=0,u=r.length;i<u;i++)s.removeNode(r[i])}},Ba:function(n,t){if(n.length){for(t=8===t.nodeType&&t.parentNode||t;n.length&&n[0].parentNode!==t;)n.splice(0,1);for(;1<n.length&&n[n.length-1].parentNode!==t;)n.length--;if(1<n.length){var i=n[0],r=n[n.length-1];for(n.length=0;i!==r;)n.push(i),i=i.nextSibling;n.push(r)}}return n},wc:function(n,i){7>t?n.setAttribute("selected",i):n.selected=i},cb:function(t){return null===t||t===n?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},sd:function(n,t){return n=n||"",t.length>n.length?!1:n.substring(0,t.length)===t},Rc:function(n,t){if(n===t)return!0;if(11===n.nodeType)return!1;if(t.contains)return t.contains(3===n.nodeType?n.parentNode:n);if(t.compareDocumentPosition)return 16==(t.compareDocumentPosition(n)&16);for(;n&&n!=t;)n=n.parentNode;return!!n},qb:function(n){return s.a.Rc(n,n.ownerDocument.documentElement)},Tb:function(n){return!!s.a.Vb(n,s.a.qb)},A:function(n){return n&&n.tagName&&n.tagName.toLowerCase()},Zb:function(n){return s.onError?function(){try{return n.apply(this,arguments)}catch(t){throw s.onError&&s.onError(t),t;}}:n},setTimeout:function(n,t){return setTimeout(s.a.Zb(n),t)},dc:function(n){setTimeout(function(){s.onError&&s.onError(n);throw n;},0)},q:function(n,i,u){var f=s.a.Zb(u),e,o;if(u=t&&b[i],s.options.useOnlyNativeEvents||u||!r)if(u||"function"!=typeof n.addEventListener)if("undefined"!=typeof n.attachEvent)e=function(t){f.call(n,t)},o="on"+i,n.attachEvent(o,e),s.a.G.qa(n,function(){n.detachEvent(o,e)});else throw Error("Browser doesn't support addEventListener or attachEvent");else n.addEventListener(i,f,!1);else r(n).bind(i,f)},Fa:function(n,t){if(!n||!n.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var f;if("input"===s.a.A(n)&&n.type&&"click"==t.toLowerCase()?(f=n.type,f="checkbox"==f||"radio"==f):f=!1,s.options.useOnlyNativeEvents||!r||f)if("function"==typeof i.createEvent)if("function"==typeof n.dispatchEvent)f=i.createEvent(p[t]||"HTMLEvents"),f.initEvent(t,!0,!0,u,0,0,0,0,0,!1,!1,!1,!1,0,n),n.dispatchEvent(f);else throw Error("The supplied element doesn't support dispatchEvent");else if(f&&n.click)n.click();else if("undefined"!=typeof n.fireEvent)n.fireEvent("on"+t);else throw Error("Browser doesn't support triggering events");else r(n).trigger(t)},c:function(n){return s.I(n)?n():n},Bb:function(n){return s.I(n)?n.p():n},fb:function(n,t,i){var r;t&&("object"==typeof n.classList?(r=n.classList[i?"add":"remove"],s.a.r(t.match(c),function(t){r.call(n.classList,t)})):"string"==typeof n.className.baseVal?v(n.className,"baseVal",t,i):v(n,"className",t,i))},bb:function(t,i){var r=s.a.c(i),u;(null===r||r===n)&&(r="");u=s.f.firstChild(t);!u||3!=u.nodeType||s.f.nextSibling(u)?s.f.fa(t,[t.ownerDocument.createTextNode(r)]):u.data=r;s.a.Wc(t)},vc:function(n,r){if(n.name=r,7>=t)try{n.mergeAttributes(i.createElement("<input name='"+n.name+"'/>"),!1)}catch(u){}},Wc:function(n){9<=t&&(n=1==n.nodeType?n:n.parentNode,n.style&&(n.style.zoom=n.style.zoom))},Sc:function(n){if(t){var i=n.style.width;n.style.width=0;n.style.width=i}},nd:function(n,t){n=s.a.c(n);t=s.a.c(t);for(var r=[],i=n;i<=t;i++)r.push(i);return r},W:function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i},bc:function(n){return w?Symbol(n):n},xd:6===t,yd:7===t,C:t,ic:function(n,t){for(var r=s.a.W(n.getElementsByTagName("input")).concat(s.a.W(n.getElementsByTagName("textarea"))),f="string"==typeof t?function(n){return n.name===t}:function(n){return t.test(n.name)},u=[],i=r.length-1;0<=i;i--)f(r[i])&&u.push(r[i]);return u},kd:function(n){return"string"==typeof n&&(n=s.a.cb(n))?f&&f.parse?f.parse(n):new Function("return "+n)():null},Gb:function(n,t,i){if(!f||!f.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return f.stringify(s.a.c(n),t,i)},ld:function(n,t,r){var v,e,h,f,u,c;r=r||{};var l=r.params||{},a=r.includeFields||this.gc,v=n;if("object"==typeof n&&"form"===s.a.A(n))for(v=n.action,e=a.length-1;0<=e;e--)for(h=s.a.ic(n,a[e]),f=h.length-1;0<=f;f--)l[h[f].name]=h[f].value;t=s.a.c(t);u=i.createElement("form");u.style.display="none";u.action=v;u.method="post";for(c in t)n=i.createElement("input"),n.type="hidden",n.name=c,n.value=s.a.Gb(s.a.c(t[c])),u.appendChild(n);o(l,function(n,t){var r=i.createElement("input");r.type="hidden";r.name=n;r.value=t;u.appendChild(r)});i.body.appendChild(u);r.submitter?r.submitter(u):u.submit();setTimeout(function(){u.parentNode.removeChild(u)},0)}}}();s.b("utils",s.a);s.b("utils.arrayForEach",s.a.r);s.b("utils.arrayFirst",s.a.Vb);s.b("utils.arrayFilter",s.a.Ma);s.b("utils.arrayGetDistinctValues",s.a.Wb);s.b("utils.arrayIndexOf",s.a.o);s.b("utils.arrayMap",s.a.ib);s.b("utils.arrayPushAll",s.a.ta);s.b("utils.arrayRemoveItem",s.a.Na);s.b("utils.extend",s.a.extend);s.b("utils.fieldsIncludedWithJsonPost",s.a.gc);s.b("utils.getFormFields",s.a.ic);s.b("utils.peekObservable",s.a.Bb);s.b("utils.postJson",s.a.ld);s.b("utils.parseJson",s.a.kd);s.b("utils.registerEventHandler",s.a.q);s.b("utils.stringifyJson",s.a.Gb);s.b("utils.range",s.a.nd);s.b("utils.toggleDomNodeCssClass",s.a.fb);s.b("utils.triggerEvent",s.a.Fa);s.b("utils.unwrapObservable",s.a.c);s.b("utils.objectForEach",s.a.D);s.b("utils.addOrRemoveItem",s.a.ra);s.b("utils.setTextContent",s.a.bb);s.b("unwrap",s.a.c);Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i;return 1===arguments.length?function(){return t.apply(n,arguments)}:(i=Array.prototype.slice.call(arguments,1),function(){var r=i.slice(0);return r.push.apply(r,arguments),t.apply(n,r)})});s.a.e=new function(){function r(r,f){var e=r[t];if(!e||"null"===e||!i[e]){if(!f)return n;e=r[t]="ko"+u++;i[e]={}}return i[e]}var u=0,t="__ko__"+(new Date).getTime(),i={};return{get:function(t,i){var u=r(t,!1);return u===n?n:u[i]},set:function(t,i,u){(u!==n||r(t,!1)!==n)&&(r(t,!0)[i]=u)},clear:function(n){var r=n[t];return r?(delete i[r],n[t]=null,!0):!1},J:function(){return u+++t}}};s.b("utils.domData",s.a.e);s.b("utils.domData.clear",s.a.e.clear);s.a.G=new function(){function t(t,i){var r=s.a.e.get(t,u);return r===n&&i&&(r=[],s.a.e.set(t,u,r)),r}function i(n){var r=t(n,!1),u;if(r)for(r=r.slice(0),u=0;u<r.length;u++)r[u](n);if(s.a.e.clear(n),s.a.G.cleanExternalData(n),f[n.nodeType])for(r=n.firstChild;n=r;)r=n.nextSibling,8===n.nodeType&&i(n)}var u=s.a.e.J(),e={1:!0,8:!0,9:!0},f={1:!0,9:!0};return{qa:function(n,i){if("function"!=typeof i)throw Error("Callback must be a function");t(n,!0).push(i)},tc:function(i,r){var f=t(i,!1);f&&(s.a.Na(f,r),0==f.length&&s.a.e.set(i,u,n))},ba:function(n){var t,r,u;if(e[n.nodeType]&&(i(n),f[n.nodeType]))for(t=[],s.a.ta(t,n.getElementsByTagName("*")),r=0,u=t.length;r<u;r++)i(t[r]);return n},removeNode:function(n){s.ba(n);n.parentNode&&n.parentNode.removeChild(n)},cleanExternalData:function(n){r&&"function"==typeof r.cleanData&&r.cleanData([n])}}};s.ba=s.a.G.ba;s.removeNode=s.a.G.removeNode;s.b("cleanNode",s.ba);s.b("removeNode",s.removeNode);s.b("utils.domNodeDisposal",s.a.G);s.b("utils.domNodeDisposal.addDisposeCallback",s.a.G.qa);s.b("utils.domNodeDisposal.removeDisposeCallback",s.a.G.tc),function(){var h=[0,"",""],t=[1,"<table>","<\/table>"],f=[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"],e=[1,"<select multiple='multiple'>","<\/select>"],c={thead:t,tbody:t,tfoot:t,tr:[2,"<table><tbody>","<\/tbody><\/table>"],td:f,th:f,option:e,optgroup:e},o=8>=s.a.C;s.a.na=function(n,t){var f,e;if(r){if(r.parseHTML)f=r.parseHTML(n,t)||[];else if((f=r.clean([n],t))&&f[0]){for(e=f[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{(f=t)||(f=i);var e=f.parentWindow||f.defaultView||u,v=s.a.cb(n).toLowerCase(),l=f.createElement("div"),a;for(a=(v=v.match(/^<([a-z]+)[ >]/))&&c[v[1]]||h,v=a[0],a="ignored<div>"+a[1]+n+a[2]+"<\/div>","function"==typeof e.innerShiv?l.appendChild(e.innerShiv(a)):(o&&f.appendChild(l),l.innerHTML=a,o&&l.parentNode.removeChild(l));v--;)l=l.lastChild;f=s.a.W(l.lastChild.childNodes)}return f};s.a.Eb=function(t,i){if(s.a.rb(t),i=s.a.c(i),null!==i&&i!==n)if("string"!=typeof i&&(i=i.toString()),r)r(t).html(i);else for(var f=s.a.na(i,t.ownerDocument),u=0;u<f.length;u++)t.appendChild(f[u])}}();s.b("utils.parseHtmlFragment",s.a.na);s.b("utils.setHtml",s.a.Eb);s.N=function(){function i(n,t){var r;if(n)if(8==n.nodeType)r=s.N.pc(n.nodeValue),null!=r&&t.push({Qc:n,hd:r});else if(1==n.nodeType)for(var r=0,u=n.childNodes,f=u.length;r<f;r++)i(u[r],t)}var t={};return{yb:function(n){if("function"!=typeof n)throw Error("You can only pass a function to ko.memoization.memoize()");var i=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return t[i]=n,"<!--[ko_memo:"+i+"]-->"},Bc:function(i,r){var u=t[i];if(u===n)throw Error("Couldn't find any memo with ID "+i+". Perhaps it's already been unmemoized.");try{return u.apply(null,r||[]),!0}finally{delete t[i]}},Cc:function(n,t){var f=[],u,o,r,e;for(i(n,f),u=0,o=f.length;u<o;u++)r=f[u].Qc,e=[r],t&&s.a.ta(e,t),s.N.Bc(f[u].hd,e),r.nodeValue="",r.parentNode&&r.parentNode.removeChild(r)},pc:function(n){return(n=n.match(/^\[ko_memo\:(.*?)\]$/))?n[1]:null}}}();s.b("memoization",s.N);s.b("memoization.memoize",s.N.yb);s.b("memoization.unmemoize",s.N.Bc);s.b("memoization.parseMemoText",s.N.pc);s.b("memoization.unmemoizeDomNodeAndDescendants",s.N.Cc);s.Z=function(){function f(){if(n)for(var i=n,u=0,f;t<n;)if(f=r[t++]){if(t>i){if(5e3<=++u){t=n;s.a.dc(Error("'Too much recursion' after processing "+u+" task groups."));break}i=n}try{f()}catch(e){s.a.dc(e)}}}function e(){f();t=n=r.length=0}var r=[],n=0,o=1,t=0;return{scheduler:u.MutationObserver?function(n){var t=i.createElement("div");return new MutationObserver(n).observe(t,{attributes:!0}),function(){t.classList.toggle("foo")}}(e):i&&"onreadystatechange"in i.createElement("script")?function(n){var t=i.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null;i.documentElement.removeChild(t);t=null;n()};i.documentElement.appendChild(t)}:function(n){setTimeout(n,0)},Za:function(t){return n||s.Z.scheduler(e),r[n++]=t,o++},cancel:function(i){i-=o-n;i>=t&&i<n&&(r[i]=null)},resetForTesting:function(){var i=n-t;return t=n=r.length=0,i},rd:f}}();s.b("tasks",s.Z);s.b("tasks.schedule",s.Z.Za);s.b("tasks.runEarly",s.Z.rd);s.Aa={throttle:function(n,t){n.throttleEvaluation=t;var i=null;return s.B({read:n,write:function(r){clearTimeout(i);i=s.a.setTimeout(function(){n(r)},t)}})},rateLimit:function(n,t){var i,r,u;"number"==typeof t?i=t:(i=t.timeout,r=t.method);n.gb=!1;u="notifyWhenChangesStop"==r?it:tt;n.Wa(function(n){return u(n,i)})},deferred:function(t,i){if(!0!==i)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");t.gb||(t.gb=!0,t.Wa(function(i){var u,r=!1;return function(){if(!r){s.Z.cancel(u);u=s.Z.Za(i);try{r=!0;t.notifySubscribers(n,"dirty")}finally{r=!1}}}}))},notify:function(n,t){n.equalityComparer="always"==t?null:b}};nt={undefined:1,boolean:1,number:1,string:1};s.b("extenders",s.Aa);s.zc=function(n,t,i){this.$=n;this.jb=t;this.Pc=i;this.T=!1;s.H(this,"dispose",this.k)};s.zc.prototype.k=function(){this.T=!0;this.Pc()};s.K=function(){s.a.ab(this,l);l.ub(this)};v="change";l={ub:function(n){n.F={change:[]};n.Qb=1},Y:function(n,t,i){var r=this,u;return i=i||v,u=new s.zc(r,t?n.bind(t):n,function(){s.a.Na(r.F[i],u);r.Ka&&r.Ka(i)}),r.ua&&r.ua(i),r.F[i]||(r.F[i]=[]),r.F[i].push(u),u},notifySubscribers:function(n,t){var u,i,r;if(t=t||v,t===v&&this.Kb(),this.Ra(t)){u=t===v&&this.Fc||this.F[t].slice(0);try{for(s.l.Xb(),i=0;r=u[i];++i)r.T||r.jb(n)}finally{s.l.end()}}},Pa:function(){return this.Qb},Zc:function(n){return this.Pa()!==n},Kb:function(){++this.Qb},Wa:function(n){var t=this,o=s.I(t),u,f,r,i,e;t.Ja||(t.Ja=t.notifySubscribers,t.notifySubscribers=rt);e=n(function(){t.Ha=!1;o&&i===t&&(i=t.Mb?t.Mb():t());var n=f||t.Ua(r,i);f=u=!1;n&&t.Ja(r=i)});t.Pb=function(n){t.Fc=t.F[v].slice(0);t.Ha=u=!0;i=n;e()};t.Ob=function(n){u||(r=n,t.Ja(n,"beforeChange"))};t.Hc=function(){t.Ua(r,t.p(!0))&&(f=!0)}},Ra:function(n){return this.F[n]&&this.F[n].length},Xc:function(n){if(n)return this.F[n]&&this.F[n].length||0;var t=0;return s.a.D(this.F,function(n,i){"dirty"!==n&&(t+=i.length)}),t},Ua:function(n,t){return!this.equalityComparer||!this.equalityComparer(n,t)},extend:function(n){var t=this;return n&&s.a.D(n,function(n,i){var r=s.Aa[n];"function"==typeof r&&(t=r(t,i)||t)}),t}};s.H(l,"subscribe",l.Y);s.H(l,"extend",l.extend);s.H(l,"getSubscriptionsCount",l.Xc);s.a.la&&s.a.$a(l,Function.prototype);s.K.fn=l;s.lc=function(n){return null!=n&&"function"==typeof n.Y&&"function"==typeof n.notifySubscribers};s.b("subscribable",s.K);s.b("isSubscribable",s.lc);s.xa=s.l=function(){function t(t){r.push(n);n=t}function i(){n=r.pop()}var r=[],n,u=0;return{Xb:t,end:i,sc:function(t){if(n){if(!s.lc(t))throw Error("Only subscribable things can act as dependencies");n.jb.call(n.Lc,t,t.Gc||(t.Gc=++u))}},w:function(n,r,u){try{return t(),n.apply(r,u||[])}finally{i()}},Ca:function(){if(n)return n.m.Ca()},Va:function(){if(n)return n.Va}}}();s.b("computedContext",s.xa);s.b("computedContext.getDependenciesCount",s.xa.Ca);s.b("computedContext.isInitial",s.xa.Va);s.b("ignoreDependencies",s.wd=s.l.w);y=s.a.bc("_latestValue");s.O=function(n){function t(){return 0<arguments.length?(t.Ua(t[y],arguments[0])&&(t.ia(),t[y]=arguments[0],t.ha()),this):(s.l.sc(t),t[y])}return t[y]=n,s.a.la||s.a.extend(t,s.K.fn),s.K.fn.ub(t),s.a.ab(t,a),s.options.deferUpdates&&s.Aa.deferred(t,!0),t};a={equalityComparer:b,p:function(){return this[y]},ha:function(){this.notifySubscribers(this[y])},ia:function(){this.notifySubscribers(this[y],"beforeChange")}};s.a.la&&s.a.$a(a,s.K.fn);p=s.O.md="__ko_proto__";a[p]=s.O;s.Qa=function(t,i){return null===t||t===n||t[p]===n?!1:t[p]===i?!0:s.Qa(t[p],i)};s.I=function(n){return s.Qa(n,s.O)};s.Da=function(n){return"function"==typeof n&&n[p]===s.O||"function"==typeof n&&n[p]===s.B&&n.$c?!0:!1};s.b("observable",s.O);s.b("isObservable",s.I);s.b("isWriteableObservable",s.Da);s.b("isWritableObservable",s.Da);s.b("observable.fn",a);s.H(a,"peek",a.p);s.H(a,"valueHasMutated",a.ha);s.H(a,"valueWillMutate",a.ia);s.ma=function(n){if(n=n||[],"object"!=typeof n||!("length"in n))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return n=s.O(n),s.a.ab(n,s.ma.fn),n.extend({trackArrayChanges:!0})};s.ma.fn={remove:function(n){for(var u,r=this.p(),i=[],f="function"!=typeof n||s.I(n)?function(t){return t===n}:n,t=0;t<r.length;t++)u=r[t],f(u)&&(0===i.length&&this.ia(),i.push(u),r.splice(t,1),t--);return i.length&&this.ha(),i},removeAll:function(t){if(t===n){var i=this.p(),r=i.slice(0);return this.ia(),i.splice(0,i.length),this.ha(),r}return t?this.remove(function(n){return 0<=s.a.o(t,n)}):[]},destroy:function(n){var i=this.p(),r="function"!=typeof n||s.I(n)?function(t){return t===n}:n,t;for(this.ia(),t=i.length-1;0<=t;t--)r(i[t])&&(i[t]._destroy=!0);this.ha()},destroyAll:function(t){return t===n?this.destroy(function(){return!0}):t?this.destroy(function(n){return 0<=s.a.o(t,n)}):[]},indexOf:function(n){var t=this();return s.a.o(t,n)},replace:function(n,t){var i=this.indexOf(n);0<=i&&(this.ia(),this.p()[i]=t,this.ha())}};s.a.la&&s.a.$a(s.ma.fn,s.O.fn);s.a.r("pop push reverse shift sort splice unshift".split(" "),function(n){s.ma.fn[n]=function(){var t=this.p(),i;return this.ia(),this.Yb(t,n,arguments),i=t[n].apply(t,arguments),this.ha(),i===t?this:i}});s.a.r(["slice"],function(n){s.ma.fn[n]=function(){var t=this();return t[n].apply(t,arguments)}});s.b("observableArray",s.ma);s.Aa.trackArrayChanges=function(t,i){function l(){if(!f){f=!0;u=t.notifySubscribers;t.notifySubscribers=function(n,t){return t&&t!==v||++e,u.apply(this,arguments)};var n=[].concat(t.p()||[]);r=null;o=t.Y(function(i){if(i=[].concat(i||[]),t.Ra("arrayChange")){var u;(!r||1<e)&&(r=s.a.lb(n,i,t.kb));u=r}n=i;r=null;e=0;u&&u.length&&t.notifySubscribers(u,"arrayChange")})}}if(t.kb={},i&&"object"==typeof i&&s.a.extend(t.kb,i),t.kb.sparse=!0,!t.Yb){var f=!1,r=null,o,e=0,u,h=t.ua,c=t.Ka;t.ua=function(n){h&&h.call(t,n);"arrayChange"===n&&l()};t.Ka=function(i){c&&c.call(t,i);"arrayChange"!==i||t.Ra("arrayChange")||(u&&(t.notifySubscribers=u,u=n),o.k(),f=!1)};t.Yb=function(n,t,i){function c(n,t,i){return l[l.length]={status:n,value:t,index:i}}if(f&&!e){var l=[],u=n.length,h=i.length,o=0;switch(t){case"push":o=u;case"unshift":for(t=0;t<h;t++)c("added",i[t],o+t);break;case"pop":o=u-1;case"shift":u&&c("deleted",n[o],o);break;case"splice":t=Math.min(Math.max(0,0>i[0]?u+i[0]:i[0]),u);for(var u=1===h?u:Math.min(t+(i[1]||0),u),h=t+h-2,o=Math.max(u,h),a=[],v=[],y=2;t<o;++t,++y)t<u&&v.push(c("deleted",n[t],t)),t<h&&a.push(c("added",i[y],t));s.a.hc(v,a);break;default:return}r=l}}}};h=s.a.bc("_state");s.m=s.B=function(t,i,r){function u(){if(0<arguments.length){if("function"==typeof e)e.apply(f.sb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}return s.l.sc(u),(f.V||f.t&&u.Sa())&&u.U(),f.M}if("object"==typeof t?r=t:(r=r||{},t&&(r.read=t)),"function"!=typeof r.read)throw Error("Pass a function that returns the value of the ko.computed");var e=r.write,f={M:n,da:!0,V:!0,Ta:!1,Hb:!1,T:!1,Ya:!1,t:!1,od:r.read,sb:i||r.owner,i:r.disposeWhenNodeIsRemoved||r.i||null,ya:r.disposeWhen||r.ya,pb:null,s:{},L:0,fc:null};return u[h]=f,u.$c="function"==typeof e,s.a.la||s.a.extend(u,s.K.fn),s.K.fn.ub(u),s.a.ab(u,c),r.pure?(f.Ya=!0,f.t=!0,s.a.extend(u,et)):r.deferEvaluation&&s.a.extend(u,ot),s.options.deferUpdates&&s.Aa.deferred(u,!0),f.i&&(f.Hb=!0,f.i.nodeType||(f.i=null)),f.t||r.deferEvaluation||u.U(),f.i&&u.ca()&&s.a.G.qa(f.i,f.pb=function(){u.k()}),u};var c={equalityComparer:b,Ca:function(){return this[h].L},Sb:function(n,t,i){if(this[h].Ya&&t===this)throw Error("A 'pure' computed must not be called recursively");this[h].s[n]=i;i.Ia=this[h].L++;i.pa=t.Pa()},Sa:function(){var t,n,i=this[h].s;for(t in i)if(i.hasOwnProperty(t)&&(n=i[t],this.oa&&n.$.Ha||n.$.Zc(n.pa)))return!0},gd:function(){this.oa&&!this[h].Ta&&this.oa(!1)},ca:function(){var n=this[h];return n.V||0<n.L},qd:function(){this.Ha?this[h].V&&(this[h].da=!0):this.ec()},yc:function(n){if(n.gb&&!this[h].i){var t=n.Y(this.gd,this,"dirty"),i=n.Y(this.qd,this);return{$:n,k:function(){t.k();i.k()}}}return n.Y(this.ec,this)},ec:function(){var n=this,t=n.throttleEvaluation;t&&0<=t?(clearTimeout(this[h].fc),this[h].fc=s.a.setTimeout(function(){n.U(!0)},t)):n.oa?n.oa(!0):n.U(!0)},U:function(n){var t=this[h],i=t.ya,r=!1;if(!t.Ta&&!t.T){if(t.i&&!s.a.qb(t.i)||i&&i()){if(!t.Hb){this.k();return}}else t.Hb=!1;t.Ta=!0;try{r=this.Vc(n)}finally{t.Ta=!1}return t.L||this.k(),r}},Vc:function(t){var i=this[h],u=!1,f=i.Ya?n:!i.L,r={Mc:this,Oa:i.s,ob:i.L};return s.l.Xb({Lc:r,jb:ft,m:this,Va:f}),i.s={},i.L=0,r=this.Uc(i,r),this.Ua(i.M,r)&&(i.t||this.notifySubscribers(i.M,"beforeChange"),i.M=r,i.t?this.Kb():t&&this.notifySubscribers(i.M),u=!0),f&&this.notifySubscribers(i.M,"awake"),u},Uc:function(n,t){try{var i=n.od;return n.sb?i.call(n.sb):i()}finally{s.l.end();t.ob&&!n.t&&s.a.D(t.Oa,ut);n.da=n.V=!1}},p:function(n){var t=this[h];return(t.V&&(n||!t.L)||t.t&&this.Sa())&&this.U(),t.M},Wa:function(n){s.K.fn.Wa.call(this,n);this.Mb=function(){return this[h].da?this.U():this[h].V=!1,this[h].M};this.oa=function(n){this.Ob(this[h].M);this[h].V=!0;n&&(this[h].da=!0);this.Pb(this)}},k:function(){var n=this[h];!n.t&&n.s&&s.a.D(n.s,function(n,t){t.k&&t.k()});n.i&&n.pb&&s.a.G.tc(n.i,n.pb);n.s=null;n.L=0;n.T=!0;n.da=!1;n.V=!1;n.t=!1;n.i=null}},et={ua:function(n){var i=this,t=i[h],r;!t.T&&t.t&&"change"==n&&(t.t=!1,t.da||i.Sa()?(t.s=null,t.L=0,i.U()&&i.Kb()):(r=[],s.a.D(t.s,function(n,t){r[t.Ia]=n}),s.a.r(r,function(n,r){var f=t.s[n],u=i.yc(f.$);u.Ia=r;u.pa=f.pa;t.s[n]=u})),t.T||i.notifySubscribers(t.M,"awake"))},Ka:function(t){var i=this[h];i.T||"change"!=t||this.Ra("change")||(s.a.D(i.s,function(n,t){t.k&&(i.s[n]={$:t.$,Ia:t.Ia,pa:t.pa},t.k())}),i.t=!0,this.notifySubscribers(n,"asleep"))},Pa:function(){var n=this[h];return n.t&&(n.da||this.Sa())&&this.U(),s.K.fn.Pa.call(this)}},ot={ua:function(n){"change"!=n&&"beforeChange"!=n||this.p()}};s.a.la&&s.a.$a(c,s.K.fn);d=s.O.md;s.m[d]=s.O;c[d]=s.m;s.bd=function(n){return s.Qa(n,s.m)};s.cd=function(n){return s.Qa(n,s.m)&&n[h]&&n[h].Ya};s.b("computed",s.m);s.b("dependentObservable",s.m);s.b("isComputed",s.bd);s.b("isPureComputed",s.cd);s.b("computed.fn",c);s.H(c,"peek",c.p);s.H(c,"dispose",c.k);s.H(c,"isActive",c.ca);s.H(c,"getDependenciesCount",c.Ca);s.rc=function(n,t){return"function"==typeof n?s.m(n,t,{pure:!0}):(n=s.a.extend({},n),n.pure=!0,s.m(n,t))};s.b("pureComputed",s.rc),function(){function t(u,f,e){if(e=e||new i,u=f(u),"object"!=typeof u||null===u||u===n||u instanceof RegExp||u instanceof Date||u instanceof String||u instanceof Number||u instanceof Boolean)return u;var o=u instanceof Array?[]:{};return e.save(u,o),r(u,function(i){var r=f(u[i]),s;switch(typeof r){case"boolean":case"number":case"string":case"function":o[i]=r;break;case"object":case"undefined":s=e.get(r);o[i]=s!==n?s:t(r,f,e)}}),o}function r(n,t){if(n instanceof Array){for(var i=0;i<n.length;i++)t(i);"function"==typeof n.toJSON&&t("toJSON")}else for(i in n)t(i)}function i(){this.keys=[];this.Lb=[]}s.Ac=function(n){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(n,function(n){for(var t=0;s.I(n)&&10>t;t++)n=n();return n})};s.toJSON=function(n,t,i){return n=s.Ac(n),s.a.Gb(n,t,i)};i.prototype={save:function(n,t){var i=s.a.o(this.keys,n);0<=i?this.Lb[i]=t:(this.keys.push(n),this.Lb.push(t))},get:function(t){return t=s.a.o(this.keys,t),0<=t?this.Lb[t]:n}}}();s.b("toJS",s.Ac);s.b("toJSON",s.toJSON),function(){s.j={u:function(t){switch(s.a.A(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?s.a.e.get(t,s.d.options.zb):7>=s.a.C?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?s.j.u(t.options[t.selectedIndex]):n;default:return t.value}},ja:function(t,i,r){switch(s.a.A(t)){case"option":switch(typeof i){case"string":s.a.e.set(t,s.d.options.zb,n);"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__;t.value=i;break;default:s.a.e.set(t,s.d.options.zb,i);t.__ko__hasDomDataOptionValue__=!0;t.value="number"==typeof i?i:""}break;case"select":(""===i||null===i)&&(i=n);for(var f=-1,u=0,o=t.options.length,e;u<o;++u)if(e=s.j.u(t.options[u]),e==i||""==e&&i===n){f=u;break}(r||0<=f||i===n&&1<t.size)&&(t.selectedIndex=f);break;default:(null===i||i===n)&&(i="");t.value=i}}}}();s.b("selectExtensions",s.j);s.b("selectExtensions.readValue",s.j.u);s.b("selectExtensions.writeValue",s.j.ja);s.h=function(){function n(n){var c,u,i;n=s.a.cb(n);123===n.charCodeAt(0)&&(n=n.slice(1,-1));var a=[],h=n.match(t),o,r=[],l=0;if(h)for(h.push(","),c=0;u=h[c];++c){if(i=u.charCodeAt(0),44===i){if(0>=l){a.push(o&&r.length?{key:o,value:r.join("")}:{unknown:o||r.join("")});o=l=0;r=[];continue}}else if(58===i){if(!l&&!o&&1===r.length){o=r.pop();continue}}else 47===i&&c&&1<u.length?(i=h[c-1].match(f))&&!e[i[0]]&&(n=n.substr(n.indexOf(u)+1),h=n.match(t),h.push(","),c=-1,u="/"):40===i||123===i||91===i?++l:41===i||125===i||93===i?--l:o||r.length||34!==i&&39!==i||(u=u.slice(1,-1));r.push(u)}return a}var r=["true","false","null","undefined"],u=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,t=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,e={"in":1,"return":1,"typeof":1},i={};return{va:[],ga:i,Ab:n,Xa:function(t,f){function e(n,t){var a,f;if(!l){if(f=s.getBindingHandler(n),f&&f.preprocess&&!(t=f.preprocess(t,n,e)))return;(f=i[n])&&(a=t,0<=s.a.o(r,a)?a=!1:(f=a.match(u),a=null===f?!1:f[1]?"Object("+f[1]+")"+f[2]:a),f=a);f&&o.push("'"+n+"':function(_z){"+a+"=_z}")}c&&(t="function(){return "+t+" }");h.push("'"+n+"':"+t)}f=f||{};var h=[],o=[],c=f.valueAccessors,l=f.bindingParams,a="string"==typeof t?n(t):t;return s.a.r(a,function(n){e(n.key||n.unknown,n.value)}),o.length&&e("_ko_property_writers","{"+o.join(",")+" }"),h.join(",")},fd:function(n,t){for(var i=0;i<n.length;i++)if(n[i].key==t)return!0;return!1},Ga:function(n,t,i,r,u){n&&s.I(n)?!s.Da(n)||u&&n.p()===r||n(r):(n=t.get("_ko_property_writers"))&&n[i]&&n[i](r)}}}();s.b("expressionRewriting",s.h);s.b("expressionRewriting.bindingRewriteValidators",s.h.va);s.b("expressionRewriting.parseObjectLiteral",s.h.Ab);s.b("expressionRewriting.preProcessBindings",s.h.Xa);s.b("expressionRewriting._twoWayBindings",s.h.ga);s.b("jsonExpressionRewriting",s.h);s.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",s.h.Xa),function(){function n(n){return 8==n.nodeType&&e.test(t?n.text:n.nodeValue)}function r(n){return 8==n.nodeType&&o.test(t?n.text:n.nodeValue)}function u(t,i){for(var u=t,f=1,e=[];u=u.nextSibling;){if(r(u)&&(f--,0===f))return e;e.push(u);n(u)&&f++}if(!i)throw Error("Cannot find closing comment tag to match: "+t.nodeValue);return null}function f(n,t){var i=u(n,t);return i?0<i.length?i[i.length-1].nextSibling:n.nextSibling:null}var t=i&&"<!--test-->"===i.createComment("test").text,e=t?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=t?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,h={ul:!0,ol:!0};s.f={aa:{},childNodes:function(t){return n(t)?u(t):t.childNodes},za:function(t){if(n(t)){t=s.f.childNodes(t);for(var i=0,r=t.length;i<r;i++)s.removeNode(t[i])}else s.a.rb(t)},fa:function(t,i){if(n(t)){s.f.za(t);for(var u=t.nextSibling,r=0,f=i.length;r<f;r++)u.parentNode.insertBefore(i[r],u)}else s.a.fa(t,i)},qc:function(t,i){n(t)?t.parentNode.insertBefore(i,t.nextSibling):t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i)},kc:function(t,i,r){r?n(t)?t.parentNode.insertBefore(i,r.nextSibling):r.nextSibling?t.insertBefore(i,r.nextSibling):t.appendChild(i):s.f.qc(t,i)},firstChild:function(t){return n(t)?!t.nextSibling||r(t.nextSibling)?null:t.nextSibling:t.firstChild},nextSibling:function(t){return n(t)&&(t=f(t)),t.nextSibling&&r(t.nextSibling)?null:t.nextSibling},Yc:n,vd:function(n){return(n=(t?n.text:n.nodeValue).match(e))?n[1]:null},oc:function(t){var o,i,u,e;if(h[s.a.A(t)]&&(o=t.firstChild,o))do if(1===o.nodeType){if(i=o.firstChild,u=null,i)do u?u.push(i):n(i)?(e=f(i,!0),e?i=e:u=[i]):r(i)&&(u=[i]);while(i=i.nextSibling);if(i=u)for(u=o.nextSibling,e=0;e<i.length;e++)u?t.insertBefore(i[e],u):t.appendChild(i[e])}while(o=o.nextSibling)}}}();s.b("virtualElements",s.f);s.b("virtualElements.allowedBindings",s.f.aa);s.b("virtualElements.emptyNode",s.f.za);s.b("virtualElements.insertAfter",s.f.kc);s.b("virtualElements.prepend",s.f.qc);s.b("virtualElements.setDomNodeChildren",s.f.fa),function(){s.S=function(){this.Kc={}};s.a.extend(s.S.prototype,{nodeHasBindings:function(n){switch(n.nodeType){case 1:return null!=n.getAttribute("data-bind")||s.g.getComponentNameForNode(n);case 8:return s.f.Yc(n);default:return!1}},getBindings:function(n,t){var i=this.getBindingsString(n,t),i=i?this.parseBindingsString(i,t,n):null;return s.g.Rb(i,n,t,!1)},getBindingAccessors:function(n,t){var i=this.getBindingsString(n,t),i=i?this.parseBindingsString(i,t,n,{valueAccessors:!0}):null;return s.g.Rb(i,n,t,!0)},getBindingsString:function(n){switch(n.nodeType){case 1:return n.getAttribute("data-bind");case 8:return s.f.vd(n);default:return null}},parseBindingsString:function(n,t,i,r){var u,f,e,h,c;try{return u=this.Kc,f=n+(r&&r.valueAccessors||""),(e=u[f])||(c="with($context){with($data||{}){return{"+s.h.Xa(n,r)+"}}}",h=new Function("$context","$element",c),e=u[f]=h),e(t,i)}catch(o){throw o.message="Unable to parse bindings.\nBindings value: "+n+"\nMessage: "+o.message,o;}}});s.S.instance=new s.S}();s.b("bindingProvider",s.S),function(){function v(n){return function(){return n}}function i(n){return n()}function o(n){return s.a.Ea(s.l.w(n),function(t,i){return function(){return n()[i]}})}function y(n,t,i){return"function"==typeof n?o(n.bind(null,t,i)):s.a.Ea(n,v)}function p(n,t){return o(this.getBindings.bind(this,n,t))}function h(n,t,i){var r,u=s.f.firstChild(t),f=s.S.instance,e=f.preprocessNode;if(e){for(;r=u;)u=s.f.nextSibling(r),e.call(f,r);u=s.f.firstChild(t)}for(;r=u;)u=s.f.nextSibling(r),c(n,r,i)}function c(n,t,i){var u=!0,r=1===t.nodeType;r&&s.f.oc(t);(r&&i||s.S.instance.nodeHasBindings(t))&&(u=l(t,null,n,i).shouldBindDescendants);u&&!a[s.a.A(t)]&&h(n,t,!r)}function w(n){var i=[],r={},t=[];return s.a.D(n,function u(f){if(!r[f]){var e=s.getBindingHandler(f);e&&(e.after&&(t.push(f),s.a.r(e.after,function(i){if(n[i]){if(-1!==s.a.o(t,i))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+t.join(", "));u(i)}}),t.length--),i.push({key:f,jc:e}));r[f]=!0}}),i}function l(t,r,u,e){var v=s.a.e.get(t,f),o,l,a,c;if(!r){if(v)throw Error("You cannot apply bindings multiple times to the same element.");s.a.e.set(t,f,!0)}if(!v&&e&&s.xc(t,u),r&&"function"!=typeof r)o=r;else{var y=s.S.instance,b=y.getBindingAccessors||p,h=s.B(function(){return(o=r?r(u,t):b.call(y,t,u))&&u.Q&&u.Q(),o},null,{i:t});o&&h.ca()||(h=null)}return o&&(a=h?function(n){return function(){return i(h()[n])}}:function(n){return o[n]},c=function(){return s.a.Ea(h?h():o,i)},c.get=function(n){return o[n]&&i(a(n))},c.has=function(n){return n in o},e=w(o),s.a.r(e,function(i){var e=i.jc.init,h=i.jc.update,r=i.key;if(8===t.nodeType&&!s.f.aa[r])throw Error("The binding '"+r+"' cannot be used with virtual elements");try{"function"==typeof e&&s.l.w(function(){var i=e(t,a(r),c,u.$data,u);if(i&&i.controlsDescendantBindings){if(l!==n)throw Error("Multiple bindings ("+l+" and "+r+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=r}});"function"==typeof h&&s.B(function(){h(t,a(r),c,u.$data,u)},null,{i:t})}catch(f){throw f.message='Unable to process binding "'+r+": "+o[r]+'"\nMessage: '+f.message,f;}})),{shouldBindDescendants:l===n}}function t(n){return n&&n instanceof s.R?n:new s.R(n)}var a,f,e;s.d={};a={script:!0,textarea:!0,template:!0};s.getBindingHandler=function(n){return s.d[n]};s.R=function(t,i,r,u,f){function c(){var f=a?t():t,n=s.a.c(f);return i?(i.Q&&i.Q(),s.a.extend(e,i),e.Q=o):(e.$parents=[],e.$root=n,e.ko=s),e.$rawData=f,e.$data=n,r&&(e[r]=n),u&&u(e,i,n),e.$data}function l(){return h&&!s.a.Tb(h)}var e=this,a="function"==typeof t&&!s.I(t),h,o;f&&f.exportDependencies?c():(o=s.B(c,null,{ya:l,i:!0}),o.ca()&&(e.Q=o,o.equalityComparer=null,h=[],o.Dc=function(t){h.push(t);s.a.G.qa(t,function(t){s.a.Na(h,t);h.length||(o.k(),e.Q=o=n)})}))};s.R.prototype.createChildContext=function(n,t,i,r){return new s.R(n,this,t,function(n,t){n.$parentContext=t;n.$parent=t.$data;n.$parents=(t.$parents||[]).slice(0);n.$parents.unshift(n.$parent);i&&i(n)},r)};s.R.prototype.extend=function(n){return new s.R(this.Q||this.$data,this,null,function(t,i){t.$rawData=i.$rawData;s.a.extend(t,"function"==typeof n?n():n)})};s.R.prototype.ac=function(n,t){return this.createChildContext(n,t,null,{exportDependencies:!0})};f=s.a.e.J();e=s.a.e.J();s.xc=function(n,t){if(2==arguments.length)s.a.e.set(n,e,t),t.Q&&t.Q.Dc(n);else return s.a.e.get(n,e)};s.La=function(n,i,r){return 1===n.nodeType&&s.f.oc(n),l(n,i,t(r),!0)};s.Ic=function(n,i,r){return r=t(r),s.La(n,y(i,r,n),r)};s.hb=function(n,i){1!==i.nodeType&&8!==i.nodeType||h(t(n),i,!0)};s.Ub=function(n,i){if(!r&&u.jQuery&&(r=u.jQuery),i&&1!==i.nodeType&&8!==i.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");i=i||u.document.body;c(t(n),i,!0)};s.nb=function(t){switch(t.nodeType){case 1:case 8:var i=s.xc(t);if(i)return i;if(t.parentNode)return s.nb(t.parentNode)}return n};s.Oc=function(t){return(t=s.nb(t))?t.$data:n};s.b("bindingHandlers",s.d);s.b("applyBindings",s.Ub);s.b("applyBindingsToDescendants",s.hb);s.b("applyBindingAccessorsToNode",s.La);s.b("applyBindingsToNode",s.Ic);s.b("contextFor",s.nb);s.b("dataFor",s.Oc)}(),function(n){function u(t,u){var e=i.hasOwnProperty(t)?i[t]:n,o;e?e.Y(u):(e=i[t]=new s.K,e.Y(u),f(t,function(n,u){var f=!(!u||!u.synchronous);r[t]={definition:n,dd:f};delete i[t];o||f?e.notifySubscribers(n):s.Z.Za(function(){e.notifySubscribers(n)})}),o=!0)}function f(n,i){t("getConfig",[n],function(r){r?t("loadComponent",[n,r],function(n){i(n,r)}):i(null,null)})}function t(i,r,u,f){var e,o,h;if(f||(f=s.g.loaders.slice(0)),e=f.shift(),e)if(o=e[i],o){if(h=!1,o.apply(e,r.concat(function(n){h?u(null):null!==n?u(n):t(i,r,u,f)}))!==n&&(h=!0,!e.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.");}else t(i,r,u,f);else u(null)}var i={},r={};s.g={get:function(t,i){var f=r.hasOwnProperty(t)?r[t]:n;f?f.dd?s.l.w(function(){i(f.definition)}):s.Z.Za(function(){i(f.definition)}):u(t,i)},$b:function(n){delete r[n]},Nb:t};s.g.loaders=[];s.b("components",s.g);s.b("components.get",s.g.get);s.b("components.clearCachedDefinition",s.g.$b)}(),function(){function l(n,i,u,f){function e(){0==--c&&f(o)}var o={},c=2,h=u.template;u=u.viewModel;h?r(i,h,function(t){s.g.Nb("loadTemplate",[n,t],function(n){o.template=n;e()})}):e();u?r(i,u,function(i){s.g.Nb("loadViewModel",[n,i],function(n){o[t]=n;e()})}):e()}function e(n,i,r){if("function"==typeof i)r(function(n){return new i(n)});else if("function"==typeof i[t])r(i[t]);else if("instance"in i){var u=i.instance;r(function(){return u})}else"viewModel"in i?e(n,i.viewModel,r):n("Unknown viewModel value: "+i)}function h(n){switch(s.a.A(n)){case"script":return s.a.na(n.text);case"textarea":return s.a.na(n.value);case"template":if(c(n.content))return s.a.wa(n.content.childNodes)}return s.a.wa(n.childNodes)}function c(n){return u.DocumentFragment?n instanceof DocumentFragment:n&&11===n.nodeType}function r(n,t,i){"string"==typeof t.require?o||u.require?(o||u.require)([t.require],i):n("Uses require, but no AMD loader is present"):i(t)}function f(n){return function(t){throw Error("Component '"+n+"': "+t);}}var n={},t;s.g.register=function(t,i){if(!i)throw Error("Invalid configuration for "+t);if(s.g.wb(t))throw Error("Component "+t+" is already registered");n[t]=i};s.g.wb=function(t){return n.hasOwnProperty(t)};s.g.ud=function(t){delete n[t];s.g.$b(t)};s.g.cc={getConfig:function(t,i){i(n.hasOwnProperty(t)?n[t]:null)},loadComponent:function(n,t,i){var u=f(n);r(u,t,function(t){l(n,u,t,i)})},loadTemplate:function(n,t,r){if(n=f(n),"string"==typeof t)r(s.a.na(t));else if(t instanceof Array)r(t);else if(c(t))r(s.a.W(t.childNodes));else if(t.element)if(t=t.element,u.HTMLElement?t instanceof HTMLElement:t&&t.tagName&&1===t.nodeType)r(h(t));else if("string"==typeof t){var e=i.getElementById(t);e?r(h(e)):n("Cannot find element with ID "+t)}else n("Unknown element type: "+t);else n("Unknown template value: "+t)},loadViewModel:function(n,t,i){e(f(n),t,i)}};t="createViewModel";s.b("components.register",s.g.register);s.b("components.isRegistered",s.g.wb);s.b("components.unregister",s.g.ud);s.b("components.defaultLoader",s.g.cc);s.g.loaders.push(s.g.cc);s.g.Ec=n}(),function(){function n(n,i){var r=n.getAttribute("params");if(r){var r=t.parseBindingsString(r,i,n,{valueAccessors:!0,bindingParams:!0}),r=s.a.Ea(r,function(t){return s.m(t,null,{i:n})}),u=s.a.Ea(r,function(t){var i=t.p();return t.ca()?s.m({read:function(){return s.a.c(t())},write:s.Da(i)&&function(n){t()(n)},i:n}):i});return u.hasOwnProperty("$raw")||(u.$raw=r),u}return{$raw:{}}}s.g.getComponentNameForNode=function(n){var t=s.a.A(n);if(s.g.wb(t)&&(-1!=t.indexOf("-")||"[object HTMLUnknownElement]"==""+n||8>=s.a.C&&n.tagName===t))return t};s.g.Rb=function(t,i,r,u){var f,e;if(1===i.nodeType&&(f=s.g.getComponentNameForNode(i),f)){if(t=t||{},t.component)throw Error('Cannot use the "component" binding on a custom element matching a component');e={name:f,params:n(i,r)};t.component=u?function(){return e}:e}return t};var t=new s.S;9>s.a.C&&(s.g.register=function(n){return function(t){return i.createElement(t),n.apply(this,arguments)}}(s.g.register),i.createDocumentFragment=function(n){return function(){var t=n(),i=s.g.Ec;for(var r in i)i.hasOwnProperty(r)&&t.createElement(r);return t}}(i.createDocumentFragment))}(),function(n){function t(n,t,i){if(t=t.template,!t)throw Error("Component '"+n+"' has no template");n=s.a.wa(t);s.f.fa(i,n)}function i(n,t,i,r){var u=n.createViewModel;return u?u.call(n,r,{element:t,templateNodes:i}):r}var r=0;s.d.component={init:function(u,f,e,o,h){function a(){var n=c&&c.dispose;"function"==typeof n&&n.call(c);l=c=null}var c,l,v=s.a.W(s.f.childNodes(u));return s.a.G.qa(u,a),s.m(function(){var o=s.a.c(f()),e,y,p;if("string"==typeof o?e=o:(e=s.a.c(o.name),y=s.a.c(o.params)),!e)throw Error("No component name specified");p=l=++r;s.g.get(e,function(r){if(l===p){if(a(),!r)throw Error("Unknown component '"+e+"'");t(e,r,u);var f=i(r,u,v,y);r=h.createChildContext(f,n,function(n){n.$component=f;n.$componentTemplateNodes=v});c=f;s.hb(r,u)}})},null,{i:u}),{controlsDescendantBindings:!0}}};s.f.aa.component=!0}();g={"class":"className","for":"htmlFor"};s.d.attr={update:function(t,i){var r=s.a.c(i())||{};s.a.D(r,function(i,r){r=s.a.c(r);var u=!1===r||null===r||r===n;u&&t.removeAttribute(i);8>=s.a.C&&i in g?(i=g[i],u?t.removeAttribute(i):t[i]=r):u||t.setAttribute(i,r.toString());"name"===i&&s.a.vc(t,u?"":r.toString())})}},function(){s.d.checked={after:["value","attr"],init:function(t,i,r){function l(){var l=t.checked,o=y?f():l,n,h;s.xa.Va()||e&&!l||(n=s.l.w(i),u?(h=a?n.p():n,c!==o?(l&&(s.a.ra(h,o,!0),s.a.ra(h,c,!1)),c=o):s.a.ra(h,o,l),a&&s.Da(n)&&n(h)):s.h.Ga(n,r,"checked",o,!0))}function v(){var n=s.a.c(i());t.checked=u?0<=s.a.o(n,f()):h?n:f()===n}var f=s.rc(function(){return r.has("checkedValue")?s.a.c(r.get("checkedValue")):r.has("value")?s.a.c(r.get("value")):t.value}),h="checkbox"==t.type,e="radio"==t.type;if(h||e){var o=i(),u=h&&s.a.c(o)instanceof Array,a=!(u&&o.push&&o.splice),c=u?f():n,y=e||u;e&&!t.name&&s.d.uniqueName.init(t,function(){return!0});s.m(l,null,{i:t});s.a.q(t,"click",l);s.m(v,null,{i:t});o=n}}};s.h.ga.checked=!0;s.d.checkedValue={update:function(n,t){n.value=s.a.c(t())}}}();s.d.css={update:function(n,t){var i=s.a.c(t());null!==i&&"object"==typeof i?s.a.D(i,function(t,i){i=s.a.c(i);s.a.fb(n,t,i)}):(i=s.a.cb(String(i||"")),s.a.fb(n,n.__ko__cssValue,!1),n.__ko__cssValue=i,s.a.fb(n,i,!0))}};s.d.enable={update:function(n,t){var i=s.a.c(t());i&&n.disabled?n.removeAttribute("disabled"):i||n.disabled||(n.disabled=!0)}};s.d.disable={update:function(n,t){s.d.enable.update(n,function(){return!s.a.c(t())})}};s.d.event={init:function(n,t,i,r,u){var f=t()||{};s.a.D(f,function(f){"string"==typeof f&&s.a.q(n,f,function(n){var o,h=t()[f],e;if(h){try{e=s.a.W(arguments);r=u.$data;e.unshift(r);o=h.apply(r,e)}finally{!0!==o&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}!1===i.get(f+"Bubble")&&(n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation())}})})}};s.d.foreach={mc:function(n){return function(){var i=n(),t=s.a.Bb(i);return!t||"number"==typeof t.length?{foreach:i,templateEngine:s.X.vb}:(s.a.c(i),{foreach:t.data,as:t.as,includeDestroyed:t.includeDestroyed,afterAdd:t.afterAdd,beforeRemove:t.beforeRemove,afterRender:t.afterRender,beforeMove:t.beforeMove,afterMove:t.afterMove,templateEngine:s.X.vb})}},init:function(n,t){return s.d.template.init(n,s.d.foreach.mc(t))},update:function(n,t,i,r,u){return s.d.template.update(n,s.d.foreach.mc(t),i,r,u)}};s.h.va.foreach=!1;s.f.aa.foreach=!0;s.d.hasfocus={init:function(n,t,i){function r(r){var u,f;if(n.__ko_hasfocusUpdating=!0,u=n.ownerDocument,"activeElement"in u){try{f=u.activeElement}catch(e){f=u.body}r=f===n}u=t();s.h.Ga(u,i,"hasfocus",r,!0);n.__ko_hasfocusLastValue=r;n.__ko_hasfocusUpdating=!1}var u=r.bind(null,!0),f=r.bind(null,!1);s.a.q(n,"focus",u);s.a.q(n,"focusin",u);s.a.q(n,"blur",f);s.a.q(n,"focusout",f)},update:function(n,t){var i=!!s.a.c(t());n.__ko_hasfocusUpdating||n.__ko_hasfocusLastValue===i||(i?n.focus():n.blur(),!i&&n.__ko_hasfocusLastValue&&n.ownerDocument.body.focus(),s.l.w(s.a.Fa,null,[n,i?"focusin":"focusout"]))}};s.h.ga.hasfocus=!0;s.d.hasFocus=s.d.hasfocus;s.h.ga.hasFocus=!0;s.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(n,t){s.a.Eb(n,t())}};k("if");k("ifnot",!1,!0);k("with",!0,!1,function(n,t){return n.ac(t)});w={};s.d.options={init:function(n){if("select"!==s.a.A(n))throw Error("options binding applies only to SELECT elements");for(;0<n.length;)n.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,r){function a(){return s.a.Ma(t.options,function(n){return n.selected})}function v(n,t,i){var r=typeof t;return"function"==r?t(n):"string"==r?n[t]:i}function y(n,i){if(o&&e)s.j.ja(t,s.a.c(r.get("value")),!0);else if(f.length){var u=0<=s.a.o(f,s.j.u(i[0]));s.a.wc(i[0],u);o&&!u&&s.l.w(s.a.Fa,null,[t,"change"])}}var h=t.multiple,c=0!=t.length&&h?t.scrollTop:null,u=s.a.c(i()),e=r.get("valueAllowUnset")&&r.has("value"),p=r.get("optionsIncludeDestroyed"),l,f,o;i={};f=[];e||(h?f=s.a.ib(a(),s.j.u):0<=t.selectedIndex&&f.push(s.j.u(t.options[t.selectedIndex])));u&&("undefined"==typeof u.length&&(u=[u]),l=s.a.Ma(u,function(t){return p||t===n||null===t||!s.a.c(t._destroy)}),r.has("optionsCaption")&&(u=s.a.c(r.get("optionsCaption")),null!==u&&u!==n&&l.unshift(w)));o=!1;i.beforeRemove=function(n){t.removeChild(n)};u=y;r.has("optionsAfterRender")&&"function"==typeof r.get("optionsAfterRender")&&(u=function(t,i){y(0,i);s.l.w(r.get("optionsAfterRender"),null,[i[0],t!==w?t:n])});s.a.Db(t,l,function(i,u,h){return h.length&&(f=!e&&h[0].selected?[s.j.u(h[0])]:[],o=!0),u=t.ownerDocument.createElement("option"),i===w?(s.a.bb(u,r.get("optionsCaption")),s.j.ja(u,n)):(h=v(i,r.get("optionsValue"),i),s.j.ja(u,s.a.c(h)),i=v(i,r.get("optionsText"),h),s.a.bb(u,i)),[u]},i,u);s.l.w(function(){e?s.j.ja(t,s.a.c(r.get("value")),!0):(h?f.length&&a().length<f.length:f.length&&0<=t.selectedIndex?s.j.u(t.options[t.selectedIndex])!==f[0]:f.length||0<=t.selectedIndex)&&s.a.Fa(t,"change")});s.a.Sc(t);c&&20<Math.abs(c-t.scrollTop)&&(t.scrollTop=c)}};s.d.options.zb=s.a.e.J();s.d.selectedOptions={after:["options","foreach"],init:function(n,t,i){s.a.q(n,"change",function(){var u=t(),r=[];s.a.r(n.getElementsByTagName("option"),function(n){n.selected&&r.push(s.j.u(n))});s.h.Ga(u,i,"selectedOptions",r)})},update:function(n,t){if("select"!=s.a.A(n))throw Error("values binding applies only to SELECT elements");var i=s.a.c(t()),r=n.scrollTop;i&&"number"==typeof i.length&&s.a.r(n.getElementsByTagName("option"),function(n){var t=0<=s.a.o(i,s.j.u(n));n.selected!=t&&s.a.wc(n,t)});n.scrollTop=r}};s.h.ga.selectedOptions=!0;s.d.style={update:function(t,i){var r=s.a.c(i()||{});s.a.D(r,function(i,r){r=s.a.c(r);(null===r||r===n||!1===r)&&(r="");t.style[i]=r})}};s.d.submit={init:function(n,t,i,r,u){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");s.a.q(n,"submit",function(i){var r,f=t();try{r=f.call(u.$data,n)}finally{!0!==r&&(i.preventDefault?i.preventDefault():i.returnValue=!1)}})}};s.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(n,t){s.a.bb(n,t())}};s.f.aa.text=!0,function(){if(u&&u.navigator)var t=function(n){if(n)return parseFloat(n[1])},e=u.opera&&u.opera.version&&parseInt(u.opera.version()),i=u.navigator.userAgent,o=t(i.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),h=t(i.match(/Firefox\/([^ ]*)/));if(10>s.a.C)var r=s.a.e.J(),f=s.a.e.J(),c=function(n){var t=this.activeElement;(t=t&&s.a.e.get(t,f))&&t(n)},l=function(n,t){var i=n.ownerDocument;s.a.e.get(i,r)||(s.a.e.set(i,r,!0),s.a.q(i,"selectionchange",c));s.a.e.set(n,f,t)};s.d.textInput={init:function(t,i,r){function u(n,i){s.a.q(t,n,i)}function p(){var r=s.a.c(i());(null===r||r===n)&&(r="");v!==n&&r===v?s.a.setTimeout(p,4):t.value!==r&&(y=r,t.value=r)}function c(){a||(v=t.value,a=s.a.setTimeout(f,4))}function f(){clearTimeout(a);v=a=n;var u=t.value;y!==u&&(y=u,s.h.Ga(i(),r,"textInput",u))}var y=t.value,a,v,w=9==s.a.C?c:f;10>s.a.C?(u("propertychange",function(n){"value"===n.propertyName&&w(n)}),8==s.a.C&&(u("keyup",f),u("keydown",f)),8<=s.a.C&&(l(t,w),u("dragend",c))):(u("input",f),5>o&&"textarea"===s.a.A(t)?(u("keydown",c),u("paste",c),u("cut",c)):11>e?u("keydown",c):4>h&&(u("DOMAutoComplete",f),u("dragdrop",f),u("drop",f)));u("change",f);s.m(p,null,{i:t})}};s.h.ga.textInput=!0;s.d.textinput={preprocess:function(n,t,i){i("textInput",n)}}}();s.d.uniqueName={init:function(n,t){if(t()){var i="ko_unique_"+ ++s.d.uniqueName.Nc;s.a.vc(n,i)}}};s.d.uniqueName.Nc=0;s.d.value={after:["options","foreach"],init:function(n,t,i){var o,h;if("input"!=n.tagName.toLowerCase()||"checkbox"!=n.type&&"radio"!=n.type){var r=["change"],u=i.get("valueUpdate"),f=!1,e=null;u&&("string"==typeof u&&(u=[u]),s.a.ta(r,u),r=s.a.Wb(r));o=function(){e=null;f=!1;var r=t(),u=s.j.u(n);s.h.Ga(r,i,"value",u)};!s.a.C||"input"!=n.tagName.toLowerCase()||"text"!=n.type||"off"==n.autocomplete||n.form&&"off"==n.form.autocomplete||-1!=s.a.o(r,"propertychange")||(s.a.q(n,"propertychange",function(){f=!0}),s.a.q(n,"focus",function(){f=!1}),s.a.q(n,"blur",function(){f&&o()}));s.a.r(r,function(t){var i=o;s.a.sd(t,"after")&&(i=function(){e=s.j.u(n);s.a.setTimeout(o,0)},t=t.substring(5));s.a.q(n,t,i)});h=function(){var r=s.a.c(t()),u=s.j.u(n),f;null!==e&&r===e?s.a.setTimeout(h,0):r!==u&&("select"===s.a.A(n)?(f=i.get("valueAllowUnset"),u=function(){s.j.ja(n,r,f)},u(),f||r===s.j.u(n)?s.a.setTimeout(u,0):s.l.w(s.a.Fa,null,[n,"change"])):s.j.ja(n,r))};s.m(h,null,{i:n})}else s.La(n,{checkedValue:t})},update:function(){}};s.h.ga.value=!0;s.d.visible={update:function(n,t){var i=s.a.c(t()),r="none"!=n.style.display;i&&!r?n.style.display="":!i&&r&&(n.style.display="none")}},function(n){s.d[n]={init:function(t,i,r,u,f){return s.d.event.init.call(this,t,function(){var t={};return t[n]=i(),t},r,u,f)}}}("click");s.P=function(){};s.P.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource");};s.P.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};s.P.prototype.makeTemplateSource=function(n,t){if("string"==typeof n){t=t||i;var r=t.getElementById(n);if(!r)throw Error("Cannot find template with ID "+n);return new s.v.n(r)}if(1==n.nodeType||8==n.nodeType)return new s.v.sa(n);throw Error("Unknown template type: "+n);};s.P.prototype.renderTemplate=function(n,t,i,r){return n=this.makeTemplateSource(n,r),this.renderTemplateSource(n,t,i,r)};s.P.prototype.isTemplateRewritten=function(n,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(n,t).data("isRewritten")};s.P.prototype.rewriteTemplate=function(n,t,i){n=this.makeTemplateSource(n,i);t=t(n.text());n.text(t);n.data("isRewritten",!0)};s.b("templateEngine",s.P);s.Ib=function(){function n(n,t,i,r){var o,f,u,e;for(n=s.h.Ab(n),o=s.h.va,f=0;f<n.length;f++)if(u=n[f].key,o.hasOwnProperty(u))if(e=o[u],"function"==typeof e){if(u=e(n[f].value))throw Error(u);}else if(!e)throw Error("This template engine does not support the '"+u+"' binding within its templates");return i="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+s.h.Xa(n,{valueAccessors:!0})+" } })()},'"+i.toLowerCase()+"')",r.createJavaScriptEvaluatorBlock(i)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,i=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Tc:function(n,t,i){t.isTemplateRewritten(n,i)||t.rewriteTemplate(n,function(n){return s.Ib.jd(n,t)},i)},jd:function(r,u){return r.replace(t,function(t,i,r,f,e){return n(e,i,r,u)}).replace(i,function(t,i){return n(i,"<!-- ko -->","#comment",u)})},Jc:function(n,t){return s.N.yb(function(i,r){var u=i.nextSibling;u&&u.nodeName.toLowerCase()===t&&s.La(u,n,r)})}}}();s.b("__tr_ambtns",s.Ib.Jc),function(){var i,t;s.v={};s.v.n=function(n){if(this.n=n){var t=s.a.A(n);this.eb="script"===t?1:"textarea"===t?2:"template"==t&&n.content&&11===n.content.nodeType?3:4}};s.v.n.prototype.text=function(){var n=1===this.eb?"text":2===this.eb?"value":"innerHTML",t;if(0==arguments.length)return this.n[n];t=arguments[0];"innerHTML"===n?s.a.Eb(this.n,t):this.n[n]=t};i=s.a.e.J()+"_";s.v.n.prototype.data=function(n){if(1===arguments.length)return s.a.e.get(this.n,i+n);s.a.e.set(this.n,i+n,arguments[1])};t=s.a.e.J();s.v.n.prototype.nodes=function(){var i=this.n;if(0==arguments.length)return(s.a.e.get(i,t)||{}).mb||(3===this.eb?i.content:4===this.eb?i:n);s.a.e.set(i,t,{mb:arguments[0]})};s.v.sa=function(n){this.n=n};s.v.sa.prototype=new s.v.n;s.v.sa.prototype.text=function(){if(0==arguments.length){var i=s.a.e.get(this.n,t)||{};return i.Jb===n&&i.mb&&(i.Jb=i.mb.innerHTML),i.Jb}s.a.e.set(this.n,t,{Jb:arguments[0]})};s.b("templateSources",s.v);s.b("templateSources.domElement",s.v.n);s.b("templateSources.anonymousTemplate",s.v.sa)}(),function(){function t(n,t,i){var r;for(t=s.f.nextSibling(t);n&&(r=n)!==t;)n=s.f.nextSibling(r),i(r,n)}function f(n,i){if(n.length){var r=n[0],u=n[n.length-1],f=r.parentNode,e=s.S.instance,o=e.preprocessNode;if(o){if(t(r,u,function(n,t){var f=n.previousSibling,i=o.call(e,n);i&&(n===r&&(r=i[0]||t),n===u&&(u=i[i.length-1]||f))}),n.length=0,!r)return;r===u?n.push(r):(n.push(r,u),s.a.Ba(n,f))}t(r,u,function(n){1!==n.nodeType&&8!==n.nodeType||s.Ub(i,n)});t(r,u,function(n){1!==n.nodeType&&8!==n.nodeType||s.N.Cc(n,[i])});s.a.Ba(n,f)}}function i(n){return n.nodeType?n:0<n.length?n[0]:null}function e(n,t,u,e,o){o=o||{};var h=(n&&i(n)||u||{}).ownerDocument,c=o.templateEngine||r;if(s.Ib.Tc(u,c,h),u=c.renderTemplate(u,e,o,h),"number"!=typeof u.length||0<u.length&&"number"!=typeof u[0].nodeType)throw Error("Template engine must return an array of DOM nodes");h=!1;switch(t){case"replaceChildren":s.f.fa(n,u);h=!0;break;case"replaceNode":s.a.uc(n,u);h=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t);}return h&&(f(u,e),o.afterRender&&s.l.w(o.afterRender,null,[u,e.$data])),u}function o(n,t,i){return s.I(n)?n():"function"==typeof n?n(t,i):n}var r,u;s.Fb=function(t){if(t!=n&&!(t instanceof s.P))throw Error("templateEngine must inherit from ko.templateEngine");r=t};s.Cb=function(t,u,f,h,c){if(f=f||{},(f.templateEngine||r)==n)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",h){var l=i(h);return s.B(function(){var n=u&&u instanceof s.R?u:new s.R(u,null,null,null,{exportDependencies:!0}),r=o(t,n.$data,n),n=e(h,c,r,n,f);"replaceNode"==c&&(h=n,l=i(h))},null,{ya:function(){return!l||!s.a.qb(l)},i:l&&"replaceNode"==c?l.parentNode:l})}return s.N.yb(function(n){s.Cb(t,u,f,n,"replaceNode")})};s.pd=function(t,i,r,u,h){function l(n,t){f(t,c);r.afterRender&&r.afterRender(t,n);c=null}function a(n,i){c=h.createChildContext(n,r.as,function(n){n.$index=i});var u=o(t,n,c);return e(null,"ignoreTargetNode",u,c,r)}var c;return s.B(function(){var t=s.a.c(i)||[];"undefined"==typeof t.length&&(t=[t]);t=s.a.Ma(t,function(t){return r.includeDestroyed||t===n||null===t||!s.a.c(t._destroy)});s.l.w(s.a.Db,null,[u,t,a,r,l])},null,{i:u})};u=s.a.e.J();s.d.template={init:function(n,t){var i=s.a.c(t());if("string"==typeof i||i.name)s.f.za(n);else{if("nodes"in i){if(i=i.nodes||[],s.I(i))throw Error('The "nodes" option must be a plain, non-observable array.');}else i=s.f.childNodes(n);i=s.a.nc(i);new s.v.sa(n).nodes(i)}return{controlsDescendantBindings:!0}},update:function(t,i,r,f,e){var o=i();i=s.a.c(o);r=!0;f=null;"string"==typeof i?i={}:(o=i.name,"if"in i&&(r=s.a.c(i["if"])),r&&"ifnot"in i&&(r=!s.a.c(i.ifnot)));"foreach"in i?f=s.pd(o||t,r&&i.foreach||[],i,t,e):r?(e="data"in i?e.ac(i.data,i.as):e,f=s.Cb(o||t,e,i,t)):s.f.za(t);e=f;(i=s.a.e.get(t,u))&&"function"==typeof i.k&&i.k();s.a.e.set(t,u,e&&e.ca()?e:n)}};s.h.va.template=function(n){return n=s.h.Ab(n),1==n.length&&n[0].unknown||s.h.fd(n,"name")?null:"This template engine does not support anonymous templates nested within its templates"};s.f.aa.template=!0}();s.b("setTemplateEngine",s.Fb);s.b("renderTemplate",s.Cb);s.a.hc=function(n,t,i){if(n.length&&t.length)for(var o,r,f,e,u=o=0;(!i||u<i)&&(f=n[o]);++o){for(r=0;e=t[r];++r)if(f.value===e.value){f.moved=e.index;e.moved=f.index;t.splice(r,1);u=r=0;break}u+=r}};s.a.lb=function(){function n(n,t,i,r,u){for(var o=Math.min,l=Math.max,a=[],c=n.length,f,h=t.length,v=h-c||1,w=c+h+1,y,p,b,e=0;e<=c;e++)for(p=y,a.push(y=[]),b=o(h,e+v),f=l(0,e-1);f<=b;f++)y[f]=f?e?n[e-1]===t[f-1]?p[f-1]:o(p[f]||w,y[f-1]||w)+1:f+1:e+1;for(o=[],l=[],v=[],e=c,f=h;e||f;)h=a[e][f]-1,f&&h===a[e][f-1]?l.push(o[o.length]={status:i,value:t[--f],index:f}):e&&h===a[e-1][f]?v.push(o[o.length]={status:r,value:n[--e],index:e}):(--f,--e,u.sparse||o.push({status:"retained",value:t[f]}));return s.a.hc(v,l,!u.dontLimitMoves&&10*c),o.reverse()}return function(t,i,r){return r="boolean"==typeof r?{dontLimitMoves:r}:r||{},t=t||[],i=i||[],t.length<i.length?n(t,i,"added","deleted",r):n(i,t,"deleted","added",r)}}();s.b("utils.compareArrays",s.a.lb),function(){function r(t,i,r,u,f){var e=[],o=s.B(function(){var n=i(r,f,s.a.Ba(e,t))||[];0<e.length&&(s.a.uc(e,n),u&&s.l.w(u,null,[r,n,f]));e.length=0;s.a.ta(e,n)},null,{i:t,ya:function(){return!s.a.Tb(e)}});return{ea:e,B:o.ca()?o:n}}var t=s.a.e.J(),i=s.a.e.J();s.a.Db=function(u,f,e,o,h){function ut(n,t){c=g[t];tt!==t&&(rt[n]=c);c.tb(tt++);s.a.Ba(c.ea,u);w.push(c);b.push(c)}function y(n,t){if(n)for(var i=0,r=t.length;i<r;i++)t[i]&&s.a.r(t[i].ea,function(r){n(r,i,t[i].ka)})}var l,p,ft;f=f||[];o=o||{};var p=s.a.e.get(u,t)===n,g=s.a.e.get(u,t)||[],nt=s.a.ib(g,function(n){return n.ka}),a=s.a.lb(nt,f,o.dontLimitMoves),w=[],v=0,tt=0,it=[],b=[];f=[];for(var rt=[],nt=[],c,l=0,k,d;k=a[l];l++)switch(d=k.moved,k.status){case"deleted":d===n&&(c=g[v],c.B&&(c.B.k(),c.B=n),s.a.Ba(c.ea,u).length&&(o.beforeRemove&&(w.push(c),b.push(c),c.ka===i?c=null:f[l]=c),c&&it.push.apply(it,c.ea)));v++;break;case"retained":ut(l,v++);break;case"added":d!==n?ut(l,d):(c={ka:k.value,tb:s.O(tt++)},w.push(c),b.push(c),p||(nt[l]=c))}for(s.a.e.set(u,t,w),y(o.beforeMove,rt),s.a.r(it,o.beforeRemove?s.ba:s.removeNode),l=0,p=s.f.firstChild(u);c=b[l];l++){for(c.ea||s.a.extend(c,r(u,e,c.ka,h,c.tb)),v=0;a=c.ea[v];p=a.nextSibling,ft=a,v++)a!==p&&s.f.kc(u,a,ft);!c.ad&&h&&(h(c.ka,c.ea,c.tb),c.ad=!0)}for(y(o.beforeRemove,f),l=0;l<f.length;++l)f[l]&&(f[l].ka=i);y(o.afterMove,rt);y(o.afterAdd,nt)}}();s.b("utils.setDomNodeChildrenFromArrayMapping",s.a.Db);s.X=function(){this.allowTemplateRewriting=!1};s.X.prototype=new s.P;s.X.prototype.renderTemplateSource=function(n,t,i,r){return(t=(9>s.a.C?0:n.nodes)?n.nodes():null)?s.a.W(t.cloneNode(!0).childNodes):(n=n.text(),s.a.na(n,r))};s.X.vb=new s.X;s.Fb(s.X.vb);s.b("nativeTemplateEngine",s.X),function(){s.xb=function(){var n=this.ed=function(){if(!r||!r.tmpl)return 0;try{if(0<=r.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(n){}return 1}();this.renderTemplateSource=function(t,u,f,e){if(e=e||i,f=f||{},2>n)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var o=t.data("precompiled");return o||(o=t.text()||"",o=r.template(null,"{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}"),t.data("precompiled",o)),t=[u.$data],u=r.extend({koBindingContext:u},f.templateOptions),u=r.tmpl(o,t,u),u.appendTo(e.createElement("div")),r.fragments={},u};this.createJavaScriptEvaluatorBlock=function(n){return"{{ko_code ((function() { return "+n+" })()) }}"};this.addTemplate=function(n,t){i.write("<script type='text/html' id='"+n+"'>"+t+"<\/script>")};0<n&&(r.tmpl.tag.ko_code={open:"__.push($1 || '');"},r.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};s.xb.prototype=new s.P;var n=new s.xb;0<n.ed&&s.Fb(n);s.b("jqueryTmplTemplateEngine",s.xb)}()})})()}();t("ThirdParty/knockout-es5",[],function(){"use strict";function i(i,u){if(!i)throw new Error("When calling ko.track, you must pass an object as the first parameter.");var f=this,o=r(i,!0);return u=u||Object.getOwnPropertyNames(i),u.forEach(function(r){if(r!==n&&r!==t&&!(r in o)){var u=i[r],h=u instanceof Array,s=f.isObservable(u)?u:h?f.observableArray(u):f.observable(u);Object.defineProperty(i,r,{configurable:!0,enumerable:!0,get:s,set:f.isWriteableObservable(s)?s:undefined});o[r]=s;h&&e(f,s)}}),i}function r(t,i){var r=t[n];return!r&&i&&(r={},Object.defineProperty(t,n,{value:r})),r}function f(n,t,r){var f=this,u={owner:n,deferEvaluation:!0};if(typeof r=="function")u.read=r;else{if("value"in r)throw new Error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.');if(typeof r.get!="function")throw new Error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".');u.read=r.get;u.write=r.set}return n[t]=f.computed(u),i.call(f,n,[t]),n}function e(n,t){var i=null;n.computed(function(){i&&(i.dispose(),i=null);var r=t();r instanceof Array&&(i=o(n,t,r))})}function o(n,t,i){var r=s(n,i);return r.subscribe(t)}function s(n,i){var r=i[t],u;return r||(r=new n.subscribable,Object.defineProperty(i,t,{value:r}),u={},h(i,r,u),c(n,i,r,u)),r}function h(n,t,i){["pop","push","reverse","shift","sort","splice","unshift"].forEach(function(r){var u=n[r];n[r]=function(){var n=u.apply(this,arguments);return i.pause!==!0&&t.notifySubscribers(this),n}})}function c(n,t,i,r){["remove","removeAll","destroy","destroyAll","replace"].forEach(function(u){Object.defineProperty(t,u,{enumerable:!1,value:function(){var f;r.pause=!0;try{f=n.observableArray.fn[u].apply(n.observableArray(t),arguments)}finally{r.pause=!1}return i.notifySubscribers(t),f}})})}function u(n,t){if(!n)return null;var i=r(n,!1);return i&&i[t]||null}function l(n,t){var i=u(n,t);i&&i.valueHasMutated()}function a(n){n.track=i;n.getObservable=u;n.valueHasMutated=l;n.defineProperty=f}var n="__knockoutObservables",t="__knockoutSubscribable";return{attachToKo:a}});t("Widgets/SvgPathBindingHandler",[],function(){"use strict";var n="http://www.w3.org/2000/svg",t="cesium-svgPath-svg";return{register:function(i){i.bindingHandlers.cesiumSvgPath={init:function(r,u){var f=document.createElementNS(n,"svg:svg"),e;return f.setAttribute("class",t),e=document.createElementNS(n,"path"),f.appendChild(e),i.virtualElements.setDomNodeChildren(r,[f]),i.computed({read:function(){var n=i.unwrap(u()),r,o;e.setAttribute("d",i.unwrap(n.path));r=i.unwrap(n.width);o=i.unwrap(n.height);f.setAttribute("width",r);f.setAttribute("height",o);f.setAttribute("viewBox","0 0 "+r+" "+o);n.css&&f.setAttribute("class",t+" "+i.unwrap(n.css))},disposeWhenNodeIsRemoved:r}),{controlsDescendantBindings:!0}}};i.virtualElements.allowedBindings.cesiumSvgPath=!0}}});t("ThirdParty/knockout",["./knockout-3.4.2","./knockout-es5","../Widgets/SvgPathBindingHandler"],function(n,t,i){"use strict";return t.attachToKo(n),i.register(n),n}),function(n,i){typeof exports=="object"&&typeof module=="object"?module.exports=i():typeof t=="function"&&t.amd?t("ThirdParty/NoSleep",[],i):typeof exports=="object"?exports.NoSleep=i():n.NoSleep=i()}(this,function(){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var i={};return t.m=n,t.c=i,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(n){var i=n&&n.__esModule?function(){return n["default"]}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=0)}([function(n,t,i){"use strict";function f(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var u=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),e=i(1),r=typeof navigator!="undefined"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,o=function(){function n(){f(this,n);r?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",e),this.noSleepVideo.addEventListener("timeupdate",function(){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}return u(n,[{key:"enable",value:function(){r?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){r?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),n}();n.exports=o},function(n){"use strict";n.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])});t("Widgets/subscribeAndEvaluate",["../ThirdParty/knockout"],function(n){"use strict";function t(t,i,r,u,f){return r.call(u,t[i]),n.getObservable(t,i).subscribe(r,u,f)}return t});t("Widgets/Animation/Animation",["../../Core/Color","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../getElement","../subscribeAndEvaluate"],function(n,t,i,r,u,f,e){"use strict";function c(t){return n.fromCssColorString(window.getComputedStyle(t).getPropertyValue("color"))}function s(n){var i=document.createElementNS(l,n.tagName),t,r,u;for(t in n)if(n.hasOwnProperty(t)&&t!=="tagName")if(t==="children")for(u=n.children.length,r=0;r<u;++r)i.appendChild(s(n.children[r]));else t.indexOf("xlink:")===0?i.setAttributeNS(nt,t.substring(6),n[t]):t==="textContent"?i.textContent=n[t]:i.setAttribute(t,n[t]);return i}function d(n,t,i){var r=document.createElementNS(l,"text"),u;return r.setAttribute("x",n),r.setAttribute("y",t),r.setAttribute("class","cesium-animation-svgText"),u=document.createElementNS(l,"tspan"),u.textContent=i,r.appendChild(u),r}function ft(n,t,i){n.setAttribute("transform","translate(100,100) rotate("+i+")");t.setAttribute("transform","rotate("+i+")")}function o(n,t){var i=t.alpha,r=1-i;return b.red=n.red*r+t.red*i,b.green=n.green*r+t.green*i,b.blue=n.blue*r+t.blue*i,b.toCssColorString()}function g(n,t,i){var r={tagName:"g","class":"cesium-animation-rectButton",transform:"translate("+n+","+t+")",children:[{tagName:"rect","class":"cesium-animation-buttonGlow",width:32,height:32,rx:2,ry:2},{tagName:"rect","class":"cesium-animation-buttonMain",width:32,height:32,rx:4,ry:4},{tagName:"use","class":"cesium-animation-buttonPath","xlink:href":i},{tagName:"title",textContent:""}]};return s(r)}function et(n,t,i){var r={tagName:"g","class":"cesium-animation-rectButton",transform:"translate("+n+","+t+")",children:[{tagName:"use","class":"cesium-animation-buttonGlow","xlink:href":"#animation_pathWingButton"},{tagName:"use","class":"cesium-animation-buttonMain","xlink:href":"#animation_pathWingButton"},{tagName:"use","class":"cesium-animation-buttonPath","xlink:href":i},{tagName:"title",textContent:""}]};return s(r)}function ot(n,t){var i=n._viewModel,e=i.shuttleRingDragging,h;if(!e||y===n)if(t.type==="mousedown"||e&&t.type==="mousemove"||t.type==="touchstart"&&t.touches.length===1||e&&t.type==="touchmove"&&t.touches.length===1){var c=n._centerX,l=n._centerY,a=n._svgNode,f=a.getBoundingClientRect(),r,u;if(t.type==="touchstart"||t.type==="touchmove"?(r=t.touches[0].clientX,u=t.touches[0].clientY):(r=t.clientX,u=t.clientY),!e&&(r>f.right||r<f.left||u<f.top||u>f.bottom))return;var s=n._shuttleRingPointer.getBoundingClientRect(),v=r-c-f.left,p=u-l-f.top,o=Math.atan2(p,v)*180/Math.PI+90;o>180&&(o-=360);h=i.shuttleRingAngle;e||r<s.right&&r>s.left&&u>s.top&&u<s.bottom?(y=n,i.shuttleRingDragging=!0,i.shuttleRingAngle=o):o<h?i.slower():o>h&&i.faster();t.preventDefault()}else n===y&&(y=undefined),i.shuttleRingDragging=!1}function h(n,t){this._viewModel=t;this.svgElement=n;this._enabled=undefined;this._toggled=undefined;var i=this;this._clickFunction=function(){var n=i._viewModel.command;n.canExecute&&n()};n.addEventListener("click",this._clickFunction,!0);this._subscriptions=[e(t,"toggled",this.setToggled,this),e(t,"tooltip",this.setTooltip,this),e(t.command,"canExecute",this.setEnabled,this)]}function a(n,i){function r(n){ot(p,n)}var tt,o,w,a,v,b,k,c,it,ut,st,y,p;if(!t(n))throw new u("container is required.");if(!t(i))throw new u("viewModel is required.");n=f(n);this._viewModel=i;this._container=n;this._centerX=0;this._centerY=0;this._defsElement=undefined;this._svgNode=undefined;this._topG=undefined;this._lastHeight=undefined;this._lastWidth=undefined;tt=document.createElement("style");tt.textContent=".cesium-animation-rectButton .cesium-animation-buttonGlow { filter: url(#animation_blurred); }.cesium-animation-rectButton .cesium-animation-buttonMain { fill: url(#animation_buttonNormal); }.cesium-animation-buttonToggled .cesium-animation-buttonMain { fill: url(#animation_buttonToggled); }.cesium-animation-rectButton:hover .cesium-animation-buttonMain { fill: url(#animation_buttonHovered); }.cesium-animation-buttonDisabled .cesium-animation-buttonMain { fill: url(#animation_buttonDisabled); }.cesium-animation-shuttleRingG .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshGradient); }.cesium-animation-shuttleRingG:hover .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshHovered); }.cesium-animation-shuttleRingPointer { fill: url(#animation_shuttleRingPointerGradient); }.cesium-animation-shuttleRingPausePointer { fill: url(#animation_shuttleRingPointerPaused); }.cesium-animation-knobOuter { fill: url(#animation_knobOuter); }.cesium-animation-knobInner { fill: url(#animation_knobInner); }";document.head.insertBefore(tt,document.head.childNodes[0]);o=document.createElement("div");o.className="cesium-animation-theme";o.innerHTML='<div class="cesium-animation-themeNormal"><\/div><div class="cesium-animation-themeHover"><\/div><div class="cesium-animation-themeSelect"><\/div><div class="cesium-animation-themeDisabled"><\/div><div class="cesium-animation-themeKnob"><\/div><div class="cesium-animation-themePointer"><\/div><div class="cesium-animation-themeSwoosh"><\/div><div class="cesium-animation-themeSwooshHover"><\/div>';this._theme=o;this._themeNormal=o.childNodes[0];this._themeHover=o.childNodes[1];this._themeSelect=o.childNodes[2];this._themeDisabled=o.childNodes[3];this._themeKnob=o.childNodes[4];this._themePointer=o.childNodes[5];this._themeSwoosh=o.childNodes[6];this._themeSwooshHover=o.childNodes[7];w=document.createElementNS(l,"svg:svg");this._svgNode=w;w.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink",nt);a=document.createElementNS(l,"g");this._topG=a;this._realtimeSVG=new h(et(3,4,"#animation_pathClock"),i.playRealtimeViewModel);this._playReverseSVG=new h(g(44,99,"#animation_pathPlayReverse"),i.playReverseViewModel);this._playForwardSVG=new h(g(124,99,"#animation_pathPlay"),i.playForwardViewModel);this._pauseSVG=new h(g(84,99,"#animation_pathPause"),i.pauseViewModel);v=document.createElementNS(l,"g");v.appendChild(this._realtimeSVG.svgElement);v.appendChild(this._playReverseSVG.svgElement);v.appendChild(this._playForwardSVG.svgElement);v.appendChild(this._pauseSVG.svgElement);b=s({tagName:"circle","class":"cesium-animation-shuttleRingBack",cx:100,cy:100,r:99});this._shuttleRingBackPanel=b;k=s({tagName:"g","class":"cesium-animation-shuttleRingSwoosh",children:[{tagName:"use",transform:"translate(100,97) scale(-1,1)","xlink:href":"#animation_pathSwooshFX"},{tagName:"use",transform:"translate(100,97)","xlink:href":"#animation_pathSwooshFX"},{tagName:"line",x1:100,y1:8,x2:100,y2:22}]});this._shuttleRingSwooshG=k;this._shuttleRingPointer=s({tagName:"use","class":"cesium-animation-shuttleRingPointer","xlink:href":"#animation_pathPointer"});c=s({tagName:"g",transform:"translate(100,100)"});this._knobOuter=s({tagName:"circle","class":"cesium-animation-knobOuter",cx:0,cy:0,r:71});it=61;ut=s({tagName:"circle","class":"cesium-animation-knobInner",cx:0,cy:0,r:it});this._knobDate=d(0,-24,"");this._knobTime=d(0,-7,"");this._knobStatus=d(0,-41,"");st=s({tagName:"circle","class":"cesium-animation-blank",cx:0,cy:0,r:it});y=document.createElementNS(l,"g");y.setAttribute("class","cesium-animation-shuttleRingG");n.appendChild(o);a.appendChild(y);a.appendChild(c);a.appendChild(v);y.appendChild(b);y.appendChild(k);y.appendChild(this._shuttleRingPointer);c.appendChild(this._knobOuter);c.appendChild(ut);c.appendChild(this._knobDate);c.appendChild(this._knobTime);c.appendChild(this._knobStatus);c.appendChild(st);w.appendChild(a);n.appendChild(w);p=this;this._mouseCallback=r;b.addEventListener("mousedown",r,!0);b.addEventListener("touchstart",r,!0);k.addEventListener("mousedown",r,!0);k.addEventListener("touchstart",r,!0);document.addEventListener("mousemove",r,!0);document.addEventListener("touchmove",r,!0);document.addEventListener("mouseup",r,!0);document.addEventListener("touchend",r,!0);document.addEventListener("touchcancel",r,!0);this._shuttleRingPointer.addEventListener("mousedown",r,!0);this._shuttleRingPointer.addEventListener("touchstart",r,!0);this._knobOuter.addEventListener("mousedown",r,!0);this._knobOuter.addEventListener("touchstart",r,!0);var ht=this._knobTime.childNodes[0],ct=this._knobDate.childNodes[0],lt=this._knobStatus.childNodes[0],rt;this._subscriptions=[e(i.pauseViewModel,"toggled",function(n){rt!==n&&(rt=n,rt?p._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPausePointer"):p._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPointer"))}),e(i,"shuttleRingAngle",function(n){ft(p._shuttleRingPointer,p._knobOuter,n)}),e(i,"dateLabel",function(n){ct.textContent!==n&&(ct.textContent=n)}),e(i,"timeLabel",function(n){ht.textContent!==n&&(ht.textContent=n)}),e(i,"multiplierLabel",function(n){lt.textContent!==n&&(lt.textContent=n)})];this.applyThemeChanges();this.resize()}var l="http://www.w3.org/2000/svg",nt="http://www.w3.org/1999/xlink",y,v=n.fromCssColorString("rgba(247,250,255,0.384)"),p=n.fromCssColorString("rgba(143,191,255,0.216)"),k=n.fromCssColorString("rgba(153,197,255,0.098)"),w=n.fromCssColorString("rgba(255,255,255,0.086)"),rt=n.fromCssColorString("rgba(255,255,255,0.267)"),ut=n.fromCssColorString("rgba(255,255,255,0)"),tt=n.fromCssColorString("rgba(66,67,68,0.3)"),it=n.fromCssColorString("rgba(0,0,0,0.5)"),b=new n;return h.prototype.destroy=function(){var t,n,i;for(this.svgElement.removeEventListener("click",this._clickFunction,!0),t=this._subscriptions,n=0,i=t.length;n<i;n++)t[n].dispose();r(this)},h.prototype.isDestroyed=function(){return!1},h.prototype.setEnabled=function(n){if(this._enabled!==n){if(this._enabled=n,!n){this.svgElement.setAttribute("class","cesium-animation-buttonDisabled");return}if(this._toggled){this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled");return}this.svgElement.setAttribute("class","cesium-animation-rectButton")}},h.prototype.setToggled=function(n){this._toggled!==n&&(this._toggled=n,this._enabled&&(n?this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"):this.svgElement.setAttribute("class","cesium-animation-rectButton")))},h.prototype.setTooltip=function(n){this.svgElement.getElementsByTagName("title")[0].textContent=n},i(a.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){var n,u,i,f;for(t(this._observer)&&(this._observer.disconnect(),this._observer=undefined),n=this._mouseCallback,this._shuttleRingBackPanel.removeEventListener("mousedown",n,!0),this._shuttleRingBackPanel.removeEventListener("touchstart",n,!0),this._shuttleRingSwooshG.removeEventListener("mousedown",n,!0),this._shuttleRingSwooshG.removeEventListener("touchstart",n,!0),document.removeEventListener("mousemove",n,!0),document.removeEventListener("touchmove",n,!0),document.removeEventListener("mouseup",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("touchcancel",n,!0),this._shuttleRingPointer.removeEventListener("mousedown",n,!0),this._shuttleRingPointer.removeEventListener("touchstart",n,!0),this._knobOuter.removeEventListener("mousedown",n,!0),this._knobOuter.removeEventListener("touchstart",n,!0),this._container.removeChild(this._svgNode),this._container.removeChild(this._theme),this._realtimeSVG.destroy(),this._playReverseSVG.destroy(),this._playForwardSVG.destroy(),this._pauseSVG.destroy(),u=this._subscriptions,i=0,f=u.length;i<f;i++)u[i].dispose();return r(this)},a.prototype.resize=function(){var n=this._container.clientWidth,t=this._container.clientHeight,o,s;if(n!==this._lastWidth||t!==this._lastHeight){var u=this._svgNode,f=200,e=132,i=n,r=t;n===0&&t===0?(i=f,r=e):n===0?(r=t,i=f*(t/e)):t===0&&(i=n,r=e*(n/f));o=i/f;s=r/e;u.style.cssText="width: "+i+"px; height: "+r+"px; position: absolute; bottom: 0; left: 0; overflow: hidden;";u.setAttribute("width",i);u.setAttribute("height",r);u.setAttribute("viewBox","0 0 "+i+" "+r);this._topG.setAttribute("transform","scale("+o+","+s+")");this._centerX=Math.max(1,100*o);this._centerY=Math.max(1,100*s);this._lastHeight=n;this._lastWidth=t}},a.prototype.applyThemeChanges=function(){var n;if(!document.body.contains(this._container)){if(t(this._observer))return;n=this;n._observer=new MutationObserver(function(){document.body.contains(n._container)&&(n._observer.disconnect(),n._observer=undefined,n.applyThemeChanges())});n._observer.observe(document,{childList:!0,subtree:!0});return}var r=c(this._themeNormal),u=c(this._themeHover),f=c(this._themeSelect),y=c(this._themeDisabled),i=c(this._themeKnob),e=c(this._themePointer),h=c(this._themeSwoosh),l=c(this._themeSwooshHover),a=s({tagName:"defs",children:[{id:"animation_buttonNormal",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":o(r,v)},{tagName:"stop",offset:"12%","stop-color":o(r,p)},{tagName:"stop",offset:"46%","stop-color":o(r,k)},{tagName:"stop",offset:"81%","stop-color":o(r,w)}]},{id:"animation_buttonHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":o(u,v)},{tagName:"stop",offset:"12%","stop-color":o(u,p)},{tagName:"stop",offset:"46%","stop-color":o(u,k)},{tagName:"stop",offset:"81%","stop-color":o(u,w)}]},{id:"animation_buttonToggled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":o(f,v)},{tagName:"stop",offset:"12%","stop-color":o(f,p)},{tagName:"stop",offset:"46%","stop-color":o(f,k)},{tagName:"stop",offset:"81%","stop-color":o(f,w)}]},{id:"animation_buttonDisabled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":o(y,rt)},{tagName:"stop",offset:"75%","stop-color":o(y,ut)}]},{id:"animation_blurred",tagName:"filter",width:"200%",height:"200%",x:"-50%",y:"-50%",children:[{tagName:"feGaussianBlur",stdDeviation:4,"in":"SourceGraphic"}]},{id:"animation_shuttleRingSwooshGradient",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":h.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":h.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":h.toCssColorString()}]},{id:"animation_shuttleRingSwooshHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":l.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":l.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":l.toCssColorString()}]},{id:"animation_shuttleRingPointerGradient",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":e.toCssColorString()},{tagName:"stop",offset:"40%","stop-color":e.toCssColorString()},{tagName:"stop",offset:"60%","stop-color":o(e,it)},{tagName:"stop",offset:"100%","stop-color":o(e,it)}]},{id:"animation_shuttleRingPointerPaused",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":"#CCC"},{tagName:"stop",offset:"40%","stop-color":"#CCC"},{tagName:"stop",offset:"60%","stop-color":"#555"},{tagName:"stop",offset:"100%","stop-color":"#555"}]},{id:"animation_knobOuter",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":o(i,v)},{tagName:"stop",offset:"60%","stop-color":o(i,tt)},{tagName:"stop",offset:"85%","stop-color":o(i,p)}]},{id:"animation_knobInner",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":o(i,tt)},{tagName:"stop",offset:"60%","stop-color":o(i,v)},{tagName:"stop",offset:"85%","stop-color":o(i,w)}]},{id:"animation_pathReset",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.316,5.318,9.833,13.682,9.833,5.5,5.5,5.5,5.5,25.5,9.833,25.5,9.833,17.318,24.316,25.682z"},{id:"animation_pathPause",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M13,5.5,7.5,5.5,7.5,25.5,13,25.5zM24.5,5.5,19,5.5,19,25.5,24.5,25.5z"},{id:"animation_pathPlay",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},{id:"animation_pathPlayReverse",tagName:"path",transform:"translate(16,16) scale(-0.85,0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},{id:"animation_pathLoop",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.249,15.499c-0.009,4.832-3.918,8.741-8.75,8.75c-2.515,0-4.768-1.064-6.365-2.763l2.068-1.442l-7.901-3.703l0.744,8.694l2.193-1.529c2.244,2.594,5.562,4.242,9.26,4.242c6.767,0,12.249-5.482,12.249-12.249H24.249zM15.499,6.75c2.516,0,4.769,1.065,6.367,2.764l-2.068,1.443l7.901,3.701l-0.746-8.693l-2.192,1.529c-2.245-2.594-5.562-4.245-9.262-4.245C8.734,3.25,3.25,8.734,3.249,15.499H6.75C6.758,10.668,10.668,6.758,15.499,6.75z"},{id:"animation_pathClock",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-15.5)",d:"M15.5,2.374C8.251,2.375,2.376,8.251,2.374,15.5C2.376,22.748,8.251,28.623,15.5,28.627c7.249-0.004,13.124-5.879,13.125-13.127C28.624,8.251,22.749,2.375,15.5,2.374zM15.5,25.623C9.909,25.615,5.385,21.09,5.375,15.5C5.385,9.909,9.909,5.384,15.5,5.374c5.59,0.01,10.115,4.535,10.124,10.125C25.615,21.09,21.091,25.615,15.5,25.623zM8.625,15.5c-0.001-0.552-0.448-0.999-1.001-1c-0.553,0-1,0.448-1,1c0,0.553,0.449,1,1,1C8.176,16.5,8.624,16.053,8.625,15.5zM8.179,18.572c-0.478,0.277-0.642,0.889-0.365,1.367c0.275,0.479,0.889,0.641,1.365,0.365c0.479-0.275,0.643-0.887,0.367-1.367C9.27,18.461,8.658,18.297,8.179,18.572zM9.18,10.696c-0.479-0.276-1.09-0.112-1.366,0.366s-0.111,1.09,0.365,1.366c0.479,0.276,1.09,0.113,1.367-0.366C9.821,11.584,9.657,10.973,9.18,10.696zM22.822,12.428c0.478-0.275,0.643-0.888,0.366-1.366c-0.275-0.478-0.89-0.642-1.366-0.366c-0.479,0.278-0.642,0.89-0.366,1.367C21.732,12.54,22.344,12.705,22.822,12.428zM12.062,21.455c-0.478-0.275-1.089-0.111-1.366,0.367c-0.275,0.479-0.111,1.09,0.366,1.365c0.478,0.277,1.091,0.111,1.365-0.365C12.704,22.344,12.54,21.732,12.062,21.455zM12.062,9.545c0.479-0.276,0.642-0.888,0.366-1.366c-0.276-0.478-0.888-0.642-1.366-0.366s-0.642,0.888-0.366,1.366C10.973,9.658,11.584,9.822,12.062,9.545zM22.823,18.572c-0.48-0.275-1.092-0.111-1.367,0.365c-0.275,0.479-0.112,1.092,0.367,1.367c0.477,0.275,1.089,0.113,1.365-0.365C23.464,19.461,23.3,18.848,22.823,18.572zM19.938,7.813c-0.477-0.276-1.091-0.111-1.365,0.366c-0.275,0.48-0.111,1.091,0.366,1.367s1.089,0.112,1.366-0.366C20.581,8.702,20.418,8.089,19.938,7.813zM23.378,14.5c-0.554,0.002-1.001,0.45-1.001,1c0.001,0.552,0.448,1,1.001,1c0.551,0,1-0.447,1-1C24.378,14.949,23.929,14.5,23.378,14.5zM15.501,6.624c-0.552,0-1,0.448-1,1l-0.466,7.343l-3.004,1.96c-0.478,0.277-0.642,0.889-0.365,1.365c0.275,0.479,0.889,0.643,1.365,0.367l3.305-1.676C15.39,16.99,15.444,17,15.501,17c0.828,0,1.5-0.671,1.5-1.5l-0.5-7.876C16.501,7.072,16.053,6.624,15.501,6.624zM15.501,22.377c-0.552,0-1,0.447-1,1s0.448,1,1,1s1-0.447,1-1S16.053,22.377,15.501,22.377zM18.939,21.455c-0.479,0.277-0.643,0.889-0.366,1.367c0.275,0.477,0.888,0.643,1.366,0.365c0.478-0.275,0.642-0.889,0.366-1.365C20.028,21.344,19.417,21.18,18.939,21.455z"},{id:"animation_pathWingButton",tagName:"path",d:"m 4.5,0.5 c -2.216,0 -4,1.784 -4,4 l 0,24 c 0,2.216 1.784,4 4,4 l 13.71875,0 C 22.478584,27.272785 27.273681,22.511272 32.5,18.25 l 0,-13.75 c 0,-2.216 -1.784,-4 -4,-4 l -24,0 z"},{id:"animation_pathPointer",tagName:"path",d:"M-15,-65,-15,-55,15,-55,15,-65,0,-95z"},{id:"animation_pathSwooshFX",tagName:"path",d:"m 85,0 c 0,16.617 -4.813944,35.356 -13.131081,48.4508 h 6.099803 c 8.317138,-13.0948 13.13322,-28.5955 13.13322,-45.2124 0,-46.94483 -38.402714,-85.00262 -85.7743869,-85.00262 -1.0218522,0 -2.0373001,0.0241 -3.0506131,0.0589 45.958443,1.59437 82.723058,35.77285 82.723058,81.70532 z"}]});t(this._defsElement)?this._svgNode.replaceChild(a,this._defsElement):this._svgNode.appendChild(a);this._defsElement=a},a});t("Widgets/createCommand",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event","../ThirdParty/knockout"],function(n,t,i,r,u,f){"use strict";function e(e,o){function s(){if(!s.canExecute)throw new r("Cannot execute command, canExecute is false.");var t={args:arguments,cancel:!1},n;return h.raiseEvent(t),t.cancel||(n=e.apply(null,arguments),c.raiseEvent(n)),n}if(!t(e))throw new r("func is required.");o=n(o,!0);var h=new u,c=new u;return s.canExecute=o,f.track(s,["canExecute"]),i(s,{beforeExecute:{value:h},afterExecute:{value:c}}),s}return e});t("Widgets/ToggleButtonViewModel",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../ThirdParty/knockout"],function(n,t,i,r,u){"use strict";function f(i,f){if(!t(i))throw new r("command is required.");this._command=i;f=n(f,n.EMPTY_OBJECT);this.toggled=n(f.toggled,!1);this.tooltip=n(f.tooltip,"");u.track(this,["toggled","tooltip"])}return i(f.prototype,{command:{get:function(){return this._command}}}),f});t("Widgets/Animation/AnimationViewModel",["../../Core/binarySearch","../../Core/ClockRange","../../Core/ClockStep","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/JulianDate","../../ThirdParty/knockout","../../ThirdParty/sprintf","../createCommand","../ToggleButtonViewModel"],function(n,t,i,r,u,f,e,o,s,h,c){"use strict";function p(n,t){return n-t}function y(t,i){var r=n(i,t,p);return r<0?~r:r}function b(n,t){if(Math.abs(n)<=a)return n/a;var i=a,e=v,r,u=0,f;return n>0?(r=Math.log(t[t.length-1]),f=(r-u)/(e-i),Math.exp(u+f*(n-i))):(r=Math.log(-t[0]),f=(r-u)/(e-i),-Math.exp(u+f*(Math.abs(n)-i)))}function k(n,t,r){var u;if(r.clockStep===i.SYSTEM_CLOCK)return a;if(Math.abs(n)<=1)return n*a;u=t[t.length-1];n>u?n=u:n<-u&&(n=-u);var f=a,h=v,e,o=0,s;return n>0?(e=Math.log(u),s=(e-o)/(h-f),(Math.log(n)-o)/s+f):(e=Math.log(-t[0]),s=(e-o)/(h-f),-((Math.log(Math.abs(n))-o)/s+f))}function l(n){var u,s,p,w,d;if(!r(n))throw new f("clockViewModel is required.");u=this;this._clockViewModel=n;this._allShuttleRingTicks=[];this._dateFormatter=l.defaultDateFormatter;this._timeFormatter=l.defaultTimeFormatter;this.shuttleRingDragging=!1;this.snapToTicks=!1;o.track(this,["_allShuttleRingTicks","_dateFormatter","_timeFormatter","shuttleRingDragging","snapToTicks"]);this._sortedFilteredPositiveTicks=[];this.setShuttleRingTicks(l.defaultTicks);this.timeLabel=undefined;o.defineProperty(this,"timeLabel",function(){return u._timeFormatter(u._clockViewModel.currentTime,u)});this.dateLabel=undefined;o.defineProperty(this,"dateLabel",function(){return u._dateFormatter(u._clockViewModel.currentTime,u)});this.multiplierLabel=undefined;o.defineProperty(this,"multiplierLabel",function(){var t=u._clockViewModel,n;return t.clockStep===i.SYSTEM_CLOCK?"Today":(n=t.multiplier,n%1==0)?n.toFixed(0)+"x":n.toFixed(3).replace(/0{0,3}$/,"")+"x"});this.shuttleRingAngle=undefined;o.defineProperty(this,"shuttleRingAngle",{get:function(){return k(n.multiplier,u._allShuttleRingTicks,n)},set:function(n){var r,e,t,f,s,o;if(n=Math.max(Math.min(n,v),-v),r=u._allShuttleRingTicks,e=u._clockViewModel,e.clockStep=i.SYSTEM_CLOCK_MULTIPLIER,Math.abs(n)===v){e.multiplier=n>0?r[r.length-1]:r[0];return}t=b(n,r);u.snapToTicks?t=r[y(t,r)]:t!==0&&(f=Math.abs(t),f>100?(s=f.toFixed(0).length-2,o=Math.pow(10,s),t=Math.round(t/o)*o|0):f>a?t=Math.round(t):f>1?t=+t.toFixed(1):f>0&&(t=+t.toFixed(2)));e.multiplier=t}});this._canAnimate=undefined;o.defineProperty(this,"_canAnimate",function(){var n=u._clockViewModel,h=n.clockRange,s;if(u.shuttleRingDragging||h===t.UNBOUNDED)return!0;var o=n.multiplier,i=n.currentTime,r=n.startTime,f=!1;return h===t.LOOP_STOP?f=e.greaterThan(i,r)||i.equals(r)&&o>0:(s=n.stopTime,f=e.greaterThan(i,r)&&e.lessThan(i,s)||i.equals(r)&&o>0||i.equals(s)&&o<0),f||(n.shouldAnimate=!1),f});this._isSystemTimeAvailable=undefined;o.defineProperty(this,"_isSystemTimeAvailable",function(){var n=u._clockViewModel,r=n.clockRange,i;return r===t.UNBOUNDED?!0:(i=n.systemTime,e.greaterThanOrEquals(i,n.startTime)&&e.lessThanOrEquals(i,n.stopTime))});this._isAnimating=undefined;o.defineProperty(this,"_isAnimating",function(){return u._clockViewModel.shouldAnimate&&(u._canAnimate||u.shuttleRingDragging)});s=h(function(){var n=u._clockViewModel;n.shouldAnimate?n.shouldAnimate=!1:u._canAnimate&&(n.shouldAnimate=!0)});this._pauseViewModel=new c(s,{toggled:o.computed(function(){return!u._isAnimating}),tooltip:"Pause"});p=h(function(){var n=u._clockViewModel,t=n.multiplier;t>0&&(n.multiplier=-t);n.shouldAnimate=!0});this._playReverseViewModel=new c(p,{toggled:o.computed(function(){return u._isAnimating&&n.multiplier<0}),tooltip:"Play Reverse"});w=h(function(){var n=u._clockViewModel,t=n.multiplier;t<0&&(n.multiplier=-t);n.shouldAnimate=!0});this._playForwardViewModel=new c(w,{toggled:o.computed(function(){return u._isAnimating&&n.multiplier>0&&n.clockStep!==i.SYSTEM_CLOCK}),tooltip:"Play Forward"});d=h(function(){u._clockViewModel.clockStep=i.SYSTEM_CLOCK},o.getObservable(this,"_isSystemTimeAvailable"));this._playRealtimeViewModel=new c(d,{toggled:o.computed(function(){return n.clockStep===i.SYSTEM_CLOCK}),tooltip:o.computed(function(){return u._isSystemTimeAvailable?"Today (real-time)":"Current time not in range"})});this._slower=h(function(){var n=u._clockViewModel,t=u._allShuttleRingTicks,r=n.multiplier,i=y(r,t)-1;i>=0&&(n.multiplier=t[i])});this._faster=h(function(){var t=u._clockViewModel,n=u._allShuttleRingTicks,r=t.multiplier,i=y(r,n)+1;i<n.length&&(t.multiplier=n[i])})}var w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=15,v=105;return l.defaultDateFormatter=function(n){var t=e.toGregorianDate(n);return w[t.month-1]+" "+t.day+" "+t.year},l.defaultTicks=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800],l.defaultTimeFormatter=function(n,t){var i=e.toGregorianDate(n),r=Math.round(i.millisecond);return Math.abs(t._clockViewModel.multiplier)<1?s("%02d:%02d:%02d.%03d",i.hour,i.minute,i.second,r):s("%02d:%02d:%02d UTC",i.hour,i.minute,i.second)},l.prototype.getShuttleRingTicks=function(){return this._sortedFilteredPositiveTicks.slice(0)},l.prototype.setShuttleRingTicks=function(n){var t,e,i,s,u,o;if(!r(n))throw new f("positiveTicks is required.");for(s={},u=this._sortedFilteredPositiveTicks,u.length=0,t=0,e=n.length;t<e;++t)i=n[t],s.hasOwnProperty(i)||(s[i]=!0,u.push(i));for(u.sort(p),o=[],e=u.length,t=e-1;t>=0;--t)i=u[t],i!==0&&o.push(-i);Array.prototype.push.apply(o,u);this._allShuttleRingTicks=o},u(l.prototype,{slower:{get:function(){return this._slower}},faster:{get:function(){return this._faster}},clockViewModel:{get:function(){return this._clockViewModel}},pauseViewModel:{get:function(){return this._pauseViewModel}},playReverseViewModel:{get:function(){return this._playReverseViewModel}},playForwardViewModel:{get:function(){return this._playForwardViewModel}},playRealtimeViewModel:{get:function(){return this._playRealtimeViewModel}},dateFormatter:{get:function(){return this._dateFormatter},set:function(n){if(typeof n!="function")throw new f("dateFormatter must be a function");this._dateFormatter=n}},timeFormatter:{get:function(){return this._timeFormatter},set:function(n){if(typeof n!="function")throw new f("timeFormatter must be a function");this._timeFormatter=n}}}),l._maxShuttleRingAngle=v,l._realtimeShuttleRingAngle=a,l});t("Widgets/BaseLayerPicker/BaseLayerPickerViewModel",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/EllipsoidTerrainProvider","../../Core/isArray","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u,f,e,o){"use strict";function s(i){var y,p,w,b,s,h,c;i=n(i,n.EMPTY_OBJECT);var l=i.globe,a=n(i.imageryProviderViewModels,[]),v=n(i.terrainProviderViewModels,[]);if(!t(l))throw new r("globe is required");this._globe=l;this.imageryProviderViewModels=a.slice(0);this.terrainProviderViewModels=v.slice(0);this.dropDownVisible=!1;e.track(this,["imageryProviderViewModels","terrainProviderViewModels","dropDownVisible"]);y=e.getObservable(this,"imageryProviderViewModels");p=e.pureComputed(function(){for(var s=y(),i={},r,u,f,e,o,n=0;n<s.length;n++)r=s[n],u=r.category,t(i[u])?i[u].push(r):i[u]=[r];for(f=Object.keys(i),e=[],n=0;n<f.length;n++)o=f[n],e.push({name:o,providers:i[o]});return e});this._imageryProviders=p;w=e.getObservable(this,"terrainProviderViewModels");b=e.pureComputed(function(){for(var s=w(),i={},r,u,f,e,o,n=0;n<s.length;n++)r=s[n],u=r.category,t(i[u])?i[u].push(r):i[u]=[r];for(f=Object.keys(i),e=[],n=0;n<f.length;n++)o=f[n],e.push({name:o,providers:i[o]});return e});this._terrainProviders=b;this.buttonTooltip=undefined;e.defineProperty(this,"buttonTooltip",function(){var r=this.selectedImagery,u=this.selectedTerrain,n=t(r)?r.name:undefined,i=t(u)?u.name:undefined;return t(n)&&t(i)?n+"\n"+i:t(n)?n:i});this.buttonImageUrl=undefined;e.defineProperty(this,"buttonImageUrl",function(){var n=this.selectedImagery;if(t(n))return n.iconUrl});this.selectedImagery=undefined;s=e.observable();this._currentImageryProviders=[];e.defineProperty(this,"selectedImagery",{get:function(){return s()},set:function(n){var a,e,o,u,v,h;if(s()===n){this.dropDownVisible=!1;return}for(var c=this._currentImageryProviders,y=c.length,r=this._globe.imageryLayers,l=!1,i=0;i<y;i++)for(a=r.length,e=0;e<a;e++)if(o=r.get(e),o.imageryProvider===c[i]){r.remove(o);l=!0;break}if(t(n))if(u=n.creationCommand(),f(u)){for(v=u.length,i=v-1;i>=0;i--)r.addImageryProvider(u[i],0);this._currentImageryProviders=u.slice(0)}else this._currentImageryProviders=[u],l?r.addImageryProvider(u,0):(h=r.get(0),t(h)&&r.remove(h),r.addImageryProvider(u,0));s(n);this.dropDownVisible=!1}});this.selectedTerrain=undefined;h=e.observable();e.defineProperty(this,"selectedTerrain",{get:function(){return h()},set:function(n){if(h()===n){this.dropDownVisible=!1;return}var i;t(n)&&(i=n.creationCommand());this._globe.depthTestAgainstTerrain=!(i instanceof u);this._globe.terrainProvider=i;h(n);this.dropDownVisible=!1}});c=this;this._toggleDropDown=o(function(){c.dropDownVisible=!c.dropDownVisible});this.selectedImagery=n(i.selectedImageryProviderViewModel,a[0]);this.selectedTerrain=n(i.selectedTerrainProviderViewModel,v[0])}return i(s.prototype,{toggleDropDown:{get:function(){return this._toggleDropDown}},globe:{get:function(){return this._globe}}}),s});t("Widgets/BaseLayerPicker/BaseLayerPicker",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/FeatureDetection","../../ThirdParty/knockout","../getElement","./BaseLayerPickerViewModel"],function(n,t,i,r,u,f,e,o){"use strict";function s(t,i){var a,h,v,s,y,p,w,rt,b,c,k,ut,d,g,nt,ft,tt,l,it,et;if(!n(t))throw new r("container is required.");t=e(t);a=new o(i);h=document.createElement("button");h.type="button";h.className="cesium-button cesium-toolbar-button";h.setAttribute("data-bind","attr: { title: buttonTooltip },click: toggleDropDown");t.appendChild(h);v=document.createElement("img");v.setAttribute("draggable","false");v.className="cesium-baseLayerPicker-selected";v.setAttribute("data-bind","attr: { src: buttonImageUrl }, visible: !!buttonImageUrl");h.appendChild(v);s=document.createElement("div");s.className="cesium-baseLayerPicker-dropDown";s.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-dropDown-visible" : dropDownVisible }');t.appendChild(s);y=document.createElement("div");y.className="cesium-baseLayerPicker-sectionTitle";y.setAttribute("data-bind","visible: imageryProviderViewModels.length > 0");y.innerHTML="Imagery";s.appendChild(y);p=document.createElement("div");p.className="cesium-baseLayerPicker-section";p.setAttribute("data-bind","foreach: _imageryProviders");s.appendChild(p);w=document.createElement("div");w.className="cesium-baseLayerPicker-category";p.appendChild(w);rt=document.createElement("div");rt.className="cesium-baseLayerPicker-categoryTitle";rt.setAttribute("data-bind","text: name");w.appendChild(rt);b=document.createElement("div");b.className="cesium-baseLayerPicker-choices";b.setAttribute("data-bind","foreach: providers");w.appendChild(b);c=document.createElement("div");c.className="cesium-baseLayerPicker-item";c.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data === $parents[1].selectedImagery },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedImagery = $data; }');b.appendChild(c);k=document.createElement("img");k.className="cesium-baseLayerPicker-itemIcon";k.setAttribute("data-bind","attr: { src: iconUrl }");k.setAttribute("draggable","false");c.appendChild(k);ut=document.createElement("div");ut.className="cesium-baseLayerPicker-itemLabel";ut.setAttribute("data-bind","text: name");c.appendChild(ut);d=document.createElement("div");d.className="cesium-baseLayerPicker-sectionTitle";d.setAttribute("data-bind","visible: terrainProviderViewModels.length > 0");d.innerHTML="Terrain";s.appendChild(d);g=document.createElement("div");g.className="cesium-baseLayerPicker-section";g.setAttribute("data-bind","foreach: _terrainProviders");s.appendChild(g);nt=document.createElement("div");nt.className="cesium-baseLayerPicker-category";g.appendChild(nt);ft=document.createElement("div");ft.className="cesium-baseLayerPicker-categoryTitle";ft.setAttribute("data-bind","text: name");nt.appendChild(ft);tt=document.createElement("div");tt.className="cesium-baseLayerPicker-choices";tt.setAttribute("data-bind","foreach: providers");nt.appendChild(tt);l=document.createElement("div");l.className="cesium-baseLayerPicker-item";l.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data === $parents[1].selectedTerrain },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedTerrain = $data; }');tt.appendChild(l);it=document.createElement("img");it.className="cesium-baseLayerPicker-itemIcon";it.setAttribute("data-bind","attr: { src: iconUrl }");it.setAttribute("draggable","false");l.appendChild(it);et=document.createElement("div");et.className="cesium-baseLayerPicker-itemLabel";et.setAttribute("data-bind","text: name");l.appendChild(et);f.applyBindings(a,h);f.applyBindings(a,s);this._viewModel=a;this._container=t;this._element=h;this._dropPanel=s;this._closeDropDown=function(n){h.contains(n.target)||s.contains(n.target)||(a.dropDownVisible=!1)};u.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}return t(s.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return u.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),f.cleanNode(this._element),f.cleanNode(this._dropPanel),this._container.removeChild(this._element),this._container.removeChild(this._dropPanel),i(this)},s});t("Widgets/BaseLayerPicker/ProviderViewModel",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u,f){"use strict";function e(i){if(!t(i.name))throw new r("options.name is required.");if(!t(i.tooltip))throw new r("options.tooltip is required.");if(!t(i.iconUrl))throw new r("options.iconUrl is required.");if(typeof i.creationFunction!="function")throw new r("options.creationFunction is required.");var e=i.creationFunction;t(e.canExecute)||(e=f(e));this._creationCommand=e;this.name=i.name;this.tooltip=i.tooltip;this.iconUrl=i.iconUrl;this._category=n(i.category,"");u.track(this,["name","tooltip","iconUrl"])}return i(e.prototype,{creationCommand:{get:function(){return this._creationCommand}},category:{get:function(){return this._category}}}),e});t("Widgets/BaseLayerPicker/createDefaultImageryProviderViewModels",["../../Core/buildModuleUrl","../../Scene/ArcGisMapServerImageryProvider","../../Scene/IonWorldImageryStyle","../../Scene/createOpenStreetMapImageryProvider","../../Scene/createTileMapServiceImageryProvider","../../Scene/createWorldImagery","../../Scene/IonImageryProvider","../../Scene/MapboxImageryProvider","../BaseLayerPicker/ProviderViewModel"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(){var h=[];return h.push(new s({name:"Bing Maps Aerial",iconUrl:n("Widgets/Images/ImageryProviders/bingAerial.png"),tooltip:"Bing Maps aerial imagery, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return f({style:i.AERIAL})}})),h.push(new s({name:"Bing Maps Aerial with Labels",iconUrl:n("Widgets/Images/ImageryProviders/bingAerialLabels.png"),tooltip:"Bing Maps aerial imagery with labels, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return f({style:i.AERIAL_WITH_LABELS})}})),h.push(new s({name:"Bing Maps Roads",iconUrl:n("Widgets/Images/ImageryProviders/bingRoads.png"),tooltip:"Bing Maps standard road maps, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return f({style:i.ROAD})}})),h.push(new s({name:"Mapbox Satellite",tooltip:"Mapbox satellite imagery https://www.mapbox.com/maps/",iconUrl:n("Widgets/Images/ImageryProviders/mapboxSatellite.png"),category:"Other",creationFunction:function(){return new o({mapId:"mapbox.satellite"})}})),h.push(new s({name:"Mapbox Streets",tooltip:"Mapbox streets imagery https://www.mapbox.com/maps/",iconUrl:n("Widgets/Images/ImageryProviders/mapboxTerrain.png"),category:"Other",creationFunction:function(){return new o({mapId:"mapbox.streets"})}})),h.push(new s({name:"Mapbox Streets Classic",tooltip:"Mapbox streets basic imagery https://www.mapbox.com/maps/",iconUrl:n("Widgets/Images/ImageryProviders/mapboxStreets.png"),category:"Other",creationFunction:function(){return new o({mapId:"mapbox.streets-basic"})}})),h.push(new s({name:"ESRI World Imagery",iconUrl:n("Widgets/Images/ImageryProviders/esriWorldImagery.png"),tooltip:"World Imagery provides one meter or better satellite and aerial imagery in many parts of the world and lower resolution satellite imagery worldwide.  The map includes NASA Blue Marble: Next Generation 500m resolution imagery at small scales (above 1:1,000,000), i-cubed 15m eSAT imagery at medium-to-large scales (down to 1:70,000) for the world, and USGS 15m Landsat imagery for Antarctica. The map features 0.3m resolution imagery in the continental United States and 0.6m resolution imagery in parts of Western Europe from DigitalGlobe. In other parts of the world, 1 meter resolution imagery is available from GeoEye IKONOS, i-cubed Nationwide Prime, Getmapping, AeroGRID, IGN Spain, and IGP Portugal.  Additionally, imagery at different resolutions has been contributed by the GIS User Community.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new t({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",enablePickFeatures:!1})}})),h.push(new s({name:"ESRI World Street Map",iconUrl:n("Widgets/Images/ImageryProviders/esriWorldStreetMap.png"),tooltip:"This worldwide street map presents highway-level data for the world. Street-level data includes the United States; much of Canada; Japan; most countries in Europe; Australia and New Zealand; India; parts of South America including Argentina, Brazil, Chile, Colombia, and Venezuela; Ghana; and parts of southern Africa including Botswana, Lesotho, Namibia, South Africa, and Swaziland.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new t({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",enablePickFeatures:!1})}})),h.push(new s({name:"ESRI National Geographic",iconUrl:n("Widgets/Images/ImageryProviders/esriNationalGeographic.png"),tooltip:"This web map contains the National Geographic World Map service. This map service is designed to be used as a general reference map for informational and educational purposes as well as a basemap by GIS professionals and other users for creating web maps and web mapping applications.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new t({url:"https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/",enablePickFeatures:!1})}})),h.push(new s({name:"OpenStreetMap",iconUrl:n("Widgets/Images/ImageryProviders/openStreetMap.png"),tooltip:"OpenStreetMap (OSM) is a collaborative project to create a free editable map of the world.\nhttp://www.openstreetmap.org",category:"Other",creationFunction:function(){return r({url:"https://a.tile.openstreetmap.org/"})}})),h.push(new s({name:"Stamen Watercolor",iconUrl:n("Widgets/Images/ImageryProviders/stamenWatercolor.png"),tooltip:"Reminiscent of hand drawn maps, Stamen watercolor maps apply raster effect area washes and organic edges over a paper texture to add warm pop to any map.\nhttp://maps.stamen.com",category:"Other",creationFunction:function(){return r({url:"https://stamen-tiles.a.ssl.fastly.net/watercolor/",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),h.push(new s({name:"Stamen Toner",iconUrl:n("Widgets/Images/ImageryProviders/stamenToner.png"),tooltip:"A high contrast black and white map.\nhttp://maps.stamen.com",category:"Other",creationFunction:function(){return r({url:"https://stamen-tiles.a.ssl.fastly.net/toner/",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),h.push(new s({name:"Sentinel-2",iconUrl:n("Widgets/Images/ImageryProviders/sentinel-2.png"),tooltip:"Sentinel-2 cloudless by EOX IT Services GmbH (Contains modified Copernicus Sentinel data 2016 and 2017).",category:"Cesium ion",creationFunction:function(){return new e({assetId:3954})}})),h.push(new s({name:"Blue Marble",iconUrl:n("Widgets/Images/ImageryProviders/blueMarble.png"),tooltip:"Blue Marble Next Generation July, 2004 imagery from NASA.",category:"Cesium ion",creationFunction:function(){return new e({assetId:3845})}})),h.push(new s({name:"Earth at night",iconUrl:n("Widgets/Images/ImageryProviders/earthAtNight.png"),tooltip:"The Earth at night, also known as The Black Marble, is a 500 meter resolution global composite imagery layer released by NASA.",category:"Cesium ion",creationFunction:function(){return new e({assetId:3812})}})),h.push(new s({name:"Natural EarthII",iconUrl:n("Widgets/Images/ImageryProviders/naturalEarthII.png"),tooltip:"Natural Earth II, darkened for contrast.\nhttp://www.naturalearthdata.com/",category:"Cesium ion",creationFunction:function(){return u({url:n("Assets/Textures/NaturalEarthII")})}})),h}return h});t("Widgets/BaseLayerPicker/createDefaultTerrainProviderViewModels",["../../Core/buildModuleUrl","../../Core/createWorldTerrain","../../Core/EllipsoidTerrainProvider","../BaseLayerPicker/ProviderViewModel"],function(n,t,i,r){"use strict";function u(){var u=[];return u.push(new r({name:"WGS84 Ellipsoid",iconUrl:n("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",category:"Cesium ion",creationFunction:function(){return new i}})),u.push(new r({name:"Cesium World Terrain",iconUrl:n("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"High-resolution global terrain tileset curated from several datasources and hosted by Cesium ion",category:"Cesium ion",creationFunction:function(){return t({requestWaterMask:!0,requestVertexNormals:!0})}})),u}return u});t("Widgets/InspectorShared",["../Core/defined","../Core/Check"],function(n,t){"use strict";var i={};return i.createCheckbox=function(i,r,u){var o;t.typeOf.string("labelText",i);t.typeOf.string("checkedBinding",r);var s=document.createElement("div"),f=document.createElement("label"),e=document.createElement("input");return e.type="checkbox",o="checked: "+r,n(u)&&(o+=", enable: "+u),e.setAttribute("data-bind",o),f.appendChild(e),f.appendChild(document.createTextNode(i)),s.appendChild(f),s},i.createSection=function(n,i,r,u){var f,e,o;return t.defined("panel",n),t.typeOf.string("headerText",i),t.typeOf.string("sectionVisibleBinding",r),t.typeOf.string("toggleSectionVisibilityBinding",u),f=document.createElement("div"),f.className="cesium-cesiumInspector-section",f.setAttribute("data-bind",'css: { "cesium-cesiumInspector-section-collapsed": !'+r+" }"),n.appendChild(f),e=document.createElement("h3"),e.className="cesium-cesiumInspector-sectionHeader",e.appendChild(document.createTextNode(i)),e.setAttribute("data-bind","click: "+u),f.appendChild(e),o=document.createElement("div"),o.className="cesium-cesiumInspector-sectionContent",f.appendChild(o),o},i});t("Widgets/Cesium3DTilesInspector/Cesium3DTilesInspectorViewModel",["../../Core/Check","../../Core/Color","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/ScreenSpaceEventHandler","../../Core/ScreenSpaceEventType","../../Scene/Cesium3DTileColorBlendMode","../../Scene/Cesium3DTileFeature","../../Scene/Cesium3DTileset","../../Scene/Cesium3DTileStyle","../../Scene/PerformanceDisplay","../../ThirdParty/knockout"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";function g(n){return function(t){var r=n._scene.pick(t.position);i(r)&&r.primitive instanceof h&&(n.tileset=r.primitive);n.pickActive=!1}}function k(n,t){t?n._eventHandler.setInputAction(function(t){var r=n._scene.pick(t.endPosition);i(r)&&r.primitive instanceof h&&(n.tileset=r.primitive)},e.MOUSE_MOVE):(n._eventHandler.removeInputAction(e.MOUSE_MOVE),n.picking=n.picking)}function w(n){var t=n/1048576;return t<1?t.toLocaleString(undefined,nt):Math.round(t).toLocaleString()}function y(n,t){if(!i(n))return"";var r=t?n._statisticsLastPick:n._statisticsLastColor,u='<ul class="cesium-cesiumInspector-statistics">';return u+="<li><strong>Visited: <\/strong>"+r.visited.toLocaleString()+"<\/li><li><strong>Selected: <\/strong>"+r.selected.toLocaleString()+"<\/li><li><strong>Commands: <\/strong>"+r.numberOfCommands.toLocaleString()+"<\/li>",u+="<\/ul>",t||(u+='<ul class="cesium-cesiumInspector-statistics">',u+="<li><strong>Requests: <\/strong>"+r.numberOfPendingRequests.toLocaleString()+"<\/li><li><strong>Attempted: <\/strong>"+r.numberOfAttemptedRequests.toLocaleString()+"<\/li><li><strong>Processing: <\/strong>"+r.numberOfTilesProcessing.toLocaleString()+"<\/li><li><strong>Content Ready: <\/strong>"+r.numberOfTilesWithContentReady.toLocaleString()+"<\/li><li><strong>Total: <\/strong>"+r.numberOfTilesTotal.toLocaleString()+"<\/li>",u+="<\/ul>",u+='<ul class="cesium-cesiumInspector-statistics">',u+="<li><strong>Features Selected: <\/strong>"+r.numberOfFeaturesSelected.toLocaleString()+"<\/li><li><strong>Features Loaded: <\/strong>"+r.numberOfFeaturesLoaded.toLocaleString()+"<\/li><li><strong>Points Selected: <\/strong>"+r.numberOfPointsSelected.toLocaleString()+"<\/li><li><strong>Points Loaded: <\/strong>"+r.numberOfPointsLoaded.toLocaleString()+"<\/li><li><strong>Triangles Selected: <\/strong>"+r.numberOfTrianglesSelected.toLocaleString()+"<\/li>",u+="<\/ul>",u+='<ul class="cesium-cesiumInspector-statistics">',u+="<li><strong>Tiles styled: <\/strong>"+r.numberOfTilesStyled.toLocaleString()+"<\/li><li><strong>Features styled: <\/strong>"+r.numberOfFeaturesStyled.toLocaleString()+"<\/li>",u+="<\/ul>",u+='<ul class="cesium-cesiumInspector-statistics">',u+="<li><strong>Children Union Culled: <\/strong>"+r.numberOfTilesCulledWithChildrenUnion.toLocaleString()+"<\/li>",u+="<\/ul>",u+='<ul class="cesium-cesiumInspector-statistics">',u+="<li><strong>Geometry Memory (MB): <\/strong>"+w(r.geometryByteLength)+"<\/li><li><strong>Texture Memory (MB): <\/strong>"+w(r.texturesByteLength)+"<\/li><li><strong>Batch Table Memory (MB): <\/strong>"+w(r.batchTableByteLength)+"<\/li>",u+="<\/ul>"),u}function v(t,r){var u,v,y,p,w,b,d,nt,tt,it,rt,c,ut,ft,et,ot,st,h,ht,ri,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii;n.typeOf.object("scene",t);n.typeOf.object("performanceContainer",r);u=this;v=t.canvas;this._eventHandler=new f(v);this._scene=t;this._performanceContainer=r;this._canvas=v;this._performanceDisplay=new l({container:r});this._statisticsText="";this._pickStatisticsText="";this._editorError="";this.performance=!1;this.showStatistics=!0;this.showPickStatistics=!0;this.inspectorVisible=!0;this.tilesetVisible=!1;this.displayVisible=!1;this.updateVisible=!1;this.loggingVisible=!1;this.styleVisible=!1;this.tileDebugLabelsVisible=!1;this.optimizationVisible=!1;this.styleString="{}";this._tileset=undefined;this._feature=undefined;this._tile=undefined;a.track(this,["performance","inspectorVisible","_statisticsText","_pickStatisticsText","_editorError","showPickStatistics","showStatistics","tilesetVisible","displayVisible","updateVisible","loggingVisible","styleVisible","optimizationVisible","tileDebugLabelsVisible","styleString","_feature","_tile"]);this._properties=a.observable({});this.properties=[];a.defineProperty(this,"properties",function(){var n=[],t=u._properties();for(var i in t)t.hasOwnProperty(i)&&n.push(i);return n});y=a.observable();a.defineProperty(this,"dynamicScreenSpaceError",{get:function(){return y()},set:function(n){y(n);i(u._tileset)&&(u._tileset.dynamicScreenSpaceError=n)}});this.dynamicScreenSpaceError=!1;p=a.observable();a.defineProperty(this,"colorBlendMode",{get:function(){return p()},set:function(n){p(n);i(u._tileset)&&(u._tileset.colorBlendMode=n,u._scene.requestRender())}});this.colorBlendMode=o.HIGHLIGHT;w=a.observable();a.defineProperty(this,"picking",{get:function(){return w()},set:function(n){w(n);n?u._eventHandler.setInputAction(function(n){var r=t.pick(n.endPosition),f;(r instanceof s?(u.feature=r,u.tile=r.content.tile):i(r)&&i(r.content)?(u.feature=undefined,u.tile=r.content.tile):(u.feature=undefined,u.tile=undefined),i(u._tileset))&&(c&&i(r)&&i(r.content)?(t.pickPositionSupported&&(f=t.pickPosition(n.endPosition),i(f)&&(u._tileset.debugPickPosition=f)),u._tileset.debugPickedTile=r.content.tile):u._tileset.debugPickedTile=undefined,u._scene.requestRender())},e.MOUSE_MOVE):(u.feature=undefined,u.tile=undefined,u._eventHandler.removeInputAction(e.MOUSE_MOVE))}});this.picking=!0;b=a.observable();a.defineProperty(this,"colorize",{get:function(){return b()},set:function(n){b(n);i(u._tileset)&&(u._tileset.debugColorizeTiles=n,u._scene.requestRender())}});this.colorize=!1;d=a.observable();a.defineProperty(this,"wireframe",{get:function(){return d()},set:function(n){d(n);i(u._tileset)&&(u._tileset.debugWireframe=n,u._scene.requestRender())}});this.wireframe=!1;nt=a.observable();a.defineProperty(this,"showBoundingVolumes",{get:function(){return nt()},set:function(n){nt(n);i(u._tileset)&&(u._tileset.debugShowBoundingVolume=n,u._scene.requestRender())}});this.showBoundingVolumes=!1;tt=a.observable();a.defineProperty(this,"showContentBoundingVolumes",{get:function(){return tt()},set:function(n){tt(n);i(u._tileset)&&(u._tileset.debugShowContentBoundingVolume=n,u._scene.requestRender())}});this.showContentBoundingVolumes=!1;it=a.observable();a.defineProperty(this,"showRequestVolumes",{get:function(){return it()},set:function(n){it(n);i(u._tileset)&&(u._tileset.debugShowViewerRequestVolume=n,u._scene.requestRender())}});this.showRequestVolumes=!1;rt=a.observable();a.defineProperty(this,"freezeFrame",{get:function(){return rt()},set:function(n){rt(n);i(u._tileset)&&(u._tileset.debugFreezeFrame=n,u._scene.debugShowFrustumPlanes=n,u._scene.requestRender())}});this.freezeFrame=!1;c=a.observable();a.defineProperty(this,"showOnlyPickedTileDebugLabel",{get:function(){return c()},set:function(n){c(n);i(u._tileset)&&(u._tileset.debugPickedTileLabelOnly=n,u._scene.requestRender())}});this.showOnlyPickedTileDebugLabel=!1;ut=a.observable();a.defineProperty(this,"showGeometricError",{get:function(){return ut()},set:function(n){ut(n);i(u._tileset)&&(u._tileset.debugShowGeometricError=n,u._scene.requestRender())}});this.showGeometricError=!1;ft=a.observable();a.defineProperty(this,"showRenderingStatistics",{get:function(){return ft()},set:function(n){ft(n);i(u._tileset)&&(u._tileset.debugShowRenderingStatistics=n,u._scene.requestRender())}});this.showRenderingStatistics=!1;et=a.observable();a.defineProperty(this,"showMemoryUsage",{get:function(){return et()},set:function(n){et(n);i(u._tileset)&&(u._tileset.debugShowMemoryUsage=n,u._scene.requestRender())}});this.showMemoryUsage=!1;ot=a.observable();a.defineProperty(this,"showUrl",{get:function(){return ot()},set:function(n){ot(n);i(u._tileset)&&(u._tileset.debugShowUrl=n,u._scene.requestRender())}});this.showUrl=!1;st=a.observable();a.defineProperty(this,"maximumScreenSpaceError",{get:function(){return st()},set:function(n){n=Number(n);isNaN(n)||(st(n),i(u._tileset)&&(u._tileset.maximumScreenSpaceError=n))}});this.maximumScreenSpaceError=16;h=a.observable();a.defineProperty(this,"dynamicScreenSpaceErrorDensity",{get:function(){return h()},set:function(n){n=Number(n);isNaN(n)||(h(n),i(u._tileset)&&(u._tileset.dynamicScreenSpaceErrorDensity=n))}});this.dynamicScreenSpaceErrorDensity=.00278;this.dynamicScreenSpaceErrorDensitySliderValue=undefined;a.defineProperty(this,"dynamicScreenSpaceErrorDensitySliderValue",{get:function(){return Math.pow(h(),1/6)},set:function(n){h(Math.pow(n,6))}});ht=a.observable();a.defineProperty(this,"dynamicScreenSpaceErrorFactor",{get:function(){return ht()},set:function(n){n=Number(n);isNaN(n)||(ht(n),i(u._tileset)&&(u._tileset.dynamicScreenSpaceErrorFactor=n))}});this.dynamicScreenSpaceErrorFactor=4;ri=g(this);ct=a.observable();a.defineProperty(this,"pickActive",{get:function(){return ct()},set:function(n){ct(n);n?u._eventHandler.setInputAction(ri,e.LEFT_CLICK):u._eventHandler.removeInputAction(e.LEFT_CLICK)}});lt=a.observable();a.defineProperty(this,"pointCloudShading",{get:function(){return lt()},set:function(n){lt(n);i(u._tileset)&&(u._tileset.pointCloudShading.attenuation=n)}});this.pointCloudShading=!1;at=a.observable();a.defineProperty(this,"geometricErrorScale",{get:function(){return at()},set:function(n){n=Number(n);isNaN(n)||(at(n),i(u._tileset)&&(u._tileset.pointCloudShading.geometricErrorScale=n))}});this.geometricErrorScale=1;vt=a.observable();a.defineProperty(this,"maximumAttenuation",{get:function(){return vt()},set:function(n){n=Number(n);isNaN(n)||(vt(n),i(u._tileset)&&(u._tileset.pointCloudShading.maximumAttenuation=n===0?undefined:n))}});this.maximumAttenuation=0;yt=a.observable();a.defineProperty(this,"baseResolution",{get:function(){return yt()},set:function(n){n=Number(n);isNaN(n)||(yt(n),i(u._tileset)&&(u._tileset.pointCloudShading.baseResolution=n===0?undefined:n))}});this.baseResolution=0;pt=a.observable();a.defineProperty(this,"eyeDomeLighting",{get:function(){return pt()},set:function(n){pt(n);i(u._tileset)&&(u._tileset.pointCloudShading.eyeDomeLighting=n)}});this.eyeDomeLighting=!1;wt=a.observable();a.defineProperty(this,"eyeDomeLightingStrength",{get:function(){return wt()},set:function(n){n=Number(n);isNaN(n)||(wt(n),i(u._tileset)&&(u._tileset.pointCloudShading.eyeDomeLightingStrength=n))}});this.eyeDomeLightingStrength=1;bt=a.observable();a.defineProperty(this,"eyeDomeLightingRadius",{get:function(){return bt()},set:function(n){n=Number(n);isNaN(n)||(bt(n),i(u._tileset)&&(u._tileset.pointCloudShading.eyeDomeLightingRadius=n))}});this.eyeDomeLightingRadius=1;this.pickActive=!1;kt=a.observable();a.defineProperty(this,"skipLevelOfDetail",{get:function(){return kt()},set:function(n){kt(n);i(u._tileset)&&(u._tileset.skipLevelOfDetail=n)}});this.skipLevelOfDetail=!0;dt=a.observable();a.defineProperty(this,"skipScreenSpaceErrorFactor",{get:function(){return dt()},set:function(n){n=Number(n);isNaN(n)||(dt(n),i(u._tileset)&&(u._tileset.skipScreenSpaceErrorFactor=n))}});this.skipScreenSpaceErrorFactor=16;gt=a.observable();a.defineProperty(this,"baseScreenSpaceError",{get:function(){return gt()},set:function(n){n=Number(n);isNaN(n)||(gt(n),i(u._tileset)&&(u._tileset.baseScreenSpaceError=n))}});this.baseScreenSpaceError=1024;ni=a.observable();a.defineProperty(this,"skipLevels",{get:function(){return ni()},set:function(n){n=Number(n);isNaN(n)||(ni(n),i(u._tileset)&&(u._tileset.skipLevels=n))}});this.skipLevels=1;ti=a.observable();a.defineProperty(this,"immediatelyLoadDesiredLevelOfDetail",{get:function(){return ti()},set:function(n){ti(n);i(u._tileset)&&(u._tileset.immediatelyLoadDesiredLevelOfDetail=n)}});this.immediatelyLoadDesiredLevelOfDetail=!1;ii=a.observable();a.defineProperty(this,"loadSiblings",{get:function(){return ii()},set:function(n){ii(n);i(u._tileset)&&(u._tileset.loadSiblings=n)}});this.loadSiblings=!1;this._style=undefined;this._shouldStyle=!1;this._definedProperties=["properties","dynamicScreenSpaceError","colorBlendMode","picking","colorize","wireframe","showBoundingVolumes","showContentBoundingVolumes","showRequestVolumes","freezeFrame","maximumScreenSpaceError","dynamicScreenSpaceErrorDensity","baseScreenSpaceError","skipScreenSpaceErrorFactor","skipLevelOfDetail","skipLevels","immediatelyLoadDesiredLevelOfDetail","loadSiblings","dynamicScreenSpaceErrorDensitySliderValue","dynamicScreenSpaceErrorFactor","pickActive","showOnlyPickedTileDebugLabel","showGeometricError","showRenderingStatistics","showMemoryUsage","showUrl","pointCloudShading","geometricErrorScale","maximumAttenuation","baseResolution","eyeDomeLighting","eyeDomeLightingStrength","eyeDomeLightingRadius"];this._removePostRenderEvent=t.postRender.addEventListener(function(){u._update()});i(this._tileset)||k(this,!0)}function b(n){var t,u,r;if(n.featuresLength>0)return!0;if(t=n.innerContents,i(t)){for(u=t.length,r=0;r<u;++r)if(!b(t[r]))return!1;return!0}return!1}var nt={maximumFractionDigits:3},tt=[{text:"Highlight",value:o.HIGHLIGHT},{text:"Replace",value:o.REPLACE},{text:"Mix",value:o.MIX}],d=new t(1,1,0,.4),it=new t,p=new t;return r(v.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},statisticsText:{get:function(){return this._statisticsText}},pickStatisticsText:{get:function(){return this._pickStatisticsText}},colorBlendModes:{get:function(){return tt}},editorError:{get:function(){return this._editorError}},tileset:{get:function(){return this._tileset},set:function(n){var u,f,o,r,e,t;if(this._tileset=n,this._style=undefined,this.styleString="{}",this.feature=undefined,this.tile=undefined,i(n)){for(u=this,n.readyPromise.then(function(n){u.isDestroyed()||u._properties(n.properties)}),f=["colorize","wireframe","showBoundingVolumes","showContentBoundingVolumes","showRequestVolumes","freezeFrame","showOnlyPickedTileDebugLabel","showGeometricError","showRenderingStatistics","showMemoryUsage","showUrl"],o=f.length,r=0;r<o;++r)e=f[r],this[e]=this[e];this.maximumScreenSpaceError=n.maximumScreenSpaceError;this.dynamicScreenSpaceError=n.dynamicScreenSpaceError;this.dynamicScreenSpaceErrorDensity=n.dynamicScreenSpaceErrorDensity;this.dynamicScreenSpaceErrorFactor=n.dynamicScreenSpaceErrorFactor;this.colorBlendMode=n.colorBlendMode;this.skipLevelOfDetail=n.skipLevelOfDetail;this.skipScreenSpaceErrorFactor=n.skipScreenSpaceErrorFactor;this.baseScreenSpaceError=n.baseScreenSpaceError;this.skipLevels=n.skipLevels;this.immediatelyLoadDesiredLevelOfDetail=n.immediatelyLoadDesiredLevelOfDetail;this.loadSiblings=n.loadSiblings;t=n.pointCloudShading;this.pointCloudShading=t.attenuation;this.geometricErrorScale=t.geometricErrorScale;this.maximumAttenuation=t.maximumAttenuation?t.maximumAttenuation:0;this.baseResolution=t.baseResolution?t.baseResolution:0;this.eyeDomeLighting=t.eyeDomeLighting;this.eyeDomeLightingStrength=t.eyeDomeLightingStrength;this.eyeDomeLightingRadius=t.eyeDomeLightingRadius;this._scene.requestRender()}else this._properties({});this._statisticsText=y(n,!1);this._pickStatisticsText=y(n,!0);k(this,!1)}},feature:{get:function(){return this._feature},set:function(n){if(this._feature!==n){var r=this._feature;i(r)&&!r.content.isDestroyed()&&(r.color=!this.colorize&&i(this._style)?i(this._style.color)?this._style.color.evaluateColor(r,it):t.WHITE:p,this._scene.requestRender());i(n)&&(t.clone(n.color,p),n.color=d,this._scene.requestRender());this._feature=n}}},tile:{get:function(){return this._tile},set:function(n){if(this._tile!==n){var r=this._tile;!i(r)||r.isDestroyed()||b(r.content)||(r.color=p,this._scene.requestRender());i(n)&&!b(n.content)&&(t.clone(n.color,p),n.color=d,this._scene.requestRender());this._tile=n}}}}),v.prototype.togglePickTileset=function(){this.pickActive=!this.pickActive},v.prototype.toggleInspector=function(){this.inspectorVisible=!this.inspectorVisible},v.prototype.toggleTileset=function(){this.tilesetVisible=!this.tilesetVisible},v.prototype.toggleDisplay=function(){this.displayVisible=!this.displayVisible},v.prototype.toggleUpdate=function(){this.updateVisible=!this.updateVisible},v.prototype.toggleLogging=function(){this.loggingVisible=!this.loggingVisible},v.prototype.toggleStyle=function(){this.styleVisible=!this.styleVisible},v.prototype.toggleTileDebugLabels=function(){this.tileDebugLabelsVisible=!this.tileDebugLabelsVisible},v.prototype.toggleOptimization=function(){this.optimizationVisible=!this.optimizationVisible},v.prototype.trimTilesCache=function(){i(this._tileset)&&this._tileset.trimLoadedTiles()},v.prototype.compileStyle=function(){var n=this._tileset;if(i(n)&&this.styleString!==JSON.stringify(n.style)){this._editorError="";try{this.styleString.length===0&&(this.styleString="{}");this._style=new c(JSON.parse(this.styleString));this._shouldStyle=!0;this._scene.requestRender()}catch(t){this._editorError=t.toString()}this.feature=this._feature;this.tile=this._tile}},v.prototype.styleEditorKeyPress=function(n,t){var h;if(t.keyCode===9){t.preventDefault();var u=t.target,e=u.selectionStart,o=u.selectionEnd,f=o,c=u.value.slice(e,o),r=c.split("\n"),s=r.length,i;if(t.shiftKey)for(i=0;i<s;++i)r[i][0]===" "&&(r[i][1]===" "?(r[i]=r[i].substr(2),f-=2):(r[i]=r[i].substr(1),f-=1));else for(i=0;i<s;++i)r[i]="  "+r[i],f+=2;h=r.join("\n");u.value=u.value.slice(0,e)+h+u.value.slice(o);u.selectionStart=e!==o?e:f;u.selectionEnd=f}else t.ctrlKey&&(t.keyCode===10||t.keyCode===13)&&this.compileStyle();return!0},v.prototype._update=function(){var n=this._tileset,t;if(this.performance&&this._performanceDisplay.update(),i(n)){if(n.isDestroyed()){this.tile=undefined;this.feature=undefined;this.tileset=undefined;return}t=n.style;this._style!==n.style&&(this._shouldStyle?(n.style=this._style,this._shouldStyle=!1):(this._style=t,this.styleString=JSON.stringify(t.style,null,"  ")))}this.showStatistics&&(this._statisticsText=y(n,!1),this._pickStatisticsText=y(n,!0))},v.prototype.isDestroyed=function(){return!1},v.prototype.destroy=function(){this._eventHandler.destroy();this._removePostRenderEvent();var n=this;return this._definedProperties.forEach(function(t){a.getObservable(n,t).dispose()}),u(this)},v.getStatistics=y,v});t("Widgets/Cesium3DTilesInspector/Cesium3DTilesInspector",["../../Core/Check","../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../ThirdParty/knockout","../getElement","../InspectorShared","./Cesium3DTilesInspectorViewModel"],function(n,t,i,r,u,f,e,o,s){"use strict";function c(t,i){var c,tt,ht,k,u,ft,ct,a,g,lt,nt,et,ot,v,at,vt,bt,st,yt,pt,wt;n.defined("container",t);n.typeOf.object("scene",i);t=e(t);c=document.createElement("div");tt=document.createElement("div");tt.setAttribute("data-bind","visible: performance");ht=new s(i,tt);this._viewModel=ht;this._container=t;this._element=c;k=document.createElement("div");k.textContent="3D Tiles Inspector";k.className="cesium-cesiumInspector-button";k.setAttribute("data-bind","click: toggleInspector");c.appendChild(k);c.className="cesium-cesiumInspector cesium-3DTilesInspector";c.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : inspectorVisible, "cesium-cesiumInspector-hidden" : !inspectorVisible}');t.appendChild(c);u=document.createElement("div");this._panel=u;u.className="cesium-cesiumInspector-dropDown";c.appendChild(u);var y=o.createSection,r=o.createCheckbox,it=y(u,"Tileset","tilesetVisible","toggleTileset"),p=y(u,"Display","displayVisible","toggleDisplay"),rt=y(u,"Update","updateVisible","toggleUpdate"),w=y(u,"Logging","loggingVisible","toggleLogging"),d=y(u,"Tile Debug Labels","tileDebugLabelsVisible","toggleTileDebugLabels"),kt=y(u,"Style","styleVisible","toggleStyle"),b=y(u,"Optimization","optimizationVisible","toggleOptimization"),ut=document.createElement("div");ut.className="field-group";ft=document.createElement("label");ft.className="field-label";ft.appendChild(document.createTextNode("Properties: "));ct=document.createElement("div");ct.setAttribute("data-bind","text: properties");ut.appendChild(ft);ut.appendChild(ct);it.appendChild(ut);it.appendChild(l("togglePickTileset","Pick Tileset","pickActive"));it.appendChild(l("trimTilesCache","Trim Tiles Cache"));it.appendChild(r("Enable Picking","picking"));p.appendChild(r("Colorize","colorize"));p.appendChild(r("Wireframe","wireframe"));p.appendChild(r("Bounding Volumes","showBoundingVolumes"));p.appendChild(r("Content Volumes","showContentBoundingVolumes"));p.appendChild(r("Request Volumes","showRequestVolumes"));p.appendChild(r("Point Cloud Shading","pointCloudShading"));a=document.createElement("div");a.setAttribute("data-bind","visible: pointCloudShading");a.appendChild(h("geometricErrorScale",0,2,.01,"Geometric Error Scale"));a.appendChild(h("maximumAttenuation",0,32,1,"Maximum Attenuation"));a.appendChild(h("baseResolution",0,1,.01,"Base Resolution"));a.appendChild(r("Eye Dome Lighting (EDL)","eyeDomeLighting"));p.appendChild(a);g=document.createElement("div");g.setAttribute("data-bind","visible: eyeDomeLighting");g.appendChild(h("eyeDomeLightingStrength",0,2,.1,"EDL Strength"));g.appendChild(h("eyeDomeLightingRadius",0,4,.1,"EDL Radius"));a.appendChild(g);rt.appendChild(r("Freeze Frame","freezeFrame"));rt.appendChild(r("Dynamic Screen Space Error","dynamicScreenSpaceError"));lt=document.createElement("div");lt.appendChild(h("maximumScreenSpaceError",0,128,1,"Maximum Screen Space Error"));rt.appendChild(lt);nt=document.createElement("div");nt.setAttribute("data-bind","visible: dynamicScreenSpaceError");nt.appendChild(h("dynamicScreenSpaceErrorDensitySliderValue",0,1,.005,"Screen Space Error Density","dynamicScreenSpaceErrorDensity"));nt.appendChild(h("dynamicScreenSpaceErrorFactor",1,10,.1,"Screen Space Error Factor"));rt.appendChild(nt);w.appendChild(r("Performance","performance"));w.appendChild(tt);w.appendChild(r("Statistics","showStatistics"));et=document.createElement("div");et.className="cesium-3dTilesInspector-statistics";et.setAttribute("data-bind","html: statisticsText, visible: showStatistics");w.appendChild(et);w.appendChild(r("Pick Statistics","showPickStatistics"));ot=document.createElement("div");ot.className="cesium-3dTilesInspector-statistics";ot.setAttribute("data-bind","html: pickStatisticsText, visible: showPickStatistics");w.appendChild(ot);v=document.createElement("div");kt.appendChild(v);v.appendChild(document.createTextNode("Color Blend Mode: "));at=document.createElement("select");at.setAttribute("data-bind",'options: colorBlendModes, optionsText: "text", optionsValue: "value", value: colorBlendMode');v.appendChild(at);vt=document.createElement("textarea");vt.setAttribute("data-bind","textInput: styleString, event: { keydown: styleEditorKeyPress }");v.className="cesium-cesiumInspector-styleEditor";v.appendChild(vt);bt=l("compileStyle","Compile (Ctrl+Enter)");v.appendChild(bt);st=document.createElement("div");st.className="cesium-cesiumInspector-error";st.setAttribute("data-bind","text: editorError");v.appendChild(st);d.appendChild(r("Show Picked Only","showOnlyPickedTileDebugLabel"));d.appendChild(r("Geometric Error","showGeometricError"));d.appendChild(r("Rendering Statistics","showRenderingStatistics"));d.appendChild(r("Memory Usage (MB)","showMemoryUsage"));d.appendChild(r("Url","showUrl"));b.appendChild(r("Skip Tile LODs","skipLevelOfDetail"));yt=document.createElement("div");yt.appendChild(h("skipScreenSpaceErrorFactor",1,50,1,"Skip SSE Factor"));b.appendChild(yt);pt=document.createElement("div");pt.appendChild(h("baseScreenSpaceError",0,4096,1,"SSE before skipping LOD"));b.appendChild(pt);wt=document.createElement("div");wt.appendChild(h("skipLevels",0,10,1,"Min. levels to skip"));b.appendChild(wt);b.appendChild(r("Load only tiles that meet the max SSE.","immediatelyLoadDesiredLevelOfDetail"));b.appendChild(r("Load siblings of visible tiles","loadSiblings"));f.applyBindings(ht,c)}function h(n,i,r,u,f,e){var h,o,c,s;return e=t(e,n),h=document.createElement("input"),h.setAttribute("data-bind","value: "+e),h.type="number",o=document.createElement("input"),o.type="range",o.min=i,o.max=r,o.step=u,o.setAttribute("data-bind",'valueUpdate: "input", value: '+n),c=document.createElement("div"),c.appendChild(o),s=document.createElement("div"),s.className="cesium-cesiumInspector-slider",s.appendChild(document.createTextNode(f)),s.appendChild(h),s.appendChild(c),s}function l(n,t,r){var u=document.createElement("button"),f;return u.type="button",u.textContent=t,u.className="cesium-cesiumInspector-pickButton",f="click: "+n,i(r)&&(f+=', css: {"cesium-cesiumInspector-pickButtonHighlight" : '+r+"}"),u.setAttribute("data-bind",f),u}return r(c.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return f.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),u(this)},c});t("Widgets/CesiumInspector/CesiumInspectorViewModel",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/Rectangle","../../Core/ScreenSpaceEventHandler","../../Core/ScreenSpaceEventType","../../Scene/DebugModelMatrixPrimitive","../../Scene/PerformanceDisplay","../../Scene/TileCoordinatesImageryProvider","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function y(t){var r,u,f,e,o,s,i,h;if(n(t)){r="Command Statistics";u=t.commandsInFrustums;for(f in u)if(u.hasOwnProperty(f)){if(e=parseInt(f,10),e===7)o="1, 2 and 3";else{for(s=[],i=2;i>=0;i--)h=Math.pow(2,i),e>=h&&(s.push(i+1),e-=h);o=s.reverse().join(" and ")}r+="<br>&nbsp;&nbsp;&nbsp;&nbsp;"+u[f]+" in frustum "+o}r+="<br>Total: "+t.totalCommands}return r}function v(n,t,i){var r=Math.min(i,t);return Math.max(r,n)}function a(t,i){function k(t){var i=a._scene.pick({x:t.position.x,y:t.position.y});n(i)&&(a.primitive=n(i.collection)?i.collection:i.primitive);a._scene.requestRender();a.pickPrimitiveActive=!1}function d(t){var i,h=y.ellipsoid,c=a._scene.camera.pickEllipsoid({x:t.position.x,y:t.position.y},h),l,o,r,f,e,s;if(n(c))for(l=h.cartesianToCartographic(c),o=y._surface.tileProvider._tilesToRenderByTextureCount,r=0;!i&&r<o.length;++r)if(f=o[r],n(f))for(e=0;!i&&e<f.length;++e)s=f[e],u.contains(s.rectangle,l)&&(i=s);a.tile=i;a.pickTileActive=!1}var y,w;if(!n(t))throw new r("scene is required");if(!n(i))throw new r("performanceContainer is required");var a=this,b=t.canvas,p=new f(b);this._eventHandler=p;this._scene=t;this._canvas=b;this._primitive=undefined;this._tile=undefined;this._modelMatrixPrimitive=undefined;this._performanceDisplay=undefined;this._performanceContainer=i;y=this._scene.globe;y.depthTestAgainstTerrain=!0;this.frustums=!1;this.frustumPlanes=!1;this.performance=!1;this.shaderCacheText="";this.primitiveBoundingSphere=!1;this.primitiveReferenceFrame=!1;this.filterPrimitive=!1;this.tileBoundingSphere=!1;this.filterTile=!1;this.wireframe=!1;this.globeDepth=!1;this.pickDepth=!1;this.depthFrustum=1;this._numberOfFrustums=1;this.suspendUpdates=!1;this.tileCoordinates=!1;this.frustumStatisticText=!1;this.tileText="";this.hasPickedPrimitive=!1;this.hasPickedTile=!1;this.pickPrimitiveActive=!1;this.pickTileActive=!1;this.dropDownVisible=!0;this.generalVisible=!0;this.primitivesVisible=!1;this.terrainVisible=!1;this.depthFrustumText="";c.track(this,["frustums","frustumPlanes","performance","shaderCacheText","primitiveBoundingSphere","primitiveReferenceFrame","filterPrimitive","tileBoundingSphere","filterTile","wireframe","globeDepth","pickDepth","depthFrustum","suspendUpdates","tileCoordinates","frustumStatisticText","tileText","hasPickedPrimitive","hasPickedTile","pickPrimitiveActive","pickTileActive","dropDownVisible","generalVisible","primitivesVisible","terrainVisible","depthFrustumText"]);this._toggleDropDown=l(function(){a.dropDownVisible=!a.dropDownVisible});this._toggleGeneral=l(function(){a.generalVisible=!a.generalVisible});this._togglePrimitives=l(function(){a.primitivesVisible=!a.primitivesVisible});this._toggleTerrain=l(function(){a.terrainVisible=!a.terrainVisible});this._frustumsSubscription=c.getObservable(this,"frustums").subscribe(function(n){a._scene.debugShowFrustums=n;a._scene.requestRender()});this._frustumPlanesSubscription=c.getObservable(this,"frustumPlanes").subscribe(function(n){a._scene.debugShowFrustumPlanes=n;a._scene.requestRender()});this._performanceSubscription=c.getObservable(this,"performance").subscribe(function(n){n?a._performanceDisplay=new s({container:a._performanceContainer}):a._performanceContainer.innerHTML=""});this._showPrimitiveBoundingSphere=l(function(){return a._primitive.debugShowBoundingVolume=a.primitiveBoundingSphere,a._scene.requestRender(),!0});this._primitiveBoundingSphereSubscription=c.getObservable(this,"primitiveBoundingSphere").subscribe(function(){a._showPrimitiveBoundingSphere()});this._showPrimitiveReferenceFrame=l(function(){if(a.primitiveReferenceFrame){var t=a._primitive.modelMatrix;a._modelMatrixPrimitive=new o({modelMatrix:t});a._scene.primitives.add(a._modelMatrixPrimitive)}else n(a._modelMatrixPrimitive)&&(a._scene.primitives.remove(a._modelMatrixPrimitive),a._modelMatrixPrimitive=undefined);return a._scene.requestRender(),!0});this._primitiveReferenceFrameSubscription=c.getObservable(this,"primitiveReferenceFrame").subscribe(function(){a._showPrimitiveReferenceFrame()});this._doFilterPrimitive=l(function(){return a._scene.debugCommandFilter=a.filterPrimitive?function(t){return n(a._modelMatrixPrimitive)&&t.owner===a._modelMatrixPrimitive._primitive?!0:n(a._primitive)?t.owner===a._primitive||t.owner===a._primitive._billboardCollection||t.owner.primitive===a._primitive:!1}:undefined,!0});this._filterPrimitiveSubscription=c.getObservable(this,"filterPrimitive").subscribe(function(){a._doFilterPrimitive();a._scene.requestRender()});this._wireframeSubscription=c.getObservable(this,"wireframe").subscribe(function(n){y._surface.tileProvider._debug.wireframe=n;a._scene.requestRender()});this._globeDepthSubscription=c.getObservable(this,"globeDepth").subscribe(function(n){a._scene.debugShowGlobeDepth=n;a._scene.requestRender()});this._pickDepthSubscription=c.getObservable(this,"pickDepth").subscribe(function(n){a._scene.debugShowPickDepth=n;a._scene.requestRender()});this._depthFrustumSubscription=c.getObservable(this,"depthFrustum").subscribe(function(n){a._scene.debugShowDepthFrustum=n;a._scene.requestRender()});this._incrementDepthFrustum=l(function(){var n=a.depthFrustum+1;return a.depthFrustum=v(1,a._numberOfFrustums,n),a._scene.requestRender(),!0});this._decrementDepthFrustum=l(function(){var n=a.depthFrustum-1;return a.depthFrustum=v(1,a._numberOfFrustums,n),a._scene.requestRender(),!0});this._suspendUpdatesSubscription=c.getObservable(this,"suspendUpdates").subscribe(function(n){y._surface._debug.suspendLodUpdate=n;n||(a.filterTile=!1)});this._showTileCoordinates=l(function(){return a.tileCoordinates&&!n(w)?w=t.imageryLayers.addImageryProvider(new h({tilingScheme:t.terrainProvider.tilingScheme})):!a.tileCoordinates&&n(w)&&(t.imageryLayers.remove(w),w=undefined),!0});this._tileCoordinatesSubscription=c.getObservable(this,"tileCoordinates").subscribe(function(){a._showTileCoordinates();a._scene.requestRender()});this._tileBoundingSphereSubscription=c.getObservable(this,"tileBoundingSphere").subscribe(function(){a._showTileBoundingSphere();a._scene.requestRender()});this._showTileBoundingSphere=l(function(){return y._surface.tileProvider._debug.boundingSphereTile=a.tileBoundingSphere?a._tile:undefined,a._scene.requestRender(),!0});this._doFilterTile=l(function(){return a.filterTile?(a.suspendUpdates=!0,y._surface._tilesToRender=[],n(a._tile)&&a._tile.renderable&&y._surface._tilesToRender.push(a._tile)):a.suspendUpdates=!1,!0});this._filterTileSubscription=c.getObservable(this,"filterTile").subscribe(function(){a.doFilterTile();a._scene.requestRender()});this._pickPrimitive=l(function(){a.pickPrimitiveActive=!a.pickPrimitiveActive});this._pickPrimitiveActiveSubscription=c.getObservable(this,"pickPrimitiveActive").subscribe(function(n){n?p.setInputAction(k,e.LEFT_CLICK):p.removeInputAction(e.LEFT_CLICK)});this._pickTile=l(function(){a.pickTileActive=!a.pickTileActive});this._pickTileActiveSubscription=c.getObservable(this,"pickTileActive").subscribe(function(n){n?p.setInputAction(d,e.LEFT_CLICK):p.removeInputAction(e.LEFT_CLICK)});this._removePostRenderEvent=t.postRender.addEventListener(function(){a._update()})}return t(a.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},toggleDropDown:{get:function(){return this._toggleDropDown}},showPrimitiveBoundingSphere:{get:function(){return this._showPrimitiveBoundingSphere}},showPrimitiveReferenceFrame:{get:function(){return this._showPrimitiveReferenceFrame}},doFilterPrimitive:{get:function(){return this._doFilterPrimitive}},incrementDepthFrustum:{get:function(){return this._incrementDepthFrustum}},decrementDepthFrustum:{get:function(){return this._decrementDepthFrustum}},showTileCoordinates:{get:function(){return this._showTileCoordinates}},showTileBoundingSphere:{get:function(){return this._showTileBoundingSphere}},doFilterTile:{get:function(){return this._doFilterTile}},toggleGeneral:{get:function(){return this._toggleGeneral}},togglePrimitives:{get:function(){return this._togglePrimitives}},toggleTerrain:{get:function(){return this._toggleTerrain}},pickPrimitive:{get:function(){return this._pickPrimitive}},pickTile:{get:function(){return this._pickTile}},selectParent:{get:function(){var n=this;return l(function(){n.tile=n.tile.parent})}},selectNW:{get:function(){var n=this;return l(function(){n.tile=n.tile.northwestChild})}},selectNE:{get:function(){var n=this;return l(function(){n.tile=n.tile.northeastChild})}},selectSW:{get:function(){var n=this;return l(function(){n.tile=n.tile.southwestChild})}},selectSE:{get:function(){var n=this;return l(function(){n.tile=n.tile.southeastChild})}},primitive:{get:function(){return this._primitive},set:function(t){var i=this._primitive;t!==i&&(this.hasPickedPrimitive=!0,n(i)&&(i.debugShowBoundingVolume=!1),this._scene.debugCommandFilter=undefined,n(this._modelMatrixPrimitive)&&(this._scene.primitives.remove(this._modelMatrixPrimitive),this._modelMatrixPrimitive=undefined),this._primitive=t,t.show=!1,setTimeout(function(){t.show=!0},50),this.showPrimitiveBoundingSphere(),this.showPrimitiveReferenceFrame(),this.doFilterPrimitive())}},tile:{get:function(){return this._tile},set:function(t){var r,i;n(t)?(this.hasPickedTile=!0,r=this._tile,t!==r&&(this.tileText="L: "+t.level+" X: "+t.x+" Y: "+t.y,this.tileText+="<br>SW corner: "+t.rectangle.west+", "+t.rectangle.south,this.tileText+="<br>NE corner: "+t.rectangle.east+", "+t.rectangle.north,i=t.data,this.tileText+=n(i)?"<br>Min: "+i.minimumHeight+" Max: "+i.maximumHeight:"<br>(Tile is not loaded)"),this._tile=t,this.showTileBoundingSphere(),this.doFilterTile()):(this.hasPickedTile=!1,this._tile=undefined)}}}),a.prototype._update=function(){this.frustums&&(this.frustumStatisticText=y(this._scene.debugFrustumStatistics));var n=this._scene.numberOfFrustums;this._numberOfFrustums=n;this.depthFrustum=v(1,n,this.depthFrustum);this.depthFrustumText=this.depthFrustum+" of "+n;this.performance&&this._performanceDisplay.update();this.primitiveReferenceFrame&&(this._modelMatrixPrimitive.modelMatrix=this._primitive.modelMatrix);this.shaderCacheText="Cached shaders: "+this._scene.context.shaderCache.numberOfShaders},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return this._eventHandler.destroy(),this._removePostRenderEvent(),this._frustumsSubscription.dispose(),this._frustumPlanesSubscription.dispose(),this._performanceSubscription.dispose(),this._primitiveBoundingSphereSubscription.dispose(),this._primitiveReferenceFrameSubscription.dispose(),this._filterPrimitiveSubscription.dispose(),this._wireframeSubscription.dispose(),this._globeDepthSubscription.dispose(),this._pickDepthSubscription.dispose(),this._depthFrustumSubscription.dispose(),this._suspendUpdatesSubscription.dispose(),this._tileCoordinatesSubscription.dispose(),this._tileBoundingSphereSubscription.dispose(),this._filterTileSubscription.dispose(),this._pickPrimitiveActiveSubscription.dispose(),this._pickTileActiveSubscription.dispose(),i(this)},a});t("Widgets/CesiumInspector/CesiumInspector",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../ThirdParty/knockout","../getElement","../InspectorShared","./CesiumInspectorViewModel"],function(n,t,i,r,u,f,e,o){"use strict";function s(t,i){var ot,vt,y,ft,c,st,w,wt,bt,b,k,ri,l,d,h,et,a,g,v,nt,tt,it,rt,ut,ht,ct,dt,gt,fi,ni,ti;if(!n(t))throw new r("container is required.");if(!n(i))throw new r("scene is required.");t=f(t);ot=document.createElement("div");vt=new o(i,ot);this._viewModel=vt;this._container=t;y=document.createElement("div");this._element=y;ft=document.createElement("div");ft.textContent="Cesium Inspector";ft.className="cesium-cesiumInspector-button";ft.setAttribute("data-bind","click: toggleDropDown");y.appendChild(ft);y.className="cesium-cesiumInspector";y.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : dropDownVisible, "cesium-cesiumInspector-hidden" : !dropDownVisible }');t.appendChild(this._element);c=document.createElement("div");this._panel=c;c.className="cesium-cesiumInspector-dropDown";y.appendChild(c);var yt=e.createSection,s=e.createCheckbox,p=yt(c,"General","generalVisible","toggleGeneral"),ii=s("Show Frustums","frustums"),pt=document.createElement("div");pt.className="cesium-cesiumInspector-frustumStatistics";pt.setAttribute("data-bind","visible: frustums, html: frustumStatisticText");ii.appendChild(pt);p.appendChild(ii);p.appendChild(s("Show Frustum Planes","frustumPlanes"));p.appendChild(s("Performance Display","performance"));ot.className="cesium-cesiumInspector-performanceDisplay";p.appendChild(ot);st=document.createElement("div");st.className="cesium-cesiumInspector-shaderCache";st.setAttribute("data-bind","html: shaderCacheText");p.appendChild(st);w=document.createElement("div");p.appendChild(w);wt=document.createElement("span");wt.setAttribute("data-bind",'html: "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Frustum:"');w.appendChild(wt);bt=document.createElement("span");bt.setAttribute("data-bind","text: depthFrustumText");w.appendChild(bt);b=document.createElement("input");b.type="button";b.value="-";b.className="cesium-cesiumInspector-pickButton";b.setAttribute("data-bind","click: decrementDepthFrustum");w.appendChild(b);k=document.createElement("input");k.type="button";k.value="+";k.className="cesium-cesiumInspector-pickButton";k.setAttribute("data-bind","click: incrementDepthFrustum");w.appendChild(k);ri=yt(c,"Primitives","primitivesVisible","togglePrimitives");l=document.createElement("div");l.className="cesium-cesiumInspector-pickSection";ri.appendChild(l);d=document.createElement("input");d.type="button";d.value="Pick a primitive";d.className="cesium-cesiumInspector-pickButton";d.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickPrimitiveActive}, click: pickPrimitive');h=document.createElement("div");h.className="cesium-cesiumInspector-center";h.appendChild(d);l.appendChild(h);l.appendChild(s("Show bounding sphere","primitiveBoundingSphere","hasPickedPrimitive"));l.appendChild(s("Show reference frame","primitiveReferenceFrame","hasPickedPrimitive"));this._primitiveOnly=s("Show only selected","filterPrimitive","hasPickedPrimitive");l.appendChild(this._primitiveOnly);et=yt(c,"Terrain","terrainVisible","toggleTerrain");a=document.createElement("div");a.className="cesium-cesiumInspector-pickSection";et.appendChild(a);g=document.createElement("input");g.type="button";g.value="Pick a tile";g.className="cesium-cesiumInspector-pickButton";g.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickTileActive}, click: pickTile');h=document.createElement("div");h.appendChild(g);h.className="cesium-cesiumInspector-center";a.appendChild(h);v=document.createElement("div");a.appendChild(v);nt=document.createElement("input");nt.type="button";nt.value="Parent";nt.className="cesium-cesiumInspector-pickButton";nt.setAttribute("data-bind","click: selectParent");tt=document.createElement("input");tt.type="button";tt.value="NW";tt.className="cesium-cesiumInspector-pickButton";tt.setAttribute("data-bind","click: selectNW");it=document.createElement("input");it.type="button";it.value="NE";it.className="cesium-cesiumInspector-pickButton";it.setAttribute("data-bind","click: selectNE");rt=document.createElement("input");rt.type="button";rt.value="SW";rt.className="cesium-cesiumInspector-pickButton";rt.setAttribute("data-bind","click: selectSW");ut=document.createElement("input");ut.type="button";ut.value="SE";ut.className="cesium-cesiumInspector-pickButton";ut.setAttribute("data-bind","click: selectSE");ht=document.createElement("div");ht.className="cesium-cesiumInspector-tileText";v.className="cesium-cesiumInspector-frustumStatistics";v.appendChild(ht);v.setAttribute("data-bind","visible: hasPickedTile");ht.setAttribute("data-bind","html: tileText");ct=document.createElement("div");ct.className="cesium-cesiumInspector-relativeText";ct.textContent="Select relative:";v.appendChild(ct);var kt=document.createElement("table"),lt=document.createElement("tr"),at=document.createElement("tr"),ui=document.createElement("td");ui.appendChild(nt);dt=document.createElement("td");dt.appendChild(tt);gt=document.createElement("td");gt.appendChild(it);lt.appendChild(ui);lt.appendChild(dt);lt.appendChild(gt);fi=document.createElement("td");ni=document.createElement("td");ni.appendChild(rt);ti=document.createElement("td");ti.appendChild(ut);at.appendChild(fi);at.appendChild(ni);at.appendChild(ti);kt.appendChild(lt);kt.appendChild(at);v.appendChild(kt);a.appendChild(s("Show bounding volume","tileBoundingSphere","hasPickedTile"));a.appendChild(s("Show only selected","filterTile","hasPickedTile"));et.appendChild(s("Wireframe","wireframe"));et.appendChild(s("Suspend LOD update","suspendUpdates"));et.appendChild(s("Show tile coordinates","tileCoordinates"));u.applyBindings(vt,this._element)}return t(s.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return u.cleanNode(this._element),this._container.removeChild(this._element),this.viewModel.destroy(),i(this)},s});t("Widgets/CesiumWidget/CesiumWidget",["../../Core/buildModuleUrl","../../Core/Cartesian3","../../Core/Clock","../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/Ellipsoid","../../Core/FeatureDetection","../../Core/formatError","../../Core/requestAnimationFrame","../../Core/ScreenSpaceEventHandler","../../Scene/createWorldImagery","../../Scene/Globe","../../Scene/Moon","../../Scene/Scene","../../Scene/SceneMode","../../Scene/ShadowMode","../../Scene/SkyAtmosphere","../../Scene/SkyBox","../../Scene/Sun","../getElement"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){"use strict";function rt(t){return n("Assets/Textures/SkyBox/tycho2t3_80_"+t+".jpg")}function et(n){function t(r){var f,e,o,s;if(!n.isDestroyed())if(n._useDefaultRenderLoop)try{f=n._targetFrameRate;u(f)?(e=1e3/f,o=r-i,o>e&&(n.resize(),n.render(),i=r-o%e),l(t)):(n.resize(),n.render(),l(t))}catch(h){n._useDefaultRenderLoop=!1;n._renderLoopRunning=!1;n._showRenderLoopErrors&&(s="An error occurred while rendering.  Rendering has stopped.",n.showErrorPanel(s,undefined,h))}else n._renderLoopRunning=!1}n._renderLoopRunning=!0;var i=0;l(t)}function ut(n){var t=n._canvas,i=t.clientWidth,u=t.clientHeight,f=n._resolutionScale;n._supportsImageRenderingPixelated||(f*=r(window.devicePixelRatio,1));n._canvasWidth=i;n._canvasHeight=u;i*=f;u*=f;t.width=i;t.height=u;n._canRender=i!==0&&u!==0}function ft(n){var f=n._canvas,i=f.width,r=f.height,t;i!==0&&r!==0&&(t=n._scene.camera.frustum,u(t.aspectRatio)?t.aspectRatio=i/r:(t.top=t.right*(r/i),t.bottom=-t.top))}function it(n,f){var l,c,lt,it,at,vt,yt,e,pt,et,ot,st,ht,ct,bt,kt;if(!u(n))throw new o("container is required.");n=tt(n);f=r(f,{});l=document.createElement("div");l.className="cesium-widget";n.appendChild(l);c=document.createElement("canvas");lt=h.supportsImageRenderingPixelated();this._supportsImageRenderingPixelated=lt;lt&&(c.style.imageRendering=h.imageRenderingValue());c.oncontextmenu=function(){return!1};c.onselectstart=function(){return!1};l.appendChild(c);it=document.createElement("div");it.className="cesium-widget-credits";at=u(f.creditContainer)?tt(f.creditContainer):l;at.appendChild(it);vt=u(f.creditViewport)?tt(f.creditViewport):l;yt=r(f.showRenderLoopErrors,!0);this._element=l;this._container=n;this._canvas=c;this._canvasWidth=0;this._canvasHeight=0;this._creditViewport=vt;this._creditContainer=at;this._innerCreditContainer=it;this._canRender=!1;this._renderLoopRunning=!1;this._showRenderLoopErrors=yt;this._resolutionScale=1;this._forceResize=!1;this._clock=u(f.clock)?f.clock:new i;ut(this);try{e=new w({canvas:c,contextOptions:f.contextOptions,creditContainer:it,creditViewport:vt,mapProjection:f.mapProjection,orderIndependentTranslucency:f.orderIndependentTranslucency,scene3DOnly:r(f.scene3DOnly,!1),terrainExaggeration:f.terrainExaggeration,shadows:f.shadows,mapMode2D:f.mapMode2D,requestRenderMode:f.requestRenderMode,maximumRenderTimeChange:f.maximumRenderTimeChange});this._scene=e;e.camera.constrainedAxis=t.UNIT_Z;ft(this);pt=r(e.mapProjection.ellipsoid,s.WGS84);et=f.globe;u(et)||(et=new y(pt));et!==!1&&(e.globe=et,e.globe.shadows=r(f.terrainShadows,k.RECEIVE_ONLY));ot=f.skyBox;u(ot)||(ot=new g({sources:{positiveX:rt("px"),negativeX:rt("mx"),positiveY:rt("py"),negativeY:rt("my"),positiveZ:rt("pz"),negativeZ:rt("mz")}}));ot!==!1&&(e.skyBox=ot,e.sun=new nt,e.moon=new p);st=f.skyAtmosphere;u(st)||(st=new d(pt));st!==!1&&(e.skyAtmosphere=st);ht=f.globe===!1?!1:f.imageryProvider;u(ht)||(ht=v());ht!==!1&&e.imageryLayers.addImageryProvider(ht);u(f.terrainProvider)&&f.globe!==!1&&(e.terrainProvider=f.terrainProvider);this._screenSpaceEventHandler=new a(c,!1);u(f.sceneMode)&&(f.sceneMode===b.SCENE2D&&this._scene.morphTo2D(0),f.sceneMode===b.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0));this._useDefaultRenderLoop=undefined;this.useDefaultRenderLoop=r(f.useDefaultRenderLoop,!0);this._targetFrameRate=undefined;this.targetFrameRate=f.targetFrameRate;ct=this;e.renderError.addEventListener(function(n,t){if(ct._useDefaultRenderLoop=!1,ct._renderLoopRunning=!1,ct._showRenderLoopErrors)ct.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",undefined,t)})}catch(wt){yt&&(bt="Error constructing CesiumWidget.",kt='Visit <a href="http://get.webgl.org">http://get.webgl.org<\/a> to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:',this.showErrorPanel(bt,kt,wt));throw wt;}}return f(it.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(n){this._scene.terrainProvider=n}},camera:{get:function(){return this._scene.camera}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(n){if(n<=0)throw new o("targetFrameRate must be greater than 0, or undefined.");this._targetFrameRate=n}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(n){this._useDefaultRenderLoop!==n&&(this._useDefaultRenderLoop=n,n&&!this._renderLoopRunning&&et(this))}},resolutionScale:{get:function(){return this._resolutionScale},set:function(n){if(n<=0)throw new o("resolutionScale must be greater than 0.");this._resolutionScale=n;this._forceResize=!0}}}),it.prototype.showErrorPanel=function(n,t,i){function h(){f.style.maxHeight=Math.max(Math.round(p.clientHeight*.9-100),30)+"px"}var p=this._element,o=document.createElement("div"),r,s,f,l,a,v,y,e;o.className="cesium-widget-errorPanel";r=document.createElement("div");r.className="cesium-widget-errorPanel-content";o.appendChild(r);s=document.createElement("div");s.className="cesium-widget-errorPanel-header";s.appendChild(document.createTextNode(n));r.appendChild(s);f=document.createElement("div");f.className="cesium-widget-errorPanel-scroll";r.appendChild(f);h();u(window.addEventListener)&&window.addEventListener("resize",h,!1);u(t)&&(l=document.createElement("div"),l.className="cesium-widget-errorPanel-message",l.innerHTML="<p>"+t+"<\/p>",f.appendChild(l));a="(no error details available)";u(i)&&(a=c(i));v=document.createElement("div");v.className="cesium-widget-errorPanel-message";v.appendChild(document.createTextNode(a));f.appendChild(v);y=document.createElement("div");y.className="cesium-widget-errorPanel-buttonPanel";r.appendChild(y);e=document.createElement("button");e.setAttribute("type","button");e.className="cesium-button";e.appendChild(document.createTextNode("OK"));e.onclick=function(){u(h)&&u(window.removeEventListener)&&window.removeEventListener("resize",h,!1);p.removeChild(o)};y.appendChild(e);p.appendChild(o);typeof console!="undefined"&&console.error(n+"\n"+t+"\n"+a)},it.prototype.isDestroyed=function(){return!1},it.prototype.destroy=function(){this._scene=this._scene&&this._scene.destroy();this._container.removeChild(this._element);this._creditContainer.removeChild(this._innerCreditContainer);e(this)},it.prototype.resize=function(){var n=this._canvas,t=n.clientWidth,i=n.clientHeight;(this._forceResize||this._canvasWidth!==t||this._canvasHeight!==i)&&(this._forceResize=!1,ut(this),ft(this),this._scene.requestRender())},it.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();var n=this._clock.tick();this._scene.render(n)}else this._clock.tick()},it});t("Widgets/ClockViewModel",["../Core/Clock","../Core/defined","../Core/defineProperties","../Core/destroyObject","../Core/EventHelper","../Core/JulianDate","../ThirdParty/knockout"],function(n,t,i,r,u,f,e){"use strict";function o(i){t(i)||(i=new n);this._clock=i;this._eventHelper=new u;this._eventHelper.add(i.onTick,this.synchronize,this);this.systemTime=e.observable(f.now());this.systemTime.equalityComparer=f.equals;this.startTime=e.observable(i.startTime);this.startTime.equalityComparer=f.equals;this.startTime.subscribe(function(n){i.startTime=n;this.synchronize()},this);this.stopTime=e.observable(i.stopTime);this.stopTime.equalityComparer=f.equals;this.stopTime.subscribe(function(n){i.stopTime=n;this.synchronize()},this);this.currentTime=e.observable(i.currentTime);this.currentTime.equalityComparer=f.equals;this.currentTime.subscribe(function(n){i.currentTime=n;this.synchronize()},this);this.multiplier=e.observable(i.multiplier);this.multiplier.subscribe(function(n){i.multiplier=n;this.synchronize()},this);this.clockStep=e.observable(i.clockStep);this.clockStep.subscribe(function(n){i.clockStep=n;this.synchronize()},this);this.clockRange=e.observable(i.clockRange);this.clockRange.subscribe(function(n){i.clockRange=n;this.synchronize()},this);this.canAnimate=e.observable(i.canAnimate);this.canAnimate.subscribe(function(n){i.canAnimate=n;this.synchronize()},this);this.shouldAnimate=e.observable(i.shouldAnimate);this.shouldAnimate.subscribe(function(n){i.shouldAnimate=n;this.synchronize()},this);e.track(this,["systemTime","startTime","stopTime","currentTime","multiplier","clockStep","clockRange","canAnimate","shouldAnimate"])}return i(o.prototype,{clock:{get:function(){return this._clock}}}),o.prototype.synchronize=function(){var n=this._clock;this.systemTime=f.now();this.startTime=n.startTime;this.stopTime=n.stopTime;this.currentTime=n.currentTime;this.multiplier=n.multiplier;this.clockStep=n.clockStep;this.clockRange=n.clockRange;this.canAnimate=n.canAnimate;this.shouldAnimate=n.shouldAnimate},o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){this._eventHelper.removeAll();r(this)},o});t("Widgets/Command",["../Core/DeveloperError"],function(n){"use strict";function t(){this.canExecute=undefined;this.beforeExecute=undefined;this.afterExecute=undefined;n.throwInstantiationError()}return t});t("Widgets/FullscreenButton/FullscreenButtonViewModel",["../../Core/defaultValue","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/Fullscreen","../../ThirdParty/knockout","../createCommand","../getElement"],function(n,t,i,r,u,f,e,o){"use strict";function s(t){var s=this,i=f.observable(u.fullscreen),r=f.observable(u.enabled);this.isFullscreen=undefined;f.defineProperty(this,"isFullscreen",{get:function(){return i()}});this.isFullscreenEnabled=undefined;f.defineProperty(this,"isFullscreenEnabled",{get:function(){return r()},set:function(n){r(n&&u.enabled)}});this.tooltip=undefined;f.defineProperty(this,"tooltip",function(){return this.isFullscreenEnabled?i()?"Exit full screen":"Full screen":"Full screen unavailable"});this._command=e(function(){u.fullscreen?u.exitFullscreen():u.requestFullscreen(s._fullscreenElement)},f.getObservable(this,"isFullscreenEnabled"));this._fullscreenElement=n(o(t),document.body);this._callback=function(){i(u.fullscreen)};document.addEventListener(u.changeEventName,this._callback)}return t(s.prototype,{fullscreenElement:{get:function(){return this._fullscreenElement},set:function(n){if(!(n instanceof Element))throw new r("value must be a valid Element.");this._fullscreenElement=n}},command:{get:function(){return this._command}}}),s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){document.removeEventListener(u.changeEventName,this._callback);i(this)},s});t("Widgets/FullscreenButton/FullscreenButton",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../ThirdParty/knockout","../getElement","./FullscreenButtonViewModel"],function(n,t,i,r,u,f,e){"use strict";function o(t,i){var c,o;if(!n(t))throw new r("container is required.");t=f(t);c=new e(i);c._exitFullScreenPath=h;c._enterFullScreenPath=s;o=document.createElement("button");o.type="button";o.className="cesium-button cesium-fullscreenButton";o.setAttribute("data-bind","attr: { title: tooltip },click: command,enable: isFullscreenEnabled,cesiumSvgPath: { path: isFullscreen ? _exitFullScreenPath : _enterFullScreenPath, width: 128, height: 128 }");t.appendChild(o);u.applyBindings(c,o);this._container=t;this._viewModel=c;this._element=o}var s="M 83.96875 17.5625 L 83.96875 17.59375 L 76.65625 24.875 L 97.09375 24.96875 L 76.09375 45.96875 L 81.9375 51.8125 L 102.78125 30.9375 L 102.875 51.15625 L 110.15625 43.875 L 110.1875 17.59375 L 83.96875 17.5625 z M 44.125 17.59375 L 17.90625 17.625 L 17.9375 43.90625 L 25.21875 51.1875 L 25.3125 30.96875 L 46.15625 51.8125 L 52 45.96875 L 31 25 L 51.4375 24.90625 L 44.125 17.59375 z M 46.0625 76.03125 L 25.1875 96.875 L 25.09375 76.65625 L 17.8125 83.9375 L 17.8125 110.21875 L 44 110.25 L 51.3125 102.9375 L 30.90625 102.84375 L 51.875 81.875 L 46.0625 76.03125 z M 82 76.15625 L 76.15625 82 L 97.15625 103 L 76.71875 103.0625 L 84.03125 110.375 L 110.25 110.34375 L 110.21875 84.0625 L 102.9375 76.8125 L 102.84375 97 L 82 76.15625 z",h="M 104.34375 17.5625 L 83.5 38.4375 L 83.40625 18.21875 L 76.125 25.5 L 76.09375 51.78125 L 102.3125 51.8125 L 102.3125 51.78125 L 109.625 44.5 L 89.1875 44.40625 L 110.1875 23.40625 L 104.34375 17.5625 z M 23.75 17.59375 L 17.90625 23.4375 L 38.90625 44.4375 L 18.5 44.53125 L 25.78125 51.8125 L 52 51.78125 L 51.96875 25.53125 L 44.6875 18.25 L 44.625 38.46875 L 23.75 17.59375 z M 25.6875 76.03125 L 18.375 83.3125 L 38.78125 83.40625 L 17.8125 104.40625 L 23.625 110.25 L 44.5 89.375 L 44.59375 109.59375 L 51.875 102.3125 L 51.875 76.0625 L 25.6875 76.03125 z M 102.375 76.15625 L 76.15625 76.1875 L 76.1875 102.4375 L 83.46875 109.71875 L 83.5625 89.53125 L 104.40625 110.375 L 110.25 104.53125 L 89.25 83.53125 L 109.6875 83.46875 L 102.375 76.15625 z";return t(o.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return this._viewModel.destroy(),u.cleanNode(this._element),this._container.removeChild(this._element),i(this)},o});t("Widgets/Geocoder/GeocoderViewModel",["../../Core/IonGeocoderService","../../Core/CartographicGeocoderService","../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/Event","../../Core/GeocodeType","../../Core/Math","../../Core/Matrix4","../../Core/Rectangle","../../Core/sampleTerrainMostDetailed","../../Scene/computeFlyToLocationForRectangle","../../ThirdParty/knockout","../../ThirdParty/when","../createCommand","../getElement"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";function b(u){var s,h;if(!r(u)||!r(u.scene))throw new f("options.scene is required.");this._geocoderServices=r(u.geocoderServices)?u.geocoderServices:[new t,new n({scene:u.scene})];this._viewContainer=u.container;this._scene=u.scene;this._flightDuration=u.flightDuration;this._searchText="";this._isSearchInProgress=!1;this._geocodePromise=undefined;this._complete=new e;this._suggestions=[];this._selectedSuggestion=undefined;this._showSuggestions=!0;this._handleArrowDown=g;this._handleArrowUp=d;s=this;this._suggestionsVisible=v.pureComputed(function(){var n=v.getObservable(s,"_suggestions"),t=n().length>0,i=v.getObservable(s,"_showSuggestions")();return t&&i});this._searchCommand=p(function(n){if(n=i(n,o.SEARCH),s._focusTextbox=!1,r(s._selectedSuggestion))return s.activateSuggestion(s._selectedSuggestion),!1;s.hideSuggestions();s.isSearchInProgress?ot(s):ft(s,s._geocoderServices,n)});this.deselectSuggestion=function(){s._selectedSuggestion=undefined};this.handleKeyDown=function(n,t){var i=t.key==="ArrowDown"||t.key==="Down"||t.keyCode===40,r=t.key==="ArrowUp"||t.key==="Up"||t.keyCode===38;return(i||r)&&t.preventDefault(),!0};this.handleKeyUp=function(n,t){var i=t.key==="ArrowDown"||t.key==="Down"||t.keyCode===40,r=t.key==="ArrowUp"||t.key==="Up"||t.keyCode===38,u=t.key==="Enter"||t.keyCode===13;return r?d(s):i?g(s):u&&s._searchCommand(),!0};this.activateSuggestion=function(n){s.hideSuggestions();s._searchText=n.displayName;var t=n.destination;tt(s);s.destinationFound(s,t)};this.hideSuggestions=function(){s._showSuggestions=!1;s._selectedSuggestion=undefined};this.showSuggestions=function(){s._showSuggestions=!0};this.handleMouseover=function(n){n!==s._selectedSuggestion&&(s._selectedSuggestion=n)};this.keepExpanded=!1;this.autoComplete=i(u.autocomplete,!0);this.destinationFound=i(u.destinationFound,b.flyToDestination);this._focusTextbox=!1;v.track(this,["_searchText","_isSearchInProgress","keepExpanded","_suggestions","_selectedSuggestion","_showSuggestions","_focusTextbox"]);h=v.getObservable(this,"_searchText");h.extend({rateLimit:{timeout:500}});this._suggestionSubscription=h.subscribe(function(){b._updateSearchSuggestions(s)});this.isSearchInProgress=undefined;v.defineProperty(this,"isSearchInProgress",{get:function(){return this._isSearchInProgress}});this.searchText=undefined;v.defineProperty(this,"searchText",{get:function(){return this.isSearchInProgress?"Searching...":this._searchText},set:function(n){if(typeof n!="string")throw new f("value must be a valid string.");this._searchText=n}});this.flightDuration=undefined;v.defineProperty(this,"flightDuration",{get:function(){return this._flightDuration},set:function(n){if(r(n)&&n<0)throw new f("value must be positive.");this._flightDuration=n}})}function d(n){if(n._suggestions.length!==0){var t,i=n._suggestions.indexOf(n._selectedSuggestion);if(i===-1||i===0){n._selectedSuggestion=undefined;return}t=i-1;n._selectedSuggestion=n._suggestions[t];b._adjustSuggestionsScroll(n,t)}}function g(n){if(n._suggestions.length!==0){var i=n._suggestions.length,r=n._suggestions.indexOf(n._selectedSuggestion),t=(r+1)%i;n._selectedSuggestion=n._suggestions[t];b._adjustSuggestionsScroll(n,t)}}function it(n,t){var i=r(t)?t.availability:undefined;return r(i)?l(t,[n]).then(function(t){return n=t[0],n.height+=k,n}):(n.height+=k,y.resolve(n))}function rt(n,t){var i=n._scene,o=i.mapProjection,f=o.ellipsoid,l=i.camera,v=i.terrainProvider,e=t,u;t instanceof c?s.equalsEpsilon(t.south,t.north,s.EPSILON7)&&s.equalsEpsilon(t.east,t.west,s.EPSILON7)?t=c.center(t):u=a(t,i):t=f.cartesianToCartographic(t);r(u)||(u=it(t,v));u.then(function(n){e=f.cartographicToCartesian(n)}).always(function(){l.flyTo({destination:e,complete:function(){n._complete.raiseEvent()},duration:n._flightDuration,endTransform:h.IDENTITY})})}function ut(n,t,i,u){return n.then(function(n){if(r(n)&&n.state==="fulfilled"&&n.value.length>0)return n;return t.geocode(i,u).then(function(n){return{state:"fulfilled",value:n}}).otherwise(function(n){return{state:"rejected",reason:n}})})}function ft(n,t,i){var e=n._searchText,u,f;if(nt(e)){n.showSuggestions();return}for(n._isSearchInProgress=!0,u=y.resolve(),f=0;f<t.length;f++)u=ut(u,t[f],e,i);n._geocodePromise=u;u.then(function(t){if(!u.cancel){n._isSearchInProgress=!1;var i=t.value;if(t.state==="fulfilled"&&r(i)&&i.length>0){n._searchText=i[0].displayName;n.destinationFound(n,i[0].destination);return}n._searchText=e+" (not found)"}})}function et(n,t){var f=w(n._viewContainer),i=f.getElementsByClassName("search-results")[0],e=f.getElementsByTagName("li"),u=e[t],r;if(t===0){i.scrollTop=0;return}r=u.offsetTop;r+u.clientHeight>i.clientHeight?i.scrollTop=r+u.clientHeight:r<i.scrollTop&&(i.scrollTop=r)}function ot(n){n._isSearchInProgress=!1;r(n._geocodePromise)&&(n._geocodePromise.cancel=!0,n._geocodePromise=undefined)}function nt(n){return/^\s*$/.test(n)}function tt(n){v.getObservable(n,"_suggestions").removeAll()}function st(n){var i,t;n.autoComplete&&((i=n._searchText,tt(n),nt(i))||(t=y.resolve([]),n._geocoderServices.forEach(function(n){t=t.then(function(t){return t.length>=5?t:n.geocode(i,o.AUTOCOMPLETE).then(function(n){return t=t.concat(n)})})}),t.then(function(t){for(var r=n._suggestions,i=0;i<t.length;i++)r.push(t[i])})))}var k=1e3;return u(b.prototype,{complete:{get:function(){return this._complete}},scene:{get:function(){return this._scene}},search:{get:function(){return this._searchCommand}},selectedSuggestion:{get:function(){return this._selectedSuggestion}},suggestions:{get:function(){return this._suggestions}}}),b.prototype.destroy=function(){this._suggestionSubscription.dispose()},b.flyToDestination=rt,b._updateSearchSuggestions=st,b._adjustSuggestionsScroll=et,b});t("Widgets/Geocoder/Geocoder",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/FeatureDetection","../../ThirdParty/knockout","../getElement","./GeocoderViewModel"],function(n,t,i,r,u,f,e,o){"use strict";function s(t){var v,i,l,s,y,a,p,w;if(!n(t)||!n(t.container))throw new r("options.container is required.");if(!n(t.scene))throw new r("options.scene is required.");v=e(t.container);i=new o(t);i._startSearchPath=h;i._stopSearchPath=c;l=document.createElement("form");l.setAttribute("data-bind","submit: search");s=document.createElement("input");s.type="search";s.className="cesium-geocoder-input";s.setAttribute("placeholder","Enter an address or landmark...");s.setAttribute("data-bind",'textInput: searchText,disable: isSearchInProgress,event: { keyup: handleKeyUp, keydown: handleKeyDown, mouseover: deselectSuggestion },css: { "cesium-geocoder-input-wide" : keepExpanded || searchText.length > 0 },hasFocus: _focusTextbox');this._onTextBoxFocus=function(){setTimeout(function(){s.select()},0)};s.addEventListener("focus",this._onTextBoxFocus,!1);l.appendChild(s);this._textBox=s;y=document.createElement("span");y.className="cesium-geocoder-searchButton";y.setAttribute("data-bind","click: search,cesiumSvgPath: { path: isSearchInProgress ? _stopSearchPath : _startSearchPath, width: 32, height: 32 }");l.appendChild(y);v.appendChild(l);a=document.createElement("div");a.className="search-results";a.setAttribute("data-bind","visible: _suggestionsVisible");p=document.createElement("ul");p.setAttribute("data-bind","foreach: _suggestions");w=document.createElement("li");p.appendChild(w);w.setAttribute("data-bind","text: $data.displayName, click: $parent.activateSuggestion, event: { mouseover: $parent.handleMouseover}, css: { active: $data === $parent._selectedSuggestion }");a.appendChild(p);v.appendChild(a);f.applyBindings(i,l);f.applyBindings(i,a);this._container=v;this._searchSuggestionsContainer=a;this._viewModel=i;this._form=l;this._onInputBegin=function(n){v.contains(n.target)||(i._focusTextbox=!1,i.hideSuggestions())};this._onInputEnd=function(n){v.contains(n.target)&&(i._focusTextbox=!0,i.showSuggestions())};u.supportsPointerEvents()?(document.addEventListener("pointerdown",this._onInputBegin,!0),document.addEventListener("pointerup",this._onInputEnd,!0),document.addEventListener("pointercancel",this._onInputEnd,!0)):(document.addEventListener("mousedown",this._onInputBegin,!0),document.addEventListener("mouseup",this._onInputEnd,!0),document.addEventListener("touchstart",this._onInputBegin,!0),document.addEventListener("touchend",this._onInputEnd,!0),document.addEventListener("touchcancel",this._onInputEnd,!0))}var h="M29.772,26.433l-7.126-7.126c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127L29.772,26.433zM7.203,13.885c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486c-0.007,3.58-2.905,6.476-6.484,6.484C10.106,20.361,7.209,17.465,7.203,13.885z",c="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z";return t(s.prototype,{container:{get:function(){return this._container}},searchSuggestionsContainer:{get:function(){return this._searchSuggestionsContainer}},viewModel:{get:function(){return this._viewModel}}}),s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return u.supportsPointerEvents()?(document.removeEventListener("pointerdown",this._onInputBegin,!0),document.removeEventListener("pointerup",this._onInputEnd,!0)):(document.removeEventListener("mousedown",this._onInputBegin,!0),document.removeEventListener("mouseup",this._onInputEnd,!0),document.removeEventListener("touchstart",this._onInputBegin,!0),document.removeEventListener("touchend",this._onInputEnd,!0)),this._viewModel.destroy(),f.cleanNode(this._form),f.cleanNode(this._searchSuggestionsContainer),this._container.removeChild(this._form),this._container.removeChild(this._searchSuggestionsContainer),this._textBox.removeEventListener("focus",this._onTextBoxFocus,!1),i(this)},s});t("Widgets/HomeButton/HomeButtonViewModel",["../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u){"use strict";function f(t,f){if(!n(t))throw new i("scene is required.");this._scene=t;this._duration=f;var e=this;this._command=u(function(){e._scene.camera.flyHome(e._duration)});this.tooltip="View Home";r.track(this,["tooltip"])}return t(f.prototype,{scene:{get:function(){return this._scene}},command:{get:function(){return this._command}},duration:{get:function(){return this._duration},set:function(t){if(n(t)&&t<0)throw new i("value must be positive.");this._duration=t}}}),f});t("Widgets/HomeButton/HomeButton",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../ThirdParty/knockout","../getElement","./HomeButtonViewModel"],function(n,t,i,r,u,f,e){"use strict";function o(t,i,o){var h,s;if(!n(t))throw new r("container is required.");t=f(t);h=new e(i,o);h._svgPath="M14,4l-10,8.75h20l-4.25-3.7188v-4.6562h-2.812v2.1875l-2.938-2.5625zm-7.0938,9.906v10.094h14.094v-10.094h-14.094zm2.1876,2.313h3.3122v4.25h-3.3122v-4.25zm5.8442,1.281h3.406v6.438h-3.406v-6.438z";s=document.createElement("button");s.type="button";s.className="cesium-button cesium-toolbar-button cesium-home-button";s.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 28, height: 28 }");t.appendChild(s);u.applyBindings(h,s);this._container=t;this._viewModel=h;this._element=s}return t(o.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return u.cleanNode(this._element),this._container.removeChild(this._element),i(this)},o});t("Widgets/InfoBox/InfoBoxViewModel",["../../Core/defined","../../Core/defineProperties","../../Core/Event","../../ThirdParty/knockout"],function(n,t,i,r){"use strict";function u(){this._cameraClicked=new i;this._closeClicked=new i;this.maxHeight=500;this.enableCamera=!1;this.isCameraTracking=!1;this.showInfo=!1;this.titleText="";this.description="";r.track(this,["showInfo","titleText","description","maxHeight","enableCamera","isCameraTracking"]);this._loadingIndicatorHtml='<div class="cesium-infoBox-loadingContainer"><span class="cesium-infoBox-loading"><\/span><\/div>';this.cameraIconPath=undefined;r.defineProperty(this,"cameraIconPath",{get:function(){return!this.enableCamera||this.isCameraTracking?e:f}});r.defineProperty(this,"_bodyless",{get:function(){return!n(this.description)||this.description.length===0}})}var f="M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4853444 22.104033 11.423165 24.0625 13.84375 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 8.975298 28.305952 7.03125 25.875 7.03125 L 13.84375 7.03125 z",e="M 27.34375 1.65625 L 5.28125 27.9375 L 8.09375 30.3125 L 30.15625 4.03125 L 27.34375 1.65625 z M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4724893 20.232036 9.5676108 20.7379 9.75 21.21875 L 21.65625 7.03125 L 13.84375 7.03125 z M 28.21875 7.71875 L 14.53125 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 9.8371439 29.456025 8.4902779 28.21875 7.71875 z";return u.prototype.maxHeightOffset=function(n){return this.maxHeight-n+"px"},t(u.prototype,{cameraClicked:{get:function(){return this._cameraClicked}},closeClicked:{get:function(){return this._closeClicked}}}),u});t("Widgets/InfoBox/InfoBox",["../../Core/buildModuleUrl","../../Core/Check","../../Core/Color","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../ThirdParty/knockout","../getElement","../subscribeAndEvaluate","./InfoBoxViewModel"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(u){var c,v,a,l,f,y,p;t.defined("container",u);u=o(u);c=document.createElement("div");c.className="cesium-infoBox";c.setAttribute("data-bind",'css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }');u.appendChild(c);v=document.createElement("div");v.className="cesium-infoBox-title";v.setAttribute("data-bind","text: titleText");c.appendChild(v);a=document.createElement("button");a.type="button";a.className="cesium-button cesium-infoBox-camera";a.setAttribute("data-bind",'attr: { title: "Focus camera on object" },click: function () { cameraClicked.raiseEvent(this); },enable: enableCamera,cesiumSvgPath: { path: cameraIconPath, width: 32, height: 32 }');c.appendChild(a);l=document.createElement("button");l.type="button";l.className="cesium-infoBox-close";l.setAttribute("data-bind","click: function () { closeClicked.raiseEvent(this); }");l.innerHTML="&times;";c.appendChild(l);f=document.createElement("iframe");f.className="cesium-infoBox-iframe";f.setAttribute("sandbox","allow-same-origin allow-popups allow-forms");f.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }");f.setAttribute("allowfullscreen",!0);c.appendChild(f);y=new h;e.applyBindings(y,c);this._container=u;this._element=c;this._frame=f;this._viewModel=y;this._descriptionSubscription=undefined;p=this;f.addEventListener("load",function(){var u=f.contentDocument,e=u.createElement("link"),t;e.href=n("Widgets/InfoBox/InfoBoxDescription.css");e.rel="stylesheet";e.type="text/css";t=u.createElement("div");t.className="cesium-infoBox-description";u.head.appendChild(e);u.body.appendChild(t);p._descriptionSubscription=s(y,"description",function(n){var e,o,u,h,s,l;f.style.height="5px";t.innerHTML=n;e=null;o=t.firstElementChild;o!==null&&t.childNodes.length===1&&(u=window.getComputedStyle(o),u!==null&&(h=u["background-color"],s=i.fromCssColorString(h),r(s)&&s.alpha!==0&&(e=u["background-color"])));c.style["background-color"]=e;l=t.getBoundingClientRect().height;f.style.height=l+"px"})});f.setAttribute("src","about:blank")}return u(c.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}},frame:{get:function(){return this._frame}}}),c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){var n=this._container;return e.cleanNode(this._element),n.removeChild(this._element),r(this._descriptionSubscription)&&this._descriptionSubscription.dispose(),f(this)},c});t("Widgets/NavigationHelpButton/NavigationHelpButtonViewModel",["../../Core/defineProperties","../../ThirdParty/knockout","../createCommand"],function(n,t,i){"use strict";function r(){this.showInstructions=!1;var n=this;this._command=i(function(){n.showInstructions=!n.showInstructions});this._showClick=i(function(){n._touch=!1});this._showTouch=i(function(){n._touch=!0});this._touch=!1;this.tooltip="";t.track(this,["tooltip","showInstructions","_touch"])}return n(r.prototype,{command:{get:function(){return this._command}},showClick:{get:function(){return this._showClick}},showTouch:{get:function(){return this._showTouch}}}),r});t("Widgets/NavigationHelpButton/NavigationHelpButton",["../../Core/buildModuleUrl","../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/FeatureDetection","../../ThirdParty/knockout","../getElement","./NavigationHelpButtonViewModel"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function c(r){var u,w,c,l,v,a,y,b,k;if(!i(r)||!i(r.container))throw new f("options.container is required.");var d=s(r.container),p=new h,g=t(r.instructionsInitiallyVisible,!1);p.showInstructions=g;p._svgPath="M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M17.328,24.371h-2.707v-2.596h2.707V24.371zM17.328,19.003v0.858h-2.707v-1.057c0-3.19,3.63-3.696,3.63-5.963c0-1.034-0.924-1.826-2.134-1.826c-1.254,0-2.354,0.924-2.354,0.924l-1.541-1.915c0,0,1.519-1.584,4.137-1.584c2.487,0,4.796,1.54,4.796,4.136C21.156,16.208,17.328,16.627,17.328,19.003z";u=document.createElement("span");u.className="cesium-navigationHelpButton-wrapper";d.appendChild(u);w=document.createElement("button");w.type="button";w.className="cesium-button cesium-toolbar-button cesium-navigation-help-button";w.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 32, height: 32 }");u.appendChild(w);c=document.createElement("div");c.className="cesium-navigation-help";c.setAttribute("data-bind",'css: { "cesium-navigation-help-visible" : showInstructions}');u.appendChild(c);l=document.createElement("button");l.type="button";l.className="cesium-navigation-button cesium-navigation-button-left";l.setAttribute("data-bind",'click: showClick, css: {"cesium-navigation-button-selected": !_touch, "cesium-navigation-button-unselected": _touch}');v=document.createElement("img");v.src=n("Widgets/Images/NavigationHelp/Mouse.svg");v.className="cesium-navigation-button-icon";v.style.width="25px";v.style.height="25px";l.appendChild(v);l.appendChild(document.createTextNode(""));a=document.createElement("button");a.type="button";a.className="cesium-navigation-button cesium-navigation-button-right";a.setAttribute("data-bind",'click: showTouch, css: {"cesium-navigation-button-selected": _touch, "cesium-navigation-button-unselected": !_touch}');y=document.createElement("img");y.src=n("Widgets/Images/NavigationHelp/Touch.svg");y.className="cesium-navigation-button-icon";y.style.width="25px";y.style.height="25px";a.appendChild(y);a.appendChild(document.createTextNode(""));c.appendChild(l);c.appendChild(a);b=document.createElement("div");b.className="cesium-click-navigation-help cesium-navigation-help-instructions";b.setAttribute("data-bind",'css: { "cesium-click-navigation-help-visible" : !_touch}');b.innerHTML='            <table>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/MouseLeft.svg")+'" width="48" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-pan"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/MouseRight.svg")+'" width="48" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-zoom"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/MouseMiddle.svg")+'" width="48" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-rotate"><\/div>                        <div class="cesium-navigation-help-details">+<\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>            <\/table>';c.appendChild(b);k=document.createElement("div");k.className="cesium-touch-navigation-help cesium-navigation-help-instructions";k.setAttribute("data-bind",'css: { "cesium-touch-navigation-help-visible" : _touch}');k.innerHTML='            <table>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/TouchDrag.svg")+'" width="70" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-pan"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/TouchZoom.svg")+'" width="70" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-zoom"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/TouchTilt.svg")+'" width="70" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-rotate"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>                <tr>                    <td><img src="'+n("Widgets/Images/NavigationHelp/TouchRotate.svg")+'" width="70" height="48" /><\/td>                    <td>                        <div class="cesium-navigation-help-tilt"><\/div>                        <div class="cesium-navigation-help-details"><\/div>                    <\/td>                <\/tr>            <\/table>';c.appendChild(k);o.applyBindings(p,u);this._container=d;this._viewModel=p;this._wrapper=u;this._closeInstructions=function(n){u.contains(n.target)||(p.showInstructions=!1)};e.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeInstructions,!0):(document.addEventListener("mousedown",this._closeInstructions,!0),document.addEventListener("touchstart",this._closeInstructions,!0))}return r(c.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return e.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeInstructions,!0):(document.removeEventListener("mousedown",this._closeInstructions,!0),document.removeEventListener("touchstart",this._closeInstructions,!0)),o.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),u(this)},c});t("Widgets/PerformanceWatchdog/PerformanceWatchdogViewModel",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Scene/FrameRateMonitor","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u,f,e,o){"use strict";function s(i){var r,s;if(!t(i)||!t(i.scene))throw new u("options.scene is required.");this._scene=i.scene;this.lowFrameRateMessage=n(i.lowFrameRateMessage,"This application appears to be performing poorly on your system.  Please try using a different web browser or updating your video drivers.");this.lowFrameRateMessageDismissed=!1;this.showingLowFrameRateMessage=!1;e.track(this,["lowFrameRateMessage","lowFrameRateMessageDismissed","showingLowFrameRateMessage"]);r=this;this._dismissMessage=o(function(){r.showingLowFrameRateMessage=!1;r.lowFrameRateMessageDismissed=!0});s=f.fromScene(i.scene);this._unsubscribeLowFrameRate=s.lowFrameRate.addEventListener(function(){r.lowFrameRateMessageDismissed||(r.showingLowFrameRateMessage=!0)});this._unsubscribeNominalFrameRate=s.nominalFrameRate.addEventListener(function(){r.showingLowFrameRateMessage=!1})}return i(s.prototype,{scene:{get:function(){return this._scene}},dismissMessage:{get:function(){return this._dismissMessage}}}),s.prototype.destroy=function(){return this._unsubscribeLowFrameRate(),this._unsubscribeNominalFrameRate(),r(this)},s});t("Widgets/PerformanceWatchdog/PerformanceWatchdog",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../ThirdParty/knockout","../getElement","./PerformanceWatchdogViewModel"],function(n,t,i,r,u,f,e){"use strict";function o(t){var o,s;if(!n(t)||!n(t.container))throw new r("options.container is required.");if(!n(t.scene))throw new r("options.scene is required.");var h=f(t.container),c=new e(t),i=document.createElement("div");i.className="cesium-performance-watchdog-message-area";i.setAttribute("data-bind","visible: showingLowFrameRateMessage");o=document.createElement("button");o.setAttribute("type","button");o.className="cesium-performance-watchdog-message-dismiss";o.innerHTML="&times;";o.setAttribute("data-bind","click: dismissMessage");i.appendChild(o);s=document.createElement("div");s.className="cesium-performance-watchdog-message";s.setAttribute("data-bind","html: lowFrameRateMessage");i.appendChild(s);h.appendChild(i);u.applyBindings(c,i);this._container=h;this._viewModel=c;this._element=i}return t(o.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return this._viewModel.destroy(),u.cleanNode(this._element),this._container.removeChild(this._element),i(this)},o});t("Widgets/ProjectionPicker/ProjectionPickerViewModel",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/EventHelper","../../Core/OrthographicFrustum","../../Scene/SceneMode","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(t){if(!n(t))throw new r("scene is required.");this._scene=t;this._orthographic=t.camera.frustum instanceof f;this._flightInProgress=!1;this.dropDownVisible=!1;this.tooltipPerspective="Perspective Projection";this.tooltipOrthographic="Orthographic Projection";this.selectedTooltip=undefined;this.sceneMode=t.mode;o.track(this,["_orthographic","_flightInProgress","sceneMode","dropDownVisible","tooltipPerspective","tooltipOrthographic"]);var i=this;o.defineProperty(this,"selectedTooltip",function(){return i._orthographic?i.tooltipOrthographic:i.tooltipPerspective});this._toggleDropDown=s(function(){i.sceneMode===e.SCENE2D||i._flightInProgress||(i.dropDownVisible=!i.dropDownVisible)});this._eventHelper=new u;this._eventHelper.add(t.morphComplete,function(n,t,r){i.sceneMode=r;i._orthographic=r===e.SCENE2D||i._scene.camera.frustum instanceof f});this._eventHelper.add(t.preRender,function(){i._flightInProgress=n(t.camera._currentFlight)});this._switchToPerspective=s(function(){i.sceneMode!==e.SCENE2D&&(i._scene.camera.switchToPerspectiveFrustum(),i._orthographic=!1,i.dropDownVisible=!1)});this._switchToOrthographic=s(function(){i.sceneMode!==e.SCENE2D&&(i._scene.camera.switchToOrthographicFrustum(),i._orthographic=!0,i.dropDownVisible=!1)});this._sceneMode=e}return t(h.prototype,{scene:{get:function(){return this._scene}},toggleDropDown:{get:function(){return this._toggleDropDown}},switchToPerspective:{get:function(){return this._switchToPerspective}},switchToOrthographic:{get:function(){return this._switchToOrthographic}},isOrthographicProjection:{get:function(){return this._orthographic}}}),h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){this._eventHelper.removeAll();i(this)},h});t("Widgets/ProjectionPicker/ProjectionPicker",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/FeatureDetection","../../ThirdParty/knockout","../getElement","./ProjectionPickerViewModel"],function(n,t,i,r,u,f,e,o){"use strict";function s(t,i){var l,s,a,v,y;if(!n(t))throw new r("container is required.");if(!n(i))throw new r("scene is required.");t=e(t);l=new o(i);l._perspectivePath=h;l._orthographicPath=c;s=document.createElement("span");s.className="cesium-projectionPicker-wrapper cesium-toolbar-button";t.appendChild(s);a=document.createElement("button");a.type="button";a.className="cesium-button cesium-toolbar-button";a.setAttribute("data-bind",'css: { "cesium-projectionPicker-buttonPerspective": !_orthographic,       "cesium-projectionPicker-buttonOrthographic": _orthographic,       "cesium-button-disabled" : sceneMode === _sceneMode.SCENE2D || _flightInProgress,        "cesium-projectionPicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown');a.innerHTML='<!-- ko cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64, css: "cesium-projectionPicker-iconPerspective" } --><!-- /ko --><!-- ko cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64, css: "cesium-projectionPicker-iconOrthographic" } --><!-- /ko -->';s.appendChild(a);v=document.createElement("button");v.type="button";v.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon";v.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible && _orthographic),       "cesium-projectionPicker-none" : !_orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible },attr: { title: tooltipPerspective },click: switchToPerspective,cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64 }');s.appendChild(v);y=document.createElement("button");y.type="button";y.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon";y.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible && !_orthographic),       "cesium-projectionPicker-none" : _orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible},attr: { title: tooltipOrthographic },click: switchToOrthographic,cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64 }');s.appendChild(y);f.applyBindings(l,s);this._viewModel=l;this._container=t;this._wrapper=s;this._closeDropDown=function(n){s.contains(n.target)||(l.dropDownVisible=!1)};u.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}var h="M 28.15625,10.4375 9.125,13.21875 13.75,43.25 41.75,55.09375 50.8125,37 54.5,11.9375 z m 0.125,3 19.976451,0.394265 L 43.03125,16.875 22.6875,14.28125 z M 50.971746,15.705477 47.90625,36.03125 42.53125,46 44.84375,19.3125 z M 12.625,16.03125 l 29.15625,3.6875 -2.65625,31 L 16.4375,41.125 z",c="m 31.560594,6.5254438 -20.75,12.4687502 0.1875,24.5625 22.28125,11.8125 19.5,-12 0.65625,-0.375 0,-0.75 0.0312,-23.21875 z m 0.0625,3.125 16.65625,9.5000002 -16.125,10.28125 -17.34375,-9.71875 z m 18.96875,11.1875002 0.15625,20.65625 -17.46875,10.59375 0.15625,-20.28125 z m -37.0625,1.25 17.21875,9.625 -0.15625,19.21875 -16.9375,-9 z";return t(s.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._viewModel.destroy(),u.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),f.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),i(this)},s});t("Widgets/SceneModePicker/SceneModePickerViewModel",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/EventHelper","../../Scene/SceneMode","../../ThirdParty/knockout","../createCommand"],function(n,t,i,r,u,f,e,o,s){"use strict";function h(i,r){if(!t(i))throw new u("scene is required.");this._scene=i;var h=this,c=function(n,t,i){h.sceneMode=i;h.dropDownVisible=!1};this._eventHelper=new f;this._eventHelper.add(i.morphStart,c);this._duration=n(r,2);this.sceneMode=i.mode;this.dropDownVisible=!1;this.tooltip2D="2D";this.tooltip3D="3D";this.tooltipColumbusView="Columbus View";o.track(this,["sceneMode","dropDownVisible","tooltip2D","tooltip3D","tooltipColumbusView"]);this.selectedTooltip=undefined;o.defineProperty(this,"selectedTooltip",function(){var n=h.sceneMode;return n===e.SCENE2D?h.tooltip2D:n===e.SCENE3D?h.tooltip3D:h.tooltipColumbusView});this._toggleDropDown=s(function(){h.dropDownVisible=!h.dropDownVisible});this._morphTo2D=s(function(){i.morphTo2D(h._duration)});this._morphTo3D=s(function(){i.morphTo3D(h._duration)});this._morphToColumbusView=s(function(){i.morphToColumbusView(h._duration)});this._sceneMode=e}return i(h.prototype,{scene:{get:function(){return this._scene}},duration:{get:function(){return this._duration},set:function(n){if(n<0)throw new u("duration value must be positive.");this._duration=n}},toggleDropDown:{get:function(){return this._toggleDropDown}},morphTo2D:{get:function(){return this._morphTo2D}},morphTo3D:{get:function(){return this._morphTo3D}},morphToColumbusView:{get:function(){return this._morphToColumbusView}}}),h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){this._eventHelper.removeAll();r(this)},h});t("Widgets/SceneModePicker/SceneModePicker",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/FeatureDetection","../../ThirdParty/knockout","../getElement","./SceneModePickerViewModel"],function(n,t,i,r,u,f,e,o){"use strict";function s(t,i,s){var v,a,y,p,w,b;if(!n(t))throw new r("container is required.");if(!n(i))throw new r("scene is required.");t=e(t);v=new o(i,s);v._globePath=h;v._flatMapPath=c;v._columbusViewPath=l;a=document.createElement("span");a.className="cesium-sceneModePicker-wrapper cesium-toolbar-button";t.appendChild(a);y=document.createElement("button");y.type="button";y.className="cesium-button cesium-toolbar-button";y.setAttribute("data-bind",'css: { "cesium-sceneModePicker-button2D": sceneMode === _sceneMode.SCENE2D,       "cesium-sceneModePicker-button3D": sceneMode === _sceneMode.SCENE3D,       "cesium-sceneModePicker-buttonColumbusView": sceneMode === _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown');y.innerHTML='<!-- ko cesiumSvgPath: { path: _globePath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon3D" } --><!-- /ko --><!-- ko cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon2D" } --><!-- /ko --><!-- ko cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-iconColumbusView" } --><!-- /ko -->';a.appendChild(y);p=document.createElement("button");p.type="button";p.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon";p.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.SCENE3D)) || (!dropDownVisible && (sceneMode === _sceneMode.SCENE3D)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.SCENE3D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip3D },click: morphTo3D,cesiumSvgPath: { path: _globePath, width: 64, height: 64 }');a.appendChild(p);w=document.createElement("button");w.type="button";w.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon";w.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.SCENE2D)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.SCENE2D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip2D },click: morphTo2D,cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64 }');a.appendChild(w);b=document.createElement("button");b.type="button";b.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon";b.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible && (sceneMode !== _sceneMode.COLUMBUS_VIEW)) || (!dropDownVisible && (sceneMode === _sceneMode.COLUMBUS_VIEW)),       "cesium-sceneModePicker-none" : sceneMode === _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-hidden" : !dropDownVisible},attr: { title: tooltipColumbusView },click: morphToColumbusView,cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64 }');a.appendChild(b);f.applyBindings(v,a);this._viewModel=v;this._container=t;this._wrapper=a;this._closeDropDown=function(n){a.contains(n.target)||(v.dropDownVisible=!1)};u.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}var h="m 32.401392,4.9330437 c -7.087603,0 -14.096095,2.884602 -19.10793,7.8946843 -5.0118352,5.010083 -7.9296167,11.987468 -7.9296167,19.072999 0,7.085531 2.9177815,14.097848 7.9296167,19.107931 4.837653,4.835961 11.541408,7.631372 18.374354,7.82482 0.05712,0.01231 0.454119,0.139729 0.454119,0.139729 l 0.03493,-0.104797 c 0.08246,7.84e-4 0.162033,0.03493 0.244525,0.03493 0.08304,0 0.161515,-0.03414 0.244526,-0.03493 l 0.03493,0.104797 c 0,0 0.309474,-0.129487 0.349323,-0.139729 6.867765,-0.168094 13.582903,-2.965206 18.444218,-7.82482 2.558195,-2.5573 4.551081,-5.638134 5.903547,-8.977584 1.297191,-3.202966 2.02607,-6.661489 2.02607,-10.130347 0,-6.237309 -2.366261,-12.31219 -6.322734,-17.116794 -0.0034,-0.02316 0.0049,-0.04488 0,-0.06986 -0.01733,-0.08745 -0.104529,-0.278855 -0.104797,-0.279458 -5.31e-4,-0.0012 -0.522988,-0.628147 -0.523984,-0.62878         -3.47e-4,-2.2e-4 -0.133444,-0.03532 -0.244525,-0.06987 C 51.944299,13.447603 51.751076,13.104317 51.474391,12.827728 46.462556,7.8176457 39.488996,4.9330437 32.401392,4.9330437 z m -2.130866,3.5281554 0.104797,9.6762289 c -4.111695,-0.08361 -7.109829,-0.423664 -9.257041,-0.943171 1.198093,-2.269271 2.524531,-4.124404 3.91241,-5.414496 2.167498,-2.0147811 3.950145,-2.8540169 5.239834,-3.3185619 z m 2.794579,0 c 1.280302,0.4754953 3.022186,1.3285948 5.065173,3.2486979 1.424667,1.338973 2.788862,3.303645 3.982275,5.728886 -2.29082,0.403367 -5.381258,0.621049 -8.942651,0.698645 L 33.065105,8.4611991 z m 5.728886,0.2445256 c 4.004072,1.1230822 7.793098,3.1481363 10.724195,6.0782083 0.03468,0.03466 0.07033,0.06991 0.104797,0.104797 -0.45375,0.313891 -0.923054,0.663002 -1.956205,1.082899 -0.647388,0.263114 -1.906242,0.477396 -2.829511,0.733577 -1.382296,-2.988132         -3.027146,-5.368585 -4.785716,-7.0213781 -0.422866,-0.397432 -0.835818,-0.6453247 -1.25756,-0.9781032 z m -15.33525,0.7685092 c -0.106753,0.09503 -0.207753,0.145402 -0.31439,0.244526 -1.684973,1.5662541 -3.298068,3.8232211 -4.680919,6.5672591 -0.343797,-0.14942 -1.035052,-0.273198 -1.292493,-0.419186 -0.956528,-0.542427 -1.362964,-1.022024 -1.537018,-1.292493 -0.0241,-0.03745 -0.01868,-0.0401 -0.03493,-0.06986 2.250095,-2.163342 4.948824,-3.869984 7.859752,-5.0302421 z m -9.641296,7.0912431 c 0.464973,0.571618 0.937729,1.169056 1.956205,1.746612 0.349907,0.198425 1.107143,0.335404 1.537018,0.523983 -1.20166,3.172984 -1.998037,7.051901 -2.165798,11.772162 C 14.256557,30.361384 12.934823,30.161483 12.280427,29.90959 10.644437,29.279855 9.6888882,28.674891 9.1714586,28.267775 8.6540289,27.860658 8.6474751,27.778724 8.6474751,27.778724 l -0.069864,0.03493 C 9.3100294,23.691285         11.163248,19.798527 13.817445,16.565477 z m 37.552149,0.523984 c 2.548924,3.289983 4.265057,7.202594 4.890513,11.318043 -0.650428,0.410896 -1.756876,1.001936 -3.563088,1.606882 -1.171552,0.392383 -3.163859,0.759153 -4.960377,1.117832 -0.04367,-4.752703 -0.784809,-8.591423 -1.88634,-11.807094 0.917574,-0.263678 2.170552,-0.486495 2.864443,-0.76851 1.274693,-0.518066 2.003942,-1.001558 2.654849,-1.467153 z m -31.439008,2.619917 c 2.487341,0.672766 5.775813,1.137775 10.479669,1.222628 l 0.104797,10.689263 0,0.03493 0,0.733577 c -5.435005,-0.09059 -9.512219,-0.519044 -12.610536,-1.117831 0.106127,-4.776683 0.879334,-8.55791 2.02607,-11.562569 z m 23.264866,0.31439 c 1.073459,3.067541 1.833795,6.821314 1.816476,11.702298 -3.054474,0.423245 -7.062018,0.648559 -11.702298,0.698644 l 0,-0.838373 -0.104796,-10.654331 c 4.082416,-0.0864 7.404468,-0.403886 9.990618,-0.908238 z         M 8.2632205,30.922625 c 0.7558676,0.510548 1.5529563,1.013339 3.0041715,1.57195 0.937518,0.360875 2.612202,0.647642 3.91241,0.978102 0.112814,3.85566 0.703989,7.107756 1.606883,9.920754 -1.147172,-0.324262 -2.644553,-0.640648 -3.423359,-0.978102 -1.516688,-0.657177 -2.386627,-1.287332 -2.864443,-1.71168 -0.477816,-0.424347 -0.489051,-0.489051 -0.489051,-0.489051 L 9.8002387,40.319395 C 8.791691,37.621767 8.1584238,34.769583 8.1584238,31.900727 c 0,-0.330153 0.090589,-0.648169 0.1047967,-0.978102 z m 48.2763445,0.419186 c 0.0047,0.188973 0.06986,0.36991 0.06986,0.558916 0,2.938869 -0.620228,5.873558 -1.676747,8.628261 -0.07435,0.07583 -0.06552,0.07411 -0.454119,0.349323 -0.606965,0.429857 -1.631665,1.042044 -3.318562,1.676747 -1.208528,0.454713 -3.204964,0.850894 -5.135038,1.25756 0.84593,-2.765726 1.41808,-6.005357 1.606883,-9.815957 2.232369,-0.413371 4.483758,-0.840201         5.938479,-1.327425 1.410632,-0.472457 2.153108,-0.89469 2.96924,-1.327425 z m -38.530252,2.864443 c 3.208141,0.56697 7.372279,0.898588 12.575603,0.978103 l 0.174662,9.885821 c -4.392517,-0.06139 -8.106722,-0.320566 -10.863925,-0.803441 -1.051954,-2.664695 -1.692909,-6.043794 -1.88634,-10.060483 z m 26.793022,0.31439 c -0.246298,3.923551 -0.877762,7.263679 -1.816476,9.885822 -2.561957,0.361954 -5.766249,0.560708 -9.431703,0.62878 l -0.174661,-9.815957 c 4.491734,-0.04969 8.334769,-0.293032 11.42284,-0.698645 z M 12.035901,44.860585 c 0.09977,0.04523 0.105535,0.09465 0.209594,0.139729 1.337656,0.579602 3.441099,1.058072 5.589157,1.537018 1.545042,3.399208 3.548524,5.969402 5.589157,7.789888 -3.034411,-1.215537 -5.871615,-3.007978 -8.174142,-5.309699 -1.245911,-1.245475 -2.271794,-2.662961 -3.213766,-4.156936 z m 40.69605,0 c -0.941972,1.493975 -1.967855,2.911461         -3.213765,4.156936 -2.74253,2.741571 -6.244106,4.696717 -9.955686,5.868615 0.261347,-0.241079 0.507495,-0.394491 0.768509,-0.663713 1.674841,-1.727516 3.320792,-4.181056 4.645987,-7.265904 2.962447,-0.503021 5.408965,-1.122293 7.161107,-1.781544 0.284034,-0.106865 0.337297,-0.207323 0.593848,-0.31439 z m -31.404076,2.305527 c 2.645807,0.376448 5.701178,0.649995 9.466635,0.698645 l 0.139729,7.789888 c -1.38739,-0.480844 -3.316218,-1.29837 -5.659022,-3.388427 -1.388822,-1.238993 -2.743668,-3.0113 -3.947342,-5.100106 z m 20.365491,0.104797 c -1.04872,2.041937 -2.174337,3.779068 -3.353494,4.995309 -1.853177,1.911459 -3.425515,2.82679 -4.611055,3.353494 l -0.139729,-7.789887 c 3.13091,-0.05714 5.728238,-0.278725 8.104278,-0.558916 z",c="m 2.9825053,17.550598 0,1.368113 0,26.267766 0,1.368113 1.36811,0 54.9981397,0 1.36811,0 0,-1.368113 0,-26.267766 0,-1.368113 -1.36811,0 -54.9981397,0 -1.36811,0 z m 2.73623,2.736226 10.3292497,0 0,10.466063 -10.3292497,0 0,-10.466063 z m 13.0654697,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 10.32926,0 0,10.466063 -10.32926,0 0,-10.466063 z m -41.9326497,13.202288 10.3292497,0 0,10.329252 -10.3292497,0 0,-10.329252 z m 13.0654697,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 10.32926,0 0,10.329252 -10.32926,0 0,-10.329252 z",l="m 14.723969,17.675598 -0.340489,0.817175 -11.1680536,26.183638 -0.817175,1.872692 2.076986,0 54.7506996,0 2.07698,0 -0.81717,-1.872692 -11.16805,-26.183638 -0.34049,-0.817175 -0.91933,0 -32.414586,0 -0.919322,0 z m 1.838643,2.723916 6.196908,0 -2.928209,10.418977 -7.729111,0 4.460412,-10.418977 z m 9.02297,0 4.903049,0 0,10.418977 -7.831258,0 2.928209,-10.418977 z m 7.626964,0 5.584031,0 2.62176,10.418977 -8.205791,0 0,-10.418977 z m 8.410081,0 5.51593,0 4.46042,10.418977 -7.38863,0 -2.58772,-10.418977 z m -30.678091,13.142892 8.103649,0 -2.89416,10.282782 -9.6018026,0 4.3923136,-10.282782 z m 10.929711,0 8.614384,0 0,10.282782 -11.508544,0 2.89416,-10.282782 z m 11.338299,0 8.852721,0 2.58772,10.282782 -11.440441,0 0,-10.282782 z m 11.678781,0 7.86531,0 4.39231,10.282782 -9.6699,0 -2.58772,-10.282782 z";return t(s.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),s.prototype.isDestroyed=function(){return!1},s.prototype.destroy=function(){return this._viewModel.destroy(),u.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0)),f.cleanNode(this._wrapper),this._container.removeChild(this._wrapper),i(this)},s});t("Widgets/SelectionIndicator/SelectionIndicatorViewModel",["../../Core/Cartesian2","../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/EasingFunction","../../Scene/SceneTransforms","../../ThirdParty/knockout"],function(n,t,i,r,u,f,e,o){"use strict";function s(n,r,f){if(!i(n))throw new u("scene is required.");if(!i(r))throw new u("selectionIndicatorElement is required.");if(!i(f))throw new u("container is required.");this._scene=n;this._screenPositionX=h;this._screenPositionY=h;this._tweens=n.tweens;this._container=t(f,document.body);this._selectionIndicatorElement=r;this._scale=1;this.position=undefined;this.showSelection=!1;o.track(this,["position","_screenPositionX","_screenPositionY","_scale","showSelection"]);this.isVisible=undefined;o.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&i(this.position)}});o.defineProperty(this,"_transform",{get:function(){return"scale("+this._scale+")"}});this.computeScreenSpacePosition=function(t,i){return e.wgs84ToWindowCoordinates(n,t,i)}}var c=new n,h="-1000px";return s.prototype.update=function(){var n;if(this.showSelection&&i(this.position))if(n=this.computeScreenSpacePosition(this.position,c),i(n)){var r=this._container,f=r.parentNode.clientWidth,e=r.parentNode.clientHeight,t=this._selectionIndicatorElement.clientWidth,u=t*.5;n.x=Math.min(Math.max(n.x,-t),f+t)-u;n.y=Math.min(Math.max(n.y,-t),e+t)-u;this._screenPositionX=Math.floor(n.x+.25)+"px";this._screenPositionY=Math.floor(n.y+.25)+"px"}else this._screenPositionX=h,this._screenPositionY=h},s.prototype.animateAppear=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:2,stopValue:1,duration:.8,easingFunction:f.EXPONENTIAL_OUT})},s.prototype.animateDepart=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:this._scale,stopValue:1.5,duration:.8,easingFunction:f.EXPONENTIAL_OUT})},r(s.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}}),s});t("Widgets/SelectionIndicator/SelectionIndicator",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../ThirdParty/knockout","../getElement","./SelectionIndicatorViewModel"],function(n,t,i,r,u,f,e){"use strict";function o(t,i){var o,h,c,a;if(!n(t))throw new r("container is required.");t=f(t);this._container=t;o=document.createElement("div");o.className="cesium-selection-wrapper";o.setAttribute("data-bind",'style: { "top" : _screenPositionY, "left" : _screenPositionX },css: { "cesium-selection-wrapper-visible" : isVisible }');t.appendChild(o);this._element=o;var l="http://www.w3.org/2000/svg",s=document.createElementNS(l,"svg:svg");s.setAttribute("width",160);s.setAttribute("height",160);s.setAttribute("viewBox","0 0 160 160");h=document.createElementNS(l,"g");h.setAttribute("transform","translate(80,80)");s.appendChild(h);c=document.createElementNS(l,"path");c.setAttribute("data-bind","attr: { transform: _transform }");c.setAttribute("d","M -34 -34 L -34 -11.25 L -30 -15.25 L -30 -30 L -15.25 -30 L -11.25 -34 L -34 -34 z M 11.25 -34 L 15.25 -30 L 30 -30 L 30 -15.25 L 34 -11.25 L 34 -34 L 11.25 -34 z M -34 11.25 L -34 34 L -11.25 34 L -15.25 30 L -30 30 L -30 15.25 L -34 11.25 z M 34 11.25 L 30 15.25 L 30 30 L 15.25 30 L 11.25 34 L 34 34 L 34 11.25 z");h.appendChild(c);o.appendChild(s);a=new e(i,this._element,this._container);this._viewModel=a;u.applyBindings(this._viewModel,this._element)}return t(o.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){var n=this._container;return u.cleanNode(this._element),n.removeChild(this._element),i(this)},o});t("Widgets/Timeline/TimelineHighlightRange",["../../Core/defaultValue","../../Core/JulianDate"],function(n,t){"use strict";function i(t,i,r){this._color=t;this._height=i;this._base=n(r,0)}return i.prototype.getHeight=function(){return this._height},i.prototype.getBase=function(){return this._base},i.prototype.getStartTime=function(){return this._start},i.prototype.getStopTime=function(){return this._stop},i.prototype.setRange=function(n,t){this._start=n;this._stop=t},i.prototype.render=function(n){var u="";if(this._start&&this._stop&&this._color){var f=t.secondsDifference(this._start,n.epochJulian),i=Math.round(n.timeBarWidth*n.getAlpha(f)),e=t.secondsDifference(this._stop,n.epochJulian),r=Math.round(n.timeBarWidth*n.getAlpha(e))-i;i<0&&(r+=i,i=0);i+r>n.timeBarWidth&&(r=n.timeBarWidth-i);r>0&&(u='<span class="cesium-timeline-highlight" style="left: '+i.toString()+"px; width: "+r.toString()+"px; bottom: "+this._base.toString()+"px; height: "+this._height+"px; background-color: "+this._color+';"><\/span>')}return u},i});t("Widgets/Timeline/TimelineTrack",["../../Core/Color","../../Core/defined","../../Core/JulianDate"],function(n,t,i){"use strict";function r(t,i,r,u){this.interval=t;this.height=i;this.color=r||new n(.5,.5,.5,1);this.backgroundColor=u||new n(0,0,0,0)}return r.prototype.render=function(n,r){var o=this.interval.start,s=this.interval.stop,c=r.startJulian,l=i.addSeconds(r.startJulian,r.duration,new i),u,f,e,h;if(i.lessThan(o,c)&&i.greaterThan(s,l))n.fillStyle=this.color.toCssColorString(),n.fillRect(0,r.y,r.timeBarWidth,this.height);else if(i.lessThanOrEquals(o,l)&&i.greaterThanOrEquals(s,c)){for(u=0;u<r.timeBarWidth;++u)h=i.addSeconds(r.startJulian,u/r.timeBarWidth*r.duration,new i),!t(f)&&i.greaterThanOrEquals(h,o)?f=u:!t(e)&&i.greaterThanOrEquals(h,s)&&(e=u);n.fillStyle=this.backgroundColor.toCssColorString();n.fillRect(0,r.y,r.timeBarWidth,this.height);t(f)&&(t(e)||(e=r.timeBarWidth),n.fillStyle=this.color.toCssColorString(),n.fillRect(f,r.y,Math.max(e-f,1),this.height))}},r});t("Widgets/Timeline/Timeline",["../../Core/ClockRange","../../Core/defined","../../Core/destroyObject","../../Core/DeveloperError","../../Core/JulianDate","../getElement","./TimelineHighlightRange","./TimelineTrack"],function(n,t,i,r,u,f,e,o){"use strict";function h(n,i){var e,u;if(!t(n))throw new r("container is required.");if(!t(i))throw new r("clock is required.");n=f(n);this.container=n;e=document.createElement("div");e.className="cesium-timeline-main";n.appendChild(e);this._topDiv=e;this._endJulian=undefined;this._epochJulian=undefined;this._lastXPos=undefined;this._scrubElement=undefined;this._startJulian=undefined;this._timeBarSecondsSpan=undefined;this._clock=i;this._scrubJulian=i.currentTime;this._mainTicSpan=-1;this._mouseMode=c.none;this._touchMode=s.none;this._touchState={centerX:0,spanX:0};this._mouseX=0;this._timelineDrag=0;this._timelineDragLocation=undefined;this._lastHeight=undefined;this._lastWidth=undefined;this._topDiv.innerHTML='<div class="cesium-timeline-bar"><\/div><div class="cesium-timeline-trackContainer"><canvas class="cesium-timeline-tracks" width="10" height="1"><\/canvas><\/div><div class="cesium-timeline-needle"><\/div><span class="cesium-timeline-ruler"><\/span>';this._timeBarEle=this._topDiv.childNodes[0];this._trackContainer=this._topDiv.childNodes[1];this._trackListEle=this._topDiv.childNodes[1].childNodes[0];this._needleEle=this._topDiv.childNodes[2];this._rulerEle=this._topDiv.childNodes[3];this._context=this._trackListEle.getContext("2d");this._trackList=[];this._highlightRanges=[];this.zoomTo(i.startTime,i.stopTime);this._onMouseDown=p(this);this._onMouseUp=w(this);this._onMouseMove=b(this);this._onMouseWheel=k(this);this._onTouchStart=d(this);this._onTouchMove=nt(this);this._onTouchEnd=g(this);u=this._timeBarEle;document.addEventListener("mouseup",this._onMouseUp,!1);document.addEventListener("mousemove",this._onMouseMove,!1);u.addEventListener("mousedown",this._onMouseDown,!1);u.addEventListener("DOMMouseScroll",this._onMouseWheel,!1);u.addEventListener("mousewheel",this._onMouseWheel,!1);u.addEventListener("touchstart",this._onTouchStart,!1);u.addEventListener("touchmove",this._onTouchMove,!1);u.addEventListener("touchend",this._onTouchEnd,!1);u.addEventListener("touchcancel",this._onTouchEnd,!1);this._topDiv.oncontextmenu=function(){return!1};i.onTick.addEventListener(this.updateFromClock,this);this.updateFromClock()}function v(n){return n<10?"0"+n.toString():n.toString()}function p(n){return function(t){n._mouseMode!==c.touchOnly&&(t.button===0?(n._mouseMode=c.scrub,n._scrubElement&&(n._scrubElement.style.backgroundPosition="-16px 0"),n._onMouseMove(t)):(n._mouseX=t.clientX,n._mouseMode=t.button===2?c.zoom:c.slide));t.preventDefault()}}function w(n){return function(){n._mouseMode=c.none;n._scrubElement&&(n._scrubElement.style.backgroundPosition="0 0");n._timelineDrag=0;n._timelineDragLocation=undefined}}function b(n){return function(t){var i,r,f;n._mouseMode===c.scrub?(t.preventDefault(),r=t.clientX-n._topDiv.getBoundingClientRect().left,r<0?(n._timelineDragLocation=0,n._timelineDrag=-.01*n._timeBarSecondsSpan):r>n._topDiv.clientWidth?(n._timelineDragLocation=n._topDiv.clientWidth,n._timelineDrag=.01*n._timeBarSecondsSpan):(n._timelineDragLocation=undefined,n._setTimeBarTime(r,r*n._timeBarSecondsSpan/n._topDiv.clientWidth))):n._mouseMode===c.slide?(i=n._mouseX-t.clientX,n._mouseX=t.clientX,i!==0&&(f=i*n._timeBarSecondsSpan/n._topDiv.clientWidth,n.zoomTo(u.addSeconds(n._startJulian,f,new u),u.addSeconds(n._endJulian,f,new u)))):n._mouseMode===c.zoom&&(i=n._mouseX-t.clientX,n._mouseX=t.clientX,i!==0&&n.zoomFrom(Math.pow(1.01,i)))}}function k(n){return function(t){var i=t.wheelDeltaY||t.wheelDelta||-t.detail;a=Math.max(Math.min(Math.abs(i),a),1);i/=a;n.zoomFrom(Math.pow(1.05,-i))}}function d(n){return function(t){var i=t.touches.length,f,e,r=n._topDiv.getBoundingClientRect().left;t.preventDefault();n._mouseMode=c.touchOnly;i===1?(f=u.secondsDifference(n._scrubJulian,n._startJulian),e=Math.round(f*n._topDiv.clientWidth/n._timeBarSecondsSpan+r),Math.abs(t.touches[0].clientX-e)<50?(n._touchMode=s.scrub,n._scrubElement&&(n._scrubElement.style.backgroundPosition=i===1?"-16px 0":"0 0")):(n._touchMode=s.singleTap,n._touchState.centerX=t.touches[0].clientX-r)):i===2?(n._touchMode=s.slideZoom,n._touchState.centerX=(t.touches[0].clientX+t.touches[1].clientX)*.5-r,n._touchState.spanX=Math.abs(t.touches[0].clientX-t.touches[1].clientX)):n._touchMode=s.ignore}}function g(n){return function(t){var i=t.touches.length,r=n._topDiv.getBoundingClientRect().left;n._touchMode===s.singleTap?(n._touchMode=s.scrub,n._onTouchMove(t)):n._touchMode===s.scrub&&n._onTouchMove(t);n._mouseMode=c.touchOnly;i!==1?n._touchMode=i>0?s.ignore:s.none:n._touchMode===s.slideZoom&&(n._touchState.centerX=t.touches[0].clientX-r);n._scrubElement&&(n._scrubElement.style.backgroundPosition="0 0")}}function nt(n){return function(i){var v,f,h,r,e,o,l=1,a=n._topDiv.getBoundingClientRect().left;n._touchMode===s.singleTap&&(n._touchMode=s.slideZoom);n._mouseMode=c.touchOnly;n._touchMode===s.scrub?(i.preventDefault(),i.changedTouches.length===1&&(f=i.changedTouches[0].clientX-a,f>=0&&f<=n._topDiv.clientWidth&&n._setTimeBarTime(f,f*n._timeBarSecondsSpan/n._topDiv.clientWidth))):n._touchMode===s.slideZoom&&(h=i.touches.length,h===2?(r=(i.touches[0].clientX+i.touches[1].clientX)*.5-a,e=Math.abs(i.touches[0].clientX-i.touches[1].clientX)):h===1&&(r=i.touches[0].clientX-a,e=0),t(r)&&(e>0&&n._touchState.spanX>0?(l=n._touchState.spanX/e,o=u.addSeconds(n._startJulian,(n._touchState.centerX*n._timeBarSecondsSpan-r*n._timeBarSecondsSpan*l)/n._topDiv.clientWidth,new u)):(v=n._touchState.centerX-r,o=u.addSeconds(n._startJulian,v*n._timeBarSecondsSpan/n._topDiv.clientWidth,new u)),n.zoomTo(o,u.addSeconds(o,n._timeBarSecondsSpan*l,new u)),n._touchState.centerX=r,n._touchState.spanX=e))}}var a=1e12,c={none:0,scrub:1,slide:2,zoom:3,touchOnly:4},s={none:0,scrub:1,slideZoom:2,singleTap:3,ignore:4},l=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800,1296e3,2592e3,5184e3,7776e3,15552e3,31536e3,63072e3,126144e3,15768e4,31536e4,63072e4,126144e4,15768e5,31536e5,63072e5,126144e5,15768e6,31536e6],y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return h.prototype.addEventListener=function(n,t,i){this._topDiv.addEventListener(n,t,i)},h.prototype.removeEventListener=function(n,t,i){this._topDiv.removeEventListener(n,t,i)},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){this._clock.onTick.removeEventListener(this.updateFromClock,this);document.removeEventListener("mouseup",this._onMouseUp,!1);document.removeEventListener("mousemove",this._onMouseMove,!1);var n=this._timeBarEle;n.removeEventListener("mousedown",this._onMouseDown,!1);n.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1);n.removeEventListener("mousewheel",this._onMouseWheel,!1);n.removeEventListener("touchstart",this._onTouchStart,!1);n.removeEventListener("touchmove",this._onTouchMove,!1);n.removeEventListener("touchend",this._onTouchEnd,!1);n.removeEventListener("touchcancel",this._onTouchEnd,!1);this.container.removeChild(this._topDiv);i(this)},h.prototype.addHighlightRange=function(n,t,i){var r=new e(n,t,i);return this._highlightRanges.push(r),this.resize(),r},h.prototype.addTrack=function(n,t,i,r){var u=new o(n,t,i,r);return this._trackList.push(u),this._lastHeight=undefined,this.resize(),u},h.prototype.zoomTo=function(i,f){var e;if(!t(i))throw new r("startTime is required.");if(!t(f))throw new r("stopTime is required");if(u.lessThanOrEquals(f,i))throw new r("Start time must come before end time.");if(this._startJulian=i,this._endJulian=f,this._timeBarSecondsSpan=u.secondsDifference(f,i),this._clock&&this._clock.clockRange!==n.UNBOUNDED){var o=this._clock.startTime,s=this._clock.stopTime,h=u.secondsDifference(s,o),c=u.secondsDifference(o,this._startJulian),l=u.secondsDifference(s,this._endJulian);this._timeBarSecondsSpan>=h?(this._timeBarSecondsSpan=h,this._startJulian=this._clock.startTime,this._endJulian=this._clock.stopTime):c>0?(this._endJulian=u.addSeconds(this._endJulian,c,new u),this._startJulian=o,this._timeBarSecondsSpan=u.secondsDifference(this._endJulian,this._startJulian)):l<0&&(this._startJulian=u.addSeconds(this._startJulian,l,new u),this._endJulian=s,this._timeBarSecondsSpan=u.secondsDifference(this._endJulian,this._startJulian))}this._makeTics();e=document.createEvent("Event");e.initEvent("setzoom",!0,!0);e.startJulian=this._startJulian;e.endJulian=this._endJulian;e.epochJulian=this._epochJulian;e.totalSpan=this._timeBarSecondsSpan;e.mainTicSpan=this._mainTicSpan;this._topDiv.dispatchEvent(e)},h.prototype.zoomFrom=function(n){var t=u.secondsDifference(this._scrubJulian,this._startJulian),i;n>1||t<0||t>this._timeBarSecondsSpan?t=this._timeBarSecondsSpan*.5:t+=t-this._timeBarSecondsSpan*.5;i=this._timeBarSecondsSpan-t;this.zoomTo(u.addSeconds(this._startJulian,t-t*n,new u),u.addSeconds(this._endJulian,i*n-i,new u))},h.prototype.makeLabel=function(n){var t=u.toGregorianDate(n),r=t.millisecond,i=" UTC";if(r>0&&this._timeBarSecondsSpan<3600){for(i=Math.floor(r).toString();i.length<3;)i="0"+i;i="."+i}return y[t.month-1]+" "+t.day+" "+t.year+" "+v(t.hour)+":"+v(t.minute)+":"+v(t.second)+i},h.prototype.smallestTicInPixels=7,h.prototype._makeTics=function(){function ht(n){return Math.floor(h/n)*n}function ct(n,t){return Math.ceil(n/t+.5)*t}function rt(n){return(n-h)/i}function bt(n,t){return n-t*Math.round(n/t)}var pt=this._timeBarEle,dt=u.secondsDifference(this._scrubJulian,this._startJulian),wt=Math.round(dt*this._topDiv.clientWidth/this._timeBarSecondsSpan),gt=wt-8,n,ni=this,t,h,w,b,kt,k,d,lt,g,at,et,vt,ot,yt,st;this._needleEle.style.left=wt.toString()+"px";var s="",y=.01,nt=31536e6,tt=1e-10,r=0,i=this._timeBarSecondsSpan;i<y?(i=y,this._timeBarSecondsSpan=y,this._endJulian=u.addSeconds(this._startJulian,y,new u)):i>nt&&(i=nt,this._timeBarSecondsSpan=nt,this._endJulian=u.addSeconds(this._startJulian,nt,new u));t=this._timeBarEle.clientWidth;t<10&&(t=10);var it=this._startJulian,ti=Math.min(i/t*1e-5,.4),p,c=u.toGregorianDate(it);p=i>31536e4?u.fromDate(new Date(Date.UTC(Math.floor(c.year/100)*100,0))):i>31536e3?u.fromDate(new Date(Date.UTC(Math.floor(c.year/10)*10,0))):i>86400?u.fromDate(new Date(Date.UTC(c.year,0))):u.fromDate(new Date(Date.UTC(c.year,c.month,c.day)));h=u.secondsDifference(this._startJulian,u.addSeconds(p,ti,new u));w=h+i;this._epochJulian=p;this._rulerEle.innerHTML=this.makeLabel(u.addSeconds(this._endJulian,-y,new u));b=this._rulerEle.offsetWidth+20;b<30&&(b=180);kt=r;r-=tt;k={startTime:h,startJulian:it,epochJulian:p,duration:i,timeBarWidth:t,getAlpha:rt};this._highlightRanges.forEach(function(n){s+=n.render(k)});var f=0,a=0,v=0,ut=b/t;ut>1&&(ut=1);ut*=this._timeBarSecondsSpan;for(var e=-1,o=-1,ii=l.length,ft=0;ft<ii;++ft){if(d=l[ft],++e,f=d,d>ut&&d>r)break;o<0&&t*(d/this._timeBarSecondsSpan)>=this.smallestTicInPixels&&(o=e)}if(e>0){while(e>0)if(--e,Math.abs(bt(f,l[e]))<1e-5){l[e]>=r&&(a=l[e]);break}if(o>=0)while(o<e){if(Math.abs(bt(a,l[o]))<1e-5&&l[o]>=r){v=l[o];break}++o}}if(r=kt,r>tt&&v<1e-5&&Math.abs(r-f)>tt&&(v=r,r<=f+tt&&(a=0)),lt=-999999,t*(v/this._timeBarSecondsSpan)>=3)for(n=ht(v);n<=w;n=ct(n,v))s+='<span class="cesium-timeline-ticTiny" style="left: '+Math.round(t*rt(n)).toString()+'px;"><\/span>';if(t*(a/this._timeBarSecondsSpan)>=3)for(n=ht(a);n<=w;n=ct(n,a))s+='<span class="cesium-timeline-ticSub" style="left: '+Math.round(t*rt(n)).toString()+'px;"><\/span>';if(t*(f/this._timeBarSecondsSpan)>=2)for(this._mainTicSpan=f,w+=f,n=ht(f),at=u.computeTaiMinusUtc(p);n<=w;)et=u.addSeconds(it,n-h,new u),f>2.1&&(vt=u.computeTaiMinusUtc(et),Math.abs(vt-at)>.1&&(n+=vt-at,et=u.addSeconds(it,n-h,new u))),ot=Math.round(t*rt(n)),yt=this.makeLabel(et),this._rulerEle.innerHTML=yt,g=this._rulerEle.offsetWidth,g<10&&(g=b),st=ot-(g/2-1),st>lt?(lt=st+g+5,s+='<span class="cesium-timeline-ticMain" style="left: '+ot.toString()+'px;"><\/span><span class="cesium-timeline-ticLabel" style="left: '+st.toString()+'px;">'+yt+"<\/span>"):s+='<span class="cesium-timeline-ticSub" style="left: '+ot.toString()+'px;"><\/span>',n=ct(n,f);else this._mainTicSpan=-1;s+='<span class="cesium-timeline-icon16" style="left:'+gt+'px;bottom:0;background-position: 0 0;"><\/span>';pt.innerHTML=s;this._scrubElement=pt.lastChild;this._context.clearRect(0,0,this._trackListEle.width,this._trackListEle.height);k.y=0;this._trackList.forEach(function(n){n.render(ni._context,k);k.y+=n.height})},h.prototype.updateFromClock=function(){var i,r,n;this._scrubJulian=this._clock.currentTime;i=this._scrubElement;t(this._scrubElement)&&(r=u.secondsDifference(this._scrubJulian,this._startJulian),n=Math.round(r*this._topDiv.clientWidth/this._timeBarSecondsSpan),this._lastXPos!==n&&(this._lastXPos=n,i.style.left=n-8+"px",this._needleEle.style.left=n+"px"));t(this._timelineDragLocation)&&(this._setTimeBarTime(this._timelineDragLocation,this._timelineDragLocation*this._timeBarSecondsSpan/this._topDiv.clientWidth),this.zoomTo(u.addSeconds(this._startJulian,this._timelineDrag,new u),u.addSeconds(this._endJulian,this._timelineDrag,new u)))},h.prototype._setTimeBarTime=function(n,t){var r,i;n=Math.round(n);this._scrubJulian=u.addSeconds(this._startJulian,t,new u);this._scrubElement&&(r=n-8,this._scrubElement.style.left=r.toString()+"px",this._needleEle.style.left=n.toString()+"px");i=document.createEvent("Event");i.initEvent("settime",!0,!0);i.clientX=n;i.timeSeconds=t;i.timeJulian=this._scrubJulian;i.clock=this._clock;this._topDiv.dispatchEvent(i)},h.prototype.resize=function(){var i=this.container.clientWidth,t=this.container.clientHeight,n;(i!==this._lastWidth||t!==this._lastHeight)&&(this._trackContainer.style.height=t+"px",n=1,this._trackList.forEach(function(t){n+=t.height}),this._trackListEle.style.height=n.toString()+"px",this._trackListEle.width=this._trackListEle.clientWidth,this._trackListEle.height=n,this._makeTics(),this._lastXPos=undefined,this._lastWidth=i,this._lastHeight=t)},h});t("Widgets/VRButton/VRButtonViewModel",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/EventHelper","../../Core/Fullscreen","../../Core/OrthographicFrustum","../../ThirdParty/knockout","../../ThirdParty/NoSleep","../createCommand","../getElement"],function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";function y(n){var r=!1,i=window.screen;return t(i)&&(t(i.lockOrientation)?r=i.lockOrientation(n):t(i.mozLockOrientation)?r=i.mozLockOrientation(n):t(i.msLockOrientation)?r=i.msLockOrientation(n):t(i.orientation&&i.orientation.lock)&&(r=i.orientation.lock(n))),r}function v(){var n=window.screen;t(n)&&(t(n.unlockOrientation)?n.unlockOrientation():t(n.mozUnlockOrientation)?n.mozUnlockOrientation():t(n.msUnlockOrientation)?n.msUnlockOrientation():t(n.orientation&&n.orientation.unlock)&&n.orientation.unlock())}function p(n,t,i,r){r()||(i()?(t.useWebVR=!1,n._locked&&(v(),n._locked=!1),n._noSleep.disable(),e.exitFullscreen(),i(!1)):(e.fullscreen||e.requestFullscreen(n._vrElement),n._noSleep.enable(),n._locked||(n._locked=y("landscape")),t.useWebVR=!0,i(!0)))}function a(i,r){var w;if(!t(i))throw new u("scene is required.");var y=this,b=s.observable(e.enabled),a=s.observable(!1);this.isVRMode=undefined;s.defineProperty(this,"isVRMode",{get:function(){return a()}});this.isVREnabled=undefined;s.defineProperty(this,"isVREnabled",{get:function(){return b()},set:function(n){b(n&&e.enabled)}});this.tooltip=undefined;s.defineProperty(this,"tooltip",function(){return b()?a()?"Exit VR mode":"Enter VR mode":"VR mode is unavailable"});w=s.observable(!1);this._isOrthographic=undefined;s.defineProperty(this,"_isOrthographic",{get:function(){return w()}});this._eventHelper=new f;this._eventHelper.add(i.preRender,function(){w(i.camera.frustum instanceof o)});this._locked=!1;this._noSleep=new h;this._command=c(function(){p(y,i,a,w)},s.getObservable(this,"isVREnabled"));this._vrElement=n(l(r),document.body);this._callback=function(){!e.fullscreen&&a()&&(i.useWebVR=!1,y._locked&&(v(),y._locked=!1),y._noSleep.disable(),a(!1))};document.addEventListener(e.changeEventName,this._callback)}return i(a.prototype,{vrElement:{get:function(){return this._vrElement},set:function(n){if(!(n instanceof Element))throw new u("value must be a valid Element.");this._vrElement=n}},command:{get:function(){return this._command}}}),a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){this._eventHelper.removeAll();document.removeEventListener(e.changeEventName,this._callback);r(this)},a});t("Widgets/VRButton/VRButton",["../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../ThirdParty/knockout","../getElement","./VRButtonViewModel"],function(n,t,i,r,u,f,e){"use strict";function o(t,i,o){var l,c;if(!n(t))throw new r("container is required.");if(!n(i))throw new r("scene is required.");t=f(t);l=new e(i,o);l._exitVRPath=h;l._enterVRPath=s;c=document.createElement("button");c.type="button";c.className="cesium-button cesium-vrButton";c.setAttribute("data-bind",'css: { "cesium-button-disabled" : _isOrthographic }, attr: { title: tooltip },click: command,enable: isVREnabled,cesiumSvgPath: { path: isVRMode ? _exitVRPath : _enterVRPath, width: 32, height: 32 }');t.appendChild(c);u.applyBindings(l,c);this._container=t;this._viewModel=l;this._element=c}var s="M 5.3125 6.375 C 4.008126 6.375 2.96875 7.4141499 2.96875 8.71875 L 2.96875 19.5 C 2.96875 20.8043 4.008126 21.875 5.3125 21.875 L 13.65625 21.875 C 13.71832 20.0547 14.845166 18.59375 16.21875 18.59375 C 17.592088 18.59375 18.71881 20.0552 18.78125 21.875 L 27.09375 21.875 C 28.398125 21.875 29.4375 20.8043 29.4375 19.5 L 29.4375 8.71875 C 29.4375 7.4141499 28.398125 6.375 27.09375 6.375 L 5.3125 6.375 z M 9.625 10.4375 C 11.55989 10.4375 13.125 12.03385 13.125 13.96875 C 13.125 15.90365 11.55989 17.46875 9.625 17.46875 C 7.69011 17.46875 6.125 15.90365 6.125 13.96875 C 6.125 12.03385 7.69011 10.4375 9.625 10.4375 z M 22.46875 10.4375 C 24.40364 10.4375 25.96875 12.03385 25.96875 13.96875 C 25.96875 15.90365 24.40364 17.46875 22.46875 17.46875 C 20.53386 17.46875 18.96875 15.90365 18.96875 13.96875 C 18.96875 12.03385 20.53386 10.4375 22.46875 10.4375 z",h="M 25.770585,2.4552065 C 15.72282,13.962707 10.699956,19.704407 8.1768352,22.580207 c -1.261561,1.4379 -1.902282,2.1427 -2.21875,2.5 -0.141624,0.1599 -0.208984,0.2355 -0.25,0.2813 l 0.6875,0.75 c 10e-5,-10e-5 0.679191,0.727 0.6875,0.7187 0.01662,-0.016 0.02451,-0.024 0.03125,-0.031 0.01348,-0.014 0.04013,-0.038 0.0625,-0.062 0.04474,-0.05 0.120921,-0.1315 0.28125,-0.3126 0.320657,-0.3619 0.956139,-1.0921 2.2187499,-2.5312 2.5252219,-2.8781 7.5454589,-8.6169 17.5937499,-20.1250005 l -1.5,-1.3125 z m -20.5624998,3.9063 c -1.304375,0 -2.34375,1.0391 -2.34375,2.3437 l 0,10.8125005 c 0,1.3043 1.039375,2.375 2.34375,2.375 l 2.25,0 c 1.9518039,-2.2246 7.4710958,-8.5584 13.5624998,-15.5312005 l -15.8124998,0 z m 21.1249998,0 c -1.855467,2.1245 -2.114296,2.4005 -3.59375,4.0936995 1.767282,0.1815 3.15625,1.685301 3.15625,3.500001 0,1.9349 -1.56511,3.5 -3.5,3.5 -1.658043,0 -3.043426,-1.1411 -3.40625,-2.6875 -1.089617,1.2461 -2.647139,2.9988 -3.46875,3.9375 0.191501,-0.062 0.388502,-0.094 0.59375,-0.094 1.373338,0 2.50006,1.4614 2.5625,3.2812 l 8.3125,0 c 1.304375,0 2.34375,-1.0707 2.34375,-2.375 l 0,-10.8125005 c 0,-1.3046 -1.039375,-2.3437 -2.34375,-2.3437 l -0.65625,0 z M 9.5518351,10.423906 c 1.9348899,0 3.4999999,1.596401 3.4999999,3.531301 0,1.9349 -1.56511,3.5 -3.4999999,3.5 -1.9348899,0 -3.4999999,-1.5651 -3.4999999,-3.5 0,-1.9349 1.56511,-3.531301 3.4999999,-3.531301 z m 4.2187499,10.312601 c -0.206517,0.2356 -0.844218,0.9428 -1.03125,1.1562 l 0.8125,0 c 0.01392,-0.4081 0.107026,-0.7968 0.21875,-1.1562 z";return t(o.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}}),o.prototype.isDestroyed=function(){return!1},o.prototype.destroy=function(){return this._viewModel.destroy(),u.cleanNode(this._element),this._container.removeChild(this._element),i(this)},o});t("Widgets/Viewer/Viewer",["../../Core/BoundingSphere","../../Core/Cartesian3","../../Core/Cartographic","../../Core/Clock","../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/destroyObject","../../Core/DeveloperError","../../Core/Event","../../Core/EventHelper","../../Core/HeadingPitchRange","../../Core/isArray","../../Core/Matrix4","../../Core/Rectangle","../../Core/ScreenSpaceEventType","../../DataSources/BoundingSphereState","../../DataSources/ConstantPositionProperty","../../DataSources/DataSourceCollection","../../DataSources/DataSourceDisplay","../../DataSources/Entity","../../DataSources/EntityView","../../DataSources/Property","../../Scene/Cesium3DTileset","../../Scene/computeFlyToLocationForRectangle","../../Scene/ImageryLayer","../../Scene/SceneMode","../../Scene/TimeDynamicPointCloud","../../ThirdParty/knockout","../../ThirdParty/when","../Animation/Animation","../Animation/AnimationViewModel","../BaseLayerPicker/BaseLayerPicker","../BaseLayerPicker/createDefaultImageryProviderViewModels","../BaseLayerPicker/createDefaultTerrainProviderViewModels","../CesiumWidget/CesiumWidget","../ClockViewModel","../FullscreenButton/FullscreenButton","../Geocoder/Geocoder","../getElement","../HomeButton/HomeButton","../InfoBox/InfoBox","../NavigationHelpButton/NavigationHelpButton","../ProjectionPicker/ProjectionPicker","../SceneModePicker/SceneModePicker","../SelectionIndicator/SelectionIndicator","../subscribeAndEvaluate","../Timeline/Timeline","../VRButton/VRButton"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei){"use strict";function li(n){var t=n.clock;t.currentTime=n.timeJulian;t.shouldAnimate=!1}function ai(n,t){var i=n.scene.pick(t.position),r;return f(i)&&(r=u(i.id,i.primitive.id),r instanceof g)?r:f(n.scene.globe)?bi(n,t.position):void 0}function vi(n,t,i){if(f(i)){var r=i.clock;f(r)&&(r.getValue(t),f(n)&&(n.updateFromClock(),n.zoomTo(r.startTime,r.stopTime)))}}function bi(n,t){var r=n.scene,e=r.camera.getPickRay(t),u=r.imageryLayers.pickImageryLayerFeatures(e,r),i;if(f(u))return i=new g({id:"Loading...",description:"Loading feature information..."}),st(u,function(t){var r,u,e;if(n.selectedEntity===i){if(!f(t)||t.length===0){n.selectedEntity=yi();return}r=t[0];u=new g({id:r.name,description:r.description});f(r.position)&&(e=n.scene.globe.ellipsoid.cartographicToCartesian(r.position,wi),u.position=new b(e));n.selectedEntity=u}},function(){n.selectedEntity===i&&(n.selectedEntity=yi())}),i}function yi(){return new g({id:"None",description:"No features found."})}function ki(n,t){var u=n._geocoder,e=n._homeButton,o=n._sceneModePicker,s=n._projectionPicker,h=n._baseLayerPicker,c=n._animation,l=n._timeline,r=n._fullscreenButton,a=n._infoBox,v=n._selectionIndicator,i=t?"hidden":"visible",y;f(u)&&(u.container.style.visibility=i);f(e)&&(e.container.style.visibility=i);f(o)&&(o.container.style.visibility=i);f(s)&&(s.container.style.visibility=i);f(h)&&(h.container.style.visibility=i);f(c)&&(c.container.style.visibility=i);f(l)&&(l.container.style.visibility=i);f(r)&&r.viewModel.isFullscreenEnabled&&(r.container.style.visibility=i);f(a)&&(a.container.style.visibility=i);f(v)&&(v.container.style.visibility=i);n._container&&(y=t||!f(r)?0:r.container.clientWidth,n._vrButton.container.style.right=y+"px",n.forceResize())}function oi(n,t){function tu(n){var t=ai(b,n);f(t)&&(tt.getValueOrUndefined(t.position,b.clock.currentTime)?b.trackedEntity=t:b.zoomTo(t))}function iu(n){b.selectedEntity=ai(b,n)}var g,b,o,et,rt,st,w,ut,ir,rr,hi,ci,vi,ur,v,ft,yi,hr,pi,cr,lr,wi,ar,vr,yr,pr,wr,fr,er,br,bi,y,di,gi,kr,nt,nr,dr,gr,it,nu,tr;if(!f(n))throw new s("container is required.");if(n=kt(n),t=u(t,u.EMPTY_OBJECT),g=(!f(t.globe)||t.globe!==!1)&&(!f(t.baseLayerPicker)||t.baseLayerPicker!==!1),!g&&f(t.selectedImageryProviderViewModel))throw new s("options.selectedImageryProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.imageryProvider instead or set options.baseLayerPicker to true.");if(!g&&f(t.selectedTerrainProviderViewModel))throw new s("options.selectedTerrainProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.terrainProvider instead or set options.baseLayerPicker to true.");b=this;o=document.createElement("div");o.className="cesium-viewer";n.appendChild(o);et=document.createElement("div");et.className="cesium-viewer-cesiumWidgetContainer";o.appendChild(et);rt=document.createElement("div");rt.className="cesium-viewer-bottom";o.appendChild(rt);st=u(t.scene3DOnly,!1);ir=!1;f(t.clockViewModel)?(ut=t.clockViewModel,w=ut.clock):(w=new r,ut=new pt(w),ir=!0);f(t.shouldAnimate)&&(w.shouldAnimate=t.shouldAnimate);var si=new yt(et,{imageryProvider:g||f(t.imageryProvider)?!1:undefined,clock:w,skyBox:t.skyBox,skyAtmosphere:t.skyAtmosphere,sceneMode:t.sceneMode,mapProjection:t.mapProjection,globe:t.globe,orderIndependentTranslucency:t.orderIndependentTranslucency,contextOptions:t.contextOptions,useDefaultRenderLoop:t.useDefaultRenderLoop,targetFrameRate:t.targetFrameRate,showRenderLoopErrors:t.showRenderLoopErrors,creditContainer:f(t.creditContainer)?t.creditContainer:rt,creditViewport:t.creditViewport,scene3DOnly:st,terrainExaggeration:t.terrainExaggeration,shadows:t.shadows,terrainShadows:t.terrainShadows,mapMode2D:t.mapMode2D,requestRenderMode:t.requestRenderMode,maximumRenderTimeChange:t.maximumRenderTimeChange}),l=t.dataSources,or=!1;f(l)||(l=new k,or=!0);var i=si.scene,sr=new d({scene:i,dataSourceCollection:l}),e=new c;if(e.add(w.onTick,oi.prototype._onTick,this),e.add(i.morphStart,oi.prototype._clearTrackedObject,this),f(t.selectionIndicator)&&t.selectionIndicator===!1||(hi=document.createElement("div"),hi.className="cesium-viewer-selectionIndicatorContainer",o.appendChild(hi),rr=new ri(hi,i)),f(t.infoBox)&&t.infoBox===!1||(vi=document.createElement("div"),vi.className="cesium-viewer-infoBoxContainer",o.appendChild(vi),ci=new gt(vi),ur=ci.viewModel,e.add(ur.cameraClicked,oi.prototype._onInfoBoxCameraClicked,this),e.add(ur.closeClicked,oi.prototype._onInfoBoxClockClicked,this)),v=document.createElement("div"),v.className="cesium-viewer-toolbar",o.appendChild(v),f(t.geocoder)&&t.geocoder===!1||(yi=document.createElement("div"),yi.className="cesium-viewer-geocoderContainer",v.appendChild(yi),f(t.geocoder)&&typeof t.geocoder!="boolean"&&(hr=a(t.geocoder)?t.geocoder:[t.geocoder]),ft=new bt({container:yi,geocoderServices:hr,scene:i}),e.add(ft.viewModel.search.beforeExecute,oi.prototype._clearObjects,this)),f(t.homeButton)&&t.homeButton===!1||(pi=new dt(v,i),f(ft)&&e.add(pi.viewModel.command.afterExecute,function(){var n=ft.viewModel;n.searchText="";n.isSearchInProgress&&n.search()}),e.add(pi.viewModel.command.beforeExecute,oi.prototype._clearTrackedObject,this)),t.sceneModePicker===!0&&st)throw new s("options.sceneModePicker is not available when options.scene3DOnly is set to true.");if(st||f(t.sceneModePicker)&&t.sceneModePicker===!1||(cr=new ii(v,i)),t.projectionPicker&&(lr=new ti(v,i)),g&&(vr=u(t.imageryProviderViewModels,at()),yr=u(t.terrainProviderViewModels,vt()),wi=new lt(v,{globe:i.globe,imageryProviderViewModels:vr,selectedImageryProviderViewModel:t.selectedImageryProviderViewModel,terrainProviderViewModels:yr,selectedTerrainProviderViewModel:t.selectedTerrainProviderViewModel}),pr=v.getElementsByClassName("cesium-baseLayerPicker-dropDown"),ar=pr[0]),f(t.imageryProvider)&&t.imageryProvider!==!1&&(g&&(wi.viewModel.selectedImagery=undefined),i.imageryLayers.removeAll(),i.imageryLayers.addImageryProvider(t.imageryProvider)),f(t.terrainProvider)&&(g&&(wi.viewModel.selectedTerrain=undefined),i.terrainProvider=t.terrainProvider),!f(t.navigationHelpButton)||t.navigationHelpButton!==!1){fr=!0;try{f(window.localStorage)&&(er=window.localStorage.getItem("cesium-hasSeenNavHelp"),f(er)&&Boolean(er)?fr=!1:window.localStorage.setItem("cesium-hasSeenNavHelp","true"))}catch(ru){}wr=new ni({container:v,instructionsInitiallyVisible:u(t.navigationInstructionsInitiallyVisible,fr)})}for(f(t.animation)&&t.animation===!1||(bi=document.createElement("div"),bi.className="cesium-viewer-animationContainer",o.appendChild(bi),br=new ht(bi,new ct(ut))),f(t.timeline)&&t.timeline===!1||(di=document.createElement("div"),di.className="cesium-viewer-timelineContainer",o.appendChild(di),y=new fi(di,w),y.addEventListener("settime",li,!1),y.zoomTo(w.startTime,w.stopTime)),f(t.fullscreenButton)&&t.fullscreenButton===!1||(nt=document.createElement("div"),nt.className="cesium-viewer-fullscreenContainer",o.appendChild(nt),gi=new wt(nt,t.fullscreenElement),kr=ui(gi.viewModel,"isFullscreenEnabled",function(n){nt.style.display=n?"block":"none";f(y)&&(y.container.style.right=nt.clientWidth+"px",y.resize())})),t.vrButton&&(it=document.createElement("div"),it.className="cesium-viewer-vrContainer",o.appendChild(it),nr=new ei(it,i,t.fullScreenElement),dr=ui(nr.viewModel,"isVREnabled",function(n){it.style.display=n?"block":"none";f(gi)&&(it.style.right=nt.clientWidth+"px");f(y)&&(y.container.style.right=it.clientWidth+"px",y.resize())}),gr=ui(nr.viewModel,"isVRMode",function(n){ki(b,n)})),this._baseLayerPickerDropDown=ar,this._fullscreenSubscription=kr,this._vrSubscription=dr,this._vrModeSubscription=gr,this._dataSourceChangedListeners={},this._automaticallyTrackDataSourceClocks=u(t.automaticallyTrackDataSourceClocks,!0),this._container=n,this._bottomContainer=rt,this._element=o,this._cesiumWidget=si,this._selectionIndicator=rr,this._infoBox=ci,this._dataSourceCollection=l,this._destroyDataSourceCollection=or,this._dataSourceDisplay=sr,this._clockViewModel=ut,this._destroyClockViewModel=ir,this._toolbar=v,this._homeButton=pi,this._sceneModePicker=cr,this._projectionPicker=lr,this._baseLayerPicker=wi,this._navigationHelpButton=wr,this._animation=br,this._timeline=y,this._fullscreenButton=gi,this._vrButton=nr,this._geocoder=ft,this._eventHelper=e,this._lastWidth=0,this._lastHeight=0,this._allowDataSourcesToSuspendAnimation=!0,this._entityView=undefined,this._enableInfoOrSelection=f(ci)||f(rr),this._clockTrackedDataSource=undefined,this._trackedEntity=undefined,this._needTrackedEntityUpdate=!1,this._selectedEntity=undefined,this._clockTrackedDataSource=undefined,this._forceResize=!1,this._zoomIsFlight=!1,this._zoomTarget=undefined,this._zoomPromise=undefined,this._zoomOptions=undefined,this._selectedEntityChanged=new h,this._trackedEntityChanged=new h,ot.track(this,["_trackedEntity","_selectedEntity","_clockTrackedDataSource"]),e.add(l.dataSourceAdded,oi.prototype._onDataSourceAdded,this),e.add(l.dataSourceRemoved,oi.prototype._onDataSourceRemoved,this),e.add(i.postUpdate,oi.prototype.resize,this),e.add(i.postRender,oi.prototype._postRender,this),nu=l.length,tr=0;tr<nu;tr++)this._dataSourceAdded(l,l.get(tr));this._dataSourceAdded(undefined,sr.defaultDataSource);e.add(l.dataSourceAdded,oi.prototype._dataSourceAdded,this);e.add(l.dataSourceRemoved,oi.prototype._dataSourceRemoved,this);si.screenSpaceEventHandler.setInputAction(iu,p.LEFT_CLICK);si.screenSpaceEventHandler.setInputAction(tu,p.LEFT_DOUBLE_CLICK)}function pi(n,t,i,r){if(!f(t))throw new s("zoomTarget is required.");ci(n);var e=st.defer();return n._zoomPromise=e,n._zoomIsFlight=r,n._zoomOptions=i,st(t,function(t){if(n._zoomPromise===e){if(t instanceof ut){t.getViewableRectangle().then(function(t){return rt(t,n.scene)}).then(function(t){n._zoomPromise===e&&(n._zoomTarget=t)});return}if(t instanceof it){n._zoomTarget=t;return}if(t instanceof et){n._zoomTarget=t;return}if(t.isLoading&&f(t.loadingEvent)){var i=t.loadingEvent.addEventListener(function(){i();n._zoomPromise===e&&(n._zoomTarget=t.entities.values.slice(0))});return}if(a(t)){n._zoomTarget=t.slice(0);return}t=u(t.values,t);f(t.entities)&&(t=t.entities.values);n._zoomTarget=a(t)?t.slice(0):[t]}}),n.scene.requestRender(),e.promise}function hi(n){n._zoomPromise=undefined;n._zoomTarget=undefined;n._zoomOptions=undefined}function ci(n){var t=n._zoomPromise;f(t)&&(hi(n),t.resolve(!1))}function di(t){var e=t._zoomTarget,k,c,d,a,p,tt,g;if(f(e)&&t.scene.mode!==ft.MORPHING){var nt=t.scene,s=nt.camera,o=t._zoomPromise,r=u(t._zoomOptions,{}),h,b;if(e instanceof it)return e.readyPromise.then(function(){var n=e.boundingSphere;f(r.offset)||(r.offset=new l(0,-.5,n.radius));h={offset:r.offset,duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)}};t._zoomIsFlight?s.flyToBoundingSphere(e.boundingSphere,h):(s.viewBoundingSphere(n,r.offset),s.lookAtTransform(v.IDENTITY),o.resolve(!0));hi(t)});if(e instanceof et)return e.readyPromise.then(function(){var n=e.boundingSphere;f(r.offset)||(r.offset=new l(0,-.5,n.radius));h={offset:r.offset,duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)}};t._zoomIsFlight?s.flyToBoundingSphere(n,h):(s.viewBoundingSphere(n,r.offset),s.lookAtTransform(v.IDENTITY),o.resolve(!0));hi(t)});if(k=e instanceof i,e instanceof y||k){c=e;k&&(c=nt.mapProjection.ellipsoid.cartographicToCartesian(c));h={destination:c,duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)}};t._zoomIsFlight?s.flyTo(h):(s.setView(h),o.resolve(!0));hi(t);return}for(d=e,a=[],p=0,tt=d.length;p<tt;p++){if(g=t._dataSourceDisplay.getBoundingSphere(d[p],!1,si),g===w.PENDING)return;g!==w.FAILED&&a.push(n.clone(si))}if(a.length===0){ci(t);return}t.trackedEntity=undefined;b=n.fromBoundingSpheres(a);t._zoomIsFlight?(hi(t),s.flyToBoundingSphere(b,{duration:r.duration,maximumHeight:r.maximumHeight,complete:function(){o.resolve(!0)},cancel:function(){o.resolve(!1)},offset:r.offset})):(s.viewBoundingSphere(b,r.offset),s.lookAtTransform(v.IDENTITY),hi(t),o.resolve(!0))}}function gi(n){var t,u,i,o;if(n._needTrackedEntityUpdate){var r=n._trackedEntity,e=n.clock.currentTime,s=tt.getValueOrUndefined(r.position,e);f(s)&&(t=n.scene,u=n._dataSourceDisplay.getBoundingSphere(r,!1,si),u!==w.PENDING)&&(i=t.mode,(i===ft.COLUMBUS_VIEW||i===ft.SCENE2D)&&(t.screenSpaceCameraController.enableTranslate=!1),(i===ft.COLUMBUS_VIEW||i===ft.SCENE3D)&&(t.screenSpaceCameraController.enableTilt=!1),o=u!==w.FAILED?si:undefined,n._entityView=new nt(r,t,t.mapProjection.ellipsoid),n._entityView.update(e,o),n._needTrackedEntityUpdate=!1)}}var si=new n,wi=new t;return e(oi.prototype,{container:{get:function(){return this._container}},bottomContainer:{get:function(){return this._bottomContainer}},cesiumWidget:{get:function(){return this._cesiumWidget}},selectionIndicator:{get:function(){return this._selectionIndicator}},infoBox:{get:function(){return this._infoBox}},geocoder:{get:function(){return this._geocoder}},homeButton:{get:function(){return this._homeButton}},sceneModePicker:{get:function(){return this._sceneModePicker}},projectionPicker:{get:function(){return this._projectionPicker}},baseLayerPicker:{get:function(){return this._baseLayerPicker}},navigationHelpButton:{get:function(){return this._navigationHelpButton}},animation:{get:function(){return this._animation}},timeline:{get:function(){return this._timeline}},fullscreenButton:{get:function(){return this._fullscreenButton}},vrButton:{get:function(){return this._vrButton}},dataSourceDisplay:{get:function(){return this._dataSourceDisplay}},entities:{get:function(){return this._dataSourceDisplay.defaultDataSource.entities}},dataSources:{get:function(){return this._dataSourceCollection}},canvas:{get:function(){return this._cesiumWidget.canvas}},scene:{get:function(){return this._cesiumWidget.scene}},shadows:{get:function(){return this.scene.shadowMap.enabled},set:function(n){this.scene.shadowMap.enabled=n}},terrainShadows:{get:function(){return this.scene.globe.shadows},set:function(n){this.scene.globe.shadows=n}},shadowMap:{get:function(){return this.scene.shadowMap}},imageryLayers:{get:function(){return this.scene.imageryLayers}},terrainProvider:{get:function(){return this.scene.terrainProvider},set:function(n){this.scene.terrainProvider=n}},camera:{get:function(){return this.scene.camera}},postProcessStages:{get:function(){return this.scene.postProcessStages}},clock:{get:function(){return this._clockViewModel.clock}},clockViewModel:{get:function(){return this._clockViewModel}},screenSpaceEventHandler:{get:function(){return this._cesiumWidget.screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._cesiumWidget.targetFrameRate},set:function(n){this._cesiumWidget.targetFrameRate=n}},useDefaultRenderLoop:{get:function(){return this._cesiumWidget.useDefaultRenderLoop},set:function(n){this._cesiumWidget.useDefaultRenderLoop=n}},resolutionScale:{get:function(){return this._cesiumWidget.resolutionScale},set:function(n){this._cesiumWidget.resolutionScale=n;this._forceResize=!0}},allowDataSourcesToSuspendAnimation:{get:function(){return this._allowDataSourcesToSuspendAnimation},set:function(n){this._allowDataSourcesToSuspendAnimation=n}},trackedEntity:{get:function(){return this._trackedEntity},set:function(n){if(this._trackedEntity!==n){this._trackedEntity=n;ci(this);var i=this.scene,t=i.mode;f(n)&&f(n.position)?this._needTrackedEntityUpdate=!0:(this._needTrackedEntityUpdate=!1,(t===ft.COLUMBUS_VIEW||t===ft.SCENE2D)&&(i.screenSpaceCameraController.enableTranslate=!0),(t===ft.COLUMBUS_VIEW||t===ft.SCENE3D)&&(i.screenSpaceCameraController.enableTilt=!0),this._entityView=undefined,this.camera.lookAtTransform(v.IDENTITY));this._trackedEntityChanged.raiseEvent(n);this.scene.requestRender()}}},selectedEntity:{get:function(){return this._selectedEntity},set:function(n){if(this._selectedEntity!==n){this._selectedEntity=n;var t=f(this._selectionIndicator)?this._selectionIndicator.viewModel:undefined;f(n)?f(t)&&t.animateAppear():f(t)&&t.animateDepart();this._selectedEntityChanged.raiseEvent(n)}}},selectedEntityChanged:{get:function(){return this._selectedEntityChanged}},trackedEntityChanged:{get:function(){return this._trackedEntityChanged}},clockTrackedDataSource:{get:function(){return this._clockTrackedDataSource},set:function(n){this._clockTrackedDataSource!==n&&(this._clockTrackedDataSource=n,vi(this._timeline,this.clock,n))}}}),oi.prototype.extend=function(n,t){if(!f(n))throw new s("mixin is required.");n(this,t)},oi.prototype.resize=function(){var k=this._cesiumWidget,h=this._container,r=h.clientWidth,o=h.clientHeight,d=f(this._animation),g=f(this._timeline),u,s,c,t,e;if(this._forceResize||r!==this._lastWidth||o!==this._lastHeight){k.resize();this._forceResize=!1;u=o-125;s=this._baseLayerPickerDropDown;f(s)&&(s.style.maxHeight=u+"px");f(this._geocoder)&&(c=this._geocoder.searchSuggestionsContainer,c.style.maxHeight=u+"px");f(this._infoBox)&&(this._infoBox.viewModel.maxHeight=u);var l=this._timeline,n,i=0,a=0,v=0;if(d&&window.getComputedStyle(this._animation.container).visibility!=="hidden"&&(t=this._lastWidth,n=this._animation.container,r>900?(i=169,t<=900&&(n.style.width="169px",n.style.height="112px",this._animation.resize())):r>=600?(i=136,(t<600||t>900)&&(n.style.width="136px",n.style.height="90px",this._animation.resize())):(i=106,(t>600||t===0)&&(n.style.width="106px",n.style.height="70px",this._animation.resize())),a=i+5),g&&window.getComputedStyle(this._timeline.container).visibility!=="hidden"){var y=this._fullscreenButton,p=this._vrButton,w=l.container,b=w.style;v=w.clientHeight+3;b.left=i+"px";e=0;f(y)&&(e+=y.container.clientWidth);f(p)&&(e+=p.container.clientWidth);b.right=e+"px";l.resize()}this._bottomContainer.style.left=a+"px";this._bottomContainer.style.bottom=v+"px";this._lastWidth=r;this._lastHeight=o}},oi.prototype.forceResize=function(){this._lastWidth=0;this.resize()},oi.prototype.render=function(){this._cesiumWidget.render()},oi.prototype.isDestroyed=function(){return!1},oi.prototype.destroy=function(){var n,t,i;for(this.screenSpaceEventHandler.removeInputAction(p.LEFT_CLICK),this.screenSpaceEventHandler.removeInputAction(p.LEFT_DOUBLE_CLICK),t=this.dataSources,i=t.length,n=0;n<i;n++)this._dataSourceRemoved(t,t.get(n));return this._dataSourceRemoved(undefined,this._dataSourceDisplay.defaultDataSource),this._container.removeChild(this._element),this._element.removeChild(this._toolbar),this._eventHelper.removeAll(),f(this._geocoder)&&(this._geocoder=this._geocoder.destroy()),f(this._homeButton)&&(this._homeButton=this._homeButton.destroy()),f(this._sceneModePicker)&&(this._sceneModePicker=this._sceneModePicker.destroy()),f(this._projectionPicker)&&(this._projectionPicker=this._projectionPicker.destroy()),f(this._baseLayerPicker)&&(this._baseLayerPicker=this._baseLayerPicker.destroy()),f(this._animation)&&(this._element.removeChild(this._animation.container),this._animation=this._animation.destroy()),f(this._timeline)&&(this._timeline.removeEventListener("settime",li,!1),this._element.removeChild(this._timeline.container),this._timeline=this._timeline.destroy()),f(this._fullscreenButton)&&(this._fullscreenSubscription.dispose(),this._element.removeChild(this._fullscreenButton.container),this._fullscreenButton=this._fullscreenButton.destroy()),f(this._vrButton)&&(this._vrSubscription.dispose(),this._vrModeSubscription.dispose(),this._element.removeChild(this._vrButton.container),this._vrButton=this._vrButton.destroy()),f(this._infoBox)&&(this._element.removeChild(this._infoBox.container),this._infoBox=this._infoBox.destroy()),f(this._selectionIndicator)&&(this._element.removeChild(this._selectionIndicator.container),this._selectionIndicator=this._selectionIndicator.destroy()),this._destroyClockViewModel&&(this._clockViewModel=this._clockViewModel.destroy()),this._dataSourceDisplay=this._dataSourceDisplay.destroy(),this._cesiumWidget=this._cesiumWidget.destroy(),this._destroyDataSourceCollection&&(this._dataSourceCollection=this._dataSourceCollection.destroy()),o(this)},oi.prototype._dataSourceAdded=function(n,t){var i=t.entities;i.collectionChanged.addEventListener(oi.prototype._onEntityCollectionChanged,this)},oi.prototype._dataSourceRemoved=function(n,t){var i=t.entities;i.collectionChanged.removeEventListener(oi.prototype._onEntityCollectionChanged,this);f(this.trackedEntity)&&i.getById(this.trackedEntity.id)===this.trackedEntity&&(this.trackedEntity=undefined);f(this.selectedEntity)&&i.getById(this.selectedEntity.id)===this.selectedEntity&&(this.selectedEntity=undefined)},oi.prototype._onTick=function(n){var o=n.currentTime,p=this._dataSourceDisplay.update(o),c,a,v,y,e,r;this._allowDataSourcesToSuspendAnimation&&(this._clockViewModel.canAnimate=p);c=this._entityView;f(c)&&(a=this._trackedEntity,v=this._dataSourceDisplay.getBoundingSphere(a,!1,si),v===w.DONE&&c.update(o,si));var s,l=!1,i=this.selectedEntity,h=f(i)&&this._enableInfoOrSelection;h&&i.isShowing&&i.isAvailable(o)&&(y=this._dataSourceDisplay.getBoundingSphere(i,!0,si),y!==w.FAILED?s=si.center:f(i.position)&&(s=i.position.getValue(o,s)),l=f(s));e=f(this._selectionIndicator)?this._selectionIndicator.viewModel:undefined;f(e)&&(e.position=t.clone(s,e.position),e.showSelection=h&&l,e.update());r=f(this._infoBox)?this._infoBox.viewModel:undefined;f(r)&&(r.showInfo=h,r.enableCamera=l,r.isCameraTracking=this.trackedEntity===this.selectedEntity,h?(r.titleText=u(i.name,i.id),r.description=tt.getValueOrDefault(i.description,o,"")):(r.titleText="",r.description=""))},oi.prototype._onEntityCollectionChanged=function(n,t,i){for(var u,f=i.length,r=0;r<f;r++)u=i[r],this.trackedEntity===u&&(this.trackedEntity=undefined),this.selectedEntity===u&&(this.selectedEntity=undefined)},oi.prototype._onInfoBoxCameraClicked=function(n){if(n.isCameraTracking&&this.trackedEntity===this.selectedEntity)this.trackedEntity=undefined;else{var t=this.selectedEntity,i=t.position;f(i)?this.trackedEntity=this.selectedEntity:this.zoomTo(this.selectedEntity)}},oi.prototype._clearTrackedObject=function(){this.trackedEntity=undefined},oi.prototype._onInfoBoxClockClicked=function(){this.selectedEntity=undefined},oi.prototype._clearObjects=function(){this.trackedEntity=undefined;this.selectedEntity=undefined},oi.prototype._onDataSourceChanged=function(n){this.clockTrackedDataSource===n&&vi(this.timeline,this.clock,n)},oi.prototype._onDataSourceAdded=function(n,t){this._automaticallyTrackDataSourceClocks&&(this.clockTrackedDataSource=t);var i=t.entities.id,r=this._eventHelper.add(t.changedEvent,oi.prototype._onDataSourceChanged,this);this._dataSourceChangedListeners[i]=r},oi.prototype._onDataSourceRemoved=function(n,t){var u=this.clockTrackedDataSource===t,r=t.entities.id,i;this._dataSourceChangedListeners[r]();this._dataSourceChangedListeners[r]=undefined;u&&(i=n.length,this.clockTrackedDataSource=this._automaticallyTrackDataSourceClocks&&i>0?n.get(i-1):undefined)},oi.prototype.zoomTo=function(n,t){var i={offset:t};return pi(this,n,i,!1)},oi.prototype.flyTo=function(n,t){return pi(this,n,t,!0)},oi.prototype._postRender=function(){di(this);gi(this)},oi});t("Widgets/Viewer/viewerCesium3DTilesInspectorMixin",["../../Core/Check","../../Core/defineProperties","../Cesium3DTilesInspector/Cesium3DTilesInspector"],function(n,t,i){"use strict";function r(r){var u,f;n.typeOf.object("viewer",r);u=document.createElement("div");u.className="cesium-viewer-cesium3DTilesInspectorContainer";r.container.appendChild(u);f=new i(u,r.scene);t(r,{cesium3DTilesInspector:{get:function(){return f}}})}return r});t("Widgets/Viewer/viewerCesiumInspectorMixin",["../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../CesiumInspector/CesiumInspector"],function(n,t,i,r){"use strict";function u(u){var f,e;if(!n(u))throw new i("viewer is required.");f=document.createElement("div");f.className="cesium-viewer-cesiumInspectorContainer";u.container.appendChild(f);e=new r(f,u.scene);t(u,{cesiumInspector:{get:function(){return e}}})}return u});t("Widgets/Viewer/viewerDragDropMixin",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../Core/Event","../../Core/wrapFunction","../../DataSources/CzmlDataSource","../../DataSources/GeoJsonDataSource","../../DataSources/KmlDataSource","../getElement"],function(n,t,i,r,u,f,e,o,s,h){"use strict";function v(e,o){function v(n){var u,f,t,i,r;for(c(n),b&&(e.entities.removeAll(),e.dataSources.removeAll()),u=n.dataTransfer.files,f=u.length,t=0;t<f;t++)i=u[t],r=new FileReader,r.onload=y(e,i,d,k),r.onerror=p(e,i),r.readAsText(i)}if(!t(e))throw new r("viewer is required.");if(e.hasOwnProperty("dropTarget"))throw new r("dropTarget is already defined by another mixin.");if(e.hasOwnProperty("dropEnabled"))throw new r("dropEnabled is already defined by another mixin.");if(e.hasOwnProperty("dropError"))throw new r("dropError is already defined by another mixin.");if(e.hasOwnProperty("clearOnDrop"))throw new r("clearOnDrop is already defined by another mixin.");if(e.hasOwnProperty("flyToOnDrop"))throw new r("flyToOnDrop is already defined by another mixin.");o=n(o,n.EMPTY_OBJECT);var w=!0,g=n(o.flyToOnDrop,!0),nt=new u,b=n(o.clearOnDrop,!0),s=n(o.dropTarget,e.container),k=n(o.clampToGround,!0),d=o.proxy;s=h(s);i(e,{dropTarget:{get:function(){return s},set:function(n){if(!t(n))throw new r("value is required.");a(s,v);s=n;l(s,v)}},dropEnabled:{get:function(){return w},set:function(n){n!==w&&(n?l(s,v):a(s,v),w=n)}},dropError:{get:function(){return nt}},clearOnDrop:{get:function(){return b},set:function(n){b=n}},flyToOnDrop:{get:function(){return g},set:function(n){g=n}},proxy:{get:function(){return d},set:function(n){d=n}},clampToGround:{get:function(){return k},set:function(n){k=n}}});l(s,v);e.destroy=f(e,e.destroy,function(){e.dropEnabled=!1});e._handleDrop=v}function c(n){n.stopPropagation();n.preventDefault()}function a(n,i){var r=n;t(r)&&(r.removeEventListener("drop",i,!1),r.removeEventListener("dragenter",c,!1),r.removeEventListener("dragover",c,!1),r.removeEventListener("dragexit",c,!1))}function l(n,t){n.addEventListener("drop",t,!1);n.addEventListener("dragenter",c,!1);n.addEventListener("dragover",c,!1);n.addEventListener("dragexit",c,!1)}function y(n,i,r,u){var f=n.scene;return function(h){var c=i.name,l;try{if(/\.czml$/i.test(c))l=e.load(JSON.parse(h.target.result),{sourceUri:c});else if(/\.geojson$/i.test(c)||/\.json$/i.test(c)||/\.topojson$/i.test(c))l=o.load(JSON.parse(h.target.result),{sourceUri:c,clampToGround:u});else if(/\.(kml|kmz)$/i.test(c))l=s.load(i,{sourceUri:c,proxy:r,camera:f.camera,canvas:f.canvas,clampToGround:u});else{n.dropError.raiseEvent(n,c,"Unrecognized file: "+c);return}t(l)&&n.dataSources.add(l).then(function(t){n.flyToOnDrop&&n.flyTo(t)}).otherwise(function(t){n.dropError.raiseEvent(n,c,t)})}catch(a){n.dropError.raiseEvent(n,c,a)}}}function p(n,t){return function(i){n.dropError.raiseEvent(n,t.name,i.target.error)}}return v});t("Widgets/Viewer/viewerPerformanceWatchdogMixin",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../PerformanceWatchdog/PerformanceWatchdog"],function(n,t,i,r,u){"use strict";function f(f,e){if(!t(f))throw new r("viewer is required.");e=n(e,n.EMPTY_OBJECT);var o=new u({scene:f.scene,container:f.bottomContainer,lowFrameRateMessage:e.lowFrameRateMessage});i(f,{performanceWatchdog:{get:function(){return o}}})}return f});t("Workers/createTaskProcessorWorker",["../ThirdParty/when","../Core/defaultValue","../Core/defined","../Core/formatError"],function(n,t,i,r){"use strict";function u(t,i,r){try{return t(i,r)}catch(u){return n.reject(u)}}function f(f){var e;return function(o){var h=o.data,c=[],s={id:h.id,result:undefined,error:undefined};return n(u(f,h.parameters,c)).then(function(n){s.result=n}).otherwise(function(n){s.error=n instanceof Error?{name:n.name,message:n.message,stack:n.stack}:n}).always(function(){i(e)||(e=t(self.webkitPostMessage,self.postMessage));h.canTransferArrayBuffer||(c.length=0);try{e(s,c)}catch(n){s.result=undefined;s.error="postMessage failed with error: "+r(n)+"\n  with responseMessage: "+JSON.stringify(s);e(s)}})}}return f});t("Cesium",["./Core/appendForwardSlash","./Core/ApproximateTerrainHeights","./Core/arrayFill","./Core/arrayRemoveDuplicates","./Core/arraySlice","./Core/AssociativeArray","./Core/AttributeCompression","./Core/AxisAlignedBoundingBox","./Core/barycentricCoordinates","./Core/binarySearch","./Core/BingMapsApi","./Core/BingMapsGeocoderService","./Core/BoundingRectangle","./Core/BoundingSphere","./Core/BoxGeometry","./Core/BoxOutlineGeometry","./Core/buildModuleUrl","./Core/cancelAnimationFrame","./Core/Cartesian2","./Core/Cartesian3","./Core/Cartesian4","./Core/Cartographic","./Core/CartographicGeocoderService","./Core/CatmullRomSpline","./Core/CesiumTerrainProvider","./Core/Check","./Core/CircleGeometry","./Core/CircleOutlineGeometry","./Core/Clock","./Core/ClockRange","./Core/ClockStep","./Core/clone","./Core/Color","./Core/ColorGeometryInstanceAttribute","./Core/combine","./Core/ComponentDatatype","./Core/CompressedTextureBuffer","./Core/CoplanarPolygonGeometry","./Core/CoplanarPolygonGeometryLibrary","./Core/CoplanarPolygonOutlineGeometry","./Core/CornerType","./Core/CorridorGeometry","./Core/CorridorGeometryLibrary","./Core/CorridorOutlineGeometry","./Core/createGuid","./Core/createWorldTerrain","./Core/Credit","./Core/CubicRealPolynomial","./Core/CullingVolume","./Core/CylinderGeometry","./Core/CylinderGeometryLibrary","./Core/CylinderOutlineGeometry","./Core/decodeGoogleEarthEnterpriseData","./Core/DefaultProxy","./Core/defaultValue","./Core/defined","./Core/defineProperties","./Core/deprecationWarning","./Core/destroyObject","./Core/DeveloperError","./Core/DistanceDisplayCondition","./Core/DistanceDisplayConditionGeometryInstanceAttribute","./Core/DoublyLinkedList","./Core/EarthOrientationParameters","./Core/EarthOrientationParametersSample","./Core/EasingFunction","./Core/EllipseGeometry","./Core/EllipseGeometryLibrary","./Core/EllipseOutlineGeometry","./Core/Ellipsoid","./Core/EllipsoidalOccluder","./Core/EllipsoidGeodesic","./Core/EllipsoidGeometry","./Core/EllipsoidOutlineGeometry","./Core/EllipsoidTangentPlane","./Core/EllipsoidTerrainProvider","./Core/EncodedCartesian3","./Core/Event","./Core/EventHelper","./Core/ExtrapolationType","./Core/FeatureDetection","./Core/formatError","./Core/freezeObject","./Core/FrustumGeometry","./Core/FrustumOutlineGeometry","./Core/Fullscreen","./Core/GeocoderService","./Core/GeocodeType","./Core/GeographicProjection","./Core/GeographicTilingScheme","./Core/Geometry","./Core/GeometryAttribute","./Core/GeometryAttributes","./Core/GeometryInstance","./Core/GeometryInstanceAttribute","./Core/GeometryOffsetAttribute","./Core/GeometryPipeline","./Core/GeometryType","./Core/getAbsoluteUri","./Core/getBaseUri","./Core/getExtensionFromUri","./Core/getFilenameFromUri","./Core/getImagePixels","./Core/getMagic","./Core/getStringFromTypedArray","./Core/getTimestamp","./Core/GoogleEarthEnterpriseMetadata","./Core/GoogleEarthEnterpriseTerrainData","./Core/GoogleEarthEnterpriseTerrainProvider","./Core/GoogleEarthEnterpriseTileInformation","./Core/GregorianDate","./Core/GroundPolylineGeometry","./Core/HeadingPitchRange","./Core/HeadingPitchRoll","./Core/Heap","./Core/HeightmapTerrainData","./Core/HeightmapTessellator","./Core/HermitePolynomialApproximation","./Core/HermiteSpline","./Core/Iau2000Orientation","./Core/Iau2006XysData","./Core/Iau2006XysSample","./Core/IauOrientationAxes","./Core/IauOrientationParameters","./Core/IndexDatatype","./Core/InterpolationAlgorithm","./Core/Intersect","./Core/Intersections2D","./Core/IntersectionTests","./Core/Interval","./Core/Ion","./Core/IonGeocoderService","./Core/IonResource","./Core/isArray","./Core/isBitSet","./Core/isBlobUri","./Core/isCrossOriginUrl","./Core/isDataUri","./Core/isLeapYear","./Core/Iso8601","./Core/JulianDate","./Core/KeyboardEventModifier","./Core/LagrangePolynomialApproximation","./Core/LeapSecond","./Core/LinearApproximation","./Core/LinearSpline","./Core/loadCRN","./Core/loadImageFromTypedArray","./Core/loadKTX","./Core/ManagedArray","./Core/MapboxApi","./Core/MapProjection","./Core/Math","./Core/Matrix2","./Core/Matrix3","./Core/Matrix4","./Core/mergeSort","./Core/NearFarScalar","./Core/objectToQuery","./Core/Occluder","./Core/OffsetGeometryInstanceAttribute","./Core/oneTimeWarning","./Core/OpenCageGeocoderService","./Core/OrientedBoundingBox","./Core/OrthographicFrustum","./Core/OrthographicOffCenterFrustum","./Core/Packable","./Core/PackableForInterpolation","./Core/parseResponseHeaders","./Core/PeliasGeocoderService","./Core/PerspectiveFrustum","./Core/PerspectiveOffCenterFrustum","./Core/PinBuilder","./Core/PixelFormat","./Core/Plane","./Core/PlaneGeometry","./Core/PlaneOutlineGeometry","./Core/pointInsideTriangle","./Core/PolygonGeometry","./Core/PolygonGeometryLibrary","./Core/PolygonHierarchy","./Core/PolygonOutlineGeometry","./Core/PolygonPipeline","./Core/PolylineGeometry","./Core/PolylinePipeline","./Core/PolylineVolumeGeometry","./Core/PolylineVolumeGeometryLibrary","./Core/PolylineVolumeOutlineGeometry","./Core/PrimitiveType","./Core/QuadraticRealPolynomial","./Core/QuantizedMeshTerrainData","./Core/QuarticRealPolynomial","./Core/Quaternion","./Core/QuaternionSpline","./Core/queryToObject","./Core/Queue","./Core/Ray","./Core/Rectangle","./Core/RectangleCollisionChecker","./Core/RectangleGeometry","./Core/RectangleGeometryLibrary","./Core/RectangleOutlineGeometry","./Core/ReferenceFrame","./Core/Request","./Core/requestAnimationFrame","./Core/RequestErrorEvent","./Core/RequestScheduler","./Core/RequestState","./Core/RequestType","./Core/Resource","./Core/RuntimeError","./Core/sampleTerrain","./Core/sampleTerrainMostDetailed","./Core/scaleToGeodeticSurface","./Core/ScreenSpaceEventHandler","./Core/ScreenSpaceEventType","./Core/ShowGeometryInstanceAttribute","./Core/Simon1994PlanetaryPositions","./Core/SimplePolylineGeometry","./Core/SphereGeometry","./Core/SphereOutlineGeometry","./Core/Spherical","./Core/Spline","./Core/subdivideArray","./Core/TaskProcessor","./Core/TerrainData","./Core/TerrainEncoding","./Core/TerrainMesh","./Core/TerrainProvider","./Core/TerrainQuantization","./Core/TileAvailability","./Core/TileProviderError","./Core/TilingScheme","./Core/TimeConstants","./Core/TimeInterval","./Core/TimeIntervalCollection","./Core/TimeStandard","./Core/Tipsify","./Core/Transforms","./Core/TranslationRotationScale","./Core/TridiagonalSystemSolver","./Core/TrustedServers","./Core/VertexFormat","./Core/VideoSynchronizer","./Core/Visibility","./Core/VRTheWorldTerrainProvider","./Core/WallGeometry","./Core/WallGeometryLibrary","./Core/WallOutlineGeometry","./Core/WebGLConstants","./Core/webGLConstantToGlslType","./Core/WebMercatorProjection","./Core/WebMercatorTilingScheme","./Core/WeightSpline","./Core/WindingOrder","./Core/wrapFunction","./Core/writeTextToCanvas","./DataSources/BillboardGraphics","./DataSources/BillboardVisualizer","./DataSources/BoundingSphereState","./DataSources/BoxGeometryUpdater","./DataSources/BoxGraphics","./DataSources/CallbackProperty","./DataSources/CheckerboardMaterialProperty","./DataSources/ColorMaterialProperty","./DataSources/CompositeEntityCollection","./DataSources/CompositeMaterialProperty","./DataSources/CompositePositionProperty","./DataSources/CompositeProperty","./DataSources/ConstantPositionProperty","./DataSources/ConstantProperty","./DataSources/CorridorGeometryUpdater","./DataSources/CorridorGraphics","./DataSources/createMaterialPropertyDescriptor","./DataSources/createPropertyDescriptor","./DataSources/createRawPropertyDescriptor","./DataSources/CustomDataSource","./DataSources/CylinderGeometryUpdater","./DataSources/CylinderGraphics","./DataSources/CzmlDataSource","./DataSources/DataSource","./DataSources/DataSourceClock","./DataSources/DataSourceCollection","./DataSources/DataSourceDisplay","./DataSources/DynamicGeometryBatch","./DataSources/DynamicGeometryUpdater","./DataSources/EllipseGeometryUpdater","./DataSources/EllipseGraphics","./DataSources/EllipsoidGeometryUpdater","./DataSources/EllipsoidGraphics","./DataSources/Entity","./DataSources/EntityCluster","./DataSources/EntityCollection","./DataSources/EntityView","./DataSources/GeoJsonDataSource","./DataSources/GeometryUpdater","./DataSources/GeometryVisualizer","./DataSources/GridMaterialProperty","./DataSources/GroundGeometryUpdater","./DataSources/heightReferenceOnEntityPropertyChanged","./DataSources/ImageMaterialProperty","./DataSources/KmlCamera","./DataSources/KmlDataSource","./DataSources/KmlLookAt","./DataSources/KmlTour","./DataSources/KmlTourFlyTo","./DataSources/KmlTourWait","./DataSources/LabelGraphics","./DataSources/LabelVisualizer","./DataSources/MaterialProperty","./DataSources/ModelGraphics","./DataSources/ModelVisualizer","./DataSources/NodeTransformationProperty","./DataSources/PathGraphics","./DataSources/PathVisualizer","./DataSources/PlaneGeometryUpdater","./DataSources/PlaneGraphics","./DataSources/PointGraphics","./DataSources/PointVisualizer","./DataSources/PolygonGeometryUpdater","./DataSources/PolygonGraphics","./DataSources/PolylineArrowMaterialProperty","./DataSources/PolylineDashMaterialProperty","./DataSources/PolylineGeometryUpdater","./DataSources/PolylineGlowMaterialProperty","./DataSources/PolylineGraphics","./DataSources/PolylineOutlineMaterialProperty","./DataSources/PolylineVisualizer","./DataSources/PolylineVolumeGeometryUpdater","./DataSources/PolylineVolumeGraphics","./DataSources/PositionProperty","./DataSources/PositionPropertyArray","./DataSources/Property","./DataSources/PropertyArray","./DataSources/PropertyBag","./DataSources/RectangleGeometryUpdater","./DataSources/RectangleGraphics","./DataSources/ReferenceProperty","./DataSources/Rotation","./DataSources/SampledPositionProperty","./DataSources/SampledProperty","./DataSources/ScaledPositionProperty","./DataSources/StaticGeometryColorBatch","./DataSources/StaticGeometryPerMaterialBatch","./DataSources/StaticGroundGeometryColorBatch","./DataSources/StaticGroundGeometryPerMaterialBatch","./DataSources/StaticGroundPolylinePerMaterialBatch","./DataSources/StaticOutlineGeometryBatch","./DataSources/StripeMaterialProperty","./DataSources/StripeOrientation","./DataSources/TerrainOffsetProperty","./DataSources/TimeIntervalCollectionPositionProperty","./DataSources/TimeIntervalCollectionProperty","./DataSources/VelocityOrientationProperty","./DataSources/VelocityVectorProperty","./DataSources/Visualizer","./DataSources/WallGeometryUpdater","./DataSources/WallGraphics","./Renderer/AutomaticUniforms","./Renderer/Buffer","./Renderer/BufferUsage","./Renderer/ClearCommand","./Renderer/ComputeCommand","./Renderer/ComputeEngine","./Renderer/Context","./Renderer/ContextLimits","./Renderer/createUniform","./Renderer/createUniformArray","./Renderer/CubeMap","./Renderer/CubeMapFace","./Renderer/DrawCommand","./Renderer/Framebuffer","./Renderer/freezeRenderState","./Renderer/loadCubeMap","./Renderer/MipmapHint","./Renderer/modernizeShader","./Renderer/Pass","./Renderer/PassState","./Renderer/PixelDatatype","./Renderer/Renderbuffer","./Renderer/RenderbufferFormat","./Renderer/RenderState","./Renderer/Sampler","./Renderer/ShaderCache","./Renderer/ShaderProgram","./Renderer/ShaderSource","./Renderer/Texture","./Renderer/TextureMagnificationFilter","./Renderer/TextureMinificationFilter","./Renderer/TextureWrap","./Renderer/UniformState","./Renderer/VertexArray","./Renderer/VertexArrayFacade","./Scene/Appearance","./Scene/ArcGisMapServerImageryProvider","./Scene/AttributeType","./Scene/Axis","./Scene/Batched3DModel3DTileContent","./Scene/BatchTable","./Scene/Billboard","./Scene/BillboardCollection","./Scene/BingMapsImageryProvider","./Scene/BingMapsStyle","./Scene/BlendEquation","./Scene/BlendFunction","./Scene/BlendingState","./Scene/BlendOption","./Scene/BoxEmitter","./Scene/BrdfLutGenerator","./Scene/Camera","./Scene/CameraEventAggregator","./Scene/CameraEventType","./Scene/CameraFlightPath","./Scene/Cesium3DTile","./Scene/Cesium3DTileBatchTable","./Scene/Cesium3DTileColorBlendMode","./Scene/Cesium3DTileContent","./Scene/Cesium3DTileContentFactory","./Scene/Cesium3DTileContentState","./Scene/Cesium3DTileFeature","./Scene/Cesium3DTileFeatureTable","./Scene/Cesium3DTileOptimizationHint","./Scene/Cesium3DTileOptimizations","./Scene/Cesium3DTilePointFeature","./Scene/Cesium3DTileRefine","./Scene/Cesium3DTileset","./Scene/Cesium3DTilesetCache","./Scene/Cesium3DTilesetStatistics","./Scene/Cesium3DTilesetTraversal","./Scene/Cesium3DTileStyle","./Scene/Cesium3DTileStyleEngine","./Scene/CircleEmitter","./Scene/ClassificationModel","./Scene/ClassificationPrimitive","./Scene/ClassificationType","./Scene/ClippingPlane","./Scene/ClippingPlaneCollection","./Scene/ColorBlendMode","./Scene/Composite3DTileContent","./Scene/computeFlyToLocationForRectangle","./Scene/ConditionsExpression","./Scene/ConeEmitter","./Scene/createBillboardPointCallback","./Scene/createOpenStreetMapImageryProvider","./Scene/createTangentSpaceDebugPrimitive","./Scene/createTileMapServiceImageryProvider","./Scene/createWorldImagery","./Scene/CreditDisplay","./Scene/CullFace","./Scene/DebugAppearance","./Scene/DebugCameraPrimitive","./Scene/DebugModelMatrixPrimitive","./Scene/DepthFunction","./Scene/DepthPlane","./Scene/DerivedCommand","./Scene/DeviceOrientationCameraController","./Scene/DiscardMissingTileImagePolicy","./Scene/DracoLoader","./Scene/EllipsoidPrimitive","./Scene/EllipsoidSurfaceAppearance","./Scene/Empty3DTileContent","./Scene/Expression","./Scene/ExpressionNodeType","./Scene/Fog","./Scene/FrameRateMonitor","./Scene/FrameState","./Scene/FrustumCommands","./Scene/Geometry3DTileContent","./Scene/getBinaryAccessor","./Scene/getClipAndStyleCode","./Scene/getClippingFunction","./Scene/GetFeatureInfoFormat","./Scene/Globe","./Scene/GlobeDepth","./Scene/GlobeSurfaceShaderSet","./Scene/GlobeSurfaceTile","./Scene/GlobeSurfaceTileProvider","./Scene/GoogleEarthEnterpriseImageryProvider","./Scene/GoogleEarthEnterpriseMapsProvider","./Scene/GridImageryProvider","./Scene/GroundPolylinePrimitive","./Scene/GroundPrimitive","./Scene/HeightReference","./Scene/HorizontalOrigin","./Scene/Imagery","./Scene/ImageryLayer","./Scene/ImageryLayerCollection","./Scene/ImageryLayerFeatureInfo","./Scene/ImageryProvider","./Scene/ImagerySplitDirection","./Scene/ImageryState","./Scene/Instanced3DModel3DTileContent","./Scene/InvertClassification","./Scene/IonImageryProvider","./Scene/IonWorldImageryStyle","./Scene/JobScheduler","./Scene/JobType","./Scene/Label","./Scene/LabelCollection","./Scene/LabelStyle","./Scene/MapboxImageryProvider","./Scene/MapMode2D","./Scene/Material","./Scene/MaterialAppearance","./Scene/Model","./Scene/ModelAnimation","./Scene/ModelAnimationCache","./Scene/ModelAnimationCollection","./Scene/ModelAnimationLoop","./Scene/ModelAnimationState","./Scene/ModelInstance","./Scene/ModelInstanceCollection","./Scene/ModelLoadResources","./Scene/ModelMaterial","./Scene/ModelMesh","./Scene/ModelNode","./Scene/ModelUtility","./Scene/Moon","./Scene/NeverTileDiscardPolicy","./Scene/OIT","./Scene/OrderedGroundPrimitiveCollection","./Scene/Particle","./Scene/ParticleBurst","./Scene/ParticleEmitter","./Scene/ParticleSystem","./Scene/PerformanceDisplay","./Scene/PerInstanceColorAppearance","./Scene/PickDepth","./Scene/PickDepthFramebuffer","./Scene/PickFramebuffer","./Scene/PointCloud","./Scene/PointCloud3DTileContent","./Scene/PointCloudEyeDomeLighting","./Scene/PointCloudShading","./Scene/PointPrimitive","./Scene/PointPrimitiveCollection","./Scene/Polyline","./Scene/PolylineCollection","./Scene/PolylineColorAppearance","./Scene/PolylineMaterialAppearance","./Scene/PostProcessStage","./Scene/PostProcessStageCollection","./Scene/PostProcessStageComposite","./Scene/PostProcessStageLibrary","./Scene/PostProcessStageSampleMode","./Scene/PostProcessStageTextureCache","./Scene/Primitive","./Scene/PrimitiveCollection","./Scene/PrimitivePipeline","./Scene/PrimitiveState","./Scene/processModelMaterialsCommon","./Scene/processPbrMaterials","./Scene/QuadtreeOccluders","./Scene/QuadtreePrimitive","./Scene/QuadtreeTile","./Scene/QuadtreeTileLoadState","./Scene/QuadtreeTileProvider","./Scene/Scene","./Scene/SceneFramebuffer","./Scene/SceneMode","./Scene/SceneTransforms","./Scene/SceneTransitioner","./Scene/ScreenSpaceCameraController","./Scene/ShadowMap","./Scene/ShadowMapShader","./Scene/ShadowMode","./Scene/ShadowVolumeAppearance","./Scene/SingleTileImageryProvider","./Scene/SkyAtmosphere","./Scene/SkyBox","./Scene/SphereEmitter","./Scene/StencilFunction","./Scene/StencilOperation","./Scene/StyleExpression","./Scene/Sun","./Scene/SunPostProcess","./Scene/TerrainState","./Scene/TextureAtlas","./Scene/TileBoundingRegion","./Scene/TileBoundingSphere","./Scene/TileBoundingVolume","./Scene/TileCoordinatesImageryProvider","./Scene/TileDiscardPolicy","./Scene/TileImagery","./Scene/TileOrientedBoundingBox","./Scene/TileReplacementQueue","./Scene/Tileset3DTileContent","./Scene/TileState","./Scene/TileTerrain","./Scene/TimeDynamicImagery","./Scene/TimeDynamicPointCloud","./Scene/TweenCollection","./Scene/UrlTemplateImageryProvider","./Scene/Vector3DTileBatch","./Scene/Vector3DTileContent","./Scene/Vector3DTileGeometry","./Scene/Vector3DTilePoints","./Scene/Vector3DTilePolygons","./Scene/Vector3DTilePolylines","./Scene/Vector3DTilePrimitive","./Scene/VerticalOrigin","./Scene/View","./Scene/ViewportQuad","./Scene/WebMapServiceImageryProvider","./Scene/WebMapTileServiceImageryProvider","./Shaders/AdjustTranslucentFS","./Shaders/Appearances/AllMaterialAppearanceFS","./Shaders/Appearances/AllMaterialAppearanceVS","./Shaders/Appearances/BasicMaterialAppearanceFS","./Shaders/Appearances/BasicMaterialAppearanceVS","./Shaders/Appearances/EllipsoidSurfaceAppearanceFS","./Shaders/Appearances/EllipsoidSurfaceAppearanceVS","./Shaders/Appearances/PerInstanceColorAppearanceFS","./Shaders/Appearances/PerInstanceColorAppearanceVS","./Shaders/Appearances/PerInstanceFlatColorAppearanceFS","./Shaders/Appearances/PerInstanceFlatColorAppearanceVS","./Shaders/Appearances/PolylineColorAppearanceVS","./Shaders/Appearances/PolylineMaterialAppearanceVS","./Shaders/Appearances/TexturedMaterialAppearanceFS","./Shaders/Appearances/TexturedMaterialAppearanceVS","./Shaders/BillboardCollectionFS","./Shaders/BillboardCollectionVS","./Shaders/BrdfLutGeneratorFS","./Shaders/Builtin/Constants/degreesPerRadian","./Shaders/Builtin/Constants/depthRange","./Shaders/Builtin/Constants/epsilon1","./Shaders/Builtin/Constants/epsilon2","./Shaders/Builtin/Constants/epsilon3","./Shaders/Builtin/Constants/epsilon4","./Shaders/Builtin/Constants/epsilon5","./Shaders/Builtin/Constants/epsilon6","./Shaders/Builtin/Constants/epsilon7","./Shaders/Builtin/Constants/infinity","./Shaders/Builtin/Constants/oneOverPi","./Shaders/Builtin/Constants/oneOverTwoPi","./Shaders/Builtin/Constants/passCesium3DTile","./Shaders/Builtin/Constants/passCesium3DTileClassification","./Shaders/Builtin/Constants/passCesium3DTileClassificationIgnoreShow","./Shaders/Builtin/Constants/passClassification","./Shaders/Builtin/Constants/passCompute","./Shaders/Builtin/Constants/passEnvironment","./Shaders/Builtin/Constants/passGlobe","./Shaders/Builtin/Constants/passOpaque","./Shaders/Builtin/Constants/passOverlay","./Shaders/Builtin/Constants/passTerrainClassification","./Shaders/Builtin/Constants/passTranslucent","./Shaders/Builtin/Constants/pi","./Shaders/Builtin/Constants/piOverFour","./Shaders/Builtin/Constants/piOverSix","./Shaders/Builtin/Constants/piOverThree","./Shaders/Builtin/Constants/piOverTwo","./Shaders/Builtin/Constants/radiansPerDegree","./Shaders/Builtin/Constants/sceneMode2D","./Shaders/Builtin/Constants/sceneMode3D","./Shaders/Builtin/Constants/sceneModeColumbusView","./Shaders/Builtin/Constants/sceneModeMorphing","./Shaders/Builtin/Constants/solarRadius","./Shaders/Builtin/Constants/threePiOver2","./Shaders/Builtin/Constants/twoPi","./Shaders/Builtin/Constants/webMercatorMaxLatitude","./Shaders/Builtin/CzmBuiltins","./Shaders/Builtin/Functions/alphaWeight","./Shaders/Builtin/Functions/antialias","./Shaders/Builtin/Functions/approximateSphericalCoordinates","./Shaders/Builtin/Functions/branchFreeTernary","./Shaders/Builtin/Functions/cascadeColor","./Shaders/Builtin/Functions/cascadeDistance","./Shaders/Builtin/Functions/cascadeMatrix","./Shaders/Builtin/Functions/cascadeWeights","./Shaders/Builtin/Functions/columbusViewMorph","./Shaders/Builtin/Functions/computePosition","./Shaders/Builtin/Functions/cosineAndSine","./Shaders/Builtin/Functions/decompressTextureCoordinates","./Shaders/Builtin/Functions/depthClampFarPlane","./Shaders/Builtin/Functions/eastNorthUpToEyeCoordinates","./Shaders/Builtin/Functions/ellipsoidContainsPoint","./Shaders/Builtin/Functions/ellipsoidNew","./Shaders/Builtin/Functions/ellipsoidWgs84TextureCoordinates","./Shaders/Builtin/Functions/equalsEpsilon","./Shaders/Builtin/Functions/eyeOffset","./Shaders/Builtin/Functions/eyeToWindowCoordinates","./Shaders/Builtin/Functions/fastApproximateAtan","./Shaders/Builtin/Functions/fog","./Shaders/Builtin/Functions/geodeticSurfaceNormal","./Shaders/Builtin/Functions/getDefaultMaterial","./Shaders/Builtin/Functions/getLambertDiffuse","./Shaders/Builtin/Functions/getSpecular","./Shaders/Builtin/Functions/getWaterNoise","./Shaders/Builtin/Functions/getWgs84EllipsoidEC","./Shaders/Builtin/Functions/HSBToRGB","./Shaders/Builtin/Functions/HSLToRGB","./Shaders/Builtin/Functions/hue","./Shaders/Builtin/Functions/isEmpty","./Shaders/Builtin/Functions/isFull","./Shaders/Builtin/Functions/latitudeToWebMercatorFraction","./Shaders/Builtin/Functions/lineDistance","./Shaders/Builtin/Functions/luminance","./Shaders/Builtin/Functions/metersPerPixel","./Shaders/Builtin/Functions/modelToWindowCoordinates","./Shaders/Builtin/Functions/multiplyWithColorBalance","./Shaders/Builtin/Functions/nearFarScalar","./Shaders/Builtin/Functions/octDecode","./Shaders/Builtin/Functions/packDepth","./Shaders/Builtin/Functions/phong","./Shaders/Builtin/Functions/planeDistance","./Shaders/Builtin/Functions/pointAlongRay","./Shaders/Builtin/Functions/rayEllipsoidIntersectionInterval","./Shaders/Builtin/Functions/readDepth","./Shaders/Builtin/Functions/reverseLogDepth","./Shaders/Builtin/Functions/RGBToHSB","./Shaders/Builtin/Functions/RGBToHSL","./Shaders/Builtin/Functions/RGBToXYZ","./Shaders/Builtin/Functions/saturation","./Shaders/Builtin/Functions/shadowDepthCompare","./Shaders/Builtin/Functions/shadowVisibility","./Shaders/Builtin/Functions/signNotZero","./Shaders/Builtin/Functions/tangentToEyeSpaceMatrix","./Shaders/Builtin/Functions/transformPlane","./Shaders/Builtin/Functions/translateRelativeToEye","./Shaders/Builtin/Functions/translucentPhong","./Shaders/Builtin/Functions/transpose","./Shaders/Builtin/Functions/unpackDepth","./Shaders/Builtin/Functions/unpackFloat","./Shaders/Builtin/Functions/vertexLogDepth","./Shaders/Builtin/Functions/windowToEyeCoordinates","./Shaders/Builtin/Functions/writeDepthClampedToFarPlane","./Shaders/Builtin/Functions/writeLogDepth","./Shaders/Builtin/Functions/XYZToRGB","./Shaders/Builtin/Structs/depthRangeStruct","./Shaders/Builtin/Structs/ellipsoid","./Shaders/Builtin/Structs/material","./Shaders/Builtin/Structs/materialInput","./Shaders/Builtin/Structs/ray","./Shaders/Builtin/Structs/raySegment","./Shaders/Builtin/Structs/shadowParameters","./Shaders/CompositeOITFS","./Shaders/DepthPlaneFS","./Shaders/DepthPlaneVS","./Shaders/EllipsoidFS","./Shaders/EllipsoidVS","./Shaders/GlobeFS","./Shaders/GlobeVS","./Shaders/GroundAtmosphere","./Shaders/Materials/BumpMapMaterial","./Shaders/Materials/CheckerboardMaterial","./Shaders/Materials/DotMaterial","./Shaders/Materials/ElevationContourMaterial","./Shaders/Materials/ElevationRampMaterial","./Shaders/Materials/FadeMaterial","./Shaders/Materials/GridMaterial","./Shaders/Materials/NormalMapMaterial","./Shaders/Materials/PolylineArrowMaterial","./Shaders/Materials/PolylineDashMaterial","./Shaders/Materials/PolylineGlowMaterial","./Shaders/Materials/PolylineOutlineMaterial","./Shaders/Materials/RimLightingMaterial","./Shaders/Materials/SlopeRampMaterial","./Shaders/Materials/StripeMaterial","./Shaders/Materials/Water","./Shaders/PointPrimitiveCollectionFS","./Shaders/PointPrimitiveCollectionVS","./Shaders/PolylineCommon","./Shaders/PolylineFS","./Shaders/PolylineShadowVolumeFS","./Shaders/PolylineShadowVolumeMorphFS","./Shaders/PolylineShadowVolumeMorphVS","./Shaders/PolylineShadowVolumeVS","./Shaders/PolylineVS","./Shaders/PostProcessStages/AdditiveBlend","./Shaders/PostProcessStages/AmbientOcclusionGenerate","./Shaders/PostProcessStages/AmbientOcclusionModulate","./Shaders/PostProcessStages/BlackAndWhite","./Shaders/PostProcessStages/BloomComposite","./Shaders/PostProcessStages/Brightness","./Shaders/PostProcessStages/BrightPass","./Shaders/PostProcessStages/ContrastBias","./Shaders/PostProcessStages/DepthOfField","./Shaders/PostProcessStages/DepthView","./Shaders/PostProcessStages/DepthViewPacked","./Shaders/PostProcessStages/EdgeDetection","./Shaders/PostProcessStages/FXAA","./Shaders/PostProcessStages/GaussianBlur1D","./Shaders/PostProcessStages/LensFlare","./Shaders/PostProcessStages/NightVision","./Shaders/PostProcessStages/PassThrough","./Shaders/PostProcessStages/PassThroughDepth","./Shaders/PostProcessStages/PointCloudEyeDomeLighting","./Shaders/PostProcessStages/Silhouette","./Shaders/ReprojectWebMercatorFS","./Shaders/ReprojectWebMercatorVS","./Shaders/ShadowVolumeAppearanceFS","./Shaders/ShadowVolumeAppearanceVS","./Shaders/ShadowVolumeFS","./Shaders/SkyAtmosphereFS","./Shaders/SkyAtmosphereVS","./Shaders/SkyBoxFS","./Shaders/SkyBoxVS","./Shaders/SunFS","./Shaders/SunTextureFS","./Shaders/SunVS","./Shaders/Vector3DTilePolylinesVS","./Shaders/VectorTileVS","./Shaders/ViewportQuadFS","./Shaders/ViewportQuadVS","./ThirdParty/Autolinker","./ThirdParty/earcut-2.1.1","./ThirdParty/GltfPipeline/addBuffer","./ThirdParty/GltfPipeline/addDefaults","./ThirdParty/GltfPipeline/addExtensionsRequired","./ThirdParty/GltfPipeline/addExtensionsUsed","./ThirdParty/GltfPipeline/addPipelineExtras","./ThirdParty/GltfPipeline/addToArray","./ThirdParty/GltfPipeline/findAccessorMinMax","./ThirdParty/GltfPipeline/ForEach","./ThirdParty/GltfPipeline/getAccessorByteStride","./ThirdParty/GltfPipeline/getComponentReader","./ThirdParty/GltfPipeline/hasExtension","./ThirdParty/GltfPipeline/moveTechniqueRenderStates","./ThirdParty/GltfPipeline/moveTechniquesToExtension","./ThirdParty/GltfPipeline/numberOfComponentsForType","./ThirdParty/GltfPipeline/parseGlb","./ThirdParty/GltfPipeline/readAccessorPacked","./ThirdParty/GltfPipeline/removeExtensionsRequired","./ThirdParty/GltfPipeline/removeExtensionsUsed","./ThirdParty/GltfPipeline/removePipelineExtras","./ThirdParty/GltfPipeline/removeUnusedElements","./ThirdParty/GltfPipeline/updateAccessorComponentTypes","./ThirdParty/GltfPipeline/updateVersion","./ThirdParty/google-earth-dbroot-parser","./ThirdParty/jsep","./ThirdParty/kdbush","./ThirdParty/knockout-3.4.2","./ThirdParty/knockout-es5","./ThirdParty/knockout","./ThirdParty/measureText","./ThirdParty/mersenne-twister","./ThirdParty/NoSleep","./ThirdParty/protobuf-minimal","./ThirdParty/purify","./ThirdParty/quickselect","./ThirdParty/rbush","./ThirdParty/Shaders/FXAA3_11","./ThirdParty/sprintf","./ThirdParty/topojson","./ThirdParty/Tween","./ThirdParty/Uri","./ThirdParty/when","./ThirdParty/zip","./Widgets/Animation/Animation","./Widgets/Animation/AnimationViewModel","./Widgets/BaseLayerPicker/BaseLayerPicker","./Widgets/BaseLayerPicker/BaseLayerPickerViewModel","./Widgets/BaseLayerPicker/createDefaultImageryProviderViewModels","./Widgets/BaseLayerPicker/createDefaultTerrainProviderViewModels","./Widgets/BaseLayerPicker/ProviderViewModel","./Widgets/Cesium3DTilesInspector/Cesium3DTilesInspector","./Widgets/Cesium3DTilesInspector/Cesium3DTilesInspectorViewModel","./Widgets/CesiumInspector/CesiumInspector","./Widgets/CesiumInspector/CesiumInspectorViewModel","./Widgets/CesiumWidget/CesiumWidget","./Widgets/ClockViewModel","./Widgets/Command","./Widgets/createCommand","./Widgets/FullscreenButton/FullscreenButton","./Widgets/FullscreenButton/FullscreenButtonViewModel","./Widgets/Geocoder/Geocoder","./Widgets/Geocoder/GeocoderViewModel","./Widgets/getElement","./Widgets/HomeButton/HomeButton","./Widgets/HomeButton/HomeButtonViewModel","./Widgets/InfoBox/InfoBox","./Widgets/InfoBox/InfoBoxViewModel","./Widgets/InspectorShared","./Widgets/NavigationHelpButton/NavigationHelpButton","./Widgets/NavigationHelpButton/NavigationHelpButtonViewModel","./Widgets/PerformanceWatchdog/PerformanceWatchdog","./Widgets/PerformanceWatchdog/PerformanceWatchdogViewModel","./Widgets/ProjectionPicker/ProjectionPicker","./Widgets/ProjectionPicker/ProjectionPickerViewModel","./Widgets/SceneModePicker/SceneModePicker","./Widgets/SceneModePicker/SceneModePickerViewModel","./Widgets/SelectionIndicator/SelectionIndicator","./Widgets/SelectionIndicator/SelectionIndicatorViewModel","./Widgets/subscribeAndEvaluate","./Widgets/SvgPathBindingHandler","./Widgets/Timeline/Timeline","./Widgets/Timeline/TimelineHighlightRange","./Widgets/Timeline/TimelineTrack","./Widgets/ToggleButtonViewModel","./Widgets/Viewer/Viewer","./Widgets/Viewer/viewerCesium3DTilesInspectorMixin","./Widgets/Viewer/viewerCesiumInspectorMixin","./Widgets/Viewer/viewerDragDropMixin","./Widgets/Viewer/viewerPerformanceWatchdogMixin","./Widgets/VRButton/VRButton","./Widgets/VRButton/VRButtonViewModel","./Workers/createTaskProcessorWorker"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,gt,ni,ti,ii,ri,ui,fi,ei,oi,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,gi,nr,tr,ir,rr,ur,fr,er,or,sr,hr,cr,lr,ar,vr,yr,pr,wr,br,kr,dr,gr,nu,tu,iu,ru,uu,fu,eu,ou,su,hu,cu,lu,au,vu,yu,pu,wu,bu,ku,du,gu,nf,tf,rf,uf,ff,ef,of,sf,hf,cf,lf,af,vf,yf,pf,wf,bf,kf,df,gf,ne,te,ie,re,ue,fe,ee,oe,se,he,ce,le,ae,ve,ye,pe,we,be,ke,de,ge,no,to,io,ro,uo,fo,eo,oo,so,ho,co,lo,ao,vo,yo,po,wo,bo,ko,go,ns,ts,is,rs,us,fs,es,os,ss,hs,cs,ls,as,vs,ys,ps,ws,bs,ks,ds,gs,nh,th,ih,rh,uh,fh,eh,oh,sh,hh,ch,lh,ah,vh,yh,ph,wh,bh,kh,dh,gh,nc,tc,ic,rc,uc,fc,ec,oc,sc,hc,cc,lc,ac,vc,yc,pc,wc,bc,kc,dc,gc,nl,tl,il,rl,ul,fl,el,ol,sl,hl,cl,ll,al,vl,yl,pl,wl,bl,kl,dl,gl,na,ta,ia,ra,ua,fa,ea,oa,sa,ha,ca,la,aa,va,ya,pa,wa,ba,ka,da,ga,nv,tv,iv,rv,uv,fv,ev,ov,sv,hv,cv,lv,av,vv,yv,pv,wv,bv,kv,dv,gv,ny,ty,iy,ry,uy,fy,ey,oy,sy,hy,cy,ly,ay,vy,yy,py,wy,by,ky,dy,gy,np,tp,ip,rp,up,fp,ep,op,sp,hp,cp,lp,ap,vp,yp,pp,wp,bp,kp,dp,gp,nw,tw,iw,rw,uw,fw,ew,ow,sw,hw,cw,lw,aw,vw,yw,pw,ww,bw,kw,dw,gw,nb,tb,ib,rb,ub,fb,eb,ob,sb,hb,cb,lb,ab,vb,yb,pb,wb,bb,kb,db,gb,nk,tk,ik,rk,uk,fk,ek,ok,sk,hk,ck,lk,ak,vk,yk,pk,wk,bk,kk,dk,gk,nd,td,id,rd,ud,fd,ed,od,sd,hd,cd,ld,ad,vd,yd,pd,wd,bd,kd,dd,gd,ng,tg,ig,rg,ug,fg,eg,og,sg,hg,cg,lg,ag,vg,yg,pg,wg,bg,kg,dg,gg,nn,tn,rn,un,fn,en,on,sn,hn,cn,ln,an,vn,yn,pn,wn,bn,kn,dn,gn,ntt,ttt,itt,rtt,utt,ftt,ett,ott,stt,htt,ctt,ltt,att,vtt,ytt,ptt,wtt,btt,ktt,dtt,gtt,nit,tit,iit,rit,uit,fit,eit,oit,sit,hit,cit,lit,ait,vit,yit,pit,wit,bit,kit,dit,git,nrt,trt,irt,rrt,urt,frt,ert,ort,srt,hrt,crt,lrt,art,vrt,yrt,prt,wrt,brt,krt,drt,grt,nut,tut,iut,rut,uut,fut,eut,out,sut,hut,cut,lut,aut,vut,yut,put,wut,but,kut,dut,gut,nft,tft,ift,rft,uft,fft,eft,oft,sft,hft,cft,lft,aft,vft,yft,pft,wft,bft,kft,dft,gft,net,tet,iet,ret,uet,fet,eet,oet,set,het,cet,aet,vet,yet,pet,wet,bet,ket,det,get,not,tot,iot,rot,uot,fot,eot,oot,sot,hot,cot,lot,aot,vot,yot,pot,wot,bot,kot,dot,got,nst,tst,ist,rst,ust,fst,est,ost,sst,hst,cst,lst,ast,vst,yst,pst,wst,bst,kst,dst,gst,nht,tht,iht,rht,uht,fht,eht,oht,sht,hht,cht,lht,aht,vht,yht,pht,wht,bht,kht,dht,ght,nct,tct,ict,rct,uct,fct,ect,oct,sct,hct,cct,lct,act,vct,yct,pct,wct,bct,kct,dct,gct,nlt,tlt,ilt,rlt,ult,flt,elt,olt,slt,hlt,clt,llt,alt,vlt,ylt,plt,wlt,blt,klt,dlt,glt,nat,tat,iat,rat,uat,fat,eat,oat,sat,hat,cat,lat,aat,vat,yat,pat,wat,bat,kat,dat,gat,nvt,tvt,ivt,rvt,uvt,fvt,evt,ovt,svt,hvt,cvt,lvt,avt,vvt,yvt,pvt,wvt,bvt,kvt,dvt,gvt,nyt,tyt,iyt,ryt,uyt,fyt,eyt,oyt,syt,hyt,cyt,lyt,ayt,vyt,yyt,pyt,wyt,byt,kyt,dyt,gyt,npt,tpt,ipt,rpt,upt,fpt,ept,opt,spt,hpt,cpt,lpt,apt,vpt,ypt,ppt,wpt,bpt,kpt,dpt,gpt,nwt,twt,iwt,rwt,uwt,fwt,ewt,owt,swt,hwt,cwt,lwt,awt,vwt,ywt,pwt,wwt,bwt,kwt,dwt,gwt,nbt,tbt,ibt,rbt,ubt,fbt,ebt,obt,sbt,hbt,cbt,lbt,abt,vbt,ybt,pbt,wbt,bbt,kbt,dbt,gbt,nkt,tkt,ikt,rkt,ukt,fkt,ekt,okt,skt,hkt,ckt,lkt,akt,vkt,ykt,pkt,wkt,bkt,kkt,dkt,gkt,ndt,tdt,idt,rdt,udt,fdt,edt,odt,sdt,hdt,cdt,ldt,adt,vdt,ydt,pdt,wdt,bdt,kdt,ddt,gdt,ngt,tgt,igt,rgt,ugt,fgt,egt,ogt,sgt,hgt,cgt,lgt,agt,vgt,ygt,pgt,wgt,bgt,kgt,dgt,ggt,nnt,tnt,int,rnt,unt,fnt,ent,ont,snt,hnt,cnt,lnt,ant,vnt,ynt,pnt,wnt,bnt,knt){"use strict";var dnt={VERSION:"1.50",_shaders:{}};return dnt.appendForwardSlash=n,dnt.ApproximateTerrainHeights=t,dnt.arrayFill=i,dnt.arrayRemoveDuplicates=r,dnt.arraySlice=u,dnt.AssociativeArray=f,dnt.AttributeCompression=e,dnt.AxisAlignedBoundingBox=o,dnt.barycentricCoordinates=s,dnt.binarySearch=h,dnt.BingMapsApi=c,dnt.BingMapsGeocoderService=l,dnt.BoundingRectangle=a,dnt.BoundingSphere=v,dnt.BoxGeometry=y,dnt.BoxOutlineGeometry=p,dnt.buildModuleUrl=w,dnt.cancelAnimationFrame=b,dnt.Cartesian2=k,dnt.Cartesian3=d,dnt.Cartesian4=g,dnt.Cartographic=nt,dnt.CartographicGeocoderService=tt,dnt.CatmullRomSpline=it,dnt.CesiumTerrainProvider=rt,dnt.Check=ut,dnt.CircleGeometry=ft,dnt.CircleOutlineGeometry=et,dnt.Clock=ot,dnt.ClockRange=st,dnt.ClockStep=ht,dnt.clone=ct,dnt.Color=lt,dnt.ColorGeometryInstanceAttribute=at,dnt.combine=vt,dnt.ComponentDatatype=yt,dnt.CompressedTextureBuffer=pt,dnt.CoplanarPolygonGeometry=wt,dnt.CoplanarPolygonGeometryLibrary=bt,dnt.CoplanarPolygonOutlineGeometry=kt,dnt.CornerType=dt,dnt.CorridorGeometry=gt,dnt.CorridorGeometryLibrary=ni,dnt.CorridorOutlineGeometry=ti,dnt.createGuid=ii,dnt.createWorldTerrain=ri,dnt.Credit=ui,dnt.CubicRealPolynomial=fi,dnt.CullingVolume=ei,dnt.CylinderGeometry=oi,dnt.CylinderGeometryLibrary=si,dnt.CylinderOutlineGeometry=hi,dnt.decodeGoogleEarthEnterpriseData=ci,dnt.DefaultProxy=li,dnt.defaultValue=ai,dnt.defined=vi,dnt.defineProperties=yi,dnt.deprecationWarning=pi,dnt.destroyObject=wi,dnt.DeveloperError=bi,dnt.DistanceDisplayCondition=ki,dnt.DistanceDisplayConditionGeometryInstanceAttribute=di,dnt.DoublyLinkedList=gi,dnt.EarthOrientationParameters=nr,dnt.EarthOrientationParametersSample=tr,dnt.EasingFunction=ir,dnt.EllipseGeometry=rr,dnt.EllipseGeometryLibrary=ur,dnt.EllipseOutlineGeometry=fr,dnt.Ellipsoid=er,dnt.EllipsoidalOccluder=or,dnt.EllipsoidGeodesic=sr,dnt.EllipsoidGeometry=hr,dnt.EllipsoidOutlineGeometry=cr,dnt.EllipsoidTangentPlane=lr,dnt.EllipsoidTerrainProvider=ar,dnt.EncodedCartesian3=vr,dnt.Event=yr,dnt.EventHelper=pr,dnt.ExtrapolationType=wr,dnt.FeatureDetection=br,dnt.formatError=kr,dnt.freezeObject=dr,dnt.FrustumGeometry=gr,dnt.FrustumOutlineGeometry=nu,dnt.Fullscreen=tu,dnt.GeocoderService=iu,dnt.GeocodeType=ru,dnt.GeographicProjection=uu,dnt.GeographicTilingScheme=fu,dnt.Geometry=eu,dnt.GeometryAttribute=ou,dnt.GeometryAttributes=su,dnt.GeometryInstance=hu,dnt.GeometryInstanceAttribute=cu,dnt.GeometryOffsetAttribute=lu,dnt.GeometryPipeline=au,dnt.GeometryType=vu,dnt.getAbsoluteUri=yu,dnt.getBaseUri=pu,dnt.getExtensionFromUri=wu,dnt.getFilenameFromUri=bu,dnt.getImagePixels=ku,dnt.getMagic=du,dnt.getStringFromTypedArray=gu,dnt.getTimestamp=nf,dnt.GoogleEarthEnterpriseMetadata=tf,dnt.GoogleEarthEnterpriseTerrainData=rf,dnt.GoogleEarthEnterpriseTerrainProvider=uf,dnt.GoogleEarthEnterpriseTileInformation=ff,dnt.GregorianDate=ef,dnt.GroundPolylineGeometry=of,dnt.HeadingPitchRange=sf,dnt.HeadingPitchRoll=hf,dnt.Heap=cf,dnt.HeightmapTerrainData=lf,dnt.HeightmapTessellator=af,dnt.HermitePolynomialApproximation=vf,dnt.HermiteSpline=yf,dnt.Iau2000Orientation=pf,dnt.Iau2006XysData=wf,dnt.Iau2006XysSample=bf,dnt.IauOrientationAxes=kf,dnt.IauOrientationParameters=df,dnt.IndexDatatype=gf,dnt.InterpolationAlgorithm=ne,dnt.Intersect=te,dnt.Intersections2D=ie,dnt.IntersectionTests=re,dnt.Interval=ue,dnt.Ion=fe,dnt.IonGeocoderService=ee,dnt.IonResource=oe,dnt.isArray=se,dnt.isBitSet=he,dnt.isBlobUri=ce,dnt.isCrossOriginUrl=le,dnt.isDataUri=ae,dnt.isLeapYear=ve,dnt.Iso8601=ye,dnt.JulianDate=pe,dnt.KeyboardEventModifier=we,dnt.LagrangePolynomialApproximation=be,dnt.LeapSecond=ke,dnt.LinearApproximation=de,dnt.LinearSpline=ge,dnt.loadCRN=no,dnt.loadImageFromTypedArray=to,dnt.loadKTX=io,dnt.ManagedArray=ro,dnt.MapboxApi=uo,dnt.MapProjection=fo,dnt.Math=eo,dnt.Matrix2=oo,dnt.Matrix3=so,dnt.Matrix4=ho,dnt.mergeSort=co,dnt.NearFarScalar=lo,dnt.objectToQuery=ao,dnt.Occluder=vo,dnt.OffsetGeometryInstanceAttribute=yo,dnt.oneTimeWarning=po,dnt.OpenCageGeocoderService=wo,dnt.OrientedBoundingBox=bo,dnt.OrthographicFrustum=ko,dnt.OrthographicOffCenterFrustum=go,dnt.Packable=ns,dnt.PackableForInterpolation=ts,dnt.parseResponseHeaders=is,dnt.PeliasGeocoderService=rs,dnt.PerspectiveFrustum=us,dnt.PerspectiveOffCenterFrustum=fs,dnt.PinBuilder=es,dnt.PixelFormat=os,dnt.Plane=ss,dnt.PlaneGeometry=hs,dnt.PlaneOutlineGeometry=cs,dnt.pointInsideTriangle=ls,dnt.PolygonGeometry=as,dnt.PolygonGeometryLibrary=vs,dnt.PolygonHierarchy=ys,dnt.PolygonOutlineGeometry=ps,dnt.PolygonPipeline=ws,dnt.PolylineGeometry=bs,dnt.PolylinePipeline=ks,dnt.PolylineVolumeGeometry=ds,dnt.PolylineVolumeGeometryLibrary=gs,dnt.PolylineVolumeOutlineGeometry=nh,dnt.PrimitiveType=th,dnt.QuadraticRealPolynomial=ih,dnt.QuantizedMeshTerrainData=rh,dnt.QuarticRealPolynomial=uh,dnt.Quaternion=fh,dnt.QuaternionSpline=eh,dnt.queryToObject=oh,dnt.Queue=sh,dnt.Ray=hh,dnt.Rectangle=ch,dnt.RectangleCollisionChecker=lh,dnt.RectangleGeometry=ah,dnt.RectangleGeometryLibrary=vh,dnt.RectangleOutlineGeometry=yh,dnt.ReferenceFrame=ph,dnt.Request=wh,dnt.requestAnimationFrame=bh,dnt.RequestErrorEvent=kh,dnt.RequestScheduler=dh,dnt.RequestState=gh,dnt.RequestType=nc,dnt.Resource=tc,dnt.RuntimeError=ic,dnt.sampleTerrain=rc,dnt.sampleTerrainMostDetailed=uc,dnt.scaleToGeodeticSurface=fc,dnt.ScreenSpaceEventHandler=ec,dnt.ScreenSpaceEventType=oc,dnt.ShowGeometryInstanceAttribute=sc,dnt.Simon1994PlanetaryPositions=hc,dnt.SimplePolylineGeometry=cc,dnt.SphereGeometry=lc,dnt.SphereOutlineGeometry=ac,dnt.Spherical=vc,dnt.Spline=yc,dnt.subdivideArray=pc,dnt.TaskProcessor=wc,dnt.TerrainData=bc,dnt.TerrainEncoding=kc,dnt.TerrainMesh=dc,dnt.TerrainProvider=gc,dnt.TerrainQuantization=nl,dnt.TileAvailability=tl,dnt.TileProviderError=il,dnt.TilingScheme=rl,dnt.TimeConstants=ul,dnt.TimeInterval=fl,dnt.TimeIntervalCollection=el,dnt.TimeStandard=ol,dnt.Tipsify=sl,dnt.Transforms=hl,dnt.TranslationRotationScale=cl,dnt.TridiagonalSystemSolver=ll,dnt.TrustedServers=al,dnt.VertexFormat=vl,dnt.VideoSynchronizer=yl,dnt.Visibility=pl,dnt.VRTheWorldTerrainProvider=wl,dnt.WallGeometry=bl,dnt.WallGeometryLibrary=kl,dnt.WallOutlineGeometry=dl,dnt.WebGLConstants=gl,dnt.webGLConstantToGlslType=na,dnt.WebMercatorProjection=ta,dnt.WebMercatorTilingScheme=ia,dnt.WeightSpline=ra,dnt.WindingOrder=ua,dnt.wrapFunction=fa,dnt.writeTextToCanvas=ea,dnt.BillboardGraphics=oa,dnt.BillboardVisualizer=sa,dnt.BoundingSphereState=ha,dnt.BoxGeometryUpdater=ca,dnt.BoxGraphics=la,dnt.CallbackProperty=aa,dnt.CheckerboardMaterialProperty=va,dnt.ColorMaterialProperty=ya,dnt.CompositeEntityCollection=pa,dnt.CompositeMaterialProperty=wa,dnt.CompositePositionProperty=ba,dnt.CompositeProperty=ka,dnt.ConstantPositionProperty=da,dnt.ConstantProperty=ga,dnt.CorridorGeometryUpdater=nv,dnt.CorridorGraphics=tv,dnt.createMaterialPropertyDescriptor=iv,dnt.createPropertyDescriptor=rv,dnt.createRawPropertyDescriptor=uv,dnt.CustomDataSource=fv,dnt.CylinderGeometryUpdater=ev,dnt.CylinderGraphics=ov,dnt.CzmlDataSource=sv,dnt.DataSource=hv,dnt.DataSourceClock=cv,dnt.DataSourceCollection=lv,dnt.DataSourceDisplay=av,dnt.DynamicGeometryBatch=vv,dnt.DynamicGeometryUpdater=yv,dnt.EllipseGeometryUpdater=pv,dnt.EllipseGraphics=wv,dnt.EllipsoidGeometryUpdater=bv,dnt.EllipsoidGraphics=kv,dnt.Entity=dv,dnt.EntityCluster=gv,dnt.EntityCollection=ny,dnt.EntityView=ty,dnt.GeoJsonDataSource=iy,dnt.GeometryUpdater=ry,dnt.GeometryVisualizer=uy,dnt.GridMaterialProperty=fy,dnt.GroundGeometryUpdater=ey,dnt.heightReferenceOnEntityPropertyChanged=oy,dnt.ImageMaterialProperty=sy,dnt.KmlCamera=hy,dnt.KmlDataSource=cy,dnt.KmlLookAt=ly,dnt.KmlTour=ay,dnt.KmlTourFlyTo=vy,dnt.KmlTourWait=yy,dnt.LabelGraphics=py,dnt.LabelVisualizer=wy,dnt.MaterialProperty=by,dnt.ModelGraphics=ky,dnt.ModelVisualizer=dy,dnt.NodeTransformationProperty=gy,dnt.PathGraphics=np,dnt.PathVisualizer=tp,dnt.PlaneGeometryUpdater=ip,dnt.PlaneGraphics=rp,dnt.PointGraphics=up,dnt.PointVisualizer=fp,dnt.PolygonGeometryUpdater=ep,dnt.PolygonGraphics=op,dnt.PolylineArrowMaterialProperty=sp,dnt.PolylineDashMaterialProperty=hp,dnt.PolylineGeometryUpdater=cp,dnt.PolylineGlowMaterialProperty=lp,dnt.PolylineGraphics=ap,dnt.PolylineOutlineMaterialProperty=vp,dnt.PolylineVisualizer=yp,dnt.PolylineVolumeGeometryUpdater=pp,dnt.PolylineVolumeGraphics=wp,dnt.PositionProperty=bp,dnt.PositionPropertyArray=kp,dnt.Property=dp,dnt.PropertyArray=gp,dnt.PropertyBag=nw,dnt.RectangleGeometryUpdater=tw,dnt.RectangleGraphics=iw,dnt.ReferenceProperty=rw,dnt.Rotation=uw,dnt.SampledPositionProperty=fw,dnt.SampledProperty=ew,dnt.ScaledPositionProperty=ow,dnt.StaticGeometryColorBatch=sw,dnt.StaticGeometryPerMaterialBatch=hw,dnt.StaticGroundGeometryColorBatch=cw,dnt.StaticGroundGeometryPerMaterialBatch=lw,dnt.StaticGroundPolylinePerMaterialBatch=aw,dnt.StaticOutlineGeometryBatch=vw,dnt.StripeMaterialProperty=yw,dnt.StripeOrientation=pw,dnt.TerrainOffsetProperty=ww,dnt.TimeIntervalCollectionPositionProperty=bw,dnt.TimeIntervalCollectionProperty=kw,dnt.VelocityOrientationProperty=dw,dnt.VelocityVectorProperty=gw,dnt.Visualizer=nb,dnt.WallGeometryUpdater=tb,dnt.WallGraphics=ib,dnt.AutomaticUniforms=rb,dnt.Buffer=ub,dnt.BufferUsage=fb,dnt.ClearCommand=eb,dnt.ComputeCommand=ob,dnt.ComputeEngine=sb,dnt.Context=hb,dnt.ContextLimits=cb,dnt.createUniform=lb,dnt.createUniformArray=ab,dnt.CubeMap=vb,dnt.CubeMapFace=yb,dnt.DrawCommand=pb,dnt.Framebuffer=wb,dnt.freezeRenderState=bb,dnt.loadCubeMap=kb,dnt.MipmapHint=db,dnt.modernizeShader=gb,dnt.Pass=nk,dnt.PassState=tk,dnt.PixelDatatype=ik,dnt.Renderbuffer=rk,dnt.RenderbufferFormat=uk,dnt.RenderState=fk,dnt.Sampler=ek,dnt.ShaderCache=ok,dnt.ShaderProgram=sk,dnt.ShaderSource=hk,dnt.Texture=ck,dnt.TextureMagnificationFilter=lk,dnt.TextureMinificationFilter=ak,dnt.TextureWrap=vk,dnt.UniformState=yk,dnt.VertexArray=pk,dnt.VertexArrayFacade=wk,dnt.Appearance=bk,dnt.ArcGisMapServerImageryProvider=kk,dnt.AttributeType=dk,dnt.Axis=gk,dnt.Batched3DModel3DTileContent=nd,dnt.BatchTable=td,dnt.Billboard=id,dnt.BillboardCollection=rd,dnt.BingMapsImageryProvider=ud,dnt.BingMapsStyle=fd,dnt.BlendEquation=ed,dnt.BlendFunction=od,dnt.BlendingState=sd,dnt.BlendOption=hd,dnt.BoxEmitter=cd,dnt.BrdfLutGenerator=ld,dnt.Camera=ad,dnt.CameraEventAggregator=vd,dnt.CameraEventType=yd,dnt.CameraFlightPath=pd,dnt.Cesium3DTile=wd,dnt.Cesium3DTileBatchTable=bd,dnt.Cesium3DTileColorBlendMode=kd,dnt.Cesium3DTileContent=dd,dnt.Cesium3DTileContentFactory=gd,dnt.Cesium3DTileContentState=ng,dnt.Cesium3DTileFeature=tg,dnt.Cesium3DTileFeatureTable=ig,dnt.Cesium3DTileOptimizationHint=rg,dnt.Cesium3DTileOptimizations=ug,dnt.Cesium3DTilePointFeature=fg,dnt.Cesium3DTileRefine=eg,dnt.Cesium3DTileset=og,dnt.Cesium3DTilesetCache=sg,dnt.Cesium3DTilesetStatistics=hg,dnt.Cesium3DTilesetTraversal=cg,dnt.Cesium3DTileStyle=lg,dnt.Cesium3DTileStyleEngine=ag,dnt.CircleEmitter=vg,dnt.ClassificationModel=yg,dnt.ClassificationPrimitive=pg,dnt.ClassificationType=wg,dnt.ClippingPlane=bg,dnt.ClippingPlaneCollection=kg,dnt.ColorBlendMode=dg,dnt.Composite3DTileContent=gg,dnt.computeFlyToLocationForRectangle=nn,dnt.ConditionsExpression=tn,dnt.ConeEmitter=rn,dnt.createBillboardPointCallback=un,dnt.createOpenStreetMapImageryProvider=fn,dnt.createTangentSpaceDebugPrimitive=en,dnt.createTileMapServiceImageryProvider=on,dnt.createWorldImagery=sn,dnt.CreditDisplay=hn,dnt.CullFace=cn,dnt.DebugAppearance=ln,dnt.DebugCameraPrimitive=an,dnt.DebugModelMatrixPrimitive=vn,dnt.DepthFunction=yn,dnt.DepthPlane=pn,dnt.DerivedCommand=wn,dnt.DeviceOrientationCameraController=bn,dnt.DiscardMissingTileImagePolicy=kn,dnt.DracoLoader=dn,dnt.EllipsoidPrimitive=gn,dnt.EllipsoidSurfaceAppearance=ntt,dnt.Empty3DTileContent=ttt,dnt.Expression=itt,dnt.ExpressionNodeType=rtt,dnt.Fog=utt,dnt.FrameRateMonitor=ftt,dnt.FrameState=ett,dnt.FrustumCommands=ott,dnt.Geometry3DTileContent=stt,dnt.getBinaryAccessor=htt,dnt.getClipAndStyleCode=ctt,dnt.getClippingFunction=ltt,dnt.GetFeatureInfoFormat=att,dnt.Globe=vtt,dnt.GlobeDepth=ytt,dnt.GlobeSurfaceShaderSet=ptt,dnt.GlobeSurfaceTile=wtt,dnt.GlobeSurfaceTileProvider=btt,dnt.GoogleEarthEnterpriseImageryProvider=ktt,dnt.GoogleEarthEnterpriseMapsProvider=dtt,dnt.GridImageryProvider=gtt,dnt.GroundPolylinePrimitive=nit,dnt.GroundPrimitive=tit,dnt.HeightReference=iit,dnt.HorizontalOrigin=rit,dnt.Imagery=uit,dnt.ImageryLayer=fit,dnt.ImageryLayerCollection=eit,dnt.ImageryLayerFeatureInfo=oit,dnt.ImageryProvider=sit,dnt.ImagerySplitDirection=hit,dnt.ImageryState=cit,dnt.Instanced3DModel3DTileContent=lit,dnt.InvertClassification=ait,dnt.IonImageryProvider=vit,dnt.IonWorldImageryStyle=yit,dnt.JobScheduler=pit,dnt.JobType=wit,dnt.Label=bit,dnt.LabelCollection=kit,dnt.LabelStyle=dit,dnt.MapboxImageryProvider=git,dnt.MapMode2D=nrt,dnt.Material=trt,dnt.MaterialAppearance=irt,dnt.Model=rrt,dnt.ModelAnimation=urt,dnt.ModelAnimationCache=frt,dnt.ModelAnimationCollection=ert,dnt.ModelAnimationLoop=ort,dnt.ModelAnimationState=srt,dnt.ModelInstance=hrt,dnt.ModelInstanceCollection=crt,dnt.ModelLoadResources=lrt,dnt.ModelMaterial=art,dnt.ModelMesh=vrt,dnt.ModelNode=yrt,dnt.ModelUtility=prt,dnt.Moon=wrt,dnt.NeverTileDiscardPolicy=brt,dnt.OIT=krt,dnt.OrderedGroundPrimitiveCollection=drt,dnt.Particle=grt,dnt.ParticleBurst=nut,dnt.ParticleEmitter=tut,dnt.ParticleSystem=iut,dnt.PerformanceDisplay=rut,dnt.PerInstanceColorAppearance=uut,dnt.PickDepth=fut,dnt.PickDepthFramebuffer=eut,dnt.PickFramebuffer=out,dnt.PointCloud=sut,dnt.PointCloud3DTileContent=hut,dnt.PointCloudEyeDomeLighting=cut,dnt.PointCloudShading=lut,dnt.PointPrimitive=aut,dnt.PointPrimitiveCollection=vut,dnt.Polyline=yut,dnt.PolylineCollection=put,dnt.PolylineColorAppearance=wut,dnt.PolylineMaterialAppearance=but,dnt.PostProcessStage=kut,dnt.PostProcessStageCollection=dut,dnt.PostProcessStageComposite=gut,dnt.PostProcessStageLibrary=nft,dnt.PostProcessStageSampleMode=tft,dnt.PostProcessStageTextureCache=ift,dnt.Primitive=rft,dnt.PrimitiveCollection=uft,dnt.PrimitivePipeline=fft,dnt.PrimitiveState=eft,dnt.processModelMaterialsCommon=oft,dnt.processPbrMaterials=sft,dnt.QuadtreeOccluders=hft,dnt.QuadtreePrimitive=cft,dnt.QuadtreeTile=lft,dnt.QuadtreeTileLoadState=aft,dnt.QuadtreeTileProvider=vft,dnt.Scene=yft,dnt.SceneFramebuffer=pft,dnt.SceneMode=wft,dnt.SceneTransforms=bft,dnt.SceneTransitioner=kft,dnt.ScreenSpaceCameraController=dft,dnt.ShadowMap=gft,dnt.ShadowMapShader=net,dnt.ShadowMode=tet,dnt.ShadowVolumeAppearance=iet,dnt.SingleTileImageryProvider=ret,dnt.SkyAtmosphere=uet,dnt.SkyBox=fet,dnt.SphereEmitter=eet,dnt.StencilFunction=oet,dnt.StencilOperation=set,dnt.StyleExpression=het,dnt.Sun=cet,dnt.SunPostProcess=aet,dnt.TerrainState=vet,dnt.TextureAtlas=yet,dnt.TileBoundingRegion=pet,dnt.TileBoundingSphere=wet,dnt.TileBoundingVolume=bet,dnt.TileCoordinatesImageryProvider=ket,dnt.TileDiscardPolicy=det,dnt.TileImagery=get,dnt.TileOrientedBoundingBox=not,dnt.TileReplacementQueue=tot,dnt.Tileset3DTileContent=iot,dnt.TileState=rot,dnt.TileTerrain=uot,dnt.TimeDynamicImagery=fot,dnt.TimeDynamicPointCloud=eot,dnt.TweenCollection=oot,dnt.UrlTemplateImageryProvider=sot,dnt.Vector3DTileBatch=hot,dnt.Vector3DTileContent=cot,dnt.Vector3DTileGeometry=lot,dnt.Vector3DTilePoints=aot,dnt.Vector3DTilePolygons=vot,dnt.Vector3DTilePolylines=yot,dnt.Vector3DTilePrimitive=pot,dnt.VerticalOrigin=wot,dnt.View=bot,dnt.ViewportQuad=kot,dnt.WebMapServiceImageryProvider=dot,dnt.WebMapTileServiceImageryProvider=got,dnt._shaders.AdjustTranslucentFS=nst,dnt._shaders.AllMaterialAppearanceFS=tst,dnt._shaders.AllMaterialAppearanceVS=ist,dnt._shaders.BasicMaterialAppearanceFS=rst,dnt._shaders.BasicMaterialAppearanceVS=ust,dnt._shaders.EllipsoidSurfaceAppearanceFS=fst,dnt._shaders.EllipsoidSurfaceAppearanceVS=est,dnt._shaders.PerInstanceColorAppearanceFS=ost,dnt._shaders.PerInstanceColorAppearanceVS=sst,dnt._shaders.PerInstanceFlatColorAppearanceFS=hst,dnt._shaders.PerInstanceFlatColorAppearanceVS=cst,dnt._shaders.PolylineColorAppearanceVS=lst,dnt._shaders.PolylineMaterialAppearanceVS=ast,dnt._shaders.TexturedMaterialAppearanceFS=vst,dnt._shaders.TexturedMaterialAppearanceVS=yst,dnt._shaders.BillboardCollectionFS=pst,dnt._shaders.BillboardCollectionVS=wst,dnt._shaders.BrdfLutGeneratorFS=bst,dnt._shaders.degreesPerRadian=kst,dnt._shaders.depthRange=dst,dnt._shaders.epsilon1=gst,dnt._shaders.epsilon2=nht,dnt._shaders.epsilon3=tht,dnt._shaders.epsilon4=iht,dnt._shaders.epsilon5=rht,dnt._shaders.epsilon6=uht,dnt._shaders.epsilon7=fht,dnt._shaders.infinity=eht,dnt._shaders.oneOverPi=oht,dnt._shaders.oneOverTwoPi=sht,dnt._shaders.passCesium3DTile=hht,dnt._shaders.passCesium3DTileClassification=cht,dnt._shaders.passCesium3DTileClassificationIgnoreShow=lht,dnt._shaders.passClassification=aht,dnt._shaders.passCompute=vht,dnt._shaders.passEnvironment=yht,dnt._shaders.passGlobe=pht,dnt._shaders.passOpaque=wht,dnt._shaders.passOverlay=bht,dnt._shaders.passTerrainClassification=kht,dnt._shaders.passTranslucent=dht,dnt._shaders.pi=ght,dnt._shaders.piOverFour=nct,dnt._shaders.piOverSix=tct,dnt._shaders.piOverThree=ict,dnt._shaders.piOverTwo=rct,dnt._shaders.radiansPerDegree=uct,dnt._shaders.sceneMode2D=fct,dnt._shaders.sceneMode3D=ect,dnt._shaders.sceneModeColumbusView=oct,dnt._shaders.sceneModeMorphing=sct,dnt._shaders.solarRadius=hct,dnt._shaders.threePiOver2=cct,dnt._shaders.twoPi=lct,dnt._shaders.webMercatorMaxLatitude=act,dnt._shaders.CzmBuiltins=vct,dnt._shaders.alphaWeight=yct,dnt._shaders.antialias=pct,dnt._shaders.approximateSphericalCoordinates=wct,dnt._shaders.branchFreeTernary=bct,dnt._shaders.cascadeColor=kct,dnt._shaders.cascadeDistance=dct,dnt._shaders.cascadeMatrix=gct,dnt._shaders.cascadeWeights=nlt,dnt._shaders.columbusViewMorph=tlt,dnt._shaders.computePosition=ilt,dnt._shaders.cosineAndSine=rlt,dnt._shaders.decompressTextureCoordinates=ult,dnt._shaders.depthClampFarPlane=flt,dnt._shaders.eastNorthUpToEyeCoordinates=elt,dnt._shaders.ellipsoidContainsPoint=olt,dnt._shaders.ellipsoidNew=slt,dnt._shaders.ellipsoidWgs84TextureCoordinates=hlt,dnt._shaders.equalsEpsilon=clt,dnt._shaders.eyeOffset=llt,dnt._shaders.eyeToWindowCoordinates=alt,dnt._shaders.fastApproximateAtan=vlt,dnt._shaders.fog=ylt,dnt._shaders.geodeticSurfaceNormal=plt,dnt._shaders.getDefaultMaterial=wlt,dnt._shaders.getLambertDiffuse=blt,dnt._shaders.getSpecular=klt,dnt._shaders.getWaterNoise=dlt,dnt._shaders.getWgs84EllipsoidEC=glt,dnt._shaders.HSBToRGB=nat,dnt._shaders.HSLToRGB=tat,dnt._shaders.hue=iat,dnt._shaders.isEmpty=rat,dnt._shaders.isFull=uat,dnt._shaders.latitudeToWebMercatorFraction=fat,dnt._shaders.lineDistance=eat,dnt._shaders.luminance=oat,dnt._shaders.metersPerPixel=sat,dnt._shaders.modelToWindowCoordinates=hat,dnt._shaders.multiplyWithColorBalance=cat,dnt._shaders.nearFarScalar=lat,dnt._shaders.octDecode=aat,dnt._shaders.packDepth=vat,dnt._shaders.phong=yat,dnt._shaders.planeDistance=pat,dnt._shaders.pointAlongRay=wat,dnt._shaders.rayEllipsoidIntersectionInterval=bat,dnt._shaders.readDepth=kat,dnt._shaders.reverseLogDepth=dat,dnt._shaders.RGBToHSB=gat,dnt._shaders.RGBToHSL=nvt,dnt._shaders.RGBToXYZ=tvt,dnt._shaders.saturation=ivt,dnt._shaders.shadowDepthCompare=rvt,dnt._shaders.shadowVisibility=uvt,dnt._shaders.signNotZero=fvt,dnt._shaders.tangentToEyeSpaceMatrix=evt,dnt._shaders.transformPlane=ovt,dnt._shaders.translateRelativeToEye=svt,dnt._shaders.translucentPhong=hvt,dnt._shaders.transpose=cvt,dnt._shaders.unpackDepth=lvt,dnt._shaders.unpackFloat=avt,dnt._shaders.vertexLogDepth=vvt,dnt._shaders.windowToEyeCoordinates=yvt,dnt._shaders.writeDepthClampedToFarPlane=pvt,dnt._shaders.writeLogDepth=wvt,dnt._shaders.XYZToRGB=bvt,dnt._shaders.depthRangeStruct=kvt,dnt._shaders.ellipsoid=dvt,dnt._shaders.material=gvt,dnt._shaders.materialInput=nyt,dnt._shaders.ray=tyt,dnt._shaders.raySegment=iyt,dnt._shaders.shadowParameters=ryt,dnt._shaders.CompositeOITFS=uyt,dnt._shaders.DepthPlaneFS=fyt,dnt._shaders.DepthPlaneVS=eyt,dnt._shaders.EllipsoidFS=oyt,dnt._shaders.EllipsoidVS=syt,dnt._shaders.GlobeFS=hyt,dnt._shaders.GlobeVS=cyt,dnt._shaders.GroundAtmosphere=lyt,dnt._shaders.BumpMapMaterial=ayt,dnt._shaders.CheckerboardMaterial=vyt,dnt._shaders.DotMaterial=yyt,dnt._shaders.ElevationContourMaterial=pyt,dnt._shaders.ElevationRampMaterial=wyt,dnt._shaders.FadeMaterial=byt,dnt._shaders.GridMaterial=kyt,dnt._shaders.NormalMapMaterial=dyt,dnt._shaders.PolylineArrowMaterial=gyt,dnt._shaders.PolylineDashMaterial=npt,dnt._shaders.PolylineGlowMaterial=tpt,dnt._shaders.PolylineOutlineMaterial=ipt,dnt._shaders.RimLightingMaterial=rpt,dnt._shaders.SlopeRampMaterial=upt,dnt._shaders.StripeMaterial=fpt,dnt._shaders.Water=ept,dnt._shaders.PointPrimitiveCollectionFS=opt,dnt._shaders.PointPrimitiveCollectionVS=spt,dnt._shaders.PolylineCommon=hpt,dnt._shaders.PolylineFS=cpt,dnt._shaders.PolylineShadowVolumeFS=lpt,dnt._shaders.PolylineShadowVolumeMorphFS=apt,dnt._shaders.PolylineShadowVolumeMorphVS=vpt,dnt._shaders.PolylineShadowVolumeVS=ypt,dnt._shaders.PolylineVS=ppt,dnt._shaders.AdditiveBlend=wpt,dnt._shaders.AmbientOcclusionGenerate=bpt,dnt._shaders.AmbientOcclusionModulate=kpt,dnt._shaders.BlackAndWhite=dpt,dnt._shaders.BloomComposite=gpt,dnt._shaders.Brightness=nwt,dnt._shaders.BrightPass=twt,dnt._shaders.ContrastBias=iwt,dnt._shaders.DepthOfField=rwt,dnt._shaders.DepthView=uwt,dnt._shaders.DepthViewPacked=fwt,dnt._shaders.EdgeDetection=ewt,dnt._shaders.FXAA=owt,dnt._shaders.GaussianBlur1D=swt,dnt._shaders.LensFlare=hwt,dnt._shaders.NightVision=cwt,dnt._shaders.PassThrough=lwt,dnt._shaders.PassThroughDepth=awt,dnt._shaders.PointCloudEyeDomeLighting=vwt,dnt._shaders.Silhouette=ywt,dnt._shaders.ReprojectWebMercatorFS=pwt,dnt._shaders.ReprojectWebMercatorVS=wwt,dnt._shaders.ShadowVolumeAppearanceFS=bwt,dnt._shaders.ShadowVolumeAppearanceVS=kwt,dnt._shaders.ShadowVolumeFS=dwt,dnt._shaders.SkyAtmosphereFS=gwt,dnt._shaders.SkyAtmosphereVS=nbt,dnt._shaders.SkyBoxFS=tbt,dnt._shaders.SkyBoxVS=ibt,dnt._shaders.SunFS=rbt,dnt._shaders.SunTextureFS=ubt,dnt._shaders.SunVS=fbt,dnt._shaders.Vector3DTilePolylinesVS=ebt,dnt._shaders.VectorTileVS=obt,dnt._shaders.ViewportQuadFS=sbt,dnt._shaders.ViewportQuadVS=hbt,dnt.Autolinker=cbt,dnt["earcut-2.1.1"]=lbt,dnt.addBuffer=abt,dnt.addDefaults=vbt,dnt.addExtensionsRequired=ybt,dnt.addExtensionsUsed=pbt,dnt.addPipelineExtras=wbt,dnt.addToArray=bbt,dnt.findAccessorMinMax=kbt,dnt.ForEach=dbt,dnt.getAccessorByteStride=gbt,dnt.getComponentReader=nkt,dnt.hasExtension=tkt,dnt.moveTechniqueRenderStates=ikt,dnt.moveTechniquesToExtension=rkt,dnt.numberOfComponentsForType=ukt,dnt.parseGlb=fkt,dnt.readAccessorPacked=ekt,dnt.removeExtensionsRequired=okt,dnt.removeExtensionsUsed=skt,dnt.removePipelineExtras=hkt,dnt.removeUnusedElements=ckt,dnt.updateAccessorComponentTypes=lkt,dnt.updateVersion=akt,dnt["google-earth-dbroot-parser"]=vkt,dnt.jsep=ykt,dnt.kdbush=pkt,dnt["knockout-3.4.2"]=wkt,dnt["knockout-es5"]=bkt,dnt.knockout=kkt,dnt.measureText=dkt,dnt["mersenne-twister"]=gkt,dnt.NoSleep=ndt,dnt["protobuf-minimal"]=tdt,dnt.purify=idt,dnt.quickselect=rdt,dnt.rbush=udt,dnt.FXAA3_11=fdt,dnt.sprintf=edt,dnt.topojson=odt,dnt.Tween=sdt,dnt.Uri=hdt,dnt.when=cdt,dnt.zip=ldt,dnt.Animation=adt,dnt.AnimationViewModel=vdt,dnt.BaseLayerPicker=ydt,dnt.BaseLayerPickerViewModel=pdt,dnt.createDefaultImageryProviderViewModels=wdt,dnt.createDefaultTerrainProviderViewModels=bdt,dnt.ProviderViewModel=kdt,dnt.Cesium3DTilesInspector=ddt,dnt.Cesium3DTilesInspectorViewModel=gdt,dnt.CesiumInspector=ngt,dnt.CesiumInspectorViewModel=tgt,dnt.CesiumWidget=igt,dnt.ClockViewModel=rgt,dnt.Command=ugt,dnt.createCommand=fgt,dnt.FullscreenButton=egt,dnt.FullscreenButtonViewModel=ogt,dnt.Geocoder=sgt,dnt.GeocoderViewModel=hgt,dnt.getElement=cgt,dnt.HomeButton=lgt,dnt.HomeButtonViewModel=agt,dnt.InfoBox=vgt,dnt.InfoBoxViewModel=ygt,dnt.InspectorShared=pgt,dnt.NavigationHelpButton=wgt,dnt.NavigationHelpButtonViewModel=bgt,dnt.PerformanceWatchdog=kgt,dnt.PerformanceWatchdogViewModel=dgt,dnt.ProjectionPicker=ggt,dnt.ProjectionPickerViewModel=nnt,dnt.SceneModePicker=tnt,dnt.SceneModePickerViewModel=int,dnt.SelectionIndicator=rnt,dnt.SelectionIndicatorViewModel=unt,dnt.subscribeAndEvaluate=fnt,dnt.SvgPathBindingHandler=ent,dnt.Timeline=ont,dnt.TimelineHighlightRange=snt,dnt.TimelineTrack=hnt,dnt.ToggleButtonViewModel=cnt,dnt.Viewer=lnt,dnt.viewerCesium3DTilesInspectorMixin=ant,dnt.viewerCesiumInspectorMixin=vnt,dnt.viewerDragDropMixin=ynt,dnt.viewerPerformanceWatchdogMixin=pnt,dnt.VRButton=wnt,dnt.VRButtonViewModel=bnt,dnt.createTaskProcessorWorker=knt,dnt});i(["Cesium"],function(n){"use strict";var t=typeof window!="undefined"?window:typeof self!="undefined"?self:{};t.Cesium=n},undefined,!0)})()